(self.webpackChunkapp_studio_enterprise_omnichannel_messaging=self.webpackChunkapp_studio_enterprise_omnichannel_messaging||[]).push([[699],{10699:(Ke,K,V)=>{V.r(K),V.d(K,{AbortError:()=>I,DefaultHttpClient:()=>Q,HttpClient:()=>W,HttpError:()=>P,HttpResponse:()=>X,HttpTransportType:()=>w,HubConnection:()=>$,HubConnectionBuilder:()=>Xe,HubConnectionState:()=>v,JsonHubProtocol:()=>oe,LogLevel:()=>l,MessageType:()=>g,NullLogger:()=>N,Subject:()=>Y,TimeoutError:()=>j,TransferFormat:()=>S,VERSION:()=>G});var B=function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(t,e){i(t,e);function o(){this.constructor=t}t.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),P=function(i){B(t,i);function t(e,o){var r=this.constructor,n=this,c=r.prototype;return n=i.call(this,e)||this,n.statusCode=o,n.__proto__=c,n}return t}(Error),j=function(i){B(t,i);function t(e){var o=this.constructor;e===void 0&&(e="A timeout occurred.");var r=this,n=o.prototype;return r=i.call(this,e)||this,r.__proto__=n,r}return t}(Error),I=function(i){B(t,i);function t(e){var o=this.constructor;e===void 0&&(e="An abort occurred.");var r=this,n=o.prototype;return r=i.call(this,e)||this,r.__proto__=n,r}return t}(Error),F=Object.assign||function(i){for(var t,e=1,o=arguments.length;e<o;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},X=function(){function i(t,e,o){this.statusCode=t,this.statusText=e,this.content=o}return i}(),W=function(){function i(){}return i.prototype.get=function(t,e){return this.send(F({},e,{method:"GET",url:t}))},i.prototype.post=function(t,e){return this.send(F({},e,{method:"POST",url:t}))},i.prototype.delete=function(t,e){return this.send(F({},e,{method:"DELETE",url:t}))},i.prototype.getCookieString=function(t){return""},i}(),l;(function(i){i[i.Trace=0]="Trace",i[i.Debug=1]="Debug",i[i.Information=2]="Information",i[i.Warning=3]="Warning",i[i.Error=4]="Error",i[i.Critical=5]="Critical",i[i.None=6]="None"})(l||(l={}));var N=function(){function i(){}return i.prototype.log=function(t,e){},i.instance=new i,i}(),se=Object.assign||function(i){for(var t,e=1,o=arguments.length;e<o;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},ce=function(i,t,e,o){return new(e||(e=Promise))(function(r,n){function c(s){try{u(o.next(s))}catch(h){n(h)}}function a(s){try{u(o.throw(s))}catch(h){n(h)}}function u(s){s.done?r(s.value):new e(function(h){h(s.value)}).then(c,a)}u((o=o.apply(i,t||[])).next())})},ae=function(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,r,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(s){return function(h){return u([s,h])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,r&&(n=s[0]&2?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,r=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(i,e)}catch(h){s=[6,h],r=0}finally{o=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},G="5.0.17",y=function(){function i(){}return i.isRequired=function(t,e){if(t==null)throw new Error("The '"+e+"' argument is required.")},i.isNotEmpty=function(t,e){if(!t||t.match(/^\s*$/))throw new Error("The '"+e+"' argument should not be empty.")},i.isIn=function(t,e,o){if(!(t in e))throw new Error("Unknown "+o+" value: "+t+".")},i}(),C=function(){function i(){}return Object.defineProperty(i,"isBrowser",{get:function(){return typeof window=="object"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"isWebWorker",{get:function(){return typeof self=="object"&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(i,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),i}();function x(i,t){var e="";return J(i)?(e="Binary data of length "+i.byteLength,t&&(e+=". Content: '"+ue(i)+"'")):typeof i=="string"&&(e="String data of length "+i.length,t&&(e+=". Content: '"+i+"'")),e}function ue(i){var t=new Uint8Array(i),e="";return t.forEach(function(o){var r=o<16?"0":"";e+="0x"+r+o.toString(16)+" "}),e.substr(0,e.length-1)}function J(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function z(i,t,e,o,r,n,c,a,u){return ce(this,void 0,void 0,function(){var s,h,f,d,m,k,b,p;return ae(this,function(M){switch(M.label){case 0:return h={},r?[4,r()]:[3,2];case 1:f=M.sent(),f&&(h=(s={},s.Authorization="Bearer "+f,s)),M.label=2;case 2:return d=D(),m=d[0],k=d[1],h[m]=k,i.log(l.Trace,"("+t+" transport) sending data. "+x(n,c)+"."),b=J(n)?"arraybuffer":"text",[4,e.post(o,{content:n,headers:se({},h,u),responseType:b,withCredentials:a})];case 3:return p=M.sent(),i.log(l.Trace,"("+t+" transport) request complete. Response status: "+p.statusCode+"."),[2]}})})}function le(i){return i===void 0?new U(l.Information):i===null?N.instance:i.log?i:new U(i)}var he=function(){function i(t,e){this.subject=t,this.observer=e}return i.prototype.dispose=function(){var t=this.subject.observers.indexOf(this.observer);t>-1&&this.subject.observers.splice(t,1),this.subject.observers.length===0&&this.subject.cancelCallback&&this.subject.cancelCallback().catch(function(e){})},i}(),U=function(){function i(t){this.minimumLogLevel=t,this.outputConsole=console}return i.prototype.log=function(t,e){if(t>=this.minimumLogLevel)switch(t){case l.Critical:case l.Error:this.outputConsole.error("["+new Date().toISOString()+"] "+l[t]+": "+e);break;case l.Warning:this.outputConsole.warn("["+new Date().toISOString()+"] "+l[t]+": "+e);break;case l.Information:this.outputConsole.info("["+new Date().toISOString()+"] "+l[t]+": "+e);break;default:this.outputConsole.log("["+new Date().toISOString()+"] "+l[t]+": "+e);break}},i}();function D(){var i="X-SignalR-User-Agent";return C.isNode&&(i="User-Agent"),[i,fe(G,de(),ge(),pe())]}function fe(i,t,e,o){var r="Microsoft SignalR/",n=i.split(".");return r+=n[0]+"."+n[1],r+=" ("+i+"; ",t&&t!==""?r+=t+"; ":r+="Unknown OS; ",r+=""+e,o?r+="; "+o:r+="; Unknown Runtime Version",r+=")",r}function de(){if(C.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function pe(){if(C.isNode)return process.versions.node}function ge(){return C.isNode?"NodeJS":"Browser"}var ve=function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(t,e){i(t,e);function o(){this.constructor=t}t.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),be=Object.assign||function(i){for(var t,e=1,o=arguments.length;e<o;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},ye=function(i,t,e,o){return new(e||(e=Promise))(function(r,n){function c(s){try{u(o.next(s))}catch(h){n(h)}}function a(s){try{u(o.throw(s))}catch(h){n(h)}}function u(s){s.done?r(s.value):new e(function(h){h(s.value)}).then(c,a)}u((o=o.apply(i,t||[])).next())})},we=function(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,r,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(s){return function(h){return u([s,h])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,r&&(n=s[0]&2?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,r=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(i,e)}catch(h){s=[6,h],r=0}finally{o=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},me=function(i){ve(t,i);function t(e){var o=i.call(this)||this;if(o.logger=e,typeof fetch>"u"){var r=__WEBPACK_EXTERNAL_createRequire(import.meta.url);o.jar=new(r("tough-cookie")).CookieJar,o.fetchType=r("node-fetch"),o.fetchType=r("fetch-cookie")(o.fetchType,o.jar),o.abortControllerType=r("abort-controller")}else o.fetchType=fetch.bind(self),o.abortControllerType=AbortController;return o}return t.prototype.send=function(e){return ye(this,void 0,void 0,function(){var o,r,n,c,a,u,s,h,f=this;return we(this,function(d){switch(d.label){case 0:if(e.abortSignal&&e.abortSignal.aborted)throw new I;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");o=new this.abortControllerType,e.abortSignal&&(e.abortSignal.onabort=function(){o.abort(),r=new I}),n=null,e.timeout&&(c=e.timeout,n=setTimeout(function(){o.abort(),f.logger.log(l.Warning,"Timeout from HTTP request."),r=new j},c)),d.label=1;case 1:return d.trys.push([1,3,4,5]),[4,this.fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:be({"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest"},e.headers),method:e.method,mode:"cors",redirect:"manual",signal:o.signal})];case 2:return a=d.sent(),[3,5];case 3:throw u=d.sent(),r||(this.logger.log(l.Warning,"Error from HTTP request. "+u+"."),u);case 4:return n&&clearTimeout(n),e.abortSignal&&(e.abortSignal.onabort=null),[7];case 5:if(!a.ok)throw new P(a.statusText,a.status);return s=Se(a,e.responseType),[4,s];case 6:return h=d.sent(),[2,new X(a.status,a.statusText,h)]}})})},t.prototype.getCookieString=function(e){var o="";return C.isNode&&this.jar&&this.jar.getCookies(e,function(r,n){return o=n.join("; ")}),o},t}(W);function Se(i,t){var e;switch(t){case"arraybuffer":e=i.arrayBuffer();break;case"text":e=i.text();break;case"blob":case"document":case"json":throw new Error(t+" is not supported.");default:e=i.text();break}return e}var Ce=function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(t,e){i(t,e);function o(){this.constructor=t}t.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),ke=function(i){Ce(t,i);function t(e){var o=i.call(this)||this;return o.logger=e,o}return t.prototype.send=function(e){var o=this;return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new I):e.method?e.url?new Promise(function(r,n){var c=new XMLHttpRequest;c.open(e.method,e.url,!0),c.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var a=e.headers;a&&Object.keys(a).forEach(function(u){c.setRequestHeader(u,a[u])}),e.responseType&&(c.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=function(){c.abort(),n(new I)}),e.timeout&&(c.timeout=e.timeout),c.onload=function(){e.abortSignal&&(e.abortSignal.onabort=null),c.status>=200&&c.status<300?r(new X(c.status,c.statusText,c.response||c.responseText)):n(new P(c.statusText,c.status))},c.onerror=function(){o.logger.log(l.Warning,"Error from HTTP request. "+c.status+": "+c.statusText+"."),n(new P(c.statusText,c.status))},c.ontimeout=function(){o.logger.log(l.Warning,"Timeout from HTTP request."),n(new j)},c.send(e.content||"")}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},t}(W),Ee=function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(t,e){i(t,e);function o(){this.constructor=t}t.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),Q=function(i){Ee(t,i);function t(e){var o=i.call(this)||this;if(typeof fetch<"u"||C.isNode)o.httpClient=new me(e);else if(typeof XMLHttpRequest<"u")o.httpClient=new ke(e);else throw new Error("No usable HttpClient found.");return o}return t.prototype.send=function(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new I):e.method?e.url?this.httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},t.prototype.getCookieString=function(e){return this.httpClient.getCookieString(e)},t}(W),R=function(){function i(){}return i.write=function(t){return""+t+i.RecordSeparator},i.parse=function(t){if(t[t.length-1]!==i.RecordSeparator)throw new Error("Message is incomplete.");var e=t.split(i.RecordSeparator);return e.pop(),e},i.RecordSeparatorCode=30,i.RecordSeparator=String.fromCharCode(i.RecordSeparatorCode),i}(),Te=function(){function i(){}return i.prototype.writeHandshakeRequest=function(t){return R.write(JSON.stringify(t))},i.prototype.parseHandshakeResponse=function(t){var e,o,r;if(J(t)||typeof Buffer<"u"&&t instanceof Buffer){var n=new Uint8Array(t),c=n.indexOf(R.RecordSeparatorCode);if(c===-1)throw new Error("Message is incomplete.");var a=c+1;o=String.fromCharCode.apply(null,n.slice(0,a)),r=n.byteLength>a?n.slice(a).buffer:null}else{var u=t,c=u.indexOf(R.RecordSeparator);if(c===-1)throw new Error("Message is incomplete.");var a=c+1;o=u.substring(0,a),r=u.length>a?u.substring(a):null}var s=R.parse(o),h=JSON.parse(s[0]);if(h.type)throw new Error("Expected a handshake response from the server.");return e=h,[r,e]},i}(),g;(function(i){i[i.Invocation=1]="Invocation",i[i.StreamItem=2]="StreamItem",i[i.Completion=3]="Completion",i[i.StreamInvocation=4]="StreamInvocation",i[i.CancelInvocation=5]="CancelInvocation",i[i.Ping=6]="Ping",i[i.Close=7]="Close"})(g||(g={}));var Y=function(){function i(){this.observers=[]}return i.prototype.next=function(t){for(var e=0,o=this.observers;e<o.length;e++){var r=o[e];r.next(t)}},i.prototype.error=function(t){for(var e=0,o=this.observers;e<o.length;e++){var r=o[e];r.error&&r.error(t)}},i.prototype.complete=function(){for(var t=0,e=this.observers;t<e.length;t++){var o=e[t];o.complete&&o.complete()}},i.prototype.subscribe=function(t){return this.observers.push(t),new he(this,t)},i}(),H=function(i,t,e,o){return new(e||(e=Promise))(function(r,n){function c(s){try{u(o.next(s))}catch(h){n(h)}}function a(s){try{u(o.throw(s))}catch(h){n(h)}}function u(s){s.done?r(s.value):new e(function(h){h(s.value)}).then(c,a)}u((o=o.apply(i,t||[])).next())})},_=function(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,r,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(s){return function(h){return u([s,h])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,r&&(n=s[0]&2?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,r=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(i,e)}catch(h){s=[6,h],r=0}finally{o=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Pe=30*1e3,Ie=15*1e3,v;(function(i){i.Disconnected="Disconnected",i.Connecting="Connecting",i.Connected="Connected",i.Disconnecting="Disconnecting",i.Reconnecting="Reconnecting"})(v||(v={}));var $=function(){function i(t,e,o,r){var n=this;this.nextKeepAlive=0,y.isRequired(t,"connection"),y.isRequired(e,"logger"),y.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=Pe,this.keepAliveIntervalInMilliseconds=Ie,this.logger=e,this.protocol=o,this.connection=t,this.reconnectPolicy=r,this.handshakeProtocol=new Te,this.connection.onreceive=function(c){return n.processIncomingData(c)},this.connection.onclose=function(c){return n.connectionClosed(c)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=v.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:g.Ping})}return i.create=function(t,e,o,r){return new i(t,e,o,r)},Object.defineProperty(i.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(t){if(this.connectionState!==v.Disconnected&&this.connectionState!==v.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t},enumerable:!0,configurable:!0}),i.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},i.prototype.startWithStateTransitions=function(){return H(this,void 0,void 0,function(){var t;return _(this,function(e){switch(e.label){case 0:if(this.connectionState!==v.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=v.Connecting,this.logger.log(l.Debug,"Starting HubConnection."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return e.sent(),this.connectionState=v.Connected,this.connectionStarted=!0,this.logger.log(l.Debug,"HubConnection connected successfully."),[3,4];case 3:return t=e.sent(),this.connectionState=v.Disconnected,this.logger.log(l.Debug,"HubConnection failed to start successfully because of error '"+t+"'."),[2,Promise.reject(t)];case 4:return[2]}})})},i.prototype.startInternal=function(){return H(this,void 0,void 0,function(){var t,e,o,r=this;return _(this,function(n){switch(n.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,t=new Promise(function(c,a){r.handshakeResolver=c,r.handshakeRejecter=a}),[4,this.connection.start(this.protocol.transferFormat)];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),e={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(l.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(e))];case 3:return n.sent(),this.logger.log(l.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,t];case 4:if(n.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return o=n.sent(),this.logger.log(l.Debug,"Hub handshake failed with error '"+o+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(o)];case 6:throw n.sent(),o;case 7:return[2]}})})},i.prototype.stop=function(){return H(this,void 0,void 0,function(){var t,e;return _(this,function(o){switch(o.label){case 0:return t=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,t];case 3:return o.sent(),[3,5];case 4:return e=o.sent(),[3,5];case 5:return[2]}})})},i.prototype.stopInternal=function(t){return this.connectionState===v.Disconnected?(this.logger.log(l.Debug,"Call to HubConnection.stop("+t+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===v.Disconnecting?(this.logger.log(l.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=v.Disconnecting,this.logger.log(l.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(l.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=t||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))},i.prototype.stream=function(t){for(var e=this,o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];var n=this.replaceStreamingParams(o),c=n[0],a=n[1],u=this.createStreamInvocation(t,o,a),s,h=new Y;return h.cancelCallback=function(){var f=e.createCancelInvocation(u.invocationId);return delete e.callbacks[u.invocationId],s.then(function(){return e.sendWithProtocol(f)})},this.callbacks[u.invocationId]=function(f,d){if(d){h.error(d);return}else f&&(f.type===g.Completion?f.error?h.error(new Error(f.error)):h.complete():h.next(f.item))},s=this.sendWithProtocol(u).catch(function(f){h.error(f),delete e.callbacks[u.invocationId]}),this.launchStreams(c,s),h},i.prototype.sendMessage=function(t){return this.resetKeepAliveInterval(),this.connection.send(t)},i.prototype.sendWithProtocol=function(t){return this.sendMessage(this.protocol.writeMessage(t))},i.prototype.send=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var r=this.replaceStreamingParams(e),n=r[0],c=r[1],a=this.sendWithProtocol(this.createInvocation(t,e,!0,c));return this.launchStreams(n,a),a},i.prototype.invoke=function(t){for(var e=this,o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];var n=this.replaceStreamingParams(o),c=n[0],a=n[1],u=this.createInvocation(t,o,!1,a),s=new Promise(function(h,f){e.callbacks[u.invocationId]=function(m,k){if(k){f(k);return}else m&&(m.type===g.Completion?m.error?f(new Error(m.error)):h(m.result):f(new Error("Unexpected message type: "+m.type)))};var d=e.sendWithProtocol(u).catch(function(m){f(m),delete e.callbacks[u.invocationId]});e.launchStreams(c,d)});return s},i.prototype.on=function(t,e){!t||!e||(t=t.toLowerCase(),this.methods[t]||(this.methods[t]=[]),this.methods[t].indexOf(e)===-1&&this.methods[t].push(e))},i.prototype.off=function(t,e){if(t){t=t.toLowerCase();var o=this.methods[t];if(o)if(e){var r=o.indexOf(e);r!==-1&&(o.splice(r,1),o.length===0&&delete this.methods[t])}else delete this.methods[t]}},i.prototype.onclose=function(t){t&&this.closedCallbacks.push(t)},i.prototype.onreconnecting=function(t){t&&this.reconnectingCallbacks.push(t)},i.prototype.onreconnected=function(t){t&&this.reconnectedCallbacks.push(t)},i.prototype.processIncomingData=function(t){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(t=this.processHandshakeResponse(t),this.receivedHandshakeResponse=!0),t)for(var e=this.protocol.parseMessages(t,this.logger),o=0,r=e;o<r.length;o++){var n=r[o];switch(n.type){case g.Invocation:this.invokeClientMethod(n);break;case g.StreamItem:case g.Completion:var c=this.callbacks[n.invocationId];c&&(n.type===g.Completion&&delete this.callbacks[n.invocationId],c(n));break;case g.Ping:break;case g.Close:this.logger.log(l.Information,"Close message received from server.");var a=n.error?new Error("Server returned an error on close: "+n.error):void 0;n.allowReconnect===!0?this.connection.stop(a):this.stopPromise=this.stopInternal(a);break;default:this.logger.log(l.Warning,"Invalid message type: "+n.type+".");break}}this.resetTimeoutPeriod()},i.prototype.processHandshakeResponse=function(t){var e,o,r;try{e=this.handshakeProtocol.parseHandshakeResponse(t),r=e[0],o=e[1]}catch(a){var n="Error parsing handshake response: "+a;this.logger.log(l.Error,n);var c=new Error(n);throw this.handshakeRejecter(c),c}if(o.error){var n="Server returned handshake error: "+o.error;this.logger.log(l.Error,n);var c=new Error(n);throw this.handshakeRejecter(c),c}else this.logger.log(l.Debug,"Server handshake complete.");return this.handshakeResolver(),r},i.prototype.resetKeepAliveInterval=function(){this.connection.features.inherentKeepAlive||(this.nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this.cleanupPingTimer())},i.prototype.resetTimeoutPeriod=function(){var t=this;if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this.timeoutHandle=setTimeout(function(){return t.serverTimeout()},this.serverTimeoutInMilliseconds),this.pingServerHandle===void 0)){var e=this.nextKeepAlive-new Date().getTime();e<0&&(e=0),this.pingServerHandle=setTimeout(function(){return H(t,void 0,void 0,function(){var o;return _(this,function(r){switch(r.label){case 0:if(this.connectionState!==v.Connected)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return r.sent(),[3,4];case 3:return o=r.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}})})},e)}},i.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},i.prototype.invokeClientMethod=function(t){var e=this,o=this.methods[t.target.toLowerCase()];if(o){try{o.forEach(function(n){return n.apply(e,t.arguments)})}catch(n){this.logger.log(l.Error,"A callback for the method "+t.target.toLowerCase()+" threw error '"+n+"'.")}if(t.invocationId){var r="Server requested a response, which is not supported in this version of the client.";this.logger.log(l.Error,r),this.stopPromise=this.stopInternal(new Error(r))}}else this.logger.log(l.Warning,"No client method with the name '"+t.target+"' found.")},i.prototype.connectionClosed=function(t){this.logger.log(l.Debug,"HubConnection.connectionClosed("+t+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||t||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===v.Disconnecting?this.completeClose(t):this.connectionState===v.Connected&&this.reconnectPolicy?this.reconnect(t):this.connectionState===v.Connected&&this.completeClose(t)},i.prototype.completeClose=function(t){var e=this;if(this.connectionStarted){this.connectionState=v.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach(function(o){return o.apply(e,[t])})}catch(o){this.logger.log(l.Error,"An onclose callback called with error '"+t+"' threw error '"+o+"'.")}}},i.prototype.reconnect=function(t){return H(this,void 0,void 0,function(){var e,o,r,n,c,a=this;return _(this,function(u){switch(u.label){case 0:if(e=Date.now(),o=0,r=t!==void 0?t:new Error("Attempting to reconnect due to a unknown error."),n=this.getNextRetryDelay(o++,0,r),n===null)return this.logger.log(l.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(t),[2];if(this.connectionState=v.Reconnecting,t?this.logger.log(l.Information,"Connection reconnecting because of error '"+t+"'."):this.logger.log(l.Information,"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach(function(s){return s.apply(a,[t])})}catch(s){this.logger.log(l.Error,"An onreconnecting callback called with error '"+t+"' threw error '"+s+"'.")}if(this.connectionState!==v.Reconnecting)return this.logger.log(l.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}u.label=1;case 1:return n===null?[3,7]:(this.logger.log(l.Information,"Reconnect attempt number "+o+" will start in "+n+" ms."),[4,new Promise(function(s){a.reconnectDelayHandle=setTimeout(s,n)})]);case 2:if(u.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==v.Reconnecting)return this.logger.log(l.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];u.label=3;case 3:return u.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(u.sent(),this.connectionState=v.Connected,this.logger.log(l.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach(function(s){return s.apply(a,[a.connection.connectionId])})}catch(s){this.logger.log(l.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+s+"'.")}return[2];case 5:return c=u.sent(),this.logger.log(l.Information,"Reconnect attempt failed because of error '"+c+"'."),this.connectionState!==v.Reconnecting?(this.logger.log(l.Debug,"Connection moved to the '"+this.connectionState+"' from the reconnecting state during reconnect attempt. Done reconnecting."),this.connectionState===v.Disconnecting&&this.completeClose(),[2]):(r=c instanceof Error?c:new Error(c.toString()),n=this.getNextRetryDelay(o++,Date.now()-e,r),[3,6]);case 6:return[3,1];case 7:return this.logger.log(l.Information,"Reconnect retries have been exhausted after "+(Date.now()-e)+" ms and "+o+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}})})},i.prototype.getNextRetryDelay=function(t,e,o){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:t,retryReason:o})}catch(r){return this.logger.log(l.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+t+", "+e+") threw error '"+r+"'."),null}},i.prototype.cancelCallbacksWithError=function(t){var e=this.callbacks;this.callbacks={},Object.keys(e).forEach(function(o){var r=e[o];r(null,t)})},i.prototype.cleanupPingTimer=function(){this.pingServerHandle&&(clearTimeout(this.pingServerHandle),this.pingServerHandle=void 0)},i.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},i.prototype.createInvocation=function(t,e,o,r){if(o)return r.length!==0?{arguments:e,streamIds:r,target:t,type:g.Invocation}:{arguments:e,target:t,type:g.Invocation};var n=this.invocationId;return this.invocationId++,r.length!==0?{arguments:e,invocationId:n.toString(),streamIds:r,target:t,type:g.Invocation}:{arguments:e,invocationId:n.toString(),target:t,type:g.Invocation}},i.prototype.launchStreams=function(t,e){var o=this;if(t.length!==0){e||(e=Promise.resolve());var r=function(c){t[c].subscribe({complete:function(){e=e.then(function(){return o.sendWithProtocol(o.createCompletionMessage(c))})},error:function(a){var u;a instanceof Error?u=a.message:a&&a.toString?u=a.toString():u="Unknown error",e=e.then(function(){return o.sendWithProtocol(o.createCompletionMessage(c,u))})},next:function(a){e=e.then(function(){return o.sendWithProtocol(o.createStreamItemMessage(c,a))})}})};for(var n in t)r(n)}},i.prototype.replaceStreamingParams=function(t){for(var e=[],o=[],r=0;r<t.length;r++){var n=t[r];if(this.isObservable(n)){var c=this.invocationId;this.invocationId++,e[c]=n,o.push(c.toString()),t.splice(r,1)}}return[e,o]},i.prototype.isObservable=function(t){return t&&t.subscribe&&typeof t.subscribe=="function"},i.prototype.createStreamInvocation=function(t,e,o){var r=this.invocationId;return this.invocationId++,o.length!==0?{arguments:e,invocationId:r.toString(),streamIds:o,target:t,type:g.StreamInvocation}:{arguments:e,invocationId:r.toString(),target:t,type:g.StreamInvocation}},i.prototype.createCancelInvocation=function(t){return{invocationId:t,type:g.CancelInvocation}},i.prototype.createStreamItemMessage=function(t,e){return{invocationId:t,item:e,type:g.StreamItem}},i.prototype.createCompletionMessage=function(t,e,o){return e?{error:e,invocationId:t,type:g.Completion}:{invocationId:t,result:o,type:g.Completion}},i}(),De=[0,2e3,1e4,3e4,null],Z=function(){function i(t){this.retryDelays=t!==void 0?t.concat([null]):De}return i.prototype.nextRetryDelayInMilliseconds=function(t){return this.retryDelays[t.previousRetryCount]},i}(),w;(function(i){i[i.None=0]="None",i[i.WebSockets=1]="WebSockets",i[i.ServerSentEvents=2]="ServerSentEvents",i[i.LongPolling=4]="LongPolling"})(w||(w={}));var S;(function(i){i[i.Text=1]="Text",i[i.Binary=2]="Binary"})(S||(S={}));var Re=function(){function i(){this.isAborted=!1,this.onabort=null}return i.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(i.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),i}(),q=Object.assign||function(i){for(var t,e=1,o=arguments.length;e<o;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},O=function(i,t,e,o){return new(e||(e=Promise))(function(r,n){function c(s){try{u(o.next(s))}catch(h){n(h)}}function a(s){try{u(o.throw(s))}catch(h){n(h)}}function u(s){s.done?r(s.value):new e(function(h){h(s.value)}).then(c,a)}u((o=o.apply(i,t||[])).next())})},A=function(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,r,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(s){return function(h){return u([s,h])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,r&&(n=s[0]&2?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,r=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(i,e)}catch(h){s=[6,h],r=0}finally{o=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},ee=function(){function i(t,e,o,r,n,c){this.httpClient=t,this.accessTokenFactory=e,this.logger=o,this.pollAbort=new Re,this.logMessageContent=r,this.withCredentials=n,this.headers=c,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(i.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),i.prototype.connect=function(t,e){return O(this,void 0,void 0,function(){var o,r,n,c,a,u,s,h,f;return A(this,function(d){switch(d.label){case 0:if(y.isRequired(t,"url"),y.isRequired(e,"transferFormat"),y.isIn(e,S,"transferFormat"),this.url=t,this.logger.log(l.Trace,"(LongPolling transport) Connecting."),e===S.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return r=D(),n=r[0],c=r[1],a=q((o={},o[n]=c,o),this.headers),u={abortSignal:this.pollAbort.signal,headers:a,timeout:1e5,withCredentials:this.withCredentials},e===S.Binary&&(u.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return s=d.sent(),this.updateHeaderToken(u,s),h=t+"&_="+Date.now(),this.logger.log(l.Trace,"(LongPolling transport) polling: "+h+"."),[4,this.httpClient.get(h,u)];case 2:return f=d.sent(),f.statusCode!==200?(this.logger.log(l.Error,"(LongPolling transport) Unexpected response code: "+f.statusCode+"."),this.closeError=new P(f.statusText||"",f.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,u),[2]}})})},i.prototype.getAccessToken=function(){return O(this,void 0,void 0,function(){return A(this,function(t){switch(t.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,null]}})})},i.prototype.updateHeaderToken=function(t,e){if(t.headers||(t.headers={}),e){t.headers.Authorization="Bearer "+e;return}t.headers.Authorization&&delete t.headers.Authorization},i.prototype.poll=function(t,e){return O(this,void 0,void 0,function(){var o,r,n,c;return A(this,function(a){switch(a.label){case 0:a.trys.push([0,,8,9]),a.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:o=a.sent(),this.updateHeaderToken(e,o),a.label=3;case 3:return a.trys.push([3,5,,6]),r=t+"&_="+Date.now(),this.logger.log(l.Trace,"(LongPolling transport) polling: "+r+"."),[4,this.httpClient.get(r,e)];case 4:return n=a.sent(),n.statusCode===204?(this.logger.log(l.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):n.statusCode!==200?(this.logger.log(l.Error,"(LongPolling transport) Unexpected response code: "+n.statusCode+"."),this.closeError=new P(n.statusText||"",n.statusCode),this.running=!1):n.content?(this.logger.log(l.Trace,"(LongPolling transport) data received. "+x(n.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(n.content)):this.logger.log(l.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return c=a.sent(),this.running?c instanceof j?this.logger.log(l.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=c,this.running=!1):this.logger.log(l.Trace,"(LongPolling transport) Poll errored after shutdown: "+c.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(l.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}})})},i.prototype.send=function(t){return O(this,void 0,void 0,function(){return A(this,function(e){return this.running?[2,z(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},i.prototype.stop=function(){return O(this,void 0,void 0,function(){var t,e,o,r,n,c;return A(this,function(a){switch(a.label){case 0:this.logger.log(l.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),a.label=1;case 1:return a.trys.push([1,,5,6]),[4,this.receiving];case 2:return a.sent(),this.logger.log(l.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),t={},e=D(),o=e[0],r=e[1],t[o]=r,n={headers:q({},t,this.headers),withCredentials:this.withCredentials},[4,this.getAccessToken()];case 3:return c=a.sent(),this.updateHeaderToken(n,c),[4,this.httpClient.delete(this.url,n)];case 4:return a.sent(),this.logger.log(l.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(l.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}})})},i.prototype.raiseOnClose=function(){if(this.onclose){var t="(LongPolling transport) Firing onclose event.";this.closeError&&(t+=" Error: "+this.closeError),this.logger.log(l.Trace,t),this.onclose(this.closeError)}},i}(),xe=Object.assign||function(i){for(var t,e=1,o=arguments.length;e<o;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},te=function(i,t,e,o){return new(e||(e=Promise))(function(r,n){function c(s){try{u(o.next(s))}catch(h){n(h)}}function a(s){try{u(o.throw(s))}catch(h){n(h)}}function u(s){s.done?r(s.value):new e(function(h){h(s.value)}).then(c,a)}u((o=o.apply(i,t||[])).next())})},ne=function(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,r,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(s){return function(h){return u([s,h])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,r&&(n=s[0]&2?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,r=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(i,e)}catch(h){s=[6,h],r=0}finally{o=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},He=function(){function i(t,e,o,r,n,c,a){this.httpClient=t,this.accessTokenFactory=e,this.logger=o,this.logMessageContent=r,this.withCredentials=c,this.eventSourceConstructor=n,this.headers=a,this.onreceive=null,this.onclose=null}return i.prototype.connect=function(t,e){return te(this,void 0,void 0,function(){var o,r=this;return ne(this,function(n){switch(n.label){case 0:return y.isRequired(t,"url"),y.isRequired(e,"transferFormat"),y.isIn(e,S,"transferFormat"),this.logger.log(l.Trace,"(SSE transport) Connecting."),this.url=t,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:o=n.sent(),o&&(t+=(t.indexOf("?")<0?"?":"&")+("access_token="+encodeURIComponent(o))),n.label=2;case 2:return[2,new Promise(function(c,a){var u=!1;if(e!==S.Text){a(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}var s;if(C.isBrowser||C.isWebWorker)s=new r.eventSourceConstructor(t,{withCredentials:r.withCredentials});else{var h=r.httpClient.getCookieString(t),f={};f.Cookie=h;var d=D(),m=d[0],k=d[1];f[m]=k,s=new r.eventSourceConstructor(t,{withCredentials:r.withCredentials,headers:xe({},f,r.headers)})}try{s.onmessage=function(b){if(r.onreceive)try{r.logger.log(l.Trace,"(SSE transport) data received. "+x(b.data,r.logMessageContent)+"."),r.onreceive(b.data)}catch(p){r.close(p);return}},s.onerror=function(b){var p=new Error(b.data||"Error occurred");u?r.close(p):a(p)},s.onopen=function(){r.logger.log(l.Information,"SSE connected to "+r.url),r.eventSource=s,u=!0,c()}}catch(b){a(b);return}})]}})})},i.prototype.send=function(t){return te(this,void 0,void 0,function(){return ne(this,function(e){return this.eventSource?[2,z(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},i.prototype.stop=function(){return this.close(),Promise.resolve()},i.prototype.close=function(t){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(t))},i}(),_e=Object.assign||function(i){for(var t,e=1,o=arguments.length;e<o;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},Oe=function(i,t,e,o){return new(e||(e=Promise))(function(r,n){function c(s){try{u(o.next(s))}catch(h){n(h)}}function a(s){try{u(o.throw(s))}catch(h){n(h)}}function u(s){s.done?r(s.value):new e(function(h){h(s.value)}).then(c,a)}u((o=o.apply(i,t||[])).next())})},Ae=function(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,r,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(s){return function(h){return u([s,h])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,r&&(n=s[0]&2?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,r=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(i,e)}catch(h){s=[6,h],r=0}finally{o=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},je=function(){function i(t,e,o,r,n,c){this.logger=o,this.accessTokenFactory=e,this.logMessageContent=r,this.webSocketConstructor=n,this.httpClient=t,this.onreceive=null,this.onclose=null,this.headers=c}return i.prototype.connect=function(t,e){return Oe(this,void 0,void 0,function(){var o,r=this;return Ae(this,function(n){switch(n.label){case 0:return y.isRequired(t,"url"),y.isRequired(e,"transferFormat"),y.isIn(e,S,"transferFormat"),this.logger.log(l.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:o=n.sent(),o&&(t+=(t.indexOf("?")<0?"?":"&")+("access_token="+encodeURIComponent(o))),n.label=2;case 2:return[2,new Promise(function(c,a){t=t.replace(/^http/,"ws");var u,s=r.httpClient.getCookieString(t),h=!1;if(C.isNode){var f={},d=D(),m=d[0],k=d[1];f[m]=k,s&&(f.Cookie=""+s),u=new r.webSocketConstructor(t,void 0,{headers:_e({},f,r.headers)})}u||(u=new r.webSocketConstructor(t)),e===S.Binary&&(u.binaryType="arraybuffer"),u.onopen=function(b){r.logger.log(l.Information,"WebSocket connected to "+t+"."),r.webSocket=u,h=!0,c()},u.onerror=function(b){var p=null;typeof ErrorEvent<"u"&&b instanceof ErrorEvent?p=b.error:p=new Error("There was an error with the transport."),a(p)},u.onmessage=function(b){if(r.logger.log(l.Trace,"(WebSockets transport) data received. "+x(b.data,r.logMessageContent)+"."),r.onreceive)try{r.onreceive(b.data)}catch(p){r.close(p);return}},u.onclose=function(b){if(h)r.close(b);else{var p=null;typeof ErrorEvent<"u"&&b instanceof ErrorEvent?p=b.error:p=new Error("There was an error with the transport."),a(p)}}})]}})})},i.prototype.send=function(t){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(l.Trace,"(WebSockets transport) sending data. "+x(t,this.logMessageContent)+"."),this.webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},i.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},i.prototype.close=function(t){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(l.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this.isCloseEvent(t)&&(t.wasClean===!1||t.code!==1e3)?this.onclose(new Error("WebSocket closed with status code: "+t.code+" ("+t.reason+").")):t instanceof Error?this.onclose(t):this.onclose())},i.prototype.isCloseEvent=function(t){return t&&typeof t.wasClean=="boolean"&&typeof t.code=="number"},i}(),We=Object.assign||function(i){for(var t,e=1,o=arguments.length;e<o;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},T=function(i,t,e,o){return new(e||(e=Promise))(function(r,n){function c(s){try{u(o.next(s))}catch(h){n(h)}}function a(s){try{u(o.throw(s))}catch(h){n(h)}}function u(s){s.done?r(s.value):new e(function(h){h(s.value)}).then(c,a)}u((o=o.apply(i,t||[])).next())})},E=function(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,r,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(s){return function(h){return u([s,h])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,r&&(n=s[0]&2?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,r=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(i,e)}catch(h){s=[6,h],r=0}finally{o=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},re=100,Ne=function(){function i(t,e){if(e===void 0&&(e={}),this.stopPromiseResolver=function(){},this.features={},this.negotiateVersion=1,y.isRequired(t,"url"),this.logger=le(e.logger),this.baseUrl=this.resolveUrl(t),e=e||{},e.logMessageContent=e.logMessageContent===void 0?!1:e.logMessageContent,typeof e.withCredentials=="boolean"||e.withCredentials===void 0)e.withCredentials=e.withCredentials===void 0?!0:e.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");var o=null,r=null;if(C.isNode){var n=__WEBPACK_EXTERNAL_createRequire(import.meta.url);o=n("ws"),r=n("eventsource")}!C.isNode&&typeof WebSocket<"u"&&!e.WebSocket?e.WebSocket=WebSocket:C.isNode&&!e.WebSocket&&o&&(e.WebSocket=o),!C.isNode&&typeof EventSource<"u"&&!e.EventSource?e.EventSource=EventSource:C.isNode&&!e.EventSource&&typeof r<"u"&&(e.EventSource=r),this.httpClient=e.httpClient||new Q(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=e,this.onreceive=null,this.onclose=null}return i.prototype.start=function(t){return T(this,void 0,void 0,function(){var e,e;return E(this,function(o){switch(o.label){case 0:return t=t||S.Binary,y.isIn(t,S,"transferFormat"),this.logger.log(l.Debug,"Starting connection with transfer format '"+S[t]+"'."),this.connectionState!=="Disconnected"?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting",this.startInternalPromise=this.startInternal(t),[4,this.startInternalPromise]);case 1:return o.sent(),this.connectionState!=="Disconnecting"?[3,3]:(e="Failed to start the HttpConnection before stop() was called.",this.logger.log(l.Error,e),[4,this.stopPromise]);case 2:return o.sent(),[2,Promise.reject(new Error(e))];case 3:if(this.connectionState!=="Connected")return e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!",this.logger.log(l.Error,e),[2,Promise.reject(new Error(e))];o.label=4;case 4:return this.connectionStarted=!0,[2]}})})},i.prototype.send=function(t){return this.connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new Le(this.transport)),this.sendQueue.send(t))},i.prototype.stop=function(t){return T(this,void 0,void 0,function(){var e=this;return E(this,function(o){switch(o.label){case 0:return this.connectionState==="Disconnected"?(this.logger.log(l.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):this.connectionState==="Disconnecting"?(this.logger.log(l.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise(function(r){e.stopPromiseResolver=r}),[4,this.stopInternal(t)]);case 1:return o.sent(),[4,this.stopPromise];case 2:return o.sent(),[2]}})})},i.prototype.stopInternal=function(t){return T(this,void 0,void 0,function(){var e,o;return E(this,function(r){switch(r.label){case 0:this.stopError=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:return r.sent(),[3,4];case 3:return e=r.sent(),[3,4];case 4:if(!this.transport)return[3,9];r.label=5;case 5:return r.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return r.sent(),[3,8];case 7:return o=r.sent(),this.logger.log(l.Error,"HttpConnection.transport.stop() threw error '"+o+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(l.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),r.label=10;case 10:return[2]}})})},i.prototype.startInternal=function(t){return T(this,void 0,void 0,function(){var e,o,r,n,c,a;return E(this,function(u){switch(u.label){case 0:e=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,u.label=1;case 1:return u.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==w.WebSockets?[3,3]:(this.transport=this.constructTransport(w.WebSockets),[4,this.startTransport(e,t)]):[3,5];case 2:return u.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:o=null,r=0,n=function(){var s;return E(this,function(h){switch(h.label){case 0:return[4,c.getNegotiationResponse(e)];case 1:if(o=h.sent(),c.connectionState==="Disconnecting"||c.connectionState==="Disconnected")throw new Error("The connection was stopped during negotiation.");if(o.error)throw new Error(o.error);if(o.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return o.url&&(e=o.url),o.accessToken&&(s=o.accessToken,c.accessTokenFactory=function(){return s}),r++,[2]}})},c=this,u.label=6;case 6:return[5,n()];case 7:u.sent(),u.label=8;case 8:if(o.url&&r<re)return[3,6];u.label=9;case 9:if(r===re&&o.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(e,this.options.transport,o,t)];case 10:u.sent(),u.label=11;case 11:return this.transport instanceof ee&&(this.features.inherentKeepAlive=!0),this.connectionState==="Connecting"&&(this.logger.log(l.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return a=u.sent(),this.logger.log(l.Error,"Failed to start the connection: "+a),this.connectionState="Disconnected",this.transport=void 0,this.stopPromiseResolver(),[2,Promise.reject(a)];case 13:return[2]}})})},i.prototype.getNegotiationResponse=function(t){return T(this,void 0,void 0,function(){var e,o,r,n,c,a,u,s,h;return E(this,function(f){switch(f.label){case 0:return e={},this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:o=f.sent(),o&&(e.Authorization="Bearer "+o),f.label=2;case 2:r=D(),n=r[0],c=r[1],e[n]=c,a=this.resolveNegotiateUrl(t),this.logger.log(l.Debug,"Sending negotiation request: "+a+"."),f.label=3;case 3:return f.trys.push([3,5,,6]),[4,this.httpClient.post(a,{content:"",headers:We({},e,this.options.headers),withCredentials:this.options.withCredentials})];case 4:return u=f.sent(),u.statusCode!==200?[2,Promise.reject(new Error("Unexpected status code returned from negotiate '"+u.statusCode+"'"))]:(s=JSON.parse(u.content),(!s.negotiateVersion||s.negotiateVersion<1)&&(s.connectionToken=s.connectionId),[2,s]);case 5:return h=f.sent(),this.logger.log(l.Error,"Failed to complete negotiation with the server: "+h),[2,Promise.reject(h)];case 6:return[2]}})})},i.prototype.createConnectUrl=function(t,e){return e?t+(t.indexOf("?")===-1?"?":"&")+("id="+e):t},i.prototype.createTransport=function(t,e,o,r){return T(this,void 0,void 0,function(){var n,c,a,u,s,h,f,d,m,k,b;return E(this,function(p){switch(p.label){case 0:return n=this.createConnectUrl(t,o.connectionToken),this.isITransport(e)?(this.logger.log(l.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=e,[4,this.startTransport(n,r)]):[3,2];case 1:return p.sent(),this.connectionId=o.connectionId,[2];case 2:c=[],a=o.availableTransports||[],u=o,s=0,h=a,p.label=3;case 3:return s<h.length?(f=h[s],d=this.resolveTransportOrError(f,e,r),d instanceof Error?(c.push(f.transport+" failed: "+d),[3,12]):[3,4]):[3,13];case 4:if(!this.isITransport(d))return[3,12];if(this.transport=d,u)return[3,9];p.label=5;case 5:return p.trys.push([5,7,,8]),[4,this.getNegotiationResponse(t)];case 6:return u=p.sent(),[3,8];case 7:return m=p.sent(),[2,Promise.reject(m)];case 8:n=this.createConnectUrl(t,u.connectionToken),p.label=9;case 9:return p.trys.push([9,11,,12]),[4,this.startTransport(n,r)];case 10:return p.sent(),this.connectionId=u.connectionId,[2];case 11:return k=p.sent(),this.logger.log(l.Error,"Failed to start the transport '"+f.transport+"': "+k),u=void 0,c.push(f.transport+" failed: "+k),this.connectionState!=="Connecting"?(b="Failed to select transport before stop() was called.",this.logger.log(l.Debug,b),[2,Promise.reject(new Error(b))]):[3,12];case 12:return s++,[3,3];case 13:return c.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+c.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}})})},i.prototype.constructTransport=function(t){switch(t){case w.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new je(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket,this.options.headers||{});case w.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new He(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource,this.options.withCredentials,this.options.headers||{});case w.LongPolling:return new ee(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.withCredentials,this.options.headers||{});default:throw new Error("Unknown transport: "+t+".")}},i.prototype.startTransport=function(t,e){var o=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(r){return o.stopConnection(r)},this.transport.connect(t,e)},i.prototype.resolveTransportOrError=function(t,e,o){var r=w[t.transport];if(r==null)return this.logger.log(l.Debug,"Skipping transport '"+t.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+t.transport+"' because it is not supported by this client.");if(Ue(e,r)){var n=t.transferFormats.map(function(c){return S[c]});if(n.indexOf(o)>=0){if(r===w.WebSockets&&!this.options.WebSocket||r===w.ServerSentEvents&&!this.options.EventSource)return this.logger.log(l.Debug,"Skipping transport '"+w[r]+"' because it is not supported in your environment.'"),new Error("'"+w[r]+"' is not supported in your environment.");this.logger.log(l.Debug,"Selecting transport '"+w[r]+"'.");try{return this.constructTransport(r)}catch(c){return c}}else return this.logger.log(l.Debug,"Skipping transport '"+w[r]+"' because it does not support the requested transfer format '"+S[o]+"'."),new Error("'"+w[r]+"' does not support "+S[o]+".")}else return this.logger.log(l.Debug,"Skipping transport '"+w[r]+"' because it was disabled by the client."),new Error("'"+w[r]+"' is disabled by the client.")},i.prototype.isITransport=function(t){return t&&typeof t=="object"&&"connect"in t},i.prototype.stopConnection=function(t){var e=this;if(this.logger.log(l.Debug,"HttpConnection.stopConnection("+t+") called while in state "+this.connectionState+"."),this.transport=void 0,t=this.stopError||t,this.stopError=void 0,this.connectionState==="Disconnected"){this.logger.log(l.Debug,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection is already in the disconnected state.");return}if(this.connectionState==="Connecting")throw this.logger.log(l.Warning,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection is still in the connecting state."),new Error("HttpConnection.stopConnection("+t+") was called while the connection is still in the connecting state.");if(this.connectionState==="Disconnecting"&&this.stopPromiseResolver(),t?this.logger.log(l.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(l.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch(function(o){e.logger.log(l.Error,"TransportSendQueue.stop() threw error '"+o+"'.")}),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(o){this.logger.log(l.Error,"HttpConnection.onclose("+t+") threw error '"+o+"'.")}}},i.prototype.resolveUrl=function(t){if(t.lastIndexOf("https://",0)===0||t.lastIndexOf("http://",0)===0)return t;if(!C.isBrowser||!window.document)throw new Error("Cannot resolve '"+t+"'.");var e=window.document.createElement("a");return e.href=t,this.logger.log(l.Information,"Normalizing '"+t+"' to '"+e.href+"'."),e.href},i.prototype.resolveNegotiateUrl=function(t){var e=t.indexOf("?"),o=t.substring(0,e===-1?t.length:e);return o[o.length-1]!=="/"&&(o+="/"),o+="negotiate",o+=e===-1?"":t.substring(e),o.indexOf("negotiateVersion")===-1&&(o+=e===-1?"?":"&",o+="negotiateVersion="+this.negotiateVersion),o},i}();function Ue(i,t){return!i||(t&i)!==0}var Le=function(){function i(t){this.transport=t,this.buffer=[],this.executing=!0,this.sendBufferedData=new L,this.transportResult=new L,this.sendLoopPromise=this.sendLoop()}return i.prototype.send=function(t){return this.bufferData(t),this.transportResult||(this.transportResult=new L),this.transportResult.promise},i.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},i.prototype.bufferData=function(t){if(this.buffer.length&&typeof this.buffer[0]!=typeof t)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof t);this.buffer.push(t),this.sendBufferedData.resolve()},i.prototype.sendLoop=function(){return T(this,void 0,void 0,function(){var t,e,o;return E(this,function(r){switch(r.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(r.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new L,t=this.transportResult,this.transportResult=void 0,e=typeof this.buffer[0]=="string"?this.buffer.join(""):i.concatBuffers(this.buffer),this.buffer.length=0,r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.transport.send(e)];case 3:return r.sent(),t.resolve(),[3,5];case 4:return o=r.sent(),t.reject(o),[3,5];case 5:return[3,0];case 6:return[2]}})})},i.concatBuffers=function(t){for(var e=t.map(function(u){return u.byteLength}).reduce(function(u,s){return u+s}),o=new Uint8Array(e),r=0,n=0,c=t;n<c.length;n++){var a=c[n];o.set(new Uint8Array(a),r),r+=a.byteLength}return o.buffer},i}(),L=function(){function i(){var t=this;this.promise=new Promise(function(e,o){var r;return r=[e,o],t.resolver=r[0],t.rejecter=r[1],r})}return i.prototype.resolve=function(){this.resolver()},i.prototype.reject=function(t){this.rejecter(t)},i}(),Me="json",oe=function(){function i(){this.name=Me,this.version=1,this.transferFormat=S.Text}return i.prototype.parseMessages=function(t,e){if(typeof t!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];e===null&&(e=N.instance);for(var o=R.parse(t),r=[],n=0,c=o;n<c.length;n++){var a=c[n],u=JSON.parse(a);if(typeof u.type!="number")throw new Error("Invalid payload.");switch(u.type){case g.Invocation:this.isInvocationMessage(u);break;case g.StreamItem:this.isStreamItemMessage(u);break;case g.Completion:this.isCompletionMessage(u);break;case g.Ping:break;case g.Close:break;default:e.log(l.Information,"Unknown message type '"+u.type+"' ignored.");continue}r.push(u)}return r},i.prototype.writeMessage=function(t){return R.write(JSON.stringify(t))},i.prototype.isInvocationMessage=function(t){this.assertNotEmptyString(t.target,"Invalid payload for Invocation message."),t.invocationId!==void 0&&this.assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")},i.prototype.isStreamItemMessage=function(t){if(this.assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),t.item===void 0)throw new Error("Invalid payload for StreamItem message.")},i.prototype.isCompletionMessage=function(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this.assertNotEmptyString(t.error,"Invalid payload for Completion message."),this.assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")},i.prototype.assertNotEmptyString=function(t,e){if(typeof t!="string"||t==="")throw new Error(e)},i}(),ie=Object.assign||function(i){for(var t,e=1,o=arguments.length;e<o;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},Be={trace:l.Trace,debug:l.Debug,info:l.Information,information:l.Information,warn:l.Warning,warning:l.Warning,error:l.Error,critical:l.Critical,none:l.None};function Fe(i){var t=Be[i.toLowerCase()];if(typeof t<"u")return t;throw new Error("Unknown log level: "+i)}var Xe=function(){function i(){}return i.prototype.configureLogging=function(t){if(y.isRequired(t,"logging"),Je(t))this.logger=t;else if(typeof t=="string"){var e=Fe(t);this.logger=new U(e)}else this.logger=new U(t);return this},i.prototype.withUrl=function(t,e){return y.isRequired(t,"url"),y.isNotEmpty(t,"url"),this.url=t,typeof e=="object"?this.httpConnectionOptions=ie({},this.httpConnectionOptions,e):this.httpConnectionOptions=ie({},this.httpConnectionOptions,{transport:e}),this},i.prototype.withHubProtocol=function(t){return y.isRequired(t,"protocol"),this.protocol=t,this},i.prototype.withAutomaticReconnect=function(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return t?Array.isArray(t)?this.reconnectPolicy=new Z(t):this.reconnectPolicy=t:this.reconnectPolicy=new Z,this},i.prototype.build=function(){var t=this.httpConnectionOptions||{};if(t.logger===void 0&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var e=new Ne(this.url,t);return $.create(e,this.logger||N.instance,this.protocol||new oe,this.reconnectPolicy)},i}();function Je(i){return i.log!==void 0}}}]);
