 namespace Terrasoft.Configuration
{
	using System;
	using System.Collections.Generic;
	using System.Text;
	using Terrasoft.Core;

	public class UpdateMarketingAppsDataInstallScriptExecutor : IInstallScriptExecutor
	{
		private Guid _eventManagementImageId = Guid.Parse("D57138B6-BF52-F09A-5CCD-EE8A180F782A");
		private string _eventManagementImageData = "<svg width=\"224\" height=\"144\" viewBox=\"0 0 224 144\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"> <g clip-path=\"url(#clip0_5893_134167)\"> <rect width=\"224\" height=\"144\" rx=\"8\" fill=\"url(#paint0_linear_5893_134167)\"/> <g clip-path=\"url(#clip1_5893_134167)\"> <g opacity=\"0.07\"> <path d=\"M284.867 22.6047H73.4618V230.836H284.867V22.6047Z\" stroke=\"white\" stroke-width=\"32\"/> </g> <g opacity=\"0.07\"> <path d=\"M88.7195 176.885C147.975 176.885 196.01 128.14 196.01 68.0097C196.01 7.87961 147.975 -40.8655 88.7195 -40.8655C29.4643 -40.8655 -18.5714 7.87961 -18.5714 68.0097C-18.5714 128.14 29.4643 176.885 88.7195 176.885Z\" stroke=\"white\" stroke-width=\"32\"/> </g> </g> <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M106.793 40.3674C116.095 40.3674 123.787 49.1325 123.787 60.044C123.787 65.122 122.093 69.7894 119.311 73.3041C119.223 73.3037 119.137 73.3035 119.052 73.3035C109.81 74.8134 107.652 81.4467 108.825 86.8757H108.484C107.411 88.3067 104.289 93.8519 104.289 96.3562C104.289 98.6719 106.047 100.895 107.034 101.961C107.383 102.338 107.416 102.928 107.078 103.314C106.727 103.715 106.111 103.745 105.743 103.361C103.96 101.505 102.72 99.4296 102.5 96.3562C102.321 93.8519 104.194 89.9166 106.161 86.8757H105.65C104.049 86.8757 102.949 85.2659 103.531 83.7746L105.183 79.5417C96.5971 78.6473 89.7997 70.2401 89.7997 60.044C89.7997 49.1325 97.4915 40.3674 106.793 40.3674ZM108.045 73.4599C108.045 74.4478 108.853 75.2672 109.825 75.0908C115.232 74.1094 118.941 68.6338 119.437 60.9377C119.5 59.9518 118.693 59.1496 117.705 59.1496C116.717 59.1496 115.924 59.9519 115.844 60.9366C115.457 65.7169 113.503 70.3083 109.811 71.4179C108.865 71.7022 108.045 72.4719 108.045 73.4599Z\" fill=\"white\"/> <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M137.614 73.8082C137.146 73.5901 136.625 73.5092 136.113 73.5751C135.833 73.6111 135.561 73.6901 135.308 73.8082C135.098 73.9061 134.9 74.0309 134.719 74.1802L134.711 74.1873C134.362 74.4794 134.013 74.7523 133.664 75.0072C131.352 76.6984 129.076 77.6004 127.306 78.0818C126.289 78.3587 125.444 78.495 124.866 78.5619C124.775 78.5725 124.69 78.5813 124.613 78.5887C124.445 78.6046 124.312 78.6137 124.215 78.6189C124.144 78.6227 124.094 78.6244 124.064 78.6252L124.037 78.6257H119.608C117.943 78.6257 116.346 79.2876 115.168 80.4657C113.99 81.6439 113.329 83.2418 113.329 84.9079C113.329 86.574 113.99 88.1719 115.168 89.35C115.895 90.077 116.781 90.6074 117.745 90.907L119.324 97.3603C119.421 97.7568 119.605 98.1265 119.863 98.4422C120.125 98.7617 120.456 99.0174 120.831 99.19C121.206 99.3626 121.615 99.4476 122.028 99.4386C122.435 99.4296 122.835 99.3293 123.198 99.1451L125.262 98.1183C125.717 97.8929 126.099 97.5448 126.366 97.1133C126.578 96.7714 126.711 96.3879 126.757 95.9908L126.775 95.5001V91.5978C126.946 91.6389 127.123 91.6842 127.306 91.734C129.168 92.2404 131.591 93.2124 134.026 95.0792C134.254 95.2542 134.483 95.4372 134.711 95.6284L134.719 95.6356C134.965 95.8392 135.244 95.9971 135.542 96.1036C135.726 96.1694 135.917 96.2155 136.113 96.2407C136.418 96.2799 136.726 96.2671 137.025 96.2041C137.227 96.1614 137.425 96.0957 137.614 96.0075C137.888 95.8797 138.138 95.7079 138.354 95.5001C138.507 95.3531 138.643 95.1882 138.758 95.0082C138.947 94.7149 139.077 94.3895 139.143 94.05C139.174 93.8865 139.191 93.7198 139.192 93.5518L139.193 93.5372L139.192 76.264C139.188 75.7472 139.038 75.2422 138.758 74.8075C138.479 74.3729 138.082 74.0264 137.614 73.8082ZM123.085 91.19H121.611L122.615 95.3129L123.085 95.0792L123.085 91.19ZM119.608 87.4991H123.085V82.3167H119.608C118.921 82.3167 118.263 82.5897 117.777 83.0756C117.291 83.5616 117.018 84.2207 117.018 84.9079C117.018 85.5951 117.291 86.2542 117.777 86.7401C118.263 87.2261 118.921 87.4991 119.608 87.4991Z\" fill=\"white\"/> </g> <defs> <linearGradient id=\"paint0_linear_5893_134167\" x1=\"224\" y1=\"7.632\" x2=\"89.9692\" y2=\"205.074\" gradientUnits=\"userSpaceOnUse\"> <stop stop-color=\"#F9307F\"/> <stop offset=\"1\" stop-color=\"#C2185B\"/> </linearGradient> <clipPath id=\"clip0_5893_134167\"> <rect width=\"224\" height=\"144\" rx=\"8\" fill=\"white\"/> </clipPath> <clipPath id=\"clip1_5893_134167\"> <rect width=\"224\" height=\"144\" fill=\"white\"/> </clipPath> </defs> </svg> ";
		private Guid _eventManagementWorkplaceId = Guid.Parse("9361FE9F-93AF-4DA6-A4FD-4CEDF756CE04");
		private string _eventManagementWorkplaceName = "Event management";
		private Guid _leadGenerationImageId = Guid.Parse("81AFC863-9931-70CD-6DFB-59923A1EB4FF");
		private string _leadGenerationImageData = "<svg width=\"224\" height=\"144\" viewBox=\"0 0 224 144\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"> <g clip-path=\"url(#clip0_5893_134040)\"> <rect width=\"224\" height=\"144\" rx=\"8\" fill=\"url(#paint0_linear_5893_134040)\"/> <g clip-path=\"url(#clip1_5893_134040)\"> <g opacity=\"0.07\"> <path d=\"M284.867 22.6047H73.4618V230.836H284.867V22.6047Z\" stroke=\"white\" stroke-width=\"32\"/> </g> <g opacity=\"0.07\"> <path d=\"M88.7195 176.885C147.975 176.885 196.01 128.14 196.01 68.0097C196.01 7.87961 147.975 -40.8655 88.7195 -40.8655C29.4643 -40.8655 -18.5714 7.87961 -18.5714 68.0097C-18.5714 128.14 29.4643 176.885 88.7195 176.885Z\" stroke=\"white\" stroke-width=\"32\"/> </g> </g> <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M132.725 48.0339C132.725 46.0822 131.143 44.5 129.191 44.5C127.239 44.5 125.657 46.0822 125.657 48.0339V58.3413H135.965C137.916 58.3413 139.498 56.7591 139.498 54.8074C139.498 52.8556 137.916 51.2734 135.965 51.2734H132.725V48.0339ZM119.007 54.6343C120.959 54.6343 122.541 56.2165 122.541 58.1682V61.4276H125.801C127.752 61.4276 129.334 63.0098 129.334 64.9616C129.334 66.9133 127.752 68.4955 125.801 68.4955H120.469L112.901 76.0637C111.521 77.4438 109.283 77.4438 107.903 76.0637C106.523 74.6836 106.523 72.446 107.903 71.0659L115.473 63.4959V58.1682C115.473 56.2165 117.055 54.6343 119.007 54.6343ZM99.574 59.4395C102.536 57.4601 106.019 56.4036 109.582 56.4036C111.534 56.4036 113.116 54.8214 113.116 52.8696C113.116 50.9179 111.534 49.3357 109.582 49.3357C104.621 49.3357 99.772 50.8067 95.6473 53.5628C91.5225 56.3189 88.3077 60.2362 86.4093 64.8193C84.5109 69.4025 84.0142 74.4457 84.982 79.3111C85.9498 84.1766 88.3386 88.6458 91.8464 92.1536C95.3542 95.6614 99.8234 98.0502 104.689 99.018C109.308 99.9368 114.087 99.5357 118.481 97.8683L118.358 97.7216C117.781 97.0319 117.158 96.2796 116.587 95.4788C115.712 94.2508 115.345 92.9032 115.34 91.4871C112.362 92.4919 109.165 92.702 106.068 92.086C102.573 91.3909 99.3635 89.6752 96.8442 87.1558C94.3248 84.6365 92.6091 81.4267 91.914 77.9323C91.219 74.4378 91.5757 70.8158 92.9392 67.5241C94.3026 64.2324 96.6115 61.419 99.574 59.4395ZM134.664 74.4178C134.664 75.8347 134.544 77.2425 134.309 78.6269C134.119 78.7518 133.927 78.8795 133.731 79.0101C133.075 79.4477 132.194 79.6496 130.887 79.6904C130.24 79.7107 129.559 79.6911 128.793 79.6685L128.773 79.6679H128.773C128.162 79.6499 127.499 79.6303 126.824 79.6376C127.333 77.9541 127.596 76.196 127.596 74.4178C127.596 72.4661 129.179 70.8839 131.13 70.8839C133.082 70.8839 134.664 72.4661 134.664 74.4178ZM122.22 78.6037C121.86 79.6905 121.359 80.7318 120.727 81.7C119.368 82.5921 117.934 83.8252 116.995 85.4799C116.264 85.9708 115.483 86.3905 114.662 86.7308C112.224 87.7406 109.541 88.0048 106.953 87.49C104.365 86.9752 101.987 85.7044 100.121 83.8384C98.2551 81.9724 96.9844 79.595 96.4695 77.0068C95.9547 74.4186 96.2189 71.7358 97.2288 69.2977C98.2387 66.8597 99.9488 64.7759 102.143 63.3098C103.122 62.6554 104.178 62.1373 105.282 61.764C107.131 61.1389 109.137 62.131 109.762 63.9799C110.387 65.8288 109.395 67.8344 107.546 68.4596C107.027 68.6351 106.53 68.8788 106.07 69.1865C105.038 69.876 104.234 70.856 103.759 72.0025C103.284 73.1491 103.16 74.4107 103.402 75.6279C103.644 76.8451 104.241 77.9631 105.119 78.8407C105.996 79.7182 107.114 80.3158 108.332 80.5579C109.549 80.8001 110.81 80.6758 111.957 80.2009C113.104 79.726 114.084 78.9217 114.773 77.8898C115.088 77.419 115.335 76.9106 115.512 76.3789C116.126 74.5264 118.126 73.5227 119.978 74.137C121.831 74.7514 122.835 76.7512 122.22 78.6037ZM141.523 79.5215C142.018 79.4579 142.521 79.536 142.974 79.7467C143.427 79.9573 143.81 80.292 144.08 80.7118C144.35 81.1315 144.496 81.6193 144.5 82.1183L144.5 98.8001L144.5 98.8142C144.499 98.9764 144.482 99.1374 144.452 99.2953C144.388 99.6232 144.263 99.9374 144.08 100.221C143.969 100.395 143.837 100.554 143.69 100.696C143.481 100.896 143.239 101.062 142.974 101.186C142.791 101.271 142.6 101.334 142.405 101.376C142.116 101.436 141.818 101.449 141.523 101.411C141.334 101.387 141.149 101.342 140.971 101.279C140.683 101.176 140.414 101.023 140.176 100.827L140.168 100.82C139.947 100.635 139.726 100.458 139.506 100.289C137.152 98.4865 134.81 97.5477 133.011 97.0586C132.834 97.0105 132.662 96.9668 132.497 96.9271V100.696L132.479 101.17C132.435 101.553 132.307 101.924 132.102 102.254C131.844 102.67 131.474 103.007 131.035 103.224L129.04 104.216C128.689 104.394 128.302 104.491 127.908 104.499C127.509 104.508 127.114 104.426 126.751 104.259C126.389 104.093 126.069 103.846 125.816 103.537C125.567 103.232 125.389 102.875 125.295 102.492L123.769 96.26C122.837 95.9706 121.98 95.4584 121.278 94.7563C120.139 93.6185 119.5 92.0753 119.5 90.4663C119.5 88.8572 120.139 87.314 121.278 86.1762C122.416 85.0384 123.96 84.3992 125.57 84.3992H129.851L129.877 84.3987C129.905 84.398 129.954 84.3963 130.023 84.3926C130.116 84.3876 130.245 84.3788 130.407 84.3634C130.482 84.3563 130.564 84.3478 130.652 84.3376C131.211 84.273 132.027 84.1413 133.011 83.8739C134.721 83.409 136.922 82.5379 139.156 80.9046C139.493 80.6584 139.831 80.3949 140.168 80.1128L140.176 80.1059C140.35 79.9617 140.542 79.8412 140.745 79.7467C140.99 79.6326 141.252 79.5563 141.523 79.5215ZM127.506 96.5333H128.93L128.931 100.289L128.476 100.515L127.506 96.5333ZM128.93 92.9687H125.57C124.906 92.9687 124.269 92.7051 123.8 92.2358C123.33 91.7665 123.066 91.13 123.066 90.4663C123.066 89.8026 123.33 89.1661 123.8 88.6968C124.269 88.2275 124.906 87.9638 125.57 87.9638H128.93V92.9687Z\" fill=\"white\"/> </g> <defs> <linearGradient id=\"paint0_linear_5893_134040\" x1=\"224\" y1=\"9.936\" x2=\"95.8828\" y2=\"192.745\" gradientUnits=\"userSpaceOnUse\"> <stop stop-color=\"#00C853\"/> <stop offset=\"1\" stop-color=\"#008537\"/> </linearGradient> <clipPath id=\"clip0_5893_134040\"> <rect width=\"224\" height=\"144\" rx=\"8\" fill=\"white\"/> </clipPath> <clipPath id=\"clip1_5893_134040\"> <rect width=\"224\" height=\"144\" fill=\"white\"/> </clipPath> </defs> </svg> ";
		private Guid _leadGenerationWorkplaceId = Guid.Parse("2250420C-9276-4DCF-9D8E-AE7621946C2B");
		private string _leadGenerationWorkplaceName = "Lead generation";

		private void UpdateAppsData(UserConnection userConnection) {
			var entitySchemaManager = userConnection.EntitySchemaManager;
			var sysAppTemplate = entitySchemaManager.GetEntityByName("SysAppTemplate", userConnection);
			var sysImage = entitySchemaManager.GetEntityByName("SysImage", userConnection);
			var sysWorkplace = entitySchemaManager.GetEntityByName("SysWorkplace", userConnection);
			var conditions = new Dictionary<string, object> {
				["Code"] = "CrtEventMarketingApp"
			};
			if (sysAppTemplate.FetchFromDB(conditions)) {
				sysAppTemplate.SetColumnValue("Name", "Event Management");
				sysAppTemplate.SetColumnValue("IsPrerelease", false);
				sysAppTemplate.Save(false);
			};
			conditions = new Dictionary<string, object> {
				["Id"] = _eventManagementImageId
			};
			if (sysImage.FetchFromDB(conditions)) {
				sysImage.SetBytesValue("Data", Encoding.UTF8.GetBytes(_eventManagementImageData));
				sysImage.SetColumnValue("Name", "EventManagement.svg");
				sysImage.Save(false);
			}
			conditions = new Dictionary<string, object> {
				["Id"] = _eventManagementWorkplaceId
			};
			if (sysWorkplace.FetchFromDB(conditions)) {
				sysWorkplace.SetColumnValue("Name", _eventManagementWorkplaceName);
				sysWorkplace.Save(false);
			}
			conditions = new Dictionary<string, object> {
				["Code"] = "CrtEngagementToolsApp"
			};
			if (sysAppTemplate.FetchFromDB(conditions)) {
				sysAppTemplate.SetColumnValue("Name", "Lead Generation");
				sysAppTemplate.SetColumnValue("IsPrerelease", false);
				sysAppTemplate.Save(false);
			}
			conditions = new Dictionary<string, object> {
				["Id"] = _leadGenerationImageId
			};
			if (sysImage.FetchFromDB(conditions)) {
				sysImage.SetBytesValue("Data", Encoding.UTF8.GetBytes(_leadGenerationImageData));
				sysImage.SetColumnValue("Name", "LeadGeneration.svg");
				sysImage.Save(false);
			}
			conditions = new Dictionary<string, object> {
				["Id"] = _leadGenerationWorkplaceId
			};
			if (sysWorkplace.FetchFromDB(conditions)) {
				sysWorkplace.SetColumnValue("Name", _leadGenerationWorkplaceName);
				sysWorkplace.Save(false);
			}
		}

		public void Execute(UserConnection userConnection) {
			UpdateAppsData(userConnection);
		}
	}
}
