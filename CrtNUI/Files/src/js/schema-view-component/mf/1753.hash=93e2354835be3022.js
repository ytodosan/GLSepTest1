(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[1753],{51753:(it,kn,u)=>{u.r(kn),u.d(kn,{ConnectionPropertiesPageComponent:()=>ge,ContainerPropertiesPageComponent:()=>Ae,CrtRelationshipDialogComponent:()=>Be,EntityInGroupPropertiesDialogComponent:()=>ve,GroupContentListComponent:()=>be,GroupContentListEventService:()=>ne,GroupPropertiesDialogComponent:()=>xe,GroupsPropertiesPageComponent:()=>Ne,LookupDataService:()=>te,PropertiesPageEventService:()=>de,RelatedListComponent:()=>ze,RelationshipDeleteDialogService:()=>X,RelationshipDesignerComponent:()=>_e,RelationshipDesignerModule:()=>kt,RelationshipDesignerService:()=>q,RelationshipDiagramEventHandlerController:()=>Tt,RelationshipDiagramEventService:()=>we});var r=u(5960),P=u(40297),Ln=u(63721),o=u(59131),Lt=u(44059),he=u(6675),ot=u(52989),Me=u(55231),J=u(23023),F=u(76923),W=u(4091),ue=u(70987),ie=u(67047),Ie=u(11587),Rn=u(39371),_i=u(55642),k=u(79772),wi=u(57229),zn=u(79877),st=u(90808),An=u(49973),Ge=u(58504),x=u(62278),Nn=u(65751),ji=u(99497);class Ee{constructor(e,t){this.queryExecutor=e,this.configurationDataService=t}_buildUrlWithCardModule(e,t,n){return window.location.origin+window.location.pathname+`#${e}/${t}/edit/${n}`}_getPageSchemaNameForRecord(e,t){const n=e?.pages;if(!n)return(0,x.of)(null);if(n.length===1){const i=n[0];return(0,x.of)(i)}return e.typeColumnName?this._getPageSchemaNameForRecordByType(e,t):(0,x.of)(n.find(i=>i.isDefault))}_getPageSchemaNameByType(e,t){const n=e?.pages;return n?n.length===1?n[0]:this._findPageByType(e,t):null}_getPageSchemaNameForRecordByType(e,t){return new x.Observable(n=>{this._getRecordTypeValue(e,t).subscribe(i=>{const s=this._findPageByType(e,i);n.next(s),n.complete()})})}_findPageByType(e,t){const n=e.pages;t=typeof t=="object"?t.value:t;let i=n.find(s=>s.typeId===t);return(!i||!t)&&(i=n[0]),i}_getRecordTypeValue(e,t){return new x.Observable(n=>{const i=e.entitySchemaName,s=e.typeColumnName,a=new An.s(i);a.rowCount=1,a.addSchemaColumn(s),a.filters.addSchemaColumnFilterWithParameter(Ge.H.Equal,"Id",t),this.queryExecutor.executeSelectQuery(a).subscribe(l=>{l=l||[];const h=(l[0]||{})[s].value;n.next(h),n.complete()})})}buildPageUrlByEntityName(e,t,n){const i=n.moduleStructure?.cardModule,a=this._getPageSchemaNameByType(n.entityStructure,t.typeId)?.cardSchemaName;return this._buildUrlWithCardModule(i,a,t.Id)}buildPageUrl(e,t){return new x.Observable(n=>{this.configurationDataService.getEntityData(e).subscribe(i=>{const s=i.data?.entityStructure;this._getPageSchemaNameForRecord(s,t).subscribe(a=>{const l=i.data?.moduleStructure?.cardModule,p=a?.cardSchemaName,g=this._buildUrlWithCardModule(l,p,t);n.next(g),n.complete()})})})}static{this.\u0275fac=function(t){return new(t||Ee)(o.\u0275\u0275inject(Nn.w),o.\u0275\u0275inject(ji.G))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ee,factory:Ee.\u0275fac})}}var Bn=u(31149),Gn=u(24091),Fn=u(43981),j=u(73308);class V{constructor(){this.error$=new x.Subject,this.updateElementCaption$=new x.Subject,this.updateConnectionCaption$=new x.Subject,this.updateCaption$=new x.Subject,this.changed$=new x.Subject,this.startLoading$=new x.Subject,this.endLoading$=new x.ReplaySubject(1)}init(){}bufferiseOps(e,t,n){}load(e,t){return(0,j.A)(function*(){return Promise.resolve(null)})()}getDiagramConfig(){return(0,j.A)(function*(){return Promise.resolve()})()}diagramInitialized(){}commit(e){return(0,j.A)(function*(){})()}undo(){}redo(){}clearCash(){}static{this.\u0275fac=function(t){return new(t||V)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}const at=new o.InjectionToken("DiagramFeaturesToken");var _=u(59969),Z;(function(c){c.connection="connection",c.defaultConnection="defaultConnection",c.label="label",c.root="root",c.shape="shape"})(Z||(Z={}));const Se={root:{id:"root1",type:Z.root}};(0,_.hi)("diagram.connections.connection"),(0,_.hi)("diagram.connections.defaultConnection");const Mi={connection:{caption:"connections.connection",order:{containers:["laneSet","lane","subProcessExpanded","eventSubProcessExpanded"],level:3},propertiesImage:"assets/images/SequenceFlowProperties.svg",type:Z.connection}},Y={label:{height:20,minHeight:20,type:Z.label,width:130,editStyle:{fontFamily:'"Open Sans", sans-serif',fontSize:12,fontWeight:"normal",lineHeight:1.2},padding:{paddingTop:1,paddingBottom:2,paddingLeft:2,paddingRight:2},minWidth:65,order:{level:10}}};let R=class{constructor(e={}){this.config=e,this.items=this.getItems()}getItems(){const e=this.config.customDiagramElements||{};return{...Y,...Mi,...Se,...e}}getConfig(e){return this.items[e.userTaskType||e.type]}};R=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("config")),(0,r.__metadata)("design:paramtypes",[Object])],R);let rt=class{constructor(e){this.config=e}getElements(){return{}}};rt=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("config")),(0,r.__metadata)("design:paramtypes",[Object])],rt);var v=u(28399),Ii=u.n(v),Fe=u(10018),oe;(function(c){c.connection="connection",c.root="root",c.shape="shape",c.label="label"})(oe||(oe={}));class D{static centerViewboxOnElement(e,t){const n=t.viewbox(),i=(0,Fe.U7)(e),s={x:Math.round(i.x+i.width/2-n.outer.width/2),y:Math.round(i.y+i.height/2-n.outer.height/2),width:n.outer.width,height:n.outer.height};t.viewbox(s),t.zoom(n.scale)}static isLabel(e){return e.type===oe.label}static isRoot(e){return e.type===oe.root}static getCorrectSpaceToolDelta(e,t){const n=t.context,i=n.axis,s=n.minAllowedDelta;return s!==null&&(i==="x"&&e.x<s&&(e.x=s),i==="y"&&e.y<s&&(e.y=s)),e}static getOriginalWaypoint(e,t){return[t.y,t.y+t.height].includes(e.y)?{x:e.x,y:t.y+Math.round(t.height/2)}:{x:t.x+Math.round(t.width/2),y:e.y}}getContainersType(){return[]}setProcessRelativePosition(e,t){const n=(i,s)=>{s.id===Se.root.id?(!v.isNumber(i.rx)&&i.x&&(i.rx=i.x),!v.isNumber(i.ry)&&i.y&&(i.ry=i.y)):(!v.isNumber(i.rx)&&i.x&&s.x&&(i.rx=i.x-s.x),!v.isNumber(i.ry)&&i.y&&s.y&&(i.ry=i.y-s.y))};Object.keys((0,_.vw)(e.elements)).forEach(i=>{const s=e.elements[i],a=e.elements[s.parent];n(s,a||{id:"root1"})}),Object.keys((0,_.vw)(e.labels)).forEach(i=>{const s=e.labels[i],a=e.connections[s.parent]||e.elements[s.parent];let l=a;if(a)this.isConnection(a)&&(l=e.elements[a.source]);else{const p=`Element with id "${a}" - not found in process "${e.id}"`;t.error(p,{loggerName:"setProcessRelativePosition"}),console.error(p)}n(s,l||{id:"root1"})})}isConnection(e){return oe.connection===e.type}isFlow(e){return oe.connection===e.type}findRealElementParent(e,t,n){for(const i of t)if(e.x>i.x&&e.x<i.x+i.width&&e.y>i.y&&e.y<i.y+i.height)return i;return n}getAllContainers(e){const t=this.getContainersType(),n=[];return e.forEach(i=>{if(t.includes(i.type)){const s=i.children?i.children.filter(a=>t.includes(a.type)):[];n.push({container:i,count:s.length})}},this),n.sort((i,s)=>i.count-s.count).map(i=>i.container)}}var Ei=u(41666),Si=u(20418),Di=u(39255),Pi=u(54100),Oi=u(95576),Ti=u(85284),ki=u(26316),Li=u(78768),Ri=u(54559),Vn=u(46902),zi=u(50317),Ai=u(50101),Ni=u(77648),Bi=u(79691),Gi=u(85868),Fi=u(76357),Vi=u(25342),Hi=u(88729),Ui=u(56773),Wi=u(28400),Zi=u(23550),Yi=u(64916),Qi=u(32959),$i=u(81284),Ji=u(43537);function H(){return function(c,e,t){const n=t.value;t.value=function(){return this.isReadOnly?!1:n.apply(this,arguments)}}}let z=class extends Ji.A{constructor(e,t){super(e),this.isReadOnly=!1,this.isReadOnly=t.isReadOnly}canConnect(e,t){return e.type!==Z.root&&e.type!==Z.connection&&t.type!==Z.root&&t.type!==Z.connection}addRule(e,t){super.addRule(e,t)}init(){super.addRule("connection.create",this.canConnectionCreate.bind(this)),super.addRule("connection.reconnect",this.canReconnect.bind(this)),super.addRule("elements.move",this.canElementMove.bind(this)),super.addRule("shape.create",this.canElementMove.bind(this)),super.addRule("elements.create",this.canElementMove.bind(this)),super.addRule("shape.resize",this.canElementResize.bind(this)),super.addRule("element.copy",this.canElementCopy.bind(this)),super.addRule("element.paste",this.canElementPaste.bind(this)),super.addRule("elements.delete",this.canElementsDelete.bind(this)),super.addRule("canOpenContextPad",this.canOpenContextPad.bind(this)),super.addRule("canShowConnectionOutline",this.canShowConnectionOutline.bind(this)),super.addRule("canConnectionSegmentMove",this.canConnectionSegmentMove.bind(this)),super.addRule("canLabelEdit",this.canLabelEdit.bind(this)),super.addRule("canShowPalette",this.canShowPalette.bind(this)),super.addRule("canShowLabelOutline",this.canShowLabelOutline.bind(this)),super.addRule("canElementMarkerUpdate",this.canElementMarkerUpdate.bind(this)),super.addRule("element.canUpdateType",this.canElementUpdateType.bind(this)),super.addRule("connection.updateWaypoints",this.canConnectionUpdateWaypoints.bind(this))}canElementMarkerUpdate(){return!0}canShowLabelOutline(){return!0}canConnectionSegmentMove(){return!0}canShowPalette(){return!0}canLabelEdit(){return!0}canShowConnectionOutline(){return!0}canOpenContextPad(){return!0}canConnectionCreate(e){return this.canConnect(e.target,e.source)}canReconnect(e){if(D.isRoot(e.target)||D.isRoot(e.source))return!1;switch(e.type){case"reconnectEnd":return this.canReconnectEnd(e);case"reconnectStart":return this.canReconnectStart(e);default:return this.canReconnectEnd(e)||this.canReconnectStart(e)}}canReconnectStart(e){return this.canConnect(e.target,e.source)}canReconnectEnd(e){return this.canConnect(e.target,e.source)}canElementMove(e){return!0}canElementResize(e){return!1}canElementCopy(e){return!0}canElementPaste(e){return!0}canElementsDelete(e){return!0}canElementUpdateType(e){return!0}canConnectionUpdateWaypoints(){return!1}};(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canElementMarkerUpdate",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canConnectionSegmentMove",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canShowPalette",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canLabelEdit",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canShowConnectionOutline",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canOpenContextPad",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canConnectionCreate",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object]),(0,r.__metadata)("design:returntype",Boolean)],z.prototype,"canReconnect",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canElementMove",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canElementResize",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canElementCopy",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canElementPaste",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canElementsDelete",null),(0,r.__decorate)([H(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object]),(0,r.__metadata)("design:returntype",void 0)],z.prototype,"canElementUpdateType",null),z=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("eventBus")),(0,r.__param)(1,(0,_.y_)("config")),(0,r.__metadata)("design:paramtypes",[Object,Object])],z);var Ki=u(6513);const A={MIN:100,LOW:500,MEDIUM:1e3,HIGH:1500,MAX:5e3};let lt=class extends Ki.A{constructor(e,t,n,i,s,a){super(e,t,n,i,s),this.eventBus=e,this.canvas=t,this.interactionEvents=n,this.bendpointMove=i,this.connectionSegmentMove=s,this.rules=a,e.on("element.marker.update",A.HIGH,this.onElementMarkerUpdate.bind(this))}onElementMarkerUpdate(e){this.rules.allowed("canElementMarkerUpdate")||(e.element={})}getConnectionBendpointsFilter(e,t,n){return t===0||t===n.length-1}};lt=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("eventBus")),(0,r.__param)(1,(0,_.y_)("canvas")),(0,r.__param)(2,(0,_.y_)("interactionEvents")),(0,r.__param)(3,(0,_.y_)("bendpointMove")),(0,r.__param)(4,(0,_.y_)("connectionSegmentMove")),(0,r.__param)(5,(0,_.y_)("rules")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],lt);const d=_.y_;var Rt=u(69034),f=u(87004);let zt=class extends Rt.A{constructor(e,t,n,i){super(e,t,n,i),this._canvas=e,this._eventBus=t,this._graphicsFactory=n,this._elementRegistry=i,t.on(["canvas.init"],s=>this.onInit(s))}onInit(e){const t=(0,f.vt)("defs");(0,f.BC)(e.svg,t)}zoom(e,t){const n=super.zoom(e,t);return this._eventBus.fire("zoom.changed",n),n}bringToFrontElement(e){const n=this._elementRegistry.getGraphics(e).parentNode,i=n.parentNode;i.removeChild(n),i.appendChild(n)}};zt=(0,r.__decorate)([(0,r.__param)(0,d("config.canvas")),(0,r.__param)(1,d("eventBus")),(0,r.__param)(2,d("graphicsFactory")),(0,r.__param)(3,d("elementRegistry")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object])],zt);var Xi=u(17389);let At=class extends Xi.A{constructor(e,t){super(e,t),this.eventBus=e}undo(){this.eventBus.fire("undo")}redo(){this.eventBus.fire("redo")}};At=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("injector")),(0,r.__metadata)("design:paramtypes",[Object,Object])],At);let ct=class{constructor(e,t,n,i,s){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.config=i,this.diagramUtils=s,this.highlightClassName="animated",this.subscribeEvents()}get supportHighlight(){return this.config.isReadOnly}onSelectionChanged(e){const{newSelection:t,oldSelection:n}=e;n.forEach(i=>this.changeConnectionSelection(i,!1)),t.forEach(i=>this.changeConnectionSelection(i,!0))}changeConnectionSelection(e,t){const n=this.elementRegistry.filter(i=>i.source===e||i.target===e);n.forEach(i=>{t?this.canvas.addMarker(i,this.highlightClassName):this.canvas.removeMarker(i,this.highlightClassName)}),this.bringToFront(n,e)}bringToFrontElement(e){this.canvas.bringToFrontElement(e)}subscribeEvents(){this.supportHighlight&&this.eventBus.on(["selection.changed"],A.LOW,e=>this.onSelectionChanged(e))}bringToFront(e,t){e.forEach(i=>this.bringToFrontElement(i)),this.elementRegistry.filter(i=>!this.diagramUtils.isConnection(i)).forEach(i=>this.bringToFrontElement(i)),this.bringToFrontElement(t)}};ct=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("canvas")),(0,r.__param)(2,d("elementRegistry")),(0,r.__param)(3,d("config")),(0,r.__param)(4,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,D])],ct);var qi=u(28012);let Nt=class extends qi.A{constructor(e,t,n,i){super(e,t,n,i),this._injector=e,this._canvas=t,this._graphicsFactory=n,this._elementFactory=i}createNoopConnection(e,t){const n=(0,f.vt)("polyline");return(0,f.CF)(n,{stroke:"#8095b3",strokeWidth:2}),(0,f.CF)(n,{points:[e.x,e.y,t.x,t.y]}),n}};Nt=(0,r.__decorate)([(0,r.__param)(0,d("injector")),(0,r.__param)(1,d("canvas")),(0,r.__param)(2,d("graphicsFactory")),(0,r.__param)(3,d("elementFactory")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object])],Nt);var eo=u(45041);const N={element:{deleteElementsExecuted:"commandStack.elements.delete.executed",paste:"elements.paste",updateLabel:"element.updateLabel",updateLabelExecuted:"commandStack.element.updateLabel.executed",mouseDown:"element.mousedown",doubleClick:"element.dblclick",update:"element.update",updated:"element.updated",typeUpdated:"element.typeUpdated",click:"element.click",updateExecuted:"commandStack.element.update.executed",validation:"element.validation",canUpdateType:"element.canUpdateType"},elements:{create:"elements.create",move:"elements.move",delete:"elements.delete",removing:"elements.removing",updatingTypeValidate:"elements.updatingTypeValidate",canCopy:"elements.canCopy",changed:"elements.changed"},directEditing:{activate:"directEditing.activate",complete:"directEditing.complete",cancel:"directEditing.cancel",resize:"directEditing.resize"},label:{createExecuted:"commandStack.label.create.executed",create:"label.create"},lane:{create:"lane.create",resize:"lane.resize",split:"lane.split"},diagram:{create:"diagram.create",changed:"diagram.changed",initialized:"diagram.initialized"},selection:{changed:"selection.changed"},shape:{createExecuted:"commandStack.shape.create.executed",moveExecuted:"commandStack.shape.move.executed",resizeExecuted:"commandStack.shape.resize.executed",deleteExecuted:"commandStack.shape.delete.executed",move:"shape.move.move",end:"shape.move.end",shapeMove:"shape.move",shapeCreate:"shape.create",shapeResize:"shape.resize",shapeDelete:"shape.delete"},import:{elementAdd:"import.element.add"},connection:{createExecuted:"commandStack.connection.create.executed",update:"connection.update",updateExecuted:"commandStack.connection.update.executed",moveExecuted:"commandStack.connection.move.executed",layoutExecuted:"commandStack.connection.layout.executed",reconnectEndExecuted:"commandStack.connection.reconnectEnd.executed",updateWaypointsExecuted:"commandStack.connection.updateWaypoints.executed",reconnectExecuted:"commandStack.connection.reconnect.executed",deleteExecuted:"commandStack.connection.delete.executed",changeDirection:"connection.changeDirection",changeDirectionExecuted:"commandStack.connection.changeDirection.executed",reconnect:"connection.reconnect",moveConnectionLabel:"connection.move.label",highlight:"commandStack.connection.highlight.executed"},connect:{move:"connect.move",hover:"connect.hover",end:"connect.end"},create:{move:"create.move",end:"create.end"}};var to=u(84919),no=u(52874),E=u(98218),y=u(52687),io=u(44156);let se=class extends io.A{constructor(e,t,n){super({style:v.cloneDeep(Y.label.editStyle)}),this.config=e,this.elements=t,this.diagramUtils=n,this.style=v.cloneDeep(Y.label.editStyle)}getElementLabelPosition(e,t){return t.delta?{x:Math.round(e.x+t.delta.x+t.width/2),y:Math.round(e.y+t.delta.y+t.height/2)}:{x:Math.round(e.x+e.width/2),y:Math.round(e.y+e.height+Y.label.height/2)}}layoutToFirstLine(e,t){const i=e[0].textContent,s=super.layoutText(i,t);return s.element.children[0].textContent=i.substring(0,i.length-3)+"...",s}layoutRtlText(e,t){const n=e.element.children||[];n.length>1&&(e=this.layoutToFirstLine(n,t)),e.element.style.direction="rtl";const i=e.element.children||[];for(const s of i)s.style.direction="ltr";return e}getLabelPaddingTop(e,t){return 7}isIEOrEdge(){return/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)}applySvgHelperContent(e,t){const n=this.isEmptyText(t)?"dummy":t;e.textContent=n}createForeignText(e,t,n){const i=document.createElement("div"),s=`color: ${v.get(n,"style.fill","initial")}`;return i.setAttribute("class","foreign-text"),i.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),i.setAttribute("style",`width: ${t}px; ${s}`),i.textContent=e,i}createForeignTextContainer(e,t,n){const i=document.createElement("div");i.setAttribute("class","foreign-text-container"),i.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const s=this.createForeignText(e,t,n);return i.append(s),i}createForeignObject(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),i=e.height,s=e.width;n.setAttribute("height",i.toString()),n.setAttribute("width",s.toString());const a=this.createForeignTextContainer(e.text,e.width,t);return n.append(a),n}getTextLayout(e,t){const n=(0,E.assign)({},{},t.box);let i={height:n.height,width:n.width,text:e};if(t.needRecalcDimensions){const s=i.height===void 0?i.width:null,a=this.getHelperSvg(s);i={...this.getTextBBox(e,a),text:e},(0,y.remove)(a)}return i}getLabelOptions(e){return{box:{x:Math.round(e.width/2+e.x),y:Math.round(e.height/2+e.y),width:e.width||Y.label.width,height:e.height},style:{direction:"ltr",...this.style}}}getHelperSvg(e){let t=document.getElementById("helper-svg");return t||(t=document.createElement("div"),t.setAttribute("id","helper-svg"),t.setAttribute("class","foreign-text foreign-text-helper"),e&&t.setAttribute("style",`max-width: ${e}px`),document.body.appendChild(t)),t}getTextBBox(e,t){this.applySvgHelperContent(t,e);const n=t.getBoundingClientRect();return{width:this.isEmptyText(e)?0:n.width,height:n.height}}getDimensions(e,t){return t.needRecalcDimensions=!0,this.layoutText(e,t).dimensions}createText(e,t){return super.createText(e,t)}layoutText(e,t){if(this.isIEOrEdge()){const s=super.layoutText(e,t);return this.config.isRtl?this.layoutRtlText(s,t):s}const n=this.getTextLayout(e,t),i=this.createForeignObject(n,t);return{dimensions:{width:n.width,height:n.height},element:i}}getConnectionLabelPosition(e,t){const n=Math.floor(e.length/2-1),i=e[n],s=e[n+1],a={x:Math.round((s.x-i.x)/2),y:Math.round((s.y-i.y)/2)},l=i.x+a.x;let p=i.y+a.y;return i.y===s.y&&(p+=Math.round(t.height/2)+5),{x:l,y:p}}getLabelBounds(e,t){const n=this.getLabelOptions(e),i=this.getDimensions(t,n);return{height:i.height,width:i.width,x:Math.round(e.x+e.width/2-i.width/2),y:Math.round(e.y)}}isEmptyText(e){return!e||!e.trim()}resetLabelPosition(e){const{width:i,height:s}=this.getLabelBounds(e,e.labelTarget.caption);e.width=i,e.height=s;const a=e.parent;e.x=Math.round(a.x+a.width/2-e.width/2),e.y=Math.round(a.y+a.height+Y.label.height/2)-1*2-1}addLabel(e,t,n,i=t.caption){if(!this.isEmptyText(i)){const s=this.getLabelPosition(t,n);s.y+=this.getLabelPaddingTop(t,n.delta);const a={id:no.Guid.create().toString(),getDimensions:!0,...v.pick(n,["type","width","height"])};e.createLabel(t,s,a)}}getLabelPosition(e,t=Y.label){return this.diagramUtils.isConnection(e)?this.getConnectionLabelPosition(e.waypoints,t):this.getElementLabelPosition(e,t)}};se=(0,r.__decorate)([(0,r.__param)(0,d("config")),(0,r.__param)(1,d("elements")),(0,r.__param)(2,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,R,D])],se);let Bt=class{constructor(e,t){this.modeling=e,this.diagramText=t}setText(e,t){const n=e.label||e,i=e.labelTarget||e;return i.caption=t,[n,i]}preExecute(e){const t=e.element;t&&!t.label&&!D.isLabel(t)&&this.diagramText.addLabel(this.modeling,t,Y.label,e.text)}execute(e){e.oldText=e.element.caption||"";const t=(e.text||"").trim();return this.setText(e.element,t)}revert(e){return this.setText(e.element,e.oldText)}resizeShape(e,t){this.modeling.resizeShape(e,t,{height:0,width:0})}postExecute(e){const t=e.element.label;if(!t)return;const n=this.diagramText;if(n.isEmptyText(e.text))this.modeling.removeShape(t,{unsetLabel:!1});else{const i=t.labelTarget.caption;if(i){const s=e.newBounds||n.getLabelBounds(t,i);this.resizeShape(t,s)}}}};Bt=(0,r.__decorate)([(0,r.__param)(0,d("modeling")),(0,r.__param)(1,d("diagramText")),(0,r.__metadata)("design:paramtypes",[Object,se])],Bt);var oo=u(2050);class dt{constructor(e){this.utils=e}_setAbsolutePosition(e,t,n){if(n.includes(e.id)||v.isUndefined(e.rx)||v.isUndefined(e.ry))return;const i=e.parent;let s=t.elements[i]||t.connections[i];s?(this.utils.isConnection(s)&&(s=t.elements[s.source]),this._setAbsolutePosition(s,t,n),e.x=s.x+e.rx,e.y=s.y+e.ry):(e.x=e.rx,e.y=e.ry),n.push(e.id)}setRelativePosition(e,t=null){let n=t||e.labelTarget||e.parent;n.id===Se.root.id?(e.rx=e.x,e.ry=e.y):(this.utils.isConnection(n)&&(n=n.source),e.rx=e.x-n.x,e.ry=e.y-n.y)}setShapeAbsolutePosition(e,t=null){let n=t||e.labelTarget||e.parent;n.id===Se.root.id?(v.isUndefined(e.rx)||(e.x=e.rx),v.isUndefined(e.ry)||(e.y=e.ry)):(this.utils.isConnection(n)&&(n=n.source),v.isUndefined(e.rx)||(e.x=n.x+e.rx),v.isUndefined(e.ry)||(e.y=n.y+e.ry))}setAbsolutePosition(e){if(!e)return;const t=[];v.forEach(e.elements,n=>{this._setAbsolutePosition(n,e,t)}),v.forEach(e.labels,n=>{this._setAbsolutePosition(n,e,t)})}}let Gt=class extends oo.A{constructor(e,t){super(e),this.canvas=e,this.diagramUtils=t,this.convertUtils=new dt(t)}execute(e){const t=super.execute(e);return this.convertUtils.setRelativePosition(t),t}};Gt=(0,r.__decorate)([(0,r.__param)(0,d("canvas")),(0,r.__param)(1,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object])],Gt);var so=u(34635);let Ft=class extends so.A{constructor(e,t){super(e),this.canvas=e,this.diagramUtils=t,this.convertUtils=new dt(t)}execute(e){const t=super.execute(e);return this.convertUtils.setRelativePosition(t,e.labelTarget),t}};Ft=(0,r.__decorate)([(0,r.__param)(0,d("canvas")),(0,r.__param)(1,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object])],Ft);var ao=u(97970),me=u(65911);let pt=class extends ao.A{constructor(e){super(e)}execute(e){super.execute(e)}postExecute(e){const{connection:t,hints:n}=e;n&&n.docking&&(e.dockingOrPoints=n.docking==="source"?(0,me.pp)(t.source):(0,me.pp)(t.target)),super.postExecute(e)}};pt=(0,r.__decorate)([(0,r.__param)(0,d("modeling")),(0,r.__metadata)("design:paramtypes",[Object])],pt);var ro=u(90006);let Vt=class extends ro.A{constructor(e,t){super(e),this.modeling=e,this.canvas=t}getParent(e,t){const n=this.canvas.getRootElement();let i=super.getParent(e,t);return D.isLabel(i)&&(i=n),i}preExecute(e){super.preExecute(e)}};Vt=(0,r.__decorate)([(0,r.__param)(0,d("modeling")),(0,r.__param)(1,d("canvas")),(0,r.__metadata)("design:paramtypes",[Object,Object])],Vt);var lo=u(12301);let Ht=class extends lo.A{constructor(e,t,n,i){super(e),this.modeling=e,this.elementRegistry=t,this.canvas=n,this.diagramUtils=i}setParent(e){const t=e.newParent;t&&(this.diagramUtils.isFlow(t)&&(e.targetConnection=t,e.newParent=this.getRealParent(e)),D.isLabel(t)&&(e.newParent=this.getRealParent(e)))}getRealParent(e){const t=this.diagramUtils.getAllContainers(this.elementRegistry.getAllElements()),n=this.canvas.getRootElement(),i=e.shapes[0];return this.diagramUtils.findRealElementParent({x:i.x,y:i.y},t,n)}postExecute(e){this.setParent(e),super.postExecute(e)}};Ht=(0,r.__decorate)([(0,r.__param)(0,d("modeling")),(0,r.__param)(1,d("elementRegistry")),(0,r.__param)(2,d("canvas")),(0,r.__param)(3,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,D])],Ht);var co=u(57261),po=u(45240);let Ut=class extends co.A{constructor(e){super(e),this.modeling=e,this.postExecute=function(t){const n=t.movingShapes,i=t.delta;this.modeling.moveElements(n,i,void 0,{autoResize:!1,attach:!1})},this.preExecute=function(t){const n=t.resizingShapes,i=t.delta,s=t.direction;n.forEach(a=>{const l=(0,po.Ih)(a,s,i);this.modeling.resizeShape(a,l)})}}};Ut=(0,r.__decorate)([(0,r.__param)(0,d("modeling")),(0,r.__metadata)("design:paramtypes",[Object])],Ut);const go={CENTER:"center",RIGHT:"right",LEFT:"left"},ho={TOP:"top",CENTER:"center",BOTTOM:"bottom"};let Q=class extends to.A{constructor(e,t,n,i,s,a,l,p,g){super(e,t,n,i),this.eventBus=e,this.elementFactory=t,this.commandStack=n,this.canvas=i,this.registry=s,this.diagramText=a,this.elements=l,this.rules=p,this.diagramUtils=g,this.convertUtils=new dt(g)}addShapeHandlers(e){e[N.shape.shapeCreate]=Gt}addLabelHandlers(e){e[N.label.create]=Ft}getLabelPositionByX(e,t){return e.horizontalAlignment===go.CENTER?e.x:e.x+t.width/2}getLabelPositionByY(e,t){return e.verticalAlignment===ho.CENTER?e.y:e.y+t.height/2}getLabelPosition(e,t,n){let i,s;if(this.needResetLabelPosition(e,t)){const a=this.diagramText.getLabelPosition(t,n),l=this.getFixedLabelPosition(a,n,t);i=!v.isUndefined(e.x)&&v.isUndefined(e.y)?this.getLabelPositionByX(e,n):l.x,s=!v.isUndefined(e.y)&&v.isUndefined(e.x)?this.getLabelPositionByY(e,n):l.y}else i=this.getLabelPositionByX(e,n),s=this.getLabelPositionByY(e,n);return{x:Math.round(i),y:Math.round(s)}}getLabelSize(e,t){let n;if(e.width&&e.height)n={width:e.width,height:e.height};else{const i=e.caption||t.caption,s=this.diagramText.getLabelBounds(e,i);n={width:s.width,height:s.height}}return n}addElementHandlers(e){e[N.element.updateLabel]=Bt}addConnectionHandlers(e){e[N.connection.update]=pt,e[N.connection.reconnect]=pt}getFixedLabelPosition(e,t,n){const a=e.x,l=this.diagramUtils.isConnection(n)?e.y:e.y+t.height/2-1*2-1;return{x:Math.round(a),y:Math.round(l)}}needResetLabelPosition(e,t){return v.isUndefined(e.x)||v.isUndefined(e.y)}getElement(e){return typeof e=="string"?this.registry.get(e):e}addElementsHandlers(e){e[N.elements.create]=Vt,e[N.elements.move]=Ht}getLabelAttributes(e,t,n,i){return{id:t.id,type:e.type,width:n.width,height:n.height,caption:e.caption,backgroundStyle:e.backgroundStyle,style:e.style,hidden:i?.hidden,tooltip:e.tooltip,tooltipConfig:e.tooltipConfig}}getElementAttributes(e,t,n){const{caption:i,type:s}=t,a=t.width||n.width,l=t.height||n.height,p=t.largeImage||n.largeImage,g=t.name;return{id:e,type:s,width:a,height:l,largeImage:p,name:g,caption:i&&i.toString(),tooltip:t.tooltip,tooltipConfig:t.tooltipConfig}}centerViewbox(e){D.centerViewboxOnElement(e,this.canvas)}getElementPosition(e,t){const{x:n=0,y:i=0}=e,s=e.width||t.width,a=e.height||t.height;return{x:Math.round(n+s/2),y:Math.round(i+a/2)}}createDiagramLabel(e){const t=v.cloneDeep(e.value),n=this.registry.get(t.parent);if(n){this.convertUtils.setShapeAbsolutePosition(t,n);const i=this.getLabelSize(t,n);t.height=t.height||i.height;const s=this.getLabelPosition(t,n,i),a=this.getLabelAttributes(t,e,i,n);return this.createLabel(n,s,a,n)}}createDiagramElement(e,t){if(this.registry.get(e))return;const n=this.elements.items.root.id,i=v.cloneDeep(t[e]),s=i.parent||n;let a=this.registry.get(s);a||(this.createDiagramElement(s,t),a=this.registry.get(s)),this.convertUtils.setShapeAbsolutePosition(i,a);const l=this.elements.getConfig(i),p=this.getElementAttributes(e,i,l),g=this.getElementPosition(i,l);this.createShape(p,g,a,0,{generateUniqueCaption:!1})}getHandlers(){const e=super.getHandlers(this);return e.spaceTool=Ut,this.addLabelHandlers(e),this.addShapeHandlers(e),this.addElementHandlers(e),this.addElementsHandlers(e),this.addConnectionHandlers(e),e}moveConnection(e,t,n,i){super.moveConnection(e,t,e.parent,n,i)}createShape(e,t,n,i,s){return super.createShape(e,t,n,i,s)}pasteElements(e,t,n){super.pasteElements(e,t,n)}moveShape(e,t,n=null,i=null,s=null){super.moveShape(e,t,n,i,s)}updateWaypoints(e,t,n={}){const i=this.getElement(e);i&&(v.defaults(n,{doUpdateLabelPosition:!0}),super.updateWaypoints(i,t,n))}reconnect(e,t,n,i,s){s&&s.docking==="target"&&v.defaults(s,{isUpdateConnectionType:!0});const a=this.getElement(e),l=this.getElement(t),p=this.getElement(n);a&&(l||p)&&super.reconnect(a,l,p,i,s)}reconnectStart(e,t,n,i={}){if(!n){const s=this.getElement(e),a=s.waypoints[0];n=a.original||D.getOriginalWaypoint(a,s.source)}super.reconnectStart(e,t,n,i)}reconnectEnd(e,t,n,i={}){if(!n){const s=this.getElement(e),a=s.waypoints,l=a[a.length-1];n=l.original||D.getOriginalWaypoint(l,s.target)}super.reconnectEnd(e,t,n,i)}createLabel(e,t,n,i){if(this.registry.get(n.id))return;const s=super.createLabel(e,t,n,i);return s.parent=e,s}removeConnection(e){const t=this.getElement(e);t&&super.removeConnection(t)}connect(e,t,n,i){const s=this.canvas.getRootElement();return n=n||{},this.createConnection(e,t,n,s,i)}createConnection(e,t,n,i,s,a){if(typeof n=="object"&&(a=s,s=i,i=n,n=void 0),!this.registry.get(i.id))return s=s||this.canvas.getRootElement(),super.createConnection(e,t,n,i,s,a)}updateLabel(e,t,n=null){const i=this.getElement(e);i&&this.commandStack.execute(N.element.updateLabel,{element:i,text:t,newBounds:n})}moveConnectionLabel(e,t){const n={connection:e,hints:t};this.eventBus.fire(N.connection.moveConnectionLabel,{context:n})}removeElementChildren(e){const t=e.children;for(t.length&&this.eventBus.fire(N.elements.removing,{elements:t});t.length>0;){const n=t[0];this.removeShape(n,{force:!0})}}resizeShape(e,t,n,i){super.resizeShape(e,t,n,i)}removeShape(e,t){super.removeShape(e,t)}removeElements(e,t=!1){(t||this.rules.allowed(N.elements.delete,{elements:e}))&&super.removeElements(e)}clearDiagram(){const e=this.registry.getAllElements();super.removeElements(e)}layoutConnection(e,t){super.layoutConnection(e,t)}};Q=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("elementFactory")),(0,r.__param)(2,d("commandStack")),(0,r.__param)(3,d("canvas")),(0,r.__param)(4,d("elementRegistry")),(0,r.__param)(5,d("diagramText")),(0,r.__param)(6,d("elements")),(0,r.__param)(7,d("rules")),(0,r.__param)(8,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,R,Object,D])],Q);let gt=class extends eo.A{constructor(e,t,n,i,s,a,l){super(e,t,n,i,l,a),this.rules=s;const p=this.start;this.start=(g,h,C)=>{this.rules.allowed("canConnectionSegmentMove")&&p.call(this,g,h,C)}}};gt=(0,r.__decorate)([(0,r.__param)(0,d("injector")),(0,r.__param)(1,d("eventBus")),(0,r.__param)(2,d("canvas")),(0,r.__param)(3,d("dragging")),(0,r.__param)(4,d("rules")),(0,r.__param)(5,d("modeling")),(0,r.__param)(6,d("graphicsFactory")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Q,Object])],gt);const Hn=".entry";let ht=class{constructor(e,t,n,i){this.eventBus=e,this.overlays=t,this.rules=n,this.canvas=i,this._providers=[],this.current=null,this.init()}init(){this.eventBus.on("selection.changed",e=>{const t=e.newSelection;t.length===1?this.open(t[0]):this.close()}),this.eventBus.on("elements.delete",e=>{const t=e.elements;(0,E.forEach)(t,n=>{this.isOpen(n)&&this.close()})}),this.eventBus.on("element.changed",e=>{const t=e.element,n=this.current;n&&n.element===t&&this.open(t,!0)}),this.eventBus.on("canvas.viewbox.changing",()=>{this.isOpen()&&(0,E.assign)(this.current.pad.html.style,{visibility:"hidden"})}),this.eventBus.on("canvas.viewbox.changed",()=>{const e=this.current&&this.current.element;e&&this.open(e,!0)}),this.eventBus.on("diagram.clear",()=>{this.close()})}canOpen(e){return this.rules.allowed("canOpenContextPad",{})}getSeparatorConfig(){return{className:"entry-separator"}}getNoopConfig(){return{noop:{className:"noop-entry"}}}sliceObj(e,t,n){return Object.keys(e).slice(t,n).reduce((i,s)=>(i[s]=e[s],i),{})}addNoopEntry(e){const t=Object.keys(e);return t.length<=2||t[1]==="setup"?e:{...this.sliceObj(e,0,1),...this.getNoopConfig(),...this.sliceObj(e,1,t.length)}}addSeparators(e){const t=Object.keys(e);return t.length<=1?e:t.length===2?t[1]==="setup"?e:(this.oneColumnMode=!0,{...this.sliceObj(e,0,1),separator1:this.getSeparatorConfig(),...this.sliceObj(e,1,t.length)}):{...this.sliceObj(e,0,2),separator1:this.getSeparatorConfig(),separator2:this.getSeparatorConfig(),...this.sliceObj(e,2,t.length)}}fixConnectToolPosition(e){const t=Object.keys(e);if(t.length<=2)return e;const n=t.indexOf("connect");if(n<0||n%2===0)return e;const i=t[n-1];return{...this.sliceObj(e,0,n-1),connect:e.connect,[i]:e[i],...this.sliceObj(e,n+1,t.length)}}fixEntries(e){return this.oneColumnMode=!1,e=this.addNoopEntry(e),e=this.addSeparators(e),e=this.fixConnectToolPosition(e),e}trigger(e,t,n=!1){const{entries:i,element:s}=this.current,a=t.delegateTarget||t.target;if(!a)return t.preventDefault();const l=(0,y.attr)(a,"data-action"),g=i[l].action,h=t.originalEvent||t;if((0,E.isFunction)(g)){if(e==="click")return g(h,s,n)}else if(g[e])return g[e](h,s,n);t.preventDefault()}getConnectionBBox(e){const t=(0,Fe.U7)(e);return{x:t.x,y:t.y,width:t.width,height:t.height}}getElementBBox(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}getPadPosition(e){const t={left:9,top:-6},n=this.canvas.viewbox(),i=e.waypoints?this.getConnectionBBox(e):this.getElementBBox(e),s=i.x+i.width+t.left-n.x,a=i.y+t.top-n.y,l=n.scale;return{x:Math.round(s*l),y:Math.round(a*l)}}getEntryControl(e,t){const{className:n,title:i,imageUrl:s}=t,a=(0,y.domify)(`<div class="entry" draggable="true" data-action="${e}"></div>`);if(n){const l=(0,y.classes)(a);((0,E.isArray)(n)?n:n.split(/\s+/g)).forEach(g=>{l.add(g)})}return i&&(0,y.attr)(a,"title",i),s&&a.appendChild((0,y.domify)('<img src="'+s+'">')),a}addEntriesContainer(e){const t=(0,y.domify)('<div class="group"></div>');return(0,E.forEach)(e,(n,i)=>{const s=this.getEntryControl(i,n);t.appendChild(s)}),t}getPad(e){if(this.isOpen())return this.current.pad;const t=(0,y.domify)('<div class="djs-context-pad"></div>');y.delegate.bind(t,Hn,"click",s=>{this.trigger("click",s)}),y.delegate.bind(t,Hn,"dragstart",s=>{this.trigger("dragstart",s)}),y.event.bind(t,"mousedown",s=>{s.stopPropagation()});const n=this.getPadPosition(e);(0,E.assign)(t.style,{position:"absolute",left:n.x+"px",top:n.y+"px",visibility:"visible"});const i={html:t};return this.eventBus.fire("contextPad.create",{element:e,pad:i}),i}getEntries(e){const t={};return(0,E.forEach)(this._providers,n=>{const i=n.getContextPadEntries(e);(0,E.forEach)(i,(s,a)=>{t[a]=s})}),this.fixEntries(t)}registerProvider(e){this._providers.push(e)}open(e,t=!1){if(!t&&this.isOpen(e)||(this.close(),!this.canOpen(e)))return;const n=this.getEntries(e);if(v.isEmpty(n))return;const i=this.addEntriesContainer(n),s=this.getPad(e),a=s.html;a.appendChild(i),(0,y.classes)(a).add("open"),(0,y.classes)(a).toggle("one-column-grid",this.oneColumnMode),this.canvas.getContainer().appendChild(a),this.current={element:e,pad:s,entries:n},this.eventBus.fire("contextPad.open",{current:this.current})}isOpen(e){return this.current&&(!e||this.current.element===e)}close(){this.isOpen()&&((0,y.remove)(this.current.pad.html),this.eventBus.fire("contextPad.close",{current:this.current}),this.current.pad.html=null,this.current=null)}};ht=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("overlays")),(0,r.__param)(2,d("rules")),(0,r.__param)(3,d("canvas")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object])],ht);var uo=u(7034);let Wt=class extends uo.A{constructor(e,t,n,i,s,a,l,p,g,h){super(e,t,n,i,s,a,l,p),this.canvas=e,this.create=t,this.clipboard=n,this.elementFactory=i,this.eventBus=s,this.modeling=a,this.mouse=l,this.rules=p,this.diagramText=g,this.config=h,this.init()}_onPasteElement(e){Object.assign(e.hints,{generateUniqueCaption:!1,isElementCopyPaste:!0})}onCopyElement({element:e,descriptor:t}){this.copyProperties.forEach(n=>t[n]=(0,v.clone)(e[n]))}init(){this.copyProperties=["type","caption"],this.eventBus.on("copyPaste.pasteElements",e=>this._onPasteElement(e)),this.eventBus.on("copyPaste.copyElement",e=>this.onCopyElement(e))}resetLabelsPosition(e){const t=e.filter(n=>D.isLabel(n));t.length===1&&e.length===2&&this.diagramText.resetLabelPosition(t[0])}_createElements(e){const t=super._createElements(e);return this.resetLabelsPosition(t),t}createShape(e){const t=e.id,n=super.createShape(e);return n.sourceId=t,n}};Wt=(0,r.__decorate)([(0,r.__param)(0,d("canvas")),(0,r.__param)(1,d("create")),(0,r.__param)(2,d("clipboard")),(0,r.__param)(3,d("elementFactory")),(0,r.__param)(4,d("eventBus")),(0,r.__param)(5,d("modeling")),(0,r.__param)(6,d("mouse")),(0,r.__param)(7,d("rules")),(0,r.__param)(8,d("diagramText")),(0,r.__param)(9,d("config")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object,Object,Object])],Wt);let Ve=class{constructor(e,t){this.eventBus=e,this.canvas=t}getEntry(e,t){const n=(0,E.matchPattern)({id:t}),i=(0,E.find)(e,n);if(!i)throw new Error("entry not found");return i}createContainer(){const t=this.canvas.getContainer().getBoundingClientRect(),i=(0,y.query)(`[data-action="${this.paletteEntryId}"]`).getBoundingClientRect(),s={x:12,y:-5},a={x:i.left+i.width+s.x-t.left,y:i.top+s.y-t.top},l=(0,y.domify)('<div class="djs-popup diagram-create-popup-menu">');return(0,E.assign)(l.style,{position:"absolute",left:a.x+"px",top:a.y+"px",visibility:"hidden"}),l}alignPosition(e){const n=this.canvas.getContainer().getBoundingClientRect(),i=e.getBoundingClientRect(),s=10,a=i.top+i.height-(n.top+n.height)+s;if(a>0){let l=i.top-n.top-a;l=l>s?l:s,(0,E.assign)(e.style,{top:l+"px"})}}entryAction(e,t,n){n.preventDefault();const i=n.delegateTarget||n.target,s=(0,y.attr)(i,"data-id"),a=this.getEntry(e,s),l=a.action[t];l&&l.call(null,n,a)}attachContainer(e,t){const n=this.canvas.getContainer();y.delegate.bind(t,".entry","dragstart",this.entryAction.bind(this,e,"dragstart")),y.delegate.bind(t,".entry","click",this.entryAction.bind(this,e,"click")),n.appendChild(t),this.alignPosition(t),(0,E.assign)(t.style,{visibility:"visible","z-index":1e3,opacity:1}),this.subscribeEvents(),t.onwheel=i=>this.onWheel(i)}createEntriesContainer(e){const t=(0,y.domify)('<div class="djs-popup-body">');return(0,E.forEach)(e,n=>{const i=this.createEntry(n);t.appendChild(i)}),t}createEntry(e){if(!e.id)throw new Error("every entry must have the id property set");const t=(0,y.domify)('<div class="entry" draggable="true"></div>');(0,y.classes)(t).add("entry"),(0,y.attr)(t,"data-id",e.id);const i=(0,y.domify)("<span>");return i.textContent=e.label,t.appendChild(i),t.appendChild((0,y.domify)('<img src="'+e.imageUrl+'" />')),t}subscribeEvents(){const e=this.eventBus;e.once("contextPad.close",this.close.bind(this)),e.once("popupMenu.open",this.close.bind(this)),e.once("canvas.viewbox.changing",this.close.bind(this)),e.once("commandStack.changed",this.close.bind(this)),e.once("element.mousedown",A.HIGH,this.close.bind(this)),e.once("keyboard.keydown",A.HIGH,this.close.bind(this))}unsubscribeEvents(){const e=this.eventBus;e.off("contextPad.close",this.close.bind(this)),e.off("popupMenu.open",this.close.bind(this)),e.off("canvas.viewbox.changed",this.close.bind(this)),e.off("commandStack.changed",this.close.bind(this)),e.off("element.mousedown",this.close.bind(this)),e.off("keyboard.keydown",this.close.bind(this))}open(e,t,n){if(this.isOpen()&&(this.close(),e.type===this.currentElement.type))return;this.currentElement=e,this.paletteEntryId=t,this.eventBus.fire("createPopupMenu.open",{paletteEntryId:t});const i=this.createContainer(),s=this.createEntriesContainer(n);i.appendChild(s),this.attachContainer(n,i),this.container=i}close(){if(!this.isOpen())return;const e=this.paletteEntryId;this.eventBus.fire("createPopupMenu.close",{paletteEntryId:e}),this.unsubscribeEvents(),(0,y.remove)(this.container),this.container=null}isOpen(){return!!this.container}onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this.container.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}};Ve=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("canvas")),(0,r.__metadata)("design:paramtypes",[Object,Object])],Ve);var mo=u(20990);let Zt=class extends mo.A{constructor(e,t){super(t,e),this.injector=e}_registerDefaultActions(){super._registerDefaultActions.call(this,this.injector);const e=this.injector.get("elementRegistry",!1),t=this.injector.get("selection",!1);e&&t&&super._registerAction("selectAll",()=>{const n=e.getAllElements();return t.select(n),n})}};Zt=(0,r.__decorate)([(0,r.__param)(0,d("injector")),(0,r.__param)(1,d("eventBus")),(0,r.__metadata)("design:paramtypes",[Object,Object])],Zt);var fo=u(15176),yo=u(23710),Yt=u.n(yo);class Un extends fo.A{constructor(){super(),Yt().config({disableDefaultAlphabetLength:!0}),Yt().characters("0123456789abcdefghijklmnopqrstuvwxyz")}generateId(e){return e+"_"+Yt().generate()}create(e,t){return t=Object.assign({},t),t.type||(t.type=e),t.id||(t.id=this.generateId(t.type)),super.create(e,t)}}var Co=u(54343);let He=class extends Co.A{constructor(e){super(),this.injector=e}getAllElements(){const t=this.injector.get("canvas",!1).getRootElement();return super.filter(n=>n!==t)}getAll(){return this.getAllElements()}getGraphics(e,t){return super.getGraphics(e,t)}get(e){return super.get(e)}};He=(0,r.__decorate)([(0,r.__param)(0,d("injector")),(0,r.__metadata)("design:paramtypes",[Object])],He),(0,_.hi)("diagram.elementTools.connect.connect"),(0,_.hi)("diagram.elementTools.remove"),(0,_.hi)("diagram.elementTools.changeType");const vo="assets/images/icon_tools_del.svg",xo="assets/images/icon_tools_setup.svg",bo="assets/images/icon_tools_arrow.svg";let ut=class{constructor(e,t){this.elements=e,this.config=t,this.addItems=this.getAddItems(),this.tools=this.getTools()}getAddItems(){return[]}getTools(){const e=this.config.localizableStrings;return{connect:{imageUrl:bo,title:e.get("elementTools.connect.connect")},setup:{imageUrl:xo,title:e.get("elementTools.changeType")},delete:{imageUrl:vo,title:e.get("elementTools.remove")}}}};ut=(0,r.__decorate)([(0,r.__param)(0,d("elements")),(0,r.__param)(1,d("config")),(0,r.__metadata)("design:paramtypes",[R,Object])],ut);var _o=u(77117),Wn=u(34495);const U={Backspace:{code:"Backspace",keyCode:8},Tab:{code:"Tab",keyCode:9},Enter:{code:"Enter",keyCode:13},NumpadEnter:{code:"NumpadEnter",keyCode:13},Escape:{code:"Escape",keyCode:27},Space:{code:"Space",keyCode:32},PageUp:{code:"PageUp",keyCode:33},PageDown:{code:"PageDown",keyCode:34},End:{code:"End",keyCode:35},Home:{code:"Home",keyCode:36},ArrowLeft:{code:"ArrowLeft",keyCode:37},ArrowUp:{code:"ArrowUp",keyCode:38},ArrowRight:{code:"ArrowRight",keyCode:39},ArrowDown:{code:"ArrowDown",keyCode:40},Insert:{code:"Insert",keyCode:45},Delete:{code:"Delete",keyCode:46},ShiftLeft:{code:"ShiftLeft",keyCode:16},ShiftRight:{code:"ShiftRight",keyCode:16},ControlLeft:{code:"ControlLeft",keyCode:17},ControlRight:{code:"ControlRight",keyCode:17},AltLeft:{code:"AltLeft",keyCode:18},AltRight:{code:"AltRight",keyCode:18},CapsLock:{code:"CapsLock",keyCode:20},OSLeft:{code:"OSLeft",keyCode:91},OSRight:{code:"OSRight",keyCode:92},Digit0:{code:"Digit0",keyCode:48},Digit1:{code:"Digit1",keyCode:49},Digit2:{code:"Digit2",keyCode:50},Digit3:{code:"Digit3",keyCode:51},Digit4:{code:"Digit4",keyCode:52},Digit5:{code:"Digit5",keyCode:53},Digit6:{code:"Digit6",keyCode:54},Digit7:{code:"Digit7",keyCode:55},Digit8:{code:"Digit8",keyCode:56},Digit9:{code:"Digit9",keyCode:57},KeyA:{code:"KeyA",keyCode:65},KeyB:{code:"KeyB",keyCode:66},KeyC:{code:"KeyC",keyCode:67},KeyD:{code:"KeyD",keyCode:68},KeyE:{code:"KeyE",keyCode:69},KeyF:{code:"KeyF",keyCode:70},KeyG:{code:"KeyG",keyCode:71},KeyH:{code:"KeyH",keyCode:72},KeyI:{code:"KeyI",keyCode:73},KeyJ:{code:"KeyJ",keyCode:74},KeyK:{code:"KeyK",keyCode:75},KeyL:{code:"KeyL",keyCode:76},KeyM:{code:"KeyM",keyCode:77},KeyN:{code:"KeyN",keyCode:78},KeyO:{code:"KeyO",keyCode:79},KeyP:{code:"KeyP",keyCode:80},KeyQ:{code:"KeyQ",keyCode:81},KeyR:{code:"KeyR",keyCode:82},KeyS:{code:"KeyS",keyCode:83},KeyT:{code:"KeyT",keyCode:84},KeyU:{code:"KeyU",keyCode:85},KeyV:{code:"KeyV",keyCode:86},KeyW:{code:"KeyW",keyCode:87},KeyX:{code:"KeyX",keyCode:88},KeyY:{code:"KeyY",keyCode:89},KeyZ:{code:"KeyZ",keyCode:90},NumpadMultiply:{code:"NumpadMultiply",keyCode:106},NumpadAdd:{code:"NumpadAdd",keyCode:107},NumpadDecimal:{code:"NumpadDecimal",keyCode:108},NumpadSubtract:{code:"NumpadSubtract",keyCode:109},NumpadDivide:{code:"NumpadDivide",keyCode:111},F1:{code:"F1",keyCode:112},F2:{code:"F2",keyCode:113},F3:{code:"F3",keyCode:114},F4:{code:"F4",keyCode:115},F5:{code:"F5",keyCode:116},F6:{code:"F6",keyCode:117},F7:{code:"F7",keyCode:118},F8:{code:"F8",keyCode:119},F9:{code:"F9",keyCode:120},F10:{code:"F10",keyCode:121},F11:{code:"F11",keyCode:122},F12:{code:"F12",keyCode:123},F13:{code:"F13",keyCode:124},F14:{code:"F14",keyCode:125},F15:{code:"F15",keyCode:126},F16:{code:"F16",keyCode:127},F17:{code:"F17",keyCode:128},F18:{code:"F18",keyCode:129},F19:{code:"F19",keyCode:130},F20:{code:"F20",keyCode:131},F21:{code:"F21",keyCode:132},F22:{code:"F22",keyCode:133},F23:{code:"F23",keyCode:134},F24:{code:"F24",keyCode:135},NumLock:{code:"NumLock",keyCode:144},Semicolon:{code:"Semicolon",keyCode:186},Equal:{code:"Equal",keyCode:187},Comma:{code:"Comma",keyCode:188},Minus:{code:"Minus",keyCode:189},Period:{code:"Period",keyCode:190},Slash:{code:"Slash",keyCode:191},Backquote:{code:"Backquote",keyCode:192},IntlRo:{code:"IntlRo",keyCode:193},BracketLeft:{code:"BracketLeft",keyCode:219},Backslash:{code:"Backslash",keyCode:220},BracketRight:{code:"BracketRight",keyCode:221},Quote:{code:"Quote",keyCode:222},IntlYen:{code:"IntlYen",keyCode:255}};function Ue(c){const e=U[c.code];return e?e.keyCode:c.keyCode}function wo(c){if(c.ctrlKey||c.metaKey||c.altKey)return!1;const e=c.which||c.keyCode;return e>47&&e<58||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function ee(c,e,t={}){return!v.isUndefined(t.ctrl)&&t.ctrl!==(0,Wn.nM)(c)||!v.isUndefined(t.shift)&&t.shift!==(0,Wn.Tu)(c)?!1:Ue(c)===e.keyCode}function jo(c){return Ue(c)===U.Enter.keyCode}function Mo(c,e){c.shiftKey||(c.stopPropagation(),c.preventDefault(),c.ctrlKey||c.altKey?document.execCommand("insertText",!1,`
`):e())}class Io extends _o.A{registerBindings(e,t){const s=(a,l)=>{t.isRegistered(a)&&e.addListener(l)};s("stepZoom",a=>{const l=a.keyEvent;if(ee(l,U.Equal,{ctrl:!0})||ee(l,U.NumpadAdd,{ctrl:!0}))return t.trigger("stepZoom",{value:1}),!0}),s("undo",a=>{const l=a.keyEvent;if(ee(l,U.KeyZ,{ctrl:!0,shift:!1}))return t.trigger("undo"),!0}),s("redo",a=>{const l=a.keyEvent;if(ee(l,U.KeyY,{ctrl:!0})||ee(l,U.KeyZ,{ctrl:!0,shift:!0}))return t.trigger("redo"),!0}),s("copy",a=>{const l=a.keyEvent;if(ee(l,U.KeyC,{ctrl:!0}))return t.trigger("copy"),!0}),s("paste",a=>{const l=a.keyEvent;if(ee(l,U.KeyV,{ctrl:!0}))return t.trigger("paste"),!0}),s("selectAll",a=>{const l=a.keyEvent;if(ee(l,U.KeyA,{ctrl:!0}))return t.trigger("selectAll"),!0}),super.registerBindings(e,t)}}var Eo=u(40406);let Qt=class extends Eo.A{constructor(e,t,n,i,s,a){super(e,t,n,i,s,a),this.eventBus=e,this.canvas=t,this.dragging=n,this.elementRegistry=i,this.selection=s,this.toolManager=a}select(e,t){const n=(0,Fe.rx)(e,t),i=(0,E.values)(n),s=i.filter(a=>D.isLabel(a)&&i.includes(a.parent)||!D.isLabel(a));this.selection.select(s)}};Qt=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("canvas")),(0,r.__param)(2,d("dragging")),(0,r.__param)(3,d("elementRegistry")),(0,r.__param)(4,d("selection")),(0,r.__param)(5,d("toolManager")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],Qt);let mt=class{constructor(e,t,n,i,s){this.elementRegistry=e,this.diagramModeling=t,this.elements=n,this.eventBus=i,this.logger=s,this.errors=[],this.loadRenderInterval=500}createElement(e,t){this.diagramModeling.createDiagramElement(e,t)}createLabel(e,t){this.diagramModeling.createDiagramLabel({value:e,id:t})}createConnection(e,t){const n=v.cloneDeep(e),{source:i,target:s}=n,a=this.elementRegistry,l=a.get(i),p=a.get(s),g=this.getConnectionAttributes(t,n);this.diagramModeling.connect(l,p,g,e.hints||{})}addOriginalToWaypoint(e,t){if(!e.original){const n=this.elementRegistry.get(t);n&&(e.original=D.getOriginalWaypoint(e,n))}}addOriginalToConnection(e){const t=e.waypoints;if(t&&t.length>1){const n=t[0];this.addOriginalToWaypoint(n,e.source);const i=t[t.length-1];this.addOriginalToWaypoint(i,e.target)}}getConnectionAttributes(e,t){const{waypoints:n,name:i,type:s=Z.connection}=t;this.addOriginalToConnection(t);let{caption:a,documentation:l}=t;return a=a&&a.toString(),l=l&&l.toString(),{id:e,waypoints:n,name:i,caption:a,documentation:l,type:s}}load(e,t,n){var i=this;return(0,j.A)(function*(){i.errors=[];const s=[...v.map(e.elements,(l,p)=>({handler:()=>i.createElement(p,e.elements),id:p})),...v.map(e.connections,(l,p)=>({handler:()=>i.createConnection(l,p),id:p})),...v.map(e.labels,(l,p)=>({handler:()=>i.createLabel(l,p),id:p}))];let a=Number(new Date);try{for(let l=0,p=s.length;l<p&&!t.isStopped;l++){try{s[l].handler()}catch(h){i.errors.push(s[l].id+" "+h.toString()),console.error(h)}if(Number(new Date)-a>i.loadRenderInterval){const h=Math.round(l/p*100);n.next(h),yield new Promise(C=>v.delay(C,0)),a=Number(new Date)}}return i.errors.length&&i.logger.exception(`Error when loading process with ID: ${e.id}`,{loggerName:"DiagramLoader"},i.errors),i.errors}finally{n.next(0),t.isStopped||i.eventBus.fire("diagram.loaded")}})()}};mt=(0,r.__decorate)([(0,r.__param)(0,d("elementRegistry")),(0,r.__param)(1,d("modeling")),(0,r.__param)(2,d("elements")),(0,r.__param)(3,d("eventBus")),(0,r.__param)(4,d("loggerService")),(0,r.__metadata)("design:paramtypes",[Object,Q,R,Object,_.gP])],mt);class ae extends _.sj{constructor(){super({prefix:"bpmonline-designer.diagram",storageType:"localStorage"}),this.diagramId=""}set(e,t,n=!0){return n&&(e+="."+this.diagramId),super.set(e,t)}get(e,t=!0){return t&&(e+="."+this.diagramId),super.get(e)}remove(...e){return e&&(e=e.map(t=>t+"."+this.diagramId)),super.remove(...e)}static{this.\u0275fac=function(t){return new(t||ae)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac})}}var So=u(25141),Zn=u.n(So),Do=u(12266);const ft=50,Po={min:.2,max:4},Oo=10,To=.1;let $t=class{constructor(e,t,n,i,s,a,l,p){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.zoomScroll=i,this.localStorage=s,this.popupMenu=a,this.config=l,this.diagramUtils=p,this.openStateKey="minimap-state",this.loadMiniMapRenderInterval=50,this._onElementAdded=this.onElementAdded.bind(this),this._onElementRemoved=this.onElementRemoved.bind(this),this._onElementsChanged=this.onElementsChanged.bind(this),this._onElementUpdateId=this.onElementUpdateId.bind(this),this.init()}init(){const e=this.getOpenState();this._state={isOpen:e,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null,parentClientRect:null,zoomDelta:0,data:null},this.createComponent(),this.registerPopupMenu(),this.subscribeEvents()}getOpenState(){return this.localStorage.get(this.openStateKey,!1)}setOpenState(e){(0,E.assign)(this._state,{isOpen:e}),this.localStorage.set(this.openStateKey,e,!1),e?((0,y.classes)(this.parent).add("open"),(0,y.attr)(this.mapButtons.preview,"title",this.config.localizableStrings.get("miniMapClose"))):((0,y.classes)(this.parent).remove("open"),(0,y.attr)(this.mapButtons.preview,"title",this.config.localizableStrings.get("miniMapOpen")))}createComponent(){this.parent=document.createElement("div"),(0,y.classes)(this.parent).add("djs-minimap"),y.event.bind(this.parent,"mousedown",t=>t.stopPropagation());const e=this.canvas.getContainer();this.isOpen()&&(0,y.classes)(this.parent).add("open"),e.appendChild(this.parent),this.initButtons(),this.map=document.createElement("div"),(0,y.classes)(this.map).add("map"),this.parent.appendChild(this.map),this.svg=(0,f.vt)("svg"),(0,f.CF)(this.svg,{width:"100%",height:"100%"}),(0,f.BC)(this.map,this.svg),this.elementsGroup=(0,f.vt)("g"),(0,f.BC)(this.svg,this.elementsGroup),this.viewportGroup=(0,f.vt)("g"),(0,f.BC)(this.svg,this.viewportGroup),this.viewport=(0,f.vt)("rect"),(0,f.Ly)(this.viewport).add("viewport"),(0,f.BC)(this.viewportGroup,this.viewport),this.viewportDom=document.createElement("div"),(0,y.classes)(this.viewportDom).add("viewport-dom"),this.parent.appendChild(this.viewportDom),this.overlay=document.createElement("div"),(0,y.classes)(this.overlay).add("overlay"),this.parent.appendChild(this.overlay)}initButtons(){const e=document.createElement("div");(0,y.classes)(e).add("map-buttons"),this.mapButtons={},this.getMapButtonsConfig().forEach(n=>{const i=document.createElement("div");if(["map-button",...n.classes].forEach(s=>(0,y.classes)(i).add(s)),n.title){let s=this.config.localizableStrings.get(n.title);n.shortcut&&(s+=` (${n.shortcut})`),(0,y.attr)(i,"title",s)}n.caption&&(i.textContent=n.caption),this.subscribeUserEvent(i,"click",n.click),this.mapButtons[n.id]=i,e.appendChild(i)}),this.parent.appendChild(e)}getMapButtonsConfig(){return[{id:"preview",classes:["material-icons","preview-button"],title:this.isOpen()?"miniMapClose":"miniMapOpen",caption:"icon_preview_16",click:()=>this.preview()},{id:"fitToView",classes:["material-icons","fit-to-view-button"],title:"fitToView",shortcut:"Ctrl+0",caption:"icon_fullscreen_16",click:()=>this.fitToView()},{id:"resetView",classes:["reset-view-button"],title:"resetView",caption:"1:1",click:()=>this.resetView()},{id:"zoomOut",classes:["material-icons","zoom-out-button"],title:"zoomOut",shortcut:"Ctrl+-",caption:"icon_zoom_out_16",click:()=>this.zoomScroll.zoomOut()},{id:"zoomIn",classes:["material-icons","zoom-in-button"],title:"zoomIn",shortcut:"Ctrl++",caption:"icon_zoom_in_16",click:()=>this.zoomScroll.zoomIn()},{id:"zoom",classes:["zoom-button"],caption:"100%",click:()=>this.togglePopupMenu()}]}subscribeEvents(){let e=!0;this.eventBus.on("diagram.loaded",()=>{e?(e=!1,this.isOpen()&&this.open().then(()=>{this.onDiagramLoaded().then()})):this.onDiagramLoaded().then()}),this.subscribeUserEvent(this.svg,"click",t=>this.onSvgClick(t)),y.event.bind(this.viewportDom,"mousedown",t=>this.onMousedown(!1,t)),y.event.bind(this.svg,"mousedown",t=>this.onMousedown(!0,t)),this.subscribeUserEvent(this.parent,"wheel",t=>this.onParentWheel(t)),this.eventBus.on("canvas.viewbox.changed",()=>this.onViewBoxChanged()),this.eventBus.on("canvas.resized",()=>this.onCanvasResized()),this.eventBus.on("zoom.changed",(t,n)=>this._onZoomChanged(n)),this.eventBus.on("keyboard.keydown",t=>this.onKeyDown(t)),this.eventBus.on("diagram.clear",()=>this.onClear())}onDiagramLoaded(){var e=this;return(0,j.A)(function*(){e.isOpen()&&(yield e.loadData(),e.subscribeElementEvents())})()}onSvgClick(e){this.setViewboxCenteredAroundClickEvent(e)}onViewBoxChanged(){this._state.isDragging||this.update()}onCanvasResized(){document.body.contains(this.parent)&&(this._state.isDragging||this.update(),this._state._svgClientRect=this.svg.getBoundingClientRect())}onKeyDown({keyEvent:e}){if(e.ctrlKey&&Ue(e)===U.Digit0.keyCode)return this.fitToView(),!1}onClear(){this.isOpen()&&this.unsubscribeElementEvents(),this.elementRegistry.getAllElements().forEach(e=>this.removeElement(e))}subscribeUserEvent(e,t,n){y.event.bind(e,t,i=>{i.preventDefault(),i.stopPropagation(),n.call(this,i)})}onParentWheel(e){if(!e.ctrlKey||(this.updateSvgClientRect(),!this.isPointInside(e,this._state._svgClientRect)))return;const{deltaMode:t,deltaX:n,deltaY:i}=e,s=t===0?.02:.32,a=Math.sqrt(Math.pow(i,2)+Math.pow(n,2))*Math.sign(i)*-s;if(this._state.zoomDelta+=a,Math.abs(this._state.zoomDelta)>To){const l=a>0?1:-1,p=Math.log(this.canvas.zoom())/Math.log(10),g=this.getStepSize(Po,Oo*2),h=Math.round(p/g)*g+g*l,C=Math.pow(10,h);this.zoomScroll.setZoom(C),this._state.zoomDelta=0;const m=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint(m),this.update()}}update(){if(!this.isOpen())return;const e=this.canvas.viewbox(),t=e.inner,n=e.outer;if(!this.validViewbox(e))return;let i,s,a,l;const p=n.width-t.width,g=n.height-t.height;t.width<n.width?(i=t.x-p/2,a=n.width,t.x+t.width<n.width&&(i=Math.min(0,t.x))):(i=t.x,a=t.width),t.height<n.height?(s=t.y-g/2,l=n.height,t.y+t.height<n.height&&(s=Math.min(0,t.y))):(s=t.y,l=t.height),i=i-ft,s=s-ft,a=a+ft*2,l=l+ft*2,this.lastViewbox={x:i,y:s,width:a,height:l},(0,f.CF)(this.svg,{viewBox:i+", "+s+", "+a+", "+l}),(0,f.CF)(this.viewport,{x:e.x,y:e.y,width:e.width,height:e.height});const h=this.map.getBoundingClientRect();this._state._parentClientRect=h;const C=this.viewport.getBoundingClientRect(),m={top:C.top-h.top,left:C.left-h.left,width:C.width,height:C.height};(0,E.assign)(this.viewportDom.style,{top:m.top+"px",left:m.left+"px",width:m.width+"px",height:m.height+"px"});const b=this.getOverlayClipPath(h,m);(0,E.assign)(this.overlay.style,{clipPath:b})}setViewboxCenteredAroundClickEvent(e){this.updateSvgClientRect();const t=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint(t),this.update()}onMousedown(e,t){if(t.button!==0)return;this.updateSvgClientRect(),e&&this.setViewboxCenteredAroundClickEvent(t);const n=this.mapMousePositionToDiagramPoint(t),i=this.canvas.viewbox(),s=this.getOffsetViewport(n,i),a=this.viewportDom.getBoundingClientRect(),l={x:t.clientX-a.left+1,y:t.clientY-a.top+1};(0,E.assign)(this._state,{cachedViewbox:i,initialDragPosition:{x:t.clientX,y:t.clientY},isDragging:!0,offsetViewport:s,offsetViewportDom:l,viewportClientRect:this.viewport.getBoundingClientRect(),parentClientRect:this.map.getBoundingClientRect()}),y.event.bind(document,"mousemove",this.onMousemove.bind(this)),y.event.bind(document,"mouseup",this.onMouseup.bind(this))}updateSvgClientRect(){(!this._state._svgClientRect||this.isZeroDimensional(this._state._svgClientRect))&&(this._state._svgClientRect=this.svg.getBoundingClientRect())}onMousemove(e){if(this._state.isDragging){this.updateSvgClientRect();const t=this._state.offsetViewportDom,n=this._state.viewportClientRect,i=this._state.parentClientRect;(0,E.assign)(this.viewportDom.style,{top:e.clientY-t.y-i.top+"px",left:e.clientX-t.x-i.left+"px"});const s=this.getOverlayClipPath(i,{top:e.clientY-t.y-i.top,left:e.clientX-t.x-i.left,width:n.width,height:n.height});(0,E.assign)(this.overlay.style,{clipPath:s});const a=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint({x:a.x-this._state.offsetViewport.x,y:a.y-this._state.offsetViewport.y})}}onMouseup(e){if(this._state.isDragging){const t=this._state.initialDragPosition;t.x===e.clientX&&t.y===e.clientY&&this.setViewboxCenteredAroundClickEvent(e),this.update(),(0,E.assign)(this._state,{cachedViewbox:null,initialDragPosition:null,isDragging:!1,offsetViewport:null,offsetViewportDom:null}),y.event.unbind(document,"mousemove",this.onMousemove.bind(this)),y.event.unbind(document,"mouseup",this.onMouseup.bind(this))}}_onZoomChanged(e){this.mapButtons.zoom.textContent=Math.round(e*100)+"%"}updateElement(e){try{e.parent!==void 0&&e.parent!==null&&(this.removeElement(e),this.addElement(e))}catch(t){console.warn(`Minimap#updateElement error: ${t}`)}}addElement(e){if(this.removeElement(e),e.hidden)return;let t,n,i;const s=this.createElement(e);if(s){const a=(0,y.query)("#"+Zn()(e.parent.id),this.elementsGroup),l=this.elementRegistry.getGraphics(e),p=this.elementRegistry.getGraphics(e.parent),g=this.getIndexOfChildInParentChildren(l,p);return g!=="undefined"?a?a.childNodes.length>g?this.insertChildAtIndex(s,a,g):this.insertChildAtIndex(s,a,a.childNodes.length-1):this.elementsGroup.appendChild(s):this.elementsGroup.appendChild(s),this.diagramUtils.isConnection(e)?(t=e.parent,n=0,i=0,typeof t.x<"u"&&typeof t.y<"u"&&(n=-t.x,i=-t.y),(0,f.CF)(s,{transform:"translate("+n+" "+i+")",strokeWidth:"4"})):(n=e.x,i=e.y,a&&(t=e.parent,typeof t.x<"u"&&typeof t.y<"u"&&(n-=t.x,i-=t.y)),(0,f.CF)(s,{transform:"translate("+n+" "+i+")"})),e.children&&e.children.length&&e.children.forEach(h=>{this.addElement(h)}),s}}removeElement(e){const t=this.svg.getElementById(e.id);t&&(0,f.TF)(t)}createElement(e){const t=this.elementRegistry.getGraphics(e);if(t){const n=(0,Do.P)(t);if(n){const i=(0,f.o8)(n);return(0,f.CF)(i,{id:e.id}),i}}}getOffsetViewport(e,t){return{x:e.x-(t.x+t.width/2),y:e.y-(t.y+t.height/2)}}mapMousePositionToDiagramPoint({clientX:e,clientY:t}){const n={x:e-this._state._svgClientRect.left,y:t-this._state._svgClientRect.top},i=this.svg.getBoundingClientRect(),s=this.fitAspectRatio(this.lastViewbox,i.width/i.height),a=this.mapPosition(n.x,0,i.width,s.x,s.x+s.width),l=this.mapPosition(n.y,0,i.height,s.y,s.y+s.height);return{x:a,y:l}}setViewboxCenteredAroundPoint(e){const t=this.canvas.viewbox(),n=t.width,i=t.height;this.canvas.viewbox({x:e.x-n/2,y:e.y-i/2,width:n,height:i})}fitAspectRatio(e,t){const n=e.width/e.height,i=(0,E.assign)({},{x:e.x,y:e.y,width:e.width,height:e.height});if(n>t){const s=i.width*(1/t),a=i.y-(s-i.height)/2;(0,E.assign)(i,{y:a,height:s})}else if(n<t){const s=i.height*t,a=i.x-(s-i.width)/2;(0,E.assign)(i,{x:a,width:s})}return i}mapPosition(e,t,n,i,s){const a=n-t,l=s-i;return(e-t)*l/a+i}getIndexOfChildInParentChildren(e,t){const n=(0,y.query)(".djs-children",t.parentNode);if(!n)return;const i=[].slice.call(n.childNodes);let s=-1;return i.forEach(function(a,l){(0,y.query)(".djs-element",a)===e&&(s=l)}),s}insertChildAtIndex(e,t,n){const s=[].slice.call(t.childNodes)[n];t.insertBefore(e,s.nextSibling)}isZeroDimensional(e){return e.width===0&&e.height===0}isPointInside(e,t){return e.x>t.left&&e.x<t.left+t.width&&e.y>t.top&&e.y<t.top+t.height}getStepSize(e,t){const n=Math.log(e.min)/Math.log(10),i=Math.log(e.max)/Math.log(10);return(Math.abs(n)+Math.abs(i))/t}getOverlayClipPath(e,t){return`polygon(${[[t.left,t.top],[t.left+t.width,t.top],[t.left+t.width,t.top+t.height],[t.left,t.top+t.height],[t.left,e.height],[e.width,e.height],[e.width,0],[0,0],[0,e.height],[t.left,e.height]].map(([i,s])=>`${i}px ${s}px`).join(", ")})`}validViewbox(e){return(0,E.every)(e,t=>(0,E.isObject)(t)?this.validViewbox(t):(0,E.isNumber)(t)&&isFinite(t))}subscribeElementEvents(){this.eventBus.on(["shape.added","connection.added"],A.MIN,this._onElementAdded),this.eventBus.on(["shape.removed","connection.removed"],A.MIN,this._onElementRemoved),this.eventBus.on(["elements.changed"],A.MIN,this._onElementsChanged),this.eventBus.on(["element.updateId"],A.MIN,this._onElementUpdateId)}unsubscribeElementEvents(){this.eventBus.off(["shape.added","connection.added"],this._onElementAdded),this.eventBus.off(["shape.removed","connection.removed"],this._onElementRemoved),this.eventBus.off(["elements.changed"],this._onElementsChanged),this.eventBus.off(["element.updateId"],this._onElementUpdateId)}onElementAdded({element:e}){this.addElement(e),this.update()}onElementRemoved({element:e}){this.removeElement(e),this.update()}onElementsChanged({elements:e}){e.forEach(t=>this.updateElement(t)),this.update()}onElementUpdateId({element:e,newId:t}){try{const n=(0,y.query)("#"+Zn()(e.id),this.elementsGroup);n&&(n.id=t)}catch(n){console.warn(`Minimap#updateElementId error: ${n}`)}}registerPopupMenu(){this.popupMenu.registerProvider("zoom",this),this.eventBus.on("minimap.open",()=>this.popupMenu.close()),this.eventBus.on("minimap.close",()=>this.popupMenu.close())}delay(e=0){return new Promise(t=>v.delay(t,e))}loadData(){var e=this;return(0,j.A)(function*(){yield e.delay();let t=Number(new Date);const n=e.elementRegistry.getAllElements();for(let i=0,s=n.length;i<s;i++){try{e.addElement(n[i])}catch(l){console.error(l)}Number(new Date)-t>e.loadMiniMapRenderInterval&&(yield e.delay(),t=Number(new Date))}})()}open(){var e=this;return(0,j.A)(function*(){e.setOpenState(!0),yield e.loadData(),e.update(),e.subscribeElementEvents(),e.eventBus.fire("minimap.open")})()}close(){this.isOpen()&&(this.setOpenState(!1),this.unsubscribeElementEvents(),this.eventBus.fire("minimap.close"))}isOpen(){return this._state.isOpen}resetView(){var e=this;return(0,j.A)(function*(){yield e.zoomScroll.animateResetView()})()}fitToView(){this.zoomScroll.fitToView()}preview(){this.isOpen()?this.close():this.open()}togglePopupMenu(){if(this.popupMenu.isOpen()){this.popupMenu.close();return}this.popupMenu.open({},"zoom",{cursor:{}})}getEntries(){var e=this;return[...[25,50,75,100,200,300].map(n=>({id:`zoom-${n}`,label:`${n}%`,action:function(){var i=(0,j.A)(function*(){yield e.zoomScroll.animateZoom(n/100)});return function(){return i.apply(this,arguments)}}()})),{id:"separator-1",className:"entry-separator",disabled:!0},{id:"reset-view",label:this.config.localizableStrings.get("resetView"),action:()=>this.resetView()},{id:"fit-into-view",label:this.config.localizableStrings.get("fitToView"),action:()=>this.fitToView()}]}};$t=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("canvas")),(0,r.__param)(2,d("elementRegistry")),(0,r.__param)(3,d("zoomScroll")),(0,r.__param)(4,d("localStorage")),(0,r.__param)(5,d("popupMenu")),(0,r.__param)(6,d("config")),(0,r.__param)(7,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,D])],$t);var ko=u(96206);let Jt=class extends ko.A{constructor(e,t){super(e,t),this.eventBus=e,this.canvas=t,e.on("diagram.init",A.LOW,()=>{this.updateEntries()})}updateEntries(){const e=this.getEntries();(0,E.forEach)(e,function(t,n){const i=(0,y.query)(`[data-action="${n}"]`);t.hasOwnProperty("menu")&&(0,y.classes)(i).add("create-menu")})}getEntries(){return super.getEntries()}};Jt=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("canvas")),(0,r.__metadata)("design:paramtypes",[Object,Object])],Jt);let Kt=class{constructor(e,t,n,i,s,a,l,p,g,h,C){this.create=e,this.elementFactory=t,this.palette=n,this.featureProvider=i,this.canvas=s,this.elements=a,this.paletteElements=l,this.rules=p,this.eventBus=g,this.createPopupMenu=h,this.config=C,this.dataActionPrefix="create-",this.init()}init(){this.rules.allowed("canShowPalette")&&(this.palette.registerProvider(this),this.subscribeEvents())}subscribeEvents(){this.eventBus.on("createPopupMenu.open",e=>this.activateEntry(e)),this.eventBus.on("createPopupMenu.close",e=>this.deactivateEntry(e))}getCreateShapeConfig(e){const t=this.elements.getConfig(e),{type:n,width:i,height:s}=t;return{type:n,width:i,height:s}}createActionClick(e,t){const n=this.getCreateShapeConfig(e),i=this.elementFactory.createShape(n);this.create.start(t,i),this.createPopupMenu.close()}openCreateMenu(e,t,n){this.createPopupMenu.open(e,t,n)}getCreateMenuEntries(e){return e.menu.map(t=>this.elements.items[t]).filter(t=>t).map(t=>({action:{dragstart:this.createActionClick.bind(this,t)},id:t.userTaskType||t.type,imageUrl:t.smallImage,label:this.config.localizableStrings.get(t.caption)}))}activateEntry({paletteEntryId:e}){const t=(0,y.query)(`[data-action="${e}"]`);(0,y.classes)(t).add("active")}deactivateEntry({paletteEntryId:e}){const t=(0,y.query)(`[data-action="${e}"]`);(0,y.classes)(t).remove("active")}getPaletteEntries(){const e={};return Object.values(this.paletteElements.getElements()).forEach(t=>{const n=this.dataActionPrefix+t.type,i={group:"elements",action:{dragstart:this.createActionClick.bind(this,t)},...t};if(t.menu){const s=this.getCreateMenuEntries(t);s.length?i.action.click=this.openCreateMenu.bind(this,t,n,s):delete i.menu}e[n]=i}),e}};Kt=(0,r.__decorate)([(0,r.__param)(0,d("create")),(0,r.__param)(1,d("elementFactory")),(0,r.__param)(2,d("palette")),(0,r.__param)(3,d("featureProvider")),(0,r.__param)(4,d("canvas")),(0,r.__param)(5,d("elements")),(0,r.__param)(6,d("paletteElements")),(0,r.__param)(7,d("rules")),(0,r.__param)(8,d("eventBus")),(0,r.__param)(9,d("createPopupMenu")),(0,r.__param)(10,d("config")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,R,rt,Object,Object,Ve,Object])],Kt);let Xt=class{constructor(e,t,n,i,s){this.config=e,this.toolManager=t,this.dragging=n,this.lassoTool=i,this.spaceTool=s}getPaletteToolsConfig(){return{arrow:{icon:"icon_arrow_select_24",title:"arrow",click:()=>{this.toolManager.setActive(null),this.dragging.cancel()}},lasso:{icon:"icon_sellect_24",title:"lasso",click:()=>{this.lassoTool.toggle()}},space:{icon:"icon_move_24",title:"space",click:()=>{this.spaceTool.toggle()}}}}getPaletteTools(e=!0){const t={},n=this.getPaletteToolsConfig();return Object.keys(n).forEach(i=>{const{icon:s,title:a,click:l}=n[i];t[i]={group:"tools",html:`<div class="entry material-icons">${s}</div>`,title:this.config.localizableStrings.get(a),action:{click:l}}}),e?{...t,separator:{separator:!0}}:t}};Xt=(0,r.__decorate)([(0,r.__param)(0,d("config")),(0,r.__param)(1,d("toolManager")),(0,r.__param)(2,d("dragging")),(0,r.__param)(3,d("lassoTool")),(0,r.__param)(4,d("spaceTool")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object])],Xt);let qt=class{constructor(e,t){this.eventBus=e,this.canvas=t,this._isOpen=!1,this._init()}_init(){this._popupContainer=(0,y.domify)('<div class="djs-diagram-popup"></div>');const e=this.canvas.getContainer();this._popup=e.appendChild(this._popupContainer),this._subscribeEvents()}_subscribeEvents(){this._subscribeEventBusEvents(),this._subscribeDomEvents()}_subscribeDomEvents(){this._popup.onwheel=e=>this._onWheel(e)}_onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this._popup.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}_onViewBoxChanged(){this._state&&this._state.parentContainer&&this.open({parentContainer:this._state.parentContainer,html:this._state.html,width:this._state.width,options:this._state.options})}_subscribeEventBusEvents(){this.eventBus.on(["canvas.resized","zoom.changed","selection.changed"],()=>this.close()),this.eventBus.on("popup.open",e=>this.open(e)),this.eventBus.on("canvas.viewbox.changing",()=>this.hide()),this.eventBus.on("canvas.viewbox.changed",()=>this._onViewBoxChanged())}getPopupPosition(e){const{parentContainer:t}=e,{e:n,f:i}=t.getCTM(),{height:s}=t.getBoundingClientRect(),a=5,l=i+s+a,{width:p}=t.getBoundingClientRect(),g=e.options?.direction||"right";let h=n;return g==="right"&&(h+=p-e.width),g==="left"&&(h-=p),{x:h,y:l}}open(e){if(!e.width)throw new Error("width must be > 0");this._state={parentContainer:e.parentContainer,html:e.html,width:e.width,options:e.options};const{x:t,y:n}=this.getPopupPosition(e);return(0,v.assign)(this._popupContainer.style,{left:`${t}px`,top:`${n}px`,visibility:"visible",width:`${e.width}px`}),this._isOpen=!0,this._popupContainer.innerHTML=e.html,this._popupContainer}close(){this._isOpen&&(this.hide(),this._state={})}hide(){(0,v.assign)(this._popupContainer.style,{visibility:"hidden"}),this._popupContainer.innerHTML=""}};qt=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("canvas")),(0,r.__metadata)("design:paramtypes",[Object,Object])],qt);var Lo=u(6226);let en=class extends Lo.A{constructor(e,t,n){super(e,t,n),this.contextPadItemWidth=32,this.padding=10}subscribeEvents(){this.preventScrollParent(this.getContainer());const e=this._eventBus;e.once("createPopupMenu.open",this.close.bind(this)),e.once("element.mousedown",A.HIGH,this.close.bind(this)),e.once("keyboard.keydown",A.HIGH,this.close.bind(this))}unsubscribeEvents(){const e=this._eventBus;e.off("createPopupMenu.open",this.close.bind(this)),e.off("element.mousedown",this.close.bind(this)),e.off("keyboard.keydown",this.close.bind(this))}fixContainerPosition(e,t){const i=this._canvas.getContainer().getBoundingClientRect(),s=e.getBoundingClientRect(),a=i.y+this.padding;if(s.top<a){const l=this.padding,p=t.x-this.contextPadItemWidth-s.width-this.padding;(0,E.assign)(e.style,{top:`${l}px`,left:`${p}px`})}}getContainer(){return this._current.container}preventScrollParent(e){e.onwheel=t=>this.onWheel(t)}open(e,t,n){super.open(e,t,n);const i=this.getContainer();this.fixContainerPosition(i,n),this.subscribeEvents(),(0,E.assign)(i.style,{opacity:1})}close(){super.close(),this.unsubscribeEvents()}onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this._current.container.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}};en=(0,r.__decorate)([(0,r.__param)(0,d("config.popupMenu")),(0,r.__param)(1,d("eventBus")),(0,r.__param)(2,d("canvas")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object])],en);var Ro=u(38134);class zo extends Ro.A{addDragger(e,t,n){const i=super.addDragger(e,t,n);return i.classList.add(e.type),i}}var yt=u(95820),Ao=u(97975),re=u(19187);const $={Connection:{Fill:"none",MarkerShape:"M-10,3 L2,0 L-10,-3 Z",MarkerfillOpacity:1,StrokeLinejoin:"round",StrokeWidth:1,PathStrokeWidth:2}};var We;(function(c){c.Connection="connection",c.ConnectionEndMarker="connection-end-marker"})(We||(We={}));const tn={arrowHoverStrokeColor:"#1186D8",arrowStrokeColor:"#8095b3",connectionMarkerFillColor:"#FFFF",connectionMarkerStrokeColor:"#60779F",connectionStrokeColor:"#8095B3"};class Yn{get endMarker(){const e=(0,f.vt)("path");return(0,f.CF)(e,{d:$.Connection.MarkerShape,"fill-opacity":$.Connection.MarkerfillOpacity,fill:tn.arrowStrokeColor,stroke:tn.arrowStrokeColor,strokeLinejoin:$.Connection.StrokeLinejoin,strokeWidth:$.Connection.StrokeWidth,class:We.ConnectionEndMarker}),e}_getLastSegment(e){const t=e.length;return{a:e[t-2],b:e[t-1]}}_getFirstSegment(e){return{a:e[1],b:e[0]}}_angle(e){const t=e.b.y-e.a.y,n=e.b.x-e.a.x;return Math.atan2(t,n)}_renderMarker(e,t,n,i){e&&(this._transformMarker(e,i,n),(0,f.BC)(t,e))}_transformMarker(e,t,n){(0,f.pd)(e,(0,f.uK)(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),n.x,n.y))}renderMarkers(e,t){const n=t.waypoints,i=this._getLastSegment(n),s=this._angle(i),a=this._getFirstSegment(n),l=this._angle(a),p=this.startMarker(t);this._renderMarker(p,e,a.b,l),this._renderMarker(this.endMarker,e,i.b,s)}startMarker(e){return null}getConnectionAttributes(e){return{class:We.Connection,fill:$.Connection.Fill,stroke:tn.connectionStrokeColor,strokeLinejoin:$.Connection.StrokeLinejoin,strokeWidth:$.Connection.PathStrokeWidth}}drawConnection(e,t,n){n.itemName&&(0,f.CF)(t,{"data-item-marker":n.itemName});const i=(0,f.vt)("g"),s=this.getConnectionAttributes(n.type),a=n.waypoints,l=["m"+a[0].x+","+a[0].y];for(let g=1;g<a.length;g++)l.push("L"+a[g].x+","+a[g].y);const p=(0,f.vt)("path");return(0,f.CF)(p,{d:l.join(" ")}),(0,f.CF)(p,s),(0,f.BC)(i,p),this.renderMarkers(i,n),(0,f.BC)(t,i),i}}var le;(function(c){c[c.before=0]="before",c[c.after=1]="after",c[c.instead=2]="instead"})(le||(le={}));function Ze(c,e,t=le.instead){return(n,i,s)=>{s===void 0&&(s=Object.getOwnPropertyDescriptor(n,i));const a=s.value;return e.__instance__ instanceof e||(e.__instance__=new e),s.value=function(){const l=[].slice.call(arguments),p=[...l];let g;if(this.createFeatureContext instanceof Function&&p.unshift(this.createFeatureContext.call(this)),c(...l)){const h=e.__instance__;switch(t){case le.before:return g=h[i].apply(h,[...p]),a.apply(this,[...l,g]);case le.after:return g=a.apply(this,l),h[i].apply(h,[...p,g]);default:return h[i].apply(h,[...p])}}return a.apply(this,[...l,g])},s}}class Qn{drawConnection(e,t,n){}}(0,r.__decorate)([Ze(()=>!0,Yn),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Object,Object]),(0,r.__metadata)("design:returntype",Object)],Qn.prototype,"drawConnection",null);var $n;let fe=class{constructor(e,t,n,i){this.elements=e,this.styles=t,this.diagramText=n,this.eventBus=i}updateClass(e,t){const n=this.elements.getConfig(t),i=e.parentElement||e.parentNode,s=i.classList;(0,v.forEach)(this.elements.items,a=>{s.remove(a.type),s.remove(a.userTaskType)}),i.classList.add(n.userTaskType||n.type)}createText(e,t,n){const i=this.diagramText.createText(t,n);return(0,f.Ly)(i).add("djs-label"),n.className&&(0,f.Ly)(i).add(n.className),(0,f.BC)(e,i),i}drawRect(e,t,n,i,s,a){(0,v.isObject)(s)&&(a=s,s=0),s=s||0,a=this.styles.computeStyle(a,{fill:"none",stroke:"#EBEBEB",strokeWidth:1});const l=(0,f.vt)("rect");return(0,f.CF)(l,{height:n-s*2,rx:i,ry:i,width:t-s*2,x:s,y:s}),(0,f.CF)(l,a),(0,f.BC)(e,l),l}draw(e,t){return this.updateClass(e,t),null}};fe=(0,r.__decorate)([(0,r.__param)(0,d("elements")),(0,r.__param)(1,d("styles")),(0,r.__param)(2,d("diagramText")),(0,r.__param)(3,d("eventBus")),(0,r.__metadata)("design:paramtypes",[Object,typeof($n=typeof re.A<"u"&&re.A)=="function"?$n:Object,se,Object])],fe);const Jn={ELLIPSE:"ellipse",RECTANGLE:"rect"};class No{static{this.xmlns="http://www.w3.org/2000/svg"}static createFeFlood(e,t="#000",n=0){return this.createElement(e,{"flood-color":t,"flood-opacity":n||0,result:"colorResult"},"feFlood")}static createFeComposite(e){return this.createElement(e,{operator:"in",in:"colorResult",in2:"blurResult",result:"shadowResult"},"feComposite")}static createFeGaussianBlur(e,t=0){return this.createElement(e,{result:"blurResult",in:"offsetResult",stdDeviation:t},"feGaussianBlur")}static createFeBlend(e){return this.createElement(e,{in:"SourceGraphic",in2:"shadowResult",mode:"normal"},"feBlend")}static setAttribute(e,t){const n=Object.keys(t);for(const i of n)e.setAttribute(i.toString(),t[i])}static createElement(e,t,n){let i;return t&&t.id&&(i=e.getElementById(t.id)),i||(i=document.createElementNS(this.xmlns,n)),t&&this.setAttribute(i,t),i}static createFilter(e,t){return this.createElement(e,{id:t,width:"200%",height:"200%"},"filter")}static createFeOffset(e,t=0,n=0){return this.createElement(e,{result:"offsetResult",in:"SourceAlpha",dx:t,dy:n},"feOffset")}static addDefs(){const e=document.querySelector("svg"),t=e.getElementsByTagName("defs")[0];if(t==null){const n=document.createElementNS(this.xmlns,"defs");return e.appendChild(n)}return t}static createShadowFilter(e){const t=document.querySelector("svg"),n=e.name;if(!n)throw new Error("ArgumentNullOrEmptyException");const i=t.getElementById(n),s="url(#"+n+")";if(i)return s;const a=this.addDefs(),l=this.createFilter(t,n),p=this.createFeOffset(t,e.offsetX,e.offsetY);l.appendChild(p);const g=this.createFeGaussianBlur(t,e.blur);l.appendChild(g);const h=this.createFeFlood(t,e.color,e.opacity);l.appendChild(h);const C=this.createFeComposite(t);l.appendChild(C);const m=this.createFeBlend(t);return l.appendChild(m),a.appendChild(l),s}}class Kn extends fe{getEllipseBackgroundConfig(e){const n=e.backgroundStyle.padding||0,i=Math.round(Math.max(e.width,e.height)/2),s=Math.round(e.height/2);return{rx:i+n,ry:s+n,cx:Math.round(e.width/2),cy:Math.round(e.height/2-1)}}getLabelBackgroundConfig(e){const t=e.backgroundStyle,i=(t&&t.type)===Jn.ELLIPSE?this.getEllipseBackgroundConfig(e):this.getDefaultBackgroundConfig(e),s=t&&t.fill;v.assign(i,s?{fill:s}:{style:"fill: transparent;"});const a=t&&t.filter;if(a){const l=No.createShadowFilter(a);v.assign(i,{filter:l})}return i}setLabelBackground(e,t){const n=t.backgroundStyle,i=n&&n.type||Jn.RECTANGLE,s=(0,f.vt)(i),a=this.getLabelBackgroundConfig(t);(0,f.CF)(s,a),(0,f.BC)(e,s)}getDefaultBackgroundConfig(e){return{height:e.height,width:e.width}}getLabelText(e){return e.caption||e.labelTarget&&e.labelTarget.caption||""}getDrawOptions(e){const t=e.caption?0:3,n={box:{height:e.height,width:e.width+t,x:e.x,y:e.y},fitBox:!1,style:{...this.diagramText.style,direction:"ltr"}};return v.assign(n.style,e.style),n}draw(e,t){super.draw(e,t),this.setLabelBackground(e,t);const n=this.getLabelText(t),i=this.getDrawOptions(t),s=this.diagramText.createText(n,i);return(0,f.Ly)(s).add("djs-label"),(0,f.BC)(e,s),s}}let Ye=class{constructor(e,t){this.renderingLabel=e,this.renderingShape=t}create(e){return e===Z.label?this.renderingLabel:this.renderingShape}};Ye=(0,r.__decorate)([(0,r.__param)(0,d("renderingLabel")),(0,r.__param)(1,d("renderingShape")),(0,r.__metadata)("design:paramtypes",[Kn,fe])],Ye);function Xn(c,e=le.before){return Ze(()=>!0,c,e)}var qn,ei;let Qe=class extends Ao.A{constructor(e,t,n,i,s){super(e),this.eventBus=e,this.styles=t,this.diagramText=n,this.renderingFactory=i,this.elementRegistry=s}setDataItemMarker(e,t){let n=t.itemName;if(t.type===Z.label){const i=t.labelTarget.itemName;n=n||i&&i+"_label"}n&&e.setAttributeNS(null,"data-item-marker",n)}canRender(){return!0}drawShape(e,t){return this.setDataItemMarker(e,t),this.renderingFactory.create(t.type).draw(e,t)}drawConnection(e,t){return super.drawConnection(e,t)}createFeatureContext(){return{styles:this.styles,diagramText:this.diagramText,elementRegistry:this.elementRegistry}}};(0,r.__decorate)([Xn(Qn,le.instead),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Object]),(0,r.__metadata)("design:returntype",void 0)],Qe.prototype,"drawConnection",null),Qe=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("styles")),(0,r.__param)(2,d("diagramText")),(0,r.__param)(3,d("renderingShapeFactory")),(0,r.__param)(4,d("elementRegistry")),(0,r.__metadata)("design:paramtypes",[typeof(qn=typeof yt.A<"u"&&yt.A)=="function"?qn:Object,typeof(ei=typeof re.A<"u"&&re.A)=="function"?ei:Object,Object,Ye,Object])],Qe);var Bo=u(19506);let nn=class extends Bo.A{constructor(e,t,n,i,s,a,l,p){super(n,t,e,i,s,a),this.elements=l,this.diagramUtils=p,this.AXIS_TO_DIMENSION={x:"width",y:"height"}}_excludeLabelsWithoutTargets(e){return e.filter(t=>t.type===oe.label?e.some(n=>n.id===t.labelTarget.id):!0)}calculateAdjustments(e,t,n,i){const s=[],a=[];return e.forEach(l=>{const p=l[t],g=p+l[this.AXIS_TO_DIMENSION[t]];if(l.parent&&!l.waypoints){if(!this.canResizeShape(l,i,t)&&(n>0&&p>i||n<0&&g<i))return s.push(l);if(this.canResizeShape(l,i,t)||p<i&&g>i&&this._rules.allowed("shape.resize",{shape:l}))return a.push(l)}}),{movingShapes:this._excludeLabelsWithoutTargets(s),resizingShapes:this._excludeLabelsWithoutTargets(a)}}init(e,t){const n=super.init(e,t);return n&&(t.minAllowedDelta=this.getMinAllowedDelta(t.resizingShapes,t.direction,t.movingShapes),t.spaceToolConstraints=null),n}getDelta(e){const t=super.getDelta(e);return D.getCorrectSpaceToolDelta(t,e)}canResizeShape(e,t,n){return!1}getMinAllowedDelta(e,t,n){return null}};nn=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("dragging")),(0,r.__param)(2,d("canvas")),(0,r.__param)(3,d("modeling")),(0,r.__param)(4,d("rules")),(0,r.__param)(5,d("toolManager")),(0,r.__param)(6,d("elements")),(0,r.__param)(7,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,R,D])],nn);var Go=u(7264);class Fo extends Go.A{getDelta(e){const t=super.getDelta(e);return D.getCorrectSpaceToolDelta(t,e)}}let on=class{constructor(e,t,n){this.eventBus=e,this.Tooltips=t,this.canvas=n,this.tooltipTimeout=400,e.on("element.hover",this.onElementHover.bind(this)),this.Tooltips._updateRoot=()=>{}}onElementHover(e){clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(()=>{const{element:t,gfx:n}=e;this.elementId!==t.id&&this.tooltipId&&this.removeTooltip(),t.tooltip&&!this.tooltipId&&this.addTooltip(n,t)},this.tooltipTimeout)}removeTooltip(){this.Tooltips.remove(this.tooltipId),this.tooltipId=null}addTooltip(e,t){this.elementId=t.id;const n=t.tooltipConfig||{};this.tooltipId=this.Tooltips.add({position:{x:0,y:0},type:n.type,html:this.getTemplate(t.tooltip)}),this.setPosition(e,t)}getTemplate(e){return`<div class="tooltip">${e}</div>`}getDiagramSize(){const t=this.canvas.getContainer().getBoundingClientRect();return{width:t.width,height:t.height}}getHtmlContainer(){return this.Tooltips.get(this.tooltipId).htmlContainer}setPosition(e,t){const{a:n,e:i,f:s}=e.getCTM();let a=i+t.width*n,l=s+t.height*n;const p=this.getDiagramSize(),g=this.getHtmlContainer(),{width:h,height:C}=g.getBoundingClientRect();a+h>p.width&&(a=i-h),l+C>p.height&&(l=s-C),Object.assign(g.style,{left:a+"px",top:l+"px"})}};on=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("tooltips")),(0,r.__param)(2,d("canvas")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object])],on);var ti=u(40127),Vo=u(436),Ho=u(56165),O=u(36486),ni,ii,oi;const Uo={min:.2,max:4};let sn=class extends Vo.A{constructor(e,t,n,i,s,a){super(e,t,n),this.config=e,this.eventBus=t,this.canvas=n,this.createPopupMenu=i,this.popupMenu=s,this.localStorage=a,this.cancelAnimation$=new x.Subject,this.eventBus.on(["canvas.viewbox.changed"],A.MEDIUM,l=>{this.onCanvasViewBoxChanged(l)})}cancelAnimation(){this.cancelAnimation$.next(!0)}_handleWheel(e){if(this.cancelAnimation(),this.createPopupMenu.isOpen()){this.createPopupMenu.onWheel(e);return}if(this.popupMenu.isOpen()){this.popupMenu.onWheel(e);return}super._handleWheel(e)}onCanvasViewBoxChanged(e){const t=this.canvas.scroll();t.x=Math.round(t.x)||0,t.y=Math.round(t.y)||0;const n=this.getInitScroll();t.x!==n.x||t.y!==n.y?this.localStorage.set("scroll",t):this.localStorage.remove("scroll");const i=e.viewbox.scale;i&&i!==this.getInitScale()?this.localStorage.set("scale",i):this.localStorage.remove("scale")}getInitScale(){return this.config&&this.config.initScale||1}getInitScroll(){return this.config&&this.config.initScroll||{x:0,y:0}}getScale(){return this.canvas.viewbox().scale}getScroll(){return this.canvas.scroll()}setZoom(e){const t=this.canvas.viewbox().outer,n={x:t.width/2,y:t.height/2};this.canvas.zoom((0,Ho.N)(Uo,e),n)}setScroll(e){const t=this.getScroll();this.canvas.scroll({dx:-t.x+e.x,dy:-t.y+e.y})}animateZoomScroll({toScale:e,toScroll:t,fromScale:n=null,fromScroll:i=null,stepCount:s=20,stepPeriod:a=1}){var l=this;return(0,j.A)(function*(){if(l.cancelAnimation(),n=n||l.getScale(),i=i||l.getScroll(),n===e&&i.x===t.x&&i.y===t.y)return;const p=(e-n)/s,g=(t.x-i.x)/s,h=(t.y-i.y)/s;return new Promise(C=>{(0,x.interval)(a).pipe((0,O.take)(s+1),(0,O.takeUntil)(l.cancelAnimation$),(0,O.finalize)(()=>{l.eventBus.fire("animateZoomScroll.done"),C()})).subscribe(m=>{l.setZoom(n+p*m),l.setScroll({x:i.x+g*m,y:i.y+h*m})})})})()}animateZoom(e){var t=this;return(0,j.A)(function*(){const n=t.getScroll();yield t.animateZoomScroll({toScale:e,toScroll:n,stepCount:5,stepPeriod:1})})()}initZoomScroll(e=null,t=0){const n=e||this.localStorage.get("scroll")||this.getInitScroll(),i=t||this.localStorage.get("scale")||this.getInitScale();this.getScale()!==i&&this.setZoom(i);const a=this.getScroll();(a.x!==n.x||a.y!==n.y)&&this.setScroll(n)}animateResetView(){var e=this;return(0,j.A)(function*(){yield e.animateZoomScroll({toScale:e.getInitScale(),toScroll:e.getInitScroll()})})()}fitToView(){this.cancelAnimation(),this.canvas.zoom("fit-viewport",null);const e=this.getInitScroll();this.canvas.scroll({dx:e.x,dy:e.y})}zoomOut(e=.1){this.cancelAnimation(),this.setZoom(this.getScale()-e)}zoomIn(e=.1){this.cancelAnimation(),this.setZoom(this.getScale()+e)}};sn=(0,r.__decorate)([(0,r.__param)(0,d("config")),(0,r.__param)(1,d("eventBus")),(0,r.__param)(2,d("canvas")),(0,r.__param)(3,d("createPopupMenu")),(0,r.__param)(4,d("popupMenu")),(0,r.__param)(5,d("localStorage")),(0,r.__metadata)("design:paramtypes",[Object,typeof(ni=typeof yt.A<"u"&&yt.A)=="function"?ni:Object,typeof(ii=typeof Rt.A<"u"&&Rt.A)=="function"?ii:Object,Ve,typeof(oi=typeof ti.A<"u"&&ti.A)=="function"?oi:Object,ae])],sn);class an{constructor(e){this.context=e,this.modeling=e.modeling,this.localizableStrings=e.localizableStrings,this.canvas=e.canvas,this.contextPad=e.contextPad,this.popupMenu=e.popupMenu,this.connect=e.connect,this.create=e.create,this.elementFactory=e.elementFactory,this.elements=e.elements,this.elementToolsConfig=e.elementToolsConfig}getAddItemsConfig(e){const t=this.elementToolsConfig.addItems,n={};return t.forEach(i=>{const s=this.addElementDragStart.bind(this,i);n["add."+i.type]={action:{dragstart:s},imageUrl:i.image,title:i.title}}),n}getDragStartShapeConfig(e){const t=this.elements.getConfig(e);return{type:e.type,width:t.width,height:t.height,caption:""}}addElementDragStart(e,t,n){const i=this.getDragStartShapeConfig(e),s=this.elementFactory.createShape(i);this.create.start(t,s,{source:n})}getDeleteConfig(e){return{delete:{action:{click:()=>{this.modeling.removeElements([e])}},...this.elementToolsConfig.tools.delete}}}getSetupConfig(){return{setup:{action:{click:(e,t)=>{const n=this.getPopupMenuPosition(e,t);this.popupMenu.open(t,"setup",n)}},...this.elementToolsConfig.tools.setup}}}getPopupMenuPosition(e,t){const n=this.canvas.getContainer().getBoundingClientRect(),i=this.contextPad.getPad(t).html.getBoundingClientRect();return{cursor:{x:e.clientX,y:e.clientY},x:i.left+i.width+3-n.left,y:i.top-1-n.top}}getConnectConfig(){return{connect:{action:{dragstart:(e,t,n)=>{this.connect.start(e,t,n)}},...this.elementToolsConfig.tools.connect}}}hasSetupMenu(e){return!this.popupMenu.isEmpty(e,"setup")}hasConnectConfig(e){return e.type&&e.type!==Z.connection}hasAddItemsMenu(e){return!0}hasDeleteAction(e){return!0}getContextPadEntries(e){const t={};return this.hasDeleteAction(e)&&Object.assign(t,this.getDeleteConfig(e)),this.hasSetupMenu(e)&&Object.assign(t,this.getSetupConfig()),this.hasAddItemsMenu(e)&&Object.assign(t,this.getAddItemsConfig(e)),this.hasConnectConfig(e)&&Object.assign(t,this.getConnectConfig()),t}}class si extends an{getContextPadEntries(){return{}}}class ai{constructor(e){this.context=e}getElementToolsFeature(e){return D.isLabel(e)?new si(this.context):new an(this.context)}}let Ct=class{constructor(e,t,n,i,s,a,l,p,g,h){this.elements=g,this.elementToolsConfig=h;const C=p.localizableStrings;t.registerProvider(this);const m={modeling:n,localizableStrings:C,contextPad:t,canvas:l,popupMenu:a,elementFactory:i,create:s,connect:e,elements:g,elementToolsConfig:h};this.initializeElementToolsFactory(m)}initializeElementToolsFactory(e){this.toolsFactory=new ai(e)}getContextPadEntries(e){return this.toolsFactory.getElementToolsFeature(e).getContextPadEntries(e)}};Ct=(0,r.__decorate)([(0,r.__param)(0,d("connect")),(0,r.__param)(1,d("contextPad")),(0,r.__param)(2,d("modeling")),(0,r.__param)(3,d("elementFactory")),(0,r.__param)(4,d("create")),(0,r.__param)(5,d("popupMenu")),(0,r.__param)(6,d("canvas")),(0,r.__param)(7,d("config")),(0,r.__param)(8,d("elements")),(0,r.__param)(9,d("elementToolsConfig")),(0,r.__metadata)("design:paramtypes",[Object,Object,Q,Object,Object,Object,Object,Object,R,Object])],Ct);class Wo{constructor(){this._featureService=new x.ReplaySubject(1)}set featureService(e){this._featureService.next(e)}getFeatureServiceValues(e){return this._featureService.subscribe(t=>{t.getFeatureValues(n=>{e(n)})})}}var Zo=u(17521);class Yo{findIntersectSegment(e,t){const n={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};let i=-1,s;const a=e.waypoints;for(let l=0;l<a.length-1;l++){const p={x1:a[l].x,y1:a[l].y,x2:a[l+1].x,y2:a[l+1].y},g=n,h={x1:Math.min(p.x1,p.x2)-1,y1:Math.min(p.y1,p.y2)-1,x2:Math.max(p.x1,p.x2)+1,y2:Math.max(p.y1,p.y2)+1},C=Math.max(0,Math.min(h.x2,g.x2)-Math.max(h.x1,g.x1)),m=Math.max(0,Math.min(h.y2,g.y2)-Math.max(h.y1,g.y1)),b=C*m;(b>i||i<0)&&(i=b,s=p)}return s}getAlignDelta(e,t){let n=0,i=0;const s=(0,me.pp)(t);return e.x1===e.x2?n=e.x1-s.x:i=e.y1-s.y,{x:n,y:i}}isForbiddenType(e){return D.isLabel(e)}canSplit(e){return e&&e.length===1&&!this.isForbiddenType(e[0])}splitConnection({connection:e,shapes:t,modeling:n}){if(e&&this.canSplit(t)){const i=t[0],s=e.target,a=this.findIntersectSegment(e,i),l=this.getAlignDelta(a,i);n.moveShape(i,l);const p=(0,Zo.jz)(i);n.reconnectEnd(e,i,p,{isUpdateConnectionType:!1}),n.connect(i,s,{})}}}var Qo=u(49096);const Ca=4,va=4,xa=5,ri=3.5,ba=1,_a=16.8699;let rn=class{constructor(e,t,n,i,s,a,l){this.eventBus=e,this.directEditing=t,this.canvas=n,this.modeling=i,this.diagramText=s,this.selection=a,this.rules=l,this.directEditing.registerProvider(this),this.rules.allowed("canLabelEdit")?this.subscribeEvents():this.subscribeSelectionEvents()}clearLabelTargetsCaption(e){const t=v.compact(v.map(e.elements,n=>n.labelTarget));v.forEach(t,n=>this.clearElementCaption(n))}clearElementCaption(e){e.caption="",this.eventBus.fire(N.element.updateLabelExecuted,{context:{element:e,text:""}})}onKeyDown({keyEvent:e}){const t=this.selection.get(),n=t.length===1&&t[0];if(n){if(Ue(e)===U.Enter.keyCode)return v.defer(()=>this.editElementLabel(n)),!1;if(wo(e))return n.needClearCaption=!0,this.editElementLabel(n),!1}}_copySelectedLabelText(){const e=this.selection.get(),t=e.length===1&&e[0];if(!t)return;const n=t.labelTarget.caption,i=s=>{(s.clipboardData||window.clipboardData).setData("text",n),s.preventDefault()};document.addEventListener("copy",i,!1),document.execCommand("copy"),document.removeEventListener("copy",i,!1)}_selectLabelText(e){const t=document.createRange(),n=document.querySelector(`[data-element-id="${e.id}"] .foreign-text`);t.selectNodeContents(n);const i=window.getSelection();i.removeAllRanges(),i.addRange(t)}showElementLabel(e){const t=e.active&&e.active.element.label;t&&this.canvas.removeMarker(t,"djs-element-hidden")}subscribeSelectionEvents(){this.eventBus.on(["element.dblclick"],({element:e})=>{e.type===oe.label&&this._selectLabelText(e)}),this.eventBus.on(["keyboard.keydown"],({keyEvent:e})=>{ee(e,U.KeyC,{ctrl:!0})&&this._copySelectedLabelText()})}subscribeEvents(){this.eventBus.on(["element.dblclick"],e=>this.editElementLabel(e.element)),this.eventBus.on(["canvas.viewbox.changing","element.mousedown","popupMenu.open"],()=>{this.directEditing.isActive()&&this.directEditing.complete()}),this.eventBus.on(["drag.init"],e=>{if(this.directEditing.isActive()){this.directEditing.complete();const t=e.shape;t&&t.x&&t.y&&this.selection.select(t)}}),this.eventBus.on(["create.end"],A.LOW,e=>this.onCreateEnd(e)),this.eventBus.on(["connect.end"],A.LOW,e=>{const t=e.context.connection;this.editElementLabel(t)}),this.eventBus.on(["directEditing.activate"],e=>{const t=e.active.element.label;t&&this.canvas.addMarker(t,"djs-element-hidden")}),this.eventBus.on(["directEditing.complete","directEditing.cancel"],e=>this.showElementLabel(e)),this.eventBus.on([N.element.deleteElementsExecuted],e=>this.clearLabelTargetsCaption(e.context)),this.eventBus.on(["keyboard.keydown"],e=>this.onKeyDown(e))}onCreateEnd(e){const t=e.shape;e.context.canExecute&&this.editElementLabel(t)}editElementLabel(e){e.constructor!==Qo.bL&&this.directEditing.activate(e.labelTarget||e)}getPadding(e,t){return v.mapValues(e,n=>n*t)}getBoxBounds(e){let t;const n=this.canvas,i=n.zoom(),s=Y.label.width*i,a=this.getPadding(Y.label.padding,i),l=a.paddingTop,p=a.paddingBottom,g=e.label,h=1;if(g){const m=n.getAbsoluteBBox(g);t={height:m.height+l+p,width:s,minHeight:Y.label.minHeight,x:Math.round(m.x+m.width/2-s/2),y:Math.round(m.y-l)}}else{const m=this.diagramText.style,w=m.fontSize*m.lineHeight*i+l+p+h*2,S={height:w/i,width:s/i},T=this.diagramText.getLabelPosition(e,S),B=n.getAbsoluteBBox(T);t={height:w,width:s,x:Math.round(B.x-s/2),y:Math.round(B.y-l-h)}}const C=e.width?e.width+(ri+h)*2:Y.label.minWidth;return t.minWidth=C*i,t}getTextStyle(e,t,n){const i=t.fontSize*e;return{...t,fontSize:`${i}px`,padding:`${n.paddingTop}px ${n.paddingRight}px ${n.paddingBottom}px ${n.paddingLeft}px`}}getElementStyle(e){const t=this.canvas.zoom(),n=v.cloneDeep(this.diagramText.style),i=Y.label.padding;return this.getTextStyle(t,n,this.getPadding(i,t))}activate(e){const t=this.getBoxBounds(e),n=this.getElementStyle(e),i=["djs-direct-editing-parent"];let s;return e.needClearCaption?(s="",e.needClearCaption=!1):s=e.caption||"",{autoResize:!0,bounds:t,centerVertically:!0,options:{autoResize:!0,classList:i},style:n,text:s}}update(e,t,n){this.modeling.updateLabel(e,t)}};rn=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("directEditing")),(0,r.__param)(2,d("canvas")),(0,r.__param)(3,d("modeling")),(0,r.__param)(4,d("diagramText")),(0,r.__param)(5,d("selection")),(0,r.__param)(6,d("rules")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Q,Object,Object,Object])],rn);var $o=u(22170);let ln=class extends $o.A{constructor(e,t,n,i){super(e,t,n),this.eventBus=t,this.modeling=n,this.diagramText=i,this.subscribeEvents()}onMoveConnectionLabel(e){const t=e.context,i=t.connection.label;if(i){const s=t.hints.delta;this.modeling.moveShape(i,s)}}onReconnectStart(e){const{connection:t,hints:n,newSource:i,oldSource:s}=e.context,a=t.label,l=n&&n.doUpdateLabelPosition;if(a&&l){const p={x:i.x-s.x,y:i.y-s.y};this.modeling.moveShape(a,p)}}subscribeEvents(){this.eventBus.on([N.connection.moveConnectionLabel],this.onMoveConnectionLabel.bind(this)),super.postExecute(["connection.updateWaypoints"],this.onUpdateWaypoints.bind(this)),super.postExecute(["connection.layout"],this.onConnectionLayout.bind(this)),super.postExecute(["connection.reconnectStart"],this.onReconnectStart.bind(this)),super.postExecute(["shape.replace"],e=>{const t=e.context.newShape;this.modeling.updateLabel(t,t.caption)})}onConnectionLayout(e){const n=e.context.connection,i=n.label;if(!this.canMoveLabel(e,i))return;const s=this.getLabelOffset(n.waypoints,i);this.modeling.moveShape(i,s)}getLabelOffset(e,t){const n=this.diagramText.getConnectionLabelPosition(e,t);return{x:n.x-t.x-Math.round(t.width/2),y:n.y-t.y-Math.round(t.height/2)}}canMoveLabel(e,t){const{connection:n,hints:i,oldWaypoints:s,newSource:a}=e.context,l=i&&i.doUpdateLabelPosition;return t&&(!v.isEqual(n.waypoints,s)||a)&&l!==!1}onUpdateWaypoints(e){const t=e.context,n=t.connection,i=n.label;if(!this.canMoveLabel(e,i))return;const s=this.getLabelOffset(n.waypoints,i),a=this.getLabelOffset(t.oldWaypoints,i),l={x:s.x-a.x,y:s.y-a.y};this.modeling.moveShape(i,l)}};ln=(0,r.__decorate)([(0,r.__param)(0,d("injector")),(0,r.__param)(1,d("eventBus")),(0,r.__param)(2,d("modeling")),(0,r.__param)(3,d("diagramText")),(0,r.__metadata)("design:paramtypes",[Object,Object,Q,se])],ln);class Jo{constructor(e){this._parent=e.useRtl?(0,y.domify)('<div><textarea rows="1" dir="rtl" style="direction: rtl;" class="djs-direct-editing-content"></textarea></div>'):(0,y.domify)('<div><textarea rows="1" class="djs-direct-editing-content"></textarea></div>'),this.container=e.container,this._textArea=(0,y.query)(".djs-direct-editing-content",this._parent),this.keyHandler=e.keyHandler||(()=>{}),this._mousedown=t=>{t.stopPropagation()},this.resizeHandler=e.resizeHandler||(()=>{}),this.autoResize=this.autoResize.bind(this)}create(e,t,n,i){const s=this._parent,a=this._textArea,l=this.container;i=this._options=i||{},t=this._style=t||{};const p=v.pick(t,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);v.assign(s.style,{boxSizing:"border-box",left:e.x+"px",outline:"none",overflow:"visible",position:"absolute",textAlign:"center",top:e.y+"px",wordWrap:"normal",width:e.width+"px"},p);const g=v.pick(t,["borderLeft","fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return v.assign(a.style,{boxSizing:"border-box",outline:"none",wordWrap:"break-word",width:e.minWidth+"px",maxHeight:e.maxHeight+"px",maxWidth:(e.maxWidth||e.width)+"px",minHeight:e.minHeight+"px",minWidth:e.minWidth+"px"},g),i.centerVertically&&v.assign(a.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},g),a.value=n,y.event.bind(a,"keydown",this.keyHandler),y.event.bind(a,"mousedown",this._mousedown),y.event.bind(a,"paste",this._handlePaste),y.event.bind(a,"keydown",this.autoResize),y.event.bind(a,"blur",this.blur),s.className="djs-direct-editing-parent",i.classList&&s.classList.add(...i.classList),l.appendChild(s),this._textArea.selectionStart=n.length,this._textArea.selectionEnd=n.length,this._textArea.focus(),n&&this.resizeWidth(),this.resizeHeight(),s}resizeHeight(){this._textArea.style.height="auto",this._textArea.style.height=this._textArea.scrollHeight+"px"}resizeWidth(){this._textArea.style.width="auto",this._textArea.style.width=this._textArea.scrollWidth+"px"}autoResize(){v.defer(()=>{if(this._textArea.scrollHeight>0){const e=this._textArea.getBoundingClientRect();this.resizeWidth(),this.resizeHeight(),this.resizeHandler({dx:0,dy:this._textArea.scrollHeight-e.height,height:e.height,width:e.width})}})}destroy(){const e=this._parent,t=this._textArea;t.value="",e.removeAttribute("style"),t.removeAttribute("style"),y.event.unbind(t,"keydown",this.keyHandler),y.event.unbind(t,"mousedown",this._mousedown),y.event.unbind(t,"keydown",this.autoResize),y.event.unbind(t,"blur",this.blur),(0,y.remove)(e)}getValue(){return this._textArea.value}}let cn=class{constructor(e,t,n,i,s,a,l){this._eventBus=e,this._canvas=t,this._elementRegistry=n,this._graphicsFactory=i,this._diagramText=s,this.config=a,this._providers=[],this._textbox=l||new Jo({useRtl:a.isRtl}),this._textbox.container=t.getContainer(),this._textbox.keyHandler=this._handleKey.bind(this),this._textbox.blur=this._blur.bind(this),this._textbox.resizeHandler=this.handleResize.bind(this),this._eventBus.on("diagram.destroy",1e3,this.deactivate,this)}_handleKey(e){if(Ue(e)===U.Escape.keyCode){e.stopPropagation(),e.preventDefault(),this.cancel();return}jo(e)&&Mo(e,()=>this.complete())}_blur(){this.complete()}_fire(e,t){t=t||{active:this.active},this._eventBus.fire("directEditing."+e,t)}handleResize(e){this._fire("resize",e)}getNewBounds(){const e=this.activeTextbox.getBoundingClientRect();return{x:e.top,y:e.left,width:e.width,height:e.height}}registerProvider(e){this._providers.push(e)}isActive(){return!!this.active}cancel(){this.active&&this.close("cancel")}animate(e){const t=this.activeTextbox.classList;if(!(t&&t.contains("djs-direct-editing-rotate-90")))return;const i="djs-direct-editing-rotate-0";e?t.add(i):t.remove(i)}deactivate(){this._textbox.destroy(),this._fire("deactivate",null),this.active=null}close(e){this.animate(!1),this._fire(e,null),this.deactivate()}complete(){const e=this.active;if(!e)return;const t=this.getValue();e.provider.update(e.element,t,this.getNewBounds()),this.close("complete")}getValue(){return this._textbox.getValue()}activate(e){this.isActive()&&this.cancel();let t=null;this.initialHeight=e.height,this.initialWidth=e.width;const n=this._providers.find(i=>(t=i.activate(e),t?i:null));return t&&(this.activeTextbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this.active={element:e,context:t,provider:n},this.animate(!0),this._fire("activate",null)),!!t}};cn=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("canvas")),(0,r.__param)(2,d("elementRegistry")),(0,r.__param)(3,d("graphicsFactory")),(0,r.__param)(4,d("diagramText")),(0,r.__param)(5,d("config")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object])],cn);var Ko=u(10033),$e=u(74419);let vt=class extends Ko.A{constructor(e,t){super(),this.connectionDocking=e,this.config=t}isStraightConnection(e,t,n){return!0}isShapeCenter(e,t){const{height:n,width:i,x:s,y:a}=t,l=Math.floor(e.x-s-i/2),p=Math.floor(e.y-a-n/2);return l===0&&p===0}getPreferredDirectionWithPoint(e,t){const n=t.x+t.width/2,i=t.y+t.height/2,s=e.x-n,a=e.y-i;let l;return s<0?a<0?l=-s>-a?"l":"t":l=-s>a?"l":"b":a<0?l=s>-a?"r":"t":l=s>a?"r":"b",l}getBoundingRect(e){const n=e.y-10,i=e.x+e.width+10,s=e.y+e.height+10,a=e.x-10;return{top:n,right:i,bottom:s,left:a}}findSourceLayout(e,t,n,i){let s;const a=this.getBoundingRect(e),l=this.getBoundingRect(t);switch(n){case"t":s=l.top<=a.bottom?"t":"b";break;case"b":s=l.bottom<=a.top?"t":"b";break;case"l":s=a.right<=l.left?"r":"l";break;case"r":s=l.right<=a.left?"l":"r";break}return s===n&&(i==="h"&&["r","l"].includes(n)&&(a.top>l.bottom?s="t":a.bottom<l.top||a.bottom>=l.bottom?s="b":s="t"),i==="v"&&["t","b"].includes(n)&&(a.left>l.right?s="l":a.right>=l.right||a.right<l.left?s="r":s="l")),s}getPreferredLayouts(e,t,n,i={}){const s=(0,me.pp)(e),a=(0,me.pp)(t),l=Math.abs(s.x-a.x),p=Math.abs(s.y-a.y),g=l<p?"v":"h";let h;const C=i.connectionStart;if(C)this.isShapeCenter(C,e)||(h=this.getPreferredDirectionWithPoint(C,e));else{const w=n&&n[0],S=w&&(w.original||D.getOriginalWaypoint(w,e));w&&!this.isShapeCenter(S,e)&&(h=this.getPreferredDirectionWithPoint(w,e))}let m;const b=i.connectionEnd;if(b)this.isShapeCenter(b,t)||(m=this.getPreferredDirectionWithPoint(b,t));else{const w=n&&n.slice(-1)[0],S=w&&(w.original||D.getOriginalWaypoint(w,t));w&&!this.isShapeCenter(S,t)&&(m=this.getPreferredDirectionWithPoint(w,t))}return!h&&m&&(h=this.findSourceLayout(e,t,m,g)),h&&!m&&(m=this.findSourceLayout(t,e,h,g)),!h&&!m?[`${g}:${g}`]:[`${h}:${m}`]}layoutConnection(e,t={}){const n=t.source||e.source,i=t.target||e.target;t.startChanged&&!t.connectionStart&&(t.connectionStart=(0,me.pp)(n)),t.endChanged&&!t.connectionEnd&&(t.connectionEnd=(0,me.pp)(i));const s=e.waypoints,a=t.connectionStart||s&&s.length&&s[0].original,l=t.connectionEnd||s&&s.length&&s[s.length-1].original;let p;!t.shapeMoving&&!t.startChanged&&!t.endChanged?(t.preferredLayouts=this.getPreferredLayouts(n,i,s,t),p=$e.Z9(n,i,a,l,t)):p=$e.WI(n,i,a,l,s,t),this.isStraightConnection(n,i,e)&&p.length>2&&p.splice(1,p.length-2);const h=Object.assign(e);return h.waypoints=$e.d7(p),this.connectionDocking.getCroppedWaypoints(h,n,i)}};vt=(0,r.__decorate)([(0,r.__param)(0,d("connectionDocking")),(0,r.__param)(1,d("config")),(0,r.__metadata)("design:paramtypes",[Object,Object])],vt);class Xo{constructor(e,t){this.eventBus=e,this.outlineFactory=t,e.on("shape.added",A.LOW,this.onShapeAdded.bind(this)),e.on("shape.changed",A.LOW,this.onShapeChanged.bind(this)),e.on("connection.added",this.onConnectionAdded.bind(this)),e.on("connection.changed",this.onConnectionChanged.bind(this))}onShapeAdded(e){this.onUpdateOutline(e)}onShapeChanged(e){this.onUpdateOutline(e)}onConnectionAdded(e){this.onUpdateOutline(e)}onConnectionChanged(e){this.onUpdateOutline(e)}onUpdateOutline(e){const t=e.element;this.outlineFactory.getOutline(t).draw(t,e.gfx)}}class xt{constructor(e){this.config=e}findOutline(e){return(0,y.query)("."+this.config.outlineClassName,e)}getOutline(e){let t=this.findOutline(e);if(!t){const n=e;t=this.createOutline(n)}return t}createOutline(e){const t=this.getSvgName(),n=(0,f.vt)(t),i=this.getCreateOutlineConfig();return(0,f.CF)(n,i),(0,f.BC)(e,n),n}getSvgName(){return"rect"}getCreateOutlineConfig(){return{...this.config.outlineStyle,shapeRendering:"geometricPrecision"}}draw(e,t){const n=this.getOutline(t);this.updateOutline(n,e)}erase(e,t){const n=this.findOutline(t);n&&n.remove()}}class li extends xt{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return v.assign(e,{x:10,y:10,width:100,height:100})}updateOutline(e,t){const n=(0,Fe.U7)(t,!1),i=this.config.offset;(0,f.CF)(e,{height:n.height+i*2,width:n.width+i*2,x:n.x-i,y:n.y-i})}draw(e,t){this.config.rules.allowed("canShowConnectionOutline")&&super.draw(e,t)}}class qo extends xt{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return v.assign(e,{x:10,y:10,width:100,height:100,rx:5})}updateOutline(e,t){const n=this.config.offset;(0,f.CF)(e,{x:-n,y:-n,width:t.width+n*2,height:t.height+n*2})}}class es extends xt{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return v.assign(e,{x:10,y:10,width:100,height:100})}updateOutline(e,t){this.config.rules.allowed("canShowLabelOutline")&&(0,f.CF)(e,{x:-2,y:-2,width:t.width+2*2,height:t.height+2})}draw(e,t){this.config.rules.allowed("canShowLabelOutline")&&super.draw(e,t)}}let Je=class{constructor(e,t,n,i){this.styles=e,this.rules=t,this.elements=n,this.diagramUtils=i,this.config=this.getConfig()}getConfig(){const e="djs-outline",t={...this.styles.cls(e,["no-fill"],null),strokeDasharray:"4,2",strokeWidth:"1px"};return{outlineClassName:e,outlineStyle:t,offset:ri,elements:this.elements,rules:this.rules}}getOutline(e){switch(!0){case D.isLabel(e):return new es(this.config);case this.diagramUtils.isConnection(e):return new li(this.config);default:return new qo(this.config)}}};Je=(0,r.__decorate)([(0,r.__param)(0,d("styles")),(0,r.__param)(1,d("rules")),(0,r.__param)(2,d("elements")),(0,r.__param)(3,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,R,D])],Je);let bt=class extends Xo{constructor(e,t){super(e,t),this.outlineFactory=t}};bt=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("outlineFactory")),(0,r.__metadata)("design:paramtypes",[Object,Je])],bt);class ts extends fe{getSizeConfig(e){const t=this.elements.getConfig(e);return this.styles.style({height:e.height||t.height,width:e.width||t.width})}getImageSource(e){const t=this.elements.getConfig(e);return e.largeImage||t.largeImage}draw(e,t){super.draw(e,t);const n=this.elements.getConfig(t);if(!n)throw new Error(`Element type ${t.type} not supported`);const i=(0,f.vt)("image"),s=this.getSizeConfig(t),a=this.getImageSource(t);return(0,f.CF)(i,s),i.setAttributeNS("http://www.w3.org/1999/xlink","href",a),i.setAttributeNS(null,"type",n.type),i.setAttributeNS(null,"preserveAspectRatio","none"),(0,f.BC)(e,i),i}}let dn=class{constructor(e){this.popupMenu=e,this.popupMenu.registerProvider("setup",this)}getPopupMenuEntries(e){return{}}getHeaderEntries(e){return[]}};dn=(0,r.__decorate)([(0,r.__param)(0,d("popupMenu")),(0,r.__metadata)("design:paramtypes",[Object])],dn);class ci{stopSync(){}startSync(){}subscribeServerChanges(){return[]}}const _t={__depends__:[Ei.A,Si.A,Di.A,Pi.A,Oi.A,ki.A,Li.A,Ri.A,zi.A,Ai.A,Ni.A,Yi.A,Bi.A,Vn.A,Gi.A,Ui.A,$i.A,lt,Qi.A,Ti.A,gt,Wi.A],__init__:["canvas","commandStack","contextPad","contextPadProvider","copyPaste","labelSupport","diagramLoader","diagramRenderer","diagramRules","diagramEventHandlerController","diagramText","directEditing","editorActions","elementFactory","elementRegistry","keyboardBindings","labelEdit","layouter","localStorage","outline","resize","resizeHandles","resizePreview","setupMenuProvider","handTool","spaceToolPreview","bendpointMove","bendpoints","featureProvider","connectionPreview","connectionSegmentMove","paletteProvider","paletteElements","elementToolsConfig","createPopupMenu","palette","connectionHighlight","minimap","diagramPopup","lassoTool","diagramUtils","diagramPaletteTools","diagramTooltips"],canvas:["type",zt],commandStack:["type",At],connectionDocking:["type",Zi.A],contextPad:["type",ht],contextPadProvider:["type",Ct],copyPaste:["type",Wt],labelSupport:["type",ln],diagramLoader:["type",mt],diagramRenderer:["type",Qe],diagramRules:["type",z],diagramEventHandlerController:["type",ci],directEditing:["type",cn],editorActions:["type",Zt],elementFactory:["type",Un],elementRegistry:["type",He],keyboardBindings:["type",Io],localStorage:["type",ae],modeling:["type",Q],outline:["type",bt],resize:["type",Fi.A],resizeHandles:["type",Vi.A],resizePreview:["type",Hi.A],setupMenuProvider:["type",dn],handTool:["type",Vn.A],spaceToolPreview:["type",Fo],bendpoints:["type",lt],featureProvider:["type",Wo],connectionPreview:["type",Nt],popupMenu:["type",en],connectionSegmentMove:["type",gt],labelEdit:["type",rn],diagramText:["type",se],outlineFactory:["type",Je],renderingShapeFactory:["type",Ye],renderingLabel:["type",Kn],renderingShape:["type",ts],layouter:["type",vt],elements:["type",R],paletteProvider:["type",Kt],splitConnectionHelper:["type",Yo],spaceTool:["type",nn],paletteElements:["type",rt],elementToolsConfig:["type",ut],createPopupMenu:["type",Ve],palette:["type",Jt],replaceMenuGroups:["type",function(){return{}}],zoomScroll:["type",sn],connectionHighlight:["type",ct],minimap:["type",$t],diagramPopup:["type",qt],lassoTool:["type",Qt],previewSupport:["type",zo],diagramUtils:["type",D],diagramPaletteTools:["type",Xt],diagramTooltips:["type",on]};var M;(function(c){c.relationshipItem="relationship-item",c.relationshipContainer="relationship-container",c.connection="connection",c.parentConnection="parent-connection",c.indirectConnection="indirect-connection"})(M||(M={}));class I extends D{static isFlowNode(e){return[M.relationshipContainer,M.relationshipItem].includes(e?.type)}static isRelationshipContainer(e){return e?.type===M.relationshipContainer}static isRootItem(e){return I.isRelationshipContainer(e)||e?.single===!0}static isRelationshipItem(e){return e?.type===M.relationshipItem}static isIndirectConnection(e){return e?.type===M.indirectConnection}static isHorizontalConnection(e){return e?.type===M.connection&&e.position===0}isFlow(e){const t=[M.connection,M.indirectConnection];return super.isFlow(e)||t.includes(e?.type)}isConnection(e){const t=[M.connection,M.indirectConnection];return super.isConnection(e)||t.includes(e?.type)}}let pn=class extends an{constructor(e,t){super(e),this.context=e,this.config=t}hasAddItemsMenu(e){return I.isFlowNode(e)}hasConnectConfig(e){return I.isFlowNode(e)}hasDeleteAction(e){return this.context.rules.canDelete(e)}getAddItemsConfig(e){return{add:{action:{click:(t,n)=>{const i=this.getPopupMenuPosition(t,n);this.popupMenu.open(n,"add",i)}},...this.elementToolsConfig.tools.add}}}};pn=(0,r.__decorate)([(0,r.__param)(1,d("config")),(0,r.__metadata)("design:paramtypes",[Object,Object])],pn);let gn=class extends ai{constructor(e,t){super(e),this.context=e,this.config=t}getElementToolsFeature(e){return D.isLabel(e)?new si(this.context):new pn(this.context,this.config)}};gn=(0,r.__decorate)([(0,r.__param)(1,d("config")),(0,r.__metadata)("design:paramtypes",[Object,Object])],gn);let ye=class extends He{constructor(e,t){super(e),this.injector=e,this.utils=t}getChildren(e){return this.getAllElements().filter(t=>t.parent?.id===e.id)}getFlowNodes(){return this.getAllElements().filter(I.isFlowNode)}getContainers(){return this.getAllElements().filter(I.isRelationshipContainer)}getFlows(){return this.getAllElements().filter(e=>this.utils.isFlow(e))}getElementFlows(e){return this.getAllElements().filter(t=>this.utils.isFlow(t)).filter(t=>t.source.id===e.id||t.target.id===e.id)}};ye=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("injector")),(0,r.__param)(1,(0,_.y_)("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,I])],ye);let G=class{constructor(e,t,n){this.elements=e,this.registry=t,this.localStorage=n}static{this.canMove=!1}static getSpacing(e){switch(e){case M.relationshipItem:return{x:100,y:70};case M.relationshipContainer:return{x:70,y:100};case"scroll":return{x:50,y:50};default:return{x:10,y:8}}}setExpandedContainersIds(e){e.length>0?this.localStorage.set("expanded-containers",e.join(",")):this.localStorage.remove("expanded-containers")}getExpandedContainersIds(){return(this.localStorage.get("expanded-containers")||"").split(",")}getElementSize(e){const t=this.elements.getConfig(e);return e.collapsed===!1?{width:e.expandedWidth||t.width,height:e.expandedHeight||t.height*2}:{width:t.width,height:t.height}}saveContainersState(){const e=this.registry.getContainers().filter(t=>t.collapsed===!1).map(t=>t.id);this.setExpandedContainersIds(e)}loadContainersState(e){const t=this.getExpandedContainersIds().filter(n=>e.elements[n]?.hasChildren);t.map(n=>e.elements[n]).forEach(n=>n.collapsed=!1),this.setExpandedContainersIds(t)}};G=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("elements")),(0,r.__param)(1,(0,_.y_)("elementRegistry")),(0,r.__param)(2,(0,_.y_)("localStorage")),(0,r.__metadata)("design:paramtypes",[R,ye,ae])],G);let Ke=class extends z{constructor(e,t,n,i){super(e,t),this.eventBus=e,this.utils=n,this.elementRegistry=i}getCountConnection(e,t,n){return this.elementRegistry.filter(s=>s!==n&&(s.source===e&&s.target===t||s.source===t&&s.target===e)).length}canRead(e){return e.canRead!==!1}canConnect(e,t){let n=super.canConnect(e,t);return n&&(n=(!e||this.canRead(e))&&(!t||this.canRead(t))),n}canConnectionCreate(e){const t=e.source,n=e.target,i=e.connection;return super.canConnectionCreate(e)&&t!==n&&t.parent!==n&&t!==n.parent&&!this.utils.isConnection(t)&&!this.utils.isConnection(n)&&this.getCountConnection(t,n,i)<2}canReconnectEnd(e){const t=super.canReconnectEnd(e),{hover:n,connection:i}=e,s=i.source,a=n||e.target;return t&&this.canConnectionCreate({source:s,target:a,connection:i})}canReconnectStart(e){const t=super.canReconnectStart(e),{hover:n,connection:i}=e,s=n||e.source,a=i.target;return t&&this.canConnectionCreate({source:s,target:a,connection:i})}canShowPalette(){return!1}canElementMove(e){return G.canMove}canElementCopy(e){return!1}canElementPaste(e){return!1}canElementUpdateType(e){return!1}canLabelEdit(){return!1}canShowConnectionOutline(){return!1}canConnectionSegmentMove(){return!1}canElementsDelete(e){let t=super.canElementsDelete(e);const n=e.elements;return t=t&&n.every(i=>this.canDelete(i)),t?t=this.eventBus.fire("elements.removing",{elements:n}):this.eventBus.fire("elements.noAccessMessage",{elements:n}),t}canDelete(e){const t=this.canEdit(e);if(!t)return!1;if(this.utils.isFlow(e))return t;if(!this.elementRegistry.getElementFlows(e).every(s=>this.canEdit(s)))return!1;if(I.isRelationshipContainer(e))return this.elementRegistry.getChildren(e).every(l=>this.canEdit(l));if(I.isRelationshipItem(e)){const s=e;return s.single?!0:this.canRead(s.parent)}return!0}canEdit(e){if(I.isRoot(e))return!1;if(this.utils.isFlow(e)){const n=e;return this.canConnect(n.source,n.target)}return this.canRead(e)}};Ke=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("eventBus")),(0,r.__param)(1,(0,_.y_)("config")),(0,r.__param)(2,(0,_.y_)("diagramUtils")),(0,r.__param)(3,(0,_.y_)("elementRegistry")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object])],Ke);let hn=class extends Ct{constructor(e,t,n,i,s,a,l,p,g,h,C,m){super(e,t,n,i,s,a,l,p,g,h),this.elements=g,this.elementToolsConfig=h,this.registry=C,this.rules=m,this.config=p;const b=this.config.localizableStrings,w={modeling:n,localizableStrings:b,contextPad:t,canvas:l,popupMenu:a,elementFactory:i,create:s,connect:e,elements:g,elementToolsConfig:h,registry:C,rules:m};this.initializeElementToolsFactory(w)}initializeElementToolsFactory(e){this.toolsFactory=new gn(e,this.config)}};hn=(0,r.__decorate)([(0,r.__param)(0,d("connect")),(0,r.__param)(1,d("contextPad")),(0,r.__param)(2,d("modeling")),(0,r.__param)(3,d("elementFactory")),(0,r.__param)(4,d("create")),(0,r.__param)(5,d("popupMenu")),(0,r.__param)(6,d("canvas")),(0,r.__param)(7,d("config")),(0,r.__param)(8,d("elements")),(0,r.__param)(9,d("elementToolsConfig")),(0,r.__param)(10,d("elementRegistry")),(0,r.__param)(11,d("diagramRules")),(0,r.__metadata)("design:paramtypes",[Object,Object,Q,Object,Object,Object,Object,Object,R,Object,Object,Ke])],hn);class ns extends ut{getAddItems(){const e=this.config.customElementToolsConfig?this.config.customElementToolsConfig.addItems||[]:[];return[...super.getAddItems(),...e]}getTools(){const e=this.config.customElementToolsConfig?this.config.customElementToolsConfig.tools||[]:[];return{...super.getTools(),...e}}}let wt=class extends ns{constructor(e,t){super(e,t),this.elements=e,this.config=t,this.innerTools=this.getInnerTools()}getInnerTools(){return{...this.config?.customElementToolsConfig?.innerTools||{}}}};wt=(0,r.__decorate)([(0,r.__param)(0,d("elements")),(0,r.__param)(1,d("config")),(0,r.__metadata)("design:paramtypes",[R,Object])],wt);class is extends xt{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return Object.assign(e,{x:10,y:10,width:100,height:100,rx:8,ry:8})}updateOutline(e,t){const n=this.config.offset;(0,f.CF)(e,{x:-n,y:-n,rx:8,ry:8,width:t.width+n*2,height:t.height+n*2})}}let jt=class extends Je{constructor(e,t,n,i){super(e,t,n,i),this.styles=e,this.rules=t,this.elements=n,this.diagramUtils=i,this.flowNodeConfig=this.getFlowNodeConfig(),this.flowConfig=this.getFlowConfig()}getFlowConfig(){const e=this.getConfig();return e.outlineStyle.stroke="#b033d3",e}getFlowNodeConfig(){const e=this.getConfig();return e.offset=1.5,e.outlineStyle.strokeDasharray="none",e.outlineStyle.strokeWidth="3px",e}getOutline(e){switch(!0){case I.isFlowNode(e):return new is(this.flowNodeConfig);case this.diagramUtils.isFlow(e):return new li(this.flowConfig);default:return super.getOutline(e)}}};jt=(0,r.__decorate)([(0,r.__param)(0,d("styles")),(0,r.__param)(1,d("rules")),(0,r.__param)(2,d("elements")),(0,r.__param)(3,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,R,D])],jt);var K=u(52965),di;let Mt=class extends fe{constructor(e,t,n,i,s){super(e,t,n,i),this.elements=e,this.styles=t,this.diagramText=n,this.eventBus=i,this.canvas=s,this._groupsOverflowAmount=3,this._commentIconBase64="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIgdmlld0JveD0iMCAwIDEwIDEwIj48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6I2ZmZjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMjkgMC4wMjkpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjQ3MSAwLjQ3MSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTQxMy4yNSwzODAuNzM1aC0ydjJsLTMtMmgtNHYtNmg5WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDIyLjI1IC0zNzQuNzM1KSIvPjwvZz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIvPjwvc3ZnPg=="}_createAdditionalGroupsIcon(e,t,n){const i=(0,f.vt)("rect",{stroke:"gray","stroke-width":1,fill:"#ffffff",height:18,width:18,x:e.x-20,y:e.y,rx:10,ry:10});(0,f.BC)(t,i);const s=`+${n.length-this._groupsOverflowAmount}`,a={box:{height:18,width:18},style:{fill:"#60779F !important"},className:"show-all-group-caption"},l=this.createText(t,s,a);return(0,K.pd)(l,e.x-20,e.y,0),l}_getAdditionalGroupsHtml(e){let t='<div class="additional-groups">';for(const n of e){let i="",s="",a="";n.itemComment&&(i=" has-comment",s=`<div class="additional-group-comment">${n.itemComment}</div>`,a='<div class="comment-icon-gray"></div>'),t+=`
				<div class="additional-group-container">
					<div class="additional-group-container-header">
						<div class="circle" style="background-color:${n.color}"></div>
						<div class="additional-group-name${i}">${n.caption}</div>
						${a}
					</div>
					${s}
				</div>`}return t+="</div>"}_drawCommentIcon(e,t,n){const i=(0,f.vt)("rect",{fill:n.color,height:10,rx:5,ry:5,width:15,x:t.x,y:t.y});(0,f.BC)(e,i),(0,K.pd)(i,-5,0,0);const s=this._commentIconBase64,a=this.styles.style({height:10,width:10}),l=(0,f.vt)("image",a);l.setAttributeNS("http://www.w3.org/1999/xlink","href",s),l.setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),(0,f.BC)(e,l),(0,K.pd)(l,t.x,t.y,0)}_addCommentListener(e,t,n){e.addEventListener("click",()=>{const i=`<div class="group-item-comment">
							 	<h4 class="caption">
									<span class="circle" style="background-color:${n.color}"></span>
									${n.caption}
								</h4>
							 	<p class="item-comment">${n.itemComment}</p>
							 </div>`;this.eventBus.fire("popup.open",{parentContainer:t,html:i,width:278,options:{direction:"right"}})})}draw(e,t){const n=(0,f.vt)("g",{class:"group-container"});(0,f.BC)(e,n);const i=t.groups||[];if(i.length===0)return;const s=5,a=100,l=16,p=l/2,g={x:t.width,y:t.height-l/2},h=i.length,C=h>this._groupsOverflowAmount,m=(C?this._groupsOverflowAmount:h)-1;if(C){const b=this._createAdditionalGroupsIcon(g,n,i),w=this._getAdditionalGroupsHtml(i);b.addEventListener("click",()=>{const S=this.canvas.viewbox();this.eventBus.fire("popup.open",{parentContainer:b,html:w,width:Math.round(t.width*S.scale)})}),g.x-=s+15}for(let b=0;b<=m;b++){const w=i[b],T=w.itemComment?"group-item has-item-comment":"group-item",B=(0,f.vt)("g",{class:T});(0,f.BC)(n,B),g.x-=a+s;const je=(0,f.vt)("rect",{fill:w.color,height:l,rx:p,ry:p,width:a,x:g.x,y:g.y});(0,f.BC)(B,je);const L=w.caption,Pn=w.itemComment?a-24:a-10,On={box:{height:l,width:Pn},className:"group-caption"},bi=this.createText(B,L,On);if((0,K.pd)(bi,g.x+5,g.y,0),w.itemComment){const ya={x:g.x+a-17,y:g.y+4};this._drawCommentIcon(B,ya,w),this._addCommentListener(B,bi,w)}}return n}};Mt=(0,r.__decorate)([(0,r.__param)(0,d("elements")),(0,r.__param)(1,d("styles")),(0,r.__param)(2,d("diagramText")),(0,r.__param)(3,d("eventBus")),(0,r.__param)(4,d("canvas")),(0,r.__metadata)("design:paramtypes",[Object,typeof(di=typeof re.A<"u"&&re.A)=="function"?di:Object,se,Object,Object])],Mt);let It=class{constructor(e,t,n){this.modeling=e,this.elements=t,this.elementToolsConfig=n,this.containerClassName="toggle-container",this.rectClassName="toggle-rect",this.imageClassName="toggle-image"}toggle(e){this.modeling.toggleCollapse(e)}onClick(e,t){t.stopPropagation(),this.toggle(e)}clear(e){const t=(0,y.query)("."+this.containerClassName,e);t&&(0,y.remove)(t)}draw(e,t){this.clear(e);const n=t.collapsed?8:24,i={height:30,width:30+n,class:this.containerClassName},s=(0,f.vt)("g",i);(0,f.BC)(e,s);const l=this.elements.getConfig(t).height-i.height;(0,K.pd)(s,t.width-i.width,l,0);const p={height:i.height,width:i.width,fill:"transparent",class:this.rectClassName},g=(0,f.vt)("rect",p);(0,f.BC)(s,g),y.event.bind(s,"click",this.onClick.bind(this,t));const h={height:6,width:10,class:this.imageClassName},C=(0,f.vt)("image",h),m=this.elementToolsConfig.innerTools.toggle,b=t.collapsed?m?.expandImageUrl||u(65070):m?.collapseImageUrl||u(34035);C.setAttributeNS("http://www.w3.org/1999/xlink","href",b),(0,f.BC)(s,C);const w=i.width-h.width-n,S=i.height/2-h.height/2;(0,K.pd)(C,w,S,0)}};It=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("modeling")),(0,r.__param)(1,(0,_.y_)("elements")),(0,r.__param)(2,(0,_.y_)("elementToolsConfig")),(0,r.__metadata)("design:paramtypes",[Object,Object,wt])],It);let un=class extends bt{constructor(e,t,n,i,s){super(e,t),this.outlineFactory=t,this.diagramText=n,this.relationshipRenderingGroup=i,this.relationshipToggleTools=s}drawGroups(e,t){I.isRelationshipItem(t)&&t.canRead!==!1&&this.relationshipRenderingGroup.draw(e,t)}drawToggleTools(e,t){t.hasChildren?this.relationshipToggleTools.draw(e,t):this.relationshipToggleTools.clear(e)}onShapeAdded(e){super.onShapeAdded(e),this.drawGroups(e.gfx,e.element),this.drawToggleTools(e.gfx,e.element)}onShapeChanged(e){super.onShapeChanged(e),this.drawToggleTools(e.gfx,e.element)}};un=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("outlineFactory")),(0,r.__param)(2,d("diagramText")),(0,r.__param)(3,d("relationshipRenderingGroup")),(0,r.__param)(4,d("relationshipToggleTools")),(0,r.__metadata)("design:paramtypes",[Object,jt,se,Mt,It])],un);let mn=class{constructor(e,t,n){this.config=e,this.modeling=t,this.popupMenu=n,this.popupMenu.registerProvider("add",this)}createHeaderEntry(e,t){const n=e.entitySchemaData;return{id:n.name,className:"add-item-button-tool",label:n.caption,action:()=>{this.modeling.addNewConnection({source:t,targetType:e.type}),this.popupMenu.close()}}}getPopupMenuEntries(e){return{}}getHeaderEntries(e){const t=[],n=[M.relationshipContainer,M.relationshipItem];return(0,v.forOwn)(this.config.customDiagramElements,i=>{n.includes(i.type)&&t.push(this.createHeaderEntry(i,e))}),t}};mn=(0,r.__decorate)([(0,r.__param)(0,d("config")),(0,r.__param)(1,d("modeling")),(0,r.__param)(2,d("popupMenu")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object])],mn);let Xe=class{constructor(e,t,n,i,s,a){this.sizeUtils=e,this.diagramUtils=t,this.modeling=n,this.registry=i,this.canvas=s,this.eventBus=a}elementTreeExists(e,t){return e.some(n=>n.some(i=>i.id===t.id))}fillTreeLevel(e,t,n,i){const a=this.getElementChildren(t,n).filter(l=>!this.elementTreeExists(i,l));a.forEach(l=>{this.addTreeElement(e,l,i)}),a.forEach(l=>{this.fillTreeLevel(e+1,l,n,i)})}addTreeElement(e,t,n){t.level=e;const i=Math.abs(e),s=n[i]=n[i]||[];s.map(l=>l.id).includes(t.id)||s.push(t)}getDirectConnections(e){let t=[];return e.connections&&(t=Object.values(e.connections).filter(n=>n.type===M.connection&&n.position!==0)),t}getHorizontalConnections(e){let t=[];return e.connections&&(t=Object.values(e.connections).filter(n=>n.type===M.connection&&n.position===0)),t}getLevelWidth(e){if(!e?.length)return 0;const t=e[e.length-1];return t.x+this.getElementWidth(t)}getElementWidth(e){return this.sizeUtils.getElementSize(e).width}getElementHeight(e){return this.sizeUtils.getElementSize(e).height}getElementChildren(e,t){const n=this.getDirectConnections(t).filter(i=>i.source===e.id).map(i=>t.elements[i.target]);return Array.from(new Set(n))}getTreeWidth(e){let t=0;return e.forEach(n=>{const i=this.getLevelWidth(n);t<i&&(t=i)}),t}getTreeBottomY(e){const n=e[e.length-1][0];return n.y+this.getElementHeight(n)}fixTreePositionX(e,t){const n=this.getTreeWidth(t);t.forEach(i=>{const s=this.getLevelWidth(i),a=(n-s)/2;i.forEach(l=>{l.x+=a,Object.values(e.elements).filter(g=>String(g.parent)===l.id).forEach(g=>g.x+=a)})})}getContainerChildren(e,t){return Object.values(t.elements).filter(n=>String(n.parent)===e.id)}fillContainerTreePosition(e,t){const n=this.getContainerChildren(e,t);if(e.hasChildren=n.length>0,e.hasChildren){const i=G.getSpacing(M.relationshipContainer),s=i.x,a=i.y,l=this.buildTree(t,n);this.fillTreePosition(t,l,e.x+s,e.y+a);const p=this.getTreeWidth(l),g=this.getTreeBottomY(l);e.expandedWidth=p-e.x+s,e.expandedHeight=g-e.y+a,this.fixTreePositionX(t,l)}}fillTreePosition(e,t,n=0,i=0){const s=G.getSpacing(M.relationshipItem);let a=i;for(const l of t){let p=n,g=0;for(const m of l){m.x=p,m.y=a,this.fillContainerTreePosition(m,e),p+=this.getElementWidth(m)+s.x;const b=this.getElementHeight(m);g=Math.max(g,b)}const h=Object.values(e.elements).filter(I.isRootItem),C=this.getHorizontalElements(e,h);this.fixOnlyChildByParents(e,l,C),a+=g+s.y}}fixOnlyChildByParents(e,t,n){let i=0,s=0,a=!1;const l=Object.values(e.elements),p=this.getDirectConnections(e);do{for(const g of t){const h=p.filter(m=>m.target===g.id);if(h.length===1){const m=h[0];if(!n.includes(m.target)){const b=m.source,w=l.find(T=>T.id===b);if(!this.hasLevelIntercept(w.x,g,t)){const T=w.x||0;T!==g.x&&(this.changeElementX(g,T,e),s++)}}}}a=i!==s,i=s}while(s<t.length&&a)}changeElementX(e,t,n){const i=t-e.x;e.x=t,I.isRelationshipContainer(e)&&this.getContainerChildren(e,n).forEach(a=>a.x+=i)}hasLevelIntercept(e,t,n){const i=n.map(h=>({id:h.id,x:h.id===t.id?e:h.x,type:h.type,width:this.getElementWidth(h)}));if(i.find(h=>h.id!==t.id&&h.x===t.x))return!0;i.sort((h,C)=>h.x-C.x);const a=i.findIndex(h=>h.id===t.id),l=i[a-1],p=G.getSpacing(M.relationshipItem);if(l){const h=l.x+l.width+p.x;if(e<=h)return!0}const g=i[a+1];if(g){const h=i[a];if(h.x+h.width+p.x>=g.x)return!0}return!1}getHorizontalElements(e,t){const n=new Set;return this.getHorizontalConnections(e).forEach(s=>{n.add(s.source),n.add(s.target)}),Array.from(n).filter(s=>t.find(a=>a.id===s))}buildSubTree(e,t,n,i,s,a){this.addTreeElement(s,e.elements[t],i),n.push(t),this.getDirectConnections(e).filter(l=>(a<0?l.target:l.source)===t).map(l=>a<0?l.source:l.target).filter(l=>!n.includes(l)).forEach(l=>{this.buildSubTree(e,l,n,i,s+a,a)})}mergeTrees(e){const t=this.flat(e).map(l=>l.level),n=Math.min(...t),i=Math.max(...t),s=-n;e.forEach(l=>{l.forEach(p=>{p.forEach(g=>{g.levelFixed||(g.level+=s,g.levelFixed=!0)})})});const a=new Array(i-n+1).fill(0).map(()=>[]);return e.forEach(l=>{l.forEach(p=>{p.forEach(g=>{const h=g.level,C=a[h];C.every(m=>m.id!==g.id)&&C.push(g)})})}),a}flat(e){return e.flat(1/0)}addSingleItems(e,t,n){const i=this.flat(n).map(s=>s.id);t.filter(s=>!i.includes(s.id)).forEach(s=>{this.addTreeElement(0,s,n),this.fillTreeLevel(1,s,e,n)})}buildTree(e,t){let n=[];const i=this.getHorizontalElements(e,t);if(i.length>0){const s=[],a=[...i];i.forEach(l=>{let p=!1;const g=[];this.buildSubTree(e,l,a,g,0,-1);const h=this.flat(g);if(h.length>1){const b=Math.min(...h.map(w=>w.level));g.reverse(),g.forEach((w,S)=>{w.forEach(T=>T.level=b+S)}),s.push(g),p=!0}const C=[];this.buildSubTree(e,l,a,C,0,1),(this.flat(C).length>1||!p)&&s.push(C)}),n=this.mergeTrees(s),this.addSingleItems(e,t,n)}else{const s=this.getDirectConnections(e),a=t.filter(l=>s.every(p=>p.target!==l.id));for(const l of a)this.addTreeElement(0,l,n),this.fillTreeLevel(1,l,e,n)}return n}getElements(){const e={};return this.registry.getFlowNodes().forEach(n=>{const i=this.sizeUtils.getElementSize(n);e[n.id]={id:n.id,originalId:n.originalId,type:n.type,parent:n.parent?.id,collapsed:n.collapsed,single:n.single,canRead:n.canRead,...i}}),e}getConnections(){const e={};return this.registry.getFlows().forEach(n=>{const i=n.realTarget||n.target,s=n.realSource||n.source;e[n.id]={id:n.id,originalId:n.originalId,type:n.type,target:i.id,source:s.id,position:n.position}}),e}getDiagramData(){const e={};return e.elements=this.getElements(),e.connections=this.getConnections(),e}fixElementsPosition(e){this.registry.getFlowNodes().forEach(n=>{const i=e.elements[n.id],s={x:i.x-n.x,y:i.y-n.y};(s.x||s.y)&&this.modeling.moveShape(n,s)})}hideConnections(){this.registry.getFlows().forEach(t=>{t.hidden=!0})}updateAllConnections(e){const t=Object.values(e.connections),n=t.filter(s=>!I.isIndirectConnection(s));this.updateConnections(n);const i=t.filter(I.isIndirectConnection);this.updateConnections(i)}updateConnections(e){e.forEach(({id:t,source:n,target:i})=>{const s=this.registry.get(t);let a=this.registry.get(n),l=this.registry.get(i);[a,l]=this.modeling.updateConnectionInfo(s,s.parent,a,l),s.source=a,s.target=l,this.modeling.layoutConnection(s,{}),this.canvas.bringToFrontElement(s);const p=s.labels[0];if(p){const{id:g,caption:h}=p;this.modeling.removeShape(p),this.modeling.createDiagramLabel({id:g,value:{caption:h,parent:t}})}})}calculateElementsPosition(e){const t=Object.values(e.elements).filter(I.isRootItem),n=this.buildTree(e,t);this.fillTreePosition(e,n)}updateElements(){this.hideConnections();const e=this.getDiagramData();this.calculateElementsPosition(e),this.fixElementsPosition(e),this.updateAllConnections(e)}};Xe=(0,r.__decorate)([(0,r.__param)(0,d("relationshipSizeUtils")),(0,r.__param)(1,d("diagramUtils")),(0,r.__param)(2,d("modeling")),(0,r.__param)(3,d("elementRegistry")),(0,r.__param)(4,d("canvas")),(0,r.__param)(5,d("eventBus")),(0,r.__metadata)("design:paramtypes",[G,I,Object,ye,Object,Object])],Xe);class os extends ct{constructor(){super(...arguments),this.highlightClassName="highlight"}get supportHighlight(){return!0}bringToFront(){}}let fn=class extends ht{constructor(e,t,n,i,s){super(e,t,n,i),this.eventBus=e,this.overlays=t,this.rules=n,this.canvas=i,this.utils=s,this.oneColumnMode=!0,this.elementDataActionAttributeName="data-action"}canOpen(e){return e.canRead===!1||this.utils.isFlow(e)&&(e.source.canRead===!1||e.target.canRead===!1)?!1:super.canOpen(e)}fixEntries(e){return e}addEntriesContainer(e){const t=super.addEntriesContainer(e);return this.sortContainersEntries(t)}sortContainersEntries(e){return this.getSortedContainersEntries(e).forEach(n=>{e.removeChild(n),e.appendChild(n)}),e}getSortedContainersEntries(e){const t=this.getEntriesOrder(),n=Array.from(e.children);return n.sort((i,s)=>{const a=i.getAttribute(this.elementDataActionAttributeName),l=s.getAttribute(this.elementDataActionAttributeName),p=t.get(a),g=t.get(l);return p>g?1:-1}),n}getEntriesOrder(){const e="add",t="connect",n="delete";return new Map([[e,0],[t,1],[n,2]])}};fn=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("overlays")),(0,r.__param)(2,d("rules")),(0,r.__param)(3,d("canvas")),(0,r.__param)(4,d("diagramUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object])],fn);let yn=class extends Q{constructor(e,t,n,i,s,a,l,p,g,h){super(e,t,n,i,s,a,l,p,g),this.eventBus=e,this.elementFactory=t,this.commandStack=n,this.canvas=i,this.registry=s,this.diagramText=a,this.elements=l,this.rules=p,this.diagramUtils=g,this.sizeUtils=h,this.convertUtils=new dt(g)}getElementAttributes(e,t,n){const i=super.getElementAttributes(e,t,n),{subCaption:s,collapsed:a,groups:l,info:p,expandedWidth:g,expandedHeight:h,hidden:C,originalId:m,hasChildren:b,single:w,canRead:S,position:T}=t;return{...i,subCaption:s,collapsed:a,groups:l,info:p,expandedWidth:g,expandedHeight:h,hidden:C,originalId:m,hasChildren:b,single:w,canRead:S,position:T}}createDiagramElement(e,t){const n=t[e],i=t[n.parent];i&&i.collapsed&&(n.hidden=!0);const{width:s,height:a}=this.sizeUtils.getElementSize(n);n.width=s,n.height=a,super.createDiagramElement(e,t)}removeConnection(e,t={}){super.removeConnection(e);const n=this.getElement(e);this.eventBus.fire("diagram.connection.delete",{element:n},t)}createConnection(e,t,n,i,s,a){if(typeof n=="object"&&(a=s,s=i,i=n,n=void 0),i?.type!==M.parentConnection)return[e,t,s]=this.updateConnectionInfo(i,s,e,t),super.createConnection(e,t,n,i,s,a)}updateConnectionInfo(e,t,n,i){let s;switch(e.hidden=!1,e.type){case M.connection:[n,i].every(I.isRelationshipItem)&&(t=n.parent,t.collapsed&&(e.hidden=!0));break;case M.indirectConnection:if(e.realSource=n,e.realTarget=i,[n,i]=[n,i].map(a=>a.hidden?a.parent:a),s=e.hidden,n.id===i.id?(n=e.realSource,i=e.realTarget,e.hidden=!0):e.hidden=!1,e.hidden!==s&&e.label){const a=this.registry.getGraphics(e.label),l=e.hidden?"none":"block";(0,f.CF)(a,"display",l)}break;default:break}return[n,i,t]}addNewConnection(e){this.eventBus.fire("diagram.connection.adding",e)}getHandlers(){return super.getHandlers()}positionViewboxRelativeToElement(e){const t=this.canvas.viewbox(),n=(0,Fe.U7)(e),i={x:Math.round(n.x+n.width/2-t.outer.width/2),y:n.y-130,width:t.outer.width,height:t.outer.height};this.canvas.viewbox(i),this.canvas.zoom(t.scale)}};yn=(0,r.__decorate)([(0,r.__param)(0,d("eventBus")),(0,r.__param)(1,d("elementFactory")),(0,r.__param)(2,d("commandStack")),(0,r.__param)(3,d("canvas")),(0,r.__param)(4,d("elementRegistry")),(0,r.__param)(5,d("diagramText")),(0,r.__param)(6,d("elements")),(0,r.__param)(7,d("rules")),(0,r.__param)(8,d("diagramUtils")),(0,r.__param)(9,d("relationshipSizeUtils")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,R,Object,I,G])],yn);var ss=u(40969);let Cn=class extends ss.A{constructor(e,t,n){super(e,t),this.eventBus=e,this.registry=t,this.selection=n}updateContainments(){}update(e,t,n){super.update(e,t,n),t?.hidden&&this.selection.deselect(t)}};Cn=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("eventBus")),(0,r.__param)(1,(0,_.y_)("elementRegistry")),(0,r.__param)(2,(0,_.y_)("selection")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object])],Cn);var as=u(44394),Et=u(78626);let vn=class extends as.A{constructor(e,t,n,i){super(e,t,i),this.elementRegistry=e,this.eventBus=t,this.sizeUtils=n,this.config=i}snapValue(e,t,n=Et.E){let i=0;t&&t.offset&&(i=t.offset),e+=i,e=(0,Et.y)(e,n);let s,a;return t&&t.min&&(s=t.min,(0,E.isNumber)(s)&&(s=(0,Et.y)(s+i,n,"ceil"),e=Math.max(e,s))),t&&t.max&&(a=t.max,(0,E.isNumber)(a)&&(a=(0,Et.y)(a+i,n,"floor"),e=Math.min(e,a))),e-=i,e}};vn=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("elementRegistry")),(0,r.__param)(1,(0,_.y_)("eventBus")),(0,r.__param)(2,(0,_.y_)("relationshipSizeUtils")),(0,r.__param)(3,(0,_.y_)("config")),(0,r.__metadata)("design:paramtypes",[Object,Object,G,Object])],vn);let xn=class{constructor(e,t,n){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.SHOW_GROUPS_CLASS="show-groups",this.FADE_ITEM_CLASS="fade-item",this.subscribeEvents()}subscribeEvents(){this.eventBus.on("selection.changed",this.onSelectionChanged.bind(this)),this.eventBus.on("relationshipGroup.highlight.changed",this.onGroupHighlightChanged.bind(this))}onGroupHighlightChanged(e){const t=e.id;this.clearHighlights(),t&&this.highlightItemsByGroupId(t)}onSelectionChanged(e){this.clearHighlights();const t=e.newSelection;if(t.length===1){const n=t[0];I.isRelationshipItem(n)&&n.groups?.length&&this.showGroupsByItem(n)}}removeMarkers(e){this.canvas.removeMarker(e,this.SHOW_GROUPS_CLASS),this.canvas.removeMarker(e,this.FADE_ITEM_CLASS)}showGroupsByItem(e){const t=e.groups,n=this.getAllItems(),i=this.getGroupIds(t);n.forEach(s=>{this.getGroupIds(s.groups).some(p=>i.includes(p))?this.showItemGroups(s):this.fadeItem(s)})}getAllItems(){return this.elementRegistry.filter(e=>I.isRelationshipItem(e))}getGroupIds(e){return e.map(t=>t.id)}showItemGroups(e){this.addMarker(e,this.SHOW_GROUPS_CLASS)}addMarker(e,t){this.canvas.addMarker(e,t)}fadeItem(e){this.addMarker(e,this.FADE_ITEM_CLASS)}clearHighlights(){this.getAllItems().forEach(e=>{this.removeMarkers(e)})}highlightItemsByGroupId(e){this.getAllItems().forEach(n=>{n.groups.some(s=>e===s.id)?this.showItemGroups(n):this.fadeItem(n)})}};xn=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("eventBus")),(0,r.__param)(1,(0,_.y_)("canvas")),(0,r.__param)(2,(0,_.y_)("elementRegistry")),(0,r.__metadata)("design:paramtypes",[Object,Object,Object])],xn);let bn=class extends vt{constructor(e,t,n,i,s){super(e,s),this.connectionDocking=e,this.elements=t,this.registry=n,this.sizeUtils=i,this.config=s}getRelationItemConnectPoint(e,t){const n=this.elements.getConfig(e),i=I.isIndirectConnection(t)||e.collapsed===!1,s=i?e.width:n.imageWidth,a=i?e.height:n.imageHeight;return{x:e.x+s/2,y:e.y+a/2}}getLines(e){const t=[];for(let n=0;n<e.length-1;n++){const i=e[n],s=e[n+1],a=i.x<=s.x&&i.y<=s.y?{first:{x:i.x,y:i.y},second:{x:s.x,y:s.y}}:{first:{x:s.x,y:s.y},second:{x:i.x,y:i.y}};t.push(a)}return t}intersect(e,t,n,i,s,a,l,p){const g=Math.max(e,s),h=Math.min(i,p),C=Math.min(n,l),m=Math.max(t,a),b=C-g,w=h-m;return b<=0||w<=0?0:b*w}intersectElements(e,t){const i=this.getLines(e);for(const s of i)for(const a of t){const{width:l,height:p}=this.elements.getConfig(a),g=s.first.x,h=s.first.y,C=s.second.x+.01,m=s.second.y+.01,b=a.x+2,w=a.y+2,S=a.x+l-2,T=a.y+p-2;if(this.intersect(g,h,C,m,b,w,S,T))return!0}return!1}samePoint(e,t){return e.x===t.x&&e.y===t.y}similarLines(e,t){const n=this.getLines(e);for(const i of t){const s=this.getLines(i.waypoints);if(JSON.stringify(n)===JSON.stringify(s)||(s.reverse(),JSON.stringify(n)===JSON.stringify(s)))return!0}return!1}intersectPoints(e,t){const n=this.getLines(e);for(const i of n)for(const s of t){const a=this.getLines(s.waypoints);for(const l of a)if(this.samePoint(i.first,l.first)||this.samePoint(i.first,l.second)||this.samePoint(i.second,l.first)||this.samePoint(i.second,l.second))return!0}return!1}buildWaypoints(e,t,n,i,s,a){const l=$e.Z9(t,n,i,s,a),p=Object.assign(e);return p.waypoints=$e.d7(l),this.connectionDocking.getCroppedWaypoints(p,t,n)}getLayouts(e=!1){return[...e?["v:v","h:h"]:["h:h","v:v"],"h:v","v:h","b:b","t:t","l:l","r:r","l:t","l:r","l:b","t:l","t:r","t:b","r:l","r:t","r:b","b:l","b:t","b:r"]}indirectConnectionLayouts(){return this.getLayouts()}horizontalConnectionLayouts(){return this.getLayouts()}directConnectionLayouts(){return this.getLayouts(!0)}buildSmartConnection(e,t,n,i,s,a,l,p){let g;const h=this.registry.getFlowNodes().filter(S=>S.hidden!==!0),C=this.registry.getFlows().filter(S=>S.hidden!==!0&&S.id!==e.id);let m=0;const b=[];a.preferredLayouts=[""],g=this.buildWaypoints(e,t,n,i,s,a),b.push({waypoints:g,weight:0});do{const S=l[m];a.preferredLayouts=[S],g=this.buildWaypoints(e,t,n,i,s,a);const T=this.intersectElements(g,h);let B=!1,je=!1;if(!T&&(B=this.similarLines(g,C),!B&&(!p||(je=this.intersectPoints(g,C),!je))))break;const L=+!T+ +!B+ +!je;b.push({waypoints:g,weight:L,layout:S}),m++}while(m<l.length);return m===l.length&&(b.length===1?g=b[0].waypoints:(b.sort((S,T)=>S.weight-T.weight),g=b.slice(-1)[0].waypoints)),g}buildConnection(e,t,n,i,s,a){return this.buildWaypoints(e,t,n,i,s,a)}layoutConnection(e,t={}){const n=t.source||e.source,i=t.target||e.target,s=n&&this.getRelationItemConnectPoint(n,e),a=i&&this.getRelationItemConnectPoint(i,e);let l,p=!0;switch(!0){case I.isIndirectConnection(e):l=this.indirectConnectionLayouts();break;case I.isHorizontalConnection(e):l=this.horizontalConnectionLayouts();break;default:p=!1,l=this.directConnectionLayouts();break}return this.buildSmartConnection(e,n,i,s,a,t,l,p)}};bn=(0,r.__decorate)([(0,r.__param)(0,d("connectionDocking")),(0,r.__param)(1,d("elements")),(0,r.__param)(2,d("elementRegistry")),(0,r.__param)(3,d("relationshipSizeUtils")),(0,r.__param)(4,d("config")),(0,r.__metadata)("design:paramtypes",[Object,R,ye,G,Object])],bn);let _n=class extends mt{constructor(e,t,n,i,s,a,l,p,g,h){super(e,t,n,i,h),this.elementRegistry=e,this.diagramModeling=t,this.elements=n,this.eventBus=i,this.sizeUtils=s,this.canvas=a,this.localStorage=l,this.zoomScroll=p,this.builder=g}fixData(e){e.elements=e.elements||{},e.connections=e.connections||{},e.labels=e.labels||{},e.groups=e.groups||{}}fixIds(e){["elements","connections","labels","groups"].forEach(t=>{let n=e[t]||{};n instanceof Array&&(n=e[t]=Ii().keyBy(n,"id")),Object.keys(n).forEach(i=>{n[i].id!==i&&(n[i].id=i)})})}fixConnectionsDefaults(e){Object.values(e.connections).forEach(t=>{t.type=t.type??M.connection,t.position=t.relationshipType?.position??-1})}formatUniqId(...e){return e.join("_")}fixParents(e){const{elements:t,connections:n,labels:i}=e,s=[],a=[],l=[],p=[];Object.values(n).forEach(L=>{const Pn=t[L.source],On=t[L.target];switch(L.originalId=L.id,L.type){case M.connection:I.isRelationshipContainer(Pn)||I.isRelationshipContainer(On)?s.push(L):a.push(L);break;case M.parentConnection:l.push(L);break;default:p.push(L)}});const g=this.fixItems(l,t),h=this.fixSingleItems(t,n),m=[...this.fixContainers(g,t),...g,...h],b=this.fixItemsConnections(a,g),w=this.fixItemsConnections(a,h),S=this.fixConnections(p,m),T=this.fixConnections(l,m),B=[...s,...b,...w,...T,...S];this.sortConnectionsOrder(B);const je=this.fixLabels(i,B);e.elements={},e.connections={},e.labels={},m.forEach(L=>e.elements[L.id]=L),B.forEach(L=>e.connections[L.id]=L),je.forEach(L=>e.labels[L.id]=L)}sortConnectionsOrder(e){e.sort((t,n)=>this.getConnectionOrder(t)-this.getConnectionOrder(n))}getConnectionOrder(e){let t;return I.isIndirectConnection(e)?t=3:I.isHorizontalConnection(e)?t=1:t=2,t}fixSingleItemIncludeIntoContainer(e,t){const n=Object.values(e).filter(I.isRelationshipItem),i=Object.values(t);return n.forEach(s=>{const l=i.filter(p=>s.id===p.target).every(p=>!(p.relationshipType?.includeIntoContainer??!0));s.single=l}),n.filter(s=>s.single)}fixContainers(e,t){const n=Object.values(t).filter(I.isRelationshipContainer);return n.forEach(i=>{i.originalId=i.id,i.hasChildren=e.some(s=>s.parent===i.id)}),n}fixItems(e,t){const n=[];return Array.from(new Set(e.map(s=>s.target))).forEach(s=>{e.filter(l=>l.target===s).forEach(({source:l})=>{const p=Object.assign({},t[s],{id:this.formatUniqId(s,l),originalId:s,parent:l});n.push(p)})}),n}fixSingleItems(e,t){return this.fixSingleItemIncludeIntoContainer(e,t),this.fixSingleItemOriginal(e)}fixSingleItemOriginal(e){const n=Object.values(e).filter(I.isRelationshipItem).filter(i=>i.single);return n.forEach(i=>{i.originalId=i.id}),n}fixItemsConnections(e,t){const n=[];return e.forEach(i=>{const{id:s,source:a,target:l,position:p}=i;t.filter(h=>h.originalId===a).forEach(h=>{const C=h.parent,m=t.find(b=>b.originalId===l&&b.parent===C);if(m){const b=Object.assign({},i,{id:this.formatUniqId(s,C),originalId:s,source:h.id,target:m.id,position:p});n.push(b)}})}),n}fixConnections(e,t){const n=[];return e.forEach(i=>{const{id:s,source:a,target:l,position:p}=i;t.filter(h=>h.originalId===a).forEach(h=>{t.filter(m=>m.originalId===l).forEach(m=>{const b=Object.assign({},i,{id:this.formatUniqId(s,h.id,m.id),originalId:s,source:h.id,target:m.id,position:p});n.push(b)})})}),n}fixLabels(e,t){const n=[];return Object.values(e).forEach(i=>{t.filter(a=>a.originalId===i.parent).forEach(a=>{const l=Object.assign({},i,{id:this.formatUniqId(i.id,a.id),originalId:i.id,parent:a.id});n.push(l)})}),n}mapGroupInfo(e){Object.values(e.elements).filter(t=>I.isRelationshipItem(t)).forEach(t=>{const i=(t.groups||[]).map(s=>{const a=typeof s=="object",l=a?s.id:s,p=a?s.comment:null;return{id:l,itemComment:p}});t.groups=i.map(s=>Object.assign({itemComment:s.itemComment},e.groups[s.id]))})}setContainersCollapsed(e){const t=Object.values(e.elements);t.filter(n=>I.isRelationshipContainer(n)).forEach(n=>{const i=t.filter(s=>s.parent===n.id);e.rootElementId&&i.some(s=>s.recordId===e.rootElementId)?n.collapsed=!1:n.collapsed=n.collapsed??!0})}getConnectionAttributes(e,t){return{...super.getConnectionAttributes(e,t),realSource:t.realSource,realTarget:t.realTarget,position:t.position}}load(e,t,n){var i=()=>super.load,s=this;return(0,j.A)(function*(){return s.fixData(e),s.fixIds(e),s.fixConnectionsDefaults(e),s.fixParents(e),s.mapGroupInfo(e),s.setContainersCollapsed(e),s.sizeUtils.loadContainersState(e),s.builder.calculateElementsPosition(e),i().call(s,e,t,n)})()}};_n=(0,r.__decorate)([(0,r.__param)(0,d("elementRegistry")),(0,r.__param)(1,d("modeling")),(0,r.__param)(2,d("elements")),(0,r.__param)(3,d("eventBus")),(0,r.__param)(4,d("relationshipSizeUtils")),(0,r.__param)(5,d("canvas")),(0,r.__param)(6,d("localStorage")),(0,r.__param)(7,d("zoomScroll")),(0,r.__param)(8,d("builder")),(0,r.__metadata)("design:paramtypes",[Object,Q,R,Object,G,Object,ae,Object,Xe,_.gP])],_n);var rs=u(6587);class ls extends rs.A{}const St={Connection:{PathStrokeWidth:1,MarkerFillColor:"#4E7BD8",MarkerStrokeColor:"#4E7BD8",StrokeColor:"#4E7BD8"}}.Connection;class wn extends Yn{updateDataItemMarker(e,t,n){const i=n.source,s=n.target;if(i&&s){const a=i.id+"_"+s.id,l=e.elementRegistry.getGraphics(n);(0,f.CF)(l,"data-item-marker",a)}}get endMarker(){const e=(0,f.vt)("path");return(0,f.CF)(e,{d:$.Connection.MarkerShape,"fill-opacity":$.Connection.MarkerfillOpacity,fill:St.MarkerFillColor,stroke:St.MarkerStrokeColor,strokeLinejoin:$.Connection.StrokeLinejoin,strokeWidth:$.Connection.StrokeWidth,class:We.ConnectionEndMarker}),e}getConnectionAttributes(e){const t=super.getConnectionAttributes(e);return Object.assign(t,{stroke:St.StrokeColor,strokeWidth:St.PathStrokeWidth})}drawConnection(e,t,n){const i=super.drawConnection(e,t,n);return this.updateDataItemMarker(e,t,n),i}}class cs extends wn{startMarker(){return this.endMarker}}class ds extends wn{getConnectionAttributes(e){const t=super.getConnectionAttributes(e);return Object.assign(t,{strokeDasharray:"8 8"})}}class pi{drawConnection(e,t,n){}}(0,r.__decorate)([Ze(gs,wn),Ze(ps,ds),Ze(hs,cs),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Object,Object]),(0,r.__metadata)("design:returntype",Object)],pi.prototype,"drawConnection",null);function ps(c,e,t){return I.isIndirectConnection(t)}function gs(c,e,t){return gi(t)&&t.position!==0}function hs(c,e,t){return gi(t)&&t.position===0}function gi(c){return c.type===M.connection}class hi extends Qe{drawConnection(e,t){return super.drawConnection(e,t)}}(0,r.__decorate)([Xn(pi,le.instead),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Object]),(0,r.__metadata)("design:returntype",void 0)],hi.prototype,"drawConnection",null);var ui;let Dt=class extends fe{constructor(e,t,n,i,s,a){super(e,t,n,a),this.elements=e,this.styles=t,this.diagramText=n,this.sizeUtils=i,this.elementRegistry=s,this.eventBus=a,this._borderRadius=8}drawItemBackground(e,t){const n=this.elements.getConfig(t),i=I.isRoot(t.parent)?n.fill:n.fillInParent,{width:s,height:a}=this.sizeUtils.getElementSize(t);this.drawRect(e,s,a,this._borderRadius,0,{fill:i,stroke:"none"})}drawImage(e,t){const n=this.elements.getConfig(t),i=this.styles.style({height:n.imageHeight,width:n.imageWidth,rx:this._borderRadius,ry:this._borderRadius}),s=(0,f.vt)("image",i),a=t.canRead===!1?n.largeImageNoAccess:t.largeImage||n.largeImage;return s.setAttributeNS("http://www.w3.org/1999/xlink","href",a),s.setAttributeNS(null,"type",n.type),s.setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),(0,f.BC)(e,s),s}drawImageBorder(e,t){const n=this.elements.getConfig(t),i=n.height,{imageWidth:s=i,imageHeight:a=i}=n;this.drawRect(e,s,a,this._borderRadius,0,{fill:"none",stroke:n.stroke})}drawText(e,t){const n=this.elements.getConfig(t),i=10,s=10,a=10,l=20,p=90,g=t.subCaption;if(g){const m={box:{height:l,width:n.width-n.imageWidth-s},className:"sub-caption"},b=this.createText(e,g,m);(0,K.pd)(b,n.imageWidth+i,a,0)}const h=t.canRead===!1?n.captionNoAccess:t.caption||"#"+t.id;if(h){const m={box:{height:l,width:n.width-n.imageWidth-s},className:"caption"},b=this.createText(e,h,m);(0,K.pd)(b,n.imageWidth+i,30,0)}const C=t.canRead===!1?"":t.info;if(C){const b=(t.collapsed&&t.expandedWidth?t.expandedWidth:t.width)-n.width+p,w=t.collapsed?p:b,S={box:{height:l,width:w},className:"info"},T=this.createText(e,C,S);(0,K.pd)(T,n.width-p-s,a,0)}}drawItemBorder(e,t){const n=this.elements.getConfig(t),{width:i,height:s}=this.sizeUtils.getElementSize(t);this.drawRect(e,i,s,this._borderRadius,0,{fill:"none",stroke:n.stroke})}updateDataItemMarker(e){const t=e.caption;if(t){const n=this.elementRegistry.getGraphics(e);(0,f.CF)(n,"data-item-marker",t)}}getLockImage(){return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYntzdHJva2U6IzU0NjU3ZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9LmN7c3Ryb2tlOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjExIiBoZWlnaHQ9IjkiIHJ4PSIyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgNS41KSIvPjxnIGNsYXNzPSJiIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg3IDkpIj48cmVjdCBjbGFzcz0iYyIgd2lkdGg9IjIiIGhlaWdodD0iMiIvPjxyZWN0IGNsYXNzPSJhIiB4PSIwLjUiIHk9IjAuNSIgd2lkdGg9IjEiIGhlaWdodD0iMSIvPjwvZz48cGF0aCBjbGFzcz0iYiIgZD0iTS0yNzguNTgxLDM3OC4yNjR2LTIuNWExLjUsMS41LDAsMCwxLDEuNS0xLjVoMmExLjUsMS41LDAsMCwxLDEuNSwxLjV2Mi41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyODQuMDgxIC0zNzIuNzY0KSIvPjwvc3ZnPg=="}drawLockImage(e,t){const a=this.elements.getConfig(t),l=this.styles.style({height:16,width:16,class:"lock-image"}),p=(0,f.vt)("image",l);p.setAttributeNS("http://www.w3.org/1999/xlink","href",this.getLockImage()),p.setAttributeNS(null,"type",a.type),p.setAttributeNS(null,"preserveAspectRatio","none"),(0,f.BC)(e,p);const g=a.width-16-26,h=a.height-16-13;(0,K.pd)(p,g,h,0)}draw(e,t){super.draw(e,t),this.drawItemBackground(e,t);const n=this.drawImage(e,t);return this.drawImageBorder(e,t),this.drawText(e,t),this.drawItemBorder(e,t),this.updateDataItemMarker(t),t.canRead===!1&&((e.parentElement||e.parentNode).classList.add("no-access"),this.drawLockImage(e,t)),n}};Dt=(0,r.__decorate)([(0,r.__param)(0,d("elements")),(0,r.__param)(1,d("styles")),(0,r.__param)(2,d("diagramText")),(0,r.__param)(3,d("relationshipSizeUtils")),(0,r.__param)(4,d("elementRegistry")),(0,r.__param)(5,d("eventBus")),(0,r.__metadata)("design:paramtypes",[R,typeof(ui=typeof re.A<"u"&&re.A)=="function"?ui:Object,Object,G,He,Object])],Dt);let jn=class extends Ye{constructor(e,t,n){super(e,t),this.renderingLabel=e,this.renderingShape=t,this.relationshipRenderingItem=n}create(e){return I.isFlowNode({type:e})?this.relationshipRenderingItem:super.create(e)}};jn=(0,r.__decorate)([(0,r.__param)(0,d("renderingLabel")),(0,r.__param)(1,d("renderingShape")),(0,r.__param)(2,d("relationshipRenderingItem")),(0,r.__metadata)("design:paramtypes",[Object,Object,Dt])],jn);var us=u(6705);let Mn=class extends us.A{constructor(e,t,n,i,s){super(e),this.eventBus=e,this.modeling=t,this.sizeUtils=n,this.builder=i,this.registry=s,this.subscribeEvents()}subscribeEvents(){this.postExecuted(["shape.toggleCollapse"],A.LOW,e=>{this.sizeUtils.saveContainersState();const t=e.context.shape;this.resizeContainer(t)})}resizeContainer(e){const{width:t,height:n}=this.sizeUtils.getElementSize(e),{x:i,y:s}=e,a={x:i,y:s,width:t,height:n};if(this.modeling.resizeShape(e,a,null,{autoResize:!0}),this.builder.updateElements(),e.collapsed){const l=this.registry.getGraphics(e);this.eventBus.fire("element.out",{gfx:l,element:e})}}};Mn=(0,r.__decorate)([(0,r.__param)(0,(0,_.y_)("eventBus")),(0,r.__param)(1,(0,_.y_)("modeling")),(0,r.__param)(2,(0,_.y_)("relationshipSizeUtils")),(0,r.__param)(3,(0,_.y_)("builder")),(0,r.__param)(4,(0,_.y_)("elementRegistry")),(0,r.__metadata)("design:paramtypes",[Object,Object,G,Xe,ye])],Mn);const In={..._t,diagramRules:["type",Ke],renderingShapeFactory:["type",jn],relationshipRenderingItem:["type",Dt],relationshipRenderingGroup:["type",Mt],outlineFactory:["type",jt],layouter:["type",bn],outline:["type",un],selection:["type",ls],diagramRenderer:["type",hi],diagramUtils:["type",I],modeling:["type",yn],diagramLoader:["type",_n],contextPadProvider:["type",hn],relationshipGroupHighlight:["type",xn],relationshipToggleTools:["type",It],relationshipToggleHandler:["type",Mn],relationshipSizeUtils:["type",G],elementToolsConfig:["type",wt],builder:["type",Xe],addMenuProvider:["type",mn],connectionHighlight:["type",os],contextPad:["type",fn],graphicsFactory:["type",Cn],elementRegistry:["type",ye],gridSnapping:["type",vn]};In.__depends__=[..._t.__depends__],In.__init__=[..._t.__init__,"relationshipGroupHighlight","relationshipToggleHandler","relationshipSizeUtils","builder","addMenuProvider","gridSnapping"];const mi=In;class ms extends Un{generateId(e){return _.nF.generateUUID()}}var fi=u(27397),yi=u(36943),Ci=u(6503),fs=u(15192);class De{getFeatureValues(e){return(0,x.of)([]).subscribe(()=>e({}))}static{this.\u0275fac=function(t){return new(t||De)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac})}}class qe{get data(){return this.diagramData}set data(e){this.diagramData=e}get diagram(){return this.internalDiagram}set diagram(e){this.internalDiagram=e}getDiagramDataId(){return this.diagramData?this.diagramData.id:null}getDiagramDataCaption(){return this.diagramData?this.diagramData.caption:null}hasDiagramData(){return!!this.diagramData}static{this.\u0275fac=function(t){return new(t||qe)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:qe,factory:qe.\u0275fac,providedIn:"root"})}}const ys=["diagramContainer"],Cs=["resetZoomButton"];class Pe{set _isReadOnly(e){this.isReadOnly=e==="true"}set _isStraightConnection(e){this.isStraightConnection=e==="true"}set _isRtl(e){this.isRtl=e==="rtl"}get diagramEventHandlerController(){return this.get("diagramEventHandlerController")}get _diagramLoader(){return this.get("diagramLoader")}get modeling(){return this.get("modeling")}constructor(e){this.injector=e,this._initScale=1,this._unloaded$=new x.Subject,this._defaultTool="arrow",this.isRtl=!1,this.destroyed$=new x.Subject,this.initScroll={x:0,y:0},this.loaded=new x.Subject,this.loading=!0,this.elementDblClick=new o.EventEmitter,this.elementSelected=new o.EventEmitter,this.diagramInitialized=new o.EventEmitter,this.afterViewInit=new o.EventEmitter,this.loadProgress$=new x.Subject,this.isReadOnly=!1,this.isStraightConnection=!1,this.injectDependencies()}_initDiagram(e){this.diagramContainer=new o.ElementRef(document.querySelector(".diagram-container")),this.diagram=new fs.A({canvas:{container:this.diagramContainer.nativeElement},keyboard:{bindTo:window},modules:[this.features,{loggerService:["value",this.loggerService]}],isReadOnly:this.isReadOnly,isStraightConnection:this.isStraightConnection,isRtl:this.isRtl,popupMenu:{scale:{min:1,max:1}},contextPad:{scale:{min:1,max:1}},initScroll:this.initScroll,initScale:this._initScale,...e}),this.diagramDataService.diagram=this.diagram,this.diagramEventHandlerController.service=this.service;const t=this.get("canvas"),n=this.get("editorActions"),i=this.get("elementFactory"),s=this.get("eventBus");s.fire("attach",{}),s.fire("editorActions.init",{editorActions:n});const a=i.createRoot({id:Se.root.id});t.setRootElement(a),this.tool=this._defaultTool,this._serviceSubscriptions=this._subscribeService(),this.get("featureProvider").featureService=this.featureService}_setSelectedElement(e){if(e){const t=this.get("eventBus"),i=this.get("elementRegistry").get(e);i&&t.fire("element.click",{element:i})}}_subscribeLoadingData(){var e=this;const t=this.service.startLoading$.subscribe(i=>{this.dataId!==i&&(this.loading=!0)}),n=this.service.endLoading$.pipe((0,O.filter)(i=>i&&this.dataId!==i.id)).subscribe(function(){var i=(0,j.A)(function*(s){e._unloaded$.next(),yield e.loadDiagramData(s)});return function(s){return i.apply(this,arguments)}}());this._serviceSubscriptions.push(t,n),this.diagramInitialized.emit(),this.get("eventBus").fire(N.diagram.initialized)}_getCancellationToken(){const e=new x.Subject;return(0,x.merge)(this.destroyed$,this._unloaded$).subscribe(()=>{e.next(),e.complete()}),e}_subscribeService(){var e=this;const t=this.diagramEventHandlerController.subscribeServerChanges();return t.push(this.service.error$.pipe((0,O.takeUntil)(this.destroyed$),(0,O.debounceTime)(1e3)).subscribe(function(){var n=(0,j.A)(function*(i){yield e.notifyService.error({message:i});const s=e.diagramDataService.getDiagramDataId();e.loggerService.exception(i,{loggerName:"DiagramService"},{diagramDataId:s})});return function(i){return n.apply(this,arguments)}}()),this.service.updateCaption$.subscribe(n=>this._changeCaption(n))),t}_unsubscribeService(){this._serviceSubscriptions&&this._serviceSubscriptions.forEach(e=>e.unsubscribe())}unloadDiagramData(){this.diagram&&(this.get("directEditing").complete(),this._clearDiagram())}initDiagramData(e){var t=this;return(0,j.A)(function*(){t._initLocalStorage(),t._initZoomScroll(),t.diagramEventHandlerController.stopSync(),t.unloadDiagramData();const n=yield t._diagramLoader.load(t.diagramDataService.data,e,t.loadProgress$);if(e.isStopped)return;const i=n&&n[0];i&&(yield t.notifyService.show({message:i})),t.diagramEventHandlerController.startSync()})()}_changeCaption(e){this.caption=e.value}_initLocalStorage(){const e=this.get("localStorage");e.diagramId=this.diagramDataService.getDiagramDataId()}_initZoomScroll(){this.get("zoomScroll").initZoomScroll()}_subscribeDiagramChanges(){const e=this.get("eventBus");e.on(["create.end","connect.end","element.click","shape.move.end"],t=>{this._onSelectedElementChanged(t.element||t.context.shape||t.context.connection)}),e.on(["shape.replaced"],t=>v.defer(()=>this._onSelectedElementChanged(t))),e.on(["selection.changed"],t=>{const n=t.newSelection,i=n.length===1&&n[0];i&&!this.loading&&this._onSelectedElementChanged(i)}),e.on(["tool-manager.update"],t=>this._onToolChanged(t.tool)),e.on(["element.dblclick"],()=>this._elementDblClick())}_elementDblClick(){this.elementDblClick.emit()}_onSelectedElementChanged(e){let t=null;const n={source:this,id:t};e&&e.type!==Se.root.type&&(t=(e.labelTarget||e).id,n.id=t),this.elementSelected.emit(n),this.get("eventBus").fire("diagram.item.selected",{id:t})}_onToolChanged(e){this.tool=e||this._defaultTool}_getLocalizationObject(e){return{get:t=>{const n=t.split(".");let i=e;for(const s of n){if(!i||!i.hasOwnProperty(s))return t;i=i[s]}return i??t}}}_getDiagramLocalizableStrings(e){var t=this;return(0,j.A)(function*(){const n=t.translateService,i=n.getDefaultLang(),s=n.currentLang;let a,l;i===s?l=n.translations[s]?(0,x.of)({...n.translations[s],...n.translations[s]?.diagram}):n.getTranslation(s).pipe((0,O.map)(({diagram:g})=>g)):(a=n.translations?(0,x.zip)((0,x.of)(n.translations[i]),(0,x.of)(n.translations[s])):(0,x.zip)(n.getTranslation(i),n.getTranslation(s)),l=a.pipe((0,O.map)(([g,h])=>v.merge(g?.diagram,h?.diagram))));const p=yield(0,x.lastValueFrom)(l.pipe((0,O.first)()),{defaultValue:null});return t._getLocalizationObject({...p,...e})})()}_reloadDiagram(){var e=this;return(0,j.A)(function*(){const t=yield e._getDiagramConfig();e.diagramDataService.hasDiagramData()&&e._clearDiagram(),e._destroyDiagram(),e._unsubscribeService(),e._initDiagram(t),e._subscribeLoadingData(),e._subscribeDiagramChanges(),e.diagramDataService.hasDiagramData()&&(yield e.initDiagramData(e._getCancellationToken()))})()}_clearDiagram(){this.diagramEventHandlerController.stopSync(),this.diagram.clear()}_destroyDiagram(){this.diagram&&(this.get("eventBus").fire("detach",{}),this.diagram.destroy())}_getDiagramConfig(){var e=this;return(0,j.A)(function*(){const t=yield e.service.getDiagramConfig();return{localizableStrings:yield e._getDiagramLocalizableStrings(t&&t.customLocalizableStrings),...t}})()}injectDependencies(){this.diagramDataService=this.injector.get(qe),this.service=this.injector.get(V),this.translateService=this.injector.get(k.TranslateService),this.notifyService=this.injector.get(Ci.F),this.featureService=this.injector.get(De),this.loggerService=this.injector.get(_.gP),this.features=this.injector.get(at)}loadDiagramData(e){var t=this;return(0,j.A)(function*(){const n=t._getCancellationToken();if(!(t.destroyed$.isStopped||t._unloaded$.isStopped))if(t.diagramDataService.data=e,t.diagramDataService.hasDiagramData()){if(yield t.initDiagramData(n),n.isStopped)return;t.caption=t.diagramDataService.getDiagramDataCaption(),t.loading=!1,t.loaded.next(e.id),t._setSelectedElement(t.elementSelect)}else{t.loading=!1;const i=`Error. Diagram with id = "${e.id}" does not exists`;t.loaded.error(i)}})()}ngOnInit(){this.translateService.onLangChange.pipe((0,O.takeUntil)(this.destroyed$)).subscribe(()=>{this.loading?this.service.endLoading$.pipe((0,O.first)()).subscribe(()=>this._reloadDiagram()):this._reloadDiagram()})}ngAfterViewInit(){var e=this;return(0,j.A)(function*(){const t=yield e._getDiagramConfig();e._initDiagram(t),e._subscribeLoadingData(),e._subscribeDiagramChanges(),e._initZoomScroll(),e.afterViewInit.emit()})()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this._unsubscribeService(),this.diagramDataService.hasDiagramData()&&this.unloadDiagramData(),this._destroyDiagram()}get(e){return this.diagram.get(e)}onHandClick(){this.get("toolManager").setActive(null),this.get("dragging").cancel()}onLassoClick(){this.get("lassoTool").toggle()}onSpaceClick(){this.get("spaceTool").toggle()}onUndoClick(){this.service.undo()}onRedoClick(){this.service.redo()}update(e){this.modeling.updateLabel(e.id,e.value)}static{this.\u0275fac=function(t){return new(t||Pe)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:Pe,selectors:[["ts-app-diagram"]],viewQuery:function(t,n){if(t&1&&(o.\u0275\u0275viewQuery(ys,7,o.ElementRef),o.\u0275\u0275viewQuery(Cs,7,o.ElementRef)),t&2){let i;o.\u0275\u0275queryRefresh(i=o.\u0275\u0275loadQuery())&&(n.diagramContainer=i.first),o.\u0275\u0275queryRefresh(i=o.\u0275\u0275loadQuery())&&(n.resetZoomButton=i.first)}},hostVars:1,hostBindings:function(t,n){t&2&&o.\u0275\u0275attribute("data-qa",n.caption)},inputs:{_isReadOnly:[o.\u0275\u0275InputFlags.None,"readonly","_isReadOnly"],_isStraightConnection:[o.\u0275\u0275InputFlags.None,"straightconnection","_isStraightConnection"],_isRtl:[o.\u0275\u0275InputFlags.None,"dir","_isRtl"],elementSelect:"elementSelect"},outputs:{elementDblClick:"elementDblClick",elementSelected:"elementSelected",diagramInitialized:"diagramInitialized",afterViewInit:"afterViewInit"},decls:2,vars:0,consts:[["diagramContainer",""],[1,"diagram-container"]],template:function(t,n){t&1&&o.\u0275\u0275element(0,"div",1,0)},styles:[`.diagram-container{position:relative;height:100%;width:100%;margin:0}.diagram-container svg{display:block}.djs-container{direction:ltr}.djs-tooltip{border-radius:4px;padding:8px;width:150px;opacity:.9;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:1010}.djs-palette{left:10px;top:10px;border-radius:4px;overflow:hidden;padding-top:6px;padding-bottom:6px}.djs-palette.open,.djs-palette.two-column.open{width:46px}.djs-palette .group{padding:0!important;width:100%}.djs-palette .entry{width:32px;height:32px;line-height:32px;margin-left:6px;cursor:pointer}.djs-palette .entry.active{border-radius:7px}.djs-palette .entry.create-menu:after{content:"";position:absolute;width:0;height:0;border-top:3px solid transparent;border-bottom:3px solid transparent;border-left:3px solid #006ce0;margin-top:13px;margin-left:-4px}.djs-context-pad.open{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;border-radius:4px;pointer-events:auto}.djs-context-pad.open .group{display:grid;grid-template-columns:auto auto;padding:3px}.djs-context-pad.open .group:not(:first-child){padding-left:0}.djs-context-pad.open.one-column-grid .group{grid-template-columns:auto}.djs-context-pad.open .entry{height:32px;width:32px;background:transparent;margin:0;box-shadow:none;border-radius:3px}.djs-context-pad.open .entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}.djs-context-pad.open .entry.noop-entry:hover{background:inherit!important}.djs-context-pad.open .entry img{padding:4px}.entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}@supports ((-webkit-backdrop-filter: none) or (backdrop-filter: none)){.djs-context-pad.open{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background:#ffffffc7}.djs-context-pad.open .entry{background:transparent}}.djs-context-pad{max-width:72px}.djs-element.djs-connection.djs-updating path,.djs-element.djs-connection.selected path,.djs-element.djs-connection.animated path{stroke:#1186d8!important}.djs-element.djs-connection.djs-updating path.connection-end-marker,.djs-element.djs-connection.selected path.connection-end-marker,.djs-element.djs-connection.animated path.connection-end-marker{fill:#1186d8!important}.djs-element.djs-connection.animated path.connection{stroke-width:3!important;stroke-dasharray:20,3;animation:dash 5s linear infinite}@keyframes dash{0%{stroke-dashoffset:115}}.djs-bendpoint .djs-visual{fill:#fff;stroke-width:1px;stroke:#1186d8}.djs-bendpoint.floating .djs-visual{display:none}.djs-bendpoints.hover .djs-visual{stroke:#8095b3}.djs-element.hover .djs-outline{stroke:#a7c6ff}.laneSet.hover .djs-visual,.lane.hover .djs-visual{opacity:initial}.djs-element.selected .djs-outline{stroke:#3168cc}.djs-segment-dragger .djs-visual{fill:transparent;stroke:transparent}.djs-snap-line{stroke-width:1px}.djs-popup{overflow-y:auto;overflow-x:hidden;max-height:calc(100% - 20px);opacity:0;transition:opacity .2s ease-out}.djs-popup .entry{display:flex;flex-direction:row-reverse;justify-content:flex-end;align-items:stretch;padding:5px 7px}.djs-popup .entry img{height:24px;width:24px}.djs-popup .djs-popup-header{display:flex;margin:0 9px}.djs-popup .djs-popup-header .entry.active{border:none}.djs-popup .djs-popup-header .entry:first-child{margin-left:0}.djs-popup .djs-popup-header .entry{height:34px;width:34px;padding:4px;margin:2px 1px 2px 4px}.djs-dragger .djs-visual rect{fill:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border){display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;pointer-events:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border) .djs-direct-editing-content{margin:0 auto;pointer-events:auto;text-align:center}.djs-direct-editing-content{-webkit-user-select:text!important;user-select:text!important;overflow:hidden;outline:none;resize:none}.djs-direct-editing-parent-no-border .djs-direct-editing-content{border:0}.djs-direct-editing-rotate-90{transform:rotate(-90deg);transition:transform .1s ease}.djs-direct-editing-rotate-90 .djs-direct-editing-content{border:none;transition:border .1s ease}.djs-direct-editing-rotate-0{transform:rotate(0)}.djs-text-hidden text{display:none}.djs-text-hidden foreignObject{display:none}.djs-direct-editing-resize-handle{display:none}.djs-shape.connect-ok.textAnnotation .djs-visual>:nth-child(1):not(path),.djs-shape.connect-not-ok.textAnnotation .djs-visual>:nth-child(1):not(path){fill:inherit!important}.djs-element.lane.hover:not(.selected) .djs-outline{stroke:none}.djs-element.laneSet.hover:not(.selected) .djs-outline{stroke:none}foreignObject.djs-label{overflow:visible}.foreign-text-container{display:flex;justify-content:center;height:100%}.laneSet .foreign-text-container,.lane .foreign-text-container{align-items:center}.eventSubProcessExpanded .foreign-text-container{height:initial;padding:5px}.foreign-text{text-align:center;box-sizing:border-box;outline:none;font-family:Open Sans,sans-serif;font-size:12px;font-weight:400;line-height:1.2;overflow-wrap:break-word;white-space:pre-line}.label .foreign-text{max-width:130px;-webkit-user-select:text;user-select:text}.textAnnotation .foreign-text{padding:12px;max-width:none;text-align:left;line-height:1.41667;word-wrap:break-word}.textAnnotation foreignObject{height:100%}.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}@supports (-webkit-line-clamp: 2){.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{vertical-align:center;overflow:hidden;text-overflow:ellipsis;white-space:initial;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}}.foreign-text-helper{max-width:128px;min-height:14.39px;width:-moz-fit-content;width:fit-content;margin:0 auto;overflow-wrap:break-word}.diagram-create-popup-menu{border-top:none!important}.diagram-create-popup-menu .entry{cursor:move}.djs-minimap{position:absolute;right:8px;bottom:11px;width:248px;height:33px;border-radius:4px;opacity:1;overflow:hidden;box-sizing:border-box;-webkit-user-select:none;user-select:none;transition:height .2s cubic-bezier(0,0,.2,1)}.djs-minimap .map-buttons{position:absolute;bottom:0;left:0;right:0;height:32px;display:flex;padding:0 5px;z-index:1}.djs-minimap .map-buttons .map-button{min-width:32px;height:32px;cursor:pointer;line-height:32px;font-size:16px;padding:0 8px;background-position:center;transition:background .8s}.djs-minimap .map-buttons .map-button:active{background-size:100%;transition:background 0s}.djs-minimap .map-buttons .map-button.preview-button{padding:0 12px 0 10px;margin:0 4px 0 0;min-width:40px}.djs-minimap .map-buttons .map-button.zoom-button{width:100%;height:100%;padding:0 16px 0 0;text-align:right}.djs-minimap .map-buttons .map-button.zoom-button:after{content:"";position:absolute;width:0;height:0;right:9px;top:16px}.djs-minimap .map{width:248px;height:148px;margin-bottom:32px;cursor:crosshair}.djs-minimap.open{transition:height .2s cubic-bezier(.18,.89,.32,1.28);height:180px}.djs-minimap.open .overlay{position:absolute;inset:0;pointer-events:none}.djs-minimap .viewport{fill:none;stroke:none}.djs-minimap .viewport-dom{position:absolute;border-radius:2px;box-sizing:border-box;cursor:move}.djs-minimap .cursor-crosshair{cursor:crosshair}.djs-minimap .cursor-move{cursor:move}.djs-popup.zoom{right:8px;bottom:47px;top:inherit!important;left:inherit!important}.djs-popup.zoom .entry{display:flex;flex-direction:row;justify-content:space-between;align-items:stretch}.djs-popup.zoom .entry.entry-separator{padding:0!important;margin:4px 10px!important}#canvas_svg_export{position:absolute;left:50px;top:50px;box-shadow:0 0 9px 2px #0000007a}#canvas_svg_export .close-button{position:absolute;right:8px;width:16px;height:16px;cursor:pointer}
`,`.djs-outline{fill:none;visibility:hidden}.djs-element.hover .djs-outline,.djs-element.selected .djs-outline{visibility:visible;shape-rendering:crispEdges;stroke-dasharray:3,3}.djs-element.selected .djs-outline{stroke:#88f;stroke-width:1px}.djs-element.hover .djs-outline{stroke:#f88;stroke-width:1px}svg.drop-not-ok{background:#f9dee5!important}.djs-connection.connect-ok .djs-visual>:nth-child(1),.djs-connection.drop-ok .djs-visual>:nth-child(1){stroke:#90dd5f!important}.djs-connection.connect-not-ok .djs-visual>:nth-child(1),.djs-connection.drop-not-ok .djs-visual>:nth-child(1){stroke:#e56283!important}.drop-not-ok,.connect-not-ok{cursor:not-allowed}.djs-element.attach-ok .djs-visual>:nth-child(1){stroke-width:5px!important;stroke:#ff7400b3!important}.djs-frame.connect-not-ok .djs-visual>:nth-child(1),.djs-frame.drop-not-ok .djs-visual>:nth-child(1){stroke-width:3px!important;stroke:#e56283!important;fill:none!important}.djs-lasso-overlay{fill:#ff7400;fill-opacity:.1;stroke-dasharray:5 1 3 1;stroke:#ff7400;shape-rendering:crispEdges;pointer-events:none}.djs-resize-overlay{fill:none;stroke-dasharray:5 1 3 1;stroke:#ff7400;pointer-events:none}.djs-resizer-hit{fill:none;pointer-events:all}.djs-resizer-visual{fill:#fff;stroke-width:1px;stroke:#000;shape-rendering:crispEdges;stroke-opacity:.2}.djs-cursor-resize-ns,.djs-resizer-n,.djs-resizer-s{cursor:ns-resize}.djs-cursor-resize-ew,.djs-resizer-e,.djs-resizer-w{cursor:ew-resize}.djs-cursor-resize-nwse,.djs-resizer-nw,.djs-resizer-se{cursor:nwse-resize}.djs-cursor-resize-nesw,.djs-resizer-ne,.djs-resizer-sw{cursor:nesw-resize}.djs-shape.djs-resizing>.djs-outline{visibility:hidden!important}.djs-shape.djs-resizing>.djs-resizer{visibility:hidden}.djs-dragger>.djs-resizer{visibility:hidden}marker.djs-dragger circle,marker.djs-dragger path,marker.djs-dragger polygon,marker.djs-dragger polyline,marker.djs-dragger rect{fill:#ff7400!important;stroke:none!important}marker.djs-dragger text,marker.djs-dragger tspan{fill:none!important;stroke:#ff7400!important}.djs-dragging{opacity:.3}.djs-dragging,.djs-dragging>*{pointer-events:none!important}.djs-dragging .djs-context-pad,.djs-dragging .djs-outline{display:none!important}.djs-visual,.djs-outline{pointer-events:none}.djs-element.attach-ok .djs-hit{stroke-width:60px!important}.djs-element>.djs-hit-all{pointer-events:all}.djs-element>.djs-hit-stroke,.djs-element>.djs-hit-click-stroke{pointer-events:stroke}.djs-drag-active .djs-element>.djs-hit-click-stroke{pointer-events:all}.djs-connection .djs-visual{stroke-width:2px;fill:none}.djs-cursor-grab{cursor:grab}.djs-cursor-grabbing{cursor:grabbing}.djs-cursor-crosshair{cursor:crosshair}.djs-cursor-move{cursor:move}.djs-cursor-resize-ns{cursor:ns-resize}.djs-cursor-resize-ew{cursor:ew-resize}.djs-snap-line{stroke:#ffc342;stroke:#ffc34280;stroke-linecap:round;stroke-width:2px;pointer-events:none}.djs-crosshair{stroke:#555;stroke-linecap:round;stroke-width:1px;pointer-events:none;shape-rendering:crispEdges;stroke-dasharray:5,5}.djs-palette{position:absolute;left:20px;top:20px;box-sizing:border-box;width:48px}.djs-palette .separator{margin:0 5px;padding-top:5px;border:none;border-bottom:solid 1px #DDD;clear:both}.djs-palette .entry:before{vertical-align:text-bottom}.djs-palette .djs-palette-toggle{cursor:pointer}.djs-palette .entry,.djs-palette .djs-palette-toggle{color:#333;font-size:30px;text-align:center}.djs-palette .entry{float:left}.djs-palette .entry img{max-width:100%}.djs-palette .djs-palette-entries:after{content:"";display:table;clear:both}.djs-palette .djs-palette-toggle:hover{background:#666}.djs-palette .entry:hover{color:#ff7400}.djs-palette .highlighted-entry{color:#ff7400!important}.djs-palette .entry,.djs-palette .djs-palette-toggle{width:46px;height:46px;line-height:46px;cursor:default}.djs-palette.two-column.open{width:94px}.djs-palette:not(.open) .djs-palette-entries{display:none}.djs-palette:not(.open){overflow:hidden}.djs-palette.open .djs-palette-toggle{display:none}.djs-overlay-context-pad{width:72px}.djs-context-pad{position:absolute;display:none;pointer-events:none}.djs-context-pad .entry{width:22px;height:22px;text-align:center;display:inline-block;font-size:22px;margin:0 2px 2px 0;border-radius:3px;cursor:default;background-color:#fefefe;box-shadow:0 0 2px 1px #fefefe;pointer-events:all}.djs-context-pad .entry:before{vertical-align:top}.djs-context-pad .entry:hover{background:#fffcb0}.djs-context-pad.open{display:block}.djs-popup .entry{line-height:20px;white-space:nowrap;cursor:default}.djs-popup .entry:before{vertical-align:middle;font-size:20px}.djs-popup .entry>span{vertical-align:middle;font-size:14px}.djs-popup .entry:hover,.djs-popup .entry.active:hover{background:#fffcb0}.djs-popup .entry.disabled{background:inherit}.djs-popup .djs-popup-header .entry{display:inline-block;padding:2px 3px;border:solid 1px transparent;border-radius:3px}.djs-popup .djs-popup-header .entry.active{color:#ff7400;border:solid 1px rgb(255,116,0);background-color:#f6f6f6}.djs-popup-body .entry{padding:4px 10px 4px 5px}.djs-popup-body .entry>span{margin-left:5px}.djs-popup-body{background-color:#fefefe}.djs-popup-header{border-bottom:1px solid #DDD}.djs-popup-header .entry{margin:1px 1px 1px 3px}.djs-popup-header .entry:last-child{margin-right:3px}.djs-popup,.djs-palette{background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-shape,.djs-connection{touch-action:none}.djs-segment-dragger,.djs-bendpoint{display:none}.djs-segment-dragger .djs-visual{fill:#ffff7933;stroke-width:1px;stroke-opacity:1;stroke:#ffff794d}.djs-bendpoint .djs-visual{fill:#ffff79cc;stroke-width:1px;stroke-opacity:.5;stroke:#000}.djs-segment-dragger:hover,.djs-bendpoints.hover .djs-segment-dragger,.djs-bendpoints.selected .djs-segment-dragger,.djs-bendpoint:hover,.djs-bendpoints.hover .djs-bendpoint,.djs-bendpoints.selected .djs-bendpoint{display:block}.djs-drag-active .djs-bendpoints *{display:none}.djs-bendpoints:not(.hover) .floating{display:none}.djs-segment-dragger:hover .djs-visual,.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint:hover .djs-visual,.djs-bendpoint.floating .djs-visual{fill:#ff0;stroke-opacity:.5;stroke:#000}.djs-bendpoint.floating .djs-hit{pointer-events:none}.djs-segment-dragger .djs-hit,.djs-bendpoint .djs-hit{pointer-events:all;fill:none}.djs-segment-dragger.horizontal .djs-hit{cursor:ns-resize}.djs-segment-dragger.vertical .djs-hit{cursor:ew-resize}.djs-segment-dragger.djs-dragging .djs-hit{pointer-events:none}.djs-updating,.djs-updating>*{pointer-events:none!important}.djs-updating .djs-context-pad,.djs-updating .djs-outline,.djs-updating .djs-bendpoint,.connect-ok .djs-bendpoint,.connect-not-ok .djs-bendpoint,.drop-ok .djs-bendpoint,.drop-not-ok .djs-bendpoint{display:none!important}.djs-segment-dragger.djs-dragging,.djs-bendpoint.djs-dragging{display:block;opacity:1}.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint.djs-dragging .djs-visual{fill:#ff0;stroke-opacity:.5}.djs-tooltip-error{font-size:11px;line-height:18px;text-align:left;padding:5px;opacity:.7}.djs-tooltip-error>*{width:160px;background:#fcecf0;color:#9e4c4c;padding:3px 7px;border-radius:5px;border-left:solid 5px rgb(174,73,73)}.djs-tooltip-error:hover{opacity:1}.djs-search-container{position:absolute;top:20px;left:0;right:0;margin-left:auto;margin-right:auto;width:25%;min-width:300px;max-width:400px;z-index:10;font-size:1.05em;opacity:.9;background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-search-container:not(.open){display:none}.djs-search-input input{font-size:1.05em;width:100%;padding:6px 10px;border:1px solid #ccc}.djs-search-input input:focus{outline:none;border-color:#52b415}.djs-search-results{position:relative;overflow-y:auto;max-height:200px}.djs-search-results:hover{cursor:pointer}.djs-search-result{width:100%;padding:6px 10px;background:#fff;border-bottom:solid 1px #AAA;border-radius:1px}.djs-search-highlight{color:#000}.djs-search-result-primary{margin:0 0 10px}.djs-search-result-secondary{font-family:monospace;margin:0}.djs-search-result:hover{background:#fdffd6}.djs-search-result-selected{background:#fffcb0}.djs-search-result-selected:hover{background:#f7f388}.djs-search-overlay{background:#ff0;opacity:.3}.djs-element-hidden,.djs-element-hidden .djs-hit,.djs-element-hidden .djs-outline,.djs-label-hidden .djs-label{display:none!important}
`],encapsulation:2})}}class Oe{static{this.\u0275fac=function(t){return new(t||Oe)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Oe})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[V,De,{provide:at,useValue:_t},_.gP],imports:[P.CommonModule,k.TranslateModule.forChild(),yi.k]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(Oe,{declarations:[Pe],imports:[P.CommonModule,k.TranslateModule,yi.k],exports:[Pe]})})();class Ce extends Pe{constructor(e){super(e),this.initScroll=G.getSpacing("scroll")}ngOnInit(){this.loaded.pipe((0,O.first)()).subscribe(()=>{const e=this.diagramDataService.data;if(!e.rootElementId)return;const t=Object.values(e.elements).find(i=>i.recordId===e.rootElementId);this.get("modeling").positionViewboxRelativeToElement(t)})}static{this.\u0275fac=function(t){return new(t||Ce)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:Ce,selectors:[["crt-relationship-diagram"]],features:[o.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["diagramContainer",""],[1,"diagram-container"]],template:function(t,n){t&1&&o.\u0275\u0275element(0,"div",1,0)},styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.diagram-container .relationship-container .djs-visual .foreign-text{margin-right:20px}.diagram-container .relationship-item .djs-visual .foreign-text{margin-right:10px}.diagram-container .relationship-item .djs-visual image,.diagram-container .relationship-container .djs-visual image{clip-path:inset(0% round 8px)}.diagram-container .relationship-item .djs-visual .foreign-text,.diagram-container .relationship-container .djs-visual .foreign-text{text-align:left;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.diagram-container .relationship-item .djs-visual .sub-caption .foreign-text,.diagram-container .relationship-container .djs-visual .sub-caption .foreign-text{color:#757575!important;font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased}.diagram-container .relationship-item .djs-visual .caption .foreign-text,.diagram-container .relationship-container .djs-visual .caption .foreign-text{color:#004fd6!important;font-family:var(--crt-body-2-font-family);font-size:var(--crt-body-2-font-size);line-height:var(--crt-body-2-line-height);font-weight:var(--crt-body-2-font-weight);letter-spacing:var(--crt-body-2-letter-spacing);text-transform:var(--crt-body-2-text-transform);-webkit-font-smoothing:antialiased}.diagram-container .relationship-item .djs-visual .info .foreign-text-container .foreign-text,.diagram-container .relationship-container .djs-visual .info .foreign-text-container .foreign-text{color:#757575!important;font-size:10px;margin-right:0}.diagram-container .relationship-item.no-access .caption .foreign-text,.diagram-container .relationship-container.no-access .caption .foreign-text{color:#181818!important}.diagram-container .relationship-item.hover:not(.selected) .djs-outline,.diagram-container .relationship-container.hover:not(.selected) .djs-outline{stroke-width:1px!important}.diagram-container .relationship-item .lock-image,.diagram-container .relationship-container .lock-image{display:none}.diagram-container .relationship-item.hover .lock-image,.diagram-container .relationship-item.selected .lock-image,.diagram-container .relationship-container.hover .lock-image,.diagram-container .relationship-container.selected .lock-image{display:block}.diagram-container .relationship-item .group-caption .foreign-text-container .foreign-text,.diagram-container .relationship-container .group-caption .foreign-text-container .foreign-text{color:#fff!important;text-align:center;font-size:10px;height:100%;padding-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.diagram-container .relationship-item.show-groups .group-container,.diagram-container .relationship-container.show-groups .group-container{visibility:visible}.diagram-container .relationship-item.show-groups .group-container .group-item.has-item-comment,.diagram-container .relationship-container.show-groups .group-container .group-item.has-item-comment{cursor:pointer}.diagram-container .relationship-item.fade-item .djs-hit,.diagram-container .relationship-container.fade-item .djs-hit{fill:#ffffffa6!important}.diagram-container .relationship-item .djs-outline,.diagram-container .relationship-container .djs-outline{stroke:#006ce0!important}.diagram-container .relationship-item .group-container,.diagram-container .relationship-container .group-container{visibility:hidden}.diagram-container .relationship-item .toggle-container,.diagram-container .relationship-container .toggle-container,.diagram-container .relationship-item .show-all-group-caption,.diagram-container .relationship-container .show-all-group-caption{cursor:pointer}.diagram-container .relationship-item .show-all-group-caption .foreign-text-container .foreign-text,.diagram-container .relationship-container .show-all-group-caption .foreign-text-container .foreign-text{text-align:center;font-size:9px;height:100%;line-height:18px}.diagram-container .djs-bendpoints .djs-segment-dragger.horizontal .djs-hit,.diagram-container .djs-bendpoints .djs-segment-dragger.vertical .djs-hit{cursor:default}.diagram-container .djs-bendpoints .djs-segment-dragger.horizontal .djs-visual,.diagram-container .djs-bendpoints .djs-segment-dragger.vertical .djs-visual{visibility:hidden}.diagram-container .djs-diagram-popup{position:absolute;visibility:hidden;background:#fff 0% 0% no-repeat padding-box;box-shadow:0 3px 6px #00000029;border-radius:4px;opacity:.92;max-height:230px;overflow-y:auto;padding:8px}.diagram-container .additional-group-container:first-of-type{padding-top:0}.diagram-container .additional-group-container{font-size:11px;letter-spacing:0px;opacity:1;text-align:left;padding:4.5px 0;line-height:15px}.diagram-container .additional-group-container .additional-group-container-header{display:flex;align-items:center}.diagram-container .additional-group-container .additional-group-container-header .additional-group-name{color:#757575;padding-left:5px;text-align:left}.diagram-container .additional-group-container .additional-group-container-header .additional-group-name.has-comment{color:#006ce0}.diagram-container .additional-group-container .additional-group-container-header .comment-icon-gray{margin-left:4px;width:14px;height:14px;background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAALZJREFUOE9jZKAQMFKon4HaBvxnDA1dzYTPVatXh/5jYGD8D1OD4oL48rkHGf4zWeMz4D/D/yOLupIcsBqQUD7//4LORLzeQleDoniYGPD1HjcLLIBQQxwSQ9xKX/8ghxNqLJTN38PAwIAIYUaGgwwMDLMXdCauiCubd4CRgdGGgYHhwMKuRBessYAt+uLL5i1jYGTgYGRgDMQWQ0SlxISy+QH/GRmzF3YmuKJbQpQB+BLWwBsAAB0qUBHT9fFYAAAAAElFTkSuQmCC) 0% 0% no-repeat padding-box;opacity:1}.diagram-container .additional-group-container .additional-group-comment{padding-top:4px;font-size:13px;color:#181818}.diagram-container .group-item-comment{width:262px}.diagram-container .group-item-comment .circle{margin-right:5px}.diagram-container .group-item-comment .caption{color:#757575;margin:0;font-size:11px;font-weight:400}.diagram-container .group-item-comment .item-comment{margin-top:4px;margin-bottom:0;font-size:13px;line-height:15px;padding-right:8px}.diagram-container .circle{box-sizing:border-box;display:inline-block;border-radius:50%;height:8px;width:8px}.diagram-container .djs-popup.add .djs-popup-header{flex-direction:column;width:auto;border-bottom:none}.diagram-container .djs-popup.add .djs-popup-header .entry{margin-left:0}.diagram-container .djs-popup.add .djs-popup-header .entry.add-item-button-tool{width:100%}.diagram-container .djs-element.djs-connection.hover path.connection{stroke-width:2!important}.diagram-container .djs-element.djs-connection.selected path.connection{stroke-width:3!important}.diagram-container .djs-element.label>.djs-hit-all{pointer-events:none}.diagram-container .djs-connection~.djs-children .label .foreign-text{color:#54657d!important}.diagram-container .djs-connection.selected~.djs-children .label .foreign-text{color:#1186d8!important}.diagram-container .djs-element.djs-connection.highlight path.connection{stroke-width:2!important}
`,`.djs-outline{fill:none;visibility:hidden}.djs-element.hover .djs-outline,.djs-element.selected .djs-outline{visibility:visible;shape-rendering:crispEdges;stroke-dasharray:3,3}.djs-element.selected .djs-outline{stroke:#88f;stroke-width:1px}.djs-element.hover .djs-outline{stroke:#f88;stroke-width:1px}svg.drop-not-ok{background:#f9dee5!important}.djs-connection.connect-ok .djs-visual>:nth-child(1),.djs-connection.drop-ok .djs-visual>:nth-child(1){stroke:#90dd5f!important}.djs-connection.connect-not-ok .djs-visual>:nth-child(1),.djs-connection.drop-not-ok .djs-visual>:nth-child(1){stroke:#e56283!important}.drop-not-ok,.connect-not-ok{cursor:not-allowed}.djs-element.attach-ok .djs-visual>:nth-child(1){stroke-width:5px!important;stroke:#ff7400b3!important}.djs-frame.connect-not-ok .djs-visual>:nth-child(1),.djs-frame.drop-not-ok .djs-visual>:nth-child(1){stroke-width:3px!important;stroke:#e56283!important;fill:none!important}.djs-lasso-overlay{fill:#ff7400;fill-opacity:.1;stroke-dasharray:5 1 3 1;stroke:#ff7400;shape-rendering:crispEdges;pointer-events:none}.djs-resize-overlay{fill:none;stroke-dasharray:5 1 3 1;stroke:#ff7400;pointer-events:none}.djs-resizer-hit{fill:none;pointer-events:all}.djs-resizer-visual{fill:#fff;stroke-width:1px;stroke:#000;shape-rendering:crispEdges;stroke-opacity:.2}.djs-cursor-resize-ns,.djs-resizer-n,.djs-resizer-s{cursor:ns-resize}.djs-cursor-resize-ew,.djs-resizer-e,.djs-resizer-w{cursor:ew-resize}.djs-cursor-resize-nwse,.djs-resizer-nw,.djs-resizer-se{cursor:nwse-resize}.djs-cursor-resize-nesw,.djs-resizer-ne,.djs-resizer-sw{cursor:nesw-resize}.djs-shape.djs-resizing>.djs-outline{visibility:hidden!important}.djs-shape.djs-resizing>.djs-resizer{visibility:hidden}.djs-dragger>.djs-resizer{visibility:hidden}marker.djs-dragger circle,marker.djs-dragger path,marker.djs-dragger polygon,marker.djs-dragger polyline,marker.djs-dragger rect{fill:#ff7400!important;stroke:none!important}marker.djs-dragger text,marker.djs-dragger tspan{fill:none!important;stroke:#ff7400!important}.djs-dragging{opacity:.3}.djs-dragging,.djs-dragging>*{pointer-events:none!important}.djs-dragging .djs-context-pad,.djs-dragging .djs-outline{display:none!important}.djs-visual,.djs-outline{pointer-events:none}.djs-element.attach-ok .djs-hit{stroke-width:60px!important}.djs-element>.djs-hit-all{pointer-events:all}.djs-element>.djs-hit-stroke,.djs-element>.djs-hit-click-stroke{pointer-events:stroke}.djs-drag-active .djs-element>.djs-hit-click-stroke{pointer-events:all}.djs-connection .djs-visual{stroke-width:2px;fill:none}.djs-cursor-grab{cursor:grab}.djs-cursor-grabbing{cursor:grabbing}.djs-cursor-crosshair{cursor:crosshair}.djs-cursor-move{cursor:move}.djs-cursor-resize-ns{cursor:ns-resize}.djs-cursor-resize-ew{cursor:ew-resize}.djs-snap-line{stroke:#ffc342;stroke:#ffc34280;stroke-linecap:round;stroke-width:2px;pointer-events:none}.djs-crosshair{stroke:#555;stroke-linecap:round;stroke-width:1px;pointer-events:none;shape-rendering:crispEdges;stroke-dasharray:5,5}.djs-palette{position:absolute;left:20px;top:20px;box-sizing:border-box;width:48px}.djs-palette .separator{margin:0 5px;padding-top:5px;border:none;border-bottom:solid 1px #DDD;clear:both}.djs-palette .entry:before{vertical-align:text-bottom}.djs-palette .djs-palette-toggle{cursor:pointer}.djs-palette .entry,.djs-palette .djs-palette-toggle{color:#333;font-size:30px;text-align:center}.djs-palette .entry{float:left}.djs-palette .entry img{max-width:100%}.djs-palette .djs-palette-entries:after{content:"";display:table;clear:both}.djs-palette .djs-palette-toggle:hover{background:#666}.djs-palette .entry:hover{color:#ff7400}.djs-palette .highlighted-entry{color:#ff7400!important}.djs-palette .entry,.djs-palette .djs-palette-toggle{width:46px;height:46px;line-height:46px;cursor:default}.djs-palette.two-column.open{width:94px}.djs-palette:not(.open) .djs-palette-entries{display:none}.djs-palette:not(.open){overflow:hidden}.djs-palette.open .djs-palette-toggle{display:none}.djs-overlay-context-pad{width:72px}.djs-context-pad{position:absolute;display:none;pointer-events:none}.djs-context-pad .entry{width:22px;height:22px;text-align:center;display:inline-block;font-size:22px;margin:0 2px 2px 0;border-radius:3px;cursor:default;background-color:#fefefe;box-shadow:0 0 2px 1px #fefefe;pointer-events:all}.djs-context-pad .entry:before{vertical-align:top}.djs-context-pad .entry:hover{background:#fffcb0}.djs-context-pad.open{display:block}.djs-popup .entry{line-height:20px;white-space:nowrap;cursor:default}.djs-popup .entry:before{vertical-align:middle;font-size:20px}.djs-popup .entry>span{vertical-align:middle;font-size:14px}.djs-popup .entry:hover,.djs-popup .entry.active:hover{background:#fffcb0}.djs-popup .entry.disabled{background:inherit}.djs-popup .djs-popup-header .entry{display:inline-block;padding:2px 3px;border:solid 1px transparent;border-radius:3px}.djs-popup .djs-popup-header .entry.active{color:#ff7400;border:solid 1px rgb(255,116,0);background-color:#f6f6f6}.djs-popup-body .entry{padding:4px 10px 4px 5px}.djs-popup-body .entry>span{margin-left:5px}.djs-popup-body{background-color:#fefefe}.djs-popup-header{border-bottom:1px solid #DDD}.djs-popup-header .entry{margin:1px 1px 1px 3px}.djs-popup-header .entry:last-child{margin-right:3px}.djs-popup,.djs-palette{background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-shape,.djs-connection{touch-action:none}.djs-segment-dragger,.djs-bendpoint{display:none}.djs-segment-dragger .djs-visual{fill:#ffff7933;stroke-width:1px;stroke-opacity:1;stroke:#ffff794d}.djs-bendpoint .djs-visual{fill:#ffff79cc;stroke-width:1px;stroke-opacity:.5;stroke:#000}.djs-segment-dragger:hover,.djs-bendpoints.hover .djs-segment-dragger,.djs-bendpoints.selected .djs-segment-dragger,.djs-bendpoint:hover,.djs-bendpoints.hover .djs-bendpoint,.djs-bendpoints.selected .djs-bendpoint{display:block}.djs-drag-active .djs-bendpoints *{display:none}.djs-bendpoints:not(.hover) .floating{display:none}.djs-segment-dragger:hover .djs-visual,.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint:hover .djs-visual,.djs-bendpoint.floating .djs-visual{fill:#ff0;stroke-opacity:.5;stroke:#000}.djs-bendpoint.floating .djs-hit{pointer-events:none}.djs-segment-dragger .djs-hit,.djs-bendpoint .djs-hit{pointer-events:all;fill:none}.djs-segment-dragger.horizontal .djs-hit{cursor:ns-resize}.djs-segment-dragger.vertical .djs-hit{cursor:ew-resize}.djs-segment-dragger.djs-dragging .djs-hit{pointer-events:none}.djs-updating,.djs-updating>*{pointer-events:none!important}.djs-updating .djs-context-pad,.djs-updating .djs-outline,.djs-updating .djs-bendpoint,.connect-ok .djs-bendpoint,.connect-not-ok .djs-bendpoint,.drop-ok .djs-bendpoint,.drop-not-ok .djs-bendpoint{display:none!important}.djs-segment-dragger.djs-dragging,.djs-bendpoint.djs-dragging{display:block;opacity:1}.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint.djs-dragging .djs-visual{fill:#ff0;stroke-opacity:.5}.djs-tooltip-error{font-size:11px;line-height:18px;text-align:left;padding:5px;opacity:.7}.djs-tooltip-error>*{width:160px;background:#fcecf0;color:#9e4c4c;padding:3px 7px;border-radius:5px;border-left:solid 5px rgb(174,73,73)}.djs-tooltip-error:hover{opacity:1}.djs-search-container{position:absolute;top:20px;left:0;right:0;margin-left:auto;margin-right:auto;width:25%;min-width:300px;max-width:400px;z-index:10;font-size:1.05em;opacity:.9;background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-search-container:not(.open){display:none}.djs-search-input input{font-size:1.05em;width:100%;padding:6px 10px;border:1px solid #ccc}.djs-search-input input:focus{outline:none;border-color:#52b415}.djs-search-results{position:relative;overflow-y:auto;max-height:200px}.djs-search-results:hover{cursor:pointer}.djs-search-result{width:100%;padding:6px 10px;background:#fff;border-bottom:solid 1px #AAA;border-radius:1px}.djs-search-highlight{color:#000}.djs-search-result-primary{margin:0 0 10px}.djs-search-result-secondary{font-family:monospace;margin:0}.djs-search-result:hover{background:#fdffd6}.djs-search-result-selected{background:#fffcb0}.djs-search-result-selected:hover{background:#f7f388}.djs-search-overlay{background:#ff0;opacity:.3}.djs-element-hidden,.djs-element-hidden .djs-hit,.djs-element-hidden .djs-outline,.djs-label-hidden .djs-label{display:none!important}
`,`.diagram-container{position:relative;height:100%;width:100%;margin:0}.diagram-container svg{display:block}.djs-container{direction:ltr}.djs-tooltip{border-radius:4px;padding:8px;width:150px;opacity:.9;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:1010}.djs-palette{left:10px;top:10px;border-radius:4px;overflow:hidden;padding-top:6px;padding-bottom:6px}.djs-palette.open,.djs-palette.two-column.open{width:46px}.djs-palette .group{padding:0!important;width:100%}.djs-palette .entry{width:32px;height:32px;line-height:32px;margin-left:6px;cursor:pointer}.djs-palette .entry.active{border-radius:7px}.djs-palette .entry.create-menu:after{content:"";position:absolute;width:0;height:0;border-top:3px solid transparent;border-bottom:3px solid transparent;border-left:3px solid #006ce0;margin-top:13px;margin-left:-4px}.djs-context-pad.open{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;border-radius:4px;pointer-events:auto}.djs-context-pad.open .group{display:grid;grid-template-columns:auto auto;padding:3px}.djs-context-pad.open .group:not(:first-child){padding-left:0}.djs-context-pad.open.one-column-grid .group{grid-template-columns:auto}.djs-context-pad.open .entry{height:32px;width:32px;background:transparent;margin:0;box-shadow:none;border-radius:3px}.djs-context-pad.open .entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}.djs-context-pad.open .entry.noop-entry:hover{background:inherit!important}.djs-context-pad.open .entry img{padding:4px}.entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}@supports ((-webkit-backdrop-filter: none) or (backdrop-filter: none)){.djs-context-pad.open{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background:#ffffffc7}.djs-context-pad.open .entry{background:transparent}}.djs-context-pad{max-width:72px}.djs-element.djs-connection.djs-updating path,.djs-element.djs-connection.selected path,.djs-element.djs-connection.animated path{stroke:#1186d8!important}.djs-element.djs-connection.djs-updating path.connection-end-marker,.djs-element.djs-connection.selected path.connection-end-marker,.djs-element.djs-connection.animated path.connection-end-marker{fill:#1186d8!important}.djs-element.djs-connection.animated path.connection{stroke-width:3!important;stroke-dasharray:20,3;animation:dash 5s linear infinite}@keyframes dash{0%{stroke-dashoffset:115}}.djs-bendpoint .djs-visual{fill:#fff;stroke-width:1px;stroke:#1186d8}.djs-bendpoint.floating .djs-visual{display:none}.djs-bendpoints.hover .djs-visual{stroke:#8095b3}.djs-element.hover .djs-outline{stroke:#a7c6ff}.laneSet.hover .djs-visual,.lane.hover .djs-visual{opacity:initial}.djs-element.selected .djs-outline{stroke:#3168cc}.djs-segment-dragger .djs-visual{fill:transparent;stroke:transparent}.djs-snap-line{stroke-width:1px}.djs-popup{overflow-y:auto;overflow-x:hidden;max-height:calc(100% - 20px);opacity:0;transition:opacity .2s ease-out}.djs-popup .entry{display:flex;flex-direction:row-reverse;justify-content:flex-end;align-items:stretch;padding:5px 7px}.djs-popup .entry img{height:24px;width:24px}.djs-popup .djs-popup-header{display:flex;margin:0 9px}.djs-popup .djs-popup-header .entry.active{border:none}.djs-popup .djs-popup-header .entry:first-child{margin-left:0}.djs-popup .djs-popup-header .entry{height:34px;width:34px;padding:4px;margin:2px 1px 2px 4px}.djs-dragger .djs-visual rect{fill:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border){display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;pointer-events:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border) .djs-direct-editing-content{margin:0 auto;pointer-events:auto;text-align:center}.djs-direct-editing-content{-webkit-user-select:text!important;user-select:text!important;overflow:hidden;outline:none;resize:none}.djs-direct-editing-parent-no-border .djs-direct-editing-content{border:0}.djs-direct-editing-rotate-90{transform:rotate(-90deg);transition:transform .1s ease}.djs-direct-editing-rotate-90 .djs-direct-editing-content{border:none;transition:border .1s ease}.djs-direct-editing-rotate-0{transform:rotate(0)}.djs-text-hidden text{display:none}.djs-text-hidden foreignObject{display:none}.djs-direct-editing-resize-handle{display:none}.djs-shape.connect-ok.textAnnotation .djs-visual>:nth-child(1):not(path),.djs-shape.connect-not-ok.textAnnotation .djs-visual>:nth-child(1):not(path){fill:inherit!important}.djs-element.lane.hover:not(.selected) .djs-outline{stroke:none}.djs-element.laneSet.hover:not(.selected) .djs-outline{stroke:none}foreignObject.djs-label{overflow:visible}.foreign-text-container{display:flex;justify-content:center;height:100%}.laneSet .foreign-text-container,.lane .foreign-text-container{align-items:center}.eventSubProcessExpanded .foreign-text-container{height:initial;padding:5px}.foreign-text{text-align:center;box-sizing:border-box;outline:none;font-family:Open Sans,sans-serif;font-size:12px;font-weight:400;line-height:1.2;overflow-wrap:break-word;white-space:pre-line}.label .foreign-text{max-width:130px;-webkit-user-select:text;user-select:text}.textAnnotation .foreign-text{padding:12px;max-width:none;text-align:left;line-height:1.41667;word-wrap:break-word}.textAnnotation foreignObject{height:100%}.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}@supports (-webkit-line-clamp: 2){.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{vertical-align:center;overflow:hidden;text-overflow:ellipsis;white-space:initial;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}}.foreign-text-helper{max-width:128px;min-height:14.39px;width:-moz-fit-content;width:fit-content;margin:0 auto;overflow-wrap:break-word}.diagram-create-popup-menu{border-top:none!important}.diagram-create-popup-menu .entry{cursor:move}.djs-minimap{position:absolute;right:8px;bottom:11px;width:248px;height:33px;border-radius:4px;opacity:1;overflow:hidden;box-sizing:border-box;-webkit-user-select:none;user-select:none;transition:height .2s cubic-bezier(0,0,.2,1)}.djs-minimap .map-buttons{position:absolute;bottom:0;left:0;right:0;height:32px;display:flex;padding:0 5px;z-index:1}.djs-minimap .map-buttons .map-button{min-width:32px;height:32px;cursor:pointer;line-height:32px;font-size:16px;padding:0 8px;background-position:center;transition:background .8s}.djs-minimap .map-buttons .map-button:active{background-size:100%;transition:background 0s}.djs-minimap .map-buttons .map-button.preview-button{padding:0 12px 0 10px;margin:0 4px 0 0;min-width:40px}.djs-minimap .map-buttons .map-button.zoom-button{width:100%;height:100%;padding:0 16px 0 0;text-align:right}.djs-minimap .map-buttons .map-button.zoom-button:after{content:"";position:absolute;width:0;height:0;right:9px;top:16px}.djs-minimap .map{width:248px;height:148px;margin-bottom:32px;cursor:crosshair}.djs-minimap.open{transition:height .2s cubic-bezier(.18,.89,.32,1.28);height:180px}.djs-minimap.open .overlay{position:absolute;inset:0;pointer-events:none}.djs-minimap .viewport{fill:none;stroke:none}.djs-minimap .viewport-dom{position:absolute;border-radius:2px;box-sizing:border-box;cursor:move}.djs-minimap .cursor-crosshair{cursor:crosshair}.djs-minimap .cursor-move{cursor:move}.djs-popup.zoom{right:8px;bottom:47px;top:inherit!important;left:inherit!important}.djs-popup.zoom .entry{display:flex;flex-direction:row;justify-content:space-between;align-items:stretch}.djs-popup.zoom .entry.entry-separator{padding:0!important;margin:4px 10px!important}#canvas_svg_export{position:absolute;left:50px;top:50px;box-shadow:0 0 9px 2px #0000007a}#canvas_svg_export .close-button{position:absolute;right:8px;width:16px;height:16px;cursor:pointer}
`],encapsulation:2})}}class Te{static{this.\u0275fac=function(t){return new(t||Te)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Te})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[V,{provide:at,useValue:mi}],imports:[P.CommonModule,Oe,k.TranslateModule.forChild(),st.P,fi.RouterModule.forChild([])]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(Te,{declarations:[Ce],imports:[P.CommonModule,Oe,k.TranslateModule,st.P,fi.RouterModule],exports:[Ce]})})();var vs=u(23092),En=u(79017),vi=u(41108);class ce{static{this.formal={id:"56d730bf-27f5-42d9-83df-183df2ec06a1",name:"Formal"}}static{this.notFormal={id:"6d1d2243-d4de-4d64-aab4-23eed4021a60",name:"Not formal"}}}class ke{static{this.AddElement="AddElement"}static{this.EditConnection="EditConnection"}static{this.DeleteElement="DeleteElement"}static{this.AddGroup="AddGroup"}static{this.AddEntityInGroup="AddEntityInGroup"}}var et=u(67354),xs=u(91966),tt=u(7471);class X{constructor(e,t){this._dialogService=e,this._translateService=t}_getRemovingConfirmationDialogConfig(e){return{width:"450px",panelClass:["dialog-top-border","relationship-remove-item"],data:{message:this._translateService.instant(e),primaryButton:{result:et.ch.result,caption:this._translateService.instant(et.ch.caption).toLowerCase()},secondaryButton:{result:et.ut.result,caption:this._translateService.instant(et.ut.caption).toLowerCase()}}}}confirmRemoving(e){const t=this._getRemovingConfirmationDialogConfig(e);return this._dialogService.open(xs.D,t).pipe((0,x.map)(n=>n===et.ch.result))}static{this.\u0275fac=function(t){return new(t||X)(o.\u0275\u0275inject(tt.o),o.\u0275\u0275inject(k.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac})}}var bs=u(56267);class te{constructor(e){this.queryExecutor=e}_getDisplayValueFilterGroup(e,t){const n=new vi.X;n.logicalOperation=bs.H.Or;for(const i of e)n.addSchemaColumnFilterWithParameter(Ge.H.Contain,i,t);return n}getFilteredLookupItems(e){const t=new An.s(e.schemaName);t.rowCount=20;const n=e.additionalColumns||[],i=e.excludedRecords||[],s=e.additionalFilters||[];n.includes("Id")||t.addSchemaColumn("Id"),n.includes("Name")||t.addSchemaColumn("Name");for(const a of n)t.addSchemaColumn(a);if(e.value!==""){const a=e.displayValueFilters||["Name"];t.filters.add(this._getDisplayValueFilterGroup(a,e.value))}i.length>0&&t.filters.addSchemaColumnInFilterWithParameters(Ge.H.Not_equal,"Id",i);for(const a of s)t.filters.add(a);return this.queryExecutor.executeSelectQuery(t).pipe((0,O.map)(a=>a.map(l=>({value:l.Id,displayValue:e.displayValueGetter?e.displayValueGetter(l):l.Name,row:l}))),(0,O.share)())}static{this.\u0275fac=function(t){return new(t||te)(o.\u0275\u0275inject(Nn.w))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac})}}class Le{static hasParent(e){return!!e?.parent}static getDefaultConnectionType(e,t){switch(!0){case(this.isContainer(e)&&this.isContainer(t)):case(this.isContainer(e)&&this.isItem(t)&&!this.hasParent(t)):case(this.isContainer(e)&&this.isItem(t)&&e.id===t.parent):case(this.isItem(e)&&!this.hasParent(e)&&this.isContainer(t)):case(this.isItem(e)&&this.hasParent(e)&&this.isItem(t)&&!this.hasParent(t)):case(this.isItem(e)&&!this.hasParent(e)&&this.isItem(t)&&this.hasParent(t)):case(this.isItem(e)&&this.hasParent(e)&&this.isItem(t)&&this.hasParent(t)&&e.parent===t.parent):return ce.formal;default:return ce.notFormal}}static getUnsupportedConnectionTypesIds(e,t){return Le.getDefaultConnectionType(e,t).id!==ce.formal.id?[ce.formal.id]:[]}static isItem(e){return e&&e.type==="relationship-item"}static isContainer(e){return e&&e.type==="relationship-container"}}var Re=u(13053),Sn=u(60575);class q{constructor(e){this.httpClient=e,this.serviceEndpoint="rest/RelationshipDesignerService/"}_prepareCollection(e,t){const n={};return e?.forEach(function(i){const s=i[t];n[s]=i},this),n}getDiagram(e,t){const n=this.serviceEndpoint+"GetDiagram";return this.httpClient.post(n,{recordId:e,schemaName:t}).pipe((0,O.map)(i=>{if(i&&i.success){const s=i.data;s.elements=this._prepareCollection(s.elements,"id"),s.connections=this._prepareCollection(s.connections,"id"),s.labels=this._prepareCollection(s.labels,"parent"),s.groups&&(s.groups=this._prepareCollection(s.groups,"id")),i.data=s;const a=i.config;a.customDiagramElements=this._prepareCollection(a.customDiagramElements,"type"),i.config=a}return i}))}deleteEntity(e){const t=this.serviceEndpoint+"DeleteEntity";return this.httpClient.post(t,{entityId:e})}createConnection(e){const t=this.serviceEndpoint+"CreateConnection";return this.httpClient.post(t,{entityConnection:e})}updateConnection(e){const t=this.serviceEndpoint+"UpdateConnection";return this.httpClient.post(t,{entityConnection:e})}deleteConnection(e){const t=this.serviceEndpoint+"DeleteConnection";return this.httpClient.post(t,{connectionId:e})}getGroupsData(){const e=this.serviceEndpoint+"GetGroupsData";return this.httpClient.post(e,null)}getGroupsDataForEntity(e){const t=this.serviceEndpoint+"GetGroupsDataForEntity";return this.httpClient.post(t,{entityId:e})}createGroup(e){const t=this.serviceEndpoint+"CreateGroup";return this.httpClient.post(t,{group:e})}updateGroup(e){const t=this.serviceEndpoint+"UpdateGroup";return this.httpClient.post(t,{group:e})}deleteGroup(e){const t=this.serviceEndpoint+"DeleteGroup";return this.httpClient.post(t,{groupId:e})}createEntityInGroup(e){const t=this.serviceEndpoint+"CreateEntityInGroup";return this.httpClient.post(t,{entityInGroup:e})}updateEntityInGroup(e){const t=this.serviceEndpoint+"UpdateEntityInGroup";return this.httpClient.post(t,{entityInGroup:e})}deleteEntityInGroup(e,t){const n=this.serviceEndpoint+"DeleteEntityInGroup";return this.httpClient.post(n,{entityId:e,groupId:t})}getRecordEntityInfo(e){const t=this.serviceEndpoint+"GetRecordEntityInfo";return this.httpClient.post(t,{entityId:e}).pipe((0,O.map)(n=>{const i=n?.recordEntityInfo;if(i){const s={};(0,v.forOwn)(i,a=>{const l=a.Key.toLowerCase();s[l]=a.Value}),n.recordEntityInfo=s}return n}))}static{this.\u0275fac=function(t){return new(t||q)(o.\u0275\u0275inject(Ln.HttpClient))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac})}}class de{constructor(){this.designerConfig$=new x.ReplaySubject(1),this.doSave$=new x.Subject,this.saveCard$=new x.Subject,this.doCloseCard$=new x.Subject}setDesignerConfig(e){this.designerConfig$.next(e)}getDesignerConfig(){return this.designerConfig$}doSave(){return this.doSave$}cardSaved(e){this.saveCard$.next(e)}saveCard(){return this.doSave$.next(),this.saveCard$}closeCard(e){this.doCloseCard$.next(e)}doCloseCard(){return this.doCloseCard$}static{this.\u0275fac=function(t){return new(t||de)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac})}}class pe{_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}_initializeGTM(){this.subscription.add(this.googleTagManagerService.initialize().subscribe())}constructor(e){this.injector=e,this.subscription=new x.Subscription,this.isNew=!1,this.isLoading=!1,this.elementData=null,this.elementConfig=null,this.id$=new x.Subject,this.isRtl=!1,this.injectDependencies(),this.subscribeEvents(),this._initializeDirectionality(),this._initializeGTM()}injectDependencies(){this.designerService=this.injector.get(q),this.propertiesPageEventService=this.injector.get(de),this.dialogService=this.injector.get(tt.o),this.translateService=this.injector.get(k.TranslateService),this.diagramEventService=this.injector.get(V),this.directionality=this.injector.get(Re.Directionality),this.googleTagManagerService=this.injector.get(Sn.A)}subscribeEvents(){this.subscription.add(this.id$.subscribe(e=>this.onIdChange(e))),this.subscription.add(this.propertiesPageEventService.doSave().subscribe(()=>this.saveCard()))}showMask(){this.isLoading=!0}hideMask(){this.isLoading=!1}getElement(e){return this.data.elements[e]||this.data.connections[e]}getElementConfig(e){return e&&this.config?.customDiagramElements[e]}getElementByRecordId(e){let t=null;return(0,v.forOwn)(this.data.elements,n=>{if(n.recordId===e)return t=n,!1}),t}onIdChange(e){this.subscription.add(this.propertiesPageEventService.getDesignerConfig().pipe((0,O.take)(1)).subscribe(t=>{this.fillData(t,e),this.onDataInitialized()}))}fillData(e,t){this.data=e.data,this.config=e.config;const n=this.elementData||this.getElement(t);this.elementConfig=this.getElementConfig(n?.type),this.elementData=n}onDataInitialized(){}saveCard(){const e=this.validate();if(!e){setTimeout(()=>{this.propertiesPageEventService.cardSaved({validated:e,success:!1,isChanged:!1})});return}this.showMask(),this.subscription.add(this.onSavedCard().subscribe(t=>{this.hideMask();const n=this.isNeedActualizeDiagram();this.propertiesPageEventService.cardSaved({validated:e,success:t,isChanged:n})}))}isNeedActualizeDiagram(){return this.isNew||this.isChanged()}onSavedCard(){return(0,x.of)(!0).pipe((0,O.delay)(1))}validate(){return!0}isChanged(){return!1}showErrorDialog(e){if(e?.success)return;const t=e?.errorInfo?.message||"An unknown error occurred during the operation.";this.subscription.add(this.dialogService.openInfoDialog(t).subscribe())}sendGtmAction(e){const t={moduleName:"RelationshipDesignerModule",schemaName:this.getGtmSchemaName()};e&&t&&this.googleTagManagerService.track((0,v.merge)(t,e))}getGtmSchemaName(){throw new Error("Need return gtm schema name")}ngOnDestroy(){this.subscription.unsubscribe(),this.hideMask()}static{this.\u0275fac=function(t){return new(t||pe)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:pe,selectors:[["crt-base-properties-page"]],hostVars:2,hostBindings:function(t,n){t&2&&o.\u0275\u0275classProp("rtl",n.isRtl)},decls:0,vars:0,template:function(t,n){},encapsulation:2})}}var Pt=u(82491),xi=u(283);class nt{set legacyAutocompleteTrigger(e){this._legacyAutocompleteTrigger=e}set legacyAutocomplete(e){this._legacyAutocomplete=e,this._openedSubscription||(this._openedSubscription=this._legacyAutocomplete.opened.subscribe(this._onAutocompleteOpened.bind(this)),this._closedSubscription=this._legacyAutocomplete.closed.subscribe(this._onAutocompleteClosed.bind(this)))}_onAutocompleteOpened(){this._overlayPointerEventsSubscription=this._legacyAutocompleteTrigger._overlayRef._outsidePointerEvents.subscribe(e=>this._legacyAutocompleteTrigger.closePanel())}_onAutocompleteClosed(){this._overlayPointerEventsSubscription.unsubscribe(),this._overlayPointerEventsSubscription=void 0}ngOnDestroy(){this._openedSubscription.unsubscribe(),this._openedSubscription=void 0,this._closedSubscription.unsubscribe(),this._closedSubscription=void 0}static{this.\u0275fac=function(t){return new(t||nt)}}static{this.\u0275dir=o.\u0275\u0275defineDirective({type:nt,selectors:[["","crtLegacyAutocompleteOverlayClick",""]],inputs:{legacyAutocompleteTrigger:"legacyAutocompleteTrigger",legacyAutocomplete:"legacyAutocomplete"}})}}function _s(c,e){c&1&&o.\u0275\u0275element(0,"ts-mask",27)}function ws(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-hint"),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate(t.getControlErrorMessage())}}function js(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-option",28),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=e.$implicit;o.\u0275\u0275property("value",t),o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function Ms(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-hint"),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate(t.getControlErrorMessage())}}function Is(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-option",28),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=e.$implicit;o.\u0275\u0275property("value",t),o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function Es(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-hint"),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate(t.getControlErrorMessage())}}function Ss(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-option",28),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=e.$implicit;o.\u0275\u0275property("value",t),o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function Ds(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-hint"),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate(t.getControlErrorMessage())}}function Ps(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-option",28),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=e.$implicit;o.\u0275\u0275property("value",t),o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}class ge extends pe{constructor(e){super(e),this.injector=e,this.relationshipTypeSchemaName="RelationType",this.connectionTypeSchemaName="RelationConnectionType",this.comment="",this.elementData=null,this._relationshipDeleteDialogService=this.injector.get(X)}injectDependencies(){super.injectDependencies(),this.lookupDataService=this.injector.get(te)}onDataInitialized(){this.showMask(),super.onDataInitialized(),this.initializeIsNew(),this.initializeSourceElementData(),this.initializeTargetElementData(),this.initializeConnectionType(),this.initializeExcludedConnectionTypes(),this.initializeRelationshipType(),this.initializeEntityA(),this.initializeEntityB(),this.initializeComment(),this.hideMask()}initializeIsNew(){this.isNew=this.elementData?.isNew}initializeSourceElementData(){this.elementData?.source&&(this.sourceElement=this.getElement(this.elementData.source),this.sourceConfig=this.getElementConfig(this.sourceElement.type))}initializeTargetElementData(){this.elementData?.target&&(this.targetElement=this.getElement(this.elementData.target),this.targetConfig=this.getElementConfig(this.targetElement.type))}initializeEntityA(){this.sourceElement&&(this.selectedEntityA={value:this.sourceElement.recordId,displayValue:this.sourceElement.caption})}initializeEntityB(){if(!this.elementData?.target)return;const e=this.getElement(this.elementData.target);this.selectedEntityB={value:e.recordId,displayValue:e.caption}}initializeConnectionType(){if(!this.elementData?.relationshipType?.connectionType)return;const e=this.elementData.relationshipType.connectionType;let t=e.id;this.isNew?(t=this.isFormalConnectionAddingDisabled()?ce.notFormal.id:t,this.initializeConnectionTypeById(t)):this.selectedConnectionType={value:t,displayValue:e.name}}initializeConnectionTypeById(e){this.getConnectionTypeControlLookupValues().pipe((0,O.take)(1)).subscribe(t=>{this.selectedConnectionType=t.find(n=>n.value===e)})}initializeExcludedConnectionTypes(){!this.sourceElement||!this.targetElement||(this.excludedConnectionTypes=Le.getUnsupportedConnectionTypesIds(this.sourceElement,this.targetElement))}initializeRelationshipType(){this.elementData?.relationshipType?.id&&(this.selectedRelationshipType={value:this.elementData?.relationshipType.id,displayValue:this.elementData?.relationshipType.name})}initializeComment(){this.comment=this.elementData?.comment||""}onSavedCard(){if(!this.isNeedActualizeDiagram())return(0,x.of)(!0).pipe((0,O.delay)(1));const e=this.buildServerElement(),t=this.isNew?this.designerService.createConnection(e):this.designerService.updateConnection(e);return this.sendGtmAction({action:this.isNew?ke.AddElement:ke.EditConnection}),t.pipe((0,O.switchMap)(n=>{const i=n?.success;return i||this.showErrorDialog(n),(0,x.of)(i).pipe((0,O.delay)(1))}))}validate(){let e=super.validate();return e=e&&!!this.selectedConnectionType&&!!this.selectedRelationshipType&&!!this.selectedEntityA&&!!this.selectedEntityB,e}isChanged(){let e=super.isChanged();const t=this.elementData,n=this.getElementByRecordId(this.selectedEntityB.value);return e=e||!n||n.id!==t.target,e=e||this.selectedConnectionType?.value!==t.relationshipType.connectionType.id,e=e||this.selectedRelationshipType?.value!==t.relationshipType.id,e=e||this.comment!==t.comment,e}buildServerElement(){return{id:this.elementData.originalId||this.elementData.id,diagramId:this.data.id,relationshipRecordA:{id:this.selectedEntityA.value,schemaName:this.sourceConfig.caption},relationshipRecordB:{id:this.selectedEntityB.value,schemaName:this.targetConfig.caption},relationshipType:this.selectedRelationshipType.value,comment:this.comment}}doDeleteConnection(){if(this.isNew){this.forceCloseCard(!0);return}this.showMask(),this.subscription.add(this.designerService.deleteConnection(this.elementData.originalId).subscribe(e=>{if(!e?.success){this.hideMask(),this.showErrorDialog(e);return}this.forceCloseCard(!0),this.hideMask(),this.sendGtmAction({action:ke.DeleteElement})}))}forceCloseCard(e=!1){this.propertiesPageEventService.closeCard({isForced:!0,isNeedDiagramReload:e})}getControlLookupValues(e){return this.lookupDataService.getFilteredLookupItems({value:e.value,schemaName:e.schemaName,excludedRecords:e.excludedRecords,additionalColumns:e.additionalColumns,additionalFilters:e.additionalFilters,displayValueFilters:e.displayValueFilters,displayValueGetter:e.displayValueGetter})}isFormalConnectionAddingDisabled(){const e=Le.hasParent(this.sourceElement),t=Le.hasParent(this.targetElement),n=this.targetConfig.caption==="Account";return e&&t&&this.sourceElement.parent!==this.targetElement.parent||e&&n}getExcludedConnectionTypes(){return this.isFormalConnectionAddingDisabled()?[ce.formal.id]:[]}getConnectionTypeControlLookupValues(e=""){const t=this.excludedConnectionTypes?.length?this.excludedConnectionTypes:this.getExcludedConnectionTypes();return this.getControlLookupValues({value:e,schemaName:this.connectionTypeSchemaName,excludedRecords:t})}getRelationTypeAdditionalFilterGroup(){const e="For"+this.sourceConfig.caption+this.targetConfig.caption,t=new vi.X;t.addSchemaColumnFilterWithParameter(Ge.H.Equal,e,!0);let n=this.selectedConnectionType?.value;return!n&&this.isFormalConnectionAddingDisabled()&&(n=ce.notFormal.id),n&&t.addSchemaColumnFilterWithParameter(Ge.H.Equal,"RelationConnectionType.Id",n),t}getRelationshipTypeControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:this.relationshipTypeSchemaName,additionalColumns:["ReverseRelationType.Name","RelationConnectionType.Id","RelationConnectionType.Name"],additionalFilters:[this.getRelationTypeAdditionalFilterGroup()],displayValueFilters:["Name","ReverseRelationType.Name"],displayValueGetter:t=>t.Name+" - "+t["ReverseRelationType.Name"]})}getEntityAControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:this.sourceConfig.caption})}getEntityBControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:this.targetConfig.caption,excludedRecords:this.getExcludedEntityBControlValuesFilter()})}getExcludedEntityBControlValuesFilter(){const e=[];return this.addSelfExcludeFilterIfNeed(e),e}addSelfExcludeFilterIfNeed(e){this.targetConfig.caption===this.sourceConfig.caption&&e.push(this.sourceElement.recordId)}getGtmSchemaName(){return"ConnectionPropertiesPageComponent"}onConnectionTypeChange(e){this.selectedConnectionType=null,this.connectionTypes=this.getConnectionTypeControlLookupValues(e)}onConnectionTypeSelected(e){this.selectedConnectionType=e,this.connectionTypes=null,this.selectedRelationshipType=null}onRelationshipTypeChange(e){this.selectedRelationshipType=null,this.relationshipTypes=this.getRelationshipTypeControlLookupValues(e)}onRelationshipTypeSelected(e){this.selectedRelationshipType=e,this.selectedRelationshipType?.row&&(this.selectedConnectionType={value:this.selectedRelationshipType?.row["RelationConnectionType.Id"],displayValue:this.selectedRelationshipType?.row["RelationConnectionType.Name"]}),this.relationshipTypes=null}onEntityAChange(e){this.selectedEntityA=null,this.entitiesA=this.getEntityAControlLookupValues(e)}onEntityASelected(e){this.selectedEntityA=e,this.entitiesA=null}onEntityBChange(e){this.selectedEntityB=null,this.entitiesB=this.getEntityBControlLookupValues(e)}onEntityBSelected(e){this.selectedEntityB=e,this.entitiesB=null}getControlDisplayValue(e){return e?e.displayValue||e.value:""}getControlErrorMessage(){return this.translateService.instant("RelationshipDesigner.RequiredControlErrorMessage")}onCommentChange(e){this.comment=e}deleteConnection(){this._relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage").subscribe(e=>{e&&this.doDeleteConnection()})}onConnectionTypeFocus(e){this.connectionTypes=this.getConnectionTypeControlLookupValues()}onRelationshipTypeFocus(e){this.relationshipTypes=this.getRelationshipTypeControlLookupValues()}onEntityAFocus(e){this.entitiesA=this.getEntityAControlLookupValues()}onEntityBFocus(e){this.entitiesB=this.getEntityBControlLookupValues()}static{this.\u0275fac=function(t){return new(t||ge)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:ge,selectors:[["crt-connection-properties-page"]],features:[o.\u0275\u0275InheritDefinitionFeature],decls:59,vars:52,consts:[["connectionTypeTrigger","matAutocompleteTrigger"],["connectionTypeAuto","matAutocomplete"],["relationshipTypeTrigger","matAutocompleteTrigger"],["relationshipTypeAuto","matAutocomplete"],["entityATrigger","matAutocompleteTrigger"],["entityAAuto","matAutocomplete"],["entityBTrigger","matAutocompleteTrigger"],["entityBAuto","matAutocomplete"],["class","component-mask",4,"ngIf"],[1,"header"],[1,"title-wrap"],[1,"logo-wrap"],[1,"logo"],[1,"title"],[1,"title-control-group"],["floatLabel","always"],["type","text","matInput","","required","",3,"keyup","focus","matAutocomplete","value"],[4,"ngIf"],["crtLegacyAutocompleteOverlayClick","",3,"optionSelected","legacyAutocompleteTrigger","legacyAutocomplete","displayWith"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","",1,"delete-icon",3,"click"],[1,"content"],[1,"group-label"],["type","text","matInput","","disabled","",3,"keyup","focus","matAutocomplete","value"],[1,"divider"],["floatLabel","always",1,"text-area"],["matInput","","name","message",3,"change","value"],[1,"component-mask"],[3,"value"]],template:function(t,n){if(t&1){const i=o.\u0275\u0275getCurrentView();o.\u0275\u0275template(0,_s,1,0,"ts-mask",8),o.\u0275\u0275elementStart(1,"div",9)(2,"div",10)(3,"div",11),o.\u0275\u0275element(4,"div",12),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(5,"div",13),o.\u0275\u0275text(6),o.\u0275\u0275pipe(7,"translate"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(8,"div",14)(9,"mat-form-field",15)(10,"input",16,0),o.\u0275\u0275listener("keyup",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onConnectionTypeChange(a.target.value))})("focus",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onConnectionTypeFocus(a.target.value))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275template(12,ws,2,1,"mat-hint",17),o.\u0275\u0275elementStart(13,"mat-autocomplete",18,1),o.\u0275\u0275listener("optionSelected",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onConnectionTypeSelected(a.option.value))}),o.\u0275\u0275template(15,js,2,2,"mat-option",19),o.\u0275\u0275pipe(16,"async"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(17,"button",20),o.\u0275\u0275listener("click",function(){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.deleteConnection())}),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(18,"div",21)(19,"mat-form-field",15)(20,"mat-label"),o.\u0275\u0275text(21),o.\u0275\u0275pipe(22,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(23,"input",16,2),o.\u0275\u0275listener("keyup",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onRelationshipTypeChange(a.target.value))})("focus",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onRelationshipTypeFocus(a.target.value))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275template(25,Ms,2,1,"mat-hint",17),o.\u0275\u0275elementStart(26,"mat-autocomplete",18,3),o.\u0275\u0275listener("optionSelected",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onRelationshipTypeSelected(a.option.value))}),o.\u0275\u0275template(28,Is,2,2,"mat-option",19),o.\u0275\u0275pipe(29,"async"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(30,"span",22),o.\u0275\u0275text(31),o.\u0275\u0275pipe(32,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(33,"mat-form-field",15)(34,"mat-label"),o.\u0275\u0275text(35),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(36,"input",23,4),o.\u0275\u0275listener("keyup",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onEntityAChange(a.target.value))})("focus",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onEntityAFocus(a.target.value))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275template(38,Es,2,1,"mat-hint",17),o.\u0275\u0275elementStart(39,"mat-autocomplete",18,5),o.\u0275\u0275listener("optionSelected",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onEntityASelected(a.option.value))}),o.\u0275\u0275template(41,Ss,2,2,"mat-option",19),o.\u0275\u0275pipe(42,"async"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(43,"mat-form-field",15)(44,"mat-label"),o.\u0275\u0275text(45),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(46,"input",16,6),o.\u0275\u0275listener("keyup",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onEntityBChange(a.target.value))})("focus",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onEntityBFocus(a.target.value))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275template(48,Ds,2,1,"mat-hint",17),o.\u0275\u0275elementStart(49,"mat-autocomplete",18,7),o.\u0275\u0275listener("optionSelected",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onEntityBSelected(a.option.value))}),o.\u0275\u0275template(51,Ps,2,2,"mat-option",19),o.\u0275\u0275pipe(52,"async"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275element(53,"mat-divider",24),o.\u0275\u0275elementStart(54,"mat-form-field",25)(55,"mat-label"),o.\u0275\u0275text(56),o.\u0275\u0275pipe(57,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(58,"textarea",26),o.\u0275\u0275listener("change",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.onCommentChange(a.target.value))}),o.\u0275\u0275elementEnd()()()}if(t&2){const i=o.\u0275\u0275reference(11),s=o.\u0275\u0275reference(14),a=o.\u0275\u0275reference(24),l=o.\u0275\u0275reference(27),p=o.\u0275\u0275reference(37),g=o.\u0275\u0275reference(40),h=o.\u0275\u0275reference(47),C=o.\u0275\u0275reference(50);o.\u0275\u0275property("ngIf",n.isLoading),o.\u0275\u0275advance(6),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(7,36,"ConnectionPropertiesPage.Title")),o.\u0275\u0275advance(4),o.\u0275\u0275property("matAutocomplete",s)("value",n.selectedConnectionType==null?null:n.selectedConnectionType.displayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",!n.selectedConnectionType),o.\u0275\u0275advance(),o.\u0275\u0275property("legacyAutocompleteTrigger",i)("legacyAutocomplete",s)("displayWith",n.getControlDisplayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngForOf",o.\u0275\u0275pipeBind1(16,38,n.connectionTypes)),o.\u0275\u0275advance(6),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(22,40,"ConnectionPropertiesPage.RelationshipType")),o.\u0275\u0275advance(2),o.\u0275\u0275property("matAutocomplete",l)("value",n.selectedRelationshipType==null?null:n.selectedRelationshipType.displayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",!n.selectedRelationshipType),o.\u0275\u0275advance(),o.\u0275\u0275property("legacyAutocompleteTrigger",a)("legacyAutocomplete",l)("displayWith",n.getControlDisplayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngForOf",o.\u0275\u0275pipeBind1(29,42,n.relationshipTypes)),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(32,44,"ConnectionPropertiesPage.Relations")),o.\u0275\u0275advance(4),o.\u0275\u0275textInterpolate(n.sourceConfig==null||n.sourceConfig.entitySchemaData==null?null:n.sourceConfig.entitySchemaData.caption),o.\u0275\u0275advance(),o.\u0275\u0275property("matAutocomplete",g)("value",n.selectedEntityA==null?null:n.selectedEntityA.displayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",!n.selectedEntityA),o.\u0275\u0275advance(),o.\u0275\u0275property("legacyAutocompleteTrigger",p)("legacyAutocomplete",g)("displayWith",n.getControlDisplayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngForOf",o.\u0275\u0275pipeBind1(42,46,n.entitiesA)),o.\u0275\u0275advance(4),o.\u0275\u0275textInterpolate(n.targetConfig==null||n.targetConfig.entitySchemaData==null?null:n.targetConfig.entitySchemaData.caption),o.\u0275\u0275advance(),o.\u0275\u0275property("matAutocomplete",C)("value",n.selectedEntityB==null?null:n.selectedEntityB.displayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",!n.selectedEntityB),o.\u0275\u0275advance(),o.\u0275\u0275property("legacyAutocompleteTrigger",h)("legacyAutocomplete",C)("displayWith",n.getControlDisplayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngForOf",o.\u0275\u0275pipeBind1(52,48,n.entitiesB)),o.\u0275\u0275advance(5),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(57,50,"ConnectionPropertiesPage.Comment")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",n.comment)}},dependencies:[P.NgForOf,P.NgIf,Pt.I,Me.MatLegacyAutocomplete,Me.MatLegacyAutocompleteTrigger,xi.MatLegacyOption,J.MatLegacyButton,Lt.MatDivider,W.MatLegacyFormField,W.MatLegacyHint,W.MatLegacyLabel,ue.MatLegacyInput,nt,P.AsyncPipe,k.TranslatePipe],styles:["[_nghost-%COMP%]{display:block;position:relative;height:100%}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-right:0}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-right:10px;text-align:right}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.open-card[_ngcontent-%COMP%]{transform:rotate(-90deg)}.rtl[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:right}.header[_ngcontent-%COMP%]{max-width:343px;padding:12px 20px 0;min-height:97px;max-height:135px;border-top-left-radius:8px;border-top-right-radius:8px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]{height:56px;margin-top:5px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-top:7px;flex:0 0 69px;width:72px;height:56px;display:inline-flex;justify-content:center;align-items:center;margin-right:16px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:inline-block;letter-spacing:0px;text-align:left;margin-top:3px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;margin-top:7px;margin-right:10px;justify-content:flex-end;align-items:center}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{width:16px;height:16px;font-size:16px}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;width:100%;position:absolute;overflow-x:hidden;overflow-y:auto;height:auto;bottom:0;top:135px}.content[_ngcontent-%COMP%]:last-child{padding-bottom:0}.content[_ngcontent-%COMP%]   .text-area[_ngcontent-%COMP%]{min-width:150px;width:100%}.content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:left;letter-spacing:0px}",'.rtl[_nghost-%COMP%]   .title-control-group[_ngcontent-%COMP%]{width:300px}.rtl[_nghost-%COMP%]   .title-control-group[_ngcontent-%COMP%]   .delete-icon[_ngcontent-%COMP%]{padding:revert;margin-left:0}.rtl[_nghost-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{margin-left:-50px}.logo[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMC45MDgiIGhlaWdodD0iMTEuMDI5IiB2aWV3Qm94PSIwIDAgMTAuOTA4IDExLjAyOSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6bm9uZTtzdHJva2U6IzU0NjU3ZDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4zNTYgMC40NDcpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTQuMTMxLDEwLjIzLDE0LjIzNiwwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNC4xMzEpIi8+PGxpbmUgY2xhc3M9ImEiIHkxPSIyLjEyNSIgeDI9IjQuMjUxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1Ljg1NSkiLz48bGluZSBjbGFzcz0iYSIgeTE9IjQuMjUxIiB4Mj0iMi4xMjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDcuOTgpIi8+PC9nPjwvc3ZnPg==);width:24px;height:24px}.title-control-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:324px}.title-control-group[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}.title-control-group[_ngcontent-%COMP%]   .delete-icon[_ngcontent-%COMP%]{font-family:bpmonline designer icons;line-height:1px;line-height:.6px;font-size:24px;height:24px;width:24px;opacity:.8;margin:19px 19px 10px 5px}.title-control-group[_ngcontent-%COMP%]   .delete-icon[_ngcontent-%COMP%]:before{content:"\\e92c"!important;display:inline;position:relative}.content[_ngcontent-%COMP%]{padding:20px}.content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{padding-bottom:20px}.content[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{margin:8px -20px 0}']})}}var Os=u(29957);class ne{constructor(){this.createGroup$=new x.Subject,this.addEntityToGroup$=new x.Subject,this.initializeGroups$=new x.Subject,this.isLoading$=new x.ReplaySubject(1)}createGroup(){this.createGroup$.next()}addEntityToGroup(e){this.addEntityToGroup$.next(e)}isLoading(e){this.isLoading$.next(e)}initializeGroups(){this.initializeGroups$.next()}static{this.\u0275fac=function(t){return new(t||ne)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac})}}function Ts(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-option",14),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=e.$implicit;o.\u0275\u0275property("value",t),o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function ks(c,e){if(c&1){const t=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"mat-form-field",6)(1,"mat-label"),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(4,"input",11),o.\u0275\u0275listener("keyup",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.onGroupChange(i.target.value))})("focus",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.onGroupFocus(i.target.value))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(5,"mat-autocomplete",12,0),o.\u0275\u0275listener("optionSelected",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.onGroupSelected(i.option.value))}),o.\u0275\u0275template(7,Ts,2,2,"mat-option",13),o.\u0275\u0275pipe(8,"async"),o.\u0275\u0275elementEnd()()}if(c&2){const t=o.\u0275\u0275reference(6),n=o.\u0275\u0275nextContext();o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,5,"EntityInGroupPropertiesDialog.Group")),o.\u0275\u0275advance(2),o.\u0275\u0275property("matAutocomplete",t)("value",n.selectedGroup==null?null:n.selectedGroup.displayValue),o.\u0275\u0275advance(),o.\u0275\u0275property("displayWith",n.getControlDisplayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngForOf",o.\u0275\u0275pipeBind1(8,7,n.groups))}}function Ls(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-option",14),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),c&2){const t=e.$implicit;o.\u0275\u0275property("value",t),o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function Rs(c,e){if(c&1){const t=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"mat-form-field",6)(1,"mat-label"),o.\u0275\u0275text(2),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(3,"input",11),o.\u0275\u0275listener("keyup",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.onEntityChange(i.target.value))})("focus",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.onEntityFocus(i.target.value))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(4,"mat-autocomplete",12,1),o.\u0275\u0275listener("optionSelected",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.onEntitySelected(i.option.value))}),o.\u0275\u0275template(6,Ls,2,2,"mat-option",13),o.\u0275\u0275pipe(7,"async"),o.\u0275\u0275elementEnd()()}if(c&2){const t=o.\u0275\u0275reference(5),n=o.\u0275\u0275nextContext();o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(n.itemTypeSchemaCaption),o.\u0275\u0275advance(),o.\u0275\u0275property("matAutocomplete",t)("value",n.selectedEntity==null?null:n.selectedEntity.displayValue),o.\u0275\u0275advance(),o.\u0275\u0275property("displayWith",n.getControlDisplayValue),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngForOf",o.\u0275\u0275pipeBind1(7,5,n.entities))}}class ve{constructor(e,t){this.injector=t,this.itemTypeSchemaCaption="",this.isGroupVisible=!0,this.isEntityVisible=!0,this.isRtl=!1,this.injectDependencies(),this.initializeItemTypeSchemaCaption(),this.initializeEntityInGroup(e?.entityInGroup),this.initializeExludedGroups(e?.excludedGroups),this.initializeExludedEntityRecords(e?.exludedEntityRecords),this._initializeDirectionality()}_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}initializeExludedGroups(e){this.excludedGroups=e||[]}initializeExludedEntityRecords(e){this.excludedEntityRecords=e||[]}injectDependencies(){this.lookupDataService=this.injector.get(te),this.translateService=this.injector.get(k.TranslateService),this.diagramEventService=this.injector.get(V),this.directionality=this.injector.get(Re.Directionality)}initializeItemTypeSchemaCaption(){var e=this;return(0,j.A)(function*(){const n=(yield e.diagramEventService.getDiagramConfig())?.customDiagramElements[M.relationshipItem]||{};e.itemTypeSchemaCaption=n.entitySchemaData?.caption||""})()}initializeEntityInGroup(e){e&&(this.entityInGroup=e,this.initializeComment(),this.initializeInputVisibility())}initializeComment(){this.entityInGroup?.comment||(this.entityInGroup.comment="")}initializeInputVisibility(){this.entityInGroup.groupId&&(this.isGroupVisible=!1),this.entityInGroup.entityId&&(this.isEntityVisible=!1)}getControlLookupValues(e){return this.lookupDataService.getFilteredLookupItems({value:e.value,schemaName:e.schemaName,excludedRecords:e.excludedRecords})}getGroupControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:"RelationshipGroup",excludedRecords:this.excludedGroups})}getContactControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:"Contact",excludedRecords:this.excludedEntityRecords})}isCardValid(){const e=!this.isEntityVisible||!!this.selectedEntity,t=!this.isGroupVisible||!!this.selectedGroup;return e&&t}getControlDisplayValue(e){return e?e.displayValue||e.value:""}onGroupChange(e){this.selectedGroup=null,this.groups=this.getGroupControlLookupValues(e)}onGroupSelected(e){this.selectedGroup=e,this.entityInGroup.groupId=e.value,this.groups=null}onGroupFocus(e){this.groups=this.getGroupControlLookupValues()}onEntityChange(e){this.selectedEntity=null,this.entities=this.getContactControlLookupValues(e)}onEntitySelected(e){this.selectedEntity=e;let t=this.entityInGroup.entityRecordData||{};t=Object.assign(t,{id:e.value,name:e.displayValue}),this.entityInGroup.entityRecordData=t,this.entities=null}onEntityFocus(e){this.entities=this.getContactControlLookupValues()}getDialogCaption(){const e=this.isGroupVisible||this.isEntityVisible?"AddToGroup":"Edit";return this.translateService.instant("EntityInGroupPropertiesDialog."+e)}static{this.\u0275fac=function(t){return new(t||ve)(o.\u0275\u0275directiveInject(F.MAT_LEGACY_DIALOG_DATA),o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:ve,selectors:[["crt-entity-in-group-properties-dialog"]],hostVars:2,hostBindings:function(t,n){t&2&&o.\u0275\u0275classProp("rtl",n.isRtl)},decls:19,vars:15,consts:[["groupAutocomplete","matAutocomplete"],["contactAutocomplete","matAutocomplete"],[1,"add-entity-to-group-dialog"],["mat-dialog-title",""],["mat-dialog-content","",1,"relationship-dialog-content"],["floatLabel","always",4,"ngIf"],["floatLabel","always"],["type","text","matInput","",3,"input","value"],["mat-dialog-actions",""],["mat-button","",1,"crt-button",3,"mat-dialog-close"],["mat-flat-button","","color","accent",1,"action-button","crt-button",3,"mat-dialog-close","disabled"],["type","text","matInput","","required","",3,"keyup","focus","matAutocomplete","value"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){t&1&&(o.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"span"),o.\u0275\u0275text(3),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(4,"div",4),o.\u0275\u0275template(5,ks,9,9,"mat-form-field",5)(6,Rs,8,7,"mat-form-field",5),o.\u0275\u0275elementStart(7,"mat-form-field",6)(8,"mat-label"),o.\u0275\u0275text(9),o.\u0275\u0275pipe(10,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(11,"input",7),o.\u0275\u0275listener("input",function(s){return n.entityInGroup.comment=s.target.value}),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(12,"div",8)(13,"button",9),o.\u0275\u0275text(14),o.\u0275\u0275pipe(15,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(16,"button",10),o.\u0275\u0275text(17),o.\u0275\u0275pipe(18,"translate"),o.\u0275\u0275elementEnd()()()),t&2&&(o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(n.getDialogCaption()),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",n.isGroupVisible),o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",n.isEntityVisible),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(10,9,"EntityInGroupPropertiesDialog.Comment")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",n.entityInGroup==null?null:n.entityInGroup.comment),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(15,11,"EntityInGroupPropertiesDialog.Cancel")," "),o.\u0275\u0275advance(2),o.\u0275\u0275property("mat-dialog-close",n.entityInGroup)("disabled",!n.isCardValid()),o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(18,13,"EntityInGroupPropertiesDialog.Save")," "))},dependencies:[P.NgForOf,P.NgIf,Me.MatLegacyAutocomplete,Me.MatLegacyAutocompleteTrigger,xi.MatLegacyOption,J.MatLegacyButton,F.MatLegacyDialogClose,F.MatLegacyDialogTitle,F.MatLegacyDialogContent,F.MatLegacyDialogActions,W.MatLegacyFormField,W.MatLegacyLabel,ue.MatLegacyInput,P.AsyncPipe,k.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{min-width:240px}[_nghost-%COMP%]   .mat-dialog-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-top:4px;font-family:var(--crt-headline-2-font-family);font-size:var(--crt-headline-2-font-size);line-height:var(--crt-headline-2-line-height);font-weight:var(--crt-headline-2-font-weight);letter-spacing:var(--crt-headline-2-letter-spacing);text-transform:var(--crt-headline-2-text-transform);-webkit-font-smoothing:antialiased;color:var(--crt-palette-primary-500, var(--palette-primary-500))}.rtl[_nghost-%COMP%]   .mat-dialog-title[_ngcontent-%COMP%]{text-align:right}.rtl[_nghost-%COMP%]   .mat-autocomplete.mat-autocomplete[_ngcontent-%COMP%]:after{right:auto}.mat-dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.mat-dialog-content[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%]   .mat-form-field-label-wrapper[_ngcontent-%COMP%]   .mat-form-field-required-marker[_ngcontent-%COMP%]{color:#f44336}.mat-dialog-actions[_ngcontent-%COMP%]{justify-content:flex-end}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%], .mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]{font-family:var(--crt-button-font-family, var(--button-font-family));font-size:var(--crt-button-font-size, var(--button-font-size));font-weight:var(--crt-button-font-weight, var(--button-font-weight));text-transform:var(--crt-button-text-transform, uppercase);border-radius:var(--button-border-radius, var(--button-rounded-border-radius))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[disabled][_ngcontent-%COMP%]{color:var(--crt-palette-disabled-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-disabled-50, rgba(var(--disabled-button-background), 1))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]){color:var(--crt-palette-primary-contrast-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-primary-500, var(--palette-primary-500))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]):focus{color:var(--crt-palette-primary-contrast-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-primary-500, var(--palette-primary-500))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]):hover, .mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]).cdk-keyboard-focused{background-color:var(--crt-palette-primary-800, var(--palette-primary-800))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:var(--crt-palette-primary-900, var(--palette-primary-800))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%]{color:var(--crt-palette-secondary-500, var(--palette-primary-500))!important}"]})}}var Ot=u(6530);const zs=["colorBox"];function As(c,e){if(c&1){const t=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"color-github",15),o.\u0275\u0275listener("onChangeComplete",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.onChangeColor(i))}),o.\u0275\u0275elementEnd()}if(c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275styleProp("left",t.colorPickerPosition.x,"px")("top",t.colorPickerPosition.y,"px"),o.\u0275\u0275property("triangle","top-right")("color",t.group.color)("colors",t.colors)("width",187)}}class xe{constructor(e,t,n){this.translateService=t,this.isNew=!0,this.colors=["#FF2031","#C40069","#C400A9","#8400C4","#5200C4","#2B00C4","#005BC4","#0076C4","#009FC4","#29A5A1","#00C4A8","#00C46D","#00C407","#A3C400"],this.isColorTabVisible=!1,this.colorPickerPosition={x:0,y:0},this.group={id:(0,Ot.qv)(),name:"",color:"#000000",comment:""},this.isRtl=!1,e?.group?(this.group=e.group,this.isNew=!1):this.initializeColor(),this._initializeDirectionality(n)}_initializeDirectionality(e){this.isRtl=e?.value==="rtl"}initializeColor(){const e=Math.floor(Math.random()*Math.floor(this.colors.length-1));this.group.color=this.colors[e]}initializeColorPickerPostion(){const e=this.colorBox?.nativeElement;if(!e)return;let t=e.offsetLeft,n=e.offsetTop;n+=30,t-=145,this.colorPickerPosition={x:t,y:n}}showColorTab(){this.initializeColorPickerPostion(),this.isColorTabVisible=!0}onChangeColor(e){this.group.color=e.color.hex}onGlobalClick(e){this.colorBox.nativeElement.contains(e.target)||(this.isColorTabVisible=!1)}getDialogCaption(){const e=this.isNew?"NewGroup":"EditGroup";return this.translateService.instant("GroupPropertiesDialog."+e)}static{this.\u0275fac=function(t){return new(t||xe)(o.\u0275\u0275directiveInject(F.MAT_LEGACY_DIALOG_DATA),o.\u0275\u0275directiveInject(k.TranslateService),o.\u0275\u0275directiveInject(Re.Directionality))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:xe,selectors:[["crt-group-properties-dialog"]],viewQuery:function(t,n){if(t&1&&o.\u0275\u0275viewQuery(zs,5,o.ElementRef),t&2){let i;o.\u0275\u0275queryRefresh(i=o.\u0275\u0275loadQuery())&&(n.colorBox=i.first)}},hostVars:2,hostBindings:function(t,n){t&1&&o.\u0275\u0275listener("mousedown",function(s){return n.onGlobalClick(s)},!1,o.\u0275\u0275resolveDocument),t&2&&o.\u0275\u0275classProp("rtl",n.isRtl)},decls:27,vars:20,consts:[["colorBox",""],["mat-dialog-title",""],["mat-dialog-content","",1,"relationship-dialog-content"],[1,"flex-row-control-group"],["floatLabel","always",1,"name-control"],["matInput","","type","text","required","",3,"input","value"],["floatLabel","always"],["matInput","","type","text",3,"input","value"],[1,"color-box-wrap"],[1,"color-box"],[1,"choose-button",3,"click"],["class","color-picker",3,"left","top","triangle","color","colors","width","onChangeComplete",4,"ngIf"],["mat-dialog-actions",""],["mat-button","","cdkFocusInitial","",1,"crt-button",3,"mat-dialog-close"],["mat-flat-button","","color","accent",1,"crt-button",3,"mat-dialog-close","disabled"],[1,"color-picker",3,"onChangeComplete","triangle","color","colors","width"]],template:function(t,n){if(t&1){const i=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"div",1)(1,"span"),o.\u0275\u0275text(2),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(3,"div",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),o.\u0275\u0275text(7),o.\u0275\u0275pipe(8,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(9,"input",5),o.\u0275\u0275listener("input",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.group.name=a.target.value)}),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(10,"mat-form-field",6)(11,"mat-label"),o.\u0275\u0275text(12),o.\u0275\u0275pipe(13,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(14,"input",7),o.\u0275\u0275listener("input",function(a){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.group.comment=a.target.value)}),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(15,"div",8,0),o.\u0275\u0275element(17,"div",9),o.\u0275\u0275elementStart(18,"div",10),o.\u0275\u0275listener("click",function(){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.showColorTab())}),o.\u0275\u0275elementEnd(),o.\u0275\u0275template(19,As,1,8,"color-github",11),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(20,"div",12)(21,"button",13),o.\u0275\u0275text(22),o.\u0275\u0275pipe(23,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(24,"button",14),o.\u0275\u0275text(25),o.\u0275\u0275pipe(26,"translate"),o.\u0275\u0275elementEnd()()}t&2&&(o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(n.getDialogCaption()),o.\u0275\u0275advance(5),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(8,12,"GroupPropertiesDialog.Name")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",n.group.name),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(13,14,"GroupPropertiesDialog.Comment")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",n.group.comment),o.\u0275\u0275advance(3),o.\u0275\u0275styleProp("background",n.group.color),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",n.isColorTabVisible),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(23,16,"GroupPropertiesDialog.Cancel")," "),o.\u0275\u0275advance(2),o.\u0275\u0275property("mat-dialog-close",n.group)("disabled",!(n.group!=null&&n.group.name)),o.\u0275\u0275advance(),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(26,18,"GroupPropertiesDialog.Save")," "))},dependencies:[P.NgIf,En.GithubComponent,J.MatLegacyButton,F.MatLegacyDialogClose,F.MatLegacyDialogTitle,F.MatLegacyDialogContent,F.MatLegacyDialogActions,W.MatLegacyFormField,W.MatLegacyLabel,ue.MatLegacyInput,k.TranslatePipe],styles:["[_nghost-%COMP%]{min-width:240px}[_nghost-%COMP%]   .mat-dialog-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-top:4px;font-family:var(--crt-headline-2-font-family, var(--dialog-title-font-family));font-size:var(--crt-headline-2-font-size, var(--dialog-title-font-size));line-height:var(--crt-headline-2-line-height, var(--dialog-title-line-height));font-weight:var(--crt-headline-2-font-weight, var(--dialog-title-font-weight));color:var(--crt-palette-primary-500, var(--palette-primary-500))}.rtl[_nghost-%COMP%]   .mat-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]{margin-right:30px}.rtl[_nghost-%COMP%]   .mat-dialog-title[_ngcontent-%COMP%]{text-align:right}.mat-dialog-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.mat-dialog-content[_ngcontent-%COMP%]   .flex-row-control-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.mat-dialog-content[_ngcontent-%COMP%]   .flex-row-control-group[_ngcontent-%COMP%]   .name-control[_ngcontent-%COMP%]{width:100%}.mat-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]{height:16px;width:32px;display:flex;margin-left:10px;flex-direction:row;margin-top:20px}.mat-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{height:16px;width:16px;border:1px solid #cccccc}.mat-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]   .choose-button[_ngcontent-%COMP%]{height:16px;width:16px;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojNTQ2NTdkO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNzgzLjc3OSA3NC40NTUpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTE3ODcuNzc5LTY3LjQ1NWw0LDQsNC00WiIvPjwvZz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+);background-position:center;background-repeat:no-repeat}.mat-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]   .choose-button[_ngcontent-%COMP%]:hover{cursor:pointer}.mat-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]   .color-picker[_ngcontent-%COMP%]{position:absolute;z-index:2600}.mat-dialog-content[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%]   .mat-form-field-label-wrapper[_ngcontent-%COMP%]   mat-label[_ngcontent-%COMP%]{font-family:var(--crt-font-family, var(--font-family))}.mat-dialog-content[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%]   .mat-form-field-label-wrapper[_ngcontent-%COMP%]   .mat-form-field-required-marker[_ngcontent-%COMP%]{color:#f44336}.mat-dialog-actions[_ngcontent-%COMP%]{justify-content:flex-end}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%], .mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]{font-family:var(--crt-button-font-family, var(--button-font-family));font-size:var(--crt-button-font-size, var(--button-font-size));font-weight:var(--crt-button-font-weight, var(--button-font-weight));text-transform:var(--crt-button-text-transform, uppercase);border-radius:var(--button-border-radius, var(--button-rounded-border-radius))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[disabled][_ngcontent-%COMP%]{color:var(--crt-palette-disabled-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-disabled-50, rgba(var(--disabled-button-background), 1))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]){color:var(--crt-palette-primary-contrast-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-primary-500, var(--palette-primary-500))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]):focus{color:var(--crt-palette-primary-contrast-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-primary-500, var(--palette-primary-500))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]):hover, .mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]).cdk-keyboard-focused{background-color:var(--crt-palette-primary-800, var(--palette-primary-800))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-flat-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:var(--crt-palette-primary-900, var(--palette-primary-800))}.mat-dialog-actions[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%]{color:var(--crt-palette-secondary-500, var(--palette-primary-500))!important}"]})}}const Ns=c=>({"background-image":c});function Bs(c,e){if(c&1){const t=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"button",22),o.\u0275\u0275listener("click",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext().$implicit,a=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(a.addEntityToGroup(i,s.id))}),o.\u0275\u0275elementEnd()}}function Gs(c,e){if(c&1){const t=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"mat-list-item",23)(1,"div",24)(2,"div",25),o.\u0275\u0275element(3,"div",26),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(4,"div",27)(5,"div",28),o.\u0275\u0275text(6),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(7,"div",29)(8,"div"),o.\u0275\u0275text(9),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(10,"div",30),o.\u0275\u0275element(11,"button",31),o.\u0275\u0275elementStart(12,"mat-menu",16,1)(14,"button",18),o.\u0275\u0275listener("click",function(){const i=o.\u0275\u0275restoreView(t).$implicit,s=o.\u0275\u0275nextContext(2);return o.\u0275\u0275resetView(s.editEntityInGroup(i))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(15,"button",19),o.\u0275\u0275listener("click",function(){const i=o.\u0275\u0275restoreView(t).$implicit,s=o.\u0275\u0275nextContext(2);return o.\u0275\u0275resetView(s.deleteEntityFromGroup(i.entityId,i.groupId))}),o.\u0275\u0275elementEnd()()()(),o.\u0275\u0275elementStart(16,"div",32),o.\u0275\u0275text(17),o.\u0275\u0275elementEnd()()()()}if(c&2){const t=e.$implicit,n=o.\u0275\u0275reference(13);o.\u0275\u0275advance(3),o.\u0275\u0275property("ngStyle",o.\u0275\u0275pureFunction1(5,Ns,"url("+(t.entityRecordData==null?null:t.entityRecordData.image)+")")),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(t.entityRecordData.type),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(t.entityRecordData.name),o.\u0275\u0275advance(2),o.\u0275\u0275property("matMenuTriggerFor",n),o.\u0275\u0275advance(6),o.\u0275\u0275textInterpolate(t.comment)}}function Fs(c,e){if(c&1){const t=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"mat-list-item",4)(1,"mat-expansion-panel",5)(2,"mat-expansion-panel-header",6)(3,"div",7)(4,"div",8),o.\u0275\u0275element(5,"mat-icon",9),o.\u0275\u0275elementStart(6,"div",10)(7,"div",11),o.\u0275\u0275text(8),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(9,"div",12),o.\u0275\u0275text(10),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(11,"div",13),o.\u0275\u0275template(12,Bs,1,0,"button",14),o.\u0275\u0275elementStart(13,"button",15),o.\u0275\u0275listener("click",function(i){return o.\u0275\u0275restoreView(t),o.\u0275\u0275resetView(i==null?null:i.stopPropagation())}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(14,"mat-menu",16,0)(16,"button",17),o.\u0275\u0275listener("click",function(i){const s=o.\u0275\u0275restoreView(t).$implicit,a=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(a.toggleHighlightGroup(i,s.id))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(17,"button",18),o.\u0275\u0275listener("click",function(){const i=o.\u0275\u0275restoreView(t).$implicit,s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.editGroup(i))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(18,"button",19),o.\u0275\u0275listener("click",function(){const i=o.\u0275\u0275restoreView(t).$implicit,s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.deleteGroup(i.id))}),o.\u0275\u0275elementEnd()()()()(),o.\u0275\u0275elementStart(19,"mat-list",20),o.\u0275\u0275template(20,Gs,18,7,"mat-list-item",21),o.\u0275\u0275elementEnd()()()}if(c&2){const t=e.$implicit,n=o.\u0275\u0275reference(15),i=o.\u0275\u0275nextContext();o.\u0275\u0275advance(),o.\u0275\u0275property("expanded",!0),o.\u0275\u0275advance(),o.\u0275\u0275property("collapsedHeight","33px")("expandedHeight","33px"),o.\u0275\u0275advance(3),o.\u0275\u0275styleProp("background",t.color),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(t.name),o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate1("(",i.getGroupEntitiesCount(t),")"),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",i.isAddEntityToGroupButtonVisible()),o.\u0275\u0275advance(),o.\u0275\u0275property("matMenuTriggerFor",n),o.\u0275\u0275advance(3),o.\u0275\u0275classProp("selectedGroup",i.highlightedGroupId===t.id),o.\u0275\u0275advance(4),o.\u0275\u0275property("ngForOf",t.entities)}}class be{set isLoading(e){this.groupContentListEventService.isLoading(e)}set filteredEntityId(e){e!==this._filteredEntityId&&(this._filteredEntityId=e)}set searchFilter(e){e!==this._searchFilter&&(this._searchFilter=e,this.renderGroup())}_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}_initializeGTM(){this._subscription.add(this.googleTagManagerService.initialize().subscribe())}constructor(e){this.injector=e,this._subscription=new x.Subscription,this._searchFilter="",this.groups=[],this.renderedGroups=[],this.searchFilterChange=new o.EventEmitter,this.changed=new o.EventEmitter,this.isRtl=!1,this.injectDependencies(),this.subscribePageEvent(),this._initializeDirectionality(),this._initializeGTM()}injectDependencies(){this.diagramEventService=this.injector.get(V),this.directionality=this.injector.get(Re.Directionality),this.googleTagManagerService=this.injector.get(Sn.A),this.relationshipDesignerService=this.injector.get(q),this.groupContentListEventService=this.injector.get(ne),this.dialogService=this.injector.get(tt.o),this.translateService=this.injector.get(k.TranslateService),this.relationshipDeleteDialogService=this.injector.get(X)}initializeGroups(){this.isLoading=!0;const e=this.relationshipDesignerService,t=this._filteredEntityId;(t?e.getGroupsDataForEntity(t):e.getGroupsData()).subscribe(i=>{if(!i?.success){this.isLoading=!1,this.showErrorDialog(i);return}this.groups=i.groups,this.renderGroup(),this.isLoading=!1})}renderGroup(){const e=(0,v.cloneDeep)(this.groups);this.renderedGroups=this.filteredGroupByFilter(e)}filteredGroupByFilter(e){const t=this._searchFilter?.toLocaleLowerCase();return t?e.filter(n=>{let i=n.entities||[];return i=i.filter(s=>{const a=s.entityRecordData?.name||"";return this.isStringContain(a,t)}),n.entities=i,i.length===0?this.isStringContain(n.name,t)?n:!1:n}):e}isStringContain(e,t){return e.toLowerCase().indexOf(t)>=0}clearSearchFilter(){this._searchFilter="",this.searchFilterChange.emit(this._searchFilter),this.renderGroup()}showErrorDialog(e){if(e?.success)return;const t=e?.errorInfo?.message||"An unknown error occurred during the operation.";this._subscription.add(this.dialogService.openInfoDialog(t).subscribe())}handleBaseDialogAction(e,t,n){e&&(this.isLoading=!0,t.call(this.relationshipDesignerService,e).subscribe(i=>this.handleBaseResponseAction(i,n)))}handleBaseResponseAction(e,t){if(!e?.success){this.isLoading=!1,this.showErrorDialog(e);return}t(),this.clearSearchFilter(),this.isLoading=!1,this.changed.emit(this.groups)}subscribePageEvent(){const e=this.groupContentListEventService;this._subscription.add(e.createGroup$.subscribe(()=>this.createGroup())),this._subscription.add(e.addEntityToGroup$.subscribe(t=>this.doAddEntityToGroup(t))),this._subscription.add(e.initializeGroups$.subscribe(()=>this.initializeGroups()))}addGroupToList(e){this.groups.push(e)}updateGroupInList(e){const t=this.groups.findIndex(n=>n.id===e.id);this.groups[t]=e}deleteGroupFromList(e){const t=this.groups.findIndex(n=>n.id===e);this.groups.splice(t,1),this.diagramEventService.entityInGroupRemoving()}doAddEntityToGroup(e){const t={panelClass:["relationship-dialog-edit"],data:{entityInGroup:e,excludedGroups:this.getExcludedGroupsList(),exludedEntityRecords:this.getExcludedEntityRecords(e)},autoFocus:!1},n=this.dialogService.open(ve,t).subscribe(i=>{this.handleBaseDialogAction(i,this.relationshipDesignerService.createEntityInGroup,()=>{this.addEntityInGroupToList(i),this.diagramEventService.entityInGroupAdded(),this.sendGtmAction({action:ke.AddEntityInGroup})})});this._subscription.add(n)}addEntityInGroupToList(e){this.initializeGroups()}updateEntityInGroupInList(e){const t=this.groups.find(i=>i.id===e.groupId),n=t.entities.findIndex(i=>i.id===e.id);t.entities[n]=e}deleteEntityInGroupFromList(e,t){const n=this.groups.find(s=>s.id===t),i=n.entities.findIndex(s=>s.entityId===e);n.entities.splice(i,1)}getExcludedGroupsList(){return this._filteredEntityId?this.groups.map(e=>e.id):[]}getExcludedEntityRecords(e){if(this._filteredEntityId||!e.groupId)return[];const t=[];return this.groups.find(i=>i.id===e.groupId).entities?.forEach(i=>t.push(i.entityRecordData.id)),t}sendGtmAction(e){const t={moduleName:"RelationshipDesignerModule",schemaName:"GroupContentListComponent"};e&&t&&this.googleTagManagerService.track((0,v.merge)(t,e))}getGroupEntitiesCount(e){return e.entities?.length||0}ngOnInit(){this.initializeGroups()}ngOnDestroy(){this._subscription.unsubscribe()}createGroup(){const e={panelClass:["relationship-dialog-edit"],data:{}},t=this.dialogService.open(xe,e).subscribe(n=>{this.handleBaseDialogAction(n,this.relationshipDesignerService.createGroup,()=>{this.addGroupToList(n),this.sendGtmAction({action:ke.AddGroup})})});this._subscription.add(t)}editGroup(e){const t=Object.assign({},e),n={panelClass:["relationship-dialog-edit"],data:{group:t}},i=this.dialogService.open(xe,n).subscribe(s=>{this.handleBaseDialogAction(s,this.relationshipDesignerService.updateGroup,()=>this.updateGroupInList(s))});this._subscription.add(i)}deleteGroup(e){const t=this.relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage").subscribe(n=>{n&&(this.isLoading=!0,this.relationshipDesignerService.deleteGroup(e).subscribe(i=>{this.handleBaseResponseAction(i,()=>this.deleteGroupFromList(e))}))});this._subscription.add(t)}toggleHighlightGroup(e,t){e?.stopPropagation(),this.highlightedGroupId=t!==this.highlightedGroupId?t:null,this.diagramEventService.highlightGroup(this.highlightedGroupId)}addEntityToGroup(e,t){e?.stopPropagation(),this.doAddEntityToGroup({groupId:t})}editEntityInGroup(e){const t={panelClass:["relationship-dialog-edit"],data:{entityInGroup:Object.assign({},e)}},n=this.dialogService.open(ve,t).subscribe(i=>{this.handleBaseDialogAction(i,this.relationshipDesignerService.updateEntityInGroup,()=>this.updateEntityInGroupInList(i))});this._subscription.add(n)}deleteEntityFromGroup(e,t){const n=this.relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage").subscribe(i=>{i&&this.relationshipDesignerService.deleteEntityInGroup(e,t).subscribe(s=>{this.handleBaseResponseAction(s,()=>this.deleteEntityInGroupFromList(e,t))})});this._subscription.add(n)}isAddEntityToGroupButtonVisible(){return!this._filteredEntityId}static{this.\u0275fac=function(t){return new(t||be)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:be,selectors:[["crt-group-content-list"]],hostVars:2,hostBindings:function(t,n){t&2&&o.\u0275\u0275classProp("rtl",n.isRtl)},inputs:{filteredEntityId:"filteredEntityId",searchFilter:"searchFilter"},outputs:{searchFilterChange:"searchFilterChange",changed:"changed"},decls:2,vars:1,consts:[["matGroupItemMenu","matMenu"],["matGroupEntityItemMenu","matMenu"],[1,"group-list"],["class","group-list-item",4,"ngFor","ngForOf"],[1,"group-list-item"],[3,"expanded"],[3,"collapsedHeight","expandedHeight"],[1,"group-list-item-content"],[1,"group-list-item-info"],["matListIcon","",1,"group-icon"],[1,"group-caption-block"],[1,"group-caption"],[1,"group-caption-count"],[1,"group-list-item-actions"],["disableRipple","","mat-icon-button","","class","group-add-icon",3,"click",4,"ngIf"],["disableRipple","","mat-icon-button","",1,"group-menu-button",3,"click","matMenuTriggerFor"],["xPosition","before","yPosition","above",1,"relationship-group-menu"],["mat-menu-item","",1,"highlight",3,"click"],["mat-menu-item","",1,"edit",3,"click"],["mat-menu-item","",1,"delete",3,"click"],[1,"group-entity-list"],["class","group-entity-list-item",4,"ngFor","ngForOf"],["disableRipple","","mat-icon-button","",1,"group-add-icon",3,"click"],[1,"group-entity-list-item"],[1,"group-entity-list-item-info"],[1,"entity-logo"],[1,"logo",3,"ngStyle"],[1,"entity-info"],[1,"entity-type"],[1,"entity-name"],[1,"group-entity-list-item-actions"],["disableRipple","","mat-icon-button","",1,"group-menu-button",3,"matMenuTriggerFor"],[1,"entity-comment"]],template:function(t,n){t&1&&(o.\u0275\u0275elementStart(0,"mat-list",2),o.\u0275\u0275template(1,Fs,21,12,"mat-list-item",3),o.\u0275\u0275elementEnd()),t&2&&(o.\u0275\u0275advance(),o.\u0275\u0275property("ngForOf",n.renderedGroups))},dependencies:[P.NgForOf,P.NgIf,P.NgStyle,J.MatLegacyButton,he.MatExpansionPanel,he.MatExpansionPanelHeader,ot.MatIcon,Ie.MatList,Ie.MatListItem,ie.MatLegacyMenu,ie.MatLegacyMenuItem,ie.MatLegacyMenuTrigger],styles:[".rtl[_nghost-%COMP%]   .group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-icon[_ngcontent-%COMP%]{margin-left:7px;margin-right:0}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]{display:flex}.group-list-item-content[_ngcontent-%COMP%]{display:flex;width:100%;height:33px}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-icon[_ngcontent-%COMP%]{height:12px;width:12px;padding:0;margin-right:7px}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-caption-block[_ngcontent-%COMP%]{width:212px;display:flex;flex-direction:row}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-caption-block[_ngcontent-%COMP%]   .group-caption[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-caption-block[_ngcontent-%COMP%]   .group-caption-count[_ngcontent-%COMP%]{white-space:pre}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-actions[_ngcontent-%COMP%]{display:flex;align-items:center;opacity:0}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-actions[_ngcontent-%COMP%]   .group-add-icon[_ngcontent-%COMP%]{margin:0}.mat-expansion-panel-header[_ngcontent-%COMP%]:hover   .group-list-item-content[_ngcontent-%COMP%]   .group-list-item-actions[_ngcontent-%COMP%]{opacity:unset}.entity-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}.entity-logo[_ngcontent-%COMP%]{min-height:100%;width:42px;display:flex;flex-direction:column;justify-content:center}.entity-logo[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{height:32px;width:32px;border-radius:16px;background-position:center;background-repeat:no-repeat}"]})}}const Vs=c=>({"background-image":c});function Hs(c,e){if(c&1){const t=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"mat-list-item",3)(1,"div",4)(2,"div",5),o.\u0275\u0275element(3,"div",6),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(4,"div",7)(5,"div",8),o.\u0275\u0275text(6),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(7,"div",9)(8,"div"),o.\u0275\u0275text(9),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(10,"div",10),o.\u0275\u0275element(11,"button",11),o.\u0275\u0275elementStart(12,"mat-menu",12,0)(14,"button",13),o.\u0275\u0275listener("click",function(){const i=o.\u0275\u0275restoreView(t).$implicit,s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.edit(i))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(15,"button",14),o.\u0275\u0275listener("click",function(){const i=o.\u0275\u0275restoreView(t).$implicit,s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.delete(i))}),o.\u0275\u0275elementEnd()()()(),o.\u0275\u0275elementStart(16,"div",15),o.\u0275\u0275text(17),o.\u0275\u0275elementEnd()()()()}if(c&2){const t=e.$implicit,n=o.\u0275\u0275reference(13);o.\u0275\u0275advance(3),o.\u0275\u0275property("ngStyle",o.\u0275\u0275pureFunction1(5,Vs,"url("+t.image+")")),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(t.typeCaption),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(t.entityCaption),o.\u0275\u0275advance(2),o.\u0275\u0275property("matMenuTriggerFor",n),o.\u0275\u0275advance(6),o.\u0275\u0275textInterpolate(t.comment)}}class ze{constructor(e){this.injector=e,this.subscription=new x.Subscription,this.isRtl=!1,this.injectDependencies(),this._initializeDirectionality()}_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}injectDependencies(){this.designerService=this.injector.get(q),this.diagramEventService=this.injector.get(V),this.dialogService=this.injector.get(tt.o),this.translateService=this.injector.get(k.TranslateService),this.directionality=this.injector.get(Re.Directionality),this.relationshipDeleteDialogService=this.injector.get(X)}showErrorDialog(e){if(e?.success)return;const t=e?.errorInfo?.message||"An unknown error occurred during the operation.";this.subscription.add(this.dialogService.openInfoDialog(t).subscribe())}ngOnDestroy(){this.subscription.unsubscribe()}edit(e){this.diagramEventService.elementDoubleClick$.next(e.id)}delete(e){this.relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage").subscribe(t=>{t&&this.designerService.deleteConnection(e.originalId).subscribe(n=>{if(!n?.success){this.showErrorDialog(n);return}this.diagramEventService.diagramChanged$.next()})})}static{this.\u0275fac=function(t){return new(t||ze)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:ze,selectors:[["crt-related-list"]],hostVars:2,hostBindings:function(t,n){t&2&&o.\u0275\u0275classProp("rtl",n.isRtl)},inputs:{relatedItems:"relatedItems"},decls:2,vars:1,consts:[["matRelatedItemMenu","matMenu"],[1,"related-list"],["class","related-list-item",4,"ngFor","ngForOf"],[1,"related-list-item"],[1,"related-list-item-info"],[1,"related-entity-logo"],[1,"logo",3,"ngStyle"],[1,"related-info"],[1,"related-type-caption"],[1,"related-entity-name"],[1,"related-list-item-actions"],["mat-icon-button","",1,"related-item-menu-button",3,"matMenuTriggerFor"],["xPosition","before","yPosition","above",1,"relationship-group-menu"],["mat-menu-item","",1,"edit",3,"click"],["mat-menu-item","",1,"delete",3,"click"],[1,"related-comment"]],template:function(t,n){t&1&&(o.\u0275\u0275elementStart(0,"mat-list",1),o.\u0275\u0275template(1,Hs,18,7,"mat-list-item",2),o.\u0275\u0275elementEnd()),t&2&&(o.\u0275\u0275advance(),o.\u0275\u0275property("ngForOf",n.relatedItems))},dependencies:[P.NgForOf,P.NgStyle,J.MatLegacyButton,Ie.MatList,Ie.MatListItem,ie.MatLegacyMenu,ie.MatLegacyMenuItem,ie.MatLegacyMenuTrigger],styles:[".rtl[_nghost-%COMP%]   .related-list-item-info[_ngcontent-%COMP%]   .related-info[_ngcontent-%COMP%]   .related-type-caption[_ngcontent-%COMP%]{padding-right:0;padding-left:20px}.rtl[_nghost-%COMP%]   .related-list-item-info[_ngcontent-%COMP%]   .related-info[_ngcontent-%COMP%]   .related-comment[_ngcontent-%COMP%]{padding-right:0;padding-left:20px}"]})}}const Us=c=>({"background-image":c});function Ws(c,e){c&1&&o.\u0275\u0275element(0,"ts-mask",13)}function Zs(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275element(4,"input",18),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Type")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.type)}}function Ys(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275element(4,"input",18),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Address")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.address)}}function Qs(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275element(4,"input",19),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Phone")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.phone)}}function $s(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275element(4,"input",20),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Email")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.email)}}function Js(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275element(4,"input",20),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Web")),o.\u0275\u0275advance(2),o.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.web)}}function Ks(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header",15)(2,"mat-panel-title"),o.\u0275\u0275text(3),o.\u0275\u0275pipe(4,"translate"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275template(5,Zs,5,4,"mat-form-field",16)(6,Ys,5,4,"mat-form-field",16)(7,Qs,5,4,"mat-form-field",16)(8,$s,5,4,"mat-form-field",16)(9,Js,5,4,"mat-form-field",16),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275property("expanded",!0),o.\u0275\u0275advance(),o.\u0275\u0275property("collapsedHeight","48px")("expandedHeight","48px"),o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(4,9,"ContainerPropertiesPage.GeneralInformation")),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.type)),o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.address)),o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.phone)),o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.email)),o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.web))}}function Xs(c,e){if(c&1){const t=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header",15)(2,"mat-panel-title"),o.\u0275\u0275text(3),o.\u0275\u0275pipe(4,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(5,"button",21),o.\u0275\u0275listener("click",function(i){o.\u0275\u0275restoreView(t);const s=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(s.addToGroup(i))}),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(6,"crt-group-content-list",22),o.\u0275\u0275listener("changed",function(){o.\u0275\u0275restoreView(t);const i=o.\u0275\u0275nextContext();return o.\u0275\u0275resetView(i.onGroupsChanged())}),o.\u0275\u0275elementEnd()()}if(c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275property("expanded",t.isGroupsChanged),o.\u0275\u0275advance(),o.\u0275\u0275property("collapsedHeight","48px")("expandedHeight","48px"),o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(4,5,"ContainerPropertiesPage.Groups")),o.\u0275\u0275advance(3),o.\u0275\u0275property("filteredEntityId",t.elementData==null?null:t.elementData.originalId)}}function qs(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header",15)(2,"mat-panel-title"),o.\u0275\u0275text(3),o.\u0275\u0275elementEnd()(),o.\u0275\u0275element(4,"crt-related-list",23),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275property("expanded",!0),o.\u0275\u0275advance(),o.\u0275\u0275property("collapsedHeight","48px")("expandedHeight","48px"),o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(t.getRelatedContactsCaption()),o.\u0275\u0275advance(),o.\u0275\u0275property("relatedItems",t.relatedContacts)}}function ea(c,e){if(c&1&&(o.\u0275\u0275elementStart(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header",15)(2,"mat-panel-title"),o.\u0275\u0275text(3),o.\u0275\u0275elementEnd()(),o.\u0275\u0275element(4,"crt-related-list",23),o.\u0275\u0275elementEnd()),c&2){const t=o.\u0275\u0275nextContext();o.\u0275\u0275property("expanded",!0),o.\u0275\u0275advance(),o.\u0275\u0275property("collapsedHeight","48px")("expandedHeight","48px"),o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(t.getRelatedAccountsCaption()),o.\u0275\u0275advance(),o.\u0275\u0275property("relatedItems",t.relatedAccounts)}}class Ae extends pe{constructor(e){super(e),this.isGroupsChanged=!1,this.pageLink="",this.relatedAccounts=[],this.relatedContacts=[]}injectDependencies(){super.injectDependencies(),this.groupContentListEventService=this.injector.get(ne),this.linkGenerator=this.injector.get(Ee)}subscribeEvents(){super.subscribeEvents(),this.subscription.add(this.groupContentListEventService.isLoading$.subscribe(e=>this.isLoading=e))}onDataInitialized(){super.onDataInitialized(),this.initializePageLinkTool(),this.showMask();const e=this.elementData.originalId||this.elementData.id;this.designerService.getRecordEntityInfo(e).subscribe(t=>{if(!t?.success){this.hideMask(),this.showErrorDialog(t);return}this.initializeRecordEntityInfo(t.recordEntityInfo),this.fillRelatedAccounts(),this.fillRelatedContacts(),this.hideMask()})}initializePageLinkTool(){const e=this.elementConfig.entitySchemaData.name,t=this.elementData.recordId;this.subscription.add(this.linkGenerator.buildPageUrl(e,t).subscribe(n=>this.pageLink=n))}initializeRecordEntityInfo(e){this.elementData.recordInfo=e}isChanged(){return super.isChanged()||this.isGroupsChanged}getRelatedElementCaption(e,t=""){const n=this.translateService.instant("ContainerPropertiesPage.RelationshipsWith"),s=this.getElementConfig(e)?.entitySchemaData?.caption||t;return Os.String.Format(n,s)}getRelatedItems(e){const t=this.elementData.id,n=[],i=M,s=[i.connection,i.indirectConnection],a=e===i.relationshipContainer?"Contact":"Account";return this.elementConfig?.caption===a&&s.push(i.parentConnection),Object.values(this.data.connections).filter(l=>s.includes(l.type)).forEach(l=>{let p;if(l.source===t)p=l.target;else if(l.target===t)p=l.source;else return;const g=this.data.elements[p];if(g?.type===e&&g?.canRead){const h=g,C=h.largeImage||this.getElementConfig(h.type).largeImage,m={id:l.id,originalId:l.originalId,image:C,typeCaption:l.relationshipType.name,entityCaption:h.caption,comment:l.comment};n.push(m)}}),n}isDescriptionVisible(){const e=this.elementData?.recordInfo||{};return!!e.type||!!e.address||!!e.phone||!!e.email||!!e.web}onGroupsChanged(){this.isGroupsChanged=!0}isGroupVisible(){return this.elementConfig?.caption==="Contact"}isRelatedAccountsVisible(){return!0}isRelatedContactsVisible(){return!0}addToGroup(e){e.stopPropagation();const t={entityId:this.elementData.originalId};this.groupContentListEventService.addEntityToGroup(t)}fillRelatedAccounts(){this.relatedAccounts=this.getRelatedItems(M.relationshipContainer)}fillRelatedContacts(){this.relatedContacts=this.getRelatedItems(M.relationshipItem)}getRelatedContactsCaption(){return this.getRelatedElementCaption(M.relationshipItem)}getRelatedAccountsCaption(){return this.getRelatedElementCaption(M.relationshipContainer)}static{this.\u0275fac=function(t){return new(t||Ae)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:Ae,selectors:[["crt-container-properties-page"]],features:[o.\u0275\u0275InheritDefinitionFeature],decls:19,vars:11,consts:[["class","component-mask",4,"ngIf"],[1,"header"],[1,"title-wrap"],[1,"logo-wrap"],[1,"logo",3,"ngStyle"],[1,"title"],[1,"sub-title"],[1,"tools-group-wrap"],[1,"entity-info"],[1,"tools"],["target","_blank",1,"tool","open-card",3,"href"],[1,"content"],[3,"expanded",4,"ngIf"],[1,"component-mask"],[3,"expanded"],[3,"collapsedHeight","expandedHeight"],["floatLabel","always",4,"ngIf"],["floatLabel","always"],["type","text","matInput","","disabled","",3,"value"],["type","tel","matInput","","disabled","",3,"value"],["type","email","matInput","","disabled","",3,"value"],["mat-icon-button","",1,"group-add-icon",3,"click"],[3,"changed","filteredEntityId"],[3,"relatedItems"]],template:function(t,n){t&1&&(o.\u0275\u0275template(0,Ws,1,0,"ts-mask",0),o.\u0275\u0275elementStart(1,"div",1)(2,"div",2)(3,"div",3),o.\u0275\u0275element(4,"div",4),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(5,"div",5)(6,"div",6),o.\u0275\u0275text(7),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(8,"div"),o.\u0275\u0275text(9),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(10,"div",7),o.\u0275\u0275element(11,"div",8),o.\u0275\u0275elementStart(12,"div",9),o.\u0275\u0275element(13,"a",10),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(14,"div",11),o.\u0275\u0275template(15,Ks,10,11,"mat-expansion-panel",12)(16,Xs,7,7,"mat-expansion-panel",12)(17,qs,5,5,"mat-expansion-panel",12)(18,ea,5,5,"mat-expansion-panel",12),o.\u0275\u0275elementEnd()),t&2&&(o.\u0275\u0275property("ngIf",n.isLoading),o.\u0275\u0275advance(4),o.\u0275\u0275property("ngStyle",o.\u0275\u0275pureFunction1(9,Us,"url("+(n.elementData==null?null:n.elementData.largeImage)+")")),o.\u0275\u0275advance(3),o.\u0275\u0275textInterpolate(n.elementData==null?null:n.elementData.subCaption),o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(n.elementData==null?null:n.elementData.caption),o.\u0275\u0275advance(4),o.\u0275\u0275property("href",n.pageLink,o.\u0275\u0275sanitizeUrl),o.\u0275\u0275advance(2),o.\u0275\u0275property("ngIf",n.isDescriptionVisible()),o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",n.isGroupVisible()),o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",n.isRelatedContactsVisible()),o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",n.isRelatedAccountsVisible()))},dependencies:[P.NgIf,P.NgStyle,Pt.I,J.MatLegacyButton,he.MatExpansionPanel,he.MatExpansionPanelHeader,he.MatExpansionPanelTitle,W.MatLegacyFormField,W.MatLegacyLabel,ue.MatLegacyInput,be,ze,k.TranslatePipe],styles:["[_nghost-%COMP%]{display:block;position:relative;height:100%}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-right:0}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-right:10px;text-align:right}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.open-card[_ngcontent-%COMP%]{transform:rotate(-90deg)}.rtl[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:right}.header[_ngcontent-%COMP%]{max-width:343px;padding:12px 20px 0;min-height:97px;max-height:135px;border-top-left-radius:8px;border-top-right-radius:8px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]{height:56px;margin-top:5px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-top:7px;flex:0 0 69px;width:72px;height:56px;display:inline-flex;justify-content:center;align-items:center;margin-right:16px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:inline-block;letter-spacing:0px;text-align:left;margin-top:3px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;margin-top:7px;margin-right:10px;justify-content:flex-end;align-items:center}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{width:16px;height:16px;font-size:16px}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;width:100%;position:absolute;overflow-x:hidden;overflow-y:auto;height:auto;bottom:0;top:135px}.content[_ngcontent-%COMP%]:last-child{padding-bottom:0}.content[_ngcontent-%COMP%]   .text-area[_ngcontent-%COMP%]{min-width:150px;width:100%}.content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:left;letter-spacing:0px}",".rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{margin-right:-10px}.header[_ngcontent-%COMP%]{display:flex;min-height:97px;justify-content:space-between}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%;width:100%;max-width:290px;min-width:290px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background-size:contain;width:100%;height:100%}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:0;height:49px;margin-bottom:2px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:29px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{min-width:24px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .entity-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;align-items:center;width:50%}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{width:50%;align-items:flex-start}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.open-card[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTEiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAxMSAxMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik02LjE3NTUzIDAuODAxODE3QzYuMTc1NTMgMC4zNTg5ODYgNi41MzQ1MiAwIDYuOTc3MzUgMEgxMC4xMDE3QzEwLjU5NzUgMCAxMC45OTk1IDAuNDAxOTggMTAuOTk5NSAwLjg5Nzg0M1Y0LjAyMjE3QzEwLjk5OTUgNC40NjUgMTAuNjQwNSA0LjgyMzk4IDEwLjE5NzcgNC44MjM5OEM5Ljc1NDg3IDQuODIzOTggOS4zOTU4OCA0LjQ2NSA5LjM5NTg4IDQuMDIyMTdWMi43Mzk5M0w1LjExMTA0IDcuMDM0MDhDNC43OTgyNSA3LjM0NzU1IDQuMjkwNTcgNy4zNDgxIDMuOTc3MSA3LjAzNTMxQzMuNjYzNjMgNi43MjI1MiAzLjY2MzA4IDYuMjE0ODQgMy45NzU4NyA1LjkwMTM3TDguMjY0MyAxLjYwMzYzSDYuOTc3MzVDNi41MzQ1MiAxLjYwMzYzIDYuMTc1NTMgMS4yNDQ2NSA2LjE3NTUzIDAuODAxODE3Wk0yLjcyMjM0IDEuNjAzNjNDMi4xMDQ0OSAxLjYwMzYzIDEuNjAzNjMgMi4xMDQ0OSAxLjYwMzYzIDIuNzIyMzRWOC4yNzc1OUMxLjYwMzYzIDguODk1NDMgMi4xMDQ0OSA5LjM5NjI5IDIuNzIyMzQgOS4zOTYyOUg4LjI3NzU5QzguODk1NDMgOS4zOTYyOSA5LjM5NjI5IDguODk1NDMgOS4zOTYyOSA4LjI3NzU5VjcuMjgxMzlDOS4zOTYyOSA2LjgzODU2IDkuNzU1MjcgNi40Nzk1OCAxMC4xOTgxIDYuNDc5NThDMTAuNjQwOSA2LjQ3OTU4IDEwLjk5OTkgNi44Mzg1NiAxMC45OTk5IDcuMjgxMzlWOC4yNzc1OUMxMC45OTk5IDkuNzgxMDkgOS43ODEwOSAxMC45OTk5IDguMjc3NTkgMTAuOTk5OUgyLjcyMjM0QzEuMjE4ODMgMTAuOTk5OSAwIDkuNzgxMDkgMCA4LjI3NzU5VjIuNzIyMzRDMCAxLjIxODgzIDEuMjE4ODMgMCAyLjcyMjM0IDBIMy42ODc0NkM0LjEzMDI5IDAgNC40ODkyOCAwLjM1ODk4NiA0LjQ4OTI4IDAuODAxODE3QzQuNDg5MjggMS4yNDQ2NSA0LjEzMDI5IDEuNjAzNjMgMy42ODc0NiAxLjYwMzYzSDIuNzIyMzRaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K);background-position:center;background-repeat:no-repeat}.content[_ngcontent-%COMP%]{top:99px;border-bottom-left-radius:8px;border-bottom-right-radius:8px}.content[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{padding-bottom:0;margin-top:0}.content[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]   .group-add-icon[_ngcontent-%COMP%]{margin:0;opacity:0}.content[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]:hover   .group-add-icon[_ngcontent-%COMP%]{opacity:unset}"]})}}function ta(c,e){c&1&&o.\u0275\u0275element(0,"ts-mask",15)}class Ne extends pe{constructor(e){super(e),this.isGroupsChanged=!1,this.searchFilter=""}injectDependencies(){super.injectDependencies(),this.groupContentListEventService=this.injector.get(ne)}subscribeEvents(){super.subscribeEvents(),this.subscription.add(this.groupContentListEventService.isLoading$.subscribe(e=>this.isLoading=e))}isChanged(){return super.isChanged()||this.isGroupsChanged}onGroupsChanged(){this.isGroupsChanged=!0}createGroup(){this.groupContentListEventService.createGroup()}onSearchFilterValueChanged(e){this.searchFilter=e}static{this.\u0275fac=function(t){return new(t||Ne)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:Ne,selectors:[["crt-groups-properties-page"]],features:[o.\u0275\u0275InheritDefinitionFeature],decls:18,vars:9,consts:[["class","component-mask",4,"ngIf"],[1,"header"],[1,"title-wrap"],[1,"logo-wrap"],[1,"logo"],[1,"title"],[1,"tools-group-wrap"],[1,"search-tool"],["floatLabel","never",1,"search-input"],["matInput","","type","text","spellcheck","false","autocomplete","off",1,"search-input-field",3,"keyup","placeholder","value"],["matSuffix","",1,"search-icon"],[1,"tools"],["mat-icon-button","",1,"tool","add-icon",3,"click"],[1,"content"],[3,"searchFilterChange","changed","searchFilter"],[1,"component-mask"]],template:function(t,n){t&1&&(o.\u0275\u0275template(0,ta,1,0,"ts-mask",0),o.\u0275\u0275elementStart(1,"div",1)(2,"div",2)(3,"div",3),o.\u0275\u0275element(4,"div",4),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(5,"div",5),o.\u0275\u0275text(6),o.\u0275\u0275pipe(7,"translate"),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(8,"div",6)(9,"div",7)(10,"mat-form-field",8)(11,"input",9),o.\u0275\u0275pipe(12,"translate"),o.\u0275\u0275listener("keyup",function(s){return n.onSearchFilterValueChanged(s.target.value)}),o.\u0275\u0275elementEnd(),o.\u0275\u0275element(13,"mat-icon",10),o.\u0275\u0275elementEnd()(),o.\u0275\u0275elementStart(14,"div",11)(15,"button",12),o.\u0275\u0275listener("click",function(){return n.createGroup()}),o.\u0275\u0275elementEnd()()()(),o.\u0275\u0275elementStart(16,"div",13)(17,"crt-group-content-list",14),o.\u0275\u0275twoWayListener("searchFilterChange",function(s){return o.\u0275\u0275twoWayBindingSet(n.searchFilter,s)||(n.searchFilter=s),s}),o.\u0275\u0275listener("changed",function(){return n.onGroupsChanged()}),o.\u0275\u0275elementEnd()()),t&2&&(o.\u0275\u0275property("ngIf",n.isLoading),o.\u0275\u0275advance(6),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(7,5,"GroupsPropertiesPage.Title")),o.\u0275\u0275advance(5),o.\u0275\u0275property("placeholder",o.\u0275\u0275pipeBind1(12,7,"GroupsPropertiesPage.Search"))("value",n.searchFilter),o.\u0275\u0275advance(6),o.\u0275\u0275twoWayProperty("searchFilter",n.searchFilter))},dependencies:[P.NgIf,Pt.I,J.MatLegacyButton,ot.MatIcon,W.MatLegacyFormField,W.MatLegacySuffix,ue.MatLegacyInput,be,k.TranslatePipe],styles:["[_nghost-%COMP%]{display:block;position:relative;height:100%}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-right:0}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-right:10px;text-align:right}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.open-card[_ngcontent-%COMP%]{transform:rotate(-90deg)}.rtl[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:right}.header[_ngcontent-%COMP%]{max-width:343px;padding:12px 20px 0;min-height:97px;max-height:135px;border-top-left-radius:8px;border-top-right-radius:8px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]{height:56px;margin-top:5px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-top:7px;flex:0 0 69px;width:72px;height:56px;display:inline-flex;justify-content:center;align-items:center;margin-right:16px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:inline-block;letter-spacing:0px;text-align:left;margin-top:3px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;margin-top:7px;margin-right:10px;justify-content:flex-end;align-items:center}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{width:16px;height:16px;font-size:16px}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;width:100%;position:absolute;overflow-x:hidden;overflow-y:auto;height:auto;bottom:0;top:135px}.content[_ngcontent-%COMP%]:last-child{padding-bottom:0}.content[_ngcontent-%COMP%]   .text-area[_ngcontent-%COMP%]{min-width:150px;width:100%}.content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:left;letter-spacing:0px}",".rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{display:flex}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzOS4xOTEiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzOS4xOTEgMzIiPjxkZWZzPjxzdHlsZT4uYSwuYntmaWxsOm5vbmU7fS5he3N0cm9rZTojMDA2Y2UwO3N0cm9rZS1taXRlcmxpbWl0OjEwO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzLjM5NCAtMC40MDMpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjEwNiA1LjUzMikiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMwMi42MTYsNDc5LjQ2N2E1LjUyOSw1LjUyOSwwLDAsMC01LjUyNy01LjUzMiw1LjUzNSw1LjUzNSwwLDAsMC01LjUzNiw1LjUzMkE1LjUzNyw1LjUzNywwLDAsMC0zMDguMTQ0LDQ4NSw1LjUzMSw1LjUzMSwwLDAsMC0zMDIuNjE2LDQ3OS40NjdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMjMuMjQ0IC00NzIuOTM1KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMwNS41MzIsNDg3LjU3M2g3Ljk4MWMwLTQtMy4wMjctNi42MzgtNy41NzItNi42MzhhOS41LDkuNSwwLDAsMC0zLjQ5Mi42MTciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMzMS43NDIgLTQ2OC40NDYpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMjk5Ljc2NCw0NzkuODZhNC40MjcsNC40MjcsMCwwLDAtNC40MjUtNC40MjUsNC40MjYsNC40MjYsMCwwLDAtNC40MjUsNC40MjUsNC40MjcsNC40MjcsMCwwLDAsNC40MjUsNC40MzJBNC40MjksNC40MjksMCwwLDAtMjk5Ljc2NCw0NzkuODZaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMzAuNzQ1IC00NzIuMTE2KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMxMC43NTEsNDg3LjU3M2gtNy45NzljMC00LDMuMDI4LTYuNjM4LDcuNTctNi42MzhhOS41MjcsOS41MjcsMCwwLDEsMy40OTMuNjE3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTQuNzMgLTQ2OC40NDYpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMzE3LjYxNSw0NzkuODZhNC40MjQsNC40MjQsMCwwLDEsNC40MjMtNC40MjUsNC40Myw0LjQzLDAsMCwxLDQuNDI4LDQuNDI1LDQuNDMyLDQuNDMyLDAsMCwxLTQuNDI4LDQuNDMyQTQuNDI1LDQuNDI1LDAsMCwxLTMxNy42MTUsNDc5Ljg2WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzE2LjgzIC00NzIuMTE2KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTI5OC43NjQsNDg5Ljc4NmMwLTUuMzMtMy4zODMtOC44NTEtOC40NTctOC44NTFzLTguNDU3LDMuNTIxLTguNDU3LDguODUxWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzIyLjMxNiAtNDY4LjQ0NikiLz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAwLjQwMykiLz48L2c+PC9zdmc+);width:40px;height:32px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]{width:100%;padding-right:10px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{font-size:16px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]:before{margin-top:10px;position:absolute}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .add-icon[_ngcontent-%COMP%]{margin-bottom:6px;font-size:18px;height:24px;width:24px}"]})}}var na=u(38054);const ia=["card"],oa=[[["","caption",""]],[["","tools",""]]],sa=["[caption]","[tools]"],aa=c=>({pressed:c});function ra(c,e){c&1&&o.\u0275\u0275element(0,"ts-mask",12)}function la(c,e){}class _e{get diagramData(){return this._config?.data}get diagramConfig(){return this._config?.config}set data(e){e!==this._inputData&&(this._inputData=e,this.clearDiagramData(),this.loadDiagram())}_showResponseErorrs(e){if(e.length){const n=(0,v.uniq)(e).join(`
	`);this.showErrorDialog(n)}}_getDeleteItem(e){return new Promise(t=>{this._getDeleteItemObservable(e.id,e.originalId).subscribe(i=>{i?.success?t():t(this.getErrorResponseMessage(i))})})}_getDeleteItemObservable(e,t){return this.diagramData.connections[e]?this.designerService.deleteConnection(t):this.designerService.deleteEntity(t)}_getItem(e){return this.diagramData.elements[e]||this.diagramData.connections[e]}_getElementConfig(e){return e&&this.diagramConfig?.customDiagramElements[e]}_getCardTypeByElementId(e){const t=this._getItem(e);if(!t)throw new Error(`Not found element with id: ${e}`);return this._getCardTypeElementType(t.type)}_getCardTypeElementType(e){switch(e){case M.relationshipContainer:case M.relationshipItem:return Ae;case M.connection:case M.indirectConnection:case M.parentConnection:return ge;default:throw new Error(`Not implemented properties page for type: ${e}`)}}_confirmRemoving(){var e=this;return(0,j.A)(function*(){return yield(0,x.firstValueFrom)(e.relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage"))})()}_getExistDiagramItems(e){const t=[];return e.forEach(n=>{const i=this._getItem(n);i&&t.push(i)}),t}_deleteEntities(e){var t=this;return(0,j.A)(function*(){t.showMask();const i=t._getExistDiagramItems(e).map(a=>t._getDeleteItem(a));let s=!1;return yield Promise.all(i).then(a=>{a=a.filter(l=>l&&l!==""),t._showResponseErorrs(a),s=a.length<e.length}),t.sendGtmAction({action:ke.DeleteElement}),t.hideMask(),s})()}_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}_initializeGTM(){this._subscription.add(this.googleTagManagerService.initialize().subscribe())}constructor(e){this.injector=e,this._subscription=new x.Subscription,this.allowFullScreenMode=!0,this.isCardShowed=!1,this.isLoading=!1,this.isLoadingPending=!1,this.showMaskDelay=100,this.isGroupsCardOpen=!1,this.isFullscreenMode=!1,this.isRtl=!1,this.injectDependencies(),this.subscribeEvents(),this._initializeDirectionality(),this._initializeGTM()}showMask(){this.isLoadingPending=!0,setTimeout(()=>{this.isLoadingPending&&(this.isLoading=!0)},this.showMaskDelay)}hideMask(){this.isLoadingPending=!1,this.isLoading=!1,this.changeDetector.detectChanges()}injectDependencies(){this.changeDetector=this.injector.get(o.ChangeDetectorRef),this.designerService=this.injector.get(q),this.diagramEventService=this.injector.get(V),this.propertiesPageEventService=this.injector.get(de),this.dialogService=this.injector.get(tt.o),this.translateService=this.injector.get(k.TranslateService),this.notifyService=this.injector.get(Ci.F),this.directionality=this.injector.get(Re.Directionality),this.googleTagManagerService=this.injector.get(Sn.A),this.relationshipDeleteDialogService=this.injector.get(X)}subscribeEvents(){this.subscribeDiagramEvents()}subscribeDiagramEvents(){var e=this;const t=this.diagramEventService;[t.itemSelected$.subscribe(i=>{this.onItemSelected(i)}),t.highlightedGroup$.subscribe(i=>{this.onGroupHighlighted(i)}),t.elementDoubleClick$.subscribe(i=>{this.onElementDoubleClick(i)}),t.elementRemoving$.subscribe(function(){var i=(0,j.A)(function*(s){yield e.onElementRemoving(s)});return function(s){return i.apply(this,arguments)}}()),t.connectionAdding$.subscribe(i=>{this.onConnectionAdding(i)}),t.showMessage$.subscribe(i=>{this.notifyService.show({message:i,panelClass:"relationship-notify"}).then()}),t.connectionReconnect$.subscribe(function(){var i=(0,j.A)(function*(s){yield e.onConnectionReconnect(s)});return function(s){return i.apply(this,arguments)}}()),t.entityInGroupAdded$.subscribe((0,j.A)(function*(){e.loadDiagram()})),t.entityInGroupRemoving$.subscribe((0,j.A)(function*(){e.loadDiagram()})),t.diagramChanged$.subscribe((0,j.A)(function*(){e.loadDiagram()})),this.propertiesPageEventService.doCloseCard().subscribe(function(){var i=(0,j.A)(function*(s){return yield e.closeCard(s)});return function(s){return i.apply(this,arguments)}}())].forEach(i=>{this._subscription.add(i)})}loadDiagram(){this.showMask();const e=this._inputData;if(!e?.selectedRecordId||!e?.schemaName){this.clearDiagramData(),this.hideMask();return}this.designerService.getDiagram(e.selectedRecordId,e.schemaName).subscribe(t=>{if(t?.success)this.initializeDesignerConfig({data:t.data,config:t.config});else{const n=this.getErrorResponseMessage(t);this.showErrorDialog(n)}this.hideMask()})}initializeDesignerConfig(e){this._config=e,this.propertiesPageEventService.setDesignerConfig(e),this.initializeDiagram(e.config),this.loadDataToDiagram(e.data)}initializeDiagram(e){this.initializeDiagramLocalizableStrings(e),this.diagramEventService.setDiagramConfig({dialogService:this.dialogService,translateService:this.translateService,...e})}initializeDiagramLocalizableStrings(e){this.initializeDiagramToolsLocalizableStrings(e)}initializeDiagramToolsLocalizableStrings(e){const t=e.customLocalizableStrings||{},n={};["FitToView","ResetView","ZoomIn","ZoomOut","MiniMapClose","MiniMapOpen"].forEach(s=>{const a=this.translateService.instant("RelationshipDiagram.Tools."+s);s=(0,na.yF)(s),n[s]=a}),e.customLocalizableStrings=Object.assign(n,t)}loadDataToDiagram(e){this.diagramEventService.endLoading$.next(e)}openCardByElementId(e){var t=this;return(0,j.A)(function*(){let n=null;if(e){const i=t._getCardTypeByElementId(e);if(n=yield t.openCard(i),!n)return;n.id$.next(e)}return n})()}openCard(e){var t=this;return(0,j.A)(function*(){if(!(yield t.closeCard()))return;const i=t.card.createComponent(e);return t.isCardShowed=!0,i.instance})()}closeCard(e){return(0,x.lastValueFrom)(new x.Observable(t=>{e?.isForced?(this.forceCloseCard(e),t.next(!0),t.complete()):this.isCardShowed?this.saveAndCloseCard(t):(this.clearCardContainer(),t.next(!0),t.complete())}),{defaultValue:null})}forceCloseCard(e){this.clearCardContainer(),e.isNeedDiagramReload&&this.loadDiagram()}saveAndCloseCard(e){const t=this.propertiesPageEventService.saveCard().pipe((0,O.first)()).subscribe(n=>{const i=n?.success;i&&(this.clearCardContainer(),n.isChanged&&this.loadDiagram()),e.next(i),e.complete()});this._subscription.add(t)}clearCardContainer(){this.card.clear(),this.isCardShowed=!1,this.isGroupsCardOpen=!1}getErrorResponseMessage(e){return e?.errorInfo?.message||"An unknown error occurred during the operation."}showErrorDialog(e){this.hideMask(),this._subscription.add(this.dialogService.openInfoDialog(e).subscribe())}getDefaultRelationshipType(e,t){return{connectionType:this.getDefaultConnectionType(e,t)}}getDefaultConnectionType(e,t){const n=this._getItem(e),i=this._getItem(t);return n&&i?Le.getDefaultConnectionType(n,i):ce.formal}clearDiagramData(){this.loadDataToDiagram({})}sendGtmAction(e){const t={moduleName:"RelationshipDesignerModule",schemaName:"RelationshipDesignerComponent"};e&&t&&this.googleTagManagerService.track((0,v.merge)(t,e))}ngOnDestroy(){this._subscription.unsubscribe()}onItemSelected(e){var t=this;return(0,j.A)(function*(){e||(yield t.closeCard())})()}onGroupHighlighted(e){this.diagramComponent.get("eventBus").fire("relationshipGroup.highlight.changed",{id:e})}onElementDoubleClick(e){var t=this;return(0,j.A)(function*(){e?yield t.openCardByElementId(e):yield t.closeCard()})()}onElementRemoving(e){var t=this;return(0,j.A)(function*(){(yield t._confirmRemoving())&&(yield t.closeCard({isForced:!0,isNeedDiagramReload:!1}),(yield t._deleteEntities(e))&&t.loadDiagram())})()}onConnectionAdding(e){var t=this;return(0,j.A)(function*(){const n=yield t.openCard(ge);n&&(n.elementData={id:e.id,source:e.source,target:e.target,relationshipType:t.getDefaultRelationshipType(e.source,e.target),isNew:!0},n.targetConfig=t._getElementConfig(e.targetType),n.id$.next(e.id||(0,Ot.qv)()))})()}onConnectionReconnect(e){var t=this;return(0,j.A)(function*(){yield t._deleteEntities([e.id]);const n=yield t.openCard(ge);n&&(n.elementData={source:e.source,target:e.target,relationshipType:t.getDefaultRelationshipType(e.source,e.target),isNew:!0},n.id$.next((0,Ot.qv)()))})()}showGroupsCard(){var e=this;return(0,j.A)(function*(){if(e.isGroupsCardOpen)yield e.closeCard(),e.isGroupsCardOpen=!1;else{const t=yield e.openCard(Ne);t&&(t.id$.next((0,Ot.qv)()),e.isGroupsCardOpen=!0)}})()}toggleFullscreenMode(){this.isFullscreenMode=!this.isFullscreenMode}static{this.\u0275fac=function(t){return new(t||_e)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:_e,selectors:[["crt-relationship-designer"]],viewQuery:function(t,n){if(t&1&&(o.\u0275\u0275viewQuery(ia,7,o.ViewContainerRef),o.\u0275\u0275viewQuery(Ce,7)),t&2){let i;o.\u0275\u0275queryRefresh(i=o.\u0275\u0275loadQuery())&&(n.card=i.first),o.\u0275\u0275queryRefresh(i=o.\u0275\u0275loadQuery())&&(n.diagramComponent=i.first)}},hostVars:4,hostBindings:function(t,n){t&2&&o.\u0275\u0275classProp("fullscreen",n.isFullscreenMode)("rtl",n.isRtl)},inputs:{data:"data",allowFullScreenMode:"allowFullScreenMode"},ngContentSelectors:sa,decls:15,vars:8,consts:[["card",""],["class","component-mask",4,"ngIf"],[1,"designer-tools-panel"],[1,"caption-content-container"],[1,"modes"],[1,"tools"],["mat-icon-button","",1,"tool","group",3,"click","ngClass"],["mat-icon-button","",1,"tool","fullscreen",3,"click"],[1,"additional-tools-container"],[1,"designer-content"],[1,"diagram-wrap"],[1,"card-wrap"],[1,"component-mask"]],template:function(t,n){if(t&1){const i=o.\u0275\u0275getCurrentView();o.\u0275\u0275projectionDef(oa),o.\u0275\u0275template(0,ra,1,0,"ts-mask",1),o.\u0275\u0275elementStart(1,"div",2)(2,"div",3),o.\u0275\u0275projection(3),o.\u0275\u0275elementEnd(),o.\u0275\u0275element(4,"div",4),o.\u0275\u0275elementStart(5,"div",5)(6,"button",6),o.\u0275\u0275listener("click",function(){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.showGroupsCard())}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(7,"button",7),o.\u0275\u0275listener("click",function(){return o.\u0275\u0275restoreView(i),o.\u0275\u0275resetView(n.toggleFullscreenMode())}),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementStart(8,"div",8),o.\u0275\u0275projection(9,1),o.\u0275\u0275elementEnd()()(),o.\u0275\u0275elementStart(10,"div",9),o.\u0275\u0275element(11,"crt-relationship-diagram",10),o.\u0275\u0275elementStart(12,"div",11),o.\u0275\u0275template(13,la,0,0,"ng-template",null,0,o.\u0275\u0275templateRefExtractor),o.\u0275\u0275elementEnd()()}t&2&&(o.\u0275\u0275property("ngIf",n.isLoading),o.\u0275\u0275advance(6),o.\u0275\u0275property("ngClass",o.\u0275\u0275pureFunction1(6,aa,n.isGroupsCardOpen)),o.\u0275\u0275advance(),o.\u0275\u0275classProp("hidden",!n.allowFullScreenMode),o.\u0275\u0275advance(5),o.\u0275\u0275classProp("card-hidden",!n.isCardShowed))},dependencies:[P.NgClass,P.NgIf,Pt.I,J.MatLegacyButton,Ce],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;position:relative}.fullscreen[_nghost-%COMP%]{position:fixed;z-index:1999;top:0;left:0;width:100%;height:100%;background:#fff}.fullscreen[_nghost-%COMP%]   .designer-content[_ngcontent-%COMP%]{height:calc(100vh - 50px)}.fullscreen[_nghost-%COMP%]   .designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+CiAgPGRlZnM+CiAgICA8c3R5bGU+CiAgICAgIC5he2ZpbGw6IzU0NjU3ZH0uYntmaWxsOm5vbmU7c3Ryb2tlOiM1NDY1N2Q7c3Ryb2tlLW1pdGVybGltaXQ6MTB9CiAgICA8L3N0eWxlPgogIDwvZGVmcz4KICA8cGF0aCBjbGFzcz0iYSIgZD0iTTE0LjAwMyA4aC01VjN6TTguMDAzIDE0VjloLTV6Ii8+CiAgPHBhdGggY2xhc3M9ImIiIGQ9Ik0zIDE0bDQtNE0xMCA3bDQtNCIvPgogIDxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0wIDBoMTZ2MTZIMHoiLz4KPC9zdmc+Cg==) no-repeat center}.fullscreen[_nghost-%COMP%]   .designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]:hover{background:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzY3OF8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA2Nzgg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8cGF0aCBpZD0iUGF0aF82MDU3IiBkYXRhLW5hbWU9IlBhdGggNjA1NyIgZD0iTTE4MjIuNi02MGgtNXYtNVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xODA4LjU5NyA2OCkiIGZpbGw9IiMwMDZjZTAiLz4NCiAgPHBhdGggaWQ9IlBhdGhfNjA1OCIgZGF0YS1uYW1lPSJQYXRoIDYwNTgiIGQ9Ik0xODI5LjYtNjd2LTVoLTVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTgyMS41OTcgODEpIiBmaWxsPSIjMDA2Y2UwIi8+DQogIDxsaW5lIGlkPSJMaW5lXzU3OSIgZGF0YS1uYW1lPSJMaW5lIDU3OSIgeTE9IjQiIHgyPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzIDEwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDA2Y2UwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIvPg0KICA8bGluZSBpZD0iTGluZV81ODAiIGRhdGEtbmFtZT0iTGluZSA1ODAiIHkxPSI0IiB4Mj0iNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAgMykiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwNmNlMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82Mjc2IiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2Mjc2IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K) no-repeat center}.rtl[_nghost-%COMP%]   .designer-content[_ngcontent-%COMP%]{direction:rtl;text-align:right}.rtl[_nghost-%COMP%]   .designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{margin-right:10px;margin-left:10px}.rtl[_nghost-%COMP%]   .designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]{transform:rotate(90deg)}.fullscreen-overlay[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;top:0;left:0;opacity:.4;background-color:#fff;z-index:1998}.designer-tools-panel[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;height:48px;border:1px solid #dbdbdb;border-radius:8px}.designer-tools-panel[_ngcontent-%COMP%]   .modes[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.designer-tools-panel[_ngcontent-%COMP%]   .caption-content-container[_ngcontent-%COMP%]{width:100%}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;justify-content:flex-end;align-items:center;min-width:345px}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{width:16px;height:16px;margin-right:22px}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.group[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6IzU0NjU3ZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzE5LjExNiAtNDcxLjQzNSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMwOC42OCw0NzYuNDM1YTIuNSwyLjUsMCwwLDAtMi41LTIuNSwyLjUsMi41LDAsMCwwLTIuNSwyLjUsMi41LDIuNSwwLDAsMCwyLjUsMi41QTIuNSwyLjUsMCwwLDAtMzA4LjY4LDQ3Ni40MzVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjA2NCkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTS0zMDcuMjIyLDQ4My45MzVoMy42MDdjMC0xLjgwNi0xLjM2OC0zLTMuNDIyLTNhNC4yOTQsNC4yOTQsMCwwLDAtMS41NzguMjc5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC4wMDEpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMzA0LjYxNSw0NzcuNDM1YTIsMiwwLDAsMC0yLTIsMiwyLDAsMCwwLTIsMiwyLDIsMCwwLDAsMiwyQTIsMiwwLDAsMC0zMDQuNjE1LDQ3Ny40MzVaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMzE1LjEyNCw0ODMuOTM1aC0zLjYwNmMwLTEuODA2LDEuMzY5LTMsMy40MjEtM2E0LjMwNiw0LjMwNiwwLDAsMSwxLjU3OS4yNzkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMTE0KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMxNy42MTUsNDc3LjQzNWEyLDIsMCwwLDEsMi0yLDIsMiwwLDAsMSwyLDIsMiwyLDAsMCwxLTIsMkEyLDIsMCwwLDEtMzE3LjYxNSw0NzcuNDM1WiIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMwNi42NzgsNDg0LjkzNWMwLTIuNDA5LTEuOC00LTQuNS00cy00LjUsMS41OTEtNC41LDRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjA2MikiLz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPjwvc3ZnPg==) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.group[_ngcontent-%COMP%]:hover{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojMDA2Y2UwO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJhIiBkPSJNOCw5Yy0yLjk5MSwwLTUsMS44MDktNSw0LjVWMTRIMTN2LS41QzEzLDEwLjgwOSwxMC45OSw5LDgsOVoiLz48Y2lyY2xlIGNsYXNzPSJhIiBjeD0iMyIgY3k9IjMiIHI9IjMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUgMikiLz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xMiw5aC0uMzc5YTUuMTU1LDUuMTU1LDAsMCwxLDIuMzU1LDRIMTZ2LS41QzE2LDEwLjQ0LDE0LjM1NSw5LDEyLDlaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik00LDloLjM3OWE1LjE1NSw1LjE1NSwwLDAsMC0yLjM1NSw0SDB2LS41QzAsMTAuNDQsMS42NDUsOSw0LDlaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xMi41LDMuNWEyLjQ3NiwyLjQ3NiwwLDAsMC0uNzU4LjEzLDMuOTI2LDMuOTI2LDAsMCwxLS45MjYsNC4yMDZBMi41LDIuNSwwLDEsMCwxMi41LDMuNVoiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTMuNSwzLjVhMi40NzYsMi40NzYsMCwwLDEsLjc1OC4xMywzLjkyNiwzLjkyNiwwLDAsMCwuOTI2LDQuMjA2QTIuNSwyLjUsMCwxLDEsMy41LDMuNVoiLz48L3N2Zz4=) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.group.pressed[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojMDA2Y2UwO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJhIiBkPSJNOCw5Yy0yLjk5MSwwLTUsMS44MDktNSw0LjVWMTRIMTN2LS41QzEzLDEwLjgwOSwxMC45OSw5LDgsOVoiLz48Y2lyY2xlIGNsYXNzPSJhIiBjeD0iMyIgY3k9IjMiIHI9IjMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUgMikiLz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xMiw5aC0uMzc5YTUuMTU1LDUuMTU1LDAsMCwxLDIuMzU1LDRIMTZ2LS41QzE2LDEwLjQ0LDE0LjM1NSw5LDEyLDlaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik00LDloLjM3OWE1LjE1NSw1LjE1NSwwLDAsMC0yLjM1NSw0SDB2LS41QzAsMTAuNDQsMS42NDUsOSw0LDlaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xMi41LDMuNWEyLjQ3NiwyLjQ3NiwwLDAsMC0uNzU4LjEzLDMuOTI2LDMuOTI2LDAsMCwxLS45MjYsNC4yMDZBMi41LDIuNSwwLDEsMCwxMi41LDMuNVoiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTMuNSwzLjVhMi40NzYsMi40NzYsMCwwLDEsLjc1OC4xMywzLjkyNiwzLjkyNiwwLDAsMCwuOTI2LDQuMjA2QTIuNSwyLjUsMCwxLDEsMy41LDMuNVoiLz48L3N2Zz4=) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzUwN18zIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA1MDcg4oCTIDMiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNTgxMSIgZGF0YS1uYW1lPSJHcm91cCA1ODExIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTgxNS41OTcgNzQpIj4NCiAgICA8cGF0aCBpZD0iUGF0aF82MDU3IiBkYXRhLW5hbWU9IlBhdGggNjA1NyIgZD0iTTE4MjIuNi02MGgtNXYtNVoiIGZpbGw9IiM1NDY1N2QiLz4NCiAgICA8cGF0aCBpZD0iUGF0aF82MDU4IiBkYXRhLW5hbWU9IlBhdGggNjA1OCIgZD0iTTE4MjkuNi02N3YtNWgtNVoiIGZpbGw9IiM1NDY1N2QiLz4NCiAgICA8bGluZSBpZD0iTGluZV81NzkiIGRhdGEtbmFtZT0iTGluZSA1NzkiIHkxPSI0IiB4Mj0iNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTgyNC41OTcgLTcxKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIvPg0KICAgIDxsaW5lIGlkPSJMaW5lXzU4MCIgZGF0YS1uYW1lPSJMaW5lIDU4MCIgeTE9IjQiIHgyPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxODE4LjU5NyAtNjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82Mjc2IiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2Mjc2IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4MTUuNTk3IC03NCkiIGZpbGw9Im5vbmUiLz4NCiAgPC9nPg0KPC9zdmc+DQo=) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]:hover{background:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzY3OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA2Nzkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8cGF0aCBpZD0iUGF0aF82MDU3IiBkYXRhLW5hbWU9IlBhdGggNjA1NyIgZD0iTTE4MjIuNi02MGgtNXYtNVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xODE1LjU5NyA3NCkiIGZpbGw9IiMwMDZjZTAiLz4NCiAgPHBhdGggaWQ9IlBhdGhfNjA1OCIgZGF0YS1uYW1lPSJQYXRoIDYwNTgiIGQ9Ik0xODI5LjYtNjd2LTVoLTVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTgxNS41OTcgNzQpIiBmaWxsPSIjMDA2Y2UwIi8+DQogIDxsaW5lIGlkPSJMaW5lXzU3OSIgZGF0YS1uYW1lPSJMaW5lIDU3OSIgeTE9IjQiIHgyPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5IDMpIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDZjZTAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzU4MCIgZGF0YS1uYW1lPSJMaW5lIDU4MCIgeTE9IjQiIHgyPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzIDkpIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDZjZTAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxyZWN0IGlkPSJSZWN0YW5nbGVfNjI3NiIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNjI3NiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJub25lIi8+DQo8L3N2Zz4NCg==) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen.hidden[_ngcontent-%COMP%]{display:none}.designer-content[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.designer-content[_ngcontent-%COMP%]   .diagram-wrap[_ngcontent-%COMP%]{width:100%;border-radius:8px}.designer-content[_ngcontent-%COMP%]   .card-wrap[_ngcontent-%COMP%]{min-width:345px;max-width:345px;border:1px solid #dcdcdc;border-radius:8px}.designer-content[_ngcontent-%COMP%]   .card-wrap.card-hidden[_ngcontent-%COMP%]{display:none}"]})}}var ca=u(62115),da=u(12325),pa=u(15112);const ga=c=>({schemaName:c});class Be{constructor(e,t){this.dialogRef=e,this.data=t}static{this.\u0275fac=function(t){return new(t||Be)(o.\u0275\u0275directiveInject(F.MatLegacyDialogRef),o.\u0275\u0275directiveInject(F.MAT_LEGACY_DIALOG_DATA))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:Be,selectors:[["crt-relationship-dialog"]],decls:10,vars:11,consts:[["content",""],[3,"data","allowFullScreenMode"],["caption",""],[1,"dialog-caption",3,"caption"],["tools",""],["mat-flat-button","","color","default",3,"clicked"]],template:function(t,n){t&1&&(o.\u0275\u0275elementStart(0,"crt-dialog"),o.\u0275\u0275elementContainerStart(1,0),o.\u0275\u0275elementStart(2,"crt-relationship-designer",1),o.\u0275\u0275elementContainerStart(3,2),o.\u0275\u0275element(4,"crt-label",3),o.\u0275\u0275pipe(5,"translate"),o.\u0275\u0275elementContainerEnd(),o.\u0275\u0275elementContainerStart(6,4),o.\u0275\u0275elementStart(7,"crt-button",5),o.\u0275\u0275listener("clicked",function(){return n.dialogRef.close()}),o.\u0275\u0275text(8),o.\u0275\u0275pipe(9,"translate"),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementContainerEnd(),o.\u0275\u0275elementEnd(),o.\u0275\u0275elementContainerEnd(),o.\u0275\u0275elementEnd()),t&2&&(o.\u0275\u0275advance(2),o.\u0275\u0275property("data",n.data)("allowFullScreenMode",!1),o.\u0275\u0275advance(2),o.\u0275\u0275property("caption",o.\u0275\u0275pipeBind2(5,4,"RelationshipDesignerModal.Caption",o.\u0275\u0275pureFunction1(9,ga,n.data.schemaName))),o.\u0275\u0275advance(4),o.\u0275\u0275textInterpolate1(" ",o.\u0275\u0275pipeBind1(9,7,"BasePageComponent.Close"),""))},dependencies:[ca.B,da.V,pa.H,_e,k.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.crt-relationship-dialog{max-width:94vw!important}.crt-relationship-dialog mat-dialog-container{height:90vh;width:94vw}.crt-relationship-dialog crt-relationship-dialog .designer-tools-panel{border:none}.crt-relationship-dialog crt-relationship-dialog .designer-tools-panel .dialog-caption label{font-family:var(--crt-headline-2-font-family);font-size:var(--crt-headline-2-font-size);line-height:var(--crt-headline-2-line-height);font-weight:var(--crt-headline-2-font-weight);letter-spacing:var(--crt-headline-2-letter-spacing);text-transform:var(--crt-headline-2-text-transform);-webkit-font-smoothing:antialiased;color:var(--crt-palette-primary-500, var(--palette-primary-500))}.crt-relationship-dialog crt-relationship-dialog .designer-content .diagram-wrap{border:1px solid #dcdcdc}.crt-relationship-dialog crt-relationship-dialog .designer-content .card-wrap{margin-left:10px}
`],encapsulation:2})}}let Tt=class extends ci{constructor(e,t,n,i){super(),this.config=e,this.eventBus=t,this.rules=n,this.elements=i,this.translateService=e?.translateService}noAccessMessage(){const e=this.service,t=this.translateService.instant("RelationshipDiagram.NoAccess");e.showMessage(t)}subscribeServerDiagramChanges(){const e=this.service;this.eventBus.on(["element.dblclick"],t=>{const n=t.element;n&&!I.isRoot(n)&&(this.rules.canEdit(n)?e.elementDoubleClick(n.id):this.noAccessMessage())}),this.eventBus.on(["elements.noAccessMessage"],()=>{this.noAccessMessage()}),this.eventBus.on(["elements.removing"],t=>{const n=t.elements.map(i=>i.id);return e.elementRemoving(n)}),this.eventBus.on(["diagram.connection.adding"],t=>e.connectionAdding({source:t.source.id,target:t.target?.id,targetType:t.targetType})),this.eventBus.on([N.connection.reconnectExecuted],t=>{const n=t.context;if(n.newSource!==n.oldSource||n.newTarget!==n.oldTarget)return e.connectionReconnect({id:n.connection.id,source:n.newSource.id,target:n.newTarget.id})}),this.eventBus.on(["diagram.item.selected"],t=>e.itemSelected(t.id)),this.eventBus.on("diagram.loaded",()=>e.diagramLoaded()),this.eventBus.on("connect.end",A.LOW,function({context:t}){if(t.canExecute&&t.connection)return e.connectionAdding({id:t.connection.id,source:t.connection.source.id,target:t.connection.target.id})})}subscribeServerChanges(){return this.subscribeServerDiagramChanges(),[]}};Tt=(0,r.__decorate)([(0,r.__param)(0,d("config")),(0,r.__param)(1,d("eventBus")),(0,r.__param)(2,d("diagramRules")),(0,r.__param)(3,d("elements")),(0,r.__metadata)("design:paramtypes",[Object,Object,Ke,R])],Tt);var ha=u(41287),ua=u(844),ma=u(50342);let Dn=class extends ha.l{constructor(e){super(),this._dialogProvider=e}handle(e){const t=e.recordId?.value??e.recordId;return(0,x.firstValueFrom)(this._dialogProvider.open(Be,{data:{schemaName:e.entityName,selectedRecordId:t},panelClass:"crt-relationship-dialog"}))}};Dn=(0,r.__decorate)([(0,ua.l)({requestType:"crt.ShowRelationshipsRequest",type:"crt.ShowRelationshipsHandler"}),(0,r.__metadata)("design:paramtypes",[ma.C])],Dn);class we extends V{constructor(){super(),this.getDiagramInfo$=new x.ReplaySubject(1),this.itemSelected$=new x.Subject,this.highlightedGroup$=new x.Subject,this.diagramLoaded$=new x.Subject,this.elementDoubleClick$=new x.Subject,this.elementRemoving$=new x.Subject,this.connectionAdding$=new x.Subject,this.connectionAdded$=new x.Subject,this.connectionChanged$=new x.Subject,this.showMessage$=new x.Subject,this.connectionReconnect$=new x.Subject,this.entityInGroupAdded$=new x.Subject,this.entityInGroupRemoving$=new x.Subject,this.diagramChanged$=new x.Subject,this.init()}getDiagramConfig(){var e=this;return(0,j.A)(function*(){return(0,x.lastValueFrom)(e.getDiagramInfo$.asObservable(),{defaultValue:null})})()}setDiagramConfig(e){this.getDiagramInfo$.next(e),this.getDiagramInfo$.complete()}diagramLoaded(){this.diagramLoaded$.next()}itemSelected(e){this.itemSelected$.next(e)}highlightGroup(e){this.highlightedGroup$.next(e)}elementDoubleClick(e){this.elementDoubleClick$.next(e)}connectionAdding(e){this.connectionAdding$.next(e)}connectionReconnect(e){this.connectionReconnect$.next(e)}elementRemoving(e){return this.elementRemoving$.next(e),!1}showMessage(e){this.showMessage$.next(e)}entityInGroupAdded(){this.entityInGroupAdded$.next()}entityInGroupRemoving(){this.entityInGroupRemoving$.next()}static{this.\u0275fac=function(t){return new(t||we)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:we,factory:we.\u0275fac})}}function fa(c,e){return()=>(0,x.lastValueFrom)(c.loadCurrentUserInfo().pipe((0,O.tap)(t=>{e.use(t?.userInfo?.cultureInfo?.sysCultureName)})),{defaultValue:null})}let kt=class Tn{static{this.\u0275fac=function(t){return new(t||Tn)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Tn})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[ne,te,de,q,we,X,te,{provide:V,useClass:we},{provide:at,useFactory:()=>({...mi,diagramEventHandlerController:["type",Tt],elementFactory:["type",ms]})},Ee,{provide:o.ENVIRONMENT_INITIALIZER,useFactory:fa,deps:[vs.fv,k.TranslateService],multi:!0}],imports:[P.CommonModule,En.ColorGithubModule,zn.R,Me.MatLegacyAutocompleteModule,J.MatLegacyButtonModule,F.MatLegacyDialogModule,Lt.MatDividerModule,he.MatExpansionModule,ot.MatIconModule,W.MatLegacyFormFieldModule,ue.MatLegacyInputModule,Ie.MatListModule,ie.MatLegacyMenuModule,Rn.MatTooltipModule,st.P,Te,k.TranslateModule.forChild({defaultLanguage:"en-US",loader:{provide:k.TranslateLoader,useFactory:(e,t)=>new wi.TranslateHttpLoader(e,t+"ClientApp/assets/i18n/"),deps:[Ln.HttpClient,P.APP_BASE_HREF]}}),Bn.q,Gn.S,Fn.k]})}};kt=(0,r.__decorate)([(0,_i.g)({includes:[],requestHandlers:[Dn]})],kt),function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(kt,{declarations:[pe,ge,Ae,be,xe,Ne,_e,ve,ze,Be,nt],imports:[P.CommonModule,En.ColorGithubModule,zn.R,Me.MatLegacyAutocompleteModule,J.MatLegacyButtonModule,F.MatLegacyDialogModule,Lt.MatDividerModule,he.MatExpansionModule,ot.MatIconModule,W.MatLegacyFormFieldModule,ue.MatLegacyInputModule,Ie.MatListModule,ie.MatLegacyMenuModule,Rn.MatTooltipModule,st.P,Te,k.TranslateModule,Bn.q,Gn.S,Fn.k],exports:[pe,_e]})}()},34035:it=>{it.exports=`<svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M4.33435 0.278443C4.70198 -0.0928144 5.29802 -0.0928144 5.66565 0.278443L9.72428 4.37711C10.0919 4.74837 10.0919 5.3503 9.72428 5.72156C9.35665 6.09281 8.7606 6.09281 8.39297 5.72156L5 2.29511L1.60703 5.72156C1.2394 6.09281 0.643352 6.09281 0.275722 5.72156C-0.0919075 5.3503 -0.0919075 4.74837 0.275722 4.37711L4.33435 0.278443Z" fill="#0D2E4E"/>
</svg>
`},65070:it=>{it.exports=`<svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M0.275722 0.278443C0.643352 -0.0928144 1.2394 -0.0928144 1.60703 0.278443L5 3.70489L8.39297 0.278443C8.7606 -0.0928144 9.35665 -0.0928144 9.72428 0.278443C10.0919 0.6497 10.0919 1.25163 9.72428 1.62289L5.66565 5.72156C5.29802 6.09281 4.70198 6.09281 4.33435 5.72156L0.275722 1.62289C-0.0919075 1.25163 -0.0919075 0.6497 0.275722 0.278443Z" fill="#0D2E4E"/>
</svg>
`}}]);
