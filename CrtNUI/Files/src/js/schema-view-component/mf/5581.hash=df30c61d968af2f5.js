(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[5581],{37206:(J,y,e)=>{e.d(y,{D:()=>M,w:()=>R});var p=e(73308),P=e(81517),S=e(41287),L=e(91775),d=e(62278),v=e.n(d);const m="ChatsListLoadSubject",C="ChatsListLoadSubscription";class M extends P.S{constructor(){super(...arguments),this.searchFilter=null,this.isFirstLoad=!1}}class R extends S.l{_getChatsListLoadSubject(a){return(0,p.A)(function*(){let l=yield a.$context[m];return l||(l=new d.Subject,a.$context[m]=l),l})()}_resetChatsLoadOffsetSubscription(a){var l=this;(0,p.A)(function*(){const u=yield a.$context[C];u&&u.unsubscribe();const r=yield l._getChatsListLoadSubject(a);l._handleChatsListOffsetChange(a,r)})()}_handleChatsListOffsetChange(a,l){var u=this;a.$context[C]=l.pipe((0,d.debounceTime)(500),(0,d.tap)(()=>a.$context.IsActiveChatsLoading=!1),(0,d.distinctUntilChanged)((r,s)=>r.offset===s.offset&&r.searchFilter===s.searchFilter),(0,d.tap)(()=>a.$context.IsActiveChatsLoading=!0),(0,d.switchMap)(r=>this.getChatPreviews(r.offset,r.rowsToLoad,r.searchFilter).pipe((0,d.filter)(s=>r.offset===0||s&&s.length>0),(0,d.map)(s=>s.map(h=>this.mapChatPreview(h))),(0,d.switchMap)(s=>(0,d.from)(a.$context.ActiveChats).pipe((0,d.take)(1),(0,d.map)(h=>!h||h.length===0||r.currentPage===0?s:[...h,...s]))),(0,d.map)(s=>({page:r.currentPage,mappedSessions:s,search:r.searchFilter})),(0,d.finalize)(()=>{a.$context.IsActiveChatsLoading=!1})))).subscribe({next:r=>{a.$context.ActiveChats=Array.from(new Map(r.mappedSessions.map(s=>[s.id,s])).values()),a.$context.ChatsListPage=r.page+1,r.search&&(0,p.A)(function*(){return yield u._reloadCurrentChatIfNeeded(a)})()},error:r=>{console.error("Failed to load chat previews:",r),this._resetChatsLoadOffsetSubscription(a)}})}_reloadCurrentChatIfNeeded(a){var l=this;return(0,p.A)(function*(){const u=yield l.getCurrentChatId(a),r=yield a.$context.IsCombinedMode,s=(yield a.$context.ActiveChats).find(h=>h.id===u);if(s&&r){const h=l.getChatOpenRequest(a,s);yield L.t.instance.process(h)}})()}handle(a){var l=this;return(0,p.A)(function*(){yield l.next?.handle(a);const u=yield l._getChatsListLoadSubject(a);a.isFirstLoad&&(l._handleChatsListOffsetChange(a,u),a.$context.ChatsListPage=0);const r=yield a.$context.ChatsListPage,s=r*a.rowsToLoadCount;u.next({offset:s,rowsToLoad:a.rowsToLoadCount,currentPage:r,searchFilter:a.searchFilter})})()}}},85581:(J,y,e)=>{e.r(y),e.d(y,{ALLOW_MENTION_HOOK:()=>Pt.F,BaseChatListLoadHandler:()=>O.w,BaseChatListLoadRequest:()=>O.D,CHAT_PROFILE_KEY:()=>gt.j,CONVERSATION_RESET_EVENT:()=>K.R,ChatDraftService:()=>pt.X,ChatListChangeHandler:()=>V.h,ChatListChangeRequest:()=>V.w,ChatMessageActionHandler:()=>Y.o,ChatMessageActionRequest:()=>N,ChatMessageTypeRegisterServiceMock:()=>F,ChatPreview:()=>Ct.H,ChatScrollPositionService:()=>Mt.U,ConversationEvent:()=>K.u,CopilotContentUtils:()=>yt.$,CrtChatDisclaimerComponent:()=>a.k,CrtChatItemComponent:()=>u.I,CrtChatListComponent:()=>l.l,CrtChatMessagesComponent:()=>p.z,CrtChatPanelModule:()=>W.e,CrtChatTypingComponent:()=>P.E,CrtConversationComponent:()=>S.g,CrtMessageEditorComponent:()=>L.j,CrtMessageEditorInputComponent:()=>d.z,CrtMessageEditorReplyComponent:()=>E.z,CrtRenameChatComponent:()=>r.P,LoadChatProfileHandler:()=>w.m,LoadChatProfileRequest:()=>D,LoadConversationHandler:()=>Z.G,LoadConversationModeEnum:()=>z.W,LoadConversationRequest:()=>I,MessageEditorInputActionEnum:()=>R.g,MessageEditorInputChangeHandler:()=>Q.x,MessageEditorInputChangeRequest:()=>T,MessageEditorPreprocessor:()=>ft.k,MessageEditorSendHandler:()=>A,MessageEditorSendRequest:()=>x,RenameChatDialogData:()=>vt,SaveChatProfileHandler:()=>k.b,SaveChatProfileRequest:()=>j,TriggerMentionRequest:()=>M,providersMock:()=>mt});var p=e(90615),P=e(38739),S=e(18611),L=e(28503),d=e(30073),v=e(5960),m=e(81517),C=e(2828);let M=class extends m.S{};M=(0,v.__decorate)([(0,C.$)({type:"crt.TriggerMentionRequest"})],M);var R=e(96158),E=e(7917),a=e(88263),l=e(83463),u=e(68759),r=e(11395),s=e(73308),h=e(41287),X=e(844);let A=class extends h.l{handle(t){var o=this;return(0,s.A)(function*(){yield o.next?.handle(t)})()}};A=(0,v.__decorate)([(0,X.l)({type:"crt.MessageEditorSendHandler",requestType:"crt.MessageEditorSendRequest"})],A);var Y=e(42963),Z=e(4944),Q=e(20903),w=e(99556),k=e(53395),O=e(37206),V=e(53251),$=e(59131),_=e(11629),B=e(59969),q=e(41833),tt=e(99543);class F{static{this._selectorCounter=0}static getProvider(){return{provide:q.s,useFactory:(t,o)=>{for(const n of t){let{selector:c}=(0,$.reflectComponentType)(n.componentType);c=c+this._selectorCounter++,o.defineComponent(c,n.componentType),_.L.register(n.messageType,c)}},deps:[tt.U,B.SH]}}}var et=e(66989),ot=e(24091),at=e(31149),nt=e(57274),rt=e(71830),st=e(59962),it=e(26852),lt=e(26594),dt=e(86323),ct=e(4583),H=e(56711),ut=e(89285),i=e(62278),b=e(82805),U=e(56005);class ht{constructor(t={},o={}){this.attributes=t,this._injector={get:(n,c)=>c},this._injectionContextValue="not set",this._attributeConfigs={},this._crtControls=new Map,this.formApiModel=new H.FormGroup({}),this._destroy$=new i.Subject,this.events$=new i.Subject,this.dataSchemas={},this._businessRulesActivated$=new i.BehaviorSubject(!1),this._modelsMap=new Map,this.modelDependenciesMock={};for(const n of Object.keys(t)){Object.defineProperty(this,n,{get:()=>Promise.resolve(this.attributes[n]),set:f=>this.attributes[n]=f,configurable:!0});const c=b.C.create({name:n,value:this.attributes[n],propertiesConfig:[],featureValues:{}});this._crtControls.set(n,c)}this.Resources={Strings:{}},Object.assign(this,o)}get PrimaryModelMode(){return ut.b.Create}get IsChanged(){return Promise.resolve(!1)}get HasUnsavedData(){return Promise.resolve(!1)}get[U.w](){return this._injector}set[U.w](t){this._injector=t}isValid(){return Promise.resolve(!0)}deactivateBusinessRules(){}activateBusinessRules(){return(0,i.of)()}validate(){return Promise.resolve({})}init(t){return(0,i.of)()}setValue(t,o){return(0,i.of)()}set(t,o,n){return(0,i.of)()}setSorting(){return(0,i.of)(null)}create(t,o){return(0,i.of)(null)}executeRequest(t){return Promise.resolve()}loadLookupList(t,o,n){return null}load(...t){return(0,i.of)()}copy(t,o,n){return(0,i.of)()}loadDefaultValues(){return(0,i.of)()}save(t,o,n){return(0,i.of)()}saveInTransaction(t,o,n,c){return(0,i.of)()}deleteInTransaction(t,o,n,c){return(0,i.of)()}commitTransaction(t,o,n,c){return(0,i.of)()}delete(t,o,n){return(0,i.of)()}getAttributeControl(t){const o=this.attributes[t];return new H.FormControl(o)}getBoundDataSourceName(t){return""}getBoundDataSource(t){}getBoundDataSchema(t){}getViewModelAttributePath(t,o){return""}getViewModelAttributePaths(t,o){return null}destroy(){return this._destroy$.next(),this._destroy$.complete(),(0,i.of)(void 0)}getBoundDataSchemaByAttributePath(t){}getBoundDataSchemaAttributeByAttributePath(t){return null}getBoundDataSourceNameByAttributePath(t){return""}getPrimaryModelName(){return Promise.resolve("")}getPrimaryDataSchema(){return Promise.resolve(null)}getAttributeNameByViewItemName(t){return""}getControl(t){return this._crtControls.has(t)?this._crtControls.get(t):b.C.create({name:t,value:null,propertiesConfig:[],featureValues:{}})}getAttributePropertyValue(...t){let o,n;if(t.length===2)o=t[0],n=t[1];else if(t.length===1){const f=t[0].split(":");o=f[0],n=f[1]}else throw new Error("ArgumentException");return this.getControl(o)?.getPropertyValue(n)}setAttributePropertyValue(...t){let o,n,c;if(t.length===3)o=t[0],n=t[1],c=t[2];else if(t.length===2){const G=t[0].split(":");o=G[0],n=G[1],c=t[1]}else throw new Error("ArgumentException");const f=this.getControl(o);f&&f.setPropertyValue(n,c)}resetAttributePropertyValue(...t){let o,n;if(t.length===1)[o,n]=t[0].split(":");else if(t.length===2)o=t[0],n=t[1];else throw new Error("ArgumentException");this.getControl(o).getPropertyByName(n)?.resetValue()}getInvariabilityPropertyName(t){return null}setModelValues(t,o){return null}getIsDirty(t){return this.getControl(t).isDirty}getModelByName(t){return null}getModelMode(t){return null}getPrimaryModelMode(){return null}_getModelModeChanges(t){return null}_getPrimaryModelModeChanges(){return null}_hotSwap(t){return(0,i.of)(!0)}get _injectionContext(){return this._injectionContextValue==="not set"?{id:"id",inject:()=>null,addLazyModule:()=>null,connectHostLazyModules:()=>{},getLazyModules:()=>[],destroy:()=>{}}:this._injectionContextValue}set _injectionContext(t){this._injectionContextValue=t}get _destroyed(){return!1}markModelFor(t,o){return null}markPrimaryModelFor(t){return null}_onAsyncTaskStarted(t){}_onAsyncTaskFinished(t){}_getIsAffectedByBusinessRules(t){return Promise.resolve(!1)}_getDependOnModelsNames(t){return[]}_getModelDependencies(t){return this.modelDependenciesMock[t]??[]}}var W=e(42656);const mt=[{provide:st.e,useValue:[W.e,ot.S,at.q,et.V,nt.u]},{provide:lt.G,useValue:{}},{provide:it.I,useValue:{viewModel$:(0,i.of)(new ht)}},{provide:dt.V,useValue:ct.V.instance},{provide:B.ZP,useFactory:()=>globalThis},F.getProvider(),(0,$.importProvidersFrom)(rt.A)];var K=e(43778),z=e(15932),Ct=e(15959),gt=e(13161);class vt{}var ft=e(1978);let x=class extends m.S{};x=(0,v.__decorate)([(0,C.$)({type:"crt.MessageEditorSendRequest"})],x);let N=class extends m.S{};N=(0,v.__decorate)([(0,C.$)({type:"crt.ChatMessageActionRequest"})],N);let I=class extends m.S{constructor(){super(...arguments),this.loadMode=z.W.Replace}};I=(0,v.__decorate)([(0,C.$)({type:"crt.LoadConversationRequest"})],I);let T=class extends m.S{};T=(0,v.__decorate)([(0,C.$)({type:"crt.MessageEditorInputChangeRequest"})],T);let D=class extends m.S{};D=(0,v.__decorate)([(0,C.$)({type:"crt.LoadChatProfileRequest"})],D);let j=class extends m.S{};j=(0,v.__decorate)([(0,C.$)({type:"crt.SaveChatProfileRequest"})],j);var pt=e(13555),Mt=e(19540),yt=e(92385),Pt=e(89986)}}]);
