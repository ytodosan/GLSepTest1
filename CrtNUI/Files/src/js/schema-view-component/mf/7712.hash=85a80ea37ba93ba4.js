(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[7712],{17712:(j,Ke,m)=>{m.r(Ke),m.d(Ke,{AddSummaryItemHandler:()=>X,AddSummaryItemRequest:()=>Fe,BaseSummaryItemColumnProvider:()=>In.U,BaseUpdateSummaryItemHandler:()=>N,CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE:()=>we.W,CreateSummaryItemHandler:()=>te,CreateSummaryItemRequest:()=>Ue,CrtSummariesActionsDirective:()=>P,CrtSummariesComponent:()=>h,CrtSummariesPreprocessorsModule:()=>w,CrtSummariesRuntimeModule:()=>le,CrtSummaryItemComponent:()=>C,CrtSummaryItemEditDialogComponent:()=>Oe.E,CrtSummaryItemEditDialogModule:()=>x,CrtSummaryItemModule:()=>M,DeleteSummaryItemHandler:()=>ne,DeleteSummaryItemRequest:()=>je,EditSummaryItemHandler:()=>ee,EditSummaryItemRequest:()=>He,ExpandSummariesHandler:()=>q,QUICK_SUMMARY_ITEM_CREATION_ACTION_FUNCTIONS_FACTORY:()=>Ve.n,QUICK_SUMMARY_ITEM_CREATION_ACTION_FUNCTIONS_FACTORY_PROVIDER:()=>Mt,QUICK_SUMMARY_ITEM_CREATION_ACTION_ICON_FACTORY_PROVIDER:()=>xt,QuickSummaryItemCreationActionsModule:()=>R,QuickSummaryItemCreationActionsProvider:()=>b,ResetSummariesHandler:()=>me,ResetSummariesRequest:()=>$e,SUMMARY_ITEM_AVAILABLE_COLUMN_DATA_VALUE_TYPES:()=>ue.p,SUMMARY_ITEM_NOT_AVAILABLE_COLUMN_PATHS:()=>ue.b,SUMMARY_ITEM_VALUE_EXPRESSION_FUNCTION_LOCALIZATION_KEYS:()=>St.I,SaveSummariesForAllHandler:()=>oe,SaveSummariesForAllRequest:()=>Le,SummaryItemColumnExplorer:()=>it.$,SummaryItemColumnProvider:()=>Et.t,SummaryItemEditingService:()=>Ee.x,SummaryItemExpressionMetadataCreator:()=>O,SummaryItemMetaSettingsCreator:()=>Re.A,SummaryItemSetupService:()=>Ie.G,UpdateSummaryItemValueAfterModelInsertHandler:()=>re,UpdateSummaryItemValueAfterModelUpdateHandler:()=>ae,UpdateSummaryItemValueBeforeModelLoadHandler:()=>ie,UpdateSummaryItemValueOnModelEventDeleteHandler:()=>se,UpdateSummaryItemValueRequest:()=>Be,createSummariesExpandedAttributeName:()=>Me,createSummaryItemLabel:()=>gt.I,createSummaryItemLabelResourceKey:()=>D.tK,createSummaryItemModelAttributeName:()=>D.G0,createSummaryItemTargetAttributeName:()=>D.IZ,createSummaryItemValueAttributeName:()=>D.GE,generateSummariesName:()=>qe,generateSummaryItemName:()=>D.QG});var o=m(5960),g=m(40297),fe=m(55642),f=m(79772),Y=m(52989),Z=m(56484),ze=m(44267),n=m(59131),_=m(77592),We=m(3671),Je=m(96677),Ze=m(52793),Xe=m(68712),Tt=m(89422),Ot=m(4227),Vt=m(54653),Nt=m(84137);const Pt=["actionsMenuTrigger"];function bt(i,t){i&1&&n.\u0275\u0275elementContainer(0)}function Dt(i,t){if(i&1){const e=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275elementStart(1,"div",6,2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275listener("menuOpened",function(){n.\u0275\u0275restoreView(e);const a=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(a.actionsOpened=!0)})("menuClosed",function(){n.\u0275\u0275restoreView(e);const a=n.\u0275\u0275nextContext();return a.actionsOpened=!1,n.\u0275\u0275resetView(a.focus())}),n.\u0275\u0275template(4,bt,1,0,"ng-container",7),n.\u0275\u0275elementEnd(),n.\u0275\u0275element(5,"crt-menu",8,3),n.\u0275\u0275elementContainerEnd()}if(i&2){const e=n.\u0275\u0275reference(6),r=n.\u0275\u0275nextContext(),a=n.\u0275\u0275reference(4);n.\u0275\u0275advance(),n.\u0275\u0275property("title",r.title)("crtMenuTriggerFor",e),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(3,5,"SummaryItem.AriaLabel")),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngTemplateOutlet",a),n.\u0275\u0275advance(),n.\u0275\u0275property("items",r.actions)}}function wt(i,t){i&1&&n.\u0275\u0275elementContainer(0)}function Ft(i,t){if(i&1&&(n.\u0275\u0275elementStart(0,"div",9),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275template(2,wt,1,0,"ng-container",7),n.\u0275\u0275elementEnd()),i&2){const e=n.\u0275\u0275nextContext(),r=n.\u0275\u0275reference(4);n.\u0275\u0275property("title",e.title),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(1,4,"SummaryItem.AriaLabel"))("aria-disabled",e.readonly),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngTemplateOutlet",r)}}function Ut(i,t){if(i&1&&(n.\u0275\u0275elementStart(0,"span",12),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()),i&2){const e=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate1(" ",e.label,": ")}}function jt(i,t){if(i&1&&(n.\u0275\u0275elementStart(0,"span",13),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()),i&2){let e;const r=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate((e=r.value)!==null&&e!==void 0?e:"")}}function Ht(i,t){if(i&1&&n.\u0275\u0275element(0,"mat-icon",14),i&2){const e=n.\u0275\u0275nextContext(2);n.\u0275\u0275property("crtTooltip",e.error)}}function Bt(i,t){if(i&1&&n.\u0275\u0275template(0,Ut,2,1,"span",10)(1,jt,2,1,"span",11)(2,Ht,1,1,"ng-template",null,4,n.\u0275\u0275templateRefExtractor),i&2){const e=n.\u0275\u0275reference(3),r=n.\u0275\u0275nextContext();n.\u0275\u0275property("ngIf",r.label),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",!r.invalid)("ngIfElse",e)}}let C=class pe extends Xe.K{constructor(){super(...arguments),this._translateService=(0,n.inject)(f.TranslateService),this._errorLabel=this._translateService.instant("SummaryItem.Statuses.Error"),this.tabIndex=0,this.actionsOpened=!1,this.invalid=!1}set error(t){this._error=t,this.invalid=!!t,this.changeDetectorRef.markForCheck()}get error(){return this._error}set readonly(t){this._readonly=t,this.changeDetectorRef.markForCheck()}get readonly(){return this._readonly}get title(){const t=this.label?this.value||this.error?`${this.label}: `:this.label:"",e=this.invalid?`${this._errorLabel}. ${this.error}`:this.value??"";return t+e}onKeydown(t){(t.code===Tt.Key.Enter||t.code==="Space")&&this.actions?.length&&!this.readonly&&this._actionsMenuTrigger?.openMenu()}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=n.\u0275\u0275getInheritedFactory(pe)))(r||pe)}})()}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:pe,selectors:[["crt-summary-item"]],viewQuery:function(e,r){if(e&1&&n.\u0275\u0275viewQuery(Pt,5),e&2){let a;n.\u0275\u0275queryRefresh(a=n.\u0275\u0275loadQuery())&&(r._actionsMenuTrigger=a.first)}},hostVars:7,hostBindings:function(e,r){e&1&&n.\u0275\u0275listener("keydown",function(s){return r.onKeydown(s)}),e&2&&(n.\u0275\u0275hostProperty("tabindex",r.tabIndex),n.\u0275\u0275classProp("crt-summary-item-readonly",r.readonly)("crt-summary-item-actions-opened",r.actionsOpened)("crt-summary-item-invalid",r.invalid))},inputs:{label:"label",value:"value",error:"error",actions:"actions",readonly:"readonly"},features:[n.\u0275\u0275InheritDefinitionFeature],decls:5,vars:2,consts:[["summaryItem",""],["summaryItemContent",""],["actionsMenuTrigger","crtMenuTrigger"],["actionsMenu",""],["errorIcon",""],[4,"ngIf","ngIfElse"],["role","button",1,"crt-summary-item",3,"menuOpened","menuClosed","title","crtMenuTriggerFor"],[4,"ngTemplateOutlet"],[3,"items"],["role","button",1,"crt-summary-item",3,"title"],["class","crt-summary-item-label",4,"ngIf"],["class","crt-summary-item-value",4,"ngIf","ngIfElse"],[1,"crt-summary-item-label"],[1,"crt-summary-item-value"],["svgIcon","info-icon","title","",1,"crt-summary-item-invalid-icon",3,"crtTooltip"]],template:function(e,r){if(e&1&&n.\u0275\u0275template(0,Dt,7,7,"ng-container",5)(1,Ft,3,6,"ng-template",null,0,n.\u0275\u0275templateRefExtractor)(3,Bt,4,3,"ng-template",null,1,n.\u0275\u0275templateRefExtractor),e&2){const a=n.\u0275\u0275reference(2);n.\u0275\u0275property("ngIf",(r.actions==null?null:r.actions.length)&&!r.readonly)("ngIfElse",a)}},dependencies:[g.NgIf,g.NgTemplateOutlet,Ot.IK,Vt.O,Y.MatIcon,Nt.d,f.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{flex-shrink:1;min-width:0}[_nghost-%COMP%]:not(.crt-summary-item-readonly):hover   .crt-summary-item[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly):focus-visible   .crt-summary-item[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly).crt-summary-item-actions-opened   .crt-summary-item[_ngcontent-%COMP%]{background-color:var(--crt-palette-interaction-500)}[_nghost-%COMP%]:not(.crt-summary-item-readonly):hover   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly):hover   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-value[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly):focus-visible   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly):focus-visible   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-value[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly).crt-summary-item-actions-opened   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly).crt-summary-item-actions-opened   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-value[_ngcontent-%COMP%]{color:var(--crt-palette-secondary-A400)}.crt-summary-item-readonly[_nghost-%COMP%]   .crt-summary-item[_ngcontent-%COMP%]{cursor:default}[_nghost-%COMP%]:focus-visible{outline:none}[_nghost-%COMP%]:focus-visible   .crt-summary-item[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:9px}.crt-summary-item-invalid[_nghost-%COMP%]:hover   .crt-summary-item[_ngcontent-%COMP%], .crt-summary-item-invalid[_nghost-%COMP%]:focus-visible   .crt-summary-item[_ngcontent-%COMP%], .crt-summary-item-invalid.crt-summary-item-actions-opened[_nghost-%COMP%]   .crt-summary-item[_ngcontent-%COMP%]{background-color:var(--crt-palette-error-50)}.crt-summary-item-invalid[_nghost-%COMP%]:hover   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], .crt-summary-item-invalid[_nghost-%COMP%]:focus-visible   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], .crt-summary-item-invalid.crt-summary-item-actions-opened[_nghost-%COMP%]   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%]{color:var(--crt-palette-error-500)}.crt-summary-item-invalid[_nghost-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], .crt-summary-item-invalid[_nghost-%COMP%]   .crt-summary-item-invalid-icon[_ngcontent-%COMP%]{color:var(--crt-palette-error-500)}.crt-summary-item-invalid[_nghost-%COMP%]   .crt-summary-item-invalid-icon[_ngcontent-%COMP%]{width:16px;height:16px}.crt-summary-item[_ngcontent-%COMP%]{font-family:var(--crt-body-2-font-family);font-size:var(--crt-body-2-font-size);line-height:var(--crt-body-2-line-height);font-weight:var(--crt-body-2-font-weight);letter-spacing:var(--crt-body-2-letter-spacing);text-transform:var(--crt-body-2-text-transform);-webkit-font-smoothing:antialiased;height:18px;box-sizing:border-box;display:flex;border-radius:9px;padding:1px 8px;align-items:center;white-space:nowrap;cursor:pointer}.crt-summary-item-label[_ngcontent-%COMP%], .crt-summary-item-value[_ngcontent-%COMP%]{line-height:18px}.crt-summary-item-label[_ngcontent-%COMP%]{color:var(--crt-palette-label-500);padding-inline-end:4px;flex-shrink:1;min-width:0;overflow:hidden;text-overflow:ellipsis}.crt-summary-item-value[_ngcontent-%COMP%]{color:var(--crt-palette-secondary-500);font-weight:600}"],changeDetection:0})}};(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",String)],C.prototype,"label",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",String)],C.prototype,"value",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",String),(0,o.__metadata)("design:paramtypes",[String])],C.prototype,"error",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Array)],C.prototype,"actions",void 0),(0,o.__decorate)([(0,_.k)({defaultValue:!1}),(0,o.__metadata)("design:type",Boolean),(0,o.__metadata)("design:paramtypes",[Boolean])],C.prototype,"readonly",null),C=(0,o.__decorate)([(0,We.v)({type:"crt.SummaryItem",reuseStrategy:Je.B.Reuse}),(0,Ze.f)({designControlConfig:{selfSelect:!1},designViewItemCommands:{copy:"crt.CopySummaryItemCommand"}})],C);var Se=m(4164);let ge=class{_isEqualByModel(t,e){return"modelName"in t&&"modelName"in e&&t.modelName?t.modelName===e.modelName:!1}_isEqualByViewElement(t,e){return"viewElementName"in t&&"viewElementName"in e&&t.viewElementName?t.viewElementName===e.viewElementName:!1}convert(t,e,r){return!t||!r?!1:this._isEqualByViewElement(t,r)||this._isEqualByModel(t,r)}};ge=(0,o.__decorate)([(0,Se.a)({type:"crt.IsTargetSummaryItem"})],ge);var d=m(73308),$t=m(91775),I=m(86464),T;(function(i){i.None="None",i.Count="Count",i.Sum="Sum",i.Avg="Avg",i.Min="Min",i.Max="Max",i.TopOne="TopOne"})(T||(T={}));var he;(function(i){i.SysSetting="SysSetting",i.SysValue="SysValue",i.Parameter="Parameter",i.Record="Record",i.Collection="Collection",i.EsqAggregation="EsqAggregation"})(he||(he={}));var ve;(function(i){i.PowerFx="PowerFx"})(ve||(ve={}));const Lt=new Map([["count",T.Count],["avg",T.Avg],["max",T.Max],["min",T.Min],["sum",T.Sum]]);class O{constructor(){this.collectionVariableName="SummaryItem"}_getColumnName(t,e){return e?t.name?`${e}${t.name}`:t.path?`${e}${t.path}`:t.name:t.name}_getAdjustedOptions(t){const e=(t?.columns??[]).filter(r=>!!r?.path).map(r=>this._getAdjustedColumn(r,t.function));return{...t,columns:e}}_getAdjustedColumn(t,e){return{...t,name:this._getColumnName(t,e)?.replace(/\./g,""),aggregationType:Lt.get(e)}}_createExpression(t){const e=t.columns.map(r=>r.name).filter(Boolean);return!t.function||!e.length?"":`#${this.collectionVariableName}#.${e[0]}`}_createExpressionVariables(t){const{entitySchemaName:e,filters:r,columns:a}=t??{};return[{name:this.collectionVariableName,variableType:he.EsqAggregation,dataValueType:I.r.CUSTOM_OBJECT,config:{value:e,columns:a,filters:r}}]}create(t){const e=this._getAdjustedOptions(t);if(!e.entitySchemaName)return null;const r=this._createExpression(e);return r?{engineType:ve.PowerFx,expression:r,expressionVariables:this._createExpressionVariables(e),parameters:[],resultDataValueType:t.resultDataValueType}:null}static{this.\u0275fac=function(e){return new(e||O)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}}let _e=class{constructor(t){this._expressionMetadataCreator=t}_getModelFilters(t,e){const r={type:"crt.GetDataSourceLoadFiltersRequest",dataSourceName:t,$context:e};return $t.t.instance.process(r)}_getEntitySchemaName(t,e){return e?.dataSchemas?.[t]?.dataSourceConfig?.config?.entitySchemaName}convert(t,e,r,a){var s=this;return(0,d.A)(function*(){if(!r||!a)return null;const c=yield s._getModelFilters(r,e);return c?s._expressionMetadataCreator.create({entitySchemaName:s._getEntitySchemaName(r,e),filters:c,columns:a.columns,function:a.function,resultDataValueType:a.resultDataValueType}):null})()}};_e=(0,o.__decorate)([(0,Se.a)({type:"crt.SummaryItemToExpressionMetadata"}),(0,o.__metadata)("design:paramtypes",[O])],_e);var K=m(41287),A=m(844),Ce=m(92009),Ie=m(91856);let X=class extends K.l{constructor(t,e){super(),this._schemaService=t,this._summaryItemSetupService=e}_getSummaryItemModelName(t){return this._schemaService.getViewConfigInfoByName(t)?.viewConfig?._designOptions?.modelName}_setupSummaryItem(t){const{summariesName:e}=t,r=this._getSummaryItemModelName(e);return r?this._summaryItemSetupService.setup(r):Promise.resolve(null)}_createSummaryItem(t,e){const{scopes:r,$context:a,summariesName:s}=t,{resources:c,viewConfig:u}=e,l={type:"crt.CreateSummaryItemRequest",scopes:r,$context:a,resources:c,summariesName:s,summaryItemViewConfig:u};return this.handlerChain.process(l)}handle(t){var e=this;return(0,d.A)(function*(){const r=yield e._setupSummaryItem(t);return r&&(yield e._createSummaryItem(t,r)),e.next?.handle(t)})()}};X=(0,o.__decorate)([(0,A.l)({type:"crt.AddSummaryItemHandler",requestType:"crt.AddSummaryItemRequest"}),(0,o.__metadata)("design:paramtypes",[Ce.R,Ie.G])],X);var Ae=m(52439),S=m(59969);function Qt(i){return i?.name?.replace(/[^\w]/g,"")||qe()}function qe(){return S.$A.generateUnique("Summaries")}function Me(i){return`${Qt(i)}_Expanded`}let q=class extends K.l{constructor(t){super(),this._schemaService=t}_getSummariesViewConfig(t){return this._schemaService.getViewConfigInfoByName(t)?.viewConfig}_getSummariesExpandedStateAttributeName(t){const{expanded:e}=t;return typeof e=="boolean"?null:(0,Ae.qG)(e)?(0,Ae.YK)(e).attributePath:Me(t)}handle(t){var e=this;return(0,d.A)(function*(){const{scopes:r,$context:a,summariesName:s}=t;if(!s)return e.next?.handle(t);const c=e._getSummariesViewConfig(s);if(!c)return e.next?.handle(t);const u=e._getSummariesExpandedStateAttributeName(c);if(!u)return e.next?.handle(t);const l={type:"crt.ChangeViewModelAttributeValueRequest",scopes:r,$context:a,attributeName:u,attributeValue:!0};return yield e.handlerChain.process(l),e.next?.handle(t)})()}};q=(0,o.__decorate)([(0,A.l)({type:"crt.ExpandSummariesHandler",requestType:"crt.CreateSummaryItemRequest"}),(0,o.__metadata)("design:paramtypes",[Ce.R])],q);var et=m(40968),tt=m(22592),nt=m(99298),z=m(13111),V=m(28399),xe=m(62278),Ee=m(27286);class N extends K.l{updateSummaryItemValue(t,e,r){const a={type:"crt.UpdateSummaryItemValueRequest",scopes:e,$context:r,target:t};return this.handlerChain.process(a)}}let ee=class extends N{constructor(t,e,r,a){super(),this._maskService=t,this._schemaPartsService=e,this._summaryItemEditingService=r,this._liveAnnouncementService=a}_editSummaryItem(t,e){var r=this;return(0,d.A)(function*(){let a=!1;const s=`PREPARE_EDITING_SUMMARY_ITEM_${t}`;return yield r._maskService.showMask(s,e),yield r._schemaPartsService.apply(function(){var c=(0,d.A)(function*([u,l]){const p=yield r._getSummaryItemMetaSettings(t,u,l);if(yield r._maskService.hideMask(s,e),!p?.viewConfig)return;const y=yield(0,xe.firstValueFrom)(r._summaryItemEditingService.edit((0,V.cloneDeep)(p)));!y?.viewConfig||(0,V.isEqual)(p,y)||(a=!0,(0,V.assign)(p.viewConfig,y.viewConfig),yield l.upsertResources(y.resources))});return function(u){return c.apply(this,arguments)}}()),a&&(yield r._schemaPartsService.commit({silent:!1})),a})()}_getSummaryItemMetaSettings(t,e,r){return(0,d.A)(function*(){const a=e.getViewConfigInfoByName(t)?.viewConfig;return a?{resources:yield r.loadResources(),viewConfig:a}:null})()}handle(t){var e=this;return(0,d.A)(function*(){const{scopes:r,$context:a,name:s}=t;return!s||!a||(yield e._editSummaryItem(s,a))&&(yield e.updateSummaryItemValue({viewElementName:s},r,a),yield e._liveAnnouncementService.announce("SummaryItem.Statuses.Edited")),e.next?.handle(t)})()}};ee=(0,o.__decorate)([(0,A.l)({type:"crt.EditSummaryItemHandler",requestType:"crt.EditSummaryItemRequest"}),(0,o.__param)(0,(0,et.j)(nt.V)),(0,o.__metadata)("design:paramtypes",[tt.s,z.N,Ee.x,S.DW])],ee);var Re=m(65878);let te=class extends N{constructor(t,e,r){super(),this._schemaPartsService=t,this._liveAnnouncementService=e,this._summaryItemMetaSettingsCreator=r}_createSummaryItem(t,e){var r=this;return(0,d.A)(function*(){const{resources:a,viewConfig:s}=e;let c=!1;yield r._schemaPartsService.apply(function(){var u=(0,d.A)(function*([l,p]){const y=l.getViewConfigInfoByName(t)?.viewConfig;y&&(y.items??=[],y.items.push(s),a&&(yield p.upsertResources(a)),c=!0)});return function(l){return u.apply(this,arguments)}}()),yield r._schemaPartsService.commit({silent:!1}),c&&(yield r._liveAnnouncementService.announce("SummaryItem.Statuses.Added"))})()}_createSummaryItemMetaSettings(t){const{resources:e,summaryItemViewConfig:r,summaryItemCreationConfig:a}=t;return a?this._summaryItemMetaSettingsCreator.create(a):{resources:e,viewConfig:r}}handle(t){var e=this;return(0,d.A)(function*(){const{scopes:r,$context:a,summariesName:s}=t,c=e._createSummaryItemMetaSettings(t),u=c?.viewConfig?.name;return u&&(yield e._createSummaryItem(s,c),yield e.updateSummaryItemValue({viewElementName:u},r,a)),e.next?.handle(t)})()}};te=(0,o.__decorate)([(0,A.l)({type:"crt.CreateSummaryItemHandler",requestType:"crt.CreateSummaryItemRequest"}),(0,o.__metadata)("design:paramtypes",[z.N,S.DW,Re.A])],te);let ne=class extends K.l{constructor(t){super(),this._liveAnnouncementService=t}_deleteSummaryItem(t){const{scopes:e,$context:r,name:a}=t,s={type:"crt.RemoveViewElementRequest",scopes:e,$context:r,name:a};return this.handlerChain.process(s)}handle(t){var e=this;return(0,d.A)(function*(){yield e._deleteSummaryItem(t),yield e._liveAnnouncementService.announce("SummaryItem.Statuses.Deleted")})()}};ne=(0,o.__decorate)([(0,A.l)({type:"crt.DeleteSummaryItemHandler",requestType:"crt.DeleteSummaryItemRequest"}),(0,o.__metadata)("design:paramtypes",[S.DW])],ne);let re=class extends N{handle(t){var e=this;return(0,d.A)(function*(){const{scopes:r,$context:a,model:s}=t;if(s?.name){const c={modelName:s?.name};yield e.updateSummaryItemValue(c,r,a)}return e.next?.handle(t)})()}};re=(0,o.__decorate)([(0,A.l)({type:"crt.UpdateSummaryItemValueAfterModelInsertHandler",requestType:"crt.HandleAfterModelInsertRequest"})],re);let ae=class extends N{handle(t){var e=this;return(0,d.A)(function*(){const{scopes:r,$context:a,model:s}=t;if(s?.name){const c={modelName:s?.name};yield e.updateSummaryItemValue(c,r,a)}return e.next?.handle(t)})()}};ae=(0,o.__decorate)([(0,A.l)({type:"crt.UpdateSummaryItemValueAfterModelUpdateHandler",requestType:"crt.HandleAfterModelUpdateRequest"})],ae);let ie=class extends N{handle(t){var e=this;return(0,d.A)(function*(){const{scopes:r,$context:a,model:s}=t;if(s?.name){const c={modelName:s?.name};yield e.updateSummaryItemValue(c,r,a)}return e.next?.handle(t)})()}};ie=(0,o.__decorate)([(0,A.l)({type:"crt.UpdateSummaryItemValueBeforeModelLoadHandler",requestType:"crt.HandleBeforeModelLoadRequest"})],ie);var kt=m(85604);let se=class extends N{handle(t){var e=this;return(0,d.A)(function*(){const{scopes:r,$context:a,modelEvent:s,modelName:c}=t;if(s?.type===kt.M.Delete&&s?.payload?.primaryAttributesValues.length===1){const u={modelName:c};yield e.updateSummaryItemValue(u,r,a)}return e.next?.handle(t)})()}};se=(0,o.__decorate)([(0,A.l)({type:"crt.UpdateSummaryItemValueOnModelEventDeleteHandler",requestType:"crt.HandleModelEventRequest"})],se);var Te=m(31774),Gt=m(44462);class rt extends K.l{constructor(t){super(),this._messageDialogProvider=t}isActionConfirmed(){return(0,xe.lastValueFrom)(this._messageDialogProvider.confirmation(this.confirmationDialogMessage),{defaultValue:null})}setSummariesItems(t,e,r){const a=this.getSummariesViewConfig(t,r);if(!a)return;const s=this.getSummariesViewConfig(t,e);a.items=s?.items??[],r.init(r.schema)}findSummaryItemsResources(t,e,r){const a=this.getSummariesViewConfig(t,r),s=Array.isArray(a.items)?a.items.map(u=>(0,Gt.kS)(u.label)):[],c=Object.entries(e.localizableStrings).filter(([u])=>s.includes(u));return{localizableStrings:Object.fromEntries((0,V.cloneDeep)(c)),localizableImages:{}}}getSummariesViewConfig(t,e){return e.getViewConfigInfoByName(t)?.viewConfig}handle(t){var e=this;return(0,d.A)(function*(){(yield e.isActionConfirmed())&&(yield e.innerHandle(t))})()}}let me=class extends rt{constructor(t,e,r,a,s){super(t),this._liveAnnouncementService=e,this._maskService=r,this._schemaPartsService=a,this._schemaService=s,this.confirmationDialogMessage="ConfirmationDialog.ResetSummaries"}_getSummariesResources(t,e){var r=this;return(0,d.A)(function*(){const[a,s]=e,c=yield s.loadResources();return r.findSummaryItemsResources(t,c,a)})()}_cleanSummariesResources(t,e,r){var a=this;return(0,d.A)(function*(){const s=yield a._getSummariesResources(t,e),c=yield a._getSummariesResources(t,r);Object.keys(s.localizableStrings).forEach(l=>{const p=s.localizableStrings[l],y=c.localizableStrings[l];Object.keys(p).forEach(v=>{p[v]=y?.[v]})});const[,u]=e;yield u.upsertResources(s)})()}_resetSummaryItems(t){var e=this;return(0,d.A)(function*(){const{summariesName:r,$context:a}=t,s=`RESETTING_${r}_SUMMARIES`;e._maskService.showMask(s,a);const[c,u]=yield e._schemaPartsService.use("ALL_EMPLOYERS");yield e._schemaPartsService.apply(function(){var l=(0,d.A)(function*([p,y]){yield e._cleanSummariesResources(r,[p,y],[c,u]),e.setSummariesItems(r,c,p)});return function(p){return l.apply(this,arguments)}}(),"USER"),yield e._schemaPartsService.commit({silent:!1}),e._maskService.hideMask(s,a)})()}_updateSummaryItemsValue(t){var e=this;return(0,d.A)(function*(){const{scopes:r,$context:a,summariesName:s}=t,l=(e.getSummariesViewConfig(s,e._schemaService)?.items??[]).map(({name:p})=>e.handlerChain.process({type:"crt.UpdateSummaryItemValueRequest",scopes:r,$context:a,target:{viewElementName:p}}));yield Promise.all(l)})()}innerHandle(t){var e=this;return(0,d.A)(function*(){t.summariesName&&(yield e._resetSummaryItems(t),yield e._updateSummaryItemsValue(t),yield e._liveAnnouncementService.announce("Summaries.ProfileActions.ResetToDefaultSuccessfully"))})()}};me=(0,o.__decorate)([(0,A.l)({type:"crt.ResetSummariesHandler",requestType:"crt.ResetSummariesRequest"}),(0,o.__param)(2,(0,et.j)(nt.V)),(0,o.__metadata)("design:paramtypes",[Te.r,S.DW,tt.s,z.N,Ce.R])],me);var at=m(6503);let oe=class ye extends rt{constructor(t,e,r){super(t),this._schemaPartsService=e,this._notifyService=r,this.confirmationDialogMessage="ConfirmationDialog.SaveSummariesForAll"}_setAllEmployeePart(t,e,r){var a=this;return(0,d.A)(function*(){yield a._schemaPartsService.apply(function(){var s=(0,d.A)(function*([c,u]){a.setSummariesItems(t,e,c),yield u.upsertResources(r)});return function(c){return s.apply(this,arguments)}}(),"ALL_EMPLOYERS")})()}innerHandle({summariesName:t}){var e=this;return(0,d.A)(function*(){if(!t)return;const[r,a]=yield e._schemaPartsService.use("USER"),s=yield a.loadResources(),c=e.findSummaryItemsResources(t,s,r);yield e._setAllEmployeePart(t,r,c),yield e._schemaPartsService.commit({silent:!1}),yield e._notifyService.show({message:"Summaries.ProfileActions.SaveForAllSuccessfully"})})()}static{this.\u0275fac=function(e){return new(e||ye)(n.\u0275\u0275inject(Te.r),n.\u0275\u0275inject(z.N),n.\u0275\u0275inject(at.F))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ye,factory:ye.\u0275fac,providedIn:"root"})}};oe=(0,o.__decorate)([(0,A.l)({type:"crt.SaveSummariesForAllHandler",requestType:"crt.SaveSummariesForAllRequest"}),(0,o.__metadata)("design:paramtypes",[Te.r,z.N,at.F])],oe);var it=m(39482);let M=class Qe{static{this.\u0275fac=function(e){return new(e||Qe)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:Qe})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[it.$,O,Re.A],imports:[g.CommonModule,ze.D,Y.MatIconModule,Z.S,f.TranslateModule]})}};M=(0,o.__decorate)([(0,fe.g)({converters:[ge,_e],viewElements:[C],requestHandlers:[X,q,ee,te,ne,re,ae,ie,se,me,oe]})],M),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(M,{declarations:[C],imports:[g.CommonModule,ze.D,Y.MatIconModule,Z.S,f.TranslateModule],exports:[C]})}();var st=m(56711),mt=m(70987),ot=m(35314),ce=m(31149),ct=m(75909),ut=m(43981),lt=m(57274),Oe=m(83296);class x{static{this.\u0275fac=function(e){return new(e||x)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:x})}static{this.\u0275inj=n.\u0275\u0275defineInjector({imports:[g.CommonModule,ce.q,ct.r,ut.k,Z.S,Y.MatIconModule,mt.MatLegacyInputModule,lt.u,f.TranslateModule,ot.y,st.ReactiveFormsModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(x,{declarations:[Oe.E],imports:[g.CommonModule,ce.q,ct.r,ut.k,Z.S,Y.MatIconModule,mt.MatLegacyInputModule,lt.u,f.TranslateModule,ot.y,st.ReactiveFormsModule],exports:[Oe.E]})})();var dt=m(50663),pt=m(59649),yt=m(96176),ft=m(39202),Yt=m(34760),Kt=m(10098);class P{static{this.\u0275fac=function(e){return new(e||P)}}static{this.\u0275dir=n.\u0275\u0275defineDirective({type:P,selectors:[["","crtSummariesActions",""]]})}}var zt=m(62115),Wt=m(71983),Jt=m(12577),Zt=m(5475),Xt=m(30491);const qt=i=>({"aria-expanded":i});function en(i,t){if(i&1&&(n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275elementContainer(1,9),n.\u0275\u0275elementContainerEnd()),i&2){const e=t.$implicit;n.\u0275\u0275advance(),n.\u0275\u0275property("crtViewElement",e)}}function tn(i,t){if(i&1){const e=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"crt-button",11),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275listener("clicked",function(){n.\u0275\u0275restoreView(e);const a=n.\u0275\u0275nextContext(3);return n.\u0275\u0275resetView(a.toggleExpansionState())}),n.\u0275\u0275elementEnd()}if(i&2){const e=n.\u0275\u0275nextContext(3);n.\u0275\u0275property("attributes",n.\u0275\u0275pureFunction1(5,qt,e.expanded))("icon",e.expanded?"summaries-expansion-indicator-expanded":"summaries-expansion-indicator-collapsed")("title",n.\u0275\u0275pipeBind1(1,3,e.expanded?"Summaries.Hints.Collapse":"Summaries.Hints.Expand"))}}function nn(i,t){if(i&1&&(n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275template(1,tn,2,7,"crt-button",10),n.\u0275\u0275elementContainerEnd()),i&2){const e=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",e.hasHidden)}}function rn(i,t){if(i&1&&(n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275elementContainer(1,9),n.\u0275\u0275elementContainerEnd()),i&2){const e=t.$implicit;n.\u0275\u0275advance(),n.\u0275\u0275property("crtViewElement",e)}}function an(i,t){if(i&1&&(n.\u0275\u0275elementStart(0,"div",12),n.\u0275\u0275template(1,rn,2,1,"ng-container",13),n.\u0275\u0275elementEnd()),i&2){const e=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(),n.\u0275\u0275property("ngForOf",e.wrappedItems)("ngForTrackBy",e.trackByFn)}}function sn(i,t){if(i&1){const e=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",4)(1,"crt-adaptive-container",5),n.\u0275\u0275listener("visibilityStateChange",function(a){n.\u0275\u0275restoreView(e);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.onVisibilityStateChange(a))}),n.\u0275\u0275template(2,en,2,1,"ng-container",6)(3,nn,2,1,"ng-container",7),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(4,an,2,2,"div",8),n.\u0275\u0275elementEnd()}if(i&2){const e=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("wrap",!1)("items",e.renderedItems)("trackByFn",e.trackByFn)("getItemsByElements",e.getItemsByElements),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngIf",e.expanded)}}function mn(i,t){i&1&&n.\u0275\u0275elementContainer(0)}function on(i,t){if(i&1&&(n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275element(1,"crt-button",14),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementContainerEnd()),i&2){const e=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("title",n.\u0275\u0275pipeBind1(2,5,e.title||"Summaries.Actions.Title"))("caption",e.items!=null&&e.items.length?"":n.\u0275\u0275pipeBind1(3,7,"Summaries.Caption"))("iconPosition",e.items!=null&&e.items.length?"only-icon":"left-icon")("menuItems",e.actions)("disabled",e.disabled)}}let h=class ke extends Xe.K{set items(t){this._items=(t||[]).filter(e=>e?.type==="crt.SummaryItem"),this._setRenderedItems()}get items(){return this._items}set expanded(t){t!=null&&(this._expanded=!!t)}get expanded(){return this._expanded}constructor(t){super(t),this.injector=t,this._visibleItems={},this._expanded=!0,this.renderedItems=[],this.wrappedItems=[],this.hasHidden=!0,this.expandedChange=new n.EventEmitter}_setRenderedItems(){const t=this._items.map(e=>({...e,value:this._visibleItems[e.name]?e.value:void 0}));(0,V.isEqual)(t,this.renderedItems)||(this.renderedItems=t,this.changeDetectorRef.detectChanges())}_setLoadedItems(t){Array.from(t).map(r=>r?.getAttribute&&r.getAttribute("element-name")).filter(Boolean).forEach(r=>{const a=this.items.find(s=>s.name===r);a&&(this._visibleItems[a.name]=a)})}_setWrappedItems(t){this.wrappedItems=this.getItemsByElements(this.items,t),this.changeDetectorRef.detectChanges()}trackByFn(t,e){return e.name+e.value+e.label}onVisibilityStateChange(t){this.hasHidden=!!t.hiddenItems.length,this._setLoadedItems(t.visibleItems),this._setRenderedItems(),this._setWrappedItems(t.hiddenItems)}toggleExpansionState(){this.expandedChange.emit(!this.expanded),this.changeDetectorRef.detectChanges()}getItemsByElements(t,e){return!t||!e?[]:e.map(a=>a?.getAttribute&&a.getAttribute("element-name")).map(a=>t?.find(s=>s.name===a)).filter(Boolean)}static{this.\u0275fac=function(e){return new(e||ke)(n.\u0275\u0275directiveInject(n.Injector))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:ke,selectors:[["crt-summaries"]],contentQueries:function(e,r,a){if(e&1&&n.\u0275\u0275contentQuery(a,P,5,n.TemplateRef),e&2){let s;n.\u0275\u0275queryRefresh(s=n.\u0275\u0275loadQuery())&&(r.summariesActionsTemplate=s.first)}},inputs:{items:"items",actions:"actions",expanded:"expanded",title:"title",disabled:"disabled",readonly:"readonly"},outputs:{expandedChange:"expandedChange"},features:[n.\u0275\u0275InheritDefinitionFeature],decls:4,vars:5,consts:[[1,"crt-summaries"],["class","crt-summaries-list",4,"ngIf"],[4,"ngTemplateOutlet"],[4,"ngIf"],[1,"crt-summaries-list"],["justifyContent","end",3,"visibilityStateChange","wrap","items","trackByFn","getItemsByElements"],[4,"crtAdaptiveContainerItem"],[4,"crtAdaptiveContainerSuffix"],["class","crt-summaries-wrapped-items",4,"ngIf"],[3,"crtViewElement"],["iconPosition","only-icon","displayType","text","size","small","class","crt-summaries-expansion-indicator",3,"attributes","icon","title","clicked",4,"ngIf"],["iconPosition","only-icon","displayType","text","size","small",1,"crt-summaries-expansion-indicator",3,"clicked","attributes","icon","title"],[1,"crt-summaries-wrapped-items"],[4,"ngFor","ngForOf","ngForTrackBy"],["size","small","icon","sum-icon","clickMode","menu","displayType","text",1,"crt-summaries-actions",3,"title","caption","iconPosition","menuItems","disabled"]],template:function(e,r){e&1&&(n.\u0275\u0275elementStart(0,"div",0),n.\u0275\u0275template(1,sn,5,5,"div",1)(2,mn,1,0,"ng-container",2)(3,on,4,9,"ng-container",3),n.\u0275\u0275elementEnd()),e&2&&(n.\u0275\u0275classProp("crt-summaries-with-hidden",r.hasHidden),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",r.items==null?null:r.items.length),n.\u0275\u0275advance(),n.\u0275\u0275property("ngTemplateOutlet",r.summariesActionsTemplate),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",!r.summariesActionsTemplate&&!r.readonly))},dependencies:[g.NgForOf,g.NgIf,g.NgTemplateOutlet,zt.B,Wt.u,Jt.V,Zt.t,Xt.H,f.TranslatePipe],styles:["[_nghost-%COMP%]{flex-shrink:1;min-width:0}.crt-summaries[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:2px}.crt-summaries-list[_ngcontent-%COMP%]{min-width:0}.crt-summaries-wrapped-items[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:flex-end}.crt-summaries-expansion-indicator[_ngcontent-%COMP%]{margin-inline-start:2px}"],changeDetection:0})}};(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Array),(0,o.__metadata)("design:paramtypes",[Array])],h.prototype,"items",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Array)],h.prototype,"actions",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Boolean),(0,o.__metadata)("design:paramtypes",[Boolean])],h.prototype,"expanded",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",String)],h.prototype,"title",void 0),(0,o.__decorate)([(0,_.k)({defaultValue:!1}),(0,o.__metadata)("design:type",Boolean)],h.prototype,"disabled",void 0),(0,o.__decorate)([(0,_.k)({defaultValue:!1}),(0,o.__metadata)("design:type",Boolean)],h.prototype,"readonly",void 0),(0,o.__decorate)([(0,Yt.j)(),(0,o.__metadata)("design:type",n.EventEmitter)],h.prototype,"expandedChange",void 0),h=(0,o.__decorate)([(0,We.v)({type:"crt.Summaries",reuseStrategy:Je.B.Reuse}),(0,Ze.f)({typeCaption:"Components.Summaries.Caption",viewElementGroupType:Kt.J.Components,toolbarConfig:{position:190,icon:m(93616),defaultPropertyValues:{items:[]}},designControlConfig:{allowDesignContent:!0},designViewItemCommands:{copy:"crt.CopySummariesCommand"},propertiesPanelComponentTypeName:"crt.SummariesPropertiesPanel",collectionPropertyNames:["items"]}),(0,o.__metadata)("design:paramtypes",[n.Injector])],h);var cn=m(21832),un=m(73335),ln=m(42936),ue=m(99056),St=m(57984),gt=m(29134),Ve=m(14716);const ht=new n.InjectionToken("Represents a factory for creating functions of summary item creation action"),dn=2,Ne=9,pn=[un.D.OwnAttribute],yn=[I.r.Guid];class b{constructor(t,e,r){this._translateService=t,this._quickSummaryItemActionIconFactory=e,this._quickSummaryItemActionFunctionsFactory=r}_toExpressionColumn(t){return{type:ln.d.Column,path:t.path}}_getPrimaryDataSchemaAttributes(t){return t.getPrimaryAttributesNames().map(e=>(t?.attributes??[]).find(r=>r?.name===e)).filter(e=>e?.path)}_getAvailableDataSchemaAttributesGroups(t,e){const r=this._getAvailableDataSchemaAttributes(t);if(!r.length)return[];if(r.length<=dn)return[r];const a=this._getDefinedDataSchemaAttributes(e,r);if(a.length===Ne)return[a];const s=r.filter(c=>!a.some(u=>c.name===u.name)).slice(0,Ne-a.length);return[a,s].filter(c=>c.length)}_getAvailableDataSchemaAttributes(t){return(t?.attributes??[]).filter(e=>e?.caption&&pn.includes(e?.attributeType)&&!yn.includes(e?.dataValueType)&&!ue.b.includes(e?.path)&&ue.p.includes(e?.dataValueType)).sort((e,r)=>e.caption?.localeCompare(r.caption))}_getDefinedDataSchemaAttributes(t,e){const r=t?.isCollection?t?.attributes?.map(a=>a?.path).filter(Boolean)??[]:[];return e.filter(a=>r.includes(a.name)).slice(0,Ne)}_createCountQuickSummaryItemAction(t){const e=t.map(r=>this._toExpressionColumn(r));return e.length?{name:"Count",icon:"formula-icon",caption:this._translateService.instant("Summaries.Actions.CreateCount"),summaryItemOptions:{label:this._translateService.instant("Summaries.QuickSummaries.Count"),expression:{function:"count",columns:e,resultDataValueType:I.r.Integer}}}:null}_createQuickSummaryItemActionByAttribute(t){const{name:e,caption:r,dataValueType:a}=t??{},s=this._quickSummaryItemActionIconFactory.create(a),c=this._quickSummaryItemActionFunctionsFactory.create(a)??[];return{name:e,icon:s,caption:r,actions:c.map(u=>this._createQuickSummaryItemActionByFunction(t,u))}}_createQuickSummaryItemActionByFunction(t,e){const r=this._translateService.instant(St.I[e]);return{name:`${t.name}_${e}`,icon:"formula-icon",caption:r,summaryItemOptions:{label:(0,gt.I)(t.caption,r),expression:{function:e,columns:[this._toExpressionColumn(t)],resultDataValueType:t.dataValueType}}}}getActionsGroups(t,e){if(!t||!e)return[];const r=this._getPrimaryDataSchemaAttributes(t),a=this._getAvailableDataSchemaAttributesGroups(t,e),s=this._createCountQuickSummaryItemAction(r),c=a.map(u=>u.map(l=>this._createQuickSummaryItemActionByAttribute(l)));return s?c.length?(c[0].unshift(s),c):[[s]]:c}static{this.\u0275fac=function(e){return new(e||b)(n.\u0275\u0275inject(f.TranslateService),n.\u0275\u0275inject(ht),n.\u0275\u0275inject(Ve.n))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac})}}const Pe={type:"crt.MenuDivider"},fn="CanCreateDefaultSummariesSettings";let be=class{constructor(t,e,r){this._rightsService=t,this._translateService=e,this._quickSummaryItemCreationActionsProvider=r}_getProfileActions(t){var e=this;return(0,d.A)(function*(){if(!t)return[];const r=[{type:"crt.MenuItem",caption:e._translateService.instant("Summaries.ProfileActions.ResetToDefault"),icon:"reset-summaries",clicked:{request:"crt.ResetSummariesRequest",params:{summariesName:t}}}];return(yield e._rightsService.getCanExecuteOperation(fn))&&r.unshift({type:"crt.MenuItem",caption:e._translateService.instant("Summaries.ProfileActions.SaveForAll"),icon:"save",clicked:{request:"crt.SaveSummariesForAllRequest",params:{summariesName:t}}}),r})()}_createQuickSummaryItemMenuItemsSection(t,e,r){var a=this;return(0,d.A)(function*(){if(!t||!e)return[];const s=r.getModelByName(e),c=r._dataSourcesInfos.get(e);if(!s||!c)return[];const u=yield(0,xe.lastValueFrom)(s.getSchema()),l=a._quickSummaryItemCreationActionsProvider.getActionsGroups(u,c),p=l?.flat()?.length,y=l.map(v=>a._createQuickSummaryItemMenuItems(t,v,e)).filter(v=>v?.length).map((v,J,de)=>J===de.length-1?v:[...v,Pe]).flat();return p?[{type:"crt.MenuLabel",caption:a._translateService.instant("Summaries.QuickSummaries.QuickSetup")},...y,Pe]:[]})()}_createQuickSummaryItemMenuItems(t,e,r){return e?.length?e.map(a=>this._createQuickSummaryItemMenuItem(t,a,r)).filter(Boolean):[]}_createQuickSummaryItemMenuItem(t,e,r){return e?.actions?.length?this._createQuickSummaryItemMenuSubMenuItem(t,e,r):this._createQuickSummaryItemMenuActionItem(t,e,r)}_createQuickSummaryItemMenuSubMenuItem(t,e,r){const{name:a,icon:s,caption:c,actions:u}=e;return{type:"crt.MenuItem",name:`${t}_Create_${a}`,icon:s,caption:c,items:this._createQuickSummaryItemMenuItems(t,u,r)}}_createQuickSummaryItemMenuActionItem(t,e,r){const{name:a,icon:s,caption:c,summaryItemOptions:{label:u,expression:l}={}}=e;return{type:"crt.MenuItem",name:`${t}_Create_${a}`,icon:s,caption:c,clicked:{request:"crt.CreateSummaryItemRequest",params:{summaryItemCreationConfig:{label:u,expression:l,modelName:r},summariesName:t}}}}_createAdvancedSetupActions(t){return t?[{type:"crt.MenuLabel",caption:this._translateService.instant("Summaries.AdvancedSetup.Title")},{type:"crt.MenuItem",name:`${t}_AddCustomSummary`,icon:"add-button-icon",caption:this._translateService.instant("Summaries.AdvancedSetup.Actions.AddCustomSummary"),clicked:{request:"crt.AddSummaryItemRequest",params:{summariesName:t}}},Pe]:[]}convert(t,e,r,a){var s=this;return(0,d.A)(function*(){const c=yield s._getProfileActions(r),u=yield s._createQuickSummaryItemMenuItemsSection(r,a,e),l=s._createAdvancedSetupActions(r);return[...u,...l,...c]})()}};be=(0,o.__decorate)([(0,Se.a)({type:"crt.ToSummariesActionsAsync"}),(0,o.__metadata)("design:paramtypes",[cn.f,f.TranslateService,b])],be);let E=class Ge{constructor(t){this._materialIconsRegistrar=t,this._materialIconsRegistrar.addIcons([{name:"summaries-expansion-indicator-expanded",icon:m(25608)},{name:"summaries-expansion-indicator-collapsed",icon:m(69303)}])}static{this.\u0275fac=function(e){return new(e||Ge)(n.\u0275\u0275inject(dt.K))}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:Ge})}static{this.\u0275inj=n.\u0275\u0275defineInjector({imports:[g.CommonModule,ce.q,pt.Z,yt.c,ft.a,f.TranslateModule]})}};E=(0,o.__decorate)([(0,fe.g)({viewElements:[h],converters:[be]}),(0,o.__metadata)("design:paramtypes",[dt.K])],E),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(E,{declarations:[h,P],imports:[g.CommonModule,ce.q,pt.Z,yt.c,ft.a,f.TranslateModule],exports:[h,P]})}();var De=m(31376),Sn=m(12841);class H extends S.NS{constructor(t){super(),this._translateService=t}handle(t){const e=t?.viewConfig;return e?e._designOptions?.modelName?super.handle(t):(typeof e.title=="string"||(e.title=this._translateService.instant("Summaries.Hints.NoDataSource")),typeof e.disabled=="boolean"||(0,Ae.qG)(e.disabled)||(e.disabled=!0),super.handle(t)):super.handle(t)}static{this.\u0275fac=function(e){return new(e||H)(n.\u0275\u0275inject(f.TranslateService))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac})}}var gn=m(71281);class B extends S.NS{constructor(t){super(),this._profileAttributeService=t}handle(t){const{metadata:e,viewConfig:r}=t??{};return!e||!r?.name?super.handle(t):typeof r.expanded=="boolean"?super.handle(t):(this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,r,"expanded",Me(r)),super.handle(t))}static{this.\u0275fac=function(e){return new(e||B)(n.\u0275\u0275inject(gn.H))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac})}}var vt=m(86710),_t=m(26594),we=m(43139);class $ extends S.NS{constructor(t,e){super(),this._featureValues=t,this._licenseOperationValues=e}handle(t){const e=t?.viewConfig,r=this._licenseOperationValues[we.W];return this._featureValues.DisableSummariesRestrictionsPreprocessing||r||!e?super.handle(t):(e.readonly=!0,super.handle(t))}static{this.\u0275fac=function(e){return new(e||$)(n.\u0275\u0275inject(_t.G),n.\u0275\u0275inject(vt.W))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac})}}var hn=m(74368);class L extends S.NS{constructor(t){super(),this._metadataSchemaUtils=t}_canBindSummariesActions(t){const{viewConfig:e,metadata:r}=t;return e?.name&&e.actions==null&&e.readonly!==!0&&r!=null}_bindSummariesActionsToAttribute(t){const{metadata:e,viewConfig:r}=t,a=e.viewModelConfig.attributes,s=r.name,c=r._designOptions?.modelName,u=`${s}_Actions`,l=this._metadataSchemaUtils.findAllAttributesByDataSourceAttributePath(e,c)??[];a[u]={converter:`crt.ToSummariesActionsAsync : '${s}' : '${c}'`,triggers:l.map(p=>({request:"crt.HandleViewModelAttributeChangeRequest",filter:`crt.ToObjectProp : 'attributeName' | crt.IsEqual : '${p}'`}))},r.actions=`$${u}`}handle(t){return this._canBindSummariesActions(t)&&this._bindSummariesActionsToAttribute(t),super.handle(t)}static{this.\u0275fac=function(e){return new(e||L)(n.\u0275\u0275inject(hn.u))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac})}}class Q extends S.NS{constructor(t,e){super(),this._featureValues=t,this._licenseOperationValues=e}handle(t){const e=t?.viewConfig,r=this._licenseOperationValues[we.W];return this._featureValues.DisableSummariesRestrictionsPreprocessing||r||!e?super.handle(t):(e.readonly=!0,super.handle(t))}static{this.\u0275fac=function(e){return new(e||Q)(n.\u0275\u0275inject(_t.G),n.\u0275\u0275inject(vt.W))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac})}}var D=m(98305);const Ct=new n.InjectionToken("Represents a factory for creating summary item value format");class k extends S.NS{constructor(t){super(),this._valueFormatFactory=t}_isValidValueOptions(t){return!!(t&&t.attribute&&t.modelName&&t.expression&&t.expression.function&&t.expression.columns)}handle(t){const{metadata:e,viewConfig:r}=t??{};if(!e||!r?.name||r.value!==void 0)return super.handle(t);const a=r._designOptions?.value;if(!this._isValidValueOptions(a))return super.handle(t);const{attribute:s,expression:c,modelName:u}=a,l=(0,D.IZ)(r),p=(0,D.G0)(r),y=c.resultDataValueType??I.r.Text,v=`${a.attribute}_Format`,J=`${a.attribute}_ExecutionResult`,de=`${a.attribute}_ExecutionError`,Rt=`${a.attribute}_ExpressionOptions`;return r.value=`$${s}`,r.error=`$${de}`,e.viewModelConfig??={},e.viewModelConfig.attributes={...e.viewModelConfig.attributes??{},[J]:{converter:`crt.SummaryItemToExpressionMetadata : $${p} : $${Rt} | crt.ToExpressionResult`,triggers:[{request:"crt.UpdateSummaryItemValueRequest",filter:`crt.ToObjectProp : 'target' | crt.IsTargetSummaryItem : $${l}`}],triggersOptions:{debounce:100}},[de]:{from:J,converter:"crt.ToObjectProp: 'errorInfo' | crt.ToObjectProp: 'message'"},[s]:{from:J,converter:`crt.ToObjectProp: 'result' | crt.FormatValue : $${v} | crt.ToEmptyPlaceholder : ${y}`},[v]:{value:this._valueFormatFactory.create(y)},[Rt]:{value:{...c,resultDataValueType:y}},[p]:{value:u},[l]:{value:{modelName:u,viewElementName:r.name}}},super.handle(t)}static{this.\u0275fac=function(e){return new(e||k)(n.\u0275\u0275inject(Ct))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac})}}class G extends S.NS{constructor(t){super(),this._translateService=t}handle(t){const e=t?.viewConfig;return!e?.name||e.actions||e.readonly===!0?super.handle(t):(e.actions=[{type:"crt.MenuItem",name:`${e.name}_EditAction`,caption:this._translateService.instant("SummaryItem.Actions.Edit"),icon:"pen",clicked:{request:"crt.EditSummaryItemRequest",params:{name:e.name}}},{type:"crt.MenuItem",name:`${e.name}_DeleteAction`,caption:this._translateService.instant("SummaryItem.Actions.Delete"),icon:"delete-button-icon",clicked:{request:"crt.DeleteSummaryItemRequest",params:{name:e.name}}}],super.handle(t))}static{this.\u0275fac=function(e){return new(e||G)(n.\u0275\u0275inject(f.TranslateService))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac})}}var vn=m(60030);const It=new n.InjectionToken("Represents a handler to process summaries metadata on metadata init"),At=new n.InjectionToken("Represents a handler to process summary item metadata on metadata init");class W extends vn.X{constructor(t,e){super(),this._summariesOnMetadataInitHandler=t,this._summaryItemOnMetadataInitHandler=e}_removeSummaryItemsWithoutParent(t){t.viewConfig=(t?.viewConfig||[]).filter(e=>e.type!=="crt.SummaryItem")}crtOnMetaDataInit(t){var e=this;return(0,d.A)(function*(){const r=t;return e._removeSummaryItemsWithoutParent(r),e._summariesOnMetadataInitHandler&&(yield e.processElementsOnMetadataInit("crt.Summaries",e._summariesOnMetadataInitHandler,r)),e._summaryItemOnMetadataInitHandler&&(yield e.processElementsOnMetadataInit("crt.SummaryItem",e._summaryItemOnMetadataInitHandler,r)),Promise.resolve(t)})()}static{this.\u0275fac=function(e){return new(e||W)(n.\u0275\u0275inject(It,8),n.\u0275\u0275inject(At,8))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac})}}var _n=m(34143);const Mt=S.gX.create({token:Ve.n,mappings:[{predicate:i=>De.D.includes(i),useValue:["sum","avg","max","min"]},{predicate:i=>_n.i.includes(i),useValue:["max","min"]},{predicate:i=>i===I.r.Guid,useValue:["count"]}],default:{useValue:[]}}),xt=S.gX.create({token:ht,mappings:[{predicate:I.r.Integer,useValue:"number-integer"},{predicate:i=>(0,V.without)(De.D,I.r.Integer).includes(i),useValue:"number-decimal"},{predicate:I.r.Date,useValue:"date"},{predicate:I.r.Time,useValue:"time"},{predicate:I.r.DateTime,useValue:"date-time"}],default:{useValue:"formula-icon"}});class R{static{this.\u0275fac=function(e){return new(e||R)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:R})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[b,xt,Mt]})}}const Cn=S.gX.create({token:Ct,mappings:[{predicate:i=>(0,V.without)(De.D,I.r.Money).includes(i),useFactory:i=>({dataType:i,trimTrailingZeros:!0})}],default:{useFactory:i=>({dataType:i})}});class w{static{this.\u0275fac=function(e){return new(e||w)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:w})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[{provide:Sn.m,useClass:W,multi:!0},{provide:It,useFactory:t=>{const e=t.get(H);return e.setNext(t.get(B)).setNext(t.get($)).setNext(t.get(L)),e},deps:[n.Injector]},{provide:At,useFactory:t=>{const e=t.get(Q);return e.setNext(t.get(k)).setNext(t.get(G)),e},deps:[n.Injector]},L,B,H,G,k,$,Q,Cn],imports:[R]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(w,{imports:[R]})})();var Et=m(3022);let le=class Ye{static{this.\u0275fac=function(e){return new(e||Ye)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:Ye})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[Et.t,Ee.x,Ie.G],imports:[g.CommonModule,R,E,M,x,w,f.TranslateModule,E,M,x]})}};le=(0,o.__decorate)([(0,fe.g)({includes:[E,M]})],le),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(le,{imports:[g.CommonModule,R,E,M,x,w,f.TranslateModule],exports:[E,M,x]})}();var F=m(81517),U=m(2828);let Fe=class extends F.S{constructor(){super(...arguments),this.type="crt.AddSummaryItemRequest"}};Fe=(0,o.__decorate)([(0,U.$)({type:"crt.AddSummaryItemRequest"})],Fe);let Ue=class extends F.S{constructor(){super(...arguments),this.type="crt.CreateSummaryItemRequest"}};Ue=(0,o.__decorate)([(0,U.$)({type:"crt.CreateSummaryItemRequest"})],Ue);let je=class extends F.S{constructor(){super(...arguments),this.type="crt.DeleteSummaryItemRequest"}};je=(0,o.__decorate)([(0,U.$)({type:"crt.DeleteSummaryItemRequest"})],je);let He=class extends F.S{constructor(){super(...arguments),this.type="crt.EditSummaryItemRequest"}};He=(0,o.__decorate)([(0,U.$)({type:"crt.EditSummaryItemRequest"})],He);let Be=class extends F.S{constructor(){super(...arguments),this.type="crt.UpdateSummaryItemValueRequest"}};Be=(0,o.__decorate)([(0,U.$)({type:"crt.UpdateSummaryItemValueRequest"})],Be);let $e=class extends F.S{constructor(){super(...arguments),this.type="crt.ResetSummariesRequest"}};$e=(0,o.__decorate)([(0,U.$)({type:"crt.ResetSummariesRequest"})],$e);let Le=class extends F.S{constructor(){super(...arguments),this.type="crt.SaveSummariesForAllRequest"}};Le=(0,o.__decorate)([(0,U.$)({type:"crt.SaveSummariesForAllRequest"})],Le);var In=m(32020)},69303:j=>{j.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M3.27572 5.27844C3.64335 4.90719 4.2394 4.90719 4.60703 5.27844L8 8.70489L11.393 5.27844C11.7606 4.90719 12.3566 4.90719 12.7243 5.27844C13.0919 5.6497 13.0919 6.25163 12.7243 6.62289L8.66565 10.7216C8.29802 11.0928 7.70198 11.0928 7.33435 10.7216L3.27572 6.62289C2.90809 6.25163 2.90809 5.6497 3.27572 5.27844Z" fill="currentColor"/>
</svg>
`},25608:j=>{j.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M7.33435 5.27844C7.70198 4.90719 8.29802 4.90719 8.66565 5.27844L12.7243 9.37711C13.0919 9.74837 13.0919 10.3503 12.7243 10.7216C12.3566 11.0928 11.7606 11.0928 11.393 10.7216L8 7.29511L4.60703 10.7216C4.2394 11.0928 3.64335 11.0928 3.27572 10.7216C2.90809 10.3503 2.90809 9.74837 3.27572 9.37711L7.33435 5.27844Z" fill="currentColor"/>
</svg>
`},93616:j=>{j.exports=`<svg width="71" height="62" viewBox="0 0 71 62" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="6.46143" y="23.5" width="20.8433" height="6" rx="3" fill="#CCDEFC"/>
<rect x="30.3047" y="23.5" width="15.0966" height="6" rx="3" fill="#CCDEFC"/>
<rect x="11.3577" y="32.5" width="12.9471" height="6" rx="3" fill="#CCDEFC"/>
<rect x="27.3047" y="32.5" width="18.0966" height="6" rx="3" fill="#CCDEFC"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M49.5246 22.9091C49.7444 22.4312 50.2223 22.125 50.7483 22.125H62.5777C63.2202 22.125 63.8363 22.3802 64.2906 22.8345C64.7449 23.2888 65.0001 23.9049 65.0001 24.5473V26.6981C65.0001 27.442 64.397 28.0451 63.6531 28.0451C62.9092 28.0451 62.3062 27.442 62.3062 26.6981V24.8189H53.6769L58.2234 30.1232C58.6558 30.6276 58.6558 31.3719 58.2234 31.8763L53.6769 37.1806H62.3062V35.3014C62.3062 34.5575 62.9092 33.9544 63.6531 33.9544C64.397 33.9544 65.0001 34.5575 65.0001 35.3014V37.4522C65.0001 38.0946 64.7449 38.7107 64.2906 39.165C63.8363 39.6193 63.2202 39.8745 62.5777 39.8745H50.7483C50.2223 39.8745 49.7444 39.5683 49.5246 39.0904C49.3048 38.6125 49.3833 38.0504 49.7257 37.651L55.4267 30.9998L49.7257 24.3485C49.3833 23.9491 49.3048 23.387 49.5246 22.9091Z" fill="#004FD6"/>
</svg>
`}}]);
