(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[5841],{67881:(G,b,e)=>{e.d(b,{G:()=>C});var n=e(93277),a=e.n(n),s=e(90865),o=e.n(s),t=e(59131),y=e.n(t),m=e(56711),E=e.n(m),c=e(98093),l=e.n(c),h=e(82944),A=e(40297),F=e.n(A),M=e(80203),g=e.n(M);function V(f,R){if(f&1&&(t.\u0275\u0275elementStart(0,"div",5),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),f&2){const x=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(x.title)}}function r(f,R){if(f&1&&(t.\u0275\u0275elementStart(0,"div",6),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),f&2){const x=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(x.description)}}class C extends h.F{set default(R){this.value=R}get default(){return this.value}constructor(R,x,D){super(R,x,D),this.controlType="crt-slide-toggle",this.useDefaultWidth=!1,this.labelPosition="before",this.toggleChange=new t.EventEmitter}valueChanged(R){this.innerValue=R.checked,this.toggleChange.emit(R)}static{this.\u0275fac=function(x){return new(x||C)(t.\u0275\u0275directiveInject(m.NgControl,10),t.\u0275\u0275directiveInject(s.AutofillMonitor),t.\u0275\u0275directiveInject(n.FocusMonitor))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:C,selectors:[["crt-slide-toggle"]],inputs:{title:"title",description:"description",useDefaultWidth:"useDefaultWidth",labelPosition:"labelPosition",default:"default"},outputs:{toggleChange:"toggleChange"},features:[t.\u0275\u0275ProvidersFeature([{provide:c.MatFormFieldControl,useExisting:C}]),t.\u0275\u0275InheritDefinitionFeature],decls:5,vars:7,consts:[["input",""],[1,"slide-wrapper",3,"change","disabled","checked","labelPosition"],[1,"slide-content"],["class","slide-title",4,"ngIf"],["class","slide-description",4,"ngIf"],[1,"slide-title"],[1,"slide-description"]],template:function(x,D){if(x&1){const B=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"mat-slide-toggle",1,0),t.\u0275\u0275listener("change",function(I){return t.\u0275\u0275restoreView(B),t.\u0275\u0275resetView(D.valueChanged(I))}),t.\u0275\u0275elementStart(2,"div",2),t.\u0275\u0275template(3,V,2,1,"div",3)(4,r,2,1,"div",4),t.\u0275\u0275elementEnd()()}x&2&&(t.\u0275\u0275classProp("slide-toggle-default-width",D.useDefaultWidth),t.\u0275\u0275property("disabled",D.disabled)("checked",D.innerValue)("labelPosition",D.labelPosition),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",D.title),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",D.description))},dependencies:[A.NgIf,M.MatLegacySlideToggle],styles:[`.slide-wrapper.slide-toggle-default-width{width:400px}.slide-wrapper.mat-slide-toggle .mat-slide-toggle-label{justify-content:space-between}.slide-wrapper.mat-slide-toggle.mat-checked .mat-slide-toggle-bar{background-color:var(--crt-palette-label-500)}.slide-wrapper.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb{background-color:#fff}.slide-wrapper.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate(16px)}.slide-wrapper.mat-slide-toggle .mat-slide-toggle-bar{height:22px;border-radius:22px}.slide-wrapper.mat-slide-toggle .mat-slide-toggle-thumb-container{margin:auto 0;top:0;bottom:0;transform:translate(0)}.slide-wrapper .slide-title{white-space:break-spaces}.slide-wrapper.cdk-keyboard-focused{outline:none;outline-offset:-1px;border-radius:2px;box-shadow:inset 0 0 0 1px #0d2e4e,inset 0 0 0 2px #fff}
`],encapsulation:2})}}},30306:(G,b,e)=>{e.d(b,{E:()=>h});var n=e(5960),a=e.n(n),s=e(3671),o=e(96677),t=e(68712),y=e(59131),m=e.n(y),E=e(58433);const c=()=>({height:"52px"}),l=()=>({height:"32px",width:"100px","margin-right":"8px"});let h=class Te extends t.K{static{this.\u0275fac=(()=>{let F;return function(g){return(F||(F=y.\u0275\u0275getInheritedFactory(Te)))(g||Te)}})()}static{this.\u0275cmp=y.\u0275\u0275defineComponent({type:Te,selectors:[["crt-base-message-composer-skeleton"]],features:[y.\u0275\u0275InheritDefinitionFeature],decls:3,vars:4,consts:[[1,"message-composer-skeleton-container"],["appearance","line","count","1",1,"message-composer-skeleton-container-body",3,"styles"],["appearance","line","count","2",1,"message-composer-skeleton-container-buttons",3,"styles"]],template:function(M,g){M&1&&(y.\u0275\u0275elementStart(0,"div",0),y.\u0275\u0275element(1,"crt-skeleton-loader",1)(2,"crt-skeleton-loader",2),y.\u0275\u0275elementEnd()),M&2&&(y.\u0275\u0275advance(),y.\u0275\u0275property("styles",y.\u0275\u0275pureFunction0(2,c)),y.\u0275\u0275advance(),y.\u0275\u0275property("styles",y.\u0275\u0275pureFunction0(3,l)))},dependencies:[E.W],styles:[".message-composer-skeleton-container-body[_ngcontent-%COMP%]{margin:5px 0}.message-composer-skeleton-container-buttons[_ngcontent-%COMP%]{justify-content:space-between;text-align:end}"]})}};h=(0,n.__decorate)([(0,s.v)({type:"crt.BaseMessageComposerSkeleton",reuseStrategy:o.B.Reuse})],h)},58551:(G,b,e)=>{e.d(b,{l:()=>U});var n=e(5960),a=e.n(n),s=e(59131),o=e.n(s),t=e(56711),y=e.n(t),m=e(10067),E=e.n(m),c=e(6530),l=e(77592),h=e(34760),A=e(3671),F=e(96677),M=e(79772),g=e.n(M),V=e(59969),r=e(95145),C=e(73270),f=e(54918),R=e(31774),x=e(2122),D=e(26594),B=e(85040),T=e(83455),I=e(48534),P=e(41314),$=e(28399),Y=e.n($),q=e(62278),re=e.n(q),ce=e(36486),d=e.n(ce),p=e(29957),_=e.n(p),u=e(86190),j=e(40297),Q=e.n(j),ie=e(62115),pe=e(52989),ue=e.n(pe),Ee=e(45093),te=e(4091),_e=e.n(te),L=e(54327),Z=e(78027),k=e(59834);const se=["crtRichTextInput"],ne=["attachUploadElement"],me=["baseMessageComposerWrap"],Me=z=>({"extendable-message-composer":z});function Ie(z,v){if(z&1&&(s.\u0275\u0275elementStart(0,"div",22),s.\u0275\u0275element(1,"img",23),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275pipe(3,"bypassSecurityTrust"),s.\u0275\u0275elementEnd()),z&2){const H=s.\u0275\u0275nextContext().$implicit,W=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275propertyInterpolate2("alt","",s.\u0275\u0275pipeBind1(2,4,"MessageComposer.AttachmentPreview"),": ",H.file.name,""),s.\u0275\u0275property("src",s.\u0275\u0275pipeBind2(3,6,W.getFilePreview(H),"resourceUrl"),s.\u0275\u0275sanitizeUrl)}}function Oe(z,v){if(z&1&&s.\u0275\u0275element(0,"mat-icon",24),z&2){const H=s.\u0275\u0275nextContext().$implicit,W=s.\u0275\u0275nextContext();s.\u0275\u0275property("svgIcon",W.getFileIcon(H.file.name))}}function ge(z,v){if(z&1){const H=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",16),s.\u0275\u0275template(1,Ie,4,9,"div",17)(2,Oe,1,1,"mat-icon",18),s.\u0275\u0275elementStart(3,"span",19),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"span",20),s.\u0275\u0275text(6),s.\u0275\u0275pipe(7,"memoryFormat"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(8,"mat-icon",21),s.\u0275\u0275pipe(9,"translate"),s.\u0275\u0275pipe(10,"translate"),s.\u0275\u0275listener("click",function(){const w=s.\u0275\u0275restoreView(H).$implicit,ee=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(ee.onRemoveAttachClick(w.id))})("keydown.enter",function(){const w=s.\u0275\u0275restoreView(H).$implicit,ee=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(ee.onRemoveAttachClick(w.id))}),s.\u0275\u0275elementEnd()()}if(z&2){const H=v.$implicit,W=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",W.canShowPreview(H)),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",!W.canShowPreview(H)),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(H.file.name),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(7,7,H.file.size||H.size)),s.\u0275\u0275advance(2),s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(9,9,"MessageComposer.RemoveAttachmentHint")),s.\u0275\u0275attribute("aria-label",s.\u0275\u0275pipeBind1(10,11,"MessageComposer.RemoveAttachmentHint"))("aria-hidden",!1)}}function X(z,v){z&1&&s.\u0275\u0275elementContainer(0)}function le(z,v){if(z&1&&(s.\u0275\u0275elementStart(0,"div"),s.\u0275\u0275template(1,X,1,0,"ng-container",11),s.\u0275\u0275elementEnd()),z&2){const H=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",H.channelSelector)}}function i(z,v){z&1&&s.\u0275\u0275elementContainer(0)}function O(z,v){if(z&1){const H=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",25),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(H);const w=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(w.onCancelClick())}),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd()}z&2&&(s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(1,2,"MessageComposer.CancelButtonHint")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(3,4,"MessageComposer.CancelButtonText")," "))}function S(z,v){if(z&1){const H=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",26),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(H);const w=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(w.onSaveDraftClick())}),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd()}z&2&&(s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(1,2,"MessageComposer.SaveDraftButtonText")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(3,4,"MessageComposer.SaveDraftButtonText")," "))}let U=class Be{set height(v){v&&(this._height=v+"px")}set dataCachingService(v){this._dataCachingService=v}get dataCachingService(){return(0,$.isEmpty)(this._dataCachingService)&&(this._dataCachingService=this._injector.get(u.$)),this._dataCachingService}constructor(v,H,W,w,ee,ae,Ce,he,fe){this._injector=v,this._fileService=H,this._fileIconService=W,this._richTextEditorUploadService=w,this._sysSettingsService=ee,this._changeDetectorRef=ae,this._messageDialogProvider=Ce,this._copilotToEditorCommunicationService=he,this._liveAnnouncementService=fe,this._publishMessageHotKeys=["ctrl+enter","command+enter"],this._publishKeyboardAction="publishMessage",this._bytesInMegabyte=1024*1024,this._setCacheDraftDataDebounce=300,this._filterExtensions="",this._disableFileSecurityMode="9801c625-fafb-4ed3-9383-c3c942a5c1e3",this._denyFileSecurityMode="60849c6e-24b4-45df-9aad-2f69d419823c",this._fileSecurityMode=this._denyFileSecurityMode,this._maxFileSize=0,this.keyboardHotkeysMap={keydown:{[this._publishKeyboardAction]:{sequence:this._publishMessageHotKeys}}},this.inputControl=new t.FormControl(null),this.attachments=[],this.disabled=!1,this.sendingButtonDisabled=!1,this.footerPanelExpanded=!1,this.selectionChange=new s.EventEmitter,this.footerPanelIndent=0,this.useTemplates=!1,this.useDrafts=!1,this.discardBtnVisible=!1,this.maxAttachmentsSize=0,this.messageChangesCancel=new s.EventEmitter,this.composerCleared=new s.EventEmitter,this.messageInputFocus=new s.EventEmitter,this.messageInputBlur=new s.EventEmitter,this.messageInputClick=new s.EventEmitter,this.messageChanged=new s.EventEmitter,this.messagePublish=new s.EventEmitter,this.selectTemplate=new s.EventEmitter,this.attachmentAdded=new s.EventEmitter,this.saveDraft=new s.EventEmitter,this.newMention=new s.EventEmitter,this._snackBar=v.get(m.MatSnackBar),this._translateService=v.get(M.TranslateService),this._featureValues=v.get(D.G);const ve="FileExtensionsDenyList",Pe="FileExtensionsAllowList";this._sysSettingsService.getByCodes(["FileSecurityMode","MaxFileSize",ve,Pe]).subscribe(De=>{if(De?.success&&(this._maxFileSize=De.values.MaxFileSize?.value||0,this._fileSecurityMode=De.values.FileSecurityMode?.value.toLowerCase()||this._denyFileSecurityMode,this._fileSecurityMode!==this._disableFileSecurityMode)){const be=this._fileSecurityMode===this._denyFileSecurityMode?ve:Pe;this._filterExtensions=De.values[be]?.value||""}})}get extendableMessageComposer(){return this._featureValues.ExtendableMessageComposer}_blurCurrentElement(){document.activeElement.blur()}_isContentTypeString(v){return v?.byteLength===void 0}_convertToBase64String(v){return this._isContentTypeString(v)?v:(0,P.M6)(v)}_cacheInputMessage(){if((0,$.isEmpty)(this.inputControl?.value))this.dataCachingService.remove(this.composerCacheCode);else try{this.dataCachingService.set(this.composerCacheCode,this.inputControl.value)}catch(v){console.error(v),this.dataCachingService.remove(this.composerCacheCode)}}_setCacheDraftData(v){if((0,$.isEmpty)(v))return;const H=this.dataCachingService.get(v)??"";if(!(0,$.isEmpty)(H)){const W=this.inputControl?.value??"";if(W.includes(H))return;this.inputControl.setValue(H+W)}}_waitScrollEnd(){return new Promise(v=>{const H=this.baseMessageComposerWrap?.nativeElement;if(!H){v(!0);return}const W=new IntersectionObserver(w=>{const[ee]=w;ee.isIntersecting&&(W?.unobserve(H),v(!0))});W.observe(H)})}_getOversizeAttachmentsErrorMessage(v){v=v.reverse();const H=this._translateService.instant("InfoDialog.FileUpload.MaxFileSizeExceededExceptionMessage"),W=`\r
\r
`,w=this._translateService.instant("InfoDialog.FileUpload.FileListHeader"),ee=H+W+w+`:\r
{1}`;let ae="";return ae+=(0,p.formatString)(ee,this._maxFileSize,v.map(Ce=>"- "+Ce).join(`\r
`)),ae+=W,ae+=this._translateService.instant("InfoDialog.FileUpload.ChangeFileSizeInfoMessage"),ae}_getExtensionAttachmentsErrorMessage(v){const H=(0,$.groupBy)(v,he=>he.name.split(".").pop().toLowerCase()),W=this._fileSecurityMode===this._denyFileSecurityMode?"InvalidExtension.Deny":"InvalidExtension.Allow",w=this._translateService.instant("InfoDialog.FileUpload."+W),ee=`\r
\r
`,ae=this._translateService.instant("InfoDialog.FileUpload.FileListHeader");let Ce="";for(const he in H)if(Object.prototype.hasOwnProperty.call(H,he)){const fe=H[he];let ve=(0,p.formatString)(w+ee+ae+`:\r
`,he);fe.forEach(Pe=>{ve+="- "+Pe.name+`\r
`}),Ce+=ve+`\r
`}return Ce}_isFileExtensionAllowed(v){if(this._fileSecurityMode===this._disableFileSecurityMode)return!0;const H=v.name.split(".").pop().toLowerCase(),W=this._filterExtensions.toLowerCase();return this._fileSecurityMode===this._denyFileSecurityMode?W.indexOf(H)===-1:W.indexOf(H)>=0}_validateAttachmentsSize(v){if(this.maxAttachmentsSize<=0)return!0;let H=0;this.attachments.forEach(w=>H+=w.size?w.size:w.file.size);for(const w in v)if(Object.prototype.hasOwnProperty.call(v,w)){const ee=v[w].size;ee&&(H+=ee)}const W=H/this._bytesInMegabyte<=this.maxAttachmentsSize;if(!W){const w=(0,p.formatString)(this._translateService.instant("MessageComposer.Email.AttachmentsSizeLimitReached"),this.maxAttachmentsSize);this._messageDialogProvider.error(w)}return W}_removeCopilotHighlighting(){this._copilotToEditorCommunicationService?.notify({editorAction:B.u.RemoveHighlighting})}showSnackbar(v){this._snackBar.openFromComponent(v,{duration:3e3,panelClass:"message-action-snackbar-container"})}onMessageInputBlur(){this._cacheInputMessage(),this.messageInputBlur.emit()}onMessageInputFocus(){this.disabled||this.messageInputFocus.emit()}onMessagePublish(){this._removeCopilotHighlighting(),this.messagePublish.emit()}focus(){this.disabled||(this.footerPanelExpanded=!0,this._waitScrollEnd().then(()=>{this.crtRichTextInput?.focus(),this.messageInputFocus.emit()}))}onInputClick(){this.disabled||(this.footerPanelExpanded=!0,this.messageInputClick.emit())}onHotKeyPressed({action:v,event:H}){v===this._publishKeyboardAction&&!this.sendingButtonDisabled&&(H.preventDefault(),this._blurCurrentElement(),this.onMessagePublish())}onCancelClick(){this._messageDialogProvider.confirmation("CanDiscardUnsavedData.Default.Message").subscribe(v=>{v&&(this.clear(),this.messageChangesCancel.emit())})}onSaveDraftClick(){this._removeCopilotHighlighting(),this.dataCachingService.remove(this.composerCacheCode),this.saveDraft.emit()}onRichTextFilesUploaded(v){const H=v.map(({file:W,fileId:w})=>(W.id=w,W));this.uploadFiles({target:{files:H}})}uploadFiles({target:v}){if(!this._validateAttachmentsSize(v.files))return;const H=[],W=[],w=Array.from(v.files).map(ae=>this._maxFileSize>0&&ae.size/this._bytesInMegabyte>=this._maxFileSize?(H.push(ae.name),(0,q.of)(!0)):this._isFileExtensionAllowed(ae)?this._fileService.read(ae).pipe((0,ce.switchMap)(fe=>(fe.id=(0,$.isEmpty)(ae.id)?(0,c.qv)():ae.id,this.attachments.some(ve=>ve.file.id===fe.id)||(this.attachments=[...this.attachments,fe]),this._changeDetectorRef.markForCheck(),(0,q.of)(!0)))):(W.push(ae),(0,q.of)(!0)));let ee="";W.length>0&&(ee+=this._getExtensionAttachmentsErrorMessage(W)),H.length>0?ee+=this._getOversizeAttachmentsErrorMessage(H):(0,$.isEmpty)(ee)||(ee=ee.slice(0,-4)),(0,$.isEmpty)(ee)||this._messageDialogProvider.error(ee),v.value="",(0,q.forkJoin)(w).subscribe(()=>{this.attachmentAdded.emit(),this._liveAnnouncementService.announce("MessageComposer.Attachment.Added"),this._changeDetectorRef.markForCheck()})}onRemoveAttachClick(v){this.attachments=this.attachments.filter(H=>H.id!==v),this.crtRichTextInput.removeReadyToUploadFile(v),this._liveAnnouncementService.announce("MessageComposer.Attachment.Removed"),this._changeDetectorRef.markForCheck()}onMessageChanged(){this.messageChanged.emit()}clear(){this.crtRichTextInput?.focus(),this.dataCachingService.remove(this.composerCacheCode),this.inputControl.setValue(""),this.crtRichTextInput?.clearSelection(),this.attachments.forEach(v=>this.crtRichTextInput.removeReadyToUploadFile(v.id)),this.attachments=[],this._blurCurrentElement(),this._changeDetectorRef.markForCheck(),this.composerCleared.emit()}getValue(){return this.inputControl.value}setValue(v){this.inputControl.setValue(v)}onSelectAttachments(){this.attachUploadElement.nativeElement.click()}canShowPreview(v){return this._featureValues.ShowAttachmentsPreview?(this._isContentTypeString(v.content)?v.content!=="":v.content.byteLength>0)&&this.getFileIcon(v.file.name).startsWith(C.k.IMAGE):!1}getFilePreview(v){return this.canShowPreview(v)?`data:${v.file.type};base64,${this._convertToBase64String(v.content)}`:""}getFileIcon(v){return this._fileIconService.getFileIcon(v,"large")}saveInlineImagesToDb(v){return this._richTextEditorUploadService.uploadImages([this.crtRichTextInput.currentEditor],v).pipe((0,ce.last)())}onSelectTemplate(){this.selectTemplate.emit()}onBeforeUnload(){this.crtRichTextInput?.isFocused&&this._cacheInputMessage()}isValueEmpty(){return(0,$.isEmpty)(this.inputControl.value)}isDiscardBtnVisible(){return this.discardBtnVisible||!this.isValueEmpty()}onNewMention(v){this.newMention.next(v)}ngOnChanges(v){const H=v.composerCacheCode?.currentValue;(0,$.debounce)(()=>this._setCacheDraftData(H),this._setCacheDraftDataDebounce)()}onSelectionChange(v){this.selectionChange.next(v)}static{this.\u0275fac=function(H){return new(H||Be)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(T.d),s.\u0275\u0275directiveInject(f.H),s.\u0275\u0275directiveInject(x.H),s.\u0275\u0275directiveInject(r.A),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(R.r),s.\u0275\u0275directiveInject(I.i),s.\u0275\u0275directiveInject(V.DW))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Be,selectors:[["crt-base-message-composer"]],viewQuery:function(H,W){if(H&1&&(s.\u0275\u0275viewQuery(se,5),s.\u0275\u0275viewQuery(ne,5),s.\u0275\u0275viewQuery(me,5)),H&2){let w;s.\u0275\u0275queryRefresh(w=s.\u0275\u0275loadQuery())&&(W.crtRichTextInput=w.first),s.\u0275\u0275queryRefresh(w=s.\u0275\u0275loadQuery())&&(W.attachUploadElement=w.first),s.\u0275\u0275queryRefresh(w=s.\u0275\u0275loadQuery())&&(W.baseMessageComposerWrap=w.first)}},hostVars:2,hostBindings:function(H,W){H&1&&s.\u0275\u0275listener("beforeunload",function(){return W.onBeforeUnload()},!1,s.\u0275\u0275resolveWindow),H&2&&s.\u0275\u0275styleProp("--height",W._height)},inputs:{disabled:"disabled",sendingButtonDisabled:"sendingButtonDisabled",footerPanelExpanded:"footerPanelExpanded",footerPanelOptions:"footerPanelOptions",channelSelector:"channelSelector",selectionActions:"selectionActions",disableSelectionOptions:"disableSelectionOptions",footerPanelIndent:"footerPanelIndent",inputPlaceHolder:"inputPlaceHolder",useTemplates:"useTemplates",useDrafts:"useDrafts",composerCacheCode:"composerCacheCode",discardBtnVisible:"discardBtnVisible",sendButtonIcon:"sendButtonIcon",maxAttachmentsSize:"maxAttachmentsSize",mentionsService:"mentionsService",height:"height",dataCachingService:"dataCachingService"},outputs:{selectionChange:"selectionChange",messageChangesCancel:"messageChangesCancel",composerCleared:"composerCleared",messageInputFocus:"messageInputFocus",messageInputBlur:"messageInputBlur",messageInputClick:"messageInputClick",messageChanged:"messageChanged",messagePublish:"messagePublish",selectTemplate:"selectTemplate",attachmentAdded:"attachmentAdded",saveDraft:"saveDraft",newMention:"newMention"},features:[s.\u0275\u0275NgOnChangesFeature],decls:20,vars:32,consts:[["baseMessageComposerWrap",""],["crtRichTextInput",""],["attachUploadElement",""],[1,"base-message-composer"],[1,"base-message-composer-input"],["labelPosition","hidden","data-qa","base-message-composer-text-input",1,"base-message-composer-input-field",3,"editorBlur","editorFocus","editorValueChanged","crtKeyboardHotkeyPressed","click","selectAttachments","selectTemplate","newMention","filesUploaded","selectionChange","crtKeyboardHotkeys","control","showClip","useTemplates","readonly","placeholder","mentionsService","useBodyFilesLinks","selectionActions","disableSelectionOptions","label"],[1,"message-composer-attachments"],["role","group","class","message-composer-attachment",4,"ngFor","ngForOf"],["data-qa","base-message-composer-footer",1,"base-message-composer-footer",3,"hidden","ngClass"],["type","file","multiple","",2,"display","none",3,"change"],[4,"ngIf"],[4,"ngTemplateOutlet"],[1,"base-message-composer-footer-actions"],["alt","discard","color","default","size","large","class","base-message-composer-footer-actions-button","data-qa","base-message-composer-cancel-btn",3,"title","clicked",4,"ngIf"],["alt","save draft","color","default","size","large","class","base-message-composer-footer-actions-button","data-qa","base-message-composer-save-draft-btn",3,"title","clicked",4,"ngIf"],["alt","send","color","accent","size","large","iconPosition","left-icon","data-qa","base-message-composer-submit-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title","icon","disabled"],["role","group",1,"message-composer-attachment"],["class","message-composer-attachment-icon",4,"ngIf"],["matSuffix","","class","message-composer-attachment-icon",3,"svgIcon",4,"ngIf"],[1,"message-composer-attachment-name"],[1,"message-composer-attachment-size"],["tabindex","0","role","button","svgIcon","message-composer-attach-cross","data-qa","message-composer-attachment-remove-icon",1,"message-composer-attachment-remove-icon",3,"click","keydown.enter","title"],[1,"message-composer-attachment-icon"],[3,"src","alt"],["matSuffix","",1,"message-composer-attachment-icon",3,"svgIcon"],["alt","discard","color","default","size","large","data-qa","base-message-composer-cancel-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title"],["alt","save draft","color","default","size","large","data-qa","base-message-composer-save-draft-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title"]],template:function(H,W){if(H&1){const w=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",3)(1,"div",4,0)(3,"crt-rich-text-editor",5,1),s.\u0275\u0275pipe(5,"translate"),s.\u0275\u0275listener("editorBlur",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onMessageInputBlur())})("editorFocus",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onMessageInputFocus())})("editorValueChanged",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onMessageChanged())})("crtKeyboardHotkeyPressed",function(ae){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onHotKeyPressed(ae))})("click",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onInputClick())})("selectAttachments",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onSelectAttachments())})("selectTemplate",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onSelectTemplate())})("newMention",function(ae){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onNewMention(ae))})("filesUploaded",function(ae){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onRichTextFilesUploaded(ae))})("selectionChange",function(ae){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onSelectionChange(ae))}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(6,"div",6),s.\u0275\u0275template(7,ge,11,13,"div",7),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(8,"div",8)(9,"input",9,2),s.\u0275\u0275listener("change",function(ae){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.uploadFiles(ae))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(11,le,2,1,"div",10)(12,i,1,0,"ng-container",11),s.\u0275\u0275elementStart(13,"div",12),s.\u0275\u0275template(14,O,4,6,"crt-button",13)(15,S,4,6,"crt-button",14),s.\u0275\u0275elementStart(16,"crt-button",15),s.\u0275\u0275pipe(17,"translate"),s.\u0275\u0275listener("clicked",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(W.onMessagePublish())}),s.\u0275\u0275text(18),s.\u0275\u0275pipe(19,"translate"),s.\u0275\u0275elementEnd()()()()}H&2&&(s.\u0275\u0275advance(3),s.\u0275\u0275property("crtKeyboardHotkeys",W.keyboardHotkeysMap)("control",W.inputControl)("showClip",!0)("useTemplates",W.useTemplates)("readonly",W.disabled)("placeholder",W.inputPlaceHolder)("mentionsService",W.mentionsService)("useBodyFilesLinks",!1)("selectionActions",W.selectionActions)("disableSelectionOptions",W.disableSelectionOptions)("label",s.\u0275\u0275pipeBind1(5,24,"MessageComposer.ComposerAreaLabel")),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngForOf",W.attachments),s.\u0275\u0275advance(),s.\u0275\u0275styleProp("margin-inline-start",W.footerPanelIndent,"px"),s.\u0275\u0275property("hidden",!W.footerPanelExpanded)("ngClass",s.\u0275\u0275pureFunction1(30,Me,W.extendableMessageComposer)),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",W.extendableMessageComposer),s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",W.footerPanelOptions),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",W.isDiscardBtnVisible()),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",W.useDrafts&&!W.isValueEmpty()),s.\u0275\u0275advance(),s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(17,26,"MessageComposer.SendButtonHint")),s.\u0275\u0275property("icon",W.sendButtonIcon)("disabled",W.sendingButtonDisabled),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(19,28,"MessageComposer.SendButtonText")," "))},dependencies:[j.NgClass,j.NgForOf,j.NgIf,j.NgTemplateOutlet,ie.B,pe.MatIcon,Ee.R,te.MatLegacySuffix,L.h,Z.v,k.l,M.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.base-message-composer{position:relative}.base-message-composer-footer{margin-top:7px;display:flex;justify-content:flex-end;align-items:center}.base-message-composer-footer.extendable-message-composer{justify-content:space-between}.base-message-composer-footer[hidden]{display:none;height:0px}.base-message-composer-footer-actions{display:flex}.base-message-composer-footer-actions .base-message-composer-footer-actions-button .crt-button.button-size-large{border-radius:4px;margin-inline-start:8px}.base-message-composer-input{display:flex}.base-message-composer-input-field{width:100%;margin-inline-start:0}.base-message-composer-input-field .crt-input,.base-message-composer-input-field .crt-input-control{padding-inline-end:0!important}.base-message-composer-input-field .rich-editor-wrapper{min-height:48px;border:1px solid var(--crt-palette-border-500);border-radius:8px}.base-message-composer-input-field .rich-editor-wrapper:hover,.base-message-composer-input-field .rich-editor-wrapper:focus-within{border:1px solid var(--crt-palette-primary-500)}.base-message-composer-input-field .rich-editor-wrapper [data-cke-editorplaceholder]:before{max-width:calc(100% - 44px)}.base-message-composer-input-field .rich-editor-wrapper .cke_editable{line-height:20px;padding-inline-start:16px;padding-top:16px;padding-bottom:16px;width:calc(100% - 22px);height:var(--height, unset)}.base-message-composer .message-composer-attachments{display:flex;flex-wrap:wrap;font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased}.base-message-composer .message-composer-attachments .message-composer-attachment{display:flex;max-width:100%;margin-inline-end:30px;margin-top:10px}.base-message-composer .message-composer-attachments .message-composer-attachment-icon{width:24px;min-width:24px;height:17px;margin-inline-end:10px;border:1px solid var(--crt-palette-label-100);border-radius:4px}.base-message-composer .message-composer-attachments .message-composer-attachment-icon img{object-fit:contain;height:100%;width:100%}.base-message-composer .message-composer-attachments .message-composer-attachment-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-inline-end:10px}.base-message-composer .message-composer-attachments .message-composer-attachment-size{color:var(--crt-palette-label-500);margin-inline-end:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon{width:16px;min-width:8px;height:16px;cursor:pointer;color:var(--crt-palette-label-500)}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon svg{height:8px}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}.base-message-composer .base-message-composer-input .base-message-composer-input-field .rich-editor-wrapper div.icons{padding-inline-end:5px;position:absolute;right:0;background:var(--crt-palette-background-50);border-top-left-radius:12px;padding-top:2px}[dir=rtl] .base-message-composer .base-message-composer-input .base-message-composer-input-field .rich-editor-wrapper div.icons{left:0;border-top-right-radius:12px;border-top-left-radius:initial;right:auto}
`],encapsulation:2})}};(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"disabled",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"sendingButtonDisabled",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"footerPanelExpanded",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],U.prototype,"footerPanelOptions",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],U.prototype,"channelSelector",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],U.prototype,"selectionActions",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"selectionChange",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Boolean)],U.prototype,"disableSelectionOptions",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"footerPanelIndent",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",String)],U.prototype,"inputPlaceHolder",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"useTemplates",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"useDrafts",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",String)],U.prototype,"composerCacheCode",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"discardBtnVisible",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",String)],U.prototype,"sendButtonIcon",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"maxAttachmentsSize",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"messageChangesCancel",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"composerCleared",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"messageInputFocus",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"messageInputBlur",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"messageInputClick",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"messageChanged",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"messagePublish",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"selectTemplate",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"attachmentAdded",void 0),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"saveDraft",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],U.prototype,"mentionsService",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],U.prototype,"height",null),(0,n.__decorate)([(0,h.j)(),(0,n.__metadata)("design:type",Object)],U.prototype,"newMention",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",u.$),(0,n.__metadata)("design:paramtypes",[u.$])],U.prototype,"dataCachingService",null),U=(0,n.__decorate)([(0,A.v)({type:"crt.BaseMessageComposer",reuseStrategy:F.B.Reuse}),(0,n.__metadata)("design:paramtypes",[s.Injector,T.d,f.H,x.H,r.A,s.ChangeDetectorRef,R.r,I.i,V.DW])],U)},52808:(G,b,e)=>{e.d(b,{B:()=>g});var n=e(5960),a=e.n(n),s=e(59131),o=e.n(s),t=e(77592),y=e(34760),m=e(3671),E=e(68712),c=e(40297),l=e.n(c),h=e(62115);const A=V=>({"selected-composer":V});function F(V,r){if(V&1){const C=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"crt-button",2),s.\u0275\u0275listener("clicked",function(){const R=s.\u0275\u0275restoreView(C).$implicit,x=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(x.showComposer(R))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(V&2){const C=r.$implicit,f=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(3,A,f.isComposerSelected(C)))("icon",f.getComposerIcon(C))("caption",f.getComposerCaption(C))}}function M(V,r){if(V&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,F,2,5,"ng-container",1),s.\u0275\u0275elementContainerEnd()),V&2){const C=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",C.visibleChannels)}}let g=class Ae extends E.K{constructor(){super(...arguments),this._iconsMap={Email:"email-composer-icon",Feed:"feed-composer-icon"},this.selectedChannelIndexChange=new s.EventEmitter}get isVisible(){return this.visibleChannels?.length>1}get visibleChannels(){return this.channels?.filter(r=>r.visible!==!1)}set selectedChannelIndex(r){this._selectedChannelIndex=r,this.changeDetectorRef.markForCheck()}showComposer(r){this.selectedChannelIndex=this.channels.indexOf(r),this.selectedChannelIndexChange.emit(this._selectedChannelIndex)}getComposerIcon(r){const C=r.data;return C?.icon?C?.icon:this._iconsMap[C?.schemaType]||"send-icon"}getComposerCaption(r){return r.data?.caption||""}isComposerSelected(r){return this.channels.indexOf(r)===this._selectedChannelIndex}static{this.\u0275fac=(()=>{let r;return function(f){return(r||(r=s.\u0275\u0275getInheritedFactory(Ae)))(f||Ae)}})()}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ae,selectors:[["crt-channel-selector"]],inputs:{channels:"channels",selectedChannelIndex:"selectedChannelIndex"},outputs:{selectedChannelIndexChange:"selectedChannelIndexChange"},features:[s.\u0275\u0275ProvidersFeature([]),s.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],["size","large","iconPosition","only-icon",1,"select-composer-button",3,"clicked","ngClass","icon","caption"]],template:function(C,f){C&1&&s.\u0275\u0275template(0,M,2,1,"ng-container",0),C&2&&s.\u0275\u0275property("ngIf",f.isVisible)},dependencies:[c.NgClass,c.NgForOf,c.NgIf,h.B],styles:[`.select-composer-button{margin-inline-end:4px;border-radius:8px}.select-composer-button button:hover{border-radius:8px}.select-composer-button.selected-composer{background-color:var(--crt-button-default-hover-color)}.select-composer-button.selected-composer button{color:var(--crt-palette-primary-500)!important}
`],encapsulation:2})}};(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",Array)],g.prototype,"channels",void 0),(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],g.prototype,"selectedChannelIndex",null),(0,n.__decorate)([(0,y.j)(),(0,n.__metadata)("design:type",Object)],g.prototype,"selectedChannelIndexChange",void 0),g=(0,n.__decorate)([(0,m.v)({type:"crt.ChannelSelector"})],g)},44395:(G,b,e)=>{e.d(b,{Z:()=>A});var n=e(73308),a=e(5960),s=e(59131),o=e(34760),t=e(77592),y=e(95145),m=e(68712);const E="OptimizeComponentsAccessibilityBehavior";var c=e(62278),l=e(58909);const h=["baseComposer"];class A extends m.K{constructor(M){super(M),this.injector=M,this.isAnimationDisabled=!1,this.footerPanelExpanded=!1,this.maxAttachmentsSize=0,this.composerEventChange=new s.EventEmitter,this.selectionChange=new s.EventEmitter,this._elementRef=M.get(s.ElementRef),this._sysSettingsService=M.get(y.A),this._initOptimizeComponentsAccessibilityBehavior()}_initOptimizeComponentsAccessibilityBehavior(){var M=this;return(0,n.A)(function*(){M.isAnimationDisabled=yield(0,c.lastValueFrom)(M._sysSettingsService.getValueByCode(E,M.isAnimationDisabled)),M.isAnimationDisabled&&(M.footerPanelExpanded=!0)})()}publishInputFocusEvent(){this.composerEventChange.emit([{name:l.An,params:{isFocused:this.footerPanelExpanded}}]),this.baseComposer&&(this.baseComposer.maxAttachmentsSize=this.maxAttachmentsSize)}onMessageInputFocus(){this.footerPanelExpanded=!0,this.publishInputFocusEvent()}onMessageInputBlur(){this.baseComposer?.getValue()||(this.isAnimationDisabled||(this.footerPanelExpanded=!1),this.publishInputFocusEvent())}onMessageInputClick(){this.baseComposer?.getValue()||(this.footerPanelExpanded=!0,this.publishInputFocusEvent())}sendComponentReadyEvent(M){this.composerEventChange.emit([{name:l.iQ,params:{composerSchemaType:M}}])}get element(){return this.elementRef?.nativeElement}onSelectionChange(M){this.selectionChange.next(M)}static{this.\u0275fac=function(g){return new(g||A)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:A,viewQuery:function(g,V){if(g&1&&s.\u0275\u0275viewQuery(h,5),g&2){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(V.baseComposer=r.first)}},inputs:{maxAttachmentsSize:"maxAttachmentsSize",selection:"selection",disableSelectionOptions:"disableSelectionOptions"},outputs:{composerEventChange:"composerEventChange",selectionChange:"selectionChange"},features:[s.\u0275\u0275InheritDefinitionFeature]})}}(0,a.__decorate)([(0,o.j)(),(0,a.__metadata)("design:type",Object)],A.prototype,"composerEventChange",void 0),(0,a.__decorate)([(0,t.k)(),(0,a.__metadata)("design:type",String)],A.prototype,"selection",void 0),(0,a.__decorate)([(0,o.j)(),(0,a.__metadata)("design:type",Object)],A.prototype,"selectionChange",void 0),(0,a.__decorate)([(0,t.k)(),(0,a.__metadata)("design:type",Boolean)],A.prototype,"disableSelectionOptions",void 0)},30816:(G,b,e)=>{e.d(b,{n:()=>X,P:()=>ge});var n=e(73308),a=e(5960),s=e(95567),o=e(40297),t=e(59131),y=e(56711),m=e(91775),E=e(6530),c=e(77592),l=e(34760),h=e(3671),A=e(96677),F=e(52793),M=e(10098),g=e(79772),V=e(88033),r=e(6503),C=e(95145),f=e(31774),R;(function(le){le.DefaultMailbox="crt.DefaultSenderComposerRequest",le.CaseMailbox="crt.CaseSenderComposerRequest"})(R||(R={}));var x=e(29423),D=e(23092),B=e(28399),T=e(62278),I=e(29957),P=e(16296),$=e(58909),Y=e(46690),q=e(85688),re=e(55529),ce=e(59784),d=e(2023),p=e(44395),_=e(62115),u=e(58433),j=e(66803),Q=e(19344),ie=e(2126),pe=e(58551),ue=e(30306);const Ee=["toRecipientSearch"],te=["ccRecipientSearch"],_e=["bccRecipientSearch"],L=[[["","slot","channelspanel"]],[["","slot","selectionactions"]]],Z=["[slot='channelsPanel']","[slot='selectionActions']"],k=le=>({display:le}),se=()=>({height:"12px",width:"80%","margin-bottom":"5px","margin-top":"5px"});function ne(le,i){if(le&1&&(t.\u0275\u0275element(0,"crt-button",28),t.\u0275\u0275pipe(1,"translate")),le&2){const O=t.\u0275\u0275nextContext();t.\u0275\u0275propertyInterpolate("title",t.\u0275\u0275pipeBind1(1,3,"MessageComposer.Email.ChangeReplyAction")),t.\u0275\u0275property("icon",O.getReplyActionIcon())("menuItems",O.itemActionItems)}}function me(le,i){if(le&1){const O=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",29),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(O);const U=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(U.toggleVisibleCc())}),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}le&2&&(t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,2,"MessageComposer.Email.CC")),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,4,"MessageComposer.Email.CcToggleCaption")," "))}function Me(le,i){if(le&1){const O=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",30),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(O);const U=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(U.toggleVisibleBcc())}),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}le&2&&(t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,2,"MessageComposer.Email.BCC")),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,4,"MessageComposer.Email.BccToggleCaption")," "))}function Ie(le,i){le&1&&t.\u0275\u0275projection(0)}function Oe(le,i){le&1&&t.\u0275\u0275projection(0,1)}class ge{}let X=class Le extends p.Z{get activityId(){return this._activityId}get replyAction(){return this._replyAction}set replyAction(i){this._replyAction=i,this._updateLabelsWidth()}set from(i){if(this._from=i,this._skeletonLoading){this._defaultFrom=this._from;return}this._setFrom(this._from)}get from(){return this._from}set sendersMailboxes(i){i&&(this._sendersMailboxes=i,this.fromLookupValues=this._getFromLookupValues(this._sendersMailboxes),i.length>0&&this._updateAddressFields(i),this._mailboxSendersSet.next(this.maxAttachmentsSize))}get sendersMailboxes(){return this._sendersMailboxes}set to(i){i!=null&&this.toInputControl?.setRecipients(i)}get to(){return this._to}set cc(i){i!=null&&this.ccInputControl?.setRecipients(i)}get cc(){return this._cc}set bcc(i){i!=null&&this.bccInputControl?.setRecipients(i)}get bcc(){return this._bcc}set body(i){i!=null&&this.baseComposer.setValue(i)}get body(){return this._body}set recipientsMailboxes(i){i?.recipients&&(this.toInputControl.rawRecipinets=i.recipients,this.ccInputControl.rawRecipinets=i.recipients,this.bccInputControl.rawRecipinets=i.recipients)}set emailId(i){this._debounceSetReplyAction(i)}set skeletonLoading(i){this._skeletonLoading=i}get skeletonLoading(){return this._skeletonLoading||this.loading}get cacheCode(){if((0,B.isEmpty)(this._userId)||!(0,B.isEmpty)(this.entitySchemaName)&&(0,B.isEmpty)(this.recordId)||this._replyAction===P.T.EditDraft)return"";let i=`email_composer_cache_data_${this._userId}_`;return!(0,B.isEmpty)(this.entitySchemaName)&&!(0,B.isEmpty)(this.recordId)&&(i+=`${this.entitySchemaName}_${this.recordId}`),i}set headerLabelsWidth(i){i&&(this._headerLabelsWidth=this.getReplyButtonVisible()?this._defaultHeaderLabelsWidth:i,this._headerLabelsWidthString=this._headerLabelsWidth+"px")}get headerLabelsWidth(){return this._headerLabelsWidth}set expandOnLoad(i){i&&this.onMessageInputFocus()}set composerEvent(i){i?.forEach(O=>{switch(O?.name){case $.M7:this._handleReplyAction(O.params?.emailId,O.params?.action);break;case $.J3:this._emailSaved(O.params.response);break}})}constructor(i,O){super(i),this._document=O,this._defaultAttachmentsSizeLimit=50,this._emailSchemaName="Activity",this._iconsMap={reply:"reply-message","reply-all":"reply-all-message",forward:"forward-message"},this._defaultHeaderLabelsWidth=136,this._debounceTime=500,this._skeletonLoading=!1,this._defaultFrom="",this._subscriptions=[],this._headers=[],this._postponeSignature=!1,this._mailboxSendersSet=new T.Subject,this._debounceSetSignature=(0,B.debounce)(this._setSignature,this._debounceTime),this._debounceSetReplyAction=(0,B.debounce)(S=>this._setReplyAction(S),this._debounceTime),this.fromInputControl=new y.FormControl(null),this.itemActionItems=[],this.subjectInputControl=new y.FormControl(null),this._defaultHeaderLabelsWidthString="136px",this.subjectChange=new t.EventEmitter,this.fromChange=new t.EventEmitter,this.toChange=new t.EventEmitter,this.ccChange=new t.EventEmitter,this.bccChange=new t.EventEmitter,this.bodyChange=new t.EventEmitter,this.isReplyExpanded=!1,this.visibleCc=!1,this.visibleCcChange=new t.EventEmitter,this.visibleBcc=!1,this.visibleBccChange=new t.EventEmitter,this.headerExpanded=!1,this.headerExpandedChange=new t.EventEmitter,this.emailComposerCleared=new t.EventEmitter,this.emailComposerSaved=new t.EventEmitter,this.refreshRecipients=new t.EventEmitter,this._isDesignTime=i.get(x.w,!1),this._sendEmailService=i.get(Y.y),this._maskService=i.get(V.s),this._messageDialogProvider=i.get(f.r),this._translateService=i.get(g.TranslateService),this._sysSettingsService=i.get(C.A),this._emailsService=i.get(q.d),this._emailTemplatesService=i.get(re.B),this._emailSignatureService=i.get(ce.S),this.emailComposerCachingService=i.get(d.v),this.notifyService=i.get(r.F),this._userInfo=i.get(D.oq),!this._isDesignTime&&(this._userId=this._userInfo.id,this._init(),this._initItemActionItems())}_initItemActionItems(){this.itemActionItems=[{caption:this._translateService.instant("MessageComposer.Email.Reply"),type:"crt.MenuItem",name:"Reply",icon:"reply-message",handleItemClick:()=>this.changeReplyAction(P.T.Reply)},{caption:this._translateService.instant("MessageComposer.Email.ReplyAll"),type:"crt.MenuItem",name:"ReplyAll",icon:"reply-all-message",handleItemClick:()=>this.changeReplyAction(P.T.ReplyAll)},{caption:this._translateService.instant("MessageComposer.Email.Forward"),type:"crt.MenuItem",name:"Forward",icon:"forward-message",handleItemClick:()=>this.changeReplyAction(P.T.Forward)}]}_init(){this._skeletonLoading=!0,this._subscribeToEvents(),this._subscriptions.push((0,T.of)(this._sysSettingsService.getValueByCode("MaxAttachmentsSize",this._defaultAttachmentsSizeLimit),this._mailboxSendersSet).pipe((0,T.concatAll)()).subscribe(i=>{this.maxAttachmentsSize=i,this._skeletonLoading=!1,this.changeDetectorRef.markForCheck(),this._requestDefaultSender().then(()=>this._setDefaultFrom())}))}_requestDefaultSender(){if((0,B.isEmpty)(this.defaultSenderRequest))return new Promise(O=>O());const i={type:this.defaultSenderRequest,...this._getDefaultSenderRequestParams()};return m.t.instance.process(i).then(O=>this._defaultFrom=O).then()}_getDefaultSenderRequestParams(){return{recordId:this.defaultSenderRequest===R.DefaultMailbox?this._userId:this.recordId}}_setDefaultFrom(){!(0,B.isEmpty)(this._defaultFrom)&&(0,B.isEmpty)(this.from)&&this._setFrom(this._defaultFrom)}_setFrom(i){if((0,B.isEmpty)(i))this.fromInputControl?.setValue("");else{i=i.toLowerCase();let O=this.fromLookupValues?.find(S=>S.displayValue.toLowerCase().trim()===i.trim());(0,B.isEmpty)(O)&&(O=this.fromLookupValues?.find(S=>S.displayValue.toLowerCase().includes(i))),O?(this.fromInputControl?.setValue(O),this._debounceSetSignature()):this.fromInputControl?.setValue("")}}_subscribeToEvents(){this._subscriptions.push(this.fromInputControl.valueChanges.pipe((0,T.startWith)(null),(0,T.pairwise)()).subscribe(([i,O])=>{(i??"")!==(O??"")&&this.fromChange.emit(O?.displayValue)})),this._subscriptions.push(this.subjectInputControl.valueChanges.pipe((0,T.startWith)(null),(0,T.pairwise)()).subscribe(([i,O])=>{i!==O&&this.subjectChange.emit(O)}))}_emailSaved(i){i.activityId===this._activityId&&(this._isDraftSaving?this._processDraftSaved(i):this._processEmailSaving(i).pipe((0,T.concatMap)(O=>this._processSendingResult(O))).subscribe())}_processDraftSaved(i){i.success?(this.notifyService.show({message:"MessageComposer.Email.DraftSaved"}),this._updateNextSteps(),this.onMessageCancel()):this._showErrorMessage(this._translateService.instant("MessageComposer.Email.SaveDraftError")),this._maskService.hideBodyMask()}_processEmailSaving(i){return i.success?this._sendEmailService.sendEmail(this._activityId):(0,T.of)(i)}_unsubscribeFromEvents(){this._subscriptions.forEach(i=>i?.unsubscribe())}_setReplyAction(i){!(0,B.isEmpty)(i)&&i!==E.To&&(this._replyAction=P.T.EditDraft,this._postponeSignature=!0,this._handleReplyAction(i,P.T.EditDraft))}_setSignature(){if(this._postponeSignature)return;const i=this.fromInputControl.value,O=this.baseComposer?.getValue();if((0,B.isEmpty)(i)&&(0,B.isEmpty)(O))return;const U=this.sendersMailboxes?.find(v=>v.id===i?.value),z=U?.useSignature?U?.signature:I.String.empty;this._subscriptions.push(this._emailSignatureService.updateSignatureInBody(O,z).subscribe(v=>this.baseComposer?.setValue(v)))}_handleReplyAction(i,O){if(!(!(0,B.isEmpty)(i)&&this._inReplyTo?.id===i&&this.replyAction===O)){if((0,B.isEmpty)(i)){this._clearFields(),window.requestAnimationFrame(()=>{this.baseComposer?.focus()});return}this._subscriptions.push(this._emailsService.getEmail(i,[P.T.Forward,P.T.EditDraft].includes(O)).pipe((0,T.concatMap)(S=>(this._inReplyTo=O===P.T.EditDraft?null:S,this.replyAction=O,O===P.T.EditDraft?(0,T.of)({...S,bodyShort:S.body}):this._emailsService.getReplyDraft(S,O)))).subscribe(S=>{O!==P.T.EditDraft?(this._inReplyTo.body=S.body,this._inReplyTo.bodyShort=S.bodyShort,this._activityId=null):this._activityId=S.id,this.isReplyExpanded=!1,this._postponeSignature=!1,this._fillForm(S,!0)}))}}_removeSenderFromRecipients(i){this.replyAction!==P.T.ReplyAll||!this.fromLookupValues||this.fromLookupValues.length>1||(i.to=this._filterSenderFromRecipients(i.to),i.cc=this._filterSenderFromRecipients(i.cc))}_filterSenderFromRecipients(i){const O=this.fromLookupValues[0];if(!(!O||!i||(0,B.isEmpty)(O.displayValue)))return i.filter(S=>!S.includes(O.displayValue)&&!O.displayValue.includes(S))}_updateAddressFields(i){const O=i.length===1?i[0].senderEmailAddress:this._from;!(0,B.isEmpty)(O)&&!this.fromInputControl?.value&&this._setFrom(O),this.fromLookupValues.length===1&&(this.toInputControl.setRecipients(this._filterSenderFromRecipients(this.toInputControl.getRecipients())),this.ccInputControl.setRecipients(this._filterSenderFromRecipients(this.ccInputControl.getRecipients())))}_fillForm(i,O=!1){this._removeSenderFromRecipients(i),this.toInputControl.setRecipients(i.to),this.ccInputControl.setRecipients(i.cc),this.bccInputControl.setRecipients(i.bcc),this.setVisibleCc(i.cc?.length>0),this.setVisibleBcc(i.bcc?.length>0),this._headers=i.headers,this.subjectInputControl.setValue(i.subject);const S=this.baseComposer.getValue();if(!S||O){const z=!(0,B.isEmpty)(S)&&(0,B.isEmpty)(this._activityId)?this._emailsService.getDraftUserContent(S,!0):i.bodyShort;this.baseComposer.setValue(z)}this.replyAction===P.T.EditDraft?this.from=i.from:(this.from="",this._requestDefaultSender().then(()=>this._setDefaultFrom()));let U=[];O||(U=this.baseComposer.attachments.filter(z=>z.content.byteLength===void 0?z.content!=="":z.content.byteLength>0)),this.baseComposer.attachments=[...U,...i.attachments],this.baseComposer?.focus()}_getFromLookupValues(i){return i?.map(O=>({value:O.id,displayValue:O.senderDisplayValue?`${O.senderDisplayValue} <${O.senderEmailAddress}>`:O.senderEmailAddress}))}_getEmail(){const i=this.baseComposer.attachments;let O=!1;return this._activityId?O=!0:this._activityId=(0,E.qv)(),this.baseComposer.saveInlineImagesToDb({schemaName:this._emailSchemaName,recordId:this._activityId,fileSchemaName:""}).pipe((0,T.map)(()=>({id:this._activityId,from:this.fromInputControl?.value?.displayValue,to:this.toInputControl.getRecipients(),cc:this.ccInputControl.getRecipients(),bcc:this.bccInputControl.getRecipients(),subject:this.subjectInputControl?.value,body:this.baseComposer?.getValue(),isDraft:O,headers:(0,B.cloneDeep)(this._headers),attachments:i?.map(S=>({...S,recordId:this._activityId,fileEntitySchemaName:"ActivityFile",recordEntitySchemaName:this._emailSchemaName,recordColumnName:"Activity"}))})))}_validate(){const i=new Array;return this.fromInputControl.value||i.push(this._translateService.instant("MessageComposer.Email.FromValidationErrorMessage")),!this.toInputControl.validate()&&!this.ccInputControl.validate()&&!this.bccInputControl.validate()&&i.push(this._translateService.instant("MessageComposer.Email.ToValidationErrorMessage")),this.subjectInputControl.value||i.push(this._translateService.instant("MessageComposer.Email.SubjectValidationErrorMessage")),i.length>0?(this._showErrorMessage(i.join(`\r
\r
`)),!1):!0}_showErrorMessage(i){this._messageDialogProvider.error(i)}_onTemplateSelected(i){var O=this;return(0,n.A)(function*(){if(i&&!i.canceled){const U=(yield i?.getLookupValues())[0]?.value;if((0,B.isEmpty)(U))return;O._maskService.showBodyMask(),O._emailTemplatesService.getMultiLanguageTemplate(U,O.entitySchemaName,O.recordId).subscribe({next:z=>O._insertTemplate(z?.subjectTemplate,z?.textTemplate),error:z=>O._onErrorProcessedTemplate(z)})}})()}_onErrorProcessedTemplate(i=null){this._maskService.hideBodyMask(),i&&console.error(i),this._showErrorMessage("MessageComposer.Email.TemplateInsertError")}_insertTemplate(i,O){const S=this.baseComposer?.getValue();(0,B.isEmpty)(S)||(O+=S),this.baseComposer?.setValue(O),(0,B.isEmpty)(this.subjectInputControl?.value)&&this.subjectInputControl?.setValue(i),this._maskService.hideBodyMask(),this.baseComposer?.focus()}_saveEmail(i){this._inReplyTo&&!this.isReplyExpanded&&(i.body=this._emailsService.getSafeUserContentReplyBody(i.body,this._inReplyTo.body));const O={inReplyToId:this._inReplyTo?.id,masterRecordId:this.recordId,masterSchemaName:this.entitySchemaName,defaultValues:new Array,bindingColumns:new Array};this.bindingColumns&&this.bindingColumns.forEach(U=>{O.bindingColumns.push({activityColumnName:U.activityColumnName,formAttributeName:U.formAttributeName})});const S={email:i,params:O};return this.emailComposerSaved.emit(S),(0,T.of)()}_processSendingResult(i){if(i.success)this.notifyService.show({message:"MessageComposer.Email.EmailSent"}),this._updateNextSteps(),this.onMessageCancel();else{const O=this._translateService.instant("MessageComposer.Email.PublishError");this._showErrorMessage(I.String.format(O,i.errorInfo.message))}return this._maskService.hideBodyMask(),(0,T.of)(!0)}_updateNextSteps(){const i={type:"crt.ChangeNextStepsStateRequest",$context:null};m.t.instance.process(i)}_clearFields(){this._activityId=null,this.baseComposer?.clear(),this.fromInputControl?.setValue(""),this.toInputControl?.clear(),this.ccInputControl?.clear(),this.bccInputControl?.clear(),this.subjectInputControl?.setValue(""),this.replyAction=null,this._inReplyTo=null}_updateLabelsWidth(){this.getReplyButtonVisible()&&((!this.toInputControl||!this.ccInputControl||!this.bccInputControl)&&this.changeDetectorRef.detectChanges(),this.headerLabelsWidth=this._defaultHeaderLabelsWidth,this.toInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth,this.ccInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth,this.bccInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth)}getReplyButtonVisible(){return this.replyAction&&this.replyAction!==P.T.EditDraft}saveDraft(){this.subjectInputControl.value||this.subjectInputControl.setValue(this._translateService.instant("MessageComposer.Email.Draft").toUpperCase()),this._isDraftSaving=!0,this._maskService.showBodyMask(),this._subscriptions.push(this._getEmail().pipe((0,T.concatMap)(i=>this._saveEmail(i))).subscribe())}onSelectTemplate(){const i=this._emailTemplatesService.getTemplatesLookupConfig(this.entitySchemaName);i.afterClosed=O=>this._onTemplateSelected(O),m.t.instance.process(i)}onMessagePublish(){this._validate()&&(this._isDraftSaving=!1,this._maskService.showBodyMask(),this._subscriptions.push(this._getEmail().pipe((0,T.concatMap)(i=>this._saveEmail(i))).subscribe()))}onMessageChanged(){const i=this._document.getElementsByClassName("email-composer-reply-expander");i.length>0&&i[i.length-1].addEventListener("click",this.toggleReplyBody.bind(this)),this.bodyChange.emit(this.baseComposer.getValue())}setHeaderExpanded(i){this.headerExpanded=i,this.headerExpandedChange.emit(this.headerExpanded)}setVisibleCc(i){this.visibleCc=i,this.visibleCcChange.emit(this.visibleCc)}setVisibleBcc(i){this.visibleBcc=i,this.visibleBccChange.emit(this.visibleBcc)}onMessageCancel(){this._clearFields(),this.setHeaderExpanded(!!this.isAnimationDisabled),this.setVisibleCc(!1),this.setVisibleBcc(!1)}onMessageInputFocus(){this.footerPanelExpanded=!0,this.publishInputFocusEvent(),this.setHeaderExpanded(!0)}onMessageInputBlur(){this.headerExpanded||(this.footerPanelExpanded=!1,this.publishInputFocusEvent())}onMessageInputClick(){this.headerExpanded||(this.footerPanelExpanded=!0,super.onMessageInputClick())}toggleVisibleCc(){this.setVisibleCc(!this.visibleCc)}toggleVisibleBcc(){this.setVisibleBcc(!this.visibleBcc)}getReplyActionIcon(){return this._iconsMap[this.replyAction]}changeReplyAction(i){if(i===this.replyAction)return;this.replyAction=i;let O=(0,T.of)(this._inReplyTo);i===P.T.Forward&&this._inReplyTo.attachments?.length===0&&(O=this._emailsService.getAttachments(this._inReplyTo.id).pipe((0,T.switchMap)(S=>(this._inReplyTo.attachments=S,(0,T.of)(this._inReplyTo))))),this._subscriptions.push(O.pipe((0,T.concatMap)(S=>this._emailsService.getReplyDraft(S,i))).subscribe(S=>{this._fillForm(S)}))}toggleReplyBody(){const i=this.baseComposer.getValue();this._inReplyTo.body=this._emailsService.getSafeUserContentReplyBody(i,this._inReplyTo.body),this.baseComposer.setValue(this._inReplyTo.body),this.isReplyExpanded=!0}onFromFocus(){this.setHeaderExpanded(!0)}ngOnDestroy(){this._unsubscribeFromEvents(),this._clearFields()}ngAfterViewInit(){this.sendComponentReadyEvent("Email")}loadRecipients({query:i,recipientsLength:O}){this.refreshRecipients.next({query:i,recipientsLength:O})}toChanged(i){this.toChange.next(i)}ccChanged(i){this.ccChange.next(i)}bccChanged(i){this.bccChange.next(i)}static{this.\u0275fac=function(O){return new(O||Le)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(o.DOCUMENT))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:Le,selectors:[["crt-email-composer"]],viewQuery:function(O,S){if(O&1&&(t.\u0275\u0275viewQuery(Ee,5),t.\u0275\u0275viewQuery(te,5),t.\u0275\u0275viewQuery(_e,5)),O&2){let U;t.\u0275\u0275queryRefresh(U=t.\u0275\u0275loadQuery())&&(S.toInputControl=U.first),t.\u0275\u0275queryRefresh(U=t.\u0275\u0275loadQuery())&&(S.ccInputControl=U.first),t.\u0275\u0275queryRefresh(U=t.\u0275\u0275loadQuery())&&(S.bccInputControl=U.first)}},hostVars:4,hostBindings:function(O,S){O&2&&t.\u0275\u0275styleProp("--defaultHeaderLabelsWidthString",S._defaultHeaderLabelsWidthString)("--headerLabelsWidthString",S._headerLabelsWidthString)},inputs:{subject:"subject",from:"from",sendersMailboxes:"sendersMailboxes",to:"to",cc:"cc",bcc:"bcc",body:"body",recipientsMailboxes:"recipientsMailboxes",emailId:"emailId",skeletonLoading:"skeletonLoading",height:"height",defaultSenderRequest:"defaultSenderRequest",bindingColumns:"bindingColumns",recordId:"recordId",entitySchemaName:"entitySchemaName",isReplyExpanded:"isReplyExpanded",visibleCc:"visibleCc",visibleBcc:"visibleBcc",headerExpanded:"headerExpanded",headerLabelsWidth:"headerLabelsWidth",expandOnLoad:"expandOnLoad",composerEvent:"composerEvent"},outputs:{subjectChange:"subjectChange",fromChange:"fromChange",toChange:"toChange",ccChange:"ccChange",bccChange:"bccChange",bodyChange:"bodyChange",visibleCcChange:"visibleCcChange",visibleBccChange:"visibleBccChange",headerExpandedChange:"headerExpandedChange",emailComposerCleared:"emailComposerCleared",emailComposerSaved:"emailComposerSaved",refreshRecipients:"refreshRecipients"},features:[t.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:Z,decls:37,vars:59,consts:[["toRecipientSearch",""],["ccRecipientSearch",""],["bccRecipientSearch",""],["baseComposer",""],["channelSelector",""],["selectionActions",""],[1,"email-composer",3,"ngStyle"],[1,"email-composer-header"],[1,"email-composer-header-actions"],["class","email-composer-header-actions-button","size","large","clickMode","menu","data-qa","change-reply-action",3,"title","icon","menuItems",4,"ngIf"],[1,"email-composer-header-properties"],[1,"email-composer-header-properties-main"],[1,"email-composer-header-properties-main-from-field"],["data-qa","email-composer-from",1,"without-padding-top",3,"focusin","control","items","value","useStaticFiltering","label","labelPosition","appearance"],[1,"email-composer-header-properties-main-controls"],["displayType","text","data-qa","cc-button","class","email-composer-header-properties-main-controls-togglebtn",3,"title","clicked",4,"ngIf"],["displayType","text","data-qa","bcc-button","class","email-composer-header-properties-main-controls-togglebtn",3,"title","clicked",4,"ngIf"],[1,"email-composer-header-properties-collapsible"],["data-qa","email-composer-to",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-cc"],["data-qa","email-composer-cc",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-bcc"],["data-qa","email-composer-bcc",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-subject"],["data-qa","email-composer-subject",1,"without-padding-top",3,"control","value","appearance","label","labelPosition"],[3,"selectionChange","messagePublish","selectTemplate","messageChangesCancel","messageInputFocus","messageInputBlur","messageInputClick","messageChanged","saveDraft","composerCleared","composerCacheCode","inputPlaceHolder","footerPanelExpanded","channelSelector","selectionActions","disableSelectionOptions","useTemplates","useDrafts","height","discardBtnVisible","dataCachingService"],[3,"ngStyle"],["appearance","line","count","3",1,"email-composer-skeleton-loader",3,"styles"],["size","large","clickMode","menu","data-qa","change-reply-action",1,"email-composer-header-actions-button",3,"title","icon","menuItems"],["displayType","text","data-qa","cc-button",1,"email-composer-header-properties-main-controls-togglebtn",3,"clicked","title"],["displayType","text","data-qa","bcc-button",1,"email-composer-header-properties-main-controls-togglebtn",3,"clicked","title"]],template:function(O,S){if(O&1){const U=t.\u0275\u0275getCurrentView();t.\u0275\u0275projectionDef(L),t.\u0275\u0275elementStart(0,"div",6)(1,"div",7)(2,"div",8),t.\u0275\u0275template(3,ne,2,5,"crt-button",9),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"div",10)(5,"div",11)(6,"div",12)(7,"crt-combobox",13),t.\u0275\u0275pipe(8,"translate"),t.\u0275\u0275listener("focusin",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onFromFocus())}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(9,"div",14),t.\u0275\u0275template(10,me,4,6,"crt-button",15)(11,Me,4,6,"crt-button",16),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(12,"div",17)(13,"crt-recipient-search",18,0),t.\u0275\u0275pipe(15,"translate"),t.\u0275\u0275listener("recipientsChanged",function(v){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.toChanged(v))})("loadRecipients",function(v){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.loadRecipients(v))}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(16,"div",19)(17,"crt-recipient-search",20,1),t.\u0275\u0275pipe(19,"translate"),t.\u0275\u0275listener("recipientsChanged",function(v){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.ccChanged(v))})("loadRecipients",function(v){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.loadRecipients(v))}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(20,"div",21)(21,"crt-recipient-search",22,2),t.\u0275\u0275pipe(23,"translate"),t.\u0275\u0275listener("recipientsChanged",function(v){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.bccChanged(v))})("loadRecipients",function(v){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.loadRecipients(v))}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(24,"div",23),t.\u0275\u0275element(25,"crt-input",24),t.\u0275\u0275pipe(26,"translate"),t.\u0275\u0275elementEnd()()()(),t.\u0275\u0275elementStart(27,"crt-base-message-composer",25,3),t.\u0275\u0275pipe(29,"translate"),t.\u0275\u0275listener("selectionChange",function(v){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onSelectionChange(v))})("messagePublish",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onMessagePublish())})("selectTemplate",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onSelectTemplate())})("messageChangesCancel",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onMessageCancel())})("messageInputFocus",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onMessageInputFocus())})("messageInputBlur",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onMessageInputBlur())})("messageInputClick",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onMessageInputClick())})("messageChanged",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.onMessageChanged())})("saveDraft",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.saveDraft())})("composerCleared",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(S.emailComposerCleared.emit())}),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(30,Ie,1,0,"ng-template",null,4,t.\u0275\u0275templateRefExtractor)(32,Oe,1,0,"ng-template",null,5,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(34,"div",26),t.\u0275\u0275element(35,"crt-skeleton-loader",27)(36,"crt-base-message-composer-skeleton"),t.\u0275\u0275elementEnd()}if(O&2){const U=t.\u0275\u0275reference(31),z=t.\u0275\u0275reference(33);t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(54,k,S.skeletonLoading?"none":"")),t.\u0275\u0275advance(),t.\u0275\u0275property("@.disabled",S.isAnimationDisabled)("@collapse",!S.isAnimationDisabled&&!S.headerExpanded),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",S.getReplyButtonVisible()),t.\u0275\u0275advance(4),t.\u0275\u0275property("control",S.fromInputControl)("items",S.fromLookupValues)("value",S.from)("useStaticFiltering",!0)("label",t.\u0275\u0275pipeBind1(8,42,"MessageComposer.Email.From"))("labelPosition","left")("appearance","legacy"),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",!S.visibleCc),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",S.visibleCc&&!S.visibleBcc),t.\u0275\u0275advance(2),t.\u0275\u0275property("rawRecipients",S.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(15,44,"MessageComposer.Email.To"))("recipientLabelWidth",S.headerLabelsWidth),t.\u0275\u0275advance(3),t.\u0275\u0275property("@collapse",!S.visibleCc),t.\u0275\u0275advance(),t.\u0275\u0275property("rawRecipients",S.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(19,46,"MessageComposer.Email.CC"))("recipientLabelWidth",S.headerLabelsWidth),t.\u0275\u0275advance(3),t.\u0275\u0275property("@collapse",!S.visibleBcc),t.\u0275\u0275advance(),t.\u0275\u0275property("rawRecipients",S.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(23,48,"MessageComposer.Email.BCC"))("recipientLabelWidth",S.headerLabelsWidth),t.\u0275\u0275advance(4),t.\u0275\u0275property("control",S.subjectInputControl)("value",S.subject)("appearance","legacy")("label",t.\u0275\u0275pipeBind1(26,50,"MessageComposer.Email.Subject"))("labelPosition","left"),t.\u0275\u0275advance(2),t.\u0275\u0275property("composerCacheCode",S.cacheCode)("inputPlaceHolder",t.\u0275\u0275pipeBind1(29,52,"MessageComposer.Email.BodyPlaceholder"))("footerPanelExpanded",S.footerPanelExpanded)("channelSelector",U)("selectionActions",z)("disableSelectionOptions",S.disableSelectionOptions)("useTemplates",!0)("useDrafts",!0)("height",S.height)("discardBtnVisible",S.headerExpanded)("dataCachingService",S.emailComposerCachingService),t.\u0275\u0275advance(7),t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(56,k,S.skeletonLoading?"":"none")),t.\u0275\u0275advance(),t.\u0275\u0275property("styles",t.\u0275\u0275pureFunction0(58,se))}},dependencies:[o.NgIf,o.NgStyle,_.B,u.W,j.q,Q.j,ie.m,pe.l,ue.E,g.TranslatePipe],styles:[`@charset "UTF-8";.email-composer-header{display:flex}.email-composer-header-actions{position:absolute}.email-composer-header-properties{width:100%}.email-composer-header-properties-main{display:flex}.email-composer-header-properties-main-from-field{width:80%}.email-composer-header-properties-main-controls{width:20%;display:flex;justify-content:flex-end}.email-composer-header-properties-main-controls-togglebtn{margin-left:8px}.email-composer-reply-expander{width:48px}.email-composer-reply-expander:after{content:"\\22ef";width:16px;height:24px;font-size:18px;background-color:var(--crt-palette-interaction-400);padding:0 16px;line-height:22px;border-radius:8px;cursor:pointer;display:block}.email-composer-reply-expander:hover{color:var(--crt-palette-primary-500)}.email-composer .email-composer-header-properties-main-from-field crt-combobox.without-padding-top .crt-input,.email-composer .email-composer-header-properties-collapsible-subject crt-input.without-padding-top .crt-input,.email-composer .recipients-container{padding-top:0}.email-composer .email-composer-header-properties-collapsible-subject crt-input.crt-base-edit-input .crt-base-input-container .crt-input .crt-input-label-container,.email-composer .email-composer-header-properties-main-from-field crt-combobox.crt-base-edit-input .crt-base-input-container .crt-input .crt-input-label-container{width:var(--headerLabelsWidthString, var(--defaultHeaderLabelsWidthString));min-width:var(--headerLabelsWidthString, var(--defaultHeaderLabelsWidthString))}.email-composer .email-composer-header-properties .email-composer-header-properties-main-controls crt-button.email-composer-header-properties-main-controls-togglebtn button.crt-button{padding:0 5px}.email-composer-skeleton-loader{justify-content:space-between;text-align:end}
`],encapsulation:2,data:{animation:[(0,s.trigger)("collapse",[(0,s.state)("false",(0,s.style)({height:s.AUTO_STYLE,visibility:s.AUTO_STYLE,overflow:"hidden",opacity:1})),(0,s.state)("true",(0,s.style)({height:"0",visibility:"hidden",overflow:"hidden",opacity:0})),(0,s.transition)("false => true",(0,s.animate)("300ms ease-in")),(0,s.transition)("true => false",(0,s.animate)("300ms ease-out"))])]}})}};(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",I.String)],X.prototype,"subject",void 0),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"subjectChange",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",I.String),(0,a.__metadata)("design:paramtypes",[I.String])],X.prototype,"from",null),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"fromChange",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],X.prototype,"sendersMailboxes",null),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],X.prototype,"to",null),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"toChange",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],X.prototype,"cc",null),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"ccChange",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],X.prototype,"bcc",null),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"bccChange",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",I.String),(0,a.__metadata)("design:paramtypes",[I.String])],X.prototype,"body",null),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"bodyChange",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",ge),(0,a.__metadata)("design:paramtypes",[ge])],X.prototype,"recipientsMailboxes",null),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",I.String),(0,a.__metadata)("design:paramtypes",[I.String])],X.prototype,"emailId",null),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],X.prototype,"skeletonLoading",null),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Number)],X.prototype,"height",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",I.String)],X.prototype,"defaultSenderRequest",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Array)],X.prototype,"bindingColumns",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",I.String)],X.prototype,"recordId",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",I.String)],X.prototype,"entitySchemaName",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Object)],X.prototype,"isReplyExpanded",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Object)],X.prototype,"visibleCc",void 0),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"visibleCcChange",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Object)],X.prototype,"visibleBcc",void 0),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"visibleBccChange",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Object)],X.prototype,"headerExpanded",void 0),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"headerExpandedChange",void 0),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"emailComposerCleared",void 0),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"emailComposerSaved",void 0),(0,a.__decorate)([(0,l.j)(),(0,a.__metadata)("design:type",Object)],X.prototype,"refreshRecipients",void 0),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Number),(0,a.__metadata)("design:paramtypes",[Number])],X.prototype,"headerLabelsWidth",null),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],X.prototype,"expandOnLoad",null),(0,a.__decorate)([(0,c.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],X.prototype,"composerEvent",null),X=(0,a.__decorate)([(0,h.v)({type:"crt.EmailComposer",contentSlots:["channelsPanel","selectionActions"],reuseStrategy:A.B.Reuse}),(0,F.f)({propertiesPanelComponentTypeName:"crt.EmailComposerPropertiesPanel",viewElementGroupType:M.J.CustomElements,typeCaption:"MessageComposer.Email.Caption"}),(0,a.__metadata)("design:paramtypes",[t.Injector,Document])],X)},23854:(G,b,e)=>{e.d(b,{r:()=>te});var n=e(73308),a=e(5960),s=e.n(a),o=e(59131),t=e.n(o),y=e(61541),m=e(6530),E=e(77592),c=e(34760),l=e(3671),h=e(96677),A=e(52793),F=e(10098),M=e(79772),g=e.n(M),V=e(6503),r=e(88033),C=e(60575),f=e(31774),R=e(4092),x=e(23092),D=e(28399),B=e.n(D),T=e(62278),I=e.n(T),P=e(58909),$=e(98488),Y=e(79341),q=e(52808),re=e(44395),ce=e(40297),d=e.n(ce),p=e(67881),_=e(58551);const u=[[["","slot","channelspanel"]],[["","slot","selectionactions"]]],j=["[slot='channelsPanel']","[slot='selectionActions']"];function Q(_e,L){_e&1&&o.\u0275\u0275projection(0)}function ie(_e,L){_e&1&&o.\u0275\u0275projection(0,1)}function pe(_e,L){_e&1&&o.\u0275\u0275element(0,"div",10)}function ue(_e,L){if(_e&1){const Z=o.\u0275\u0275getCurrentView();o.\u0275\u0275elementStart(0,"div",6),o.\u0275\u0275template(1,pe,1,0,"div",7),o.\u0275\u0275elementStart(2,"div",8)(3,"crt-slide-toggle",9),o.\u0275\u0275pipe(4,"translate"),o.\u0275\u0275pipe(5,"translate"),o.\u0275\u0275listener("toggleChange",function(se){o.\u0275\u0275restoreView(Z);const ne=o.\u0275\u0275nextContext(2);return o.\u0275\u0275resetView(ne.onExternalPublishingChange(se))})("keydown.enter",function(){o.\u0275\u0275restoreView(Z);const se=o.\u0275\u0275nextContext(2);return o.\u0275\u0275resetView(se.onExternalPublishingEnter())}),o.\u0275\u0275elementEnd()()()}if(_e&2){const Z=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(),o.\u0275\u0275property("ngIf",Z.showFooterDivider),o.\u0275\u0275advance(2),o.\u0275\u0275property("default",Z.forExternal)("useDefaultWidth",!0),o.\u0275\u0275attribute("title",o.\u0275\u0275pipeBind1(4,5,"Feed.ExternalUserTagTooltip"))("aria-label",o.\u0275\u0275pipeBind1(5,7,"Feed.ExternalUserTagTooltip"))}}function Ee(_e,L){if(_e&1&&o.\u0275\u0275template(0,ue,6,9,"div",5),_e&2){const Z=o.\u0275\u0275nextContext();o.\u0275\u0275property("ngIf",Z.allowExternalPost)}}let te=class Ue extends re.Z{set composerEvent(L){L?.forEach(Z=>{Z?.name===P.Od&&(this.footerPanelIndent=Z?.params.offset)})}set allowExternalPost(L){this._allowExternalPost=L}get allowExternalPost(){return this._allowExternalPost&&!this._userInfo.isSSP}get showFooterDivider(){return!!(this.footerPanelIndent>0||this.channelsPanel?.length>0&&this.channelsPanel.first?.isVisible)}constructor(L,Z,k,se,ne,me,Me){super(L),this._feedMessageComposerService=Z,this._messageDialogProvider=k,this._maskService=se,this._feedMentionServiceFactory=ne,this._translateService=me,this._userInfo=Me,this._attachments=[],this._forExternalDefault=!1,this._forExternal=!1,this._allowExternalPost=!1,this._feedComposerTypeName="Feed",this._sendExternalBtnIcon="send-external-button-icon",this.footerPanelIndent=0,this.messageChangesCanceled=new o.EventEmitter,this.messagePosted=new o.EventEmitter,this.feedMentionService=this._feedMentionServiceFactory.getInstance(null,null),this._googleTagManager=L.get(C.A),this.notifyService=this.injector.get(V.F)}get _isNewMessage(){return(0,D.isEmpty)(this._messageId)}get _isChildMessage(){return!(0,D.isEmpty)(this._parentMessageId)}set parentMessageId(L){this._parentMessageId=L}set messageId(L){this._messageId=L}set message(L){this._message=L}set schemaUId(L){this._schemaUId=L}set forExternal(L){this._forExternal=L}get forExternal(){return this._forExternal}set forExternalDefault(L){this._forExternal=L,this._forExternalDefault=L}get forExternalDefault(){return this._forExternalDefault}get disabled(){return this.cardState===y.n.Add}get sendButtonIcon(){return this.forExternal?this._sendExternalBtnIcon:""}get placeholder(){const L=this.disabled?"Feed.Publisher.DisabledInputPlaceholder":"Feed.Publisher.DefaultInputPlaceholder";return this._translateService.instant(L)}get cacheCode(){const L=this._userInfo?.id;if(!this._isNewMessage||this._isChildMessage||(0,D.isEmpty)(L)||!(0,D.isEmpty)(this.entitySchemaName)&&(0,D.isEmpty)(this.primaryColumnValue))return"";let Z=`feed_composer_cache_data_${L}_`;return!(0,D.isEmpty)(this.entitySchemaName)&&!(0,D.isEmpty)(this.primaryColumnValue)&&(Z+=`${this.entitySchemaName}_${this.primaryColumnValue}`),Z}_getMessage(){const L=this._isNewMessage?(0,m.qv)():this._messageId,Z=this.baseComposer.attachments.map(k=>({...k,recordId:L,fileEntitySchemaName:"FeedFile",recordEntitySchemaName:"SocialMessage",recordColumnName:"RecordId"}));return this.baseComposer.saveInlineImagesToDb({schemaName:"SocialMessage",recordId:L,fileSchemaName:"FeedFile",recordColumnName:"RecordId"}).pipe((0,T.map)(()=>({Id:L,Message:this.baseComposer.getValue(),EntityId:this.primaryColumnValue,EntitySchemaName:this.entitySchemaName,Attachments:Z,EntitySchemaUId:this._schemaUId,UserAccess:this._forExternal?R.U.External:R.U.General})))}_onFeedMessagePublishError(){this._messageDialogProvider.error("Feed.Publisher.PostingErrorMsg"),this._maskService.hideBodyMask()}_onFeedMessageSuccessfullyPosted(L){this.baseComposer.clear(),this._forExternal=this._forExternalDefault,this._maskService.hideBodyMask(),this.notifyService.show({message:"MessageComposer.MessageSent"}),this.messagePosted.emit(L),this._sendGTMData()}_sendGTMData(){const L={moduleName:this._feedComposerTypeName,schemaName:"FeedComposer",action:"FeedPostAdded"};this._googleTagManager.track(L)}_createOrUpdateChildMessage(L){return this._isNewMessage?this._feedMessageComposerService.postChildMessage(L,this._parentMessageId):this._feedMessageComposerService.updateChildMessage(L)}_createOrUpdateMessage(L){return this._isNewMessage?this._feedMessageComposerService.postMessage(L):this._feedMessageComposerService.updateMessage(L)}_composeFeedMessage(L){return this._isChildMessage?this._createOrUpdateChildMessage(L):this._createOrUpdateMessage(L)}_validate(){const Z=(this.baseComposer?.getValue()||"").replace(/<(?!img)[^>]*>|\s|&nbsp;/g,""),k=!(0,D.isEmpty)(Z);return k||this._messageDialogProvider.info("Feed.Publisher.PostingEmptyMsg"),k}_confirmPublish(){if(this._isNewMessage&&this.allowExternalPost||this.forExternalDefault===this.forExternal||!this.forExternal)return Promise.resolve(!0);const L=this._isChildMessage?"Feed.Publisher.ConfirmCommentAccessLevelChange":"Feed.Publisher.ConfirmMessageAccessLevelChange";return(0,T.lastValueFrom)(this._messageDialogProvider.confirmation(L))}_loadAttachments(L,Z,k){this._feedMessageComposerService.loadAttachments(L,Z,k).subscribe(se=>{this._attachments=se?se.map(ne=>{const me=new File([],ne.fileName);return{id:ne.fileId,size:ne.fileSize,file:me,content:new ArrayBuffer(0)}}):[],this.baseComposer&&(this.baseComposer.attachments=this._attachments,this.changeDetectorRef.detectChanges())})}ngOnChanges(L){const Z=L.primaryColumnValue?.currentValue||this.primaryColumnValue,k=L.entitySchemaName?.currentValue||this.entitySchemaName,se=L.schemaUId?.currentValue||this._schemaUId,ne=L.messageId?.currentValue;(0,D.isEmpty)(ne)||this._loadAttachments(ne,se,Z),Z&&(se||k)&&(this.feedMentionService=this._feedMentionServiceFactory.getInstance(Z,k,se))}onMessagePublish(){var L=this;return(0,n.A)(function*(){if(!(!L._validate()||!(yield L._confirmPublish()))){L._maskService.showBodyMask();try{L._getMessage().pipe((0,T.concatMap)(Z=>L._composeFeedMessage(Z)),(0,T.concatMap)(Z=>((0,m.gZ)(Z)?L._onFeedMessagePublishError():L._onFeedMessageSuccessfullyPosted(Z),(0,T.of)(!0)))).subscribe({error:()=>L._onFeedMessagePublishError()})}catch{L._onFeedMessagePublishError()}}})()}onMessageChangesCancel(){this._forExternal=this._forExternalDefault,this.messageChangesCanceled.emit()}ngAfterViewInit(){(0,D.isEmpty)(this._message)||this.baseComposer.setValue(this._message),this.baseComposer.attachments=this._attachments,this.sendComponentReadyEvent(this._feedComposerTypeName)}focus(){this.baseComposer?.focus()}onExternalPublishingChange(L){this._forExternal=L?.checked??!1,this.focus()}onExternalPublishingEnter(){this._forExternal=!this._forExternal}onNewMention(L){this.forExternal||(this._forExternal=!!L?.find(Z=>Z.connectionType===`${R.U.External}`),this.changeDetectorRef.detectChanges())}static{this.\u0275fac=function(Z){return new(Z||Ue)(o.\u0275\u0275directiveInject(o.Injector),o.\u0275\u0275directiveInject($.D),o.\u0275\u0275directiveInject(f.r),o.\u0275\u0275directiveInject(r.s),o.\u0275\u0275directiveInject(Y.o),o.\u0275\u0275directiveInject(M.TranslateService),o.\u0275\u0275directiveInject(x.oq))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:Ue,selectors:[["crt-feed-composer"]],contentQueries:function(Z,k,se){if(Z&1&&o.\u0275\u0275contentQuery(se,q.B,4),Z&2){let ne;o.\u0275\u0275queryRefresh(ne=o.\u0275\u0275loadQuery())&&(k.channelsPanel=ne)}},inputs:{primaryColumnValue:"primaryColumnValue",cardState:"cardState",entitySchemaName:"entitySchemaName",composerEvent:"composerEvent",allowExternalPost:"allowExternalPost",parentMessageId:"parentMessageId",messageId:"messageId",message:"message",schemaUId:"schemaUId",forExternal:"forExternal",forExternalDefault:"forExternalDefault"},outputs:{messageChangesCanceled:"messageChangesCanceled",messagePosted:"messagePosted"},features:[o.\u0275\u0275InheritDefinitionFeature,o.\u0275\u0275NgOnChangesFeature],ngContentSelectors:j,decls:8,vars:12,consts:[["baseComposer",""],["channelSelector",""],["selectionActions",""],["footerPanelOptions",""],[3,"selectionChange","messageInputFocus","messageInputBlur","messageInputClick","messagePublish","messageChangesCancel","newMention","composerCacheCode","inputPlaceHolder","footerPanelExpanded","mentionsService","sendingButtonDisabled","disabled","footerPanelIndent","footerPanelOptions","channelSelector","selectionActions","disableSelectionOptions","sendButtonIcon"],["class","feed-composer-footer",4,"ngIf"],[1,"feed-composer-footer"],["class","feed-composer-footer-divider",4,"ngIf"],[1,"feed-composer-footer-external-slide-wrap"],["data-qa","post-for-external","title","External","labelPosition","'after'",3,"toggleChange","keydown.enter","default","useDefaultWidth"],[1,"feed-composer-footer-divider"]],template:function(Z,k){if(Z&1){const se=o.\u0275\u0275getCurrentView();o.\u0275\u0275projectionDef(u),o.\u0275\u0275elementStart(0,"crt-base-message-composer",4,0),o.\u0275\u0275listener("selectionChange",function(me){return o.\u0275\u0275restoreView(se),o.\u0275\u0275resetView(k.onSelectionChange(me))})("messageInputFocus",function(){return o.\u0275\u0275restoreView(se),o.\u0275\u0275resetView(k.onMessageInputFocus())})("messageInputBlur",function(){return o.\u0275\u0275restoreView(se),o.\u0275\u0275resetView(k.onMessageInputBlur())})("messageInputClick",function(){return o.\u0275\u0275restoreView(se),o.\u0275\u0275resetView(k.onMessageInputClick())})("messagePublish",function(){return o.\u0275\u0275restoreView(se),o.\u0275\u0275resetView(k.onMessagePublish())})("messageChangesCancel",function(){return o.\u0275\u0275restoreView(se),o.\u0275\u0275resetView(k.onMessageChangesCancel())})("newMention",function(me){return o.\u0275\u0275restoreView(se),o.\u0275\u0275resetView(k.onNewMention(me))}),o.\u0275\u0275elementEnd(),o.\u0275\u0275template(2,Q,1,0,"ng-template",null,1,o.\u0275\u0275templateRefExtractor)(4,ie,1,0,"ng-template",null,2,o.\u0275\u0275templateRefExtractor)(6,Ee,1,1,"ng-template",null,3,o.\u0275\u0275templateRefExtractor)}if(Z&2){const se=o.\u0275\u0275reference(3),ne=o.\u0275\u0275reference(5),me=o.\u0275\u0275reference(7);o.\u0275\u0275property("composerCacheCode",k.cacheCode)("inputPlaceHolder",k.placeholder)("footerPanelExpanded",k.footerPanelExpanded)("mentionsService",k.feedMentionService)("sendingButtonDisabled",k.disabled)("disabled",k.disabled)("footerPanelIndent",k.footerPanelIndent)("footerPanelOptions",me)("channelSelector",se)("selectionActions",ne)("disableSelectionOptions",k.disableSelectionOptions)("sendButtonIcon",k.sendButtonIcon)}},dependencies:[ce.NgIf,p.G,_.l,M.TranslatePipe],styles:[".feed-composer-footer[_ngcontent-%COMP%]{display:flex;flex:auto}.feed-composer-footer-external-slide-wrap[_ngcontent-%COMP%]{width:auto}.feed-composer-footer-divider[_ngcontent-%COMP%]{margin-top:4px;margin-inline-end:24px;margin-inline-start:20px;height:16px;border-left:1px solid var(--crt-palette-border-500)}"]})}};(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",String)],te.prototype,"primaryColumnValue",void 0),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",String)],te.prototype,"cardState",void 0),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",String)],te.prototype,"entitySchemaName",void 0),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],te.prototype,"composerEvent",null),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],te.prototype,"allowExternalPost",null),(0,a.__decorate)([(0,c.j)(),(0,a.__metadata)("design:type",Object)],te.prototype,"messageChangesCanceled",void 0),(0,a.__decorate)([(0,c.j)(),(0,a.__metadata)("design:type",o.EventEmitter)],te.prototype,"messagePosted",void 0),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",String),(0,a.__metadata)("design:paramtypes",[String])],te.prototype,"parentMessageId",null),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",String),(0,a.__metadata)("design:paramtypes",[String])],te.prototype,"messageId",null),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",String),(0,a.__metadata)("design:paramtypes",[String])],te.prototype,"message",null),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",String),(0,a.__metadata)("design:paramtypes",[String])],te.prototype,"schemaUId",null),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],te.prototype,"forExternal",null),(0,a.__decorate)([(0,E.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],te.prototype,"forExternalDefault",null),te=(0,a.__decorate)([(0,l.v)({type:"crt.FeedComposer",contentSlots:["channelsPanel","selectionActions"],reuseStrategy:h.B.Reuse}),(0,A.f)({propertiesPanelComponentTypeName:"crt.FeedComposerPropertiesPanel",viewElementGroupType:F.J.CustomElements,typeCaption:"MessageComposer.Feed.Caption"}),(0,a.__metadata)("design:paramtypes",[o.Injector,$.D,f.r,r.s,Y.o,M.TranslateService,x.oq])],te)},87300:(G,b,e)=>{e.d(b,{V:()=>d});var n=e(5960),a=e.n(n),s=e(95567),o=e.n(s),t=e(59131),y=e.n(t),m=e(77592),E=e(34760),c=e(3671),l=e(96677),h=e(52793),A=e(10098),F=e(38071),M=e(68712),g=e(90204),V=e(28399),r=e.n(V),C=e(62278),f=e.n(C),R=e(58909),x=e(36122),D=e(40297),B=e.n(D),T=e(52808);const I=["items"],P=["composerHeader"],$=["selectorActions"],Y=["container"],q=p=>({display:p});function re(p,_){p&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"div",null,1),t.\u0275\u0275elementContainerEnd())}function ce(p,_){if(p&1){const u=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",6,2)(2,"crt-channel-selector",7),t.\u0275\u0275listener("selectedChannelIndexChange",function(Q){t.\u0275\u0275restoreView(u);const ie=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(ie.onSelectedChannelIndexChange(Q))}),t.\u0275\u0275elementEnd()()}if(p&2){const u=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(3,q,u.getChannelSelectorVisible()?"unset":"none")),t.\u0275\u0275advance(2),t.\u0275\u0275property("channels",u.items)("selectedChannelIndex",u.selectedComposerChannelIndex)}}let d=class We extends M.K{get _visibleItems(){return this.items?.filter(_=>_.visible!==!1)}get visibleTemplate(){const _=this.itemsTemplates?.length>this.selectedComposerChannelIndex?this.selectedComposerChannelIndex:0;return this.itemsTemplates?.get(_)}get renderEmbededChannelSelector(){return this._featureService.getFeatureState("ExtendableMessageComposer").pipe((0,C.map)(_=>!_))}set defaultChannel(_){(0,V.isEmpty)(_)||(this._defaultChannel=_,this._setDefaultComposer())}get items(){return this._items}set items(_){this._items=_,this._setDefaultComposer()}set composerEvent(_){_?.forEach(u=>{switch(u?.name){case R.iQ:this._handleComposerReady(u.params?.composerSchemaType);break;case R.An:u.params&&(this._isVisible=u.params?.isFocused,this._updateOffsetOnFocus());break;case R.M7:this._handleReplyActionEvent({emailId:u.params?.emailId,action:u.params?.action})}})}set selectedComposerChannelIndex(_){this._isVisible=!1,this._selectedChannelIndex$.next(_),this.changeDetectorRef.markForCheck()}get selectedComposerChannelIndex(){return this._selectedChannelIndex$.value}constructor(_,u){super(_),this._changeComposerService=u,this._defaultChannel="crt.FeedComposer",this._subscriptions=[],this._updateView=new C.Subject,this._rendered=new Map,this._selectedChannelIndex$=new C.BehaviorSubject(0),this.composerEventChange=new t.EventEmitter,this.selectedComposerChannelIndexChange=new t.EventEmitter,this.preserveContent=!0,this._subscribeToChangeComposerEvent(this._changeComposerService),this._featureService=_.get(F.wf)}_setDefaultComposer(){if(!this._items)return;const _=this._visibleItems.findIndex(u=>u.type===this._defaultChannel);this.selectedComposerChannelIndex=_<0?0:_,this.selectedComposerChannelIndexChange.emit(this.selectedComposerChannelIndex)}_subscribeToChangeComposerEvent(_){this._subscriptions.push(_.getComposerObservable().subscribe(u=>{const j=this._visibleItems?.find(Q=>Q.data.schemaType===u);j&&this.showComposer(j)}))}_updateOffsetOnFocus(){!this._isVisible||!this.renderEmbededChannelSelector||window.requestAnimationFrame(()=>{if(this._isVisible&&!this.selectorActions){this._updateOffsetOnFocus();return}this.composerEventChange.emit([{name:R.Od,params:{offset:this.selectorActions?.nativeElement?.offsetWidth??0}}])})}_handleReplyActionEvent(_){const u=this.items.findIndex(Q=>Q.data?.schemaType==="Email");if(u<0)return;const j=this.items[this.selectedComposerChannelIndex];(!j||j.data?.schemaType!=="Email")&&(this._replyActionEvent=_,this.selectedComposerChannelIndex=u,this.changeDetectorRef.detectChanges()),window.requestAnimationFrame(()=>{this.composerHeader?.nativeElement?.scrollIntoView({behavior:"smooth",block:"nearest"})})}_handleComposerReady(_){const u=[];if(this._isVisible=!1,typeof _=="string"&&_==="Feed"&&this.selectorActions?.nativeElement)u.push({name:R.Od,params:{offset:this.selectorActions?.nativeElement?.offsetWidth??0}});else if(_==="Email"){const j=this.items[this.selectedComposerChannelIndex];this._replyActionEvent&&j.data?.schemaType==="Email"&&(u.push({name:R.M7,params:this._replyActionEvent}),this._replyActionEvent=null)}this.composerEventChange.emit(u)}_renderItem(_,u){if(u!==this.selectedComposerChannelIndex)return;const j=this.itemsTemplates.get(u),Q=_.createEmbeddedView(j);this._rendered.set(j,Q),this.detectChanges(),requestAnimationFrame(()=>{const ie=Q.rootNodes.filter(pe=>!(pe instanceof Comment));this._setVisibilityInDom(ie,"unset")})}_changeItemVisibility(_,u,j){const Q=u.rootNodes.filter(ie=>!(ie instanceof Comment));_===this.selectedComposerChannelIndex?this._setVisibilityInDom(Q,"unset"):this._setVisibilityInDom(Q,"none")}_setVisibilityInDom(_,u){_.forEach(j=>{const Q=j;Q.style.display=u,u==="none"?Q.classList.remove("rendered"):Q.classList.add("rendered")})}_destroyRenderedItem(_){this._rendered.get(_)?.destroy(),this._rendered.delete(_)}showComposer(_){this.selectedComposerChannelIndex=this.items.indexOf(_)}showItem(){this.containers?.forEach((_,u)=>{const j=this.itemsTemplates.get(u);if(!j)return;const Q=this._rendered.get(j);if(!Q){this._renderItem(_,u);return}if(this.preserveContent){this._changeItemVisibility(u,Q);return}u!==this.selectedComposerChannelIndex&&this._destroyRenderedItem(j)})}ngAfterViewInit(){this._subscriptions.push(this._updateView.asObservable().pipe((0,C.debounceTime)(0)).subscribe(()=>{this.showItem()})),this._subscriptions.push((0,C.merge)(this._selectedChannelIndex$.asObservable()).subscribe(()=>{this._updateView.next()}))}ngOnDestroy(){this._subscriptions.forEach(_=>_?.unsubscribe())}onSelectedChannelIndexChange(_){this.selectedComposerChannelIndex=_}getChannelSelectorVisible(){return this._isVisible?!!(this._visibleItems&&this._visibleItems.length>1):!1}static{this.\u0275fac=function(u){return new(u||We)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(x.I))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:We,selectors:[["crt-message-composer-selector"]],contentQueries:function(u,j,Q){if(u&1&&t.\u0275\u0275contentQuery(Q,I,4,t.TemplateRef),u&2){let ie;t.\u0275\u0275queryRefresh(ie=t.\u0275\u0275loadQuery())&&(j.itemsTemplates=ie)}},viewQuery:function(u,j){if(u&1&&(t.\u0275\u0275viewQuery(P,5),t.\u0275\u0275viewQuery($,5),t.\u0275\u0275viewQuery(Y,5,t.ViewContainerRef)),u&2){let Q;t.\u0275\u0275queryRefresh(Q=t.\u0275\u0275loadQuery())&&(j.composerHeader=Q.first),t.\u0275\u0275queryRefresh(Q=t.\u0275\u0275loadQuery())&&(j.selectorActions=Q.first),t.\u0275\u0275queryRefresh(Q=t.\u0275\u0275loadQuery())&&(j.containers=Q)}},inputs:{defaultChannel:"defaultChannel",items:"items",composerEvent:"composerEvent",selectedComposerChannelIndex:"selectedComposerChannelIndex",preserveContent:"preserveContent"},outputs:{composerEventChange:"composerEventChange",selectedComposerChannelIndexChange:"selectedComposerChannelIndexChange"},features:[t.\u0275\u0275ProvidersFeature([]),t.\u0275\u0275InheritDefinitionFeature],decls:6,vars:4,consts:[["composerHeader",""],["container",""],["selectorActions",""],[1,"message-composer-selector"],[4,"ngFor","ngForOf"],["class","message-composer-selector-actions",3,"ngStyle",4,"ngIf"],[1,"message-composer-selector-actions",3,"ngStyle"],[3,"selectedChannelIndexChange","channels","selectedChannelIndex"]],template:function(u,j){u&1&&(t.\u0275\u0275elementStart(0,"div",3),t.\u0275\u0275element(1,"div",null,0),t.\u0275\u0275template(3,re,3,0,"ng-container",4)(4,ce,3,5,"div",5),t.\u0275\u0275pipe(5,"async"),t.\u0275\u0275elementEnd()),u&2&&(t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",j.itemsTemplates),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(5,2,j.renderEmbededChannelSelector)))},dependencies:[D.NgForOf,D.NgIf,D.NgStyle,T.B,D.AsyncPipe],styles:[`.message-composer-selector{position:relative;min-height:32px}.message-composer-selector-actions{position:absolute;bottom:0;display:flex}
`],encapsulation:2,data:{animation:[(0,s.trigger)("collapse",[(0,s.state)("false",(0,s.style)({height:s.AUTO_STYLE,visibility:s.AUTO_STYLE,overflow:"hidden",opacity:1})),(0,s.state)("true",(0,s.style)({height:"0",visibility:"hidden",overflow:"hidden",opacity:0})),(0,s.transition)("false => true",(0,s.animate)("300ms ease-in")),(0,s.transition)("true => false",(0,s.animate)("300ms ease-out"))])]}})}};(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",String),(0,n.__metadata)("design:paramtypes",[String])],d.prototype,"defaultChannel",null),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],d.prototype,"items",null),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],d.prototype,"composerEvent",null),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],d.prototype,"composerEventChange",void 0),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],d.prototype,"selectedComposerChannelIndex",null),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],d.prototype,"selectedComposerChannelIndexChange",void 0),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Object)],d.prototype,"preserveContent",void 0),d=(0,n.__decorate)([(0,c.v)({type:"crt.MessageComposerSelector",contentSlots:[{name:"items",lazy:!0,input:!0}],reuseStrategy:l.B.Reuse}),(0,h.f)({toolbarConfig:{position:250,defaultPropertyValues:{items:[],name:"MessageComposer_"+g.N},icon:e(62127)},propertiesPanelComponentTypeName:"crt.MessageComposerPropertiesPanel",viewElementGroupType:A.J.Components,typeCaption:"Components.MessageComposer.Caption"}),(0,n.__metadata)("design:paramtypes",[t.Injector,x.I])],d)},2126:(G,b,e)=>{e.d(b,{m:()=>B});var n=e(59131),a=e.n(n),s=e(56711),o=e.n(s),t=e(6530),y=e(79772),m=e.n(y),E=e(59969),c=e(32625),l=e(28399),h=e.n(l),A=e(40297),F=e.n(A),M=e(84137),g=e(66803),V=e(12325),r=e(52989),C=e.n(r),f=e(82650);const R=["selectedRecipient"],x=T=>({"recipient-not-valid":T});function D(T,I){if(T&1){const P=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",7,0),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275listener("keydown.delete",function(){const Y=n.\u0275\u0275restoreView(P).$implicit,q=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(q.removeRecipient(Y.value))}),n.\u0275\u0275elementStart(3,"crt-label",8),n.\u0275\u0275pipe(4,"encodeHtml"),n.\u0275\u0275text(5),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(6,"mat-icon",9),n.\u0275\u0275pipe(7,"translate"),n.\u0275\u0275listener("click",function(){const Y=n.\u0275\u0275restoreView(P).$implicit,q=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(q.removeRecipient(Y.value))})("keydown.enter",function(){const Y=n.\u0275\u0275restoreView(P).$implicit,q=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(q.removeRecipient(Y.value))}),n.\u0275\u0275elementEnd()()}if(T&2){const P=I.$implicit,$=n.\u0275\u0275nextContext();n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(11,x,!$.validateRecipient(P))),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,5,$.recipientLabel)),n.\u0275\u0275advance(3),n.\u0275\u0275property("crtTooltip",n.\u0275\u0275pipeBind1(4,7,$.getTooltip(P))),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",$.getRecipientDisplayValue(P)," "),n.\u0275\u0275advance(),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(7,9,"MessageComposer.Email.RemoveRecipientLabel"))}}class B extends c.g{get dropDownRecipients(){return this.filteredRecipients.filter(I=>!this.selectedRecipients.some(P=>I.displayValue===P.displayValue))}set rawRecipinets(I){I&&(this._rawRecipients=I,this._loadRecipients(this.recipientSearchControl.value,0))}set recipientLabelWidth(I){I&&(this._labelWidth=I+"px")}constructor(I,P,$){super(I,null,P),this._translateService=$,this._hasNextPage=!0,this.recipientSearchControl=new s.FormControl(null),this.selectedRecipients=new Array,this.filteredRecipients=new Array,this._labelWidth="136px",this.loadRecipients=new n.EventEmitter,this.recipientsChanged=new n.EventEmitter,this.recipientSearchControl.valueChanges.subscribe(Y=>this._selectRecipient(Y))}_selectRecipient(I){I&&I.value&&!this.selectedRecipients.some(P=>P.displayValue===I.displayValue)&&(this.selectedRecipients.push(I),this.recipientsChanged.emit(this.selectedRecipients.map(P=>P.displayValue)))}_setRecipientsComboboxList(I,P=!1){this._rawRecipients=P?[...this._rawRecipients,...I]:I;const $=I.map(Y=>Y.emails).flat(1);this.filteredRecipients=P?[...this.filteredRecipients,...$]:$}_loadRecipients(I,P=0){this.recipientsLoading=!0,this._hasNextPage=this._rawRecipients.length>0,this._rawRecipients&&this._rawRecipients.length>0?this._setRecipientsComboboxList(this._rawRecipients,P>0):P===0&&!(0,l.isEmpty)(I)&&(I.includes(";")||I.includes(",")?this._selectPastedEmails(I):this._setRecipientsComboboxList([{emails:[this._mapRecipient(I)]}])),this.recipientsLoading=!1,this.changeDetectorRef.markForCheck()}_selectPastedEmails(I){I.split(/[;,]/).map(P=>P.trim()).filter(P=>!(0,l.isEmpty)(P)).forEach(P=>{this._selectRecipient(this._mapRecipient(P))}),this.clearCombobox(),window.requestAnimationFrame(()=>{this.selectedRecipient.last?.nativeElement?.focus()})}_mapRecipient(I){return{value:(0,t.qv)(),displayValue:I.trim()}}getRecipients(){return this.selectedRecipients?this.selectedRecipients.map(I=>I.displayValue):[]}setRecipients(I){this.selectedRecipients=I?.filter(P=>!(0,l.isEmpty)(P)).map(P=>this._mapRecipient(P))}clear(){this.clearCombobox(),this.selectedRecipients=[],this.recipientsChanged.emit([])}validate(){return this.selectedRecipients.length>0&&this.selectedRecipients.filter(I=>!this.validateRecipient(I)).length===0}searchRecipients(I){(0,l.isEmpty)(I)&&(I={viewElement:"crt.ComboBox",filterValue:null}),this.loadRecipients.emit({query:I.filterValue,recipientsLength:0})}clearCombobox(){this._hasNextPage=!0,this.recipientSearchControl.setValue(null)}removeRecipient(I){this.selectedRecipients=this.selectedRecipients.filter(P=>P.value!==I),this.recipientsChanged.emit(this.selectedRecipients.map(P=>P.displayValue)),this.changeDetectorRef.markForCheck()}getRecipientDisplayValue(I){const P=new RegExp(`\\s?<${E.Eu}>`,"g"),$=new RegExp(/^;+|;+$/,"g"),Y=new RegExp(/[^\s]/,"g"),q=I.displayValue.replace(P,"").replace($,"");return Y.test(q)?q:I.displayValue}validateRecipient(I){return(0,E.m2)(I.displayValue)}getTooltip(I){return this.validateRecipient(I)?(0,E.Z6)(I.displayValue)?"":I.displayValue:`"${I.displayValue}" ${this._translateService.instant("MessageComposer.Email.NotContainsEmail")}`}loadNextPage(){this._hasNextPage&&this.loadRecipients.emit({query:this.recipientSearchControl.value,recipientsLength:this._rawRecipients.length})}static{this.\u0275fac=function(P){return new(P||B)(n.\u0275\u0275directiveInject(n.Injector),n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(y.TranslateService))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:B,selectors:[["crt-recipient-search"]],viewQuery:function(P,$){if(P&1&&n.\u0275\u0275viewQuery(R,5,n.ElementRef),P&2){let Y;n.\u0275\u0275queryRefresh(Y=n.\u0275\u0275loadQuery())&&($.selectedRecipient=Y)}},hostVars:2,hostBindings:function(P,$){P&2&&n.\u0275\u0275styleProp("--labelWidth",$._labelWidth)},inputs:{rawRecipinets:"rawRecipinets",recipientLabel:"recipientLabel",recipientLabelWidth:"recipientLabelWidth"},outputs:{loadRecipients:"loadRecipients",recipientsChanged:"recipientsChanged"},features:[n.\u0275\u0275InheritDefinitionFeature],decls:8,vars:9,consts:[["selectedRecipient",""],[1,"recipients-container"],[1,"recipients-label-container"],["labelType","caption"],[1,"selected-recipients-container"],["class","selected-recipient","tabindex","0",3,"ngClass","keydown.delete",4,"ngFor","ngForOf"],["labelPosition","none","data-item-marker","recipients-search-combobox",3,"closed","showList","paginationChange","control","items","loading","debounceTime","appearance"],["tabindex","0",1,"selected-recipient",3,"keydown.delete","ngClass"],["labelEllipsis","true",1,"selected-recipient-label",3,"crtTooltip"],["svgIcon","message-composer-attach-cross","data-qa","selected-recipient-remove-button","tabindex","0",1,"selected-recipient-remove-button",3,"click","keydown.enter"]],template:function(P,$){P&1&&(n.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"crt-label",3),n.\u0275\u0275text(3),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(5,"div",4),n.\u0275\u0275template(6,D,8,13,"div",5),n.\u0275\u0275elementStart(7,"crt-combobox",6),n.\u0275\u0275listener("closed",function(){return $.clearCombobox()})("showList",function(q){return $.searchRecipients(q)})("paginationChange",function(){return $.loadNextPage()}),n.\u0275\u0275elementEnd()()()),P&2&&(n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(4,7,$.recipientLabel)," "),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngForOf",$.selectedRecipients),n.\u0275\u0275advance(),n.\u0275\u0275property("control",$.recipientSearchControl)("items",$.dropDownRecipients)("loading",$.recipientsLoading)("debounceTime",100)("appearance","legacy"))},dependencies:[A.NgClass,A.NgForOf,M.d,g.q,V.V,r.MatIcon,f.m,y.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.recipients-container{display:flex;width:100%;padding-top:8px}.recipients-container .recipients-label-container{margin-inline-end:10px;display:flex;width:var(--labelWidth, 136px);min-width:var(--labelWidth, 136px);flex-direction:row-reverse}.recipients-container .recipients-label-container .crt-label{color:var(--crt-base-input-label-color);margin-top:9px}.recipients-container .selected-recipients-container{display:flex;width:calc(100% - var(--labelWidth, 136px));flex-wrap:wrap;min-height:32px;align-items:flex-end}.recipients-container .selected-recipients-container .selected-recipient{display:flex;align-items:center;background-color:var(--crt-palette-interaction-900);border-radius:12px;padding:0 12px;margin:4px 0;margin-inline-end:12px;width:min-content;max-width:calc(100% - 36px);cursor:pointer}.recipients-container .selected-recipients-container .selected-recipient label{color:var(--crt-palette-link-500)}.recipients-container .selected-recipients-container .selected-recipient.recipient-not-valid{background-color:var(--crt-palette-navigation-primary-500)}.recipients-container .selected-recipients-container .selected-recipient.recipient-not-valid label{color:var(--crt-palette-label-contrast-500)}.recipients-container .selected-recipients-container .selected-recipient:first-of-type{margin-top:9px}.recipients-container .selected-recipients-container .selected-recipient-label{max-width:100%}.recipients-container .selected-recipients-container .selected-recipient-remove-button{display:none;flex-basis:10px;height:10px;flex-grow:0;flex-shrink:0;width:unset;color:var(--crt-palette-label-500)}.recipients-container .selected-recipients-container .selected-recipient-remove-button:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}.recipients-container .selected-recipients-container .selected-recipient:hover .selected-recipient-remove-button,.recipients-container .selected-recipients-container .selected-recipient:focus-within .selected-recipient-remove-button{display:flex}.recipients-container .selected-recipients-container .selected-recipient:hover .selected-recipient-label,.recipients-container .selected-recipients-container .selected-recipient:focus-within .selected-recipient-label{max-width:calc(100% - 10px)}.recipients-container .selected-recipients-container .selected-recipient:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:12px}
`],encapsulation:2})}}},50868:(G,b,e)=>{e.d(b,{q:()=>o});var n=e(5960),a=e.n(n),s=e(4164);let o=class{convert(y){const m=y[1],E=y[0];return m?null:E}};o=(0,n.__decorate)([(0,s.a)({type:"crt.ConditionalEmailId"})],o)},19484:(G,b,e)=>{e.d(b,{K:()=>E});var n=e(5960),a=e.n(n),s=e(6530),o=e(4164),t=e(62278),y=e.n(t),m=e(43673);let E=class{constructor(l){this._recipientsService=l}convert(l){return(0,t.lastValueFrom)(this._recipientsService.getRecipients(l.event.query,l.event.recipientsLength).pipe((0,t.map)(h=>({recipients:h,loadStamp:(0,s.qv)()}))))}};E=(0,n.__decorate)([(0,o.a)({type:"crt.ToRecipientsMailboxes"}),(0,n.__metadata)("design:paramtypes",[m.e])],E)},21122:(G,b,e)=>{e.d(b,{m:()=>E});var n=e(5960),a=e.n(n),s=e(4164),o=e(23092),t=e(62278),y=e.n(t),m=e(2047);let E=class{constructor(l,h){this._mailboxesService=l,this._userInfoService=h}convert(){return(0,t.lastValueFrom)(this._userInfoService.loadCurrentUserInfo().pipe((0,t.concatMap)(l=>this._mailboxesService.getMailboxesForSend(l?.userInfo.id))))}};E=(0,n.__decorate)([(0,s.a)({type:"crt.ToSendersMailboxes"}),(0,n.__metadata)("design:paramtypes",[m.W,o.fv])],E)},48531:(G,b,e)=>{e.d(b,{B:()=>t});var n=e(41287),a=e(93338),s=e(16296),o=e(58909);class t extends n.l{constructor(){super(...arguments),this.action=s.T.Reply}_processReply(m){const E=Object.keys(m.$context.attributes).filter(c=>c.startsWith(a._));E.length&&E.forEach(c=>m.$context[c]=[{name:o.M7,params:{emailId:m.recordId,action:this.action}}])}handle(m){return new Promise(E=>{this._processReply(m),E()})}}},99553:(G,b,e)=>{e.d(b,{E:()=>c});var n=e(73308),a=e(5960),s=e.n(a),o=e(41287),t=e(844),y=e(62278),m=e.n(y),E=e(2047);let c=class extends o.l{constructor(h){super(),this._service=h}handle(h){var A=this;return(0,n.A)(function*(){const F=h.recordId,M=yield(0,y.firstValueFrom)(A._service.getCaseDefaultMailbox(F));return M?.senderEmailAddress?M?.senderEmailAddress:yield A.next?.handle(h)})()}};c=(0,a.__decorate)([(0,t.l)({type:"crt.CaseSenderComposerHandler",requestType:"crt.CaseSenderComposerRequest"}),(0,a.__metadata)("design:paramtypes",[E.W])],c)},74575:(G,b,e)=>{e.d(b,{H:()=>m});var n=e(73308),a=e(5960),s=e.n(a),o=e(41287),t=e(844),y=e(36122);let m=class extends o.l{constructor(c){super(),this._service=c}handle(c){var l=this;return(0,n.A)(function*(){l._service.openComposer(c.composerSchemaType),yield l.next?.handle(c)})()}};m=(0,a.__decorate)([(0,t.l)({type:"crt.ChangeComposerHandler",requestType:"crt.ChangeComposerRequest"}),(0,a.__metadata)("design:paramtypes",[y.I])],m)},13787:(G,b,e)=>{e.d(b,{e:()=>f});var n=e(73308),a=e(5960),s=e.n(a),o=e(61541),t=e(844),y=e(40968),m=e(59969),E=e(38071),c=e(95145),l=e(29858),h=e(55359),A=e(66446),F=e(28399),M=e.n(F),g=e(62278),V=e.n(g),r=e(48531),C=e(16296);let f=class extends r.B{constructor(x,D,B,T){super(),this._featureService=x,this._entityConnectionService=D,this._sysSettingsService=B,this._window=T,this._freedomUiType="f4d757e1-2aeb-496f-b751-3d5b39708ea3",this._uiTypeSysSettingCode="EditPagesUITypeForFreedomHost",this.action=C.T.EditDraft}_openEditPage(x){var D=this;return(0,n.A)(function*(){let B;const T=(0,F.get)(D._window,["Terrasoft","isAngularHost"]),I=yield(0,g.lastValueFrom)(D._sysSettingsService.getValueByCode(D._uiTypeSysSettingCode));T&&I===D._freedomUiType?B={type:"crt.OpenPageRequest",schemaName:"EmailMiniPage",modelInitConfigs:[{recordId:x.recordId,action:o.n.Edit}],$context:x.$context}:B={type:"crt.UpdateRecordRequest",entityName:"Activity",recordId:x.recordId,$context:x.$context},yield D.handlerChain.process(B)})()}_openAddPage(x){var D=this;return(0,n.A)(function*(){const B=yield A.a.getPageSchemaNameForAction({entityName:"Activity",action:o.n.Add,typeColumnValue:h.Iq.toLowerCase()}),T=yield D._getDefaultValues(x),I={type:"crt.CreateRecordRequest",entityName:"Activity",entityPageName:B,defaultValues:T,$context:x.$context};yield D.handlerChain.process(I)})()}_getDefaultValues(x){var D=this;return(0,n.A)(function*(){const B=[{attributeName:"Type",value:h.Iq}],T=yield x.$context.getPrimaryDataSchema(),I=T.name,P=yield x.$context[T.primaryAttributeName],$=yield D._entityConnectionService.getEntityConnectionColumns("Activity",I),{$context:Y}=x;return x.bindingColumns&&(yield Promise.all(x.bindingColumns.map(function(){var q=(0,n.A)(function*(re){const ce=yield Y[re.formAttributeName];ce&&B.push({attributeName:re.activityColumnName,value:ce.value||ce.activityAttributeName})});return function(re){return q.apply(this,arguments)}}()))),$&&$.forEach(q=>{B.push({attributeName:q.name,value:P})}),B})()}handle(x){var D=()=>super.handle,B=this;return(0,n.A)(function*(){(yield(0,g.lastValueFrom)(B._featureService.getFeatureState("UseEmailComposer")))?yield D().call(B,{recordId:x.recordId,type:"crt.ReplyEmailComposerRequest",$context:x.$context}):(0,F.isEmpty)(x.recordId)?yield B._openAddPage(x):yield B._openEditPage(x),yield B.next?.handle(x)})()}};f=(0,a.__decorate)([(0,t.l)({type:"crt.CreateEmailRequestHandler",requestType:"crt.CreateEmailRequest"}),(0,a.__param)(3,(0,y.j)(m.ZP)),(0,a.__metadata)("design:paramtypes",[E.wf,l.r,c.A,Window])],f)},37552:(G,b,e)=>{e.d(b,{x:()=>c});var n=e(73308),a=e(5960),s=e.n(a),o=e(41287),t=e(844),y=e(62278),m=e.n(y),E=e(2047);let c=class extends o.l{constructor(h){super(),this._service=h}handle(h){var A=this;return(0,n.A)(function*(){const F=h.recordId,M=yield(0,y.firstValueFrom)(A._service.getDefaultMailboxForSend(F));return M?.senderEmailAddress?M?.senderEmailAddress:yield A.next?.handle(h)})()}};c=(0,a.__decorate)([(0,t.l)({type:"crt.DefaultSenderComposerHandler",requestType:"crt.DefaultSenderComposerRequest"}),(0,a.__metadata)("design:paramtypes",[E.W])],c)},52162:(G,b,e)=>{e.d(b,{T:()=>m});var n=e(73308),a=e(5960),s=e.n(a),o=e(844),t=e(48531),y=e(16296);let m=class extends t.B{constructor(){super(),this.action=y.T.EditDraft}handle(c){var l=()=>super.handle,h=this;return(0,n.A)(function*(){yield l().call(h,c),yield h.next?.handle(c)})()}};m=(0,a.__decorate)([(0,o.l)({type:"crt.EditDraftEmailComposerRequestHandler",requestType:"crt.EditDraftEmailComposerRequest"}),(0,a.__metadata)("design:paramtypes",[])],m)},29373:(G,b,e)=>{e.d(b,{F:()=>V,_:()=>r});var n=e(73308),a=e(5960),s=e.n(a),o=e(59131),t=e.n(o),y=e(81517),m=e(2828),E=e(41287),c=e(844),l=e(62278),h=e.n(l),A=e(36486),F=e.n(A),M=e(58909),g=e(85688);let V=class extends y.S{};V=(0,a.__decorate)([(0,m.$)({type:"crt.EmailComposerSavedRequest"})],V);let r=class extends E.l{constructor(f){super(),this._composerEventAttrName="ComposerEvent",this._emailsService=f.get(g.d)}handle(f){var R=this;return(0,n.A)(function*(){const x=f.$context,D=f.emailWithParams;if(!D)return Promise.resolve();const B=D.params,I=x.modelInitConfigs.filter(P=>P.action==="add");return I.length===1&&I[0].defaultValues?.forEach($=>{B.defaultValues.push({attributeName:$.attributeName,value:$.value})}),B.bindingColumns&&(yield Promise.all(B.bindingColumns.map(function(){var P=(0,n.A)(function*($){const Y=yield x[$.formAttributeName];Y&&B.defaultValues.push({attributeName:$.activityColumnName,value:Y.value||Y.activityAttributeName})});return function($){return P.apply(this,arguments)}}()))),(0,l.lastValueFrom)(R._emailsService.saveEmail(D.email,D.params).pipe((0,A.switchMap)(P=>{const $=Object.keys(f.$context.attributes).filter(Y=>Y.startsWith(R._composerEventAttrName));return $.length&&$.forEach(Y=>f.$context[Y]=[{name:M.J3,params:{response:P}}]),(0,l.of)({})})))})()}};r=(0,a.__decorate)([(0,c.l)({type:"crt.EmailComposerSavedHandler",requestType:"crt.EmailComposerSavedRequest"}),(0,a.__metadata)("design:paramtypes",[o.Injector])],r)},16111:(G,b,e)=>{e.d(b,{M:()=>E});var n=e(73308),a=e(5960),s=e.n(a),o=e(41287),t=e(40269),y=e(65288),m=e(844);let E=class extends o.l{_getNeedClosePage(l){var h=this;return(0,n.A)(function*(){return(yield l.$context.IsChanged)?!1:(yield l.$context.ElementExecutionData)?!(yield h._getActualSendDate(l)):!0})()}_getActualSendDate(l){return(0,n.A)(function*(){const h=yield l.$context.Id;return((yield(yield t.K.create("Activity")).load({attributes:["SendDate"],parameters:[{type:y.E.PrimaryColumnValue,value:h}]}))[0]||{}).SendDate})()}handle(l){var h=this;return(0,n.A)(function*(){if(!(yield l.$context.ComposerVisible)){yield h.next?.handle(l);return}l.$context.ComposerVisible=!1,(yield l.$context.IsReplyMode)?l.$context.IsReplyMode=!1:(yield h._getNeedClosePage(l))&&(yield h.handlerChain.process({type:"crt.ClosePageRequest",$context:l.$context})),yield h.next?.handle(l)})()}};E=(0,a.__decorate)([(0,m.l)({type:"crt.EmailFormPageComposerClearedHandler",requestType:"crt.onEmailComposerClearedRequest",scopes:["EmailFormPage"]})],E)},28307:(G,b,e)=>{e.d(b,{p:()=>A});var n=e(73308),a=e(5960),s=e.n(a),o=e(41287),t=e(844),y=e(89285),m=e(65576),E=e(28399),c=e.n(E),l=e(62278),h=e.n(l);let A=class extends o.l{_subscribeViewModelEvents(M){var g=this;const V=new l.Subscription;V.add(M.events$.pipe((0,l.filter)(({type:r})=>r===m.n.FinishLoadModelAttributes)).subscribe({next:function(){var r=(0,n.A)(function*(C){yield g._updateComposerVisibility(C,M),yield g._updateEmailBody(C,M)});return function(f){return r.apply(this,arguments)}}(),complete:()=>{V.unsubscribe()}}))}_updateComposerVisibility(M,g){return(0,n.A)(function*(){if((yield g.getPrimaryModelMode())!==y.b.Update||!M?.payload?.SendDate||!M?.payload?.Id)return;const r=yield g.Id,C=!!(yield g.SendDate);!r||C||(g.ComposerVisible=!0)})()}_updateEmailBody(M,g){return(0,n.A)(function*(){if((yield g.getPrimaryModelMode())!==y.b.Update||!M?.payload?.EmailBody||!M?.payload?.IsHtmlBody)return;const r=yield g.IsHtmlBody,C=yield g.EmailBody;!r&&!E.isEmpty(C)&&!C.startsWith("<pre>")&&(g.EmailBody=`<pre>${E.escape(C)}</pre>`)})()}handle(M){var g=this;return(0,n.A)(function*(){yield g.next?.handle(M),g._subscribeViewModelEvents(M.$context)})()}};A=(0,a.__decorate)([(0,t.l)({type:"crt.EmailFormPageViewModelInitRequestHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["EmailFormPage"]})],A)},58298:(G,b,e)=>{e.d(b,{I:()=>A});var n=e(73308),a=e(5960),s=e.n(a),o=e(41287),t=e(844),y=e(89285),m=e(65576),E=e(28399),c=e.n(E),l=e(62278),h=e.n(l);let A=class extends o.l{_subscribeViewModelEvents(M){var g=this;const V=new l.Subscription;V.add(M.events$.pipe((0,l.filter)(({type:r})=>r===m.n.FinishLoadModelAttributes)).subscribe({next:function(){var r=(0,n.A)(function*(C){yield g._tryOpenDraft(C,M),yield g._updateRecipients(C,M)});return function(f){return r.apply(this,arguments)}}(),complete:()=>{V.unsubscribe()}}))}_tryOpenDraft(M,g){var V=this;return(0,n.A)(function*(){if((yield g.getPrimaryModelMode())!==y.b.Update||!M?.payload?.SendDate||!M?.payload?.Id)return;const C=yield g.Id,f=!!(yield g.SendDate);!C||f||(yield V.handlerChain.process({type:"crt.EditDraftEmailComposerRequest",recordId:C,$context:g}))})()}_updateRecipients(M,g){return(0,n.A)(function*(){if((yield g.getPrimaryModelMode())!==y.b.Create||!M?.payload?.Recepient)return;const r=yield g.Recepient;E.isEmpty(r)||(g.EmailComposer_To=[...r.split(";")])})()}handle(M){var g=this;return(0,n.A)(function*(){yield g.next?.handle(M),g._subscribeViewModelEvents(M.$context)})()}};A=(0,a.__decorate)([(0,t.l)({type:"crt.EmailMiniPageViewModelInitRequestHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["EmailMiniPage"]})],A)},81875:(G,b,e)=>{e.d(b,{p:()=>m});var n=e(73308),a=e(5960),s=e.n(a),o=e(844),t=e(48531),y=e(16296);let m=class extends t.B{constructor(){super(),this.action=y.T.Forward}handle(c){var l=()=>super.handle,h=this;return(0,n.A)(function*(){yield l().call(h,c),yield h.next?.handle(c)})()}};m=(0,a.__decorate)([(0,o.l)({type:"crt.ForwardEmailComposerRequestHandler",requestType:"crt.ForwardEmailComposerRequest"}),(0,a.__metadata)("design:paramtypes",[])],m)},83743:(G,b,e)=>{e.d(b,{B:()=>E,C:()=>c});var n=e(73308),a=e(5960),s=e.n(a),o=e(81517),t=e(2828),y=e(41287),m=e(844);let E=class extends o.S{};E=(0,a.__decorate)([(0,t.$)({type:"crt.RefreshEmailRecipientsRequest"})],E);let c=class extends y.l{handle(h){var A=this;return(0,n.A)(function*(){yield A.next?.handle(h)})()}};c=(0,a.__decorate)([(0,m.l)({type:"crt.RefreshEmailRecipientsHandler",requestType:"crt.RefreshEmailRecipientsRequest"})],c)},8610:(G,b,e)=>{e.d(b,{F:()=>m});var n=e(73308),a=e(5960),s=e.n(a),o=e(844),t=e(48531),y=e(16296);let m=class extends t.B{constructor(){super(),this.action=y.T.ReplyAll}handle(c){var l=()=>super.handle,h=this;return(0,n.A)(function*(){yield l().call(h,c),yield h.next?.handle(c)})()}};m=(0,a.__decorate)([(0,o.l)({type:"crt.ReplyAllEmailComposerRequestHandler",requestType:"crt.ReplyAllEmailComposerRequest"}),(0,a.__metadata)("design:paramtypes",[])],m)},54880:(G,b,e)=>{e.d(b,{I:()=>m});var n=e(73308),a=e(5960),s=e.n(a),o=e(844),t=e(48531),y=e(16296);let m=class extends t.B{constructor(){super(),this.action=y.T.Reply}handle(c){var l=()=>super.handle,h=this;return(0,n.A)(function*(){yield l().call(h,c),yield h.next?.handle(c)})()}};m=(0,a.__decorate)([(0,o.l)({type:"crt.ReplyEmailComposerRequestHandler",requestType:"crt.ReplyEmailComposerRequest"}),(0,a.__metadata)("design:paramtypes",[])],m)},15841:(G,b,e)=>{e.d(b,{Q:()=>Re});var n=e(5960),a=e(40297),s=e(52989),o=e(10067),t=e(71252),y=e(55642),m=e(79772),E=e(5476),c=e(56484),l=e(56711),h=e(80203),A=e(67881),F=e(59131);class M{static{this.\u0275fac=function(K){return new(K||M)}}static{this.\u0275mod=F.\u0275\u0275defineNgModule({type:M})}static{this.\u0275inj=F.\u0275\u0275defineInjector({imports:[a.CommonModule,l.FormsModule,l.ReactiveFormsModule,h.MatLegacySlideToggleModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&F.\u0275\u0275setNgModuleScope(M,{declarations:[A.G],imports:[a.CommonModule,l.FormsModule,l.ReactiveFormsModule,h.MatLegacySlideToggleModule],exports:[A.G]})})();var g=e(18351),V=e(36943),r=e(59969),C=e(31149),f=e(75909),R=e(24091),x=e(57274),D=e(44267),B=e(57463),T=e(83455),I=e(72882),P=e(12841),$=e(24507),Y=e(8346),q=e(82650),re=e(87300),ce=e(30816),d=e(23854),p=e(58551),_=e(30306),u=e(52808),j=e(2126),Q=e(50868),ie=e(21122),pe=e(19484),ue=e(74575),Ee=e(54880),te=e(8610),_e=e(81875),L=e(37552),Z=e(99553),k=e(52162),se=e(13787),ne=e(29373),me=e(83743),Me=e(28307),Ie=e(58298),Oe=e(16111),ge=e(74368),X=e(93338),le=e(26594),i=e(28399);class O{constructor(N){this._featureValues=N,this._selectedChannelAttributeName="SelectedComposerChannelIndex",this._channelsAttributeName="ComposerChannels",this._selectedChannelAttributeDefValue=0,this._channelSelectorItemName="ChannelSelector",this._channelSelectorTypeName="crt.ChannelSelector",this._parentComposerType="crt.MessageComposerSelector",this._metadataSchemaUtils=(0,F.inject)(ge.u)}_getViewConfigs(N,K){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",K,N.viewConfig).map(J=>J?.viewConfig).filter(Boolean)}_createAndBindExtendableComposerAttributes(N,K){K.forEach((J,de)=>{if(!Array.isArray(J.items)||!J.items.length)return;let oe;(0,i.isEmpty)(J.selectedComposerChannelIndex)?(oe=`${this._selectedChannelAttributeName}_${de}`,N[oe]={value:this._selectedChannelAttributeDefValue},J.selectedComposerChannelIndex=`$${oe}`):oe=J.selectedComposerChannelIndex;const ye=`${this._channelsAttributeName}_${de}`,Se=[];J.items.forEach(He=>{this._createChannelSelector(He,oe,ye,Se)}),N[ye]={value:Se}})}_createChannelSelector(N,K,J,de){const oe=N.data;if(!(!oe||(0,i.isEmpty)(oe.schemaType))&&(de.push({visible:N.visible,data:{icon:oe.icon,schemaType:oe.schemaType,caption:oe.caption}}),(0,i.isEmpty)(N.channelsPanel))){const ye={name:`${this._channelSelectorItemName}_${N.name}`,type:this._channelSelectorTypeName,selectedChannelIndex:`$${K}`,channels:`$${J}`};N.channelsPanel=[ye]}}_createAndBindComposerEventAttribute(N,K){K.forEach((J,de)=>{if(!Array.isArray(J.items)||!J.items.length)return;const oe=`${X._}_${de}`;N[oe]={value:[]},J.composerEvent="$"+oe,J.items.forEach(ye=>{ye.composerEvent="$"+oe})})}_createAndBindComposerAttributes(N){const K=this._getViewConfigs(N,this._parentComposerType),J=N.viewModelConfig.attributes;this._createAndBindComposerEventAttribute(J,K),this._featureValues.ExtendableMessageComposer&&this._createAndBindExtendableComposerAttributes(J,K)}crtOnMetaDataInit(N){const K=N;return this._createAndBindComposerAttributes(K),Promise.resolve(N)}static{this.\u0275fac=function(K){return new(K||O)(F.\u0275\u0275inject(le.G))}}static{this.\u0275prov=F.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}}var S=e(73308),U=e(12404);class z{constructor(N){this._selectionActionsMetadataService=N,this._pageSize=150,this._metadataSchemaUtils=(0,F.inject)(ge.u)}_getViewConfigs(N,K){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",K,N.viewConfig).map(J=>J?.viewConfig).filter(Boolean)}_setCrudEventsBindings(N){N.emailComposerSaved={request:"crt.EmailComposerSavedRequest",params:{emailWithParams:"@event"}},N.refreshRecipients={request:"crt.RefreshEmailRecipientsRequest",params:{event:"@event"}}}_setAttributes(N,K){K.from=`$${this._createAttribute(N,`${K.name}_From`,"")}`,K.to=`$${this._createAttribute(N,`${K.name}_To`,[])}`,K.cc=`$${this._createAttribute(N,`${K.name}_Cc`,[])}`,K.bcc=`$${this._createAttribute(N,`${K.name}_Bcc`,[])}`,K.subject=`$${this._createAttribute(N,`${K.name}_Subject`,"")}`,K.headerExpanded=`$${this._createAttribute(N,`${K.name}_HeaderExpanded`,"")}`,K.visibleCc=`$${this._createAttribute(N,`${K.name}_VisibleCc`,"")}`,K.visibleBcc=`$${this._createAttribute(N,`${K.name}_VisibleBcc`,"")}`}_setCalculatedAttributes(N,K){K.sendersMailboxes=`$${this._getOrAddEmailSendersAttribute(N,K,K.recordId)}`,K.recipientsMailboxes=`$${this._getOrAddEmailRecipientsAttribute(N,K,K.recordId)}`}_findCalculatedAttribute(N,K,J){const de=N.viewModelConfig.attributes,oe=Object.keys(de).find(ye=>{const Se=de[ye]??{};return Se.from===K&&Se.converter===J});return(0,i.isEmpty)(oe)?void 0:oe}_createAttribute(N,K,J){const de=N.viewModelConfig.attributes;return de[K]={value:J},K}_createCalculatedAttribute(N,K,J,de){const oe=N.viewModelConfig.attributes;return oe[K]={from:J,converter:de},K}_getOrAddEmailSendersAttribute(N,K,J){return this._findCalculatedAttribute(N,J,"crt.ToSendersMailboxes")||this._createCalculatedAttribute(N,`${K.name}_SendersMailboxes`,J,"crt.ToSendersMailboxes")}_getOrAddEmailRecipientsAttribute(N,K,J){return this._findCalculatedAttribute(N,J,"crt.ToRecipientsMailboxes")||this._createCalculatedAttribute(N,`${K.name}_RecipientsMailboxes`,"crt.RefreshEmailRecipientsRequest","crt.ToRecipientsMailboxes")}crtOnMetaDataInit(N){var K=this;return(0,S.A)(function*(){const J=N,de=K._getViewConfigs(J,"crt.EmailComposer");for(const oe of de)K._setCrudEventsBindings(oe),K._setAttributes(J,oe),K._setCalculatedAttributes(J,oe),yield K._selectionActionsMetadataService.setRewriteOptions(J,oe);return Promise.resolve(N)})()}static{this.\u0275fac=function(K){return new(K||z)(F.\u0275\u0275inject(U.S))}}static{this.\u0275prov=F.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac})}}class v{constructor(N){this._selectionActionsMetadataService=N,this._metadataSchemaUtils=(0,F.inject)(ge.u)}_getViewConfigs(N,K){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",K,N.viewConfig).map(J=>J?.viewConfig).filter(Boolean)}crtOnMetaDataInit(N){var K=this;return(0,S.A)(function*(){const J=N,de=K._getViewConfigs(J,"crt.FeedComposer");for(const oe of de)yield K._selectionActionsMetadataService.setRewriteOptions(J,oe);return Promise.resolve(N)})()}static{this.\u0275fac=function(K){return new(K||v)(F.\u0275\u0275inject(U.S))}}static{this.\u0275prov=F.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac})}}var H=e(86190),W=e(36122),w=e(85688),ee=e(2047),ae=e(55529),Ce=e(59784),he=e(46690),fe=e(43673),ve=e(2023),Pe=e(98488),De=e(79341),be=e(43482),Fe=e(81517),Ve=e(2828);let xe=class extends Fe.S{};xe=(0,n.__decorate)([(0,Ve.$)({type:"crt.CreateEmailRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CreateEmailRequest",propertiesPanelComponentTypeName:"crt.CreateEmailRequestPropertiesPanelComponent"})],xe);function je(){const Ne=[xe]}je();let Re=class Ke{constructor(N,K){this._matIconRegistry=N,this._domSanitizer=K,this._registerIcons()}_registerIcons(){[{name:"reply-message",icon:e(5719)},{name:"reply-all-message",icon:e(90277)},{name:"reply-message",icon:e(5719)}].forEach(({name:K,icon:J})=>{this._matIconRegistry.addSvgIconLiteral(K,this._domSanitizer.bypassSecurityTrustHtml(J))})}static{this.\u0275fac=function(K){return new(K||Ke)(F.\u0275\u0275inject(s.MatIconRegistry),F.\u0275\u0275inject(t.DomSanitizer))}}static{this.\u0275mod=F.\u0275\u0275defineNgModule({type:Ke})}static{this.\u0275inj=F.\u0275\u0275defineInjector({providers:[T.d,H.$,W.I,w.d,ee.W,ae.B,Ce.S,he.y,fe.e,ve.v,Pe.D,I.Z,De.o,be.O,{provide:r.U2,useFactory:N=>new r.Dj(N),deps:[a.DOCUMENT]},{provide:P.m,useClass:O,multi:!0},{provide:P.m,useClass:z,multi:!0},{provide:P.m,useClass:v,multi:!0}],imports:[a.CommonModule,$.P,C.q,E.q,c.S,f.r,R.S,x.u,D.D,M,s.MatIconModule,o.MatSnackBarModule,B.q,g.C,Y.d,m.TranslateModule,V.k]})}};Re=(0,n.__decorate)([(0,y.g)({viewElements:[re.V,ce.n,d.r,p.l,_.E,u.B],requestHandlers:[ue.H,Ee.I,te.F,_e.p,L.x,Z.E,k.T,se.e,ne._,me.C,Me.p,Ie.I,Oe.M],converters:[Q.q,ie.m,pe.K]}),(0,n.__metadata)("design:paramtypes",[s.MatIconRegistry,t.DomSanitizer])],Re),function(){(typeof ngJitMode>"u"||ngJitMode)&&F.\u0275\u0275setNgModuleScope(Re,{declarations:[re.V,ce.n,d.r,j.m,p.l,_.E,u.B],imports:[a.CommonModule,$.P,C.q,E.q,c.S,f.r,R.S,x.u,q.m,D.D,M,s.MatIconModule,o.MatSnackBarModule,B.q,g.C,Y.d,m.TranslateModule,V.k],exports:[re.V,ce.n,d.r,p.l,_.E,u.B]})}()},58909:(G,b,e)=>{e.d(b,{An:()=>t,J3:()=>a,M7:()=>n,Od:()=>s,iQ:()=>o});const n="ReplyEmailEvent",a="EmailSavedEvent",s="BlindZoneWidthEvent",o="ReadyEvent",t="FocusInputEvent"},16296:(G,b,e)=>{e.d(b,{T:()=>n});var n;(function(a){a.Reply="reply",a.ReplyAll="reply-all",a.Forward="forward",a.EditDraft="edit-draft"})(n||(n={}))},36122:(G,b,e)=>{e.d(b,{I:()=>m});var n=e(62278),a=e.n(n),s=e(29957),o=e.n(s),t=e(59131),y=e.n(t);class m{constructor(){this._changeComposer$=new n.Subject}getComposerObservable(){return this._changeComposer$.asObservable()}openComposer(c){s.String.isNullOrWhiteSpace(c)||this._changeComposer$.next(c)}static{this.\u0275fac=function(l){return new(l||m)}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},86190:(G,b,e)=>{e.d(b,{$:()=>m});var n=e(59969),a=e(28399),s=e.n(a),o=e(59131),t=e.n(o),y=e(38071);class m{constructor(c,l){this._doNotUseCache=!1,this._storage=c.localStorage,l.getFeatureState("DoNotCacheComposerData").subscribe(h=>{this._doNotUseCache=h})}remove(c){(0,a.isEmpty)(c)||this._doNotUseCache||this._storage.removeItem(c)}set(c,l){(0,a.isEmpty)(c)||this._doNotUseCache||this._storage.setItem(c,l)}get(c){return(0,a.isEmpty)(c)||this._doNotUseCache?"":this._storage.getItem(c)}static{this.\u0275fac=function(l){return new(l||m)(o.\u0275\u0275inject(n.ZP),o.\u0275\u0275inject(y.wf))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},2023:(G,b,e)=>{e.d(b,{v:()=>m});var n=e(59969),a=e(86190),s=e(59131),o=e.n(s),t=e(85688),y=e(38071);class m extends a.${constructor(c,l,h){super(c,h),this._emailsService=l}set(c,l){const h=this._emailsService.getDraftUserContent(l);super.set(c,h)}static{this.\u0275fac=function(l){return new(l||m)(s.\u0275\u0275inject(n.ZP),s.\u0275\u0275inject(t.d),s.\u0275\u0275inject(y.wf))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},59784:(G,b,e)=>{e.d(b,{S:()=>F});var n=e(28399),a=e.n(n),s=e(62278),o=e.n(s),t=e(36486),y=e.n(t),m=e(29957),E=e.n(m),c=e(59131),l=e.n(c),h=e(56089),A=e(23092);class F{constructor(g,V){this._macrosHelperService=g,this._userInfo=V,this._indentation="<br>",this._signatureTag="<signature>",this._signatureTpl="<signature>{0}</signature>",this._macrosRegex=new RegExp(/\[#(.+?)#\]/)}_replaceSignatureInBody(g,V){return g.includes(this._signatureTag)?g.replace(this._getSignatureRegExp(),V):g.concat(V)}_getSignatureRegExp(){return/((<br.{1,4}>)|(\\r\\n)){0,1}((<br.{1,4}>)|(\\r\\n)){0,1}(<div>){0,1}<signature>[\s\S]*?<\/signature>(<\/div>){0,1}/}_getFormattedSignature(g){const V=g.indexOf(this._signatureTag);return(0,n.isEmpty)(g)||V===-1?m.String.format(`<div>${this._signatureTpl}</div>`,g||""):V===0?m.String.format("<div>{0}</div>",g):g}_processSignature(g,V){const r=this._getFormattedSignature(V);return(0,n.isEmpty)(g)?g=((0,n.isEmpty)(V)?this._indentation:this._indentation.repeat(2)).concat(r):g=this._replaceSignatureInBody(g,r),g}get signatureTpl(){return this._signatureTpl}get signatureTplWithIndent(){return this._indentation.repeat(2).concat(this.signatureTpl)}isBodyContainSignature(g){return!(0,n.isEmpty)(this._getSignatureRegExp().exec(g))}updateSignatureInBody(g,V){if(g=g||"",V=V||"",this._macrosRegex.test(V)){g=this._processSignature(g,m.String.empty);const r={entityId:this._userInfo.contactId,entityName:"Contact",textTemplate:V};return this._macrosHelperService.getTemplateByEntity(r,!0).pipe((0,s.map)(C=>this._processSignature(g,C)),(0,t.catchError)(()=>(0,s.of)(V)))}else return(0,s.of)(this._processSignature(g,V))}static{this.\u0275fac=function(V){return new(V||F)(c.\u0275\u0275inject(h.$),c.\u0275\u0275inject(A.oq))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac})}}},55529:(G,b,e)=>{e.d(b,{B:()=>A});var n=e(41108),a=e(56267),s=e(5704),o=e(58504),t=e(29025),y=e(53163),m=e(62278),E=e.n(m),c=e(59131),l=e.n(c),h=e(56089);class A{constructor(M){this._macrosService=M,this._templatesEntitySchemaName="EmailTemplate",this._lookupPageSchemaName="EmailTemplatesLookupPage"}_handleEmailTextTemplate(M){return`<div>${M}</div>`.replace(new RegExp(/<(\/)?(html|head|body)([^><]*?)>/gim),"")}_getLookupPageFiltersConfig(M){const g="lookupObjectFilter",V=new n.X(a.H.Or),r=new s.x(o.H.Equal,new t.g({columnPath:"[SysSchema:UId:Object].Name"}),new y.J({value:M})),C=new s.x(o.H.Is_null,new t.g({columnPath:"Object"}),new y.J({value:null}));return V.add(r),V.add(C),{filterAttributes:[{name:g,loadOnChange:!1}],attributesConfig:{[g]:{value:V}}}}getTemplatesLookupConfig(M){return{type:"crt.OpenSelectionWindowRequest",$context:{},entitySchemaName:this._templatesEntitySchemaName,schemaName:this._lookupPageSchemaName,features:{create:{enabled:!1},select:{multiple:!1,selectAll:!1}},filtersConfig:this._getLookupPageFiltersConfig(M)}}getMultiLanguageTemplate(M,g,V){return this._macrosService.getMultiLanguageTemplate(V,g,M).pipe((0,m.map)(r=>(r.textTemplate=this._handleEmailTextTemplate(r.textTemplate),r)))}static{this.\u0275fac=function(g){return new(g||A)(c.\u0275\u0275inject(h.$))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:A,factory:A.\u0275fac})}}},85688:(G,b,e)=>{e.d(b,{d:()=>re});var n=e(63721),a=e.n(n),s=e(59131),o=e.n(s),t=e(49973),y=e(58504),m=e(86464),E=e(74709),c=e(43785),l=e(18587),h=e(6530),A=e(79772),F=e.n(A),M=e(65751),g=e(29858),V=e(26628),r=e(48899),C=e(55359),f=e(26594),R=e(28399),x=e.n(R),D=e(62278),B=e.n(D),T=e(36486),I=e.n(T),P=e(29957),$=e.n(P),Y=e(59784),q=e(16296);class re{constructor(d,p){this._injector=d,this._featureValues=p,this._replyBodyLimiter="<div bodylimiter",this._copyEntitiesMethod="/rest/EntityUtilsService/CopyEntities",this._inReplyToActivityHeader="X-In-Reply-To-Activity",this._httpClient=this._injector.get(n.HttpClient),this._queryExecutor=this._injector.get(M.w),this._translateService=this._injector.get(A.TranslateService),this._emailSignatureService=this._injector.get(Y.S),this._fileApiService=this._injector.get(V.k),this._entityConnectionService=this._injector.get(g.r),this._entitySchemaService=this._injector.get(r.e)}_getEmailEsq(d){const p=new t.s("Activity");return p.addSchemaColumn("Sender"),p.addSchemaColumn("Recepient"),p.addSchemaColumn("CopyRecepient"),p.addSchemaColumn("BlindCopyRecepient"),p.addSchemaColumn("Title"),p.addSchemaColumn("Body"),p.addSchemaColumn("SendDate"),p.addSchemaColumn("HeaderProperties"),p.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",d),p}_mapEmail(d){const p={id:d.Id,from:d.Sender,subject:d.Title,body:d.Body,sendDate:d.SendDate,attachments:[]},_=d.Recepient.toString(),u=d.CopyRecepient.toString(),j=d.BlindCopyRecepient.toString(),Q=d.HeaderProperties.toString();return p.to=P.String.isNullOrWhiteSpace(_)?[]:_.split(";").filter(Boolean),p.cc=P.String.isNullOrWhiteSpace(u)?[]:u.split(";").filter(Boolean),p.bcc=P.String.isNullOrWhiteSpace(j)?[]:j.split(";").filter(Boolean),p.headers=P.String.isNullOrWhiteSpace(Q)?[]:Q.split(`
`).filter(Boolean).map(ie=>this._mapHeader(ie)),p}_getAttachmentsEsq(d){const p=new t.s("ActivityFile");return p.addSchemaColumn("Id"),p.addSchemaColumn("Name"),p.addSchemaColumn("Size"),p.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Activity",d),p.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Inline",!1),p}_mapAttachment(d){const p=new File([],d.Name);return{id:d.Id,size:d.Size,file:p,content:new ArrayBuffer(0)}}_prepareRecipient(d){return d.replace("<","&lt;").replace(">","&gt;")}_getBody(d){const p="<span style='font-weight: bold;'>{0}: </span><span>{1}</span><br>",_="<br>{0}><hr style='border:none;border-top: 1px solid #E3E3E3;'>",j="<div><blockquote style='margin-left: 0.8ex;border-left: 1px solid #E3E3E3;padding-left: 1ex;font: inherit;'>{0}</blockquote></div>",Q=this._prepareRecipient(d.from),ie=d.to?this._prepareRecipient(d.to.join(";")):"",pe=d.body,ue=d.body.match(/<body.*?>([\s\S]*)<\/body>/),Ee=ue&&ue[1]||pe,te=new P.StringBuilder;if(te.appendFormat(this._emailSignatureService.signatureTplWithIndent,P.String.empty),te.appendFormat(_,this._replyBodyLimiter),te.appendFormat(p,this._translateService.instant("MessageComposer.Email.From"),Q),te.appendFormat(p,this._translateService.instant("MessageComposer.Email.SentOn"),d.sendDate),te.appendFormat(p,this._translateService.instant("MessageComposer.Email.To"),ie),d.cc?.length!==0){const _e=d.cc?this._prepareRecipient(d.cc.join(";")):"";te.appendFormat(p,this._translateService.instant("MessageComposer.Email.CC"),_e)}return te.appendFormat(p,this._translateService.instant("MessageComposer.Email.Subject"),d.subject),te.appendFormat(j,Ee),te.toString()}_getShortBody(d=!0){const p="<br>{0}>",_='<div><div class="email-composer-reply-expander"></div></div>',u=new P.StringBuilder;return d&&u.appendFormat(this._emailSignatureService.signatureTplWithIndent,P.String.empty),u.appendFormat(p,this._replyBodyLimiter),u.appendFormat(_),u.toString()}_getSubjectPrefix(d){return d===q.T.Forward?"FW: ":"RE: "}_getSubject(d,p){const _=this._getSubjectPrefix(p),u=d.subject;return u.startsWith(_)?u:_+u}_setRecipients(d,p,_){let u=[];const j=p.from;switch(_){case q.T.Reply:u=P.String.isNullOrWhiteSpace(j)?[]:[j];break;case q.T.ReplyAll:{const Q=p.to?p.to:[];u=P.String.isNullOrWhiteSpace(j)?[...Q]:[j,...Q];break}default:break}d.to=u,d.cc=_===q.T.ReplyAll?p.cc:[],d.bcc=[]}_getInsertQuery(d,p){return this._getQueryWithEmailColumns(d,p).pipe((0,T.map)(_=>(_.addColumn("Id",d.id,m.r.Guid),_)))}_getUpdateQuery(d,p){return this._getQueryWithEmailColumns(d,p).pipe((0,T.map)(_=>(_.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",d.id),_)))}_mapHeader(d){const p=d.split("=");return{name:p[0],value:p[1]}}_getHeaderProperties(d,p){const _=d.headers||[];return!(0,R.isEmpty)(p.inReplyToId)&&!_.find(u=>u.name===this._inReplyToActivityHeader)&&_.push({name:this._inReplyToActivityHeader,value:p.inReplyToId}),_.map(u=>`${u.name}=${u.value}`).join(`
`)}_getQueryWithEmailColumns(d,p){const _=d.isDraft?new E.N("Activity"):new c.L("Activity");return _.addColumn("Title",d.subject,m.r.Text),_.addColumn("Body",d.body,m.r.Text),_.addColumn("Sender",d.from,m.r.Text),_.addColumn("Recepient",d.to?.join(";"),m.r.Text),_.addColumn("CopyRecepient",d.cc?.join(";"),m.r.Text),_.addColumn("BlindCopyRecepient",d.bcc?.join(";"),m.r.Text),_.addColumn("Type",C.Iq,m.r.Guid),_.addColumn("ActivityCategory",C.Aw,m.r.Guid),_.addColumn("IsHtmlBody",!0,m.r.Boolean),_.addColumn("HeaderProperties",this._getHeaderProperties(d,p),m.r.Text),this._entitySchemaService.getEntitySchemaByName("Activity").pipe((0,T.switchMap)(u=>this._addDefaultValues(p,_,u.entitySchema.columns)),(0,T.switchMap)(u=>this._addEntityConnectionColumns(p,u)),(0,T.switchMap)(u=>(0,R.isEmpty)(p?.inReplyToId)?(0,D.of)(u):this._copyConnectionColumnsFromParent(p,u)))}_getColumnDataValueType(d){return[m.r.LONG_TEXT,m.r.MAXSIZE_TEXT].includes(d.dataValueType)?m.r.Text:d.dataValueType}_copyConnectionColumnsFromParent(d,p){return this._featureValues.SkipParentEmailConnections?(0,D.of)(p):this._entityConnectionService.getAllEntityConnectionColumns("Activity").pipe((0,T.switchMap)(_=>{if(!_||_.length===0)return(0,D.of)({columns:_,values:null});const u=new t.s("Activity");return _.forEach(j=>{u.addSchemaColumn(j.name)}),u.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",d.inReplyToId),this._queryExecutor.executeSelectQuery(u).pipe((0,T.map)(j=>({columns:_,values:j&&j[0]})))}),(0,T.switchMap)(({columns:_,values:u})=>(_&&u&&_.forEach(j=>{if(!(0,R.isEmpty)(u[j.name])){const Q=this._getColumnDataValueType(j);p.addColumn(j.name,u[j.name],Q)}}),(0,D.of)(p))))}_addEntityConnectionColumns(d,p){return(0,R.isEmpty)(d?.masterSchemaName)||(0,R.isEmpty)(d?.masterRecordId)?(0,D.of)(p):(0,D.from)(this._entityConnectionService.getEntityConnectionColumns("Activity",d?.masterSchemaName)).pipe((0,T.switchMap)(_=>(_&&_.forEach(u=>{const j=this._getColumnDataValueType(u);p.addColumn(u.name,d.masterRecordId,j)}),(0,D.of)(p))))}_addDefaultValues(d,p,_){const u=d.defaultValues;return u&&u.forEach(j=>{const Q=_.find(ie=>ie.name===j.attributeName);if(Q){const ie=this._getColumnDataValueType(Q);p.addColumn(j.attributeName,j.value,ie)}}),(0,D.of)(p)}_executeQuery(d,p){return d.isDraft?this._getUpdateQuery(d,p).pipe((0,T.switchMap)(_=>this._queryExecutor.executeUpdateQuery(_))):this._getInsertQuery(d,p).pipe((0,T.switchMap)(_=>this._queryExecutor.executeInsertQuery(_)))}_trimStart(d,p){return d.startsWith(p)?d.slice(p.length):d}_trimEnd(d,p){return d.endsWith(p)?d.slice(0,d.length-p.length):d}_trimBrTag(d){let p=this._trimStart(d,"&nbsp;");return p=this._trimEnd(p,"<br>"),p}_deleteRemovedAttachments(d){const p=new l.x("ActivityFile");return p.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Activity",d.id),p.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Inline",!1),d.attachments.forEach(u=>p.filters.addSchemaColumnFilterWithParameter(y.H.Not_equal,"Id",u.id)),this._queryExecutor.executeDeleteQuery(p)}getEmail(d,p){const _=this._getEmailEsq(d),u=this._queryExecutor.executeSelectQuery(_).pipe((0,T.map)(Q=>this._mapEmail(Q[0]))),j=p?this.getAttachments(d):(0,D.of)([]);return(0,D.forkJoin)([u,j]).pipe((0,T.map)(Q=>{const ie=Q[0];return ie.attachments=Q[1],ie}))}getAttachments(d){const p=this._getAttachmentsEsq(d);return this._queryExecutor.executeSelectQuery(p).pipe((0,T.map)(_=>_.map(u=>this._mapAttachment(u))))}getReplyDraft(d,p){const _={id:(0,h.qv)(),from:"",subject:this._getSubject(d,p),body:this._getBody(d),bodyShort:this._getShortBody(),isDraft:!1,attachments:p===q.T.Forward&&d.attachments?[...d.attachments]:[]};return this._setRecipients(_,d,p),(0,D.of)(_)}getSafeUserContentReplyBody(d,p){const _=this.getDraftUserContent(d),u=this.getDraftUserContent(p);return p.replace(u,_)}getDraftUserContent(d,p=!1){const _=d.indexOf(this._replyBodyLimiter);return _!==-1&&(d=this._trimBrTag(d.substring(0,_))),p?d+this._getShortBody(!1):d}saveEmail(d,p){return this._executeQuery(d,p).pipe((0,T.concatMap)(_=>{if(!_.success)throw new Error(_.errorInfo?.message);let u=d.attachments;return u?(u=u.filter(j=>j.content.byteLength>0),u.length===0?(0,D.of)([_]):(0,D.from)(u).pipe((0,T.concatMap)(j=>this._fileApiService.upload(j)),(0,T.last)())):(0,D.of)([_])}),(0,T.concatMap)(_=>{if(!_[0].success)throw new Error(_[0].errorInfo?.message);if(d.isDraft)return this._deleteRemovedAttachments(d).pipe((0,T.switchMap)(()=>(0,D.of)([_])),(0,D.catchError)(()=>(0,D.of)([_])));if(d.attachments.filter(Q=>Q.content.byteLength===0).length===0)return(0,D.of)([_]);const j={sourceEntityId:p?.inReplyToId,recipientEntityId:d.id,columnName:"Activity",entitySchemaName:"Activity",sourceEntitySchemaNames:["ActivityFile"],isOnlyInline:!0,inlineIds:d.attachments.filter(Q=>Q.content.byteLength===0).map(Q=>Q.id)};return this._httpClient.post(this._copyEntitiesMethod,j)}),(0,T.switchMap)(_=>{if(_.CopyEntitiesResult&&_.CopyEntitiesResult.length===0)throw new Error(_.errorInfo?.message);return(0,D.of)({success:!0,activityId:d.id})}),(0,D.catchError)(_=>(0,D.of)({success:!1,errorInfo:{errorCode:null,message:_.message,stackTrace:""},activityId:d.id})))}static{this.\u0275fac=function(p){return new(p||re)(s.\u0275\u0275inject(s.Injector),s.\u0275\u0275inject(f.G))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac})}}},79341:(G,b,e)=>{e.d(b,{o:()=>c});var n=e(63721),a=e.n(n),s=e(43482),o=e(59131),t=e.n(o),y=e(81923),m=e(38071),E=e(95145);class c{constructor(h,A,F,M){this._httpClient=h,this._entitySchemaRepository=A,this._featureService=F,this._sysSettingsService=M}getInstance(h,A,F){return new s.O(this._httpClient,this._entitySchemaRepository,h,A,this._featureService,this._sysSettingsService,F)}static{this.\u0275fac=function(A){return new(A||c)(o.\u0275\u0275inject(n.HttpClient),o.\u0275\u0275inject(y.v),o.\u0275\u0275inject(m.wf),o.\u0275\u0275inject(E.A))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:c,factory:c.\u0275fac})}}},43482:(G,b,e)=>{e.d(b,{O:()=>g});var n=e(63721),a=e.n(n),s=e(58504),o=e(6530),t=e(28399),y=e.n(t),m=e(62278),E=e.n(m),c=e(36486),l=e.n(c),h=e(29957),A=e.n(h),F=e(59131),M=e.n(F);class g{constructor(r,C,f,R,x,D,B){this._httpClient=r,this._entitySchemaRepository=C,this._entityId=f,this._entitySchemaName=R,this._featureService=x,this._sysSettingsService=D,this._entitySchemaUId=B,this._getContactsFromDbMethod="/rest/ESNFeedModuleService/GetContactsForMention",this._getContactsFromEsMethod="/rest/ESNFeedModuleService/GetESContactsForMention",this._searchPageSize=15,this._useGlobalSearch=!1,this._featureService.getFeaturesState(["GlobalSearch_V2","ESMention","UseContactMentionFilterComparisonTypeForContactMention"]).subscribe(T=>{const I=T?.slice(0,2),P=T&&T[2];this._useGlobalSearch=I?.length===2&&!I.includes(!1),P&&(this._comparisonType=s.H.Contain)})}_getSchemaUId(){return this._entitySchemaUId&&!(0,o.gZ)(this._entitySchemaUId)?(0,m.of)(this._entitySchemaUId):this._entitySchemaRepository.getSchemaByName(this._entitySchemaName).pipe((0,c.map)(r=>r.uId))}_mapContactsResponse(r){return r.result.map(C=>({value:C.value,displayValue:C.displayValue,primaryImageValue:C.primaryImage,connectionType:C.connectionType}))}_getComparisonType(){return this._comparisonType?(0,m.of)(this._comparisonType):this._sysSettingsService.getByCode("StringColumnSearchComparisonType").pipe((0,c.map)(r=>r?.value===1?s.H.Contain:s.H.Start_with),(0,c.map)(r=>(this._comparisonType=r,r)))}_getMentionsFromDb(r){return(0,m.forkJoin)([this._getSchemaUId(),this._getComparisonType()]).pipe((0,c.switchMap)(([C,f])=>this._httpClient.post(this._getContactsFromDbMethod,{entityId:this._entityId,entitySchemaUId:C,searchName:r,searchType:f}).pipe((0,c.map)(R=>this._mapContactsResponse(R)))))}_getMentionsFromGlobalSearch(r){if((0,t.isEmpty)(r))return(0,m.of)([]);const C=(r||h.String.empty).trim().split(" ").map(f=>f.trim());return this._httpClient.post(this._getContactsFromEsMethod,{query:C,rowsOffset:0,rowCount:this._searchPageSize}).pipe((0,c.map)(f=>this._mapContactsResponse(f)))}getContacts(r){return this._useGlobalSearch?this._getMentionsFromGlobalSearch(r):this._getMentionsFromDb(r)}static{this.\u0275fac=function(C){F.\u0275\u0275invalidFactory()}}static{this.\u0275prov=F.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac})}}},98488:(G,b,e)=>{e.d(b,{D:()=>g});var n=e(63721),a=e.n(n),s=e(6530),o=e(28399),t=e.n(o),y=e(62278),m=e.n(y),E=e(36486),c=e.n(E),l=e(59131),h=e.n(l),A=e(81923),F=e(72882),M=e(26628);class g{constructor(r,C,f,R){this._httpClient=r,this._entitySchemaRepository=C,this._feedNotificationService=f,this._fileApiService=R,this._postMessageMethod="/rest/EsnService/PostMessage",this._editMessageMethod="/rest/EsnService/EditMessage",this._postCommentMethod="/rest/EsnService/PostComment",this._editCommentMethod="/rest/EsnService/EditComment",this._readAttachmentsMethod="/rest/EsnService/ReadAttachments",this._deleteAttachmentsMethod="/rest/EsnService/DeleteAttachments"}_getSchemaUId(r){return this._entitySchemaRepository.getSchemaByName(r).pipe((0,E.map)(C=>C.uId))}_postMessage(r,C){return this._httpClient.post(r,C).pipe((0,E.map)(f=>f.Id))}_modifyMessage(r,C){return this._httpClient.post(r,C).pipe((0,E.map)(f=>f.success))}_uploadAttachments(r){const C=r.filter(f=>f.content.byteLength>0);return C.length===0?(0,y.of)(!0):(C.forEach(f=>{f.fileEntitySchemaName="FeedFile"}),(0,y.from)(C).pipe((0,E.concatMap)(f=>this._fileApiService.upload(f)),(0,E.last)(),(0,E.map)(()=>!0)))}_deleteAttachments(r,C,f,R){return this._httpClient.post(this._deleteAttachmentsMethod,{messageId:r,attachmentsToKeepIds:C,schemaUId:f,entityId:R})}_getAttachmentIds(r){const C=new RegExp(/FileService\/Download\/FeedFile\/(.+?)"/gi);return[...r.Message.matchAll(C)].map(R=>R[1]).concat(r.Attachments?.map(R=>R.id))}_updateMessageAttachments(r,C){const f=C?r.Id:s.To;return((0,o.isEmpty)(r.Attachments)?(0,y.of)(!0):this._uploadAttachments(r.Attachments)).pipe((0,E.concatMap)(()=>{const x=this._getAttachmentIds(r);return this._deleteAttachments(r.Id,x,r.EntitySchemaUId,r.EntityId)}),(0,E.map)(()=>f))}updateMessage(r){return this._modifyMessage(this._editMessageMethod,{messageId:r.Id,message:{Id:r.Id,SchemaUId:r.EntitySchemaUId,EntityId:r.EntityId,Message:r.Message,UserAccess:r.UserAccess}}).pipe((0,E.switchMap)(C=>this._updateMessageAttachments(r,C)))}updateChildMessage(r){return this._modifyMessage(this._editCommentMethod,{commentId:r.Id,comment:{Id:r.Id,SchemaUId:r.EntitySchemaUId,EntityId:r.EntityId,Message:r.Message,UserAccess:r.UserAccess}}).pipe((0,E.switchMap)(C=>this._updateMessageAttachments(r,C)))}postMessage(r){return this._getSchemaUId(r.EntitySchemaName).pipe((0,E.switchMap)(C=>this._postMessage(this._postMessageMethod,{message:{Id:r.Id,SchemaUId:C,EntityId:r.EntityId,Message:r.Message,UserAccess:r.UserAccess}})),(0,E.concatMap)(C=>(0,o.isEmpty)(r.Attachments)?(0,y.of)(C):this._uploadAttachments(r.Attachments).pipe((0,E.map)(()=>C))),(0,E.map)(C=>(this._feedNotificationService.onFeedPostPublished(C,r.EntityId),C)))}postChildMessage(r,C){return this._postMessage(this._postCommentMethod,{messageId:C,comment:{Id:r.Id,SchemaUId:r.EntitySchemaUId,EntityId:r.EntityId,Message:r.Message,UserAccess:r.UserAccess}}).pipe((0,E.concatMap)(f=>(0,o.isEmpty)(r.Attachments)?(0,y.of)(f):this._uploadAttachments(r.Attachments).pipe((0,E.map)(()=>f))))}loadAttachments(r,C,f,R,x){const D=R||"FeedFile",B=x||"RecordId";return this._httpClient.post(this._readAttachmentsMethod,{messageId:r,schemaUId:C,entityId:f,schemaName:D,columnName:B}).pipe((0,E.map)(T=>T.files.map(I=>({fileId:I.Id,fileName:I.Name,fileSize:I.Size,fileCreatedOn:I.CreatedOn,getBoundDataSchemaByAttributePath:function(){return{name:D}}}))))}static{this.\u0275fac=function(C){return new(C||g)(l.\u0275\u0275inject(n.HttpClient),l.\u0275\u0275inject(A.v),l.\u0275\u0275inject(F.Z),l.\u0275\u0275inject(M.k))}}static{this.\u0275prov=l.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac})}}},2047:(G,b,e)=>{e.d(b,{W:()=>r});var n=e(63721),a=e.n(n),s=e(49973),o=e(41108),t=e(56267),y=e(58504),m=e(6530),E=e(28399),c=e.n(E),l=e(62278),h=e.n(l),A=e(36486),F=e.n(A),M=e(59131),g=e.n(M),V=e(65751);class r{constructor(f,R){this._queryExecutor=f,this._httpClient=R,this._getCaseSenderMethod="/rest/SenderObtainingService/ObtainSenderMailbox"}_getMailboxesEsq(f){const R=new s.s("MailboxSyncSettings");R.addSchemaColumn("SenderEmailAddress"),R.addSchemaColumn("SenderDisplayValue"),R.addSchemaColumn("Signature"),R.addSchemaColumn("UseSignature"),R.addSchemaColumn("CreatedBy");const x=new o.X(t.H.Or);return x.addSchemaColumnFilterWithParameter(y.H.Equal,"SysAdminUnit",f),x.addSchemaColumnFilterWithParameter(y.H.Equal,"IsShared",!0),R.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"SendEmailsViaThisAccount",!0),R.filters.add(x),R}_getCaseParamsEsq(f){const R=new s.s("Case");return R.addSchemaColumn("ParentActivity.Recepient","To"),R.addSchemaColumn("ParentActivity.CopyRecepient","CC"),R.addSchemaColumn("ParentActivity.BlindCopyRecepient","BCC"),R.addSchemaColumn("Contact"),R.addSchemaColumn("Category"),R.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",f),R}_mapMailbox(f){return{id:f.Id,senderEmailAddress:f.SenderEmailAddress,senderDisplayValue:f.SenderDisplayValue,signature:f.Signature,useSignature:f.UseSignature,createdBy:f.CreatedBy}}_mapGetSenderRequestConfig(f){const R=[f.To,f.CC,f.BCC].filter(x=>!(0,E.isEmpty)(x));return{recipients:R.length>0?R.join(";"):"",contactId:f.Contact?f.Contact.value:null,categoryId:f.Category?f.Category.value:null}}_mapCaseSenderMailbox(f){return!f||!f.ObtainSenderMailboxResult||(0,E.isEmpty)(f.ObtainSenderMailboxResult.MailboxName)?null:{id:(0,m.qv)(),senderEmailAddress:f.ObtainSenderMailboxResult.MailboxName,useSignature:!1}}getMailboxesForSend(f){const R=this._getMailboxesEsq(f);return this._queryExecutor.executeSelectQuery(R).pipe((0,A.map)(x=>x?.map(D=>this._mapMailbox(D))))}getDefaultMailboxForSend(f){const R=this._getMailboxesEsq(f);return R.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"IsDefault",!0),this._queryExecutor.executeSelectQuery(R).pipe((0,A.map)(x=>x?.map(D=>this._mapMailbox(D))),(0,A.switchMap)(x=>(0,l.of)(x[0])))}getCaseDefaultMailbox(f){const R=this._getCaseParamsEsq(f);return this._queryExecutor.executeSelectQuery(R).pipe((0,A.map)(x=>(0,E.isEmpty)(x)?null:this._mapGetSenderRequestConfig(x[0])),(0,A.concatMap)(x=>(0,E.isEmpty)(x)?(0,l.of)(null):this._httpClient.post(this._getCaseSenderMethod,x)),(0,A.switchMap)(x=>(0,l.of)(this._mapCaseSenderMailbox(x))))}static{this.\u0275fac=function(R){return new(R||r)(M.\u0275\u0275inject(V.w),M.\u0275\u0275inject(n.HttpClient))}}static{this.\u0275prov=M.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}},43673:(G,b,e)=>{e.d(b,{e:()=>R});var n=e(63721),a=e.n(n),s=e(49973),o=e(61320),t=e(41108),y=e(56267),m=e(58504),E=e(6530),c=e(59969),l=e(26594),h=e(28399),A=e.n(h),F=e(36486),M=e.n(F),g=e(29957),V=e.n(g),r=e(59131),C=e.n(r),f=e(65751);class R{constructor(D,B,T){this._queryExecutor=D,this._httpClient=B,this._globalSearchFeatureCode="GlobalSearch_V2",this._esEmailsSearchFeatureCode="IsESEmailsSearch",this._sendInitialQueryToGsFeatureCode="SendInitialQueryToGS",this._globalSearchMethodName="/rest/ESEmailService/SearchEmailsPage",this._itemsPerPage=15,this._useGlobalSearch=!1,this._sendInitialQueryToGs=!1,this._useGlobalSearch=T[this._globalSearchFeatureCode]&&T[this._esEmailsSearchFeatureCode],this._sendInitialQueryToGs=T[this._sendInitialQueryToGsFeatureCode]}_getRecipientsEsq(D,B){const T=new s.s("VwRecepientEmail"),I=T.addSchemaColumn("Email");I.orderDirection=o.Z.Asc,T.rowCount=this._itemsPerPage,T.rowsOffset=B;const P=new t.X(y.H.Or);return P.addSchemaColumnFilterWithParameter(m.H.Contain,"Email",D),P.addSchemaColumnFilterWithParameter(m.H.Contain,"ContactName",D),T.filters.add(P),T}_mapRecipient(D){return{value:(0,E.qv)(),displayValue:D}}_getRecipientsFromGlobalSearch(D,B){const T=(D||g.String.empty).trim(),I=T.split(" ").map(P=>P.trim());return this._sendInitialQueryToGs&&T&&I.push(T),this._httpClient.post(this._globalSearchMethodName,{query:I,rowsOffset:B,rowCount:this._itemsPerPage}).pipe((0,F.map)(P=>{const $=JSON.parse(P?.SearchEmailsResult||"[]")||[],Y=[];return $.forEach(function(q){const re={emails:[]};Object.keys(q).forEach(function(ce){const d=q[ce];(0,c.m2)(d)&&re.emails.push(this._mapRecipient(d))},this),re.emails.length>0&&Y.push(re)},this),Y}))}_getRecipientsFromDb(D,B){const T=this._getRecipientsEsq(D,B);return this._queryExecutor.executeSelectQuery(T).pipe((0,F.map)(I=>I?.map(P=>({emails:[this._mapRecipient(P.Email)]}))))}getRecipients(D,B=0){return this._useGlobalSearch&&!(0,h.isEmpty)(D)?this._getRecipientsFromGlobalSearch(D,B):this._getRecipientsFromDb(D,B)}static{this.\u0275fac=function(B){return new(B||R)(r.\u0275\u0275inject(f.w),r.\u0275\u0275inject(n.HttpClient),r.\u0275\u0275inject(l.G))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac})}}},46690:(G,b,e)=>{e.d(b,{y:()=>c});var n=e(63721),a=e.n(n),s=e(62278),o=e.n(s),t=e(36486),y=e.n(t),m=e(59131),E=e.n(m);class c{constructor(h){this._httpClient=h,this._publishMessageMethod="/rest/EmailSendService/Send"}_mapSendResult(h){const A=h.SendResult[0].ErrorMessage,F={success:A===""};return F.success||(F.errorInfo={message:A,errorCode:"",stackTrace:""}),F}publishMessage(h){return this._httpClient.post(this._publishMessageMethod,{ActivityId:h})}sendEmail(h){return this.publishMessage(h).pipe((0,t.switchMap)(A=>(0,s.of)(this._mapSendResult(A))),(0,s.catchError)(A=>(0,s.of)({success:!1,errorInfo:{errorCode:null,message:A.message,stackTrace:""}})))}static{this.\u0275fac=function(A){return new(A||c)(m.\u0275\u0275inject(n.HttpClient))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:c,factory:c.\u0275fac})}}},55359:(G,b,e)=>{e.d(b,{Aw:()=>m,Iq:()=>s,er:()=>y,zY:()=>o});const n="C449D832-A4CC-4B01-B9D5-8A12C42A9F89",a="Activity",s="E2831DEC-CFC0-DF11-B00F-001D60E938C6",o="fbe0acdc-cfc0-df11-b00f-001d60e938c6",t="42c74c49-58e6-df11-971b-001d60e938c6",y="f51c4643-58e6-df11-971b-001d60e938c6",m="8038A396-7825-E011-8165-00155D043204"},93338:(G,b,e)=>{e.d(b,{_:()=>n});const n="ComposerEvent"},82650:(G,b,e)=>{e.d(b,{m:()=>t});var n=e(23493),a=e.n(n),s=e(59131),o=e.n(s);class t{transform(m){return(0,n.encode)(m)}static{this.\u0275fac=function(E){return new(E||t)}}static{this.\u0275pipe=s.\u0275\u0275definePipe({name:"encodeHtml",type:t,pure:!0,standalone:!0})}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}},72882:(G,b,e)=>{e.d(b,{Z:()=>E});var n=e(59131),a=e.n(n),s=e(62278),o=e.n(s),t=e(91065),y=e(5240),m=e(23092);class E{constructor(l,h){this._messageChannelService=l,this._userInfo=h,this._subscriptions=[],this.newMessageEvent=new n.EventEmitter,this.feedPostPublishedEvent=new n.EventEmitter,this._subscribeMessageChannelEvents()}_subscribeMessageChannelEvents(){this._subscriptions.push(this._messageChannelService.messageEvent$.pipe((0,s.filter)(l=>l.header.sender==="UpdateSocialMessage"),(0,s.map)(l=>{const h=l.body;return{MessageId:l.id.toString(),AuthorId:h.sysAdminUnitId,Operation:h.operation,EntityId:h.channelId,ParentId:h.parentId,EntityName:h.entityName}})).subscribe(l=>this.newMessageEvent.emit(l)))}onFeedPostPublished(l,h){const A={MessageId:l,Operation:t.x.Insert,EntityId:h};this.feedPostPublishedEvent.emit(A)}ngOnDestroy(){this._subscriptions.forEach(l=>l?.unsubscribe())}static{this.\u0275fac=function(h){return new(h||E)(n.\u0275\u0275inject(y.A),n.\u0275\u0275inject(m.oq))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac})}}},91065:(G,b,e)=>{e.d(b,{x:()=>n});var n;(function(a){a.Insert="insert",a.Update="update",a.Delete="delete",a.ForceUpdate="forceUpdate"})(n||(n={}))},62127:G=>{G.exports=`<svg width="73" height="64" viewBox="0 0 73 64" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.6128 25.1749H18.6128C16.9559 25.1749 15.6128 26.5181 15.6128 28.1749C15.6128 29.8318 16.9559 31.1749 18.6128 31.1749H39.6128C41.2696 31.1749 42.6128 29.8318 42.6128 28.1749C42.6128 26.5181 41.2696 25.1749 39.6128 25.1749Z" fill="#D1D1D1"/>
<path d="M53.6128 35.1749H18.6128C16.9559 35.1749 15.6128 36.5181 15.6128 38.1749C15.6128 39.8318 16.9559 41.1749 18.6128 41.1749H53.6128C55.2696 41.1749 56.6128 39.8318 56.6128 38.1749C56.6128 36.5181 55.2696 35.1749 53.6128 35.1749Z" fill="#D1D1D1"/>
<path d="M53.998 27.454V30.9513C53.998 31.1514 54.2593 31.2275 54.3667 31.0587L56.0831 28.3619L53.998 27.454Z" fill="#004FD6"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M61.9104 17.6219C61.9908 16.803 61.103 16.2429 60.3985 16.6681L48.9928 23.5514C48.2977 23.9709 48.3658 25.0001 49.1101 25.3243L52.1202 26.6359L58.0677 21.0965C58.2443 20.932 58.5071 21.1632 58.3665 21.3593L53.998 27.454L56.0831 28.3619L59.3996 29.8074C60.022 30.0787 60.7281 29.6641 60.7944 28.9884L61.9104 17.6219Z" fill="#004FD6"/>
<path d="M46.834 17.1179H11.25C9.59315 17.1179 8.25 18.4611 8.25 20.1179V46.2319C8.25 47.8888 9.59314 49.2319 11.25 49.2319H61.25C62.9069 49.2319 64.25 47.8888 64.25 46.2319V36.1749" stroke="#70ACEE" stroke-linecap="round"/>
</svg>
`},90277:G=>{G.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M5.41003 9.7832L2.41003 6.7832L5.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
	<path d="M8.41003 9.7832L5.41003 6.7832L8.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
	<path d="M14.41 12.7832C14.41 11.1919 13.7779 9.66578 12.6527 8.54056C11.5275 7.41534 10.0013 6.7832 8.41003 6.7832H5.41003" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},5719:G=>{G.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M5.41003 9.7832L2.41003 6.7832L5.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
	<path d="M14.41 12.7832C14.41 11.1919 13.7779 9.66578 12.6527 8.54056C11.5275 7.41534 10.0013 6.7832 8.41003 6.7832H2.41003" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`}}]);
