(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[7253],{37253:(g,G,o)=>{o.r(G),o.d(G,{APPROVAL_WSMESSAGE_SERVICE_TOKEN:()=>Y,ApprovalActionService:()=>R,ApprovalConfirmationService:()=>w,ApprovalLoadDataService:()=>b,ApprovalSchemaService:()=>O,ApprovalWSMessageService:()=>j,CrtApprovalCommentDialogComponent:()=>I,CrtApprovalComponent:()=>v,CrtApprovalListComponent:()=>y,CrtApprovalModule:()=>U});var i=o(5960),x=o(13053),t=o(59131),h=o(77592),k=o(34760),ut=o(3671),ht=o(52793),ft=o(10098),M=o(79772),At=o(68712),A;(function(s){s.Positive="e79facb3-3c32-43e7-a59e-12ba125e6132",s.Canceled="9120fdef-69be-4168-b5f3-517714b7a4e9",s.Negative="a93ab0b9-ca36-4b95-9b23-e01aa169c338",s.ToSet="3462594d-77a7-4b0a-874a-6d8b54b293bc"})(A||(A={}));var _=o(52335),Ct=o(28399),l=o(62278),Bt=o(5240),Q=o(36486);const Y=new t.InjectionToken("Manually created service",{providedIn:"any",factory:()=>new j((0,t.inject)(t.Injector))});class j{constructor(e){this._injector=e,this._destroyed$=new l.Subject,this.messageEvent$=new l.Subject,this._messageChannelService=e.get(Bt.A)}_isUpdateRemindingMessage(e,a){return e.header?.sender==="UpdateReminding"&&e.body?.referenceEntityId===a}_isNotificationInfoMessage(e,a){return e.header?.sender==="NotificationInfo"&&e.body?.Notifications?.find(n=>n?.GroupName==="Visa"&&n?.EntityId===a)}subscribeOnNotificationMessage(e){this._subscription&&this._subscription.unsubscribe(),this._subscription=this._messageChannelService.messageEvent$.pipe((0,l.filter)(a=>this._isUpdateRemindingMessage(a,e)||this._isNotificationInfoMessage(a,e)),(0,Q.takeUntil)(this._destroyed$)).subscribe(a=>{this.messageEvent$.next({message:a,recordId:e})})}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.messageEvent$.complete()}static{this.\u0275fac=function(a){return new(a||j)(t.\u0275\u0275inject(t.Injector))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac,providedIn:"root"})}}var D=o(40297),_t=o(62115),yt=o(58433),bt=o(12325),$=o(52989);const Ht=["approvalWidgetContainer"],Ft=["*"],Gt=s=>({rtl:s}),Wt=(s,e)=>({"label-fade-in":s,"label-fade-out":e});function Ut(s,e){if(s&1&&t.\u0275\u0275element(0,"crt-skeleton-loader",4),s&2){const a=t.\u0275\u0275nextContext();t.\u0275\u0275property("styles",a.skeletonStyles)}}function zt(s,e){s&1&&(t.\u0275\u0275elementStart(0,"div",26),t.\u0275\u0275element(1,"crt-label",27),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275elementEnd()),s&2&&(t.\u0275\u0275advance(),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(2,1,"Approvals.ApprovalPurposeLabel")))}function Jt(s,e){if(s&1){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",33),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(a);const r=t.\u0275\u0275nextContext(4);return t.\u0275\u0275resetView(r.onApproveClick())}),t.\u0275\u0275elementEnd()}s&2&&t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,2,"Approvals.ApproveButtonLabel"))("ariaLabel",t.\u0275\u0275pipeBind1(2,4,"Approvals.ApproveButtonLabel"))}function Xt(s,e){if(s&1){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",34),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(a);const r=t.\u0275\u0275nextContext(4);return t.\u0275\u0275resetView(r.onRejectClick())}),t.\u0275\u0275elementEnd()}s&2&&t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,2,"Approvals.RejectButtonLabel"))("ariaLabel",t.\u0275\u0275pipeBind1(2,4,"Approvals.RejectButtonLabel"))}function Kt(s,e){if(s&1&&(t.\u0275\u0275elementStart(0,"div",28)(1,"div",29)(2,"div"),t.\u0275\u0275template(3,Jt,3,6,"crt-button",30)(4,Xt,3,6,"crt-button",31),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(5,"div",32),t.\u0275\u0275projection(6),t.\u0275\u0275elementEnd()()),s&2){const a=t.\u0275\u0275nextContext(3);t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",a.isActive),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",a.isActive)}}function Qt(s,e){s&1&&(t.\u0275\u0275elementStart(0,"div",35),t.\u0275\u0275element(1,"mat-icon",36)(2,"crt-label",37),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275pipe(4,"translate"),t.\u0275\u0275elementEnd()),s&2&&(t.\u0275\u0275advance(2),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(3,2,"Approvals.ApprovedPlaceholderLabel")),t.\u0275\u0275attribute("title",t.\u0275\u0275pipeBind1(4,4,"Approvals.ApprovedPlaceholderLabel")))}function Yt(s,e){s&1&&(t.\u0275\u0275elementStart(0,"div",38),t.\u0275\u0275element(1,"mat-icon",22)(2,"crt-label",39),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275pipe(4,"translate"),t.\u0275\u0275elementEnd()),s&2&&(t.\u0275\u0275advance(2),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(3,2,"Approvals.RejectedPlaceholderLabel")),t.\u0275\u0275attribute("title",t.\u0275\u0275pipeBind1(4,4,"Approvals.RejectedPlaceholderLabel")))}function Zt(s,e){if(s&1&&(t.\u0275\u0275elementStart(0,"div",7)(1,"div",8),t.\u0275\u0275element(2,"crt-label",9),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(4,zt,3,3,"div",10),t.\u0275\u0275elementStart(5,"div",11),t.\u0275\u0275element(6,"crt-label",12),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(7,Kt,7,2,"div",13)(8,Qt,5,6,"div",14)(9,Yt,5,6,"div",15),t.\u0275\u0275elementStart(10,"div",16)(11,"div",17),t.\u0275\u0275pipe(12,"translate"),t.\u0275\u0275element(13,"crt-label",18),t.\u0275\u0275pipe(14,"translate"),t.\u0275\u0275pipe(15,"translate"),t.\u0275\u0275elementStart(16,"div",19),t.\u0275\u0275element(17,"mat-icon",20)(18,"crt-label",21),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(19,"div",17),t.\u0275\u0275pipe(20,"translate"),t.\u0275\u0275element(21,"crt-label",18),t.\u0275\u0275pipe(22,"translate"),t.\u0275\u0275pipe(23,"translate"),t.\u0275\u0275elementStart(24,"div",19),t.\u0275\u0275element(25,"mat-icon",22)(26,"crt-label",23),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(27,"div",17),t.\u0275\u0275pipe(28,"translate"),t.\u0275\u0275element(29,"crt-label",18),t.\u0275\u0275pipe(30,"translate"),t.\u0275\u0275pipe(31,"translate"),t.\u0275\u0275elementStart(32,"div",19),t.\u0275\u0275element(33,"mat-icon",24)(34,"crt-label",25),t.\u0275\u0275elementEnd()()()()),s&2){const a=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(2),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(3,23,"Approvals.ComponentHeaderLabel")),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",a.isActive||a.approved||a.rejected),t.\u0275\u0275advance(2),t.\u0275\u0275property("caption",a.objective)("ngClass",t.\u0275\u0275pureFunction2(43,Wt,a.fadeIn,!a.fadeIn)),t.\u0275\u0275attribute("title",a.objective),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",a.isActive),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",!a.isActive&&a.approved),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",!a.isActive&&a.rejected),t.\u0275\u0275advance(2),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(12,25,"Approvals.PositiveMetricLabel")+a.positiveCount),t.\u0275\u0275advance(2),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(14,27,"Approvals.PositiveMetricLabel")),t.\u0275\u0275attribute("title",t.\u0275\u0275pipeBind1(15,29,"Approvals.PositiveMetricLabel")),t.\u0275\u0275advance(5),t.\u0275\u0275property("caption",a.positiveCount===0?"0":a.positiveCount),t.\u0275\u0275attribute("title",a.positiveCount),t.\u0275\u0275advance(),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(20,31,"Approvals.NegativeMetricLabel")+a.negativeCount),t.\u0275\u0275advance(2),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(22,33,"Approvals.NegativeMetricLabel")),t.\u0275\u0275attribute("title",t.\u0275\u0275pipeBind1(23,35,"Approvals.NegativeMetricLabel")),t.\u0275\u0275advance(5),t.\u0275\u0275property("caption",a.negativeCount===0?"0":a.negativeCount),t.\u0275\u0275attribute("title",a.negativeCount),t.\u0275\u0275advance(),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(28,37,"Approvals.PendingMetricLabel")+a.pendingCount),t.\u0275\u0275advance(2),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(30,39,"Approvals.PendingMetricLabel")),t.\u0275\u0275attribute("title",t.\u0275\u0275pipeBind1(31,41,"Approvals.PendingMetricLabel")),t.\u0275\u0275advance(5),t.\u0275\u0275property("caption",a.pendingCount<=0?"-":a.pendingCount),t.\u0275\u0275attribute("title",a.pendingCount)}}function qt(s,e){if(s&1&&(t.\u0275\u0275elementStart(0,"div",5),t.\u0275\u0275template(1,Zt,35,46,"div",6),t.\u0275\u0275elementEnd()),s&2){const a=t.\u0275\u0275nextContext();t.\u0275\u0275styleProp("background-color",a.activeColor),t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction1(4,Gt,a.isRtl())),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",a.visible)}}let v=class vt extends At.K{set recordId(e){this._recordId=e,e&&(this._approvalWSMessageService.subscribeOnNotificationMessage(e),this.loadApprovals())}set dataLoaded(e){typeof e=="boolean"&&(this.dataLoading=!e)}set approval(e){this._isLoadRequestSent=!1,this._approval=(0,Ct.cloneDeep)(e),this._setCurrentApproval()}set approvalsMetrics(e){this._approvalsMetrics=(0,Ct.cloneDeep)(e),this._approvalsMetrics?.find(a=>a.count>0)&&(this.visible=!0),this._approvalsMetrics!==null&&this._setDisplayPropertyToParentElement(),this.pendingCount=this.getApprovalMetric(A.ToSet),this.positiveCount=this.getApprovalMetric(A.Positive),this.negativeCount=this.getApprovalMetric(A.Negative)}get approvalMetrics(){return this._approvalsMetrics}set approvalChangedHandler(e){e?.status&&(this._moveToNextApproval(),this.approved=e.status===A.Positive,this.rejected=e.status===A.Negative)}set hiddenWhenNoData(e){this.visible=!e}get isActive(){return!!this.currentApproval}isRtl(){return this._isRtl}getApprovalMetric(e){return this.approvalMetrics?this.approvalMetrics.find(n=>n.status===e)?.count??0:0}constructor(e,a,n){super(e),this._translateService=a,this._direction=n,this._loadEmitSubject=new l.Subject,this.positiveCount=0,this.negativeCount=0,this.pendingCount=0,this.approve=new t.EventEmitter,this.reject=new t.EventEmitter,this.loadData=new t.EventEmitter,this.createApproval=new t.EventEmitter,this._approvalWSMessageService=e.get(Y),this._isRtl=this._direction.value==="rtl",this._loadEmitSubject.pipe((0,l.map)(()=>{this.loadData.emit({parentRecordId:this._recordId,parentSchemaName:this.entityName,loadApprovalMetrics:!0})}),(0,l.takeUntil)(this.destroyed$)).subscribe()}_setCurrentApproval(){this.currentApproval=this._approval,this.currentApproval&&(this.objective=this.currentApproval.objective),this.fadeIn=!1,setTimeout(()=>{this.fadeIn=!0,this.detectChanges()},1)}_moveToNextApproval(){this.currentApproval=this._approval=null,this._loadEmitSubject.next()}_setDisplayPropertyToParentElement(){if(this._approvalWidgetContainer?.nativeElement?.parentElement){const e=this._approvalWidgetContainer.nativeElement.parentElement;e.style.display=this.visible?null:"none"}}_subscribeOnNotificationMessage(){this._approvalWSMessageService.messageEvent$.pipe((0,l.takeUntil)(this.destroyed$)).subscribe(({recordId:e})=>{this._recordId&&!this._isLoadRequestSent&&this._recordId===e&&(this.ngAfterViewInit(),this._loadEmitSubject.next())})}ngOnInit(){this._subscribeOnNotificationMessage()}ngAfterViewInit(){this.approved=!this.currentApproval==null,this.rejected=!1}loadApprovals(){this._recordId&&(this.dataLoading=!0,this._loadEmitSubject.next())}onApproveClick(){this._isLoadRequestSent=!0,this.approve.emit({id:this.currentApproval.id,schemaName:this.approvalEntityName,actionType:_.q.Approve})}onRejectClick(){this._isLoadRequestSent=!0,this.reject.emit({id:this.currentApproval.id,schemaName:this.approvalEntityName,actionType:_.q.Reject})}static{this.\u0275fac=function(a){return new(a||vt)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(M.TranslateService),t.\u0275\u0275directiveInject(x.Directionality))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:vt,selectors:[["crt-approval"]],viewQuery:function(a,n){if(a&1&&t.\u0275\u0275viewQuery(Ht,5),a&2){let r;t.\u0275\u0275queryRefresh(r=t.\u0275\u0275loadQuery())&&(n._approvalWidgetContainer=r.first)}},inputs:{recordId:"recordId",dataLoaded:"dataLoaded",approval:"approval",approvalsMetrics:"approvalsMetrics",approvalChangedHandler:"approvalChangedHandler",hiddenWhenNoData:"hiddenWhenNoData",entityName:"entityName",approvalEntityName:"approvalEntityName",linkedSchemaName:"linkedSchemaName",linkedSchemaColumnName:"linkedSchemaColumnName",activeColor:"activeColor",inactiveColor:"inactiveColor"},outputs:{approve:"approve",reject:"reject",loadData:"loadData",createApproval:"createApproval"},features:[t.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:Ft,decls:5,vars:2,consts:[["approvalWidgetContainer",""],["approval_widget_template",""],["tabindex","0","role","region","aria-live","assertive","aria-labelledby","widget-header widget-metrics widget-purpose widget-objective"],[3,"styles",4,"ngIf","ngIfElse"],[3,"styles"],[1,"approval-widget-wrapper",3,"ngClass"],["class","approval-widget-main-section",4,"ngIf"],[1,"approval-widget-main-section"],["id","widget-header",1,"approval-widget-header"],[1,"header-caption",3,"caption"],["id","widget-purpose","class","approval-widget-purpose","aria-live","assertive",4,"ngIf"],["id","widget-objective","aria-live","assertive",1,"approval-widget-objective-container"],[1,"approval-objective-label",3,"caption","ngClass"],["class","approval-widget-items-container","aria-live","assertive",4,"ngIf"],["class","approval-widget-approved-placeholder","role","status","aria-live","assertive",4,"ngIf"],["class","approval-widget-rejected-placeholder","role","status","aria-live","assertive",4,"ngIf"],["id","widget-metrics","aria-live","assertive",1,"approval-metrics"],[1,"metric-wrapper"],["labelType","caption",1,"approval-metric-label",3,"caption"],[1,"metric-value"],["svgIcon","approve-icon","color","accent"],["labelType","headline-1-small","aria-live","assertive",1,"approval-positive-value-label",3,"caption"],["svgIcon","reject-icon","color","warn"],["labelType","headline-1-small","aria-live","assertive",1,"approval-negative-value-label",3,"caption"],["svgIcon","pending-icon"],["labelType","headline-1-small","aria-live","assertive",1,"approval-pending-value-label",3,"caption"],["id","widget-purpose","aria-live","assertive",1,"approval-widget-purpose"],["labelType","caption",1,"purpose-caption",3,"caption"],["aria-live","assertive",1,"approval-widget-items-container"],[1,"approval-widget-actions"],["icon","approve-icon","iconPosition","only-icon","class","approve-icon","color","accent",3,"title","ariaLabel","clicked",4,"ngIf"],["icon","reject-icon","iconPosition","only-icon","class","reject-icon","color","warn",3,"title","ariaLabel","clicked",4,"ngIf"],[1,"approval-widget-inner-content"],["icon","approve-icon","iconPosition","only-icon","color","accent",1,"approve-icon",3,"clicked","title","ariaLabel"],["icon","reject-icon","iconPosition","only-icon","color","warn",1,"reject-icon",3,"clicked","title","ariaLabel"],["role","status","aria-live","assertive",1,"approval-widget-approved-placeholder"],["svgIcon","approve-icon"],["labelType","headline-4",1,"approved-placeholder-label",3,"caption"],["role","status","aria-live","assertive",1,"approval-widget-rejected-placeholder"],["labelType","headline-4",1,"rejected-placeholder-label",3,"caption"]],template:function(a,n){if(a&1&&(t.\u0275\u0275projectionDef(),t.\u0275\u0275elementStart(0,"div",2,0),t.\u0275\u0275template(2,Ut,1,1,"crt-skeleton-loader",3)(3,qt,2,6,"ng-template",null,1,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd()),a&2){const r=t.\u0275\u0275reference(4);t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",n.dataLoading&&n.visible)("ngIfElse",r)}},dependencies:[D.NgClass,D.NgIf,_t.B,yt.W,bt.V,$.MatIcon,M.TranslatePipe],styles:[".approval-widget-wrapper[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column;justify-content:stretch;border-radius:8px;border-width:0;overflow:auto}.approval-widget-wrapper[_ngcontent-%COMP%]   .approval-metrics[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;padding:16px 24px}.approval-widget-wrapper[_ngcontent-%COMP%]   .approval-metrics[_ngcontent-%COMP%]   .metric-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.approval-widget-wrapper[_ngcontent-%COMP%]   .approval-metrics[_ngcontent-%COMP%]   .metric-wrapper[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-items:center}.approval-widget-wrapper[_ngcontent-%COMP%]   .approval-metrics[_ngcontent-%COMP%]   .metric-wrapper[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{height:16px;width:16px;margin-right:3px;margin-top:2px}.approval-widget-wrapper[_ngcontent-%COMP%]   .approve-icon[_ngcontent-%COMP%]{margin-right:5px}.approval-widget-wrapper.rtl[_ngcontent-%COMP%]   .approve-icon[_ngcontent-%COMP%]{margin-left:5px}.approval-widget-approved-placeholder[_ngcontent-%COMP%], .approval-widget-rejected-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:row;padding:8px 0 0 24px}.approval-widget-approved-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .approval-widget-rejected-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{height:17px;width:17px;margin-right:2px}.approval-widget-main-section[_ngcontent-%COMP%]{min-width:50%;display:flex;flex-direction:column;justify-content:space-between}.approval-widget-history-section[_ngcontent-%COMP%]{min-width:50%}.approval-widget-header[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;padding:20px 24px 12px}.approval-widget-header[_ngcontent-%COMP%]   .header-caption[_ngcontent-%COMP%]{flex-grow:1}.approval-widget-header[_ngcontent-%COMP%]   .icon-2[_ngcontent-%COMP%]{height:16px;width:16px;background-color:#fff}.approval-widget-purpose[_ngcontent-%COMP%]{display:flex;margin-bottom:8px;padding:0 24px}.approval-widget-objective-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:left;display:-webkit-box;padding:0 24px;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-align:left}.approval-widget-objective-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block}.approval-widget-items-container[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid #e6e6e6;padding:16px 24px;flex-direction:row;justify-content:space-between;flex-wrap:wrap}.approval-widget-items-container[_ngcontent-%COMP%]   .approval-widget-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:right;align-items:center}.approval-widget-items-container[_ngcontent-%COMP%]   .approval-widget-actions[_ngcontent-%COMP%]   .approve-icon[_ngcontent-%COMP%], .approval-widget-items-container[_ngcontent-%COMP%]   .approval-widget-actions[_ngcontent-%COMP%]   .reject-icon[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content;width:-moz-fit-content;width:fit-content;max-width:100%}.approval-widget-items-container[_ngcontent-%COMP%]   .approval-widget-actions[_ngcontent-%COMP%]   .approve-icon[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .approval-widget-items-container[_ngcontent-%COMP%]   .approval-widget-actions[_ngcontent-%COMP%]   .reject-icon[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:4px}.approval-widget-request[_ngcontent-%COMP%]{color:#fff;display:flex;justify-content:center;align-content:center}.approval-widget-wrapper.rtl[_ngcontent-%COMP%]   .reject-icon[_ngcontent-%COMP%]{margin-left:5px}.approval-widget-wrapper.rtl[_ngcontent-%COMP%]   .approval-widget-objective-container[_ngcontent-%COMP%]{text-align:right}.label-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadein .5s}.label-fade-out[_ngcontent-%COMP%]{opacity:0}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}"]})}};(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",String),(0,i.__metadata)("design:paramtypes",[String])],v.prototype,"recordId",null),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",Boolean),(0,i.__metadata)("design:paramtypes",[Boolean])],v.prototype,"dataLoaded",null),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",Object),(0,i.__metadata)("design:paramtypes",[Object])],v.prototype,"approval",null),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",Array),(0,i.__metadata)("design:paramtypes",[Array])],v.prototype,"approvalsMetrics",null),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",Object),(0,i.__metadata)("design:paramtypes",[Object])],v.prototype,"approvalChangedHandler",null),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",Boolean),(0,i.__metadata)("design:paramtypes",[Boolean])],v.prototype,"hiddenWhenNoData",null),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",String)],v.prototype,"entityName",void 0),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",String)],v.prototype,"approvalEntityName",void 0),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",String)],v.prototype,"linkedSchemaName",void 0),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",String)],v.prototype,"linkedSchemaColumnName",void 0),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",String)],v.prototype,"activeColor",void 0),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",String)],v.prototype,"inactiveColor",void 0),(0,i.__decorate)([(0,k.j)(),(0,i.__metadata)("design:type",Object)],v.prototype,"approve",void 0),(0,i.__decorate)([(0,k.j)(),(0,i.__metadata)("design:type",Object)],v.prototype,"reject",void 0),(0,i.__decorate)([(0,k.j)(),(0,i.__metadata)("design:type",Object)],v.prototype,"loadData",void 0),(0,i.__decorate)([(0,k.j)(),(0,i.__metadata)("design:type",Object)],v.prototype,"createApproval",void 0),v=(0,i.__decorate)([(0,ut.v)({type:"crt.Approval",contentSlots:["items"]}),(0,ht.f)({toolbarConfig:{icon:o(20875),defaultPropertyValues:{activeColor:"white",inactiveColor:"white",items:[]},position:120},typeCaption:"Components.Approval.Caption",propertiesPanelComponentTypeName:"crt.ApprovalPropertiesPanel",viewElementGroupType:ft.J.Components}),(0,i.__metadata)("design:paramtypes",[t.Injector,M.TranslateService,x.Directionality])],v);var te=o(56711),W=o(76923),ee=o(19344);function ae(s,e){if(s&1&&t.\u0275\u0275element(0,"crt-skeleton-loader",2),s&2){const a=t.\u0275\u0275nextContext();t.\u0275\u0275property("styles",a.skeletonStyles)}}function ne(s,e){if(s&1){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div")(1,"div",3),t.\u0275\u0275element(2,"crt-label",4),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"div",5),t.\u0275\u0275element(5,"crt-input",6),t.\u0275\u0275pipe(6,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(7,"div",7)(8,"crt-button",8),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(a);const r=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(r.onCancelClick())}),t.\u0275\u0275text(9),t.\u0275\u0275pipe(10,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(11,"crt-button",9),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(a);const r=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(r.onConfirmClick())}),t.\u0275\u0275text(12),t.\u0275\u0275pipe(13,"translate"),t.\u0275\u0275elementEnd()()()}if(s&2){const a=t.\u0275\u0275nextContext();t.\u0275\u0275advance(2),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(3,6,a.headerLabel)),t.\u0275\u0275advance(3),t.\u0275\u0275property("control",a.commentControl)("label",t.\u0275\u0275pipeBind1(6,8,"Approvals.RejectInputLabel"))("labelPosition","above"),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(10,10,"Approvals.CancelButtonLabel"),""),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(13,12,a.confirmButtonLabel),"")}}class I extends At.K{constructor(e,a,n){super(n),this._dialogRef=e,this.data=a,this.commentControl=new te.UntypedFormControl(""),this.headerLabel=a.operation===_.q.Approve?"Approvals.ApproveDialogHeaderLabel":"Approvals.RejectDialogHeaderLabel",this.confirmButtonLabel=a.operation===_.q.Approve?"Approvals.ApproveButtonLabel":"Approvals.RejectButtonLabel"}ngOnInit(){this.loading=!1}onConfirmClick(){this._dialogRef.close({comment:this.commentControl.value,succeeded:!0})}onCancelClick(){this._dialogRef.close()}static{this.\u0275fac=function(a){return new(a||I)(t.\u0275\u0275directiveInject(W.MatLegacyDialogRef),t.\u0275\u0275directiveInject(W.MAT_LEGACY_DIALOG_DATA),t.\u0275\u0275directiveInject(t.Injector))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:I,selectors:[["crt-approval-comment-dialog"]],features:[t.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[["approval_dialog_template",""],[3,"styles",4,"ngIf","ngIfElse"],[3,"styles"],[1,"header-container"],[1,"header-label",3,"caption"],[1,"controls-container"],["cdkFocusInitial","","multiline","true",3,"control","label","labelPosition"],[1,"buttons-container"],["mat-flat-button","","color","default","textTransform","capitalize",3,"clicked"],["color","primary","textTransform","none",1,"",3,"clicked"]],template:function(a,n){if(a&1&&t.\u0275\u0275template(0,ae,1,1,"crt-skeleton-loader",1)(1,ne,14,14,"ng-template",null,0,t.\u0275\u0275templateRefExtractor),a&2){const r=t.\u0275\u0275reference(2);t.\u0275\u0275property("ngIf",n.loading)("ngIfElse",r)}},dependencies:[D.NgIf,_t.B,yt.W,bt.V,ee.j,M.TranslatePipe],styles:[".buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:20px}.buttons-container[_ngcontent-%COMP%]   crt-button[_ngcontent-%COMP%]{margin-left:8px}.controls-container[_ngcontent-%COMP%]{margin-top:15px}"]})}}var oe=o(96677),ie=o(60776);const re={rows:{toolbar:!1,selection:!1},columns:{adding:!1,toolbar:!1,sorting:!1,resizing:!1,dragAndDrop:!1,editing:!1},cells:{selection:!1},editable:!1};var wt=o(88065),se=o(63907),xt=o(80075),Z=o(22435),q=o(82465);const pe={...re,rows:{toolbar:!0},cells:{selection:!0}};let y=class mt extends wt.X{set recordId(e){e&&this._approvalWSMessageService.subscribeOnNotificationMessage(e)}constructor(e,a,n,r,c){super(e,a,n,r,c),this.reloadData=new t.EventEmitter,this._approvalWSMessageService=e.get(Y)}_subscribeOnNotificationMessage(){this._approvalWSMessageService.messageEvent$.pipe((0,l.takeUntil)(this.destroyed$)).subscribe(()=>{this.reloadData.emit()})}ngOnInit(){this._subscribeOnNotificationMessage()}static{this.\u0275fac=function(a){return new(a||mt)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(se.t,8),t.\u0275\u0275directiveInject(xt.G,8),t.\u0275\u0275directiveInject(q.J),t.\u0275\u0275directiveInject(Z.X))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:mt,selectors:[["crt-approval-list"]],inputs:{recordId:"recordId"},outputs:{reloadData:"reloadData"},features:[t.\u0275\u0275ProvidersFeature([Z.X,q.J,j,{provide:xt.G,useValue:pe}]),t.\u0275\u0275InheritDefinitionFeature],decls:1,vars:8,consts:[[3,"sortingChange","paginationChange","items","header","columns","sorting","loading","primaryColumnName","headerToolbarItems","rowToolbarItems"]],template:function(a,n){a&1&&(t.\u0275\u0275elementStart(0,"crt-data-grid",0),t.\u0275\u0275listener("sortingChange",function(c){return n.onSortingChanged(c)})("paginationChange",function(c){return n.onPaginationChanged(c)}),t.\u0275\u0275elementEnd()),a&2&&t.\u0275\u0275property("items",n.dataItems)("header",n.header)("columns",n.columns)("sorting",n.sorting)("loading",n.loading)("primaryColumnName",n.primaryColumnName)("headerToolbarItems",n.headerToolbarItems)("rowToolbarItems",n.rowToolbarItems)},dependencies:[wt.X],styles:[".container11[_ngcontent-%COMP%]{width:200px;height:300px;background-color:red}"]})}};(0,i.__decorate)([(0,k.j)(),(0,i.__metadata)("design:type",t.EventEmitter)],y.prototype,"reloadData",void 0),(0,i.__decorate)([(0,h.k)(),(0,i.__metadata)("design:type",String),(0,i.__metadata)("design:paramtypes",[String])],y.prototype,"recordId",null),y=(0,i.__decorate)([(0,ut.v)({type:"crt.ApprovalList",reuseStrategy:oe.B.Reuse,compatibleAPIs:{[ie.I.Filtration]:!0}}),(0,ht.f)({designViewItemCommands:{copy:"crt.CopyApprovalListItemCommand",delete:"crt.RemoveCollectionViewItemCommand"},designControlConfig:{allowDesignContent:!0},typeCaption:"Components.ApprovalList.Caption",propertiesPanelComponentTypeName:"crt.ApprovalListPropertiesPanel",viewElementGroupType:ft.J.Components}),(0,i.__metadata)("design:paramtypes",[t.Injector,Array,Object,q.J,Z.X])],y);var Mt=o(71252),le=o(55642),jt=o(5476),It=o(31149),St=o(24091),Lt=o(78781),Rt=o(57274),Pt=o(96176),tt=o(12841),ce=o(4164);let et=class{convert(e,a,n){return!n?.some(r=>r.id===e)}};et=(0,i.__decorate)([(0,ce.a)({type:"crt.ToDisabledApprovalActionConverter"})],et);var C=o(73308),S=o(41287),L=o(844),at=o(63721);class b{constructor(e){this.httpClient=e,this._getActiveApprovalEndpoint={path:"rest/VisaDataService/GetFirstActiveApproval",resultArrayCaption:"GetFirstActiveApprovalResult"},this._getApprovalsMetricsEndpoint={path:"rest/VisaDataService/GetApprovalsMetricsForEntity",resultArrayCaption:"GetApprovalsMetricsForEntityResult"},this._getGetActiveApprovalsEndpoint={path:"rest/VisaDataService/GetActiveApprovals",resultArrayCaption:"GetActiveApprovalsResult"}}_convertToArray(e){const a=[];for(const n of e){const r=Object.keys(n),c={};r.forEach(d=>{const u=n[d],m=this._toLowerCaseFirstChart(d);c[m]=u}),a.push(c)}return a}_toLowerCaseFirstChart(e){return e=e.charAt(0).toLowerCase()+e.slice(1),e}_executeRequest(e,a){return this.httpClient.post(e,{parentSchemaName:a.parentSchemaName,parentRecordId:a.parentRecordId})}_parseResponse(e,a){if(!e[a])return[];const n=JSON.parse(e[a]);return this._convertToArray(n.rows)}loadApprovalsMetrics(e){const a=this._getApprovalsMetricsEndpoint;return this._executeRequest(a.path,e).pipe((0,l.map)(n=>n[a.resultArrayCaption]?JSON.parse(n[a.resultArrayCaption]).rows.map(({Count:c,Status:{value:d}})=>({count:c,status:d})):[]))}loadActiveApprovals(e){const a=this._getGetActiveApprovalsEndpoint;return this._executeRequest(a.path,e).pipe((0,l.map)(n=>this._parseResponse(n,a.resultArrayCaption)))}loadFirstActiveApproval(e){const a=this._getActiveApprovalEndpoint;return this._executeRequest(a.path,e).pipe((0,l.map)(n=>this._parseResponse(n,a.resultArrayCaption)))}static{this.\u0275fac=function(a){return new(a||b)(t.\u0275\u0275inject(at.HttpClient))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac,providedIn:"root"})}}let nt=class z extends S.l{constructor(e){super(),this._injector=e,this._service=this._injector.get(b)}handle(e){var a=this;return(0,C.A)(function*(){const n=e.$context,r=e.dataAttribute,c=e.dataLoadedAttribute,d=e.dataMetricsAttribute,u=a._service.loadFirstActiveApproval(e.config).pipe((0,l.map)(p=>{const f=p.length===0?null:p[0];n.setValue({[r]:f})})),m=a._service.loadApprovalsMetrics(e.config).pipe((0,l.map)(p=>(e.config.loadApprovalMetrics&&n.setValue({[d]:p}),p)));yield(0,l.lastValueFrom)((0,l.of)(e.config.loadApprovalMetrics).pipe((0,Q.mergeMap)(p=>p?m:(0,l.of)([])),(0,Q.mergeMap)(p=>p.length===0&&e.config.loadApprovalMetrics?(0,l.of)([]):u),(0,l.map)(()=>{c&&n.setValue({[c]:!0})})))})()}static{this.\u0275fac=function(a){return new(a||z)(t.\u0275\u0275inject(t.Injector))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac,providedIn:"root"})}};nt=(0,i.__decorate)([(0,L.l)({type:"crt.ApprovalLoadDataHandler",requestType:"crt.ApprovalLoadDataRequest"}),(0,i.__metadata)("design:paramtypes",[t.Injector])],nt);var Nt=o(88033);class R{constructor(e){this.httpClient=e,this._serviceEndpoint="rest/ApprovalService/",this._approveAction="Approve",this._rejectAction="Reject"}handleAction(e){let a="",n="";switch(e.actionType){case _.q.Approve:n=this._approveAction;break;case _.q.Reject:n=this._rejectAction;break;default:throw new Error("No approval action type set")}return a=this._serviceEndpoint+n,this.httpClient.post(a,{request:e}).pipe((0,l.map)(r=>r[`${n}Result`]))}static{this.\u0275fac=function(a){return new(a||R)(t.\u0275\u0275inject(at.HttpClient))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac,providedIn:"root"})}}let ot=class J extends S.l{constructor(e){super(),this._injector=e,this._service=this._injector.get(R),this._maskService=e.get(Nt.s)}handle(e){var a=this;return(0,C.A)(function*(){return a._maskService.showBodyMask(),yield(0,l.lastValueFrom)(a._service.handleAction(e.config).pipe((0,l.map)(()=>{const n=e.approvalChangedHandlerAttributeName;if(n){const r=e.$context,c=e.config.actionType===_.q.Approve?A.Positive:A.Negative;r.setValue({[n]:{}}),r.setValue({[n]:{status:c}})}}))),a._maskService.hideBodyMask(),!0})()}static{this.\u0275fac=function(a){return new(a||J)(t.\u0275\u0275inject(t.Injector))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac,providedIn:"root"})}};ot=(0,i.__decorate)([(0,L.l)({type:"crt.ApprovalActionHandler",requestType:"crt.ApprovalActionHandlerRequest"}),(0,i.__metadata)("design:paramtypes",[t.Injector])],ot);var de=o(7471);class w{constructor(e){this._injector=e,this._dialogService=this._injector.get(de.o)}confirmApprovalAction(e){return this._dialogService.open(I,{width:"450px",minWidth:"450px",panelClass:"dialog-top-border",data:{operation:e}}).pipe((0,l.map)(a=>({cancelled:!a?.succeeded,comment:a?.comment})))}static{this.\u0275fac=function(a){return new(a||w)(t.\u0275\u0275inject(t.Injector))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac,providedIn:"root"})}}let it=class X extends S.l{constructor(e){super(),this._injector=e,this._confirmationService=this._injector.get(w),this._maskService=e.get(Nt.s)}handle(e){var a=this;return(0,C.A)(function*(){const n=yield(0,l.lastValueFrom)(a._confirmationService.confirmApprovalAction(e.config.actionType));if(n.cancelled)return!1;a._maskService.showBodyMask();const c=[{Key:"Comment",Value:n.comment}];yield a.handlerChain.process({type:"crt.ApprovalActionHandlerRequest",config:{...e.config,additionalColumnValues:c}});const d=e.approvalChangedHandlerAttributeName;if(d){const u=e.$context;u.setValue({[d]:{}}),u.setValue({[d]:{status:e.config.actionType===_.q.Approve?A.Positive:A.Negative}})}return a._maskService.hideBodyMask(),!0})()}static{this.\u0275fac=function(a){return new(a||X)(t.\u0275\u0275inject(t.Injector))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac,providedIn:"root"})}};it=(0,i.__decorate)([(0,L.l)({type:"crt.ApprovalConfirmationHandler",requestType:"crt.ApprovalConfirmationHandlerRequest"}),(0,i.__metadata)("design:paramtypes",[t.Injector])],it);var Et=o(81517),rt=o(2828),ve=o(82517),Ot=o(94551);let Tt=class extends Et.S{};Tt=(0,i.__decorate)([(0,rt.$)({type:"crt.ApprovalListReloadRequest"})],Tt);let st=class H extends S.l{handle(e){var a=this;return(0,C.A)(function*(){if(!e.viewElementName)return;const n=`${e.viewElementName}${Ot.k}`,{scopes:r,$context:c}=e,d={type:"crt.LoadDataRequest",scopes:r,config:{loadType:ve.I.Reload},$context:c,dataSourceName:n};yield a.handlerChain.process(d)})()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=t.\u0275\u0275getInheritedFactory(H)))(n||H)}})()}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac,providedIn:"root"})}};st=(0,i.__decorate)([(0,L.l)({type:"crt.ApprovalListReloadHandler",requestType:"crt.ApprovalListReloadRequest"})],st);let pt=class extends Et.S{};pt=(0,i.__decorate)([(0,rt.$)({type:"crt.ApprovalListActionRequest"})],pt);let lt=class F extends S.l{handle(e){var a=this;return(0,C.A)(function*(){yield a.handlerChain.process({type:"crt.ApprovalActionHandlerRequest",config:{...e.config}}),yield a.handlerChain.process({type:"crt.ApprovalListReloadRequest",viewElementName:e.viewElementName,$context:e.$context})})()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=t.\u0275\u0275getInheritedFactory(F)))(n||F)}})()}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac,providedIn:"root"})}};lt=(0,i.__decorate)([(0,L.l)({type:"crt.ApprovalListActionHandler",requestType:"crt.ApprovalListActionRequest"})],lt);let kt=class extends pt{};kt=(0,i.__decorate)([(0,rt.$)({type:"crt.ApprovalListConfirmationRequest"})],kt);let ct=class K extends S.l{constructor(e){super(),this._injector=e,this._confirmationService=this._injector.get(w)}handle(e){var a=this;return(0,C.A)(function*(){const n=yield(0,l.lastValueFrom)(a._confirmationService.confirmApprovalAction(e.config.actionType));if(n.cancelled)return;const c=[{Key:"Comment",Value:n.comment}];yield a.handlerChain.process({type:"crt.ApprovalListActionRequest",viewElementName:e.viewElementName,config:{...e.config,additionalColumnValues:c},loadDataConfig:e.loadDataConfig,$context:e.$context,approvalListAttributeName:e.approvalListAttributeName})})()}static{this.\u0275fac=function(a){return new(a||K)(t.\u0275\u0275inject(t.Injector))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac,providedIn:"root"})}};ct=(0,i.__decorate)([(0,L.l)({type:"crt.ApprovalListRejectHandler",requestType:"crt.ApprovalListConfirmationRequest"}),(0,i.__metadata)("design:paramtypes",[t.Injector])],ct);let dt=class extends S.l{constructor(e){super(),this._injector=e,this._service=this._injector.get(b)}_isApprovalListDSAttribute(e){return e.startsWith("ApprovalList_")&&e.split("_").length===2&&!e.includes("Sorting")}_getApprovalEntityAttributeName(e){return`${e}_EntityName`}handle(e){var a=this;return(0,C.A)(function*(){if(a._isApprovalListDSAttribute(e.attributeName)){const n=e.$context,r=n.attributes.Id,c=a._getApprovalEntityAttributeName(e.attributeName),d=n.attributes[c],u=`${e.attributeName}_ApprovalsList`;if(typeof d!="string"||typeof r!="string")return;const m={parentRecordId:r,parentSchemaName:d};yield(0,l.lastValueFrom)(a._service.loadActiveApprovals(m).pipe((0,l.map)(p=>{n.setValue({[u]:p})})))}return a.next?.handle(e)})()}};dt=(0,i.__decorate)([(0,L.l)({type:"crt.ApprovalListDataLoadHandler",requestType:"crt.HandleViewModelAttributeChangeRequest"}),(0,i.__metadata)("design:paramtypes",[t.Injector])],dt);var Dt=o(74368),me=o(38071),$t=o(95145);class V{get isProcessingDisabled(){return(0,l.lastValueFrom)(this._featureService.getFeatureState("DisableApprovalsPreprocessing"))}constructor(e,a){this._featureService=e,this._sysSettingsService=a,this._componentName="crt.Approval",this._dataLoadedAttributeSuffix="_DataLoaded",this._approvalMetricsAttributeSuffix="_ApprovalsMetrics",this._approvalChangedHandlerAttributeSuffix="_ApprovalChangedHandler",this._listAttributeSuffix="_ApprovalList",this._metadataSchemaUtils=(0,t.inject)(Dt.u)}_getApprovals(e){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalName(e){return e.name.replace(/\./g,"_")}_getAcceptApprovalSettingValue(){return(0,l.lastValueFrom)(this._sysSettingsService.getByCodes(["AcceptApprovalWithoutComment"]).pipe((0,l.pluck)("values"),(0,l.map)(e=>e.AcceptApprovalWithoutComment?.value)))}crtOnModelInit(e,a){var n=this;return(0,C.A)(function*(){if(yield n.isProcessingDisabled)return e;const r=e,c=n._getApprovals(r);for(const d of c){const u=d?.viewConfig;let m=r.viewModelConfig.attributes;m||(m=r.viewModelConfig.attributes={});const p=n._getApprovalName(u);m[`${p}${n._listAttributeSuffix}`]={value:null},m[`${p}${n._approvalMetricsAttributeSuffix}`]={value:null},m[`${p}${n._dataLoadedAttributeSuffix}`]={value:!1},m[`${p}${n._approvalChangedHandlerAttributeSuffix}`]={value:!1}}return e})()}crtOnViewModelInit(e,a,n){var r=this;return(0,C.A)(function*(){if(yield r.isProcessingDisabled)return e;const c=yield r._getAcceptApprovalSettingValue(),d=e,u=r._getApprovals(d);for(const m of u){const p=m?.viewConfig,f=r._getApprovalName(p),P=`${f}${r._listAttributeSuffix}`,N=`${f}${r._dataLoadedAttributeSuffix}`,T=`${f}${r._approvalChangedHandlerAttributeSuffix}`,Vt=`${f}${r._approvalMetricsAttributeSuffix}`;p.recordId="$Id",p.approval=`$${P}`,p.approvalsMetrics=`$${Vt}`,p.dataLoaded=`$${N}`,p.approvalChangedHandler=`$${T}`,p.loadData={request:"crt.ApprovalLoadDataRequest",params:{dataAttribute:P,dataMetricsAttribute:Vt,dataLoadedAttribute:N,config:"@event"}},c?p.approve={request:"crt.ApprovalActionHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:T}}:p.approve={request:"crt.ApprovalConfirmationHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:T}},p.reject={request:"crt.ApprovalConfirmationHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:T}}}return e})()}static{this.\u0275fac=function(a){return new(a||V)(t.\u0275\u0275inject(me.wf),t.\u0275\u0275inject($t.A))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}var ge=o(41108),ue=o(58504);class B{constructor(e,a){this._sysSettingsService=e,this._translateService=a,this._componentName="crt.ApprovalList",this._metadataSchemaUtils=(0,t.inject)(Dt.u)}_getApprovalLists(e){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalListName(e){return e.items?.slice(1)}_getAcceptApprovalSettingValue(){return(0,l.lastValueFrom)(this._sysSettingsService.getByCodes(["AcceptApprovalWithoutComment"]).pipe((0,l.pluck)("values"),(0,l.map)(e=>e.AcceptApprovalWithoutComment?.value)))}_createDataFilter(e,a){const n=new ge.X;n.addSchemaColumnFilterWithParameter(ue.H.Equal,"IsCanceled",!1),e[`${a}_PredefinedFilter`]={value:n.toJson()};const r=e[a];r?.modelConfig&&(r.modelConfig.filterAttributes=r.modelConfig.filterAttributes||[],r.modelConfig.filterAttributes.push({loadOnChange:!1,name:`${a}_PredefinedFilter`}))}crtOnModelInit(e,a){var n=this;return(0,C.A)(function*(){const r=e,c=n._getApprovalLists(r);for(const d of c){const u=d?.viewConfig;let m=r.viewModelConfig.attributes;m||(m=r.viewModelConfig.attributes={});const p=n._getApprovalListName(u);m[`${p}_ApprovalsList`]={value:[]},m[`${p}_EntityName`]={value:u.entityName},n._createDataFilter(m,p)}return e})()}crtOnViewModelInit(e,a,n){var r=this;return(0,C.A)(function*(){const c=e,d=yield r._getAcceptApprovalSettingValue(),u=r._getApprovalLists(c);for(const m of u){const p=m?.viewConfig,f=r._getApprovalListName(p),P=`${f}_ApprovalsList`,N=`$${f}.${f}${Ot.k}_Id`,T=d?"crt.ApprovalListActionRequest":"crt.ApprovalListConfirmationRequest";p.recordId="$Id",p.rowToolbarItems=[{type:"crt.MenuItem",caption:r._translateService.instant("ApprovalList.ApproveButtonLabel"),icon:"approve-icon",iconColor:"accent",disabled:`${N} | crt.ToDisabledApprovalActionConverter: $${P}`,clicked:{request:T,params:{config:{id:N,schemaName:p.approvalEntityName,actionType:_.q.Approve},loadDataConfig:{parentSchemaName:p.entityName,parentRecordId:"$Id"},approvalListAttributeName:P,viewElementName:f}}},{type:"crt.MenuItem",caption:r._translateService.instant("ApprovalList.RejectButtonLabel"),icon:"reject-icon",iconColor:"warn",disabled:`${N} | crt.ToDisabledApprovalActionConverter: $${P}`,clicked:{request:"crt.ApprovalListConfirmationRequest",params:{config:{id:N,schemaName:p.approvalEntityName,actionType:_.q.Reject},loadDataConfig:{parentSchemaName:p.entityName,parentRecordId:"$Id"},approvalListAttributeName:P,viewElementName:f}}}],p.reloadData={request:"crt.ApprovalListReloadRequest",params:{config:"@event",viewElementName:f}}}return e})()}static{this.\u0275fac=function(a){return new(a||B)(t.\u0275\u0275inject($t.A),t.\u0275\u0275inject(M.TranslateService))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac})}}var he=o(17744);class E extends he.x{constructor(){super(...arguments),this.viewItemTypes=["crt.ApprovalList"]}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=t.\u0275\u0275getInheritedFactory(E)))(n||E)}})()}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac})}}class O{constructor(e){this.httpClient=e,this._serviceEndpoint="rest/VisaDataService/GetApprovalSchemaName",this._schemaToApprovalSchemaObservableMap=new Map}_mapToConfig(e){return e.pipe((0,l.map)(a=>a.GetApprovalSchemaNameResult))}getApprovalSchemaName(e){const a=this._schemaToApprovalSchemaObservableMap.get(e);if(a)return this._mapToConfig(a);const n=this.httpClient.post(this._serviceEndpoint,{schemaName:e}).pipe((0,l.shareReplay)({bufferSize:1,refCount:!1}));return this._schemaToApprovalSchemaObservableMap.set(e,n),this._mapToConfig(n)}static{this.\u0275fac=function(a){return new(a||O)(t.\u0275\u0275inject(at.HttpClient))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"})}}let U=class gt{constructor(e,a){this._matIconRegistry=e,this._domSanitizer=a,this._registerIcons()}_registerIcons(){[{name:"approve-icon",icon:o(6688)},{name:"reject-icon",icon:o(42396)},{name:"refresh-icon",icon:o(9734)},{name:"approval-panel-arrow-down",icon:o(95940)},{name:"approvals_icon",icon:o(20875)},{name:"approvals_list_icon",icon:o(25392)},{name:"pending-icon",icon:o(20158)},{name:"shape-icon",icon:o(68540)}].forEach(({name:a,icon:n})=>{this._matIconRegistry.addSvgIconLiteral(a,this._domSanitizer.bypassSecurityTrustHtml(n))})}static{this.\u0275fac=function(a){return new(a||gt)(t.\u0275\u0275inject($.MatIconRegistry),t.\u0275\u0275inject(Mt.DomSanitizer))}}static{this.\u0275mod=t.\u0275\u0275defineNgModule({type:gt})}static{this.\u0275inj=t.\u0275\u0275defineInjector({providers:[b,R,O,w,{provide:tt.m,useClass:V,multi:!0},{provide:tt.m,useClass:B,multi:!0},{provide:tt.m,useClass:E,multi:!0}],imports:[D.CommonModule,It.q,jt.q,Pt.c,St.S,Lt.C,M.TranslateModule,W.MatLegacyDialogModule,$.MatIconModule,Rt.u]})}};U=(0,i.__decorate)([(0,le.g)({viewElements:[v,y],requestHandlers:[nt,ot,it,st,lt,ct,dt],converters:[et]}),(0,i.__metadata)("design:paramtypes",[$.MatIconRegistry,Mt.DomSanitizer])],U),function(){(typeof ngJitMode>"u"||ngJitMode)&&t.\u0275\u0275setNgModuleScope(U,{declarations:[v,I,y],imports:[D.CommonModule,It.q,jt.q,Pt.c,St.S,Lt.C,M.TranslateModule,W.MatLegacyDialogModule,$.MatIconModule,Rt.u],exports:[v,I,y]})}()},52335:(g,G,o)=>{o.d(G,{q:()=>i});var i;(function(x){x[x.Reject=0]="Reject",x[x.Approve=1]="Approve"})(i||(i={}))},95940:g=>{g.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
	<path fill="none" stroke="black" stroke-width="1.6" d="M4.6 6 8 9.38 11.47 6"/>
	<path fill="none" d="M0 0h16v16H0z"/>
</svg>
`},20875:g=>{g.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64">
  <g id="Group_16914" data-name="Group 16914" transform="translate(-290 -760)">
    <rect id="Rectangle_39847" data-name="Rectangle 39847" width="72" height="64" rx="6" transform="translate(290 760)" fill="none"/>
    <g id="Rectangle_6778" data-name="Rectangle 6778" transform="translate(298 768)" fill="#fff" stroke="#999" stroke-width="1">
      <rect width="56" height="46" rx="4" stroke="none"/>
      <rect x="0.5" y="0.5" width="55" height="45" rx="3.5" fill="none"/>
    </g>
    <rect id="Rectangle_24809" data-name="Rectangle 24809" width="40" height="5" rx="2.5" transform="translate(306 775)" fill="#d1d1d1"/>
    <rect id="Rectangle_39848" data-name="Rectangle 39848" width="40" height="5" rx="2.5" transform="translate(306 783)" fill="#d1d1d1"/>
    <g id="Group_16921" data-name="Group 16921" transform="translate(-22 4)">
      <rect id="Rectangle_44668" data-name="Rectangle 44668" width="16" height="16" rx="3" transform="translate(328 788)" fill="#0b8500"/>
      <g id="Group_16915" data-name="Group 16915" transform="translate(331.766 792.257)">
        <path id="Path_30" data-name="Path 30" d="M13,4.5l-6.35,6.228L4,8.185" transform="translate(-4 -4.5)" fill="rgba(0,0,0,0)" stroke="#fff" stroke-width="2"/>
      </g>
    </g>
    <g id="Group_16930" data-name="Group 16930" transform="translate(-2 4)">
      <g id="Group_16932" data-name="Group 16932">
        <rect id="Rectangle_44668-2" data-name="Rectangle 44668" width="16" height="16" rx="3" transform="translate(328 788)" fill="none"/>
        <g id="Group_16931" data-name="Group 16931" transform="translate(-1 -1)">
          <path id="Path_12076" data-name="Path 12076" d="M332.686,792.975l8,8" transform="translate(0.314 0.025)" fill="none" stroke="#c23f23" stroke-width="2"/>
          <path id="Path_12077" data-name="Path 12077" d="M340.686,792.975l-8,8" transform="translate(0.314 0.025)" fill="none" stroke="#c23f23" stroke-width="2"/>
        </g>
      </g>
    </g>
  </g>
</svg>
`},25392:g=>{g.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64">
  <g id="Group_14560" data-name="Group 14560" transform="translate(-464 -425)">
    <rect id="Rectangle_24800" data-name="Rectangle 24800" width="72" height="64" rx="6" transform="translate(464 425)" fill="none"/>
    <g id="Group_14731" data-name="Group 14731" transform="translate(-18.251 3)">
      <g id="Group_14728" data-name="Group 14728" transform="translate(490.547 438)">
        <rect id="Rectangle_6612" data-name="Rectangle 6612" width="56" height="5" rx="2.5" transform="translate(-0.296)" fill="#d1d1d1"/>
        <rect id="Rectangle_41225" data-name="Rectangle 41225" width="8" height="5" rx="2.5" transform="translate(-0.296 8)" fill="#0b8500"/>
        <rect id="Rectangle_44669" data-name="Rectangle 44669" width="8" height="5" rx="2.5" transform="translate(10.704 8)" fill="#d2310d"/>
      </g>
      <g id="Group_16918" data-name="Group 16918" transform="translate(490.547 457)">
        <rect id="Rectangle_6612-2" data-name="Rectangle 6612" width="56" height="5" rx="2.5" transform="translate(-0.296)" fill="#d1d1d1"/>
        <rect id="Rectangle_41225-2" data-name="Rectangle 41225" width="8" height="5" rx="2.5" transform="translate(-0.296 8)" fill="#0b8500"/>
        <rect id="Rectangle_44670" data-name="Rectangle 44670" width="8" height="5" rx="2.5" transform="translate(10.704 8)" fill="#d2310d"/>
      </g>
    </g>
  </g>
</svg>
`},6688:g=>{g.exports=`<svg width="64" height="64" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M2 8L6 12L14 4" stroke="currentColor" stroke-width="2"/>
</svg>
`},20158:g=>{g.exports=`<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.3335 8L4.5335 5.15C4.47175 5.1031 4.42161 5.04263 4.38693 4.97328C4.35226 4.90393 4.33397 4.82754 4.3335 4.75V2.5C4.3335 2.36739 4.38617 2.24021 4.47994 2.14645C4.57371 2.05268 4.70089 2 4.8335 2H11.8335C11.9661 2 12.0933 2.05268 12.187 2.14645C12.2808 2.24021 12.3335 2.36739 12.3335 2.5V4.725C12.333 4.80254 12.3147 4.87893 12.2801 4.94828C12.2454 5.01763 12.1952 5.0781 12.1335 5.125L8.3335 8Z" stroke="#757575" stroke-width="2" stroke-linecap="round"/>
<path d="M8.3335 8L4.5335 10.85C4.47175 10.8969 4.42161 10.9574 4.38693 11.0267C4.35226 11.0961 4.33397 11.1725 4.3335 11.25V13.5C4.3335 13.6326 4.38617 13.7598 4.47994 13.8536C4.57371 13.9473 4.70089 14 4.8335 14H11.8335C11.9661 14 12.0933 13.9473 12.187 13.8536C12.2808 13.7598 12.3335 13.6326 12.3335 13.5V11.275C12.333 11.1975 12.3147 11.1211 12.2801 11.0517C12.2454 10.9824 12.1952 10.9219 12.1335 10.875L8.3335 8Z" stroke="#757575" stroke-width="2" stroke-linecap="round"/>
<path d="M12.3335 12.275L4.3335 12.25" stroke="#757575" stroke-width="2" stroke-linecap="round"/>
</svg>
`},9734:g=>{g.exports=`<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="64px" height="64px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
<g>
	<path fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" d="M33,1c7.678,0,15.354,2.929,21.212,8.787
		C64.91,20.484,65.841,37.248,57.003,49l-6.001,6.002"/>
</g>
<g>
	<path fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" d="M31,63c-7.678,0-15.354-2.929-21.212-8.787
		C-0.91,43.516-1.841,26.752,6.997,15l6.001-6.002"/>
</g>
<polyline fill="none" stroke="#000000" stroke-width="2" stroke-linejoin="bevel" stroke-miterlimit="10" points="51,44 51,55 
	62,55 "/>
<polyline fill="none" stroke="#000000" stroke-width="2" stroke-linejoin="bevel" stroke-miterlimit="10" points="13,20 13,9 2,9 
	"/>
</svg>
`},42396:g=>{g.exports=`<svg width="16" height="16" fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" >
	<path d="M13.000 3.000L3.000 13.000" stroke="currentColor" stroke-width="2"/>
	<path d="M3.000 3.000L13.000 13.000" stroke="currentColor" stroke-width="2"/>
</svg>
`},68540:g=>{g.exports=`<svg width="14" height="11" viewBox="0 0 14 11" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1 5L5 9L13 1" stroke="#0B8500" stroke-width="2"/>
</svg>
`}}]);
