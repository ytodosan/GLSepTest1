(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[5138],{35138:(Z,X,a)=>{a.r(X),a.d(X,{AcceptChatHandler:()=>S,AcceptChatRequest:()=>H,BaseLoadInProgressChatsConverter:()=>b,CrtContactCenterModule:()=>E,CrtIncomingItemListPreprocessor:()=>C,LoadInProgressChatsConverter:()=>M,LoadNotAcceptedChatsConverter:()=>w,MergeIncomingItemsConverter:()=>_,SubscribeToChatUpdateHandler:()=>A,SubscribeToChatUpdateRequest:()=>z,SubscribeToCtiEventsHandler:()=>O,SubscribeToCtiEventsRequest:()=>K,ViewModelCollectionToIncomingItemsArray:()=>P});var s=a(5960),p=a(40297),he=a(55642),v=a(79772),Y=a(50663),W=a(66989),q=a(42656),ee=a(48629),te=a(90895),ne=a(65269),ie=a(69015),ae=a(17371),oe=a(24091),x=a(31149),re=a(18070),se=a(40203),ue=a(12841),e=a(59131),ce=a(34760),le=a(77592),L=a(3671),R=a(96677),B=a(68712),ve=a(12325),g=a(73308),Ce=a(6530),fe=a(91775),Ie=a(2703),ye=a(56027),be=a(41314),xe=a(90983),V=a(28399),Te=a(30046),Me=a.n(Te),we=a(53703),_e=a(92340),Pe=a(80615),Se=a(20405),Ae=a(64),de=a(62115);const Oe=o=>({"item-outdated":o});function Ee(o,t){o&1&&(e.\u0275\u0275elementStart(0,"crt-chip",12),e.\u0275\u0275text(1," Input due "),e.\u0275\u0275elementEnd())}function Ne(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",13)(1,"crt-button",14),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onAcceptClick())}),e.\u0275\u0275elementEnd()()}o&2&&(e.\u0275\u0275advance(),e.\u0275\u0275property("caption",e.\u0275\u0275pipeBind1(2,1,"IncomingItemList.AcceptButtonLabel")))}let f=class N extends B.K{constructor(){super(...arguments),this._defaultDate=new Date,this._outdateDelay=0,this.timerType=Ie.a.Stopwatch,this.acceptClick=new e.EventEmitter}set data(t){this._incomingItem=t,this._setOutdateTimer()}get isOutdated(){const t=this._getTimeBeforeOutdate();return!!t&&t>=this._outdateDelay}set outdateDelay(t){this._outdateDelay=t*60,this._setOutdateTimer()}get incomingItem(){return this._incomingItem}get icon(){let t=this._incomingItem?.schemaName?.toLowerCase();return ye.z.includes(t)||(t="default"),`${t}-entity-icon`}get tileIconKey(){return this._incomingItem?.schemaName||"omnichat"}get ownerId(){return this._incomingItem?.contact?.value}get ownerName(){return this._incomingItem?.contact?.displayValue?.toString()}get ownerNamePlaceholder(){const t=this.ownerName;return(0,V.isEmpty)(t)?"":t[0]}get photoUrl(){const t=this._incomingItem?.contact?.primaryImageValue;return t&&t!==Ce.To?(0,be.Mc)(t):""}get createdOn(){return this._incomingItem?.createdOn!==void 0?this._incomingItem?.createdOn||this._defaultDate:this._defaultDate}get isNeedAccept(){return this._incomingItem?.accepted===!1}get isPendingDetails(){return!0}get description(){return this._incomingItem?.itemTitle}_openDefaultPage(t,n){return(0,g.A)(function*(){const i={type:"crt.UpdateRecordRequest",entityName:t,recordId:n,$context:null};yield fe.t.instance.process(i)})()}_getTimeBeforeOutdate(){return!this._incomingItem?.createdOn||!this._outdateDelay?null:Me()().diff(this._incomingItem?.createdOn,"seconds",!1)}_setOutdateTimer(){const t=this._getTimeBeforeOutdate();t===null||t>=this._outdateDelay||setTimeout(()=>{this.changeDetectorRef.detectChanges()},(this._outdateDelay-t)*1e3)}onLinkClick(t,n){var i=this;return(0,g.A)(function*(){yield i._openDefaultPage(t,n)})()}get ownerLink(){const t=this.ownerId;return t?(0,xe.TX)("Contact",t):""}onAcceptClick(){this.acceptClick.emit(this._incomingItem)}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(N)))(i||N)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:N,selectors:[["crt-incoming-item"]],inputs:{data:"data",outdateDelay:"outdateDelay"},outputs:{acceptClick:"acceptClick"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:15,vars:18,consts:[[1,"icoming-item-tile",3,"ngClass"],[1,"icoming-item-tile-header"],[1,"icoming-item-tile-icon"],[3,"tileKey","icon"],[1,"icoming-item-tile-caption",3,"title"],["class","icoming-item-tile-caption-chip","color","Orange",4,"ngIf"],[1,"icoming-item-tile-footer"],[1,"icoming-item-tile-owner"],["readonly","true","placeholderMode","abbreviation","borderRadius","large","positioning","scale-down","size","none",1,"icoming-item-tile-owner-photo",3,"value","placeholder","colorId"],["mode","'preventDefault'",1,"icoming-item-tile-owner-link",3,"clicked","href"],[1,"icoming-item-tile-date",3,"timerType","control"],["class","icoming-item-tile-actions",4,"ngIf"],["color","Orange",1,"icoming-item-tile-caption-chip"],[1,"icoming-item-tile-actions"],["size","medium","color","accent",3,"clicked","caption"]],template:function(n,i){n&1&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275element(3,"crt-entity-icon",3),e.\u0275\u0275pipe(4,"lowercase"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",4),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Ee,2,0,"crt-chip",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",6)(9,"div",7),e.\u0275\u0275element(10,"crt-image-input",8),e.\u0275\u0275elementStart(11,"crt-link",9),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick("Contact",i.ownerId)}),e.\u0275\u0275text(12),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(13,"crt-timer",10),e.\u0275\u0275template(14,Ne,3,3,"div",11),e.\u0275\u0275elementEnd()()),n&2&&(e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(16,Oe,i.isOutdated)),e.\u0275\u0275advance(3),e.\u0275\u0275property("tileKey",e.\u0275\u0275pipeBind1(4,14,i.tileIconKey))("icon",i.icon),e.\u0275\u0275advance(2),e.\u0275\u0275property("title",i.description),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i.description," "),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!1),e.\u0275\u0275advance(3),e.\u0275\u0275property("value",i.photoUrl)("placeholder",i.ownerNamePlaceholder)("colorId",i.ownerId),e.\u0275\u0275advance(),e.\u0275\u0275property("href",i.ownerLink),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i.ownerName," "),e.\u0275\u0275advance(),e.\u0275\u0275property("timerType",i.timerType)("control",i.createdOn),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.isNeedAccept))},dependencies:[p.NgClass,p.NgIf,we.h,_e.g,Pe.j,Se.N,Ae.k,de.B,p.LowerCasePipe,v.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.icoming-item-tile[_ngcontent-%COMP%]{height:96px;max-width:100%;border:1px solid var(--crt-palette-interaction-900);border-radius:8px;overflow:auto;background:var(--crt-palette-background-400);padding:5px}.icoming-item-tile.item-outdated[_ngcontent-%COMP%]{border-color:var(--crt-palette-error-500);box-shadow:1px 1px 5px var(--crt-palette-error-500)}.icoming-item-tile[_ngcontent-%COMP%]   crt-chip.icoming-item-tile-caption-chip[_ngcontent-%COMP%]{font-family:var(--crt-body-2-font-family);font-size:var(--crt-body-2-font-size);line-height:var(--crt-body-2-line-height);font-weight:var(--crt-body-2-font-weight);letter-spacing:var(--crt-body-2-letter-spacing);text-transform:var(--crt-body-2-text-transform);-webkit-font-smoothing:antialiased;margin-top:6px;max-width:67px}.icoming-item-tile[_ngcontent-%COMP%]   crt-chip.icoming-item-tile-caption-chip[_ngcontent-%COMP%]   .crt-chip-focus-overlay[_ngcontent-%COMP%]{background-color:#ffd9d0;opacity:.2}.icoming-item-tile.selected[_ngcontent-%COMP%]{background-color:var(--crt-palette-interaction-900)}.icoming-item-tile[_ngcontent-%COMP%]:hover{background-color:var(--crt-palette-interaction-700)}.icoming-item-tile[_ngcontent-%COMP%]:hover   .icoming-item-tile-actions[_ngcontent-%COMP%]{width:100px;display:inline-block}.icoming-item-tile[_ngcontent-%COMP%]:hover   .icoming-item-tile-date[_ngcontent-%COMP%]{display:none}.icoming-item-tile-header[_ngcontent-%COMP%]{display:flex}.icoming-item-tile-footer[_ngcontent-%COMP%]{display:flex;margin:12px 8px 0;align-items:center;height:24px}.icoming-item-tile-caption[_ngcontent-%COMP%]{font-family:var(--crt-body-1-font-family);font-size:var(--crt-body-1-font-size);line-height:var(--crt-body-1-line-height);font-weight:var(--crt-body-1-font-weight);letter-spacing:var(--crt-body-1-letter-spacing);text-transform:var(--crt-body-1-text-transform);-webkit-font-smoothing:antialiased;width:calc(100% - 32px);overflow:hidden;height:2.8em;margin-top:6px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;text-overflow:ellipsis;cursor:pointer}.icoming-item-tile-owner[_ngcontent-%COMP%]{font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased;width:100%;display:inline-flex;overflow:hidden;margin-inline-end:3em}.icoming-item-tile-owner-photo[_ngcontent-%COMP%]{width:16px;display:flex;height:16px;margin-inline-end:8px}.icoming-item-tile-owner-photo[_ngcontent-%COMP%]   .placeholder-abbreviation.no-photo[_ngcontent-%COMP%]{min-width:unset;min-height:unset;line-height:16px;height:16px;width:16px;font-size:8px}.icoming-item-tile-owner-photo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:unset}.icoming-item-tile-owner-link[_ngcontent-%COMP%]{max-width:calc(100% - 24px)}.icoming-item-tile-actions[_ngcontent-%COMP%]{display:none}"]})}};f=(0,s.__decorate)([(0,L.v)({type:"crt.IncomingItem",reuseStrategy:R.B.Reuse})],f);function De(o,t){o&1&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275element(1,"crt-label",4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"crt-label",5),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()),o&2&&(e.\u0275\u0275advance(),e.\u0275\u0275property("caption",e.\u0275\u0275pipeBind1(2,2,"IncomingItemList.NoDataLabel")),e.\u0275\u0275advance(2),e.\u0275\u0275property("caption",e.\u0275\u0275pipeBind1(4,4,"IncomingItemList.NoDataDescription")))}function Le(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",7)(2,"crt-incoming-item",8),e.\u0275\u0275listener("click",function(){const r=e.\u0275\u0275restoreView(n).$implicit,c=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(c.onItemClick(r))})("acceptClick",function(r){e.\u0275\u0275restoreView(n);const c=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(c.onItemAccept(r))}),e.\u0275\u0275elementEnd()()()}if(o&2){const n=t.$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("data",n)("outdateDelay",i.outdateDelay)}}function Re(o,t){if(o&1&&e.\u0275\u0275template(0,Le,3,2,"div",6),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngForOf",n.items)}}let m=class D extends B.K{constructor(){super(...arguments),this.tileClick=new e.EventEmitter,this.itemAccept=new e.EventEmitter,this.outdateDelay=0}set items(t){this._items=t}get items(){return this._items}onItemClick(t){this.tileClick.emit(t)}onItemAccept(t){this.itemAccept.emit(t)}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(D)))(i||D)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:D,selectors:[["crt-incoming-item-list"]],inputs:{outdateDelay:"outdateDelay",items:"items"},outputs:{tileClick:"tileClick",itemAccept:"itemAccept"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:2,consts:[["incoming_items",""],[1,"incoming-item-list"],["class","incoming-item-list-no-data",4,"ngIf","ngIfElse"],[1,"incoming-item-list-no-data"],[1,"incoming-item-list-no-data-label",3,"caption"],[1,"incoming-item-list-no-data-description",3,"caption"],[4,"ngFor","ngForOf"],[1,"incoming-item-wrapper"],[3,"click","acceptClick","data","outdateDelay"]],template:function(n,i){if(n&1&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275template(1,De,5,6,"div",2)(2,Re,1,1,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),n&2){const r=e.\u0275\u0275reference(3);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",(i.items==null?null:i.items.length)===0)("ngIfElse",r)}},dependencies:[p.NgForOf,p.NgIf,ve.V,f,v.TranslatePipe],styles:[".incoming-item-list[_ngcontent-%COMP%]{width:100%}.incoming-item-list[_ngcontent-%COMP%]   .incoming-item-wrapper[_ngcontent-%COMP%]{padding:5px}.incoming-item-list-no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;height:100%}.incoming-item-list-no-data-label[_ngcontent-%COMP%]{margin-top:35px}.incoming-item-list-no-data-description[_ngcontent-%COMP%]{margin-top:16px}"]})}};(0,s.__decorate)([(0,ce.j)(),(0,s.__metadata)("design:type",Object)],m.prototype,"tileClick",void 0),(0,s.__decorate)([(0,ce.j)(),(0,s.__metadata)("design:type",Object)],m.prototype,"itemAccept",void 0),(0,s.__decorate)([(0,le.k)(),(0,s.__metadata)("design:type",Object)],m.prototype,"outdateDelay",void 0),(0,s.__decorate)([(0,le.k)({reuseStrategy:{resetValue:!0}}),(0,s.__metadata)("design:type",Array),(0,s.__metadata)("design:paramtypes",[Array])],m.prototype,"items",null),m=(0,s.__decorate)([(0,L.v)({type:"crt.IncomingItems",reuseStrategy:R.B.Reuse})],m);var me=a(59969),T=a(23872),F=a(56704),d=a(62278);const Be="OmniChat",Ve="1d96a65f-2131-4916-8825-2d142b1000b2",Je="53f71b5f-7e17-4cf5-bf14-6a59212db422";var Fe=a(83463),ke=a(76556);const pe=o=>({number:o});function je(o,t){o&1&&e.\u0275\u0275element(0,"crt-skeleton-loader")}function Ue(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"div",4),e.\u0275\u0275element(3,"crt-button",5),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275element(7,"crt-button",5),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"crt-expansion-panel",6),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275element(13,"crt-chat-list",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"crt-expansion-panel",6),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275element(16,"crt-chat-list",7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div",8)(18,"span"),e.\u0275\u0275text(19,"Conversation will be here"),e.\u0275\u0275elementEnd()()()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("icon","flag-button-icon")("ariaLabel",e.\u0275\u0275pipeBind1(4,14,"AgentInbox.RealTime"))("title",e.\u0275\u0275pipeBind1(5,16,"AgentInbox.RealTime"))("caption",e.\u0275\u0275pipeBind1(6,18,"AgentInbox.RealTime")),e.\u0275\u0275advance(4),e.\u0275\u0275property("icon","queued-tasks")("ariaLabel",e.\u0275\u0275pipeBind1(8,20,"AgentInbox.QueuedTasks"))("title",e.\u0275\u0275pipeBind1(9,22,"AgentInbox.QueuedTasks"))("caption",e.\u0275\u0275pipeBind1(10,24,"AgentInbox.QueuedTasks")),e.\u0275\u0275advance(4),e.\u0275\u0275property("title",e.\u0275\u0275pipeBind2(12,26,"AgentInbox.NewItems",e.\u0275\u0275pureFunction1(32,pe,n.newChatLength)))("expanded",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("chats",n.newChats),e.\u0275\u0275advance(),e.\u0275\u0275property("title",e.\u0275\u0275pipeBind2(15,29,"AgentInbox.InProgress",e.\u0275\u0275pureFunction1(34,pe,n.chatLength)))("expanded",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("chats",n.inProgressChats)}}class Ze extends null{}let I=class G extends B.K{constructor(t,n,i){super(t),this.el=n,this.renderer=i,this.inProgressChats=[],this.newChats=[],this._omnichannelChatService=t.get(F.I),this._customEventService=t.get(me.Dj),this._translate=t.get(v.TranslateService)}_loadChats(){var t=this;return(0,g.A)(function*(){const n=yield t._getChats();t.inProgressChats=n.filter(i=>i.operator?.value).map(i=>t._mapChatPreview(i)),t.newChats=n.filter(i=>!i.operator?.value).map(i=>t._mapChatPreview(i))})()}_mapChatPreview(t){return{id:t.id,date:t.lastMessageTime,author:t.contact?new T.B(t.contact.id,t.contact.name,t.contact.photoId):new T.B,caption:t.chatPreview,preview:t.chatPreview,previewFromServer:t.chatPreview,previewMessageId:null,unreadMessagesCount:0}}_subscribeCtiEvents(){this._customEventService.subscribe("CtiModelEvents").subscribe(t=>{switch(t[0]){case"callSaved":this._handleCallSaved(t);break;case"callFinished":this._handleCallFinished(t);break;case"callIdentificationSaved":this._handleCallIdentification(t);break}this.changeDetectorRef.detectChanges()})}_handleCallSaved(t){const n=t[1];if(!n||!n.state||this.inProgressChats?.find(l=>l.id===n.databaseUId))return;const i=n.direction.toLowerCase()===Ve,r=i?"AgentInbox.IncomingCallTpl":"AgentInbox.OutgoingCallTpl",c=i?n.callerId:n.calledId;this.inProgressChats?.unshift({id:n.databaseUId,date:new Date,author:new T.B(null,"?"),caption:c,preview:this._translate.instant(r,{number:c}),previewFromServer:c,previewMessageId:null,unreadMessagesCount:0,callId:n.id})}_handleCallFinished(t){const n=t[1];if(!n||!this.inProgressChats)return;const i=this.inProgressChats.findIndex(r=>r.id===n.databaseUId);i>=0&&this.inProgressChats.splice(i,1)}_handleCallIdentification(t){const n=t[1],i=t[2],r=this.inProgressChats?.find(l=>l?.callId===n);if(!r||!i)return;const c=i.findByFn(l=>l.name==="Contact");c&&(r.author=new T.B(c.value,c.displayValue,c.primaryImageValue),r.caption=c.displayValue)}_getChats(){return(0,d.lastValueFrom)(this._omnichannelChatService.getOperatorChats().pipe((0,d.filter)(t=>t.success),(0,d.map)(t=>t.result)))}ngOnInit(){this._loadChats(),this._subscribeCtiEvents()}ngAfterViewInit(){const t=this.el.nativeElement.querySelector(".container"),n=this.el.nativeElement.querySelector(".conversation-panel");new ResizeObserver(r=>{for(const c of r)c.contentRect.width>600?this.renderer.setStyle(n,"display","block"):this.renderer.setStyle(n,"display","none")}).observe(t)}get chatLength(){return this.inProgressChats?.length||0}get newChatLength(){return this.newChats?.length||0}static{this.\u0275fac=function(n){return new(n||G)(e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(e.Renderer2))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:G,selectors:[["crt-agent-inbox"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[["agentinbox_template",""],[4,"ngIf","ngIfElse"],[1,"container"],[1,"agent-queue-panel"],[1,"btn-row"],["iconPosition","left-icon","displayType","text","size","medium",1,"crt-create-item-button",3,"icon","ariaLabel","title","caption"],["togglePosition","after","toggleType","material",3,"title","expanded"],[3,"chats"],[1,"conversation-panel"]],template:function(n,i){if(n&1&&e.\u0275\u0275template(0,je,1,0,"crt-skeleton-loader",1)(1,Ue,20,36,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),n&2){const r=e.\u0275\u0275reference(2);e.\u0275\u0275property("ngIf",i.loading)("ngIfElse",r)}},dependencies:[p.NgIf,de.B,Fe.l,ke.o,v.TranslatePipe],styles:[".container[_ngcontent-%COMP%]{display:flex}.btn-row[_ngcontent-%COMP%]{display:flex;gap:10px}.agent-queue-panel[_ngcontent-%COMP%]{width:100%;flex:1;padding:20px;display:flex;flex-direction:column;height:400px;overflow-y:auto;overflow-x:hidden}.conversation-panel[_ngcontent-%COMP%]{flex:1;padding:20px;display:none;height:100%}"]})}};I=(0,s.__decorate)([(0,L.v)({type:"crt.AgentInbox",reuseStrategy:R.B.Reuse}),(0,s.__metadata)("design:paramtypes",[e.Injector,e.ElementRef,e.Renderer2])],I);var y=a(4164);let b=class{constructor(t){this._omnichannelChatService=t,this._chatSchemaName="OmniChat"}getChats(t){return(0,d.lastValueFrom)(this._omnichannelChatService.getOperatorChats().pipe((0,d.filter)(n=>n.success),(0,d.map)(n=>n.result),(0,d.map)(n=>n.filter(i=>t?i.operator.value:!i.operator.value).map(i=>({schemaName:this._chatSchemaName,id:i.id,contact:i.contact?{value:i.contact.id,displayValue:i.contact.name,primaryImageValue:i.contact.photoId}:null,accepted:t,itemTitle:i.chatPreview,createdOn:i.lastMessageTime,additionalParams:{chatQueueId:i.chatQueueId,status:i.status,channel:i.channel,lastMessageTime:i.lastMessageTime,unprocessedMsgCount:i.unprocessedMsgCount,operator:i.operator,closeDate:i.closeDate,completionDate:i.completionDate,lastMessageDirection:i.lastMessageDirection,channelId:i.channelId}})))))}};b=(0,s.__decorate)([(0,y.a)(),(0,s.__metadata)("design:paramtypes",[F.I])],b);let M=class extends b{convert(){return this.getChats(!0)}};M=(0,s.__decorate)([(0,y.a)({type:"crt.LoadInProgressChats"})],M);let w=class extends b{convert(){return this.getChats(!1)}};w=(0,s.__decorate)([(0,y.a)({type:"crt.LoadNotAcceptedChats"})],w);let _=class{convert(t){return t.flat().filter(n=>!!n)}};_=(0,s.__decorate)([(0,y.a)({type:"crt.MergeIncomingItems"})],_);let P=class{convert(t,n,i){return(0,g.A)(function*(){return!t||t.length===0||!i?[]:yield Promise.all(t.map(function(){var c=(0,g.A)(function*(l){return{schemaName:(yield l.getPrimaryDataSchema()).name,id:yield l[i.id],itemTitle:yield l[i.itemTitle],createdOn:yield l[i.createdOn],contact:yield l[i.contact],accepted:!0}});return function(l){return c.apply(this,arguments)}}()))})()}};P=(0,s.__decorate)([(0,y.a)({type:"crt.ViewModelCollectionToIncomingItemsArray"})],P);var k=a(81517),j=a(2828),U=a(41287),$=a(844),$e=a(40968),He=a(22592),ze=a(99298);let H=class extends k.S{};H=(0,s.__decorate)([(0,j.$)({type:"crt.AcceptChatRequest"})],H);let S=class extends U.l{constructor(t,n){super(),this._omnichannelChatService=t,this._maskService=n}handle(t){var n=this;return(0,g.A)(function*(){if(t.incomingItem){const i=t.incomingItem.schemaName,r=t.incomingItem.id;if(i===Be){const c=`ACCEPT_CHAT_${r}`;yield n._maskService.showMask(c,t.$context),yield(0,d.lastValueFrom)(n._omnichannelChatService.acceptChat(r)),yield n._maskService.hideMask(c,t.$context)}}yield n.next?.handle(t)})()}};S=(0,s.__decorate)([(0,$.l)({requestType:"crt.AcceptChatRequest",type:"crt.AcceptChatHandler"}),(0,s.__param)(1,(0,$e.j)(ze.V)),(0,s.__metadata)("design:paramtypes",[F.I,He.s])],S);var Ke=a(5240),ge=a(65576);let z=class extends k.S{};z=(0,s.__decorate)([(0,j.$)({type:"crt.SubscribeToChatUpdateRequest"})],z);let A=class extends U.l{constructor(t){super(),this._messageChannelService=t}_subscribeViewModelEvents(t){const n=t.$context;let i=null;const r=new d.Subscription;r.add(n.events$.pipe((0,d.filter)(({type:c})=>c===ge.n.FinishLoadModelAttributes)).subscribe({next:c=>{i=this._messageChannelService.messageEvent$.pipe((0,d.filter)(l=>["AcceptChat","NewIncomingChat","NewTransferredChat","CompleteChat"].includes(l?.header?.sender))).subscribe(()=>{this.handlerChain.process({type:"crt.ReloadChats",$context:n,scopes:t.scopes}).then()})},complete:()=>{i.unsubscribe(),r.unsubscribe()}}))}handle(t){var n=this;return(0,g.A)(function*(){yield n.next?.handle(t),n._subscribeViewModelEvents(t)})()}};A=(0,s.__decorate)([(0,$.l)({requestType:"crt.SubscribeToChatUpdateRequest",type:"crt.SubscribeToChatUpdateHandler"}),(0,s.__metadata)("design:paramtypes",[Ke.A])],A);let K=class extends k.S{};K=(0,s.__decorate)([(0,j.$)({type:"crt.SubscribeToCtiEventsRequest"})],K);let O=class extends U.l{constructor(t){super(),this._customEventService=t}_subscribeViewModelEvents(t){const n=t.$context;let i=null;const r=new d.Subscription;r.add(n.events$.pipe((0,d.filter)(({type:c})=>c===ge.n.FinishLoadModelAttributes)).subscribe({next:c=>{i=this._customEventService.subscribe("CtiModelEvents").subscribe(l=>{const Ge=l[0],h=l[1];n[t.callsAttributeName].then(u=>{switch(Ge){case"callSaved":h.databaseUId&&h.state&&!u.find(Q=>Q.id===h.databaseUId)&&(u=[...u,{schemaName:"Call",id:h.databaseUId,accepted:!0,itemTitle:h.callerId??h.calledId,createdOn:new Date,contact:null,additionalParams:{ctiPanelCallId:h.id}}],n[t.callsAttributeName]=u);break;case"callFinished":u=u.filter(Q=>Q.id!==h.databaseUId),n[t.callsAttributeName]=u;break}})})},complete:()=>{i.unsubscribe(),r.unsubscribe()}}))}handle(t){var n=this;return(0,g.A)(function*(){yield n.next?.handle(t),n._subscribeViewModelEvents(t)})()}};O=(0,s.__decorate)([(0,$.l)({requestType:"crt.SubscribeToCtiEventsRequest",type:"crt.SubscribeToCtiEventsHandler"}),(0,s.__metadata)("design:paramtypes",[me.Dj])],O);var Qe=a(74368);class C{constructor(){this._metadataSchemaUtils=(0,e.inject)(Qe.u)}_getViewConfigs(t){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type","crt.IncomingItems",t.viewConfig).map(n=>n?.viewConfig).filter(Boolean)}_createItemsAttribute(t,n){if(!(0,V.isEmpty)(t.items)||!t.dataAttributes||(0,V.isEmpty)(t.dataAttributes))return;const i=`IncomingItems_${t.name}`,r=n.viewModelConfig.attributes;r[i]={from:t.dataAttributes,converter:"crt.MergeIncomingItems"},t.items=`$${i}`}crtOnMetaDataInit(t){const n=t,i=this._getViewConfigs(n);for(const r of i)this._createItemsAttribute(r,n);return Promise.resolve(t)}static{this.\u0275fac=function(n){return new(n||C)}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac})}}let E=class J{constructor(t){this._materialIconsRegistrator=t,this._materialIconsRegistrator.addIcons([{name:"queued-tasks",icon:a(39443)}])}static{this.\u0275fac=function(n){return new(n||J)(e.\u0275\u0275inject(Y.K))}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:J})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[{provide:ue.m,useClass:C,multi:!0}],imports:[p.CommonModule,ee.U,te.J,ne.a,ie.Q,ae.Z,oe.S,x.q,v.TranslateModule,W.V,q.e,re.o,se.D,x.q]})}};E=(0,s.__decorate)([(0,he.g)({viewElements:[m,f,I],converters:[M,w,_,P],requestHandlers:[S,A,O]}),(0,s.__metadata)("design:paramtypes",[Y.K])],E),function(){(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(E,{declarations:[m,f,I],imports:[p.CommonModule,ee.U,te.J,ne.a,ie.Q,ae.Z,oe.S,x.q,v.TranslateModule,W.V,q.e,re.o,se.D,x.q],exports:[m,I]})}()},39443:Z=>{Z.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M14.0026 8.0013C14.0026 11.3157 11.3157 14.0026 8.0013 14.0026C4.68687 14.0026 2 11.3157 2 8.0013C2 4.68687 4.68687 2 8.0013 2C11.3157 2 14.0026 4.68687 14.0026 8.0013ZM8.83695 4.40039C8.83695 3.93923 8.46311 3.56539 8.00195 3.56539C7.5408 3.56539 7.16695 3.93923 7.16695 4.40039V8.00117C7.16695 8.31745 7.34564 8.60658 7.62853 8.74802L10.0291 9.94828C10.4415 10.1545 10.9431 9.98733 11.1493 9.57485C11.3556 9.16238 11.1884 8.66082 10.7759 8.45459L8.83695 7.48511V4.40039Z" fill="currentColor"/>
</svg>
`}}]);
