(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[36],{10036:(Q,k,l)=>{l.r(k),l.d(k,{ActivityParticipantService:()=>N,AddCalendarSyncAccountHandler:()=>le,AddCalendarSyncAccountRequest:()=>Ee,CAN_USE_CALENDAR_SYNC_LICENSE_OPERATION_CODE:()=>q.I,CalendarAccountType:()=>z,CalendarColorizationType:()=>b,CalendarSettingsService:()=>F,CalendarViewService:()=>H,CalendarViewType:()=>v,ChangeMeetingResponse:()=>m,ChangeMeetingService:()=>D,CreateCalendarRecordHandler:()=>ne,CreateCalendarRecordRequest:()=>xe,CrtCalendarComponent:()=>y,CrtCalendarModule:()=>he,CrtCalendarTileOverflowDirective:()=>R,DEFAULT_LIGHTWEIGHT_MODE_LIMIT:()=>q.B,HighlightCalendarAreaHandler:()=>ie,HighlightCalendarAreaRequest:()=>Te,JoinMeetingHandler:()=>re,JoinMeetingRequest:()=>Pe,JoinMeetingService:()=>O,SendInvitesForActivityHandler:()=>ue,SendInvitesForActivityRequest:()=>de,SendInvitesOnActivitiesSaveHandler:()=>Z,SendInvitesOnActivityParticipantSaveHandler:()=>X,SendInvitesOnActivitySaveHandler:()=>W,SendInvitesOnDeleteRecordsHandler:()=>ee,SetCalendarTimeScaleHandler:()=>oe,SetCalendarTimeScaleRequest:()=>se,SetupCalendarSyncAccountHandler:()=>ce,SetupCalendarSyncAccountRequest:()=>Re,SilenceCreateCalendarRecordHandler:()=>te,SilenceCreateCalendarRecordRequest:()=>Me,TileStyleService:()=>$,ToggleShowWeekendsHandler:()=>K,ToggleShowWeekendsRequest:()=>De,UnhighlightCalendarAreaHandler:()=>ae,UnhighlightCalendarAreaRequest:()=>we});var o=l(5960),P=l(49391),E=l(40297),j=l(52989),Ve=l(55642),B=l(3976),w=l(79772),He=l(28627),$e=l(5476),Ue=l(56484),je=l(36943),Be=l(66989),Le=l(31149),We=l(48629),ze=l(89241),Ye=l(24091),Ge=l(96176),Je=l(43691),ge=l(12841),h=l(73308),s=l(59131),Qe=l(91775),_=l(77592),L=l(34760),rt=l(3671),st=l(96677),ot=l(60776),lt=l(52793),ct=l(10098),fe=l(40953),dt=l(619),ut=l.n(dt),ht=l(48959),gt=l.n(ht),ft=l(47685),mt=l.n(ft),pt=l(87125),yt=l.n(pt),vt=l(6503),V=l(31774),_t=l(68712),me=l(23092),qe=l(26594),Ct=l(65576),Ke=l(73723),p=l(28399),u=l(62278),M=l(29957),St=l(26828),At=l.n(St);class R{constructor(e){this._elementRef=e,this.entriesFunc=t=>{for(const n of t){const i=n.contentRect;if(i.height&&i.height>0){const a=this._elementRef.nativeElement.getElementsByClassName("crt-flex")[0];a?.clientHeight>i.height&&a?.classList?.add("row-direction")}}}}ngAfterViewInit(){this._resizeObserver=new(At())(this.entriesFunc),this._resizeObserver.observe(this._elementRef.nativeElement)}ngOnDestroy(){this._resizeObserver?.disconnect()}static{this.\u0275fac=function(t){return new(t||R)(s.\u0275\u0275directiveInject(s.ElementRef))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:R,selectors:[["","crtCalendarTileOverflow",""]]})}}var b;(function(d){d.Default="default",d.ByField="byField",d.ByOwner="byOwner"})(b||(b={}));var v;(function(d){d.Day="timeGridDay",d.DynamicDays="dynamicTimeGridDay",d.Week="timeGridWeek",d.Month="dayGridMonth",d.DynamicMonths="dynamicDayGridMonth"})(v||(v={}));var q=l(45767),It=l(527);class H{get firstDayOfWeek(){return this._firstDayOfWeek||(this._firstDayOfWeek=this._userInfo?.cultureInfo?.dateTimeFormat?.firstDayOfWeek??this._defaultFirstDayOfWeek),this._firstDayOfWeek}constructor(e,t){this._userInfo=e,this._featureValues=t,this._oneDayInMilliseconds=1e3*60*60*24,this._useDynamicDaysForWeekVwFeatureName="UseDynamicDaysForWeekView",this._defaultFirstDayOfWeek=1,this._firstDayOfWeek=null}_getCurrentWeekPeriod(){const e=new Date,t=e.getDate()-e.getDay()+1,n=t+6;return this._roundTime({start:new Date(new Date(e).setDate(t)),end:new Date(new Date(e).setDate(n))})}_roundTime(e){return{start:new Date(e?.start.setHours(0,0,0)),end:new Date(e?.end.setHours(23,59,59))}}_getWeekendsCount(e,t){let n=0;const i=this.getWeekendDays(),a=new Date(e);for(let r=0;r<t;r++)i.includes(a.getDay())&&n++,a.setDate(a.getDate()+1);return n}_getUserTimezoneOffset(){return this._userInfo.timeZoneOffsetHours*-60}_getWeekDays(){const e=[0,1,2,3,4,5,6];if(!e.includes(this.firstDayOfWeek))return e;for(;e[0]!==this.firstDayOfWeek;)e.push(e.shift());return e}getBusinessDays(){return this._getWeekDays().slice(0,5)}getWeekendDays(){return this._getWeekDays().slice(-2)}fixDates(e,t){if((!e||!t)&&(e=t=e||t),!e&&!t)return this._getCurrentWeekPeriod();e instanceof Date||(e=new Date(e)),t instanceof Date||(t=new Date(t));const n=e>t?{start:t,end:e}:{start:e,end:t};return this._roundTime(n)}getDifferenceInDays(e,t,n){const i=this.fixDates(e,t),a=Math.round((i.end.getTime()-i.start.getTime())/this._oneDayInMilliseconds);if(n)return a;const r=this._getWeekendsCount(i.start,a);return a-r||1}getDifferenceInMonths(e,t){const n=this.fixDates(e,t),i=n.end.getMonth()-n.start.getMonth(),a=n.end.getFullYear()-n.start.getFullYear();return i+a*12}getViewType(e){if(e?.macros)switch(e?.macros){case"[#yesterday#]":case"[#today#]":case"[#tomorrow#]":return v.Day;case"[#previousMonth#]":case"[#currentMonth#]":case"[#nextMonth#]":return v.Month;case"[#previousQuarter#]":case"[#currentQuarter#]":case"[#nextQuarter#]":return v.DynamicMonths;default:return this._featureValues[this._useDynamicDaysForWeekVwFeatureName]?v.DynamicDays:v.Week}else{const t=this.getDifferenceInDays(e?.start,e?.end,!0),n=this.getDifferenceInMonths(e?.start,e?.end);switch(!0){case t<=7:return v.DynamicDays;case(n===0&&t<=31):return v.Month;default:return v.DynamicMonths}}}getUserCurrentTime(e){const t=e.getTimezoneOffset(),n=this._getUserTimezoneOffset();if((0,It.E)(this._userInfo?.timeZoneOffsetHours)&&t!==n){const i=e.getUTCDate()-e.getDate(),a=e.getUTCHours()-n/60+i*24;let r=new Date(new Date(e).setHours(a));const c=a%1;return c>0&&(r=new Date(r.setMinutes(r.getMinutes()+c*60))),r}return e}static{this.\u0275fac=function(t){return new(t||H)(s.\u0275\u0275inject(me.oq),s.\u0275\u0275inject(qe.G))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac,providedIn:"root"})}}var Ze=l(63721),pe=l(49973),ye=l(58504),Xe=l(38071),ve=l(65751),m;(function(d){d[d.Yes=0]="Yes",d[d.No=1]="No",d[d.YesWithNotification=2]="YesWithNotification",d[d.YesWithObsoleteNotification=3]="YesWithObsoleteNotification"})(m||(m={}));class D{constructor(e){this._injector=e,this._canUserChangeMeetingMethod="/rest/MeetingService/CanUserChangeMeeting",this._getMeetingInvitationInfoMethod="/rest/MeetingService/GetMeetingInvitationInfo",this._sendInvitationsMethod="/rest/MeetingService/SendInvitations",this._getOrganizerMeetingIdsMethod="/rest/MeetingService/GetCurrentContactOrganizerMeetingIds",this._invitesFeature="MeetingInvitation",this._httpClient=this._injector.get(Ze.HttpClient),this._featureService=this._injector.get(Xe.wf),this._messageDialogProvider=this._injector.get(V.r),this._queryExecutor=this._injector.get(ve.w)}_confirmInviteSent(e){return this._messageDialogProvider.confirmation(e)}_getSyncSinceDate(e){return this._httpClient.post(this._getMeetingInvitationInfoMethod,{meetingId:e}).pipe((0,u.map)(t=>new Date(t.CalendarSyncSinceDate)))}_checkMeetingInSyncPeriod(e){return this._getSyncSinceDate(e.id).pipe((0,u.map)(t=>e.start>=t||e.oldStart&&e.oldStart>=t))}_confirmMeetingInviteSend(e,t,n,i){return this._checkMeetingInSyncPeriod(e).pipe((0,u.switchMap)(a=>a?i?this._confirmInviteSent(n).pipe((0,u.map)(r=>r?t:m.No)):(0,u.of)(t):(0,u.of)(m.Yes)))}_processCanChangeMeetingResponse(e,t,n){switch(t){case m.Yes:return(0,u.of)(m.Yes);case m.YesWithNotification:return this._confirmMeetingInviteSend(e,m.YesWithNotification,"Calendar.ConfirmResendMeetingInvitationsQuestion",n);case m.YesWithObsoleteNotification:return this._confirmMeetingInviteSend(e,m.YesWithObsoleteNotification,"Calendar.ConfirmResendOnSaveObsoleteMeetingInvitationsQuestion",n);case m.No:return n?this._messageDialogProvider.error("Calendar.CanNotChangeMeetingMessage").pipe((0,u.map)(()=>m.No)):(0,u.of)(m.No)}}_getMeetingOrganizer(e){const t=new pe.s("Activity");return t.addSchemaColumn("Organizer"),t.filters.addSchemaColumnFilterWithParameter(ye.H.Equal,"Id",e),this._queryExecutor.executeSelectQuery(t).pipe((0,u.map)(n=>{const i=n?n[0]:null;return i?i.Organizer:null}))}canUserChangeMeeting(e){return this._featureService.getFeatureState(this._invitesFeature).pipe((0,u.switchMap)(t=>t?this._httpClient.post(this._canUserChangeMeetingMethod,{meetingId:e.id}).pipe((0,u.switchMap)(n=>n<0?Promise.resolve(m.No):this._processCanChangeMeetingResponse(e,n,!0))):(0,u.of)(m.Yes)))}canUserChangeMeetings(e){return this._featureService.getFeatureState(this._invitesFeature).pipe((0,u.switchMap)(t=>t?(0,u.from)(e).pipe((0,u.concatMap)(n=>this._httpClient.post(this._canUserChangeMeetingMethod,{meetingId:n.id}).pipe((0,u.switchMap)(i=>i<0?Promise.resolve(m.No):this._processCanChangeMeetingResponse(n,i,!1)),(0,u.map)(i=>({recordId:n.id,canChange:i})))),(0,u.toArray)()):(0,u.of)(e.map(n=>({recordId:n.id,canChange:m.Yes})))))}isOutdatedMeetingConfirmed(e){return e?this._confirmInviteSent("Calendar.ConfirmResendObsoleteMeetingInvitationsQuestion"):(0,u.of)(!0)}sendInvitations(e){return this._featureService.getFeatureState(this._invitesFeature).pipe((0,u.switchMap)(t=>t?this._httpClient.post(this._sendInvitationsMethod,{meetingId:e}).pipe((0,u.map)(n=>n?.success)):(0,u.of)(!0)))}getCurrentUserOrganizedMeetings(e){return this._featureService.getFeatureState(this._invitesFeature).pipe((0,u.switchMap)(t=>t?this._httpClient.post(this._getOrganizerMeetingIdsMethod,{meetingIds:e}).pipe((0,u.map)(n=>n)):(0,u.of)(e)))}getIntegrationColumnsChanged(e,t){return["Title","StartDate","DueDate","Location","PriorityId","Notes"].some(i=>{const a=t(i);return(0,p.isEmpty)(a)?!1:e.getIsDirty(a)})}getMeetingInvitationInfo(e){return this._featureService.getFeatureState(this._invitesFeature).pipe((0,u.switchMap)(t=>!t||(0,p.isEmpty)(e)?(0,u.of)(null):(0,u.forkJoin)([this._httpClient.post(this._getMeetingInvitationInfoMethod,{meetingId:e}),this._getMeetingOrganizer(e)]).pipe((0,u.map)(([n,i])=>({...n,organizer:i})))))}static{this.\u0275fac=function(t){return new(t||D)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac,providedIn:"root"})}}class O{constructor(e){this._injector=e,this._urlPattern=/(((https?)|(ftp)):\/\/([\-\w])+(\.[a-z]{2,4})*(:[0-9]+)?(\/[%\-\w]+(\.\w{2,})?)*(([\w-.?\/+@&#;`~=%!$-_+*'(),]*)(\.\w{2,})?)*)\/?/gi,this._featureService=this._injector.get(Xe.wf),this._queryExecutor=this._injector.get(ve.w)}_getMeetingServiceLinkMasks(){if(!this._linkMasksObservable){const e=new pe.s("MeetingServiceLink");e.addSchemaColumn("LinkMask"),this._linkMasksObservable=this._queryExecutor.executeSelectQuery(e).pipe((0,u.map)(t=>t.map(n=>n.LinkMask)),(0,u.shareReplay)(1))}return this._linkMasksObservable}_getUrls(e){return(0,p.isEmpty)(e)?[]:e.match(this._urlPattern)||[]}getJoinMeetingLink(e){return this._featureService.getFeatureState("NewMeetingIntegration").pipe((0,u.switchMap)(t=>t?this._getMeetingServiceLinkMasks():(0,u.of)([])),(0,u.map)(t=>{if(!t||t.length===0)return"";const n=`(${t.join("|")})`,i=new RegExp(n,"g"),a=this._getUrls(e);for(const r of a)if(i.test(r))return r;return""}))}static{this.\u0275fac=function(t){return new(t||O)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"})}}var et=l(59969);class ${constructor(e){this.window=e,this._hexExpression=/^#[0-9A-F]{6}[0-9A-F]{0,2}$/i,this._defaultOpacity=.2,this._defaultColor="#0058EF",this._defShadePercentage=50,this._currentIndex=0,this._storageKey="freedomCalendarTileColor",this.pallete=[this._defaultColor,"#22AC14","#0091EA","#FF4013","#7848EE","#FF6534","#009688","#B87CCF","#FFAC07","#A6DE00","#03A9F4","#4F43C2","#00C853","#F9307F","#FF8800","#00BFA5"],this._storage=e.sessionStorage,this._currentIndex=this._getIndexFromStorage()}_getIndexStorageKey(){return`${this._storageKey}_index`}_getStorageKey(e){return`${this._storageKey}_${e}`}_getIndexFromStorage(){const e=this._storage?.getItem(this._getIndexStorageKey());return e?Number(e):0}_getFromStorage(e){return this._storage?.getItem(this._getStorageKey(e))}_addOpacityToColor(e,t){return t=Math.round(Math.min(Math.max(t||1,0),1)*255),e+t.toString(16).toUpperCase()}_saveIndexToStorage(){this._storage?.setItem(this._getIndexStorageKey(),this._currentIndex.toString())}_saveToStorage(e,t){this._storage?.setItem(this._getStorageKey(e),t)}_getNextColorById(e){let t=this._getFromStorage(e)||"";return t.indexOf("#")===-1&&(this._currentIndex>=this.pallete.length&&(this._currentIndex=0),t=this.pallete[this._currentIndex],this._currentIndex++,this._saveIndexToStorage(),this._saveToStorage(e,t)),t}_getShadedColor(e,t){let n=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),a=parseInt(e.substring(5,7),16);n=n*(100-t)/100,i=i*(100-t)/100,a=a*(100-t)/100,n=Math.round(n<255?n:255),i=Math.round(i<255?i:255),a=Math.round(a<255?a:255);const r=n.toString(16).length===1?"0"+n.toString(16):n.toString(16),c=i.toString(16).length===1?"0"+i.toString(16):i.toString(16),g=a.toString(16).length===1?"0"+a.toString(16):a.toString(16);return`#${r}${c}${g}`}_isValidHexColor(e){return this._hexExpression.test(e)}_removeAlphaChannel(e){return e.length>7&&(e=e.substring(0,7)),e}getStylesByColor(e){return(0,p.isEmpty)(e)||!this._isValidHexColor(e)?e=this._defaultColor:e=this._removeAlphaChannel(e),{"border-left":`3px solid ${e}`,"background-color":this._addOpacityToColor(e,this._defaultOpacity),color:this._getShadedColor(e,this._defShadePercentage)}}getStylesById(e){const t=(0,p.isEmpty)(e)?"":this._getNextColorById(e);return this.getStylesByColor(t)}static{this.\u0275fac=function(t){return new(t||$)(s.\u0275\u0275inject(et.ZP))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac,providedIn:"root"})}}class N{constructor(e){this._queryExecutor=e}requestActivityParticipantsAsync(e,t){var n=this;return(0,h.A)(function*(){const i=new pe.s("ActivityParticipant");return i.addSchemaColumn("Participant"),i.addSchemaColumn("Activity"),i.filters.addSchemaColumnInFilterWithParameters(ye.H.Equal,"Activity",t),e&&e.length>0&&i.filters.addSchemaColumnInFilterWithParameters(ye.H.Equal,"Participant",e),Promise.all(yield(0,u.lastValueFrom)(n._queryExecutor.executeSelectQuery(i).pipe((0,u.map)(a=>t.map(r=>({activityId:r,participants:a.filter(c=>c.Activity.value===r).map(c=>({value:c.Participant.value,displayValue:c.Participant.displayValue}))}))))))})()}static{this.\u0275fac=function(t){return new(t||N)(s.\u0275\u0275inject(ve.w))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac,providedIn:"root"})}}var bt=l(6975),Dt=l(12325),Mt=l(84137),xt=l(98297);const Tt=["tileContent"],tt=["calendar"],wt=d=>({"multi-month-view":d}),nt=d=>({color:d});function Pt(d,e){d&1&&s.\u0275\u0275elementContainer(0)}function Et(d,e){if(d&1&&(s.\u0275\u0275elementStart(0,"label",10),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),d&2){const t=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275property("ngStyle",s.\u0275\u0275pureFunction1(2,nt,t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.row.LabelColor)),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.participant," ")}}function Rt(d,e){if(d&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"mat-icon",11),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext(2).$implicit,a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.onJoinBtnClicked(i.event==null||i.event.extendedProps==null?null:i.event.extendedProps.joinUrl))})("keydown.enter",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext(2).$implicit,a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.onJoinBtnClicked(i.event==null||i.event.extendedProps==null?null:i.event.extendedProps.joinUrl))}),s.\u0275\u0275elementEnd()}d&2&&s.\u0275\u0275property("crtTooltip",s.\u0275\u0275pipeBind1(1,1,"Calendar.JoinBtnCaption"))}function Ot(d,e){if(d&1&&(s.\u0275\u0275elementContainerStart(0,6),s.\u0275\u0275template(1,Pt,1,0,"ng-container",7)(2,Et,2,4,"label",8)(3,Rt,2,3,"mat-icon",9),s.\u0275\u0275elementContainerEnd()),d&2){const t=s.\u0275\u0275nextContext().$implicit,n=s.\u0275\u0275nextContext();s.\u0275\u0275property("crtViewModel",t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.row),s.\u0275\u0275advance(),s.\u0275\u0275property("crtTemplateOutletWithCurrentInjector",n.visibleTemplate),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.participant),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",!(t.event!=null&&t.event.allDay)&&n.getJoinBtnVisible(t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.joinUrl,t.event==null?null:t.event.start,t.event==null?null:t.event.end))}}function Nt(d,e){if(d&1&&(s.\u0275\u0275elementStart(0,"label",10),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),d&2){const t=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275property("ngStyle",s.\u0275\u0275pureFunction1(2,nt,t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.row.LabelColor)),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.participant," ")}}function Ft(d,e){if(d&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",12),s.\u0275\u0275element(2,"crt-label",13),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(3,Nt,2,4,"label",8),s.\u0275\u0275elementContainerEnd()),d&2){const t=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275advance(2),s.\u0275\u0275property("caption",t.event==null?null:t.event.title),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.participant)}}function kt(d,e){if(d&1&&(s.\u0275\u0275elementStart(0,"div",3),s.\u0275\u0275template(1,Ot,4,4,"ng-container",4)(2,Ft,4,2,"ng-container",5),s.\u0275\u0275elementEnd()),d&2){const t=e.$implicit,n=s.\u0275\u0275nextContext();s.\u0275\u0275property("ngClass",n.getTileClasses(t.event==null?null:t.event.start,t.event==null?null:t.event.end,t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.row))("ngStyle",t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.tileStyles)("crtTooltip",n.colorizationType==="byOwner"?t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.participant:""),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",(t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.row)&&!n.isLightweightMode),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",(t.event==null||t.event.extendedProps==null?null:t.event.extendedProps.row)&&n.isLightweightMode)}}let y=class Fe extends _t.K{set showWeekends(e){if(e==null)return;this._showWeekends=e;const t=this.calendarComponent?.getApi();if(t?.setOption("hiddenDays",e?[]:this._calendarViewService.getWeekendDays()),t?.view?.type==="dynamicTimeGridDay"&&this._dateRange){const n=this._calendarViewService.getDifferenceInDays(this._dateRange.start,this._dateRange.end,e);t.setOption("dayCount",n),t.gotoDate(this._dateRange.start)}}set timeScale(e){if((0,p.isEmpty)(e))return;this._slotDuration=e;const t=this.calendarComponent?.getApi();t?.setOption("slotDuration",e),t?.render(),this._scrollToCurrentTime()}get colorizationType(){return this._colorizationType}set colorizationType(e){this._colorizationType=e||b.Default}set items(e){this._itemsValueChangeSubscription?.unsubscribe(),this._items=e,this._updateItemsDebounceFn(e),this._itemsValueChangeSubscription=e?.changed?.subscribe(()=>{this._updateItemsDebounceFn(e),this.changeDetectorRef.markForCheck()})}get visibleTemplate(){return this.itemsTemplates?.get(0)}set filters(e){e&&e.forEach(t=>{if(this._dateRange=this._calendarViewService.fixDates(t?.start,t?.end),!this._validateFilterDateRange(this._dateRange)){this._notifyService.show({message:"Calendar.DateRangeError"});return}const n=this.calendarComponent?.getApi(),i=this._calendarViewService.getViewType(t)||n?.view?.type;this._setCalendarDynamicViewOptions(i,this._dateRange),n?.changeView(i,this._dateRange),n?.gotoDate(this._dateRange.start),this._reRenderCalendar()})}set participantFilters(e){e&&(this._filteredParticipants=e.map(t=>t.value))}set templateValuesMapping(e){this._templateValuesMapping=e,this._updateItemsDebounceFn(this._items)}get isMultiMonthView(){return this.calendarComponent?.getApi()?.view?.type===v.DynamicMonths}get isTilesChanged(){return this._items?.isChanged}constructor(e){super(e),this._resizeDebounceFn=(0,p.debounce)(()=>this._reRenderCalendar(),100),this._updateItemsDebounceFn=(0,p.debounce)(this._initItemsUpdate,300),this._scrollDebounceFn=(0,p.debounce)(()=>this._scrollToCurrentTime(),300),this._defStartBusinessTime="09:00",this._defEndBusinessTime="18:00",this._defaultTileColor="#2457e6",this._defaultLabelColor="#0d2e4e",this._defaultDateRangeLimitInDays=365,this._loadingRows=[],this._systemTileInput=this.buildTileInput(),this._colorizationType=b.Default,this._defaultSlotDuration="00:30:00",this.isLightweightMode=!1,this.calendarOptions={height:"auto",eventMinHeight:30,initialView:"timeGridWeek",editable:!0,nowIndicator:!0,headerToolbar:!1,fixedWeekCount:!1,eventInteractive:!0,views:{timeGrid:{slotEventOverlap:!1,slotDuration:this._defaultSlotDuration},dynamicTimeGridDay:{type:"timeGrid",dayCount:1},dynamicDayGridMonth:{type:"multiMonth",duration:{months:1}},dayGridMonth:{dayMaxEventRows:5}},multiMonthMaxColumns:2,selectable:!0,selectMirror:!0,eventBorderColor:"unset",eventBackgroundColor:"unset",plugins:[gt(),ut(),yt(),mt()],eventDidMount:t=>{t.el.ondblclick=n=>this._onTileClick(n,t.event),t.el.onkeydown=n=>{n.key==="Enter"&&this._onTileClick(null,t.event)},t.el.setAttribute("role","button"),t.el.setAttribute("name",t.event.title),t.el.setAttribute("aria-label",t.event.title),this._resizeDebounceFn()},eventChange:t=>this._blockUIChangesWhile(this._onTileChanged(t)),moreLinkContent:t=>M.String.format(this._translateService.instant("Calendar.ExtraEventsTemplate"),t.num),now:()=>this._calendarViewService.getUserCurrentTime(new Date),select:t=>this._onAreaHighlighted(t),unselect:()=>this._onAreaUnHighlighted(),datesSet:()=>this._scrollDebounceFn(),eventClick:t=>{t.jsEvent?.key===" "&&(this._systemTileInput.value=this._systemTileInput.value+" ")}},this.pageSize=150,this.dateRangeLimitInDays=this._defaultDateRangeLimitInDays,this.useAllDayMeeting=!0,this.useAutoScrollToCurrentTime=!0,this.maxDuplicatesByOwner=16,this.loadNextPage=new s.EventEmitter,this.silenceCreate=new s.EventEmitter,this.highlightArea=new s.EventEmitter,this.openEditPage=new s.EventEmitter,this.openPositionedMiniPage=new s.EventEmitter,this._intersectingScrollFn=t=>{t?.at(0)?.isIntersecting&&this._scrollDebounceFn()},this._translateService=e.get(w.TranslateService),this._calendarViewService=e.get(H),this._notifyService=e.get(vt.F),this._userInfo=e.get(me.oq),this._messageDialogProvider=e.get(V.r),this._changeMeetingService=e.get(D),this._joinMeetingService=e.get(O),this._tileStyleService=e.get($),this._participantService=e.get(N),this._features=e.get(qe.G,{optional:!0})}_confirmNextPageLoad(){const e=M.String.format(this._translateService.instant("Calendar.ConfirmNextPage"),this._items?.length);return(0,u.lastValueFrom)(this._messageDialogProvider.confirmation(e))}_roundUpDate(e){e?.setMilliseconds(0)}_roundEndDateToFullDay(e){e?.getHours()===23&&e?.getMinutes()===59&&e.setMinutes(e.getMinutes()+1)}_createEndDate(e,t){const n=new Date(e),i=t?24:1;return n.setHours(n.getHours()+i),n}_validateFilterDateRange(e){const t=e?.start,n=e?.end;return t&&n?Math.abs((n.getTime()-t.getTime())/864e5)<=this.dateRangeLimitInDays:!0}_setCalendarDynamicViewOptions(e,t){if(e===v.DynamicDays){const n=this.calendarComponent?.getApi(),i=(n?.getOption("hiddenDays")??[]).length===0;n?.setOption("dayCount",this._calendarViewService.getDifferenceInDays(t.start,t.end,i))}else e===v.DynamicMonths&&(this.calendarComponent.options.views[v.DynamicMonths].duration.months=this._calendarViewService.getDifferenceInMonths(t.start,t.end)+1)}_tryUpdateDateColumn(e,t,n){var i=this;return(0,h.A)(function*(){const a=yield e[t];i._roundUpDate(a),i._roundUpDate(n),a.getTime()!==n.getTime()&&(e[t]=n)})()}_onTileChanged(e){var t=this;return(0,h.A)(function*(){const n=e.event?.extendedProps?.row;if(!n||!t._templateValuesMapping)return;const i=e.event?.id;if(t._loadingRows.includes(i)){t._loadingRows=t._loadingRows.filter(g=>g!==i);return}if((yield t._validate(e))===m.No){e.revert();return}const r=e.event.end||t._createEndDate(e.event.start,e.event.allDay);yield t._tryUpdateDateColumn(n,t._templateValuesMapping.startColumn,e.event.start),yield t._tryUpdateDateColumn(n,t._templateValuesMapping.endColumn,r),(yield Qe.t.instance.process({type:"crt.SaveRecordRequest",$context:n,scopes:["Tasks_FormPage"]}))||e.revert()})()}_getEventId(e,t){return(0,h.A)(function*(){return`${yield e[e.primaryAttributeName]}_${t}`})()}_getRowId(e){return e.split("_")[0]}_getParticipantId(e){return e.split("_")[1]}_validate(e){var t=this;return(0,h.A)(function*(){if(t._entitySchemaName!=="Activity")return m.Yes;const n=yield(0,u.lastValueFrom)(t._changeMeetingService.canUserChangeMeeting({id:t._getRowId(e.event.id),start:e.event.start,oldStart:e.oldEvent.start}));return e.event.extendedProps.row.ChangeMeetingResponse=n,n})()}_onTileModelChanged(e,t){var n=this;return(0,h.A)(function*(){if(e?.type!==Ct.n.FinishLoadModelAttributes)return;const a=(n.calendarComponent?.getApi()).getEventById(t),r=yield n._items.findByPrimaryAttribute(n._getRowId(t));if(!r||!a)return;n._loadingRows.push(t);const c=yield r[n._templateValuesMapping.startColumn],g=yield r[n._templateValuesMapping.endColumn];n._roundUpDate(c),n._roundUpDate(g),a.setDates(c,g,{allDay:n._getIsFullDay(c,g)}),n.changeDetectorRef.detectChanges()})()}_onTileClick(e,t){var n=this;return(0,h.A)(function*(){n.miniPageSchemaName&&e?n.openPositionedMiniPage.emit({schemaName:n.miniPageSchemaName,recordId:n._getRowId(t.id),offsetX:e.clientX,offsetY:e.clientY}):n.openEditPage.emit({schemaName:n._entitySchemaName,recordId:n._getRowId(t.id)})})()}_onAreaHighlighted(e){this._createEventDraft={startDate:e.allDay?this._resetHours(e.start):e.start,endDate:e.allDay?this._resetHours(e.end):e.end},this.highlightArea.emit(this._createEventDraft),this._highlightedTileRef=e.jsEvent.target,this._systemTileInput.value="",this._highlightedTileRef?.appendChild(this._systemTileInput),this._systemTileInput.focus()}_onAreaUnHighlighted(){this._onTileInputFocusOut(this._systemTileInput)}_resetHours(e){return new Date(e.setHours(0,0,0,0))}buildTileInput(){const e=document.createElement("input");return e.addEventListener("keypress",t=>this._onTileInputKeyPressed(t,e)),e.addEventListener("keydown",t=>this._onTileInputEscaped(t,e)),e.classList.add("calendar-system-input"),e}_releaseHighlightedTile(e){e.value=M.emptyString,this._highlightedTileRef?.remove(),this._highlightedTileRef=null,this._createEventDraft=null}_onTileInputKeyPressed(e,t){e.key==="Enter"&&(this._createEventIfTitleExists(t?.value),this._releaseHighlightedTile(t))}_onTileInputFocusOut(e){this._createEventIfTitleExists(e?.value),this._releaseHighlightedTile(e)}_onTileInputEscaped(e,t){e.key==="Escape"&&this._releaseHighlightedTile(t)}_createEventIfTitleExists(e){e&&(this._createEventDraft.title=e,this.silenceCreate.emit(this._createEventDraft))}_setEntitySchemaNameAsync(e){var t=this;return(0,h.A)(function*(){if(!(0,p.isEmpty)(t._entitySchemaName))return;const n=yield e[0].getPrimaryDataSchema();t._entitySchemaName=n?.name||""})()}_mapEventAsync(e,t,n){var i=this;return(0,h.A)(function*(){const a=yield i._getEventId(e,n?.value);if(!(yield e.HasEvent))t?.getEventById(a)?.remove();else return null;const r=yield e[i._templateValuesMapping.startColumn],c=yield e[i._templateValuesMapping.endColumn];i._roundEndDateToFullDay(c),i._roundUpDate(r),e.events$.subscribe(f=>i._onTileModelChanged(f,a)),e.HasEvent=!0,e.LabelColor=i._defaultLabelColor;const g=e[i._templateValuesMapping.titleColumn];return{id:a,title:i._toDisplayValue(yield g),start:r,end:c,backgroundColor:"unset",allDay:i._getIsFullDay(r,c),extendedProps:{row:e,joinUrl:yield i._getJoinUrl(e),tileStyles:yield i._getTileStyles(e,a),participant:n?.displayValue}}})()}_getIsFullDay(e,t){return e&&t&&this.useAllDayMeeting?t.getTime()-e.getTime()>=24*36e5:!1}_actualizeApiEvents(e){var t=this;return(0,h.A)(function*(){const n=yield Promise.all(e.map(function(){var r=(0,h.A)(function*(c){return yield c[c.primaryAttributeName]});return function(c){return r.apply(this,arguments)}}()));t._getApiEvents().filter(r=>!n.includes(t._getRowId(r.id))).forEach(r=>r?.remove()),t.crtCalendarTilesOverflow.forEach(r=>{r.ngAfterViewInit()})})()}_getApiEvents(){return this.calendarComponent?.getApi()?.getEvents()||[]}_initItemsUpdate(e){return this._actualizeLightweightMode(),this._updateItems(e)}_updateItems(e){var t=this;return(0,h.A)(function*(){const n=t.calendarComponent?.getApi();if(!e||e.length===0||!t._templateValuesMapping){n?.removeAllEventSources();return}e?.some(g=>g.HasEvent===!0)||n?.removeAllEventSources(),yield t._setEntitySchemaNameAsync(e);let a=[];if(t._entitySchemaName==="Activity"&&t.colorizationType===b.ByOwner&&t._filteredParticipants)a=yield t._duplicateEventsByParticipants(e,t._filteredParticipants);else for(const g of e)a.push(yield t._mapEventAsync(g,n,null));const r=yield Promise.all(a),c=r.filter(g=>!!g);r.length===c.length?n?.removeAllEventSources():yield t._actualizeApiEvents(e),n?.addEventSource(c),e.length%t.pageSize===0&&(yield t._confirmNextPageLoad())&&t.loadNextPage.emit()})()}_duplicateEventsByParticipants(e,t){var n=this;return(0,h.A)(function*(){const i=[],a=n.calendarComponent?.getApi(),r=yield Promise.all(e.map(g=>g[g.primaryAttributeName])),c=yield n._participantService.requestActivityParticipantsAsync(t,r);for(const g of e){const f=yield g[g.primaryAttributeName];c.find(A=>f===A.activityId).participants.slice(0,n.maxDuplicatesByOwner).forEach(A=>i.push(n._mapEventAsync(g,a,A)))}return i})()}_reRenderCalendar(){this.calendarComponent?.getApi()?.render()}_setBusinessTime(){const e=this.calendarComponent?.getApi();e?.setOption("firstDay",this._calendarViewService.firstDayOfWeek);const t={startTime:(0,p.isEmpty)(this.startBusinessTime)?this._defStartBusinessTime:this.startBusinessTime,endTime:(0,p.isEmpty)(this.endBusinessTime)?this._defEndBusinessTime:this.endBusinessTime,daysOfWeek:this._calendarViewService.getBusinessDays()};e?.setOption("businessHours",t)}_setDateAndTimeFormat(){const e=this.calendarComponent?.getApi(),t=this._userInfo;e?.setOption("locale",t.cultureInfo.sysCultureName),e?.setOption("slotLabelFormat",n=>(0,fe.formatDate)(n.date.marker,{hour:"numeric",minute:"2-digit",timeZone:"UTC",locale:t.cultureInfo.dateTimeFormat.code})),e?.setOption("slotLabelContent",n=>n.text.replace(/:00 AM/g,"am").replace(/:00 PM/g,"pm")),e?.setOption("dayHeaderFormat",n=>e?.view.type===v.DynamicMonths||e?.view.type===v.Month?(0,fe.formatDate)(n.date.marker,{weekday:"short",omitCommas:!0,timeZone:"UTC",locale:t.cultureInfo.dateTimeFormat.code}):(0,fe.formatDate)(n.date.marker,{weekday:"short",month:"numeric",day:"numeric",omitCommas:!0,timeZone:"UTC",locale:t.cultureInfo.dateTimeFormat.code}))}_scrollToCurrentTime(){if(!this.useAutoScrollToCurrentTime)return;const e=this.calendarWrapElement?.nativeElement,t=e?.querySelector(".fc-timegrid-now-indicator-arrow");if(t){const n=this._findClosestScrolledEl(this.calendarWrapElement.nativeElement,"crt-flex .crt-flex"),i=e?.querySelector(".fc-scroller-harness .fc-scroller .fc-timegrid-body");if(n&&i){const a=this._getOffsetTop(i,n),r=t.offsetTop+a-n.clientHeight/2;n?.scroll({top:r,behavior:"smooth"})}}}_getOffsetTop(e,t){let n=0,i=e;for(;i&&i.offsetParent!==t.offsetParent;)n+=i.offsetTop,i=i.offsetParent;return n}_findClosestScrolledEl(e,t){if(!e)return;let n=e.parentElement;for(;n;){const i=n.closest(t),{overflow:a}=window.getComputedStyle(i),r=n.parentElement===i,c=a.split(" ").some(f=>f==="auto"||f==="scroll"),g=n.offsetHeight>i.offsetHeight;if(r&&c&&g)return i;n=n.parentElement}return document.documentElement}_getJoinUrl(e){var t=this;return(0,h.A)(function*(){if((0,p.isEmpty)(t._templateValuesMapping.notesColumn))return"";const n=yield e[t._templateValuesMapping.notesColumn];return(0,u.lastValueFrom)(t._joinMeetingService.getJoinMeetingLink(n))})()}_getTileStyles(e,t){var n=this;return(0,h.A)(function*(){let i;switch(n.colorizationType){case b.ByField:(0,p.isEmpty)(n._templateValuesMapping.colorizationColumn)||(i=yield e[n._templateValuesMapping.colorizationColumn]);break;case b.ByOwner:i={value:n._getParticipantId(t)};break;default:return null}const a=i?i.primaryColorValue:n._defaultTileColor,r=a?n._tileStyleService.getStylesByColor(a):n._tileStyleService.getStylesById(i.value);return n.colorizationType===b.ByField&&r&&r.color&&e&&(e.LabelColor=r.color),r})()}_blockUIChangesWhile(e){var t=this;return(0,h.A)(function*(){const n=t.calendarComponent?.getApi();t._setCalendarUILock(n,!0);try{yield e}catch{}finally{t._setCalendarUILock(n,!1)}})()}_setCalendarUILock(e,t){e.setOption("editable",!t),e.setOption("selectable",!t)}_actualizeLightweightMode(){this.isLightweightMode=(this._items?.length??-1)>=(this.lightweightModeLimit??q.B)}_toDisplayValue(e){return e?.displayValue||e?.value||e}getTileClasses(e,t,n){const i=[];n?i.push(this.colorizationType):i.push(b.Default);const a=new Date,r=this._calendarViewService.getUserCurrentTime(a);return e<=r&&r<=t?i.push("present"):e<r&&t<r?i.push("past"):i.push("future"),i}ngAfterViewInit(){this._setBusinessTime(),this._resizeObserver=new ResizeObserver(this._resizeDebounceFn),this._resizeObserver.observe(this.calendarWrapElement.nativeElement),this._setDateAndTimeFormat(),this._reInitCalendarProperties(),this._intersectionObserver=new IntersectionObserver(this._intersectingScrollFn),this._intersectionObserver.observe(this.calendarWrapElement.nativeElement)}_reInitCalendarProperties(){this._features?.ExtraCalendarDataReloading&&(this.timeScale=this._slotDuration,this._dateRange&&(this.filters=[{start:this._dateRange.start,end:this._dateRange.end}]),this.showWeekends=this._showWeekends,this.items=this._items)}ngOnDestroy(){this._itemsValueChangeSubscription?.unsubscribe(),this._items?.forEach(e=>e.HasEvent=!1),this._resizeObserver?.disconnect()}getJoinBtnVisible(e,t,n){const i=this.calendarComponent?.getApi();let a=new Date;const r=this._calendarViewService.getUserCurrentTime(a);a=new Date,a.setMinutes(a.getMinutes()+15);const c=this._calendarViewService.getUserCurrentTime(a);return!(0,p.isEmpty)(e)&&(t<=r&&r<=n||r<=t&&t<=c)&&i?.getCurrentData()?.options?.type==="timeGrid"}onJoinBtnClicked(e){return(0,h.A)(function*(){const t={type:"crt.JoinMeetingRequest",joinUrl:e,$context:null};yield Qe.t.instance.process(t)})()}static{this.\u0275fac=function(t){return new(t||Fe)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Fe,selectors:[["crt-calendar"]],contentQueries:function(t,n,i){if(t&1&&s.\u0275\u0275contentQuery(i,Tt,4,s.TemplateRef),t&2){let a;s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(n.itemsTemplates=a)}},viewQuery:function(t,n){if(t&1&&(s.\u0275\u0275viewQuery(tt,5),s.\u0275\u0275viewQuery(tt,5,s.ElementRef),s.\u0275\u0275viewQuery(R,5)),t&2){let i;s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.calendarComponent=i.first),s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.calendarWrapElement=i.first),s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.crtCalendarTilesOverflow=i)}},inputs:{pageSize:"pageSize",dateRangeLimitInDays:"dateRangeLimitInDays",useAllDayMeeting:"useAllDayMeeting",useAutoScrollToCurrentTime:"useAutoScrollToCurrentTime",startBusinessTime:"startBusinessTime",endBusinessTime:"endBusinessTime",maxDuplicatesByOwner:"maxDuplicatesByOwner",miniPageSchemaName:"miniPageSchemaName",lightweightModeLimit:"lightweightModeLimit",showWeekends:"showWeekends",timeScale:"timeScale",colorizationType:"colorizationType",items:"items",filters:"filters",participantFilters:"participantFilters",templateValuesMapping:"templateValuesMapping"},outputs:{loadNextPage:"loadNextPage",silenceCreate:"silenceCreate",highlightArea:"highlightArea",openEditPage:"openEditPage",openPositionedMiniPage:"openPositionedMiniPage"},features:[s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:4,consts:[["calendar",""],["eventContent",""],[3,"options","ngClass"],["crtCalendarTileOverflow","",1,"calendar-tile",3,"ngClass","ngStyle","crtTooltip"],[3,"crtViewModel",4,"ngIf"],[4,"ngIf"],[3,"crtViewModel"],[4,"crtTemplateOutletWithCurrentInjector"],["class","participant-name crt-label",3,"ngStyle",4,"ngIf"],["class","join-button","svgIcon","join-button-icon","tabindex","0",3,"crtTooltip","click","keydown.enter",4,"ngIf"],[1,"participant-name","crt-label",3,"ngStyle"],["svgIcon","join-button-icon","tabindex","0",1,"join-button",3,"click","keydown.enter","crtTooltip"],[1,"tile-lightweight"],["labelThickness","semibold",3,"caption"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"full-calendar",2,0),s.\u0275\u0275template(2,kt,3,5,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementEnd()),t&2&&s.\u0275\u0275property("options",n.calendarOptions)("ngClass",s.\u0275\u0275pureFunction1(2,wt,n.isMultiMonthView))},dependencies:[E.NgClass,E.NgIf,E.NgStyle,j.MatIcon,B.FullCalendarComponent,bt.aD,Dt.V,Mt.d,xt.v,R,w.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}crt-calendar full-calendar{--fc-event-border-color: transparent;--fc-border-color: var(--crt-palette-border-400);--fc-now-indicator-color: var(--crt-palette-navigation-primary-500);--fc-non-business-color: rgb(217 217 217 / 15%);font-family:var(--crt-font-family, var(--font-family))}@-moz-document url-prefix(){crt-calendar full-calendar.multi-month-view .fc-view-harness.fc-view-harness-passive{display:table;table-layout:fixed;width:100%}}crt-calendar full-calendar .fc-view.fc-timegrid .fc-timegrid-now-indicator-container{overflow:visible}crt-calendar full-calendar .fc-view.fc-timegrid .fc-timegrid-now-indicator-container div.fc-timegrid-now-indicator-line{z-index:2}crt-calendar full-calendar .fc-view.fc-timegrid .fc-timegrid-now-indicator-container div.fc-timegrid-now-indicator-arrow{scroll-margin:30px;scroll-snap-margin-top:30px;background-color:var(--fc-now-indicator-color);width:105%;height:1px;border:unset;margin-top:unset;z-index:2}crt-calendar full-calendar .fc-view.fc-timegrid .fc-timegrid-now-indicator-container .fc-timegrid-now-indicator-line:before{position:absolute;display:block;content:"";margin-top:-4px;width:7px;height:7px;border-radius:50%;border:1px solid var(--reactist-bg-default);background-color:var(--fc-now-indicator-color);left:calc(var(--fc-now-indicator-shift) - 3px)}crt-calendar full-calendar .fc-view.fc-timegrid .fc-timegrid-now-indicator-container .fc-timegrid-now-indicator-line{width:calc(700% + 6px)}crt-calendar full-calendar .fc-view.fc-timegrid .fc-day:nth-child(2) .fc-timegrid-now-indicator-line{--fc-now-indicator-shift: 0%}crt-calendar full-calendar .fc-view.fc-timegrid .fc-day:nth-child(3) .fc-timegrid-now-indicator-line{--fc-now-indicator-shift: 14.29%}crt-calendar full-calendar .fc-view.fc-timegrid .fc-day:nth-child(4) .fc-timegrid-now-indicator-line{--fc-now-indicator-shift: 28.57%}crt-calendar full-calendar .fc-view.fc-timegrid .fc-day:nth-child(5) .fc-timegrid-now-indicator-line{--fc-now-indicator-shift: 42.86%}crt-calendar full-calendar .fc-view.fc-timegrid .fc-day:nth-child(6) .fc-timegrid-now-indicator-line{--fc-now-indicator-shift: 57.14%}crt-calendar full-calendar .fc-view.fc-timegrid .fc-day:nth-child(7) .fc-timegrid-now-indicator-line{--fc-now-indicator-shift: 71.43%}crt-calendar full-calendar .fc-view.fc-timegrid .fc-day:nth-child(8) .fc-timegrid-now-indicator-line{--fc-now-indicator-shift: 85.71%}crt-calendar full-calendar .fc-view.fc-timegrid .fc-day .fc-timegrid-now-indicator-line{transform:translate(calc(-1 * var(--fc-now-indicator-shift)))}crt-calendar full-calendar .fc-timegrid-bg-harness .fc-highlight{background:unset}crt-calendar full-calendar .calendar-tile .crt-flex crt-label label.mat-caption{cursor:pointer}crt-calendar full-calendar .calendar-tile,crt-calendar full-calendar .crt-flex{overflow:hidden;padding-top:2px}crt-calendar full-calendar .calendar-tile{container-type:inline-size;width:100%}@container (max-width: 30px){crt-calendar full-calendar .calendar-tile .join-button{display:none}}crt-calendar full-calendar .calendar-tile .crt-flex{align-content:flex-start;column-gap:5px}crt-calendar full-calendar .calendar-tile .crt-flex.row-direction{flex-flow:row nowrap!important;width:max-content}crt-calendar full-calendar .fc-v-event{border:unset}crt-calendar full-calendar .fc-v-event .fc-event-main .calendar-tile{height:100%;width:100%;padding:4px;border-radius:4px}crt-calendar full-calendar .fc-v-event .fc-event-main .calendar-tile.default.present{border-left:3px solid #2457e6;background-color:#d3ddfacc}crt-calendar full-calendar .fc-v-event .fc-event-main .calendar-tile.default.future{border-left:3px solid #c6d3f8;background-color:#eff9fdcc;box-shadow:1px 1px #2457e63d}crt-calendar full-calendar .fc-v-event .fc-event-main .calendar-tile.default.past{border:1px solid #e7e7e7;background-color:#fffc;box-shadow:1px 1px #0000000a}crt-calendar full-calendar .fc-v-event .fc-event-main .calendar-tile.default .join-button{color:#2457e6}crt-calendar full-calendar .fc-v-event .fc-event-main .calendar-tile.past{padding-left:7px}crt-calendar full-calendar .fc-day .fc-daygrid-day-number{font-size:var(--crt-caption-font-size);font-weight:var(--crt-headline-1-font-weight);line-height:var(--crt-overline-line-height)}crt-calendar full-calendar .fc-day:not(.fc-day-today){color:var(--crt-palette-foreground-500)}crt-calendar full-calendar .fc-day.fc-daygrid-day .fc-daygrid-day-frame.fc-scrollgrid-sync-inner .fc-daygrid-day-bg .fc-daygrid-bg-harness .fc-highlight{z-index:6;background-color:#bce8f1cc}crt-calendar full-calendar .fc-day.fc-daygrid-day .fc-daygrid-day-frame.fc-scrollgrid-sync-inner .fc-daygrid-day-bg .fc-daygrid-bg-harness .fc-highlight .calendar-system-input{width:calc(100% - 15px)}crt-calendar full-calendar .fc-day.fc-day-today .fc-daygrid-day-frame.fc-scrollgrid-sync-inner{position:relative}crt-calendar full-calendar .fc-day.fc-day-today .fc-daygrid-day-frame.fc-scrollgrid-sync-inner .fc-daygrid-day-top{color:var(--crt-palette-background-100)}crt-calendar full-calendar .fc-day.fc-day-today .fc-daygrid-day-frame.fc-scrollgrid-sync-inner .fc-daygrid-day-top:after{position:absolute;top:2px;right:1px;padding:9px;border-radius:4px;background-color:var(--fc-now-indicator-color);content:""}crt-calendar full-calendar .fc-day.fc-day-today .fc-daygrid-day-frame.fc-scrollgrid-sync-inner .fc-daygrid-day-bg .fc-daygrid-bg-harness .fc-highlight{z-index:6;background-color:#bce8f1cc}crt-calendar full-calendar .fc-day.fc-day-today .fc-daygrid-day-frame.fc-scrollgrid-sync-inner .fc-daygrid-day-bg .fc-daygrid-bg-harness .fc-highlight .calendar-system-input{width:calc(100% - 20px)}crt-calendar full-calendar .fc-daygrid-day-events .fc-daygrid-event-harness a.fc-event{border:unset}crt-calendar full-calendar .fc-daygrid-day-events .fc-daygrid-event-harness a.fc-event .calendar-tile{max-height:36px;white-space:pre-wrap;padding:4px}crt-calendar full-calendar .fc-daygrid-day-events .fc-daygrid-event-harness a.fc-event.fc-daygrid-block-event.fc-h-event .calendar-tile{max-height:24px;border-radius:4px}crt-calendar full-calendar .fc-daygrid-day-events .fc-daygrid-event-harness a.fc-event.fc-daygrid-block-event.fc-h-event .calendar-tile.default.present,crt-calendar full-calendar .fc-daygrid-day-events .fc-daygrid-event-harness a.fc-event.fc-daygrid-block-event.fc-h-event .calendar-tile.default.past{background-color:#d3ddfacc}crt-calendar full-calendar .fc-daygrid-day-events .fc-daygrid-event-harness a.fc-event.fc-daygrid-block-event.fc-h-event .calendar-tile.default.future{background-color:#eff9fdcc}crt-calendar full-calendar .fc-daygrid-day-events .fc-daygrid-day-bottom{float:right}crt-calendar full-calendar .fc-daygrid-day-events .fc-daygrid-day-bottom .fc-daygrid-more-link{font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased;text-align:right;color:var(--crt-palette-link-500)}crt-calendar full-calendar .fc-view-harness .fc-view.fc-timegrid table.fc-scrollgrid,crt-calendar full-calendar .fc-view-harness .fc-view.fc-daygrid table.fc-scrollgrid,crt-calendar full-calendar .fc-view-harness .fc-view.fc-multimonth{border-color:var(--fc-event-border-color)}crt-calendar full-calendar .fc-view-harness .fc-popover{z-index:999}crt-calendar full-calendar .fc-timegrid-event-harness-inset .fc-timegrid-event{box-shadow:unset}crt-calendar full-calendar .fc-timegrid-event-harness-inset .fc-timegrid-event:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}crt-calendar full-calendar .fc-timegrid-event-harness-inset .fc-timegrid-event:focus-visible .fc-event-main{padding:1px}crt-calendar full-calendar .fc-timegrid-event-harness-inset .fc-timegrid-event:focus-visible:after{border-radius:4px;background-color:unset}crt-calendar full-calendar th.fc-col-header-cell.fc-day{border-left-color:var(--fc-event-border-color);border-right-color:var(--fc-event-border-color);border-top-color:var(--fc-event-border-color)}crt-calendar full-calendar th.fc-col-header-cell.fc-day.fc-day-today .fc-scrollgrid-sync-inner{border-bottom:2px solid var(--fc-now-indicator-color)}crt-calendar full-calendar .fc-timegrid-slot-label-cushion,crt-calendar full-calendar .fc-timegrid-axis-cushion,crt-calendar full-calendar .fc-col-header-cell-cushion{font-weight:var(--crt-caption-font-weight);font-size:var(--crt-caption-font-size);color:var(--crt-palette-label-500)}crt-calendar full-calendar .fc-multimonth-header .fc-multimonth-title{font-size:var(--crt-headline-2-font-size);font-weight:var(--crt-caption-font-weight);color:var(--crt-palette-label-contrast-50)}crt-calendar full-calendar td.fc-day.fc-day-today.fc-timegrid-col,crt-calendar full-calendar td.fc-day.fc-day-today.fc-daygrid-day{background-color:unset}crt-calendar full-calendar a.fc-event.fc-event-draggable.fc-daygrid-event.fc-daygrid-block-event.fc-h-event.fc-event-resizable,crt-calendar full-calendar a.fc-event.fc-event-draggable.fc-daygrid-event.fc-daygrid-block-event.fc-h-event.fc-event-past,crt-calendar full-calendar a.fc-event.fc-event-draggable.fc-daygrid-event.fc-daygrid-block-event.fc-h-event.fc-event-start{border:unset}crt-calendar full-calendar td.fc-timegrid-slot.fc-timegrid-slot-minor.fc-timegrid-slot-label,crt-calendar full-calendar td.fc-timegrid-slot.fc-timegrid-slot-minor.fc-timegrid-slot-lane{border-top:unset}crt-calendar full-calendar .fc-scroller-harness .fc-timegrid-body .fc-timegrid-slots tr td.fc-timegrid-slot{height:25px}crt-calendar full-calendar .fc-dayGridMonth-view .fc-scroller-harness .fc-daygrid-body td .fc-daygrid-day-frame{height:150px}crt-calendar .crt-calendar-manage-changes-panel{max-width:80%;overflow:hidden;position:absolute;z-index:3;bottom:20px;left:50%}crt-calendar .calendar-system-input{border:none;background:transparent;color:var(--crt-palette-label-900);outline:none;font-family:var(--crt-font-family, var(--font-family));font-weight:600;font-size:var(--crt-caption-font-size);width:100%}crt-calendar .tile-lightweight{width:max-content}crt-calendar .participant-name{display:flex;margin-top:8px;cursor:pointer}
`],encapsulation:2})}};(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Object)],y.prototype,"pageSize",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Object)],y.prototype,"dateRangeLimitInDays",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Object)],y.prototype,"useAllDayMeeting",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Object)],y.prototype,"useAutoScrollToCurrentTime",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",M.String)],y.prototype,"startBusinessTime",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",M.String)],y.prototype,"endBusinessTime",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Object)],y.prototype,"maxDuplicatesByOwner",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",M.String)],y.prototype,"miniPageSchemaName",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Number)],y.prototype,"lightweightModeLimit",void 0),(0,o.__decorate)([(0,L.j)(),(0,o.__metadata)("design:type",Object)],y.prototype,"loadNextPage",void 0),(0,o.__decorate)([(0,L.j)(),(0,o.__metadata)("design:type",Object)],y.prototype,"silenceCreate",void 0),(0,o.__decorate)([(0,L.j)(),(0,o.__metadata)("design:type",Object)],y.prototype,"highlightArea",void 0),(0,o.__decorate)([(0,L.j)(),(0,o.__metadata)("design:type",Object)],y.prototype,"openEditPage",void 0),(0,o.__decorate)([(0,L.j)(),(0,o.__metadata)("design:type",Object)],y.prototype,"openPositionedMiniPage",void 0),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Boolean),(0,o.__metadata)("design:paramtypes",[Boolean])],y.prototype,"showWeekends",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",M.String),(0,o.__metadata)("design:paramtypes",[M.String])],y.prototype,"timeScale",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",M.String),(0,o.__metadata)("design:paramtypes",[M.String])],y.prototype,"colorizationType",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Ke.A),(0,o.__metadata)("design:paramtypes",[Ke.A])],y.prototype,"items",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Array),(0,o.__metadata)("design:paramtypes",[Array])],y.prototype,"filters",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Array),(0,o.__metadata)("design:paramtypes",[Array])],y.prototype,"participantFilters",null),(0,o.__decorate)([(0,_.k)(),(0,o.__metadata)("design:type",Object),(0,o.__metadata)("design:paramtypes",[Object])],y.prototype,"templateValuesMapping",null),y=(0,o.__decorate)([(0,rt.v)({type:"crt.Calendar",contentSlots:[{name:"tileContent",lazy:!0,input:!1}],reuseStrategy:st.B.Reuse,compatibleAPIs:{[ot.I.Filtration]:!0}}),(0,lt.f)({toolbarConfig:{position:310,icon:l(95226),defaultPropertyValues:{tileContent:[]}},propertiesPanelComponentTypeName:"crt.CalendarPropertiesPanelComponent",designViewItemCommands:{delete:"crt.RemoveCalendarCommand",create:"crt.AddCalendarCommand"},viewElementGroupType:ct.J.Components,typeCaption:"Components.CalendarCaption"}),(0,o.__metadata)("design:paramtypes",[s.Injector])],y);var U=l(4164);let _e=class{constructor(e){this._joinMeetingService=e}convert(e){var t=this;return(0,h.A)(function*(){return(0,u.lastValueFrom)(t._joinMeetingService.getJoinMeetingLink(e))})()}};_e=(0,o.__decorate)([(0,U.a)({type:"crt.ToJoinUrlConverter"}),(0,o.__metadata)("design:paramtypes",[O])],_e);let Ce=class{constructor(e){this._changeMeetingService=e}convert(e){const t=e?.value||e;return(0,u.lastValueFrom)(this._changeMeetingService.getMeetingInvitationInfo(t))}};Ce=(0,o.__decorate)([(0,U.a)({type:"crt.ToMeetingInvitationInfo"}),(0,o.__metadata)("design:paramtypes",[D])],Ce);let Se=class{convert(e){return!e||!e.HasCalendarIntegration}};Se=(0,o.__decorate)([(0,U.a)({type:"crt.ToSendInviteDisabled"})],Se);let Ae=class{constructor(e){this._userInfo=e}convert(e){return!e||!e.IsParticipantsExist||e.organizer?.value!==this._userInfo.contactId?!1:!e.HasCalendarIntegration||e.IsSynchronized}};Ae=(0,o.__decorate)([(0,U.a)({type:"crt.ToSendInviteVisible"}),(0,o.__metadata)("design:paramtypes",[me.oq])],Ae);let Ie=class{convert(e){return!e||e.IsOutdatedMeeting}};Ie=(0,o.__decorate)([(0,U.a)({type:"crt.ToSendInviteIsOutdated"})],Ie);let be=class{convert(e){return!!e}};be=(0,o.__decorate)([(0,U.a)({type:"crt.ToSendInviteIsStartDateUpdated"})],be);var T=l(81517),x=l(2828),I=l(41287),S=l(844);let De=class extends T.S{constructor(){super(...arguments),this.type="crt.ToggleShowWeekendsRequest"}};De=(0,o.__decorate)([(0,x.$)({type:"crt.ToggleShowWeekendsRequest"})],De);let K=class extends I.l{_toggleShowWeekends(e){return(0,h.A)(function*(){const{$context:t,showWeekendsAttributeName:n}=e??{},i=yield t[n];return t[n]=!i,!0})()}handle(e){var t=this;return(0,h.A)(function*(){return e?yield t._toggleShowWeekends(e):!1})()}};K=(0,o.__decorate)([(0,S.l)({type:"crt.ToggleShowWeekendsHandler",requestType:"crt.ToggleShowWeekendsRequest"})],K);let Z=class extends I.l{constructor(e,t,n){super(),this._messageDialogProvider=e,this._changeMeetingService=t,this._translateService=n}_getIntegrationColumnsChanged(e,t,n){return this._changeMeetingService.getIntegrationColumnsChanged(e,i=>{const a=t.getViewModelAttributePath(n,i);return(0,p.isEmpty)(a)?"":a.split(".")[1]})}_mapChanges(e,t){var n=this;return(0,h.A)(function*(){const i=t.$context.getBoundDataSourceName(t.itemsAttributeName),a=t.$context.getViewModelAttributePath(i,"StartDate").split(".");return(yield Promise.all(e.map(function(){var c=(0,h.A)(function*(g){return n._getIntegrationColumnsChanged(g,t.$context,i)?{id:yield g[g.primaryAttributeName],start:yield g[a[1]]}:null});return function(g){return c.apply(this,arguments)}}()))).filter(c=>!!c)})()}_getDisplayValues(e,t,n){return(0,h.A)(function*(){const i=yield e[0].getPrimaryDataSchema(),a=n.$context.getBoundDataSourceName(n.itemsAttributeName),r=e[0].getViewModelAttributePath(a,i.primaryDisplayAttributeName);return(yield Promise.all(e.map(function(){var g=(0,h.A)(function*(f){const C=yield f[f.primaryAttributeName];return t.some(A=>A.recordId===C)?yield f[r]:Promise.resolve("")});return function(f){return g.apply(this,arguments)}}()))).filter(g=>!(0,p.isEmpty)(g))})()}_processForbiddenMeetings(e,t,n){var i=this;return(0,h.A)(function*(){const a=e.filter(g=>g.canChange===m.No);if(a.length===0)return!0;const r=yield i._getDisplayValues(t,a,n),c=`${i._translateService.instant("Calendar.CanNotChangeMultipleMeetingsMessage")} ${r.join(", ")}`;return yield(0,u.lastValueFrom)(i._messageDialogProvider.info(c)),!1})()}_processInviteConfirmationMeetings(e,t,n){var i=this;return(0,h.A)(function*(){if(e.length===0)return!0;const a=yield i._getDisplayValues(t,e,n),r=`${i._translateService.instant("Calendar.ConfirmResendMultipleMeetingsInvitationsQuestion")} ${a.join(", ")}`;return(0,u.lastValueFrom)(i._messageDialogProvider.confirmation(r))})()}_sendInvites(e){var t=this;return(0,h.A)(function*(){const i=(yield(0,u.lastValueFrom)((0,u.from)(e).pipe((0,u.concatMap)(a=>t._changeMeetingService.sendInvitations(a.recordId)),(0,u.toArray)()))).some(a=>!a);yield(0,u.lastValueFrom)(i?t._messageDialogProvider.error("Calendar.ErrorSendingInvitationMessage"):t._messageDialogProvider.success("Calendar.SuccessSendingInvitationMessage"))})()}handle(e){var t=this;return(0,h.A)(function*(){if(e.$context.getBoundDataSchema(e.itemsAttributeName)?.name==="Activity"){const a=(yield e.$context[e.itemsAttributeName]).getChangedItems();if(a.length===0)return t.next?.handle(e);const r=yield t._mapChanges(a,e),c=yield(0,u.lastValueFrom)(t._changeMeetingService.canUserChangeMeetings(r));if(!(yield t._processForbiddenMeetings(c,a,e)))return!1;const g=c.filter(C=>[m.YesWithNotification,m.YesWithObsoleteNotification].includes(C.canChange));if(!(yield t._processInviteConfirmationMeetings(g,a,e)))return!1;const f=yield t.next?.handle(e);return f&&g.length>0&&(yield t._sendInvites(g)),f}return t.next?.handle(e)})()}};Z=(0,o.__decorate)([(0,S.l)({type:"crt.SendInvitesOnActivitiesSaveHandler",requestType:"crt.SaveRecordsRequest",scopes:["Tasks_ListPage"]}),(0,o.__metadata)("design:paramtypes",[V.r,D,w.TranslateService])],Z);var Vt=l(89285);let W=class extends I.l{constructor(e){super(),this._changeMeetingService=e}_getCanChangeMeeting(e){var t=this;return(0,h.A)(function*(){const n=yield e[e.primaryAttributeName],i=e.getBoundDataSourceName(e.primaryAttributeName),a=yield t.getParticipantsListChanged(e);if(!t.getIntegrationColumnsChanged(e,i)&&!a)return m.Yes;const r=e.getViewModelAttributePath(i,"StartDate"),c=yield e[r];return(0,u.lastValueFrom)(t._changeMeetingService.canUserChangeMeeting({id:n,start:c}))})()}_trySendInvites(e,t){var n=this;return(0,h.A)(function*(){[m.YesWithNotification,m.YesWithObsoleteNotification].includes(e)&&(yield n.handlerChain.process({type:"crt.SendInvitesForActivityRequest",$context:t,activityId:yield t[t.primaryAttributeName],isActivityOutdated:!1}))})()}_getParticipantsCollectionNames(e){var t=this;return(0,h.A)(function*(){let n=Object.keys(e.dataSchemas).filter(i=>e.dataSchemas[i]?.name==="ActivityParticipant");return n=yield t._getDataSourcesWithFilters(n,e),n.map(i=>e.getCollectionViewModelAttributePath(i)).filter(i=>!(0,p.isEmpty)(i))})()}_getDataSourcesWithFilters(e,t){return(0,h.A)(function*(){return(yield Promise.all(e.map(function(){var i=(0,h.A)(function*(a){const r=yield t.getDataSourceLoadParameters(a);return r?.parameters&&r.parameters.find(g=>g.type==="filter")?a:null});return function(a){return i.apply(this,arguments)}}()))).filter(i=>i!==null)})()}getIntegrationColumnsChanged(e,t){return this._changeMeetingService.getIntegrationColumnsChanged(e,n=>e.getViewModelAttributePath(t,n))}getParticipantsListChanged(e){var t=this;return(0,h.A)(function*(){const n=yield t._getParticipantsCollectionNames(e);return(yield Promise.all(n.map(function(){var a=(0,h.A)(function*(r){return(yield e[r])?.isChanged});return function(r){return a.apply(this,arguments)}}()))).some(a=>!!a)})()}handle(e){var t=this;return(0,h.A)(function*(){if((yield e.$context.getPrimaryDataSchema())?.name==="Activity"&&e?.$context?.getPrimaryModelMode()===Vt.b.Update){let i=yield e.$context.ChangeMeetingResponse;if(i||(i=yield t._getCanChangeMeeting(e.$context)),i===m.No)return!1;const a=yield t.next?.handle(e);return yield t._trySendInvites(i,e.$context),a}return t.next?.handle(e)})()}};W=(0,o.__decorate)([(0,S.l)({type:"crt.SendInvitesOnActivitySaveHandler",requestType:"crt.SaveRecordRequest",scopes:["AddTaskMiniPage","Tasks_FormPage"]}),(0,o.__metadata)("design:paramtypes",[D])],W);let X=class extends W{getIntegrationColumnsChanged(e,t){return!0}handle(e){return e.$context.getBoundDataSchema(e.itemsAttributeName)?.name==="ActivityParticipant"?super.handle(e):this.next?.handle(e)}};X=(0,o.__decorate)([(0,S.l)({type:"crt.SendInvitesOnActivityParticipantSaveHandler",requestType:"crt.SaveRecordsRequest",scopes:["Tasks_FormPage"]})],X);let ee=class extends I.l{constructor(e,t,n){super(),this._messageDialogProvider=e,this._changeMeetingService=t,this._translateService=n}_getDisplayValues(e,t,n){return(0,h.A)(function*(){return(yield Promise.all(e.map(function(){var a=(0,h.A)(function*(r){const c=yield r[r.primaryAttributeName];return t.includes(c)?yield r[n]:Promise.resolve("")});return function(r){return a.apply(this,arguments)}}()))).filter(a=>!(0,p.isEmpty)(a))})()}_getCanChangeMeeting(e){var t=this;return(0,h.A)(function*(){const n=yield e[e.primaryAttributeName],i=e.getBoundDataSourceName(e.primaryAttributeName),a=e.getViewModelAttributePath(i,"StartDate"),r=yield e[a];return(0,u.lastValueFrom)(t._changeMeetingService.canUserChangeMeeting({id:n,start:r}))})()}_processActivityDelete(e){var t=this;return(0,h.A)(function*(){const n=yield t._getRecordIds(e);if(n.length===0){yield(0,u.lastValueFrom)(t._messageDialogProvider.info("Calendar.CanNotChangeMultipleMeetingsByFilterMessage"));return}const i=yield(0,u.lastValueFrom)(t._changeMeetingService.getCurrentUserOrganizedMeetings(n)),a=n.filter(r=>!i.includes(r));if(a.length>0){const r=e.$context.getViewModelAttributePath(e.dataSourceName,"Title").split("."),c=yield e.$context[r[0]],g=yield t._getDisplayValues(c,a,r[1]),f=`${t._translateService.instant("Calendar.CanNotChangeMultipleMeetingsMessage")} ${g.join(", ")}`;yield(0,u.lastValueFrom)(t._messageDialogProvider.info(f));return}yield t.next?.handle(e)})()}_processActivityParticipantDelete(e){var t=this;return(0,h.A)(function*(){(yield t._getCanChangeMeeting(e.$context))!==m.No&&(yield t.next?.handle(e))})()}_getRecordIds(e){return(0,h.A)(function*(){if(e.recordIds)return e.recordIds;const t=e.$context.getCollectionViewModelAttributePath(e.dataSourceName);let n=yield e.$context[`${t}_SelectedRows`];return!n&&e.dataSourceName==="PDS"&&(n=yield e.$context.DataTable_SelectedRows),n||[]})()}handle(e){var t=this;return(0,h.A)(function*(){switch(e.$context.dataSchemas[e.dataSourceName]?.name){case"Activity":yield t._processActivityDelete(e);return;case"ActivityParticipant":yield t._processActivityParticipantDelete(e);return}yield t.next?.handle(e)})()}};ee=(0,o.__decorate)([(0,S.l)({type:"crt.SendInvitesOnDeleteRecordsHandler",requestType:"crt.DeleteRecordsRequest",scopes:["Tasks_ListPage","Tasks_FormPage"]}),(0,o.__metadata)("design:paramtypes",[V.r,D,w.TranslateService])],ee);var Ht=l(55359);let Me=class extends T.S{};Me=(0,o.__decorate)([(0,x.$)({type:"crt.SilenceCreateCalendarRecordRequest"})],Me);let te=class extends I.l{handle(e){var t=this;return(0,h.A)(function*(){const{$context:n,itemsAttributeName:i,defaultValues:a}=e,r=yield n[i];if(!r)return null;const c={};a?.forEach(C=>{c[C.attributeName]=C.value});const g={initialModelValues:{ShowInScheduler:!0,Type:Ht.zY,...c}},f=yield r.createItem(g);return yield(0,u.firstValueFrom)(f.setValue({[e.title.key]:e.title.value},{silent:!0})),yield(0,u.firstValueFrom)(f.setValue({[e.startDate.key]:e.startDate.value},{silent:!0})),yield(0,u.firstValueFrom)(f.setValue({[e.endDate.key]:e.endDate.value},{silent:!0})),t.handlerChain.process({type:"crt.SaveRecordRequest",$context:f})})()}};te=(0,o.__decorate)([(0,S.l)({type:"crt.SilenceCreateCalendarRecordHandler",requestType:"crt.SilenceCreateCalendarRecordRequest"})],te);var $t=l(92009),Ut=l(3284);let xe=class extends Ut.H{};xe=(0,o.__decorate)([(0,x.$)({type:"crt.CreateCalendarRecordRequest"})],xe);let ne=class extends I.l{constructor(e){super(),this._schemaService=e}_getComponentViewConfig(e){return this._schemaService.getViewConfigInfoByProperty("type",e)?.map(t=>t?.viewConfig)}handle(e){var t=this;return(0,h.A)(function*(){const{$context:n}=e,i=e.$context,a=t._getComponentViewConfig("crt.Calendar");if(!a||!a[0])return;const r=a[0].name,c=yield i[`${r}_highlightedStartDate`],g=yield i[`${r}_highlightedEndDate`];let f=e.defaultValues;return c&&g&&(f=[...f,{attributeName:"StartDate",value:c},{attributeName:"DueDate",value:g}]),yield t.handlerChain.process({type:"crt.UnhighlightCalendarAreaRequest",$context:n,startDateAttrName:`${r}_highlightedStartDate`,endDateAttrName:`${r}_highlightedEndDate`}),t.handlerChain.process({type:"crt.CreateRecordRequest",$context:n,entityName:e.entityName,defaultValues:f})})()}};ne=(0,o.__decorate)([(0,S.l)({type:"crt.CreateCalendarRecordHandler",requestType:"crt.CreateCalendarRecordRequest"}),(0,o.__metadata)("design:paramtypes",[$t.R])],ne);let Te=class extends T.S{constructor(){super(...arguments),this.type="crt.HighlightCalendarAreaRequest"}};Te=(0,o.__decorate)([(0,x.$)({type:"crt.HighlightCalendarAreaRequest"})],Te);let ie=class extends I.l{_setHighlightedParams(e){const{$context:t,startDate:n,startDateAttrName:i,endDate:a,endDateAttrName:r}=e??{};return t[i]=n,t[r]=a,!0}handle(e){var t=this;return(0,h.A)(function*(){return e?t._setHighlightedParams(e):!1})()}};ie=(0,o.__decorate)([(0,S.l)({type:"crt.HighlightCalendarAreaHandler",requestType:"crt.HighlightCalendarAreaRequest"})],ie);let we=class extends T.S{constructor(){super(...arguments),this.type="crt.UnhighlightCalendarAreaRequest"}};we=(0,o.__decorate)([(0,x.$)({type:"crt.UnhighlightCalendarAreaRequest"})],we);let ae=class extends I.l{_setUnhighlightedParams(e){const{$context:t,startDateAttrName:n,endDateAttrName:i}=e??{};return t[n]=null,t[i]=null,!0}handle(e){var t=this;return(0,h.A)(function*(){return e?t._setUnhighlightedParams(e):!1})()}};ae=(0,o.__decorate)([(0,S.l)({type:"crt.UnhighlightCalendarAreaHandler",requestType:"crt.UnhighlightCalendarAreaRequest"})],ae);let Pe=class extends T.S{constructor(){super(...arguments),this.type="crt.JoinMeetingRequest"}};Pe=(0,o.__decorate)([(0,x.$)({type:"crt.JoinMeetingRequest"})],Pe);let re=class extends I.l{constructor(e){super(),this._window=e.get(et.ZP)}handle(e){var t=this;return(0,h.A)(function*(){e&&(t._window.open(e.joinUrl,"_blank"),yield t.next?.handle(e))})()}};re=(0,o.__decorate)([(0,S.l)({type:"crt.JoinMeetingHandler",requestType:"crt.JoinMeetingRequest"}),(0,o.__metadata)("design:paramtypes",[s.Injector])],re);let se=class extends T.S{constructor(){super(...arguments),this.type="crt.SetCalendarTimeScaleRequest"}};se=(0,o.__decorate)([(0,x.$)({type:"crt.SetCalendarTimeScaleRequest",position:900,title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SetCalendarTimeScaleRequest",propertiesPanelComponentTypeName:"crt.CrtSetCalendarTimeScaleRequestPropertiesPanelComponent"})],se);let oe=class extends I.l{_setTimeScaleAttribute(e){const{$context:t,timeScaleAttributeName:n,timeScale:i}=e??{};!t||(0,p.isEmpty)(n)||(0,p.isEmpty)(i)||(t[n]=i)}handle(e){var t=this;return(0,h.A)(function*(){e&&t._setTimeScaleAttribute(e),yield t.next?.handle(e)})()}};oe=(0,o.__decorate)([(0,S.l)({type:"crt.SetCalendarTimeScaleHandler",requestType:"crt.SetCalendarTimeScaleRequest"})],oe);var jt=l(86710);class F{constructor(e,t){this._injector=e,this._licenseOperationValues=t,this._hasUserActiveCalendarMethod="/rest/MeetingService/HasUserActiveCalendarAccount",this._getUserCalendarsInfoMethod="/rest/MeetingService/GetUserCalendarsInfo",this._httpClient=this._injector.get(Ze.HttpClient)}hasCalendarSyncLicense(){return this._licenseOperationValues[q.I]}hasUserActiveCalendarAccount(){return this._httpClient.get(this._hasUserActiveCalendarMethod)}getUserCalendarsInfo(){return this._httpClient.get(this._getUserCalendarsInfoMethod)}static{this.\u0275fac=function(t){return new(t||F)(s.\u0275\u0275inject(s.Injector),s.\u0275\u0275inject(jt.W))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac,providedIn:"root"})}}let Ee=class extends T.S{};Ee=(0,o.__decorate)([(0,x.$)({type:"crt.AddCalendarSyncAccountRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.AddCalendarSyncAccountRequest",position:901})],Ee);let le=class extends I.l{constructor(e){super(),this._injector=e,this._calendarSettingsService=this._injector.get(F),this._messageDialogProvider=this._injector.get(V.r)}_openSyncSettingsModalBox(){var e=this;return(0,h.A)(function*(){const t="CredentialsSyncSettingsEdit",n={instanceConfig:{schemaName:"ActivitySyncSettingsEdit",isSchemaConfigInitialized:!0,useHistoryState:!1}};yield e.handlerChain.process({type:"crt.7XRequest",$context:null,action:"LoadModuleIntoModalBox",moduleName:t,moduleParams:n,modalBoxSize:{minHeight:"1",minWidth:"1",maxHeight:"100",maxWidth:"100",widthPixels:"425",heightPixels:"200"}})})()}_checkOnActiveCalendarAccount(){var e=this;return(0,h.A)(function*(){(yield(0,u.firstValueFrom)(e._calendarSettingsService.hasUserActiveCalendarAccount()))?e._messageDialogProvider.info("Calendar.UserAlreadyHasActiveCalendarAccount"):e._openSyncSettingsModalBox()})()}_checkOnCalendarSyncLicense(){const e=this._calendarSettingsService.hasCalendarSyncLicense();return e||this._messageDialogProvider.error("Calendar.LackOfLicenseMessage"),e}handle(e){var t=this;return(0,h.A)(function*(){t._checkOnCalendarSyncLicense()&&(yield t._checkOnActiveCalendarAccount()),yield t.next?.handle(e)})()}};le=(0,o.__decorate)([(0,S.l)({type:"crt.AddCalendarSyncAccountHandler",requestType:"crt.AddCalendarSyncAccountRequest"}),(0,o.__metadata)("design:paramtypes",[s.Injector])],le);var Bt=l(6530),z;(function(d){d[d.Exchange=0]="Exchange",d[d.Google=1]="Google"})(z||(z={}));let Re=class extends T.S{};Re=(0,o.__decorate)([(0,x.$)({type:"crt.SetupCalendarSyncAccountRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SetupCalendarSyncAccountRequest",position:902})],Re);let ce=class extends I.l{constructor(){super(...arguments),this._google7xPageName="GoogleIntegrationSettingsPageV2",this._syncSettingsHash="BaseSchemaModuleV2/SyncSettings",this._activitySettingsTabName="ActivitySettingsTab",this._7xRequestName="crt.7XRequest"}_openGoogleCalendarSyncSettings(){var e=this;return(0,h.A)(function*(){yield e.handlerChain.process({type:e._7xRequestName,$context:null,action:"OpenPage",payload:{schemaName:e._google7xPageName,entitySchemaName:"Activity"}})})()}_openExchangeCalendarSyncSettings(e){var t=this;return(0,h.A)(function*(){yield t.handlerChain.process({type:t._7xRequestName,$context:null,action:"PushHistoryState",hash:t._syncSettingsHash,stateObj:{activeTabName:t._activitySettingsTabName,recordId:e}})})()}handle(e){var t=this;return(0,h.A)(function*(){const n=e.calendarType,i=e.mailboxId;n===z.Google&&(yield t._openGoogleCalendarSyncSettings()),n===z.Exchange&&!(0,Bt.gZ)(i)&&(yield t._openExchangeCalendarSyncSettings(i)),yield t.next?.handle(e)})()}};ce=(0,o.__decorate)([(0,S.l)({type:"crt.SetupCalendarSyncAccountHandler",requestType:"crt.SetupCalendarSyncAccountRequest"})],ce);let de=class extends T.S{constructor(){super(...arguments),this.type="crt.SendInvitesForActivityRequest"}};de=(0,o.__decorate)([(0,x.$)({type:"crt.SendInvitesForActivityRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SendInvitesForActivityRequest",propertiesPanelComponentTypeName:"crt.CrtSendInvitesForActivityRequestPropertiesPanelComponent",position:910})],de);let ue=class extends I.l{constructor(e,t){super(),this._messageDialogProvider=e,this._changeMeetingService=t}_trySendInvites(e){var t=this;return(0,h.A)(function*(){const n=yield(0,u.lastValueFrom)(t._changeMeetingService.sendInvitations(e));yield(0,u.lastValueFrom)(n?t._messageDialogProvider.success("Calendar.SuccessSendingInvitationMessage"):t._messageDialogProvider.error("Calendar.ErrorSendingInvitationMessage"))})()}handle(e){var t=this;return(0,h.A)(function*(){const n=e.activityId?.value||e.activityId;let i=e.isActivityOutdated;e.isStartDateUpdated&&(i=(yield(0,u.lastValueFrom)(t._changeMeetingService.getMeetingInvitationInfo(n)))?.IsOutdatedMeeting??!1),(yield(0,u.lastValueFrom)(t._changeMeetingService.isOutdatedMeetingConfirmed(i)))&&(yield t._trySendInvites(n),yield t.next?.handle(e))})()}};ue=(0,o.__decorate)([(0,S.l)({type:"crt.SendInvitesForActivityHandler",requestType:"crt.SendInvitesForActivityRequest"}),(0,o.__metadata)("design:paramtypes",[V.r,D])],ue);var Lt=l(89100),it=l(38160),Oe=l(74368),Wt=l(71281);class Y{constructor(e){this._profileAttributeService=e,this._pageSize=150,this._primaryDataSourceNameMacros="#PrimaryDataSourceName()#",this._metadataSchemaUtils=(0,s.inject)(Oe.u)}_getViewConfigs(e,t){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",t,e).map(n=>n?.viewConfig).filter(Boolean)}_getDsAttributeName(e,t){return e.replace(`${t}_`,"")}_getCalendarDateColumns(e,t,n){if(!t.modelConfig||!e.modelConfig||!e.modelConfig.dataSources)return[];const i=t.modelConfig.path,r=e.modelConfig.dataSources[i]?.config?.attributes||{},c=n.templateValuesMapping;return[r[this._getDsAttributeName(c.startColumn,i)]?.path,r[this._getDsAttributeName(c.endColumn,i)]?.path].filter(g=>!!g)}_setFilterAttribute(e,t,n){if(n.filters)return;const i=e.viewModelConfig.attributes,a=i[n.items?.replace("$","")];if(!a||!a.modelConfig?.filterAttributes||t.length===0)return;const r=this._getCalendarDateColumns(e,a,n),c=this._getCalendarDateFilterAttributes(a,t,r);c.length!==0&&(n.filters=`$${this._createCalculatedAttribute(i,n.name,c)}`)}_setParticipantFilterAttribute(e,t,n){if(n.participantFilters)return;const i=e.viewModelConfig.attributes,a=i[n.items?.replace("$","")];if(!a||!a.modelConfig?.filterAttributes||t.length===0)return;if((e.modelConfig?.dataSources&&e.modelConfig.dataSources[a.modelConfig.path])?.config?.entitySchemaName==="Activity"&&n.colorizationType===b.ByOwner){const c=this._getCalendarParticipantFilterAttribute(a,t);if(c.length===0)return;n.participantFilters=`$${this._createCalculatedAttribute(i,"participant",c)}`}}_getCalendarDateFilterAttributes(e,t,n){const i=e.modelConfig?.filterAttributes?.map(a=>a.name)||[];return t.filter(a=>{if(a.filterType!==it.U.DateRange||!i.find(c=>c.startsWith(a.name)))return!1;const r=new Array;return a._filterOptions.expose.forEach(c=>c.converters?.forEach(g=>g.args?.forEach(f=>{const C=f.target;r.push(C.filterColumn),r.push(C.filterColumnEnd),r.push(C.filterColumnStart)}))),!!n.find(c=>r.includes(c))}).map(a=>a.value?a.value.replace("$",""):a._filterOptions.from)}_getCalendarParticipantFilterAttribute(e,t){const n=e.modelConfig?.filterAttributes?.map(a=>a.name)||[],i=t.find(a=>{if(a.filterType!==it.U.Lookup||!n.find(c=>c.startsWith(a.name)))return!1;let r=!1;return a._filterOptions.expose.forEach(c=>c.converters?.forEach(g=>g.args?.forEach(f=>{r=f.target.filterColumn==="[ActivityParticipant:Activity].Participant"}))),r});return i?i.value?i.value.replace("$",""):i._filterOptions.from:""}_createCalculatedAttribute(e,t,n){const i=`${t}_FilterValues`;return e[i]={from:n},i}_isDependOnPageDataSource(e,t){const n=this._getRelatedDataSourceName(e);return t?.[n]?.scope===Lt.Z.Page}_getRelatedDataSourceName(e){return e.relationPath.split(".").shift()??""}_getDefaultValue(e,t,n){const i=this._getRelatedDataSourceName(t),a=n?.[i]?.config||{},r=a.entitySchemaName?`$${e} | crt.ToLookup : '${a.entitySchemaName}'`:`$${e}`;return{attributeName:t.attributePath,value:r}}_getDefaultValuesFromDependencies(e,t,n,i){const a=n.dependencies,r=n.dataSources,c=n.primaryDataSourceName||"",f=t[i]?.modelConfig?.path,C=f&&a?.[f];return C?C.filter(A=>this._isDependOnPageDataSource(A,r)).map(A=>this._getDependencyAttributeName(A,t,c)).map((A,Ne)=>A||`${e.name}_DependencyValue_${Ne}`).map((A,Ne)=>{const at=C[Ne];return this._setDependencyViewModelAttribute(A,at,t),this._getDefaultValue(A,at,r)}):[]}_setDependencyViewModelAttribute(e,t,n){n[e]||(n[e]={modelConfig:{path:t.relationPath}})}_getDependencyAttributeName(e,t,n){return Object.keys(t).find(i=>(t[i]?.modelConfig?.path||"").replace(this._primaryDataSourceNameMacros,n)===e.relationPath)}_setCrudEventsBindings(e,t){if((0,p.isEmpty)(t.items))return;const n=t.items.slice(1),i=this._getDefaultValuesFromDependencies(t,e.viewModelConfig.attributes=e.viewModelConfig.attributes||{},e.modelConfig||{},n);t.silenceCreate={request:"crt.SilenceCreateCalendarRecordRequest",params:{itemsAttributeName:n,title:{key:t.templateValuesMapping.titleColumn,value:"@event.title"},startDate:{key:t.templateValuesMapping.startColumn,value:"@event.startDate"},endDate:{key:t.templateValuesMapping.endColumn,value:"@event.endDate"},defaultValues:i.map(({attributeName:a,value:r})=>({attributeName:a,value:r}))}},this._setHighlightedEventBinding(n,t)}_setHighlightedEventBinding(e,t){const n=`${t.name}_highlightedStartDate`,i=`${t.name}_highlightedEndDate`;t.highlightArea={request:"crt.HighlightCalendarAreaRequest",params:{itemsAttributeName:e,startDate:"@event.startDate",startDateAttrName:n,endDate:"@event.endDate",endDateAttrName:i}},t.unhighlightArea={request:"crt.UnhighlightCalendarAreaRequest",params:{itemsAttributeName:e,startDateAttrName:n,endDateAttrName:i}},t.openEditPage={request:"crt.UpdateRecordRequest",params:{entityName:"@event.schemaName",recordId:"@event.recordId"}},t.openPositionedMiniPage={request:"crt.OpenPositionedPageRequest",params:{schemaName:"@event.schemaName",recordId:"@event.recordId",offsetX:"@event.offsetX",offsetY:"@event.offsetY"}}}_setShowWeekendsAttribute(e,t){var n=this;return(0,h.A)(function*(){(0,p.isEmpty)(t.showWeekends)||(yield n._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"showWeekends",""))})()}_setLoadNextPageOptions(e,t){const i=e.viewModelConfig.attributes[t.items?.replace("$","")];this._setPagingConfig(i,t),this._setSortingConfig(e,i,t);const a=i?.modelConfig?.path;t.loadNextPage={request:"crt.LoadDataRequest",params:{dataSourceName:a}}}_setPagingConfig(e,t){if(!e?.modelConfig||e.modelConfig.pagingConfig){const n=e?.modelConfig?.pagingConfig;t.pageSize=n?.rowCount||this._pageSize;return}e.modelConfig.pagingConfig={rowCount:this._pageSize,rowsOffset:null}}_setSortingConfig(e,t,n){if(!t?.modelConfig||t.modelConfig.sortingConfig||!e?.modelConfig?.dataSources)return;const i=n.templateValuesMapping.startColumn,a=t.modelConfig.path,g=(e.modelConfig.dataSources[a]?.config?.attributes||{})[this._getDsAttributeName(i,a)]?.path;t.modelConfig.sortingConfig={attributeName:n.name+"_ItemsSorting",default:[{columnName:g,direction:"asc"}]}}_setTileLabelsColor(e){if(!e.colorizationType||e.colorizationType==="default")return;this._getViewConfigs(e.tileContent,"crt.Label").forEach(n=>{n.labelColor=`${e.items}.LabelColor`})}_setTimeScaleFromProfile(e,t){var n=this;return(0,h.A)(function*(){(0,p.isEmpty)(t.timeScale)||(yield n._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"timeScale",""))})()}crtOnMetaDataInit(e){var t=this;return(0,h.A)(function*(){const n=e,i=t._getViewConfigs(n.viewConfig,"crt.Calendar"),a=t._getViewConfigs(n.viewConfig,"crt.QuickFilter");for(const r of i)t._setFilterAttribute(n,a,r),t._setParticipantFilterAttribute(n,a,r),t._setCrudEventsBindings(n,r),yield t._setShowWeekendsAttribute(n,r),t._setLoadNextPageOptions(n,r),t._setTileLabelsColor(r),yield t._setTimeScaleFromProfile(n,r);return Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||Y)(s.\u0275\u0275inject(Wt.H))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac})}}var zt=l(1499);class G{constructor(){this._activityIdParamName="activityId",this._activityIsOutdatedParamName="isActivityOutdated",this._toMeetingInvitationInfoConverter="crt.ToMeetingInvitationInfo",this._toSendInviteVisibleConverter="crt.ToSendInviteVisible",this._toSendInviteDisabledConverter="crt.ToSendInviteDisabled",this._toSendInviteIsOutdatedConverter="crt.ToSendInviteIsOutdated",this._toSendInviteIsStartDateUpdatedConverter="crt.ToSendInviteIsStartDateUpdated",this._pdsName="",this._metadataSchemaUtils=(0,s.inject)(Oe.u)}_getSendInvitesButtons(e){return this._metadataSchemaUtils.getViewConfigInfoByFilter(t=>t.clicked?.request==="crt.SendInvitesForActivityRequest",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_setActivityBindings(e,t){if(!this._hasActivityIdParam(t)||!this._pdsName)return;const n=this._tryGetAttributeFromBinding(e,t)||this._getOrAddActivityIdAttribute(e,t);t.clicked.params[this._activityIdParamName]=`$${n}`,t.clicked.params[this._activityIsOutdatedParamName]=`$${this._getOrAddIsOutdatedAttribute(e,t,n)}`,t.clicked.params.isStartDateUpdated=`$${this._getOrAddIsStartDateUpdatedAttribute(e,t)}`,t.visible=`$${this._getOrAddVisibilityAttribute(e,t,n)}`,t.disabled=`$${this._getOrAddDisabledAttribute(e,t,n)}`}_hasActivityIdParam(e){return!!e.clicked&&!!e.clicked.params&&!(0,p.isEmpty)(e.clicked.params[this._activityIdParamName])}_tryGetAttributeFromBinding(e,t){const n=e.viewModelConfig.attributes,a=(t.clicked?.params[this._activityIdParamName]||"").split("$")[1];return n[a]?a:""}_getOrAddActivityIdAttribute(e,t){return this._findActivityIdAttribute(e,t)||this._createActivityIdAttribute(e,t)}_getOrAddMeetingInvitationInfoAttribute(e,t,n){return this._findCalculatedAttribute(e,n,this._toMeetingInvitationInfoConverter)||this._createCalculatedAttribute(e,`${t.name}_MeetingInfo`,n,this._toMeetingInvitationInfoConverter)}_getOrAddVisibilityAttribute(e,t,n){const i=this._getOrAddMeetingInvitationInfoAttribute(e,t,n);return this._findCalculatedAttribute(e,i,this._toSendInviteVisibleConverter)||this._createCalculatedAttribute(e,`${t.name}_Visible`,i,this._toSendInviteVisibleConverter)}_getOrAddDisabledAttribute(e,t,n){const i=this._getOrAddMeetingInvitationInfoAttribute(e,t,n);return this._findCalculatedAttribute(e,i,this._toSendInviteDisabledConverter)||this._createCalculatedAttribute(e,`${t.name}_Disabled`,i,this._toSendInviteDisabledConverter)}_getOrAddIsOutdatedAttribute(e,t,n){const i=this._getOrAddMeetingInvitationInfoAttribute(e,t,n);return this._findCalculatedAttribute(e,i,this._toSendInviteIsOutdatedConverter)||this._createCalculatedAttribute(e,`${t.name}_IsOutdated`,i,this._toSendInviteIsOutdatedConverter)}_getOrAddIsStartDateUpdatedAttribute(e,t){return this._findCalculatedAttribute(e,`${t.name}_IsStartDateUpdated`,this._toSendInviteIsStartDateUpdatedConverter)||this._createCalculatedAttribute(e,`${t.name}_IsStartDateUpdated`,"StartDate",this._toSendInviteIsStartDateUpdatedConverter)}_findActivityIdAttribute(e,t){const n=e.viewModelConfig.attributes,i=t.clicked?.params[this._activityIdParamName],a=Object.keys(n).find(r=>(n[r]??{}).modelConfig?.path===`${this._pdsName}.${i}`);return(0,p.isEmpty)(a)?void 0:a}_findCalculatedAttribute(e,t,n){const i=e.viewModelConfig.attributes,a=Object.keys(i).find(r=>{const c=i[r]??{};return c.from===t&&c.converter===n});return(0,p.isEmpty)(a)?void 0:a}_createActivityIdAttribute(e,t){const n=e.viewModelConfig.attributes,i=`${t.name}_ActivityId`,a=t.clicked?.params.activityId;return n[i]={modelConfig:{path:`${this._pdsName}.${a}`}},i}_createCalculatedAttribute(e,t,n,i){const a=e.viewModelConfig.attributes;return a[t]={from:n,converter:i},t}crtOnMetaDataInit(e){const t=e;return this._pdsName=(0,zt.h)(t),this._getSendInvitesButtons(t).forEach(i=>{this._setActivityBindings(t,i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||G)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac})}}class J{constructor(e){this._calendarSettingsService=e,this._setupCalendarRequest="crt.SetupCalendarSyncAccountRequest",this._metadataSchemaUtils=(0,s.inject)(Oe.u)}_getCalendarSetupButtons(e,t){return this._metadataSchemaUtils.getViewConfigInfoByFilter(n=>n.clicked?.request===this._setupCalendarRequest&&n.type===e,t.viewConfig).map(n=>n?.viewConfig).filter(Boolean)}_createAttribute(e,t,n){const i=e.viewModelConfig.attributes;return i[t]={value:n},t}_setSyncButtonVisibility(e,t,n){e.visible=`$${this._createAttribute(t,`${e.name}_Visible`,n)}`}_addCalendarItemsMenu(e,t,n,i){if(!n.length){this._setSyncButtonVisibility(e,i,!1);return}e.clickMode="menu",e[t]||(e[t]=[]);const a=e[t];n.forEach(r=>{a.push({name:r.Id,type:"crt.MenuItem",caption:r.Email,clicked:{request:this._setupCalendarRequest,params:{mailboxId:r.MailBoxId,calendarType:r.Type}}})}),this._setSyncButtonVisibility(e,i,!0)}_prepareCalendarItemsMenu(e,t,n,i){var a=this;return(0,h.A)(function*(){a._getCalendarSetupButtons(e,n).forEach(c=>{a._addCalendarItemsMenu(c,t,i,n)})})()}_handleSetupCalendarButtons(e){var t=this;return(0,h.A)(function*(){const n=yield(0,u.lastValueFrom)(t._calendarSettingsService.getUserCalendarsInfo().pipe((0,u.catchError)(()=>(0,u.of)([]))));yield t._prepareCalendarItemsMenu("crt.MenuItem","items",e,n),yield t._prepareCalendarItemsMenu("crt.Button","menuItems",e,n)})()}crtOnMetaDataInit(e){var t=this;return(0,h.A)(function*(){const n=e;return yield t._handleSetupCalendarButtons(n),Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||J)(s.\u0275\u0275inject(F))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}function Yt(){const d=[de,se]}Yt();let he=class ke{static{this.\u0275fac=function(t){return new(t||ke)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:ke})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[N,{provide:ge.m,useClass:Y,multi:!0},{provide:ge.m,useClass:G,multi:!0},{provide:ge.m,useClass:J,multi:!0}],imports:[Le.q,We.U,E.CommonModule,He.f,j.MatIconModule,w.TranslateModule,Je.X,$e.q,B.FullCalendarModule,Ge.c,ze.f,P.DragDropModule,Ye.S,Ue.S,je.k,Be.V]})}};he=(0,o.__decorate)([(0,Ve.g)({includes:[],viewElements:[y],requestHandlers:[K,Z,X,W,ee,te,ne,ie,ae,re,oe,le,ce,ue],converters:[_e,Ce,Se,Ae,Ie,be]})],he),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(he,{declarations:[y,R],imports:[Le.q,We.U,E.CommonModule,He.f,j.MatIconModule,w.TranslateModule,Je.X,$e.q,B.FullCalendarModule,Ge.c,ze.f,P.DragDropModule,Ye.S,Ue.S,je.k,Be.V],exports:[y]})}()},38160:(Q,k,l)=>{l.d(k,{U:()=>o});var o;(function(P){P.Custom="custom",P.DateRange="date-range",P.Lookup="lookup"})(o||(o={}))},55359:(Q,k,l)=>{l.d(k,{Aw:()=>w,Iq:()=>E,er:()=>B,zY:()=>j});const o="C449D832-A4CC-4B01-B9D5-8A12C42A9F89",P="Activity",E="E2831DEC-CFC0-DF11-B00F-001D60E938C6",j="fbe0acdc-cfc0-df11-b00f-001d60e938c6",Ve="42c74c49-58e6-df11-971b-001d60e938c6",B="f51c4643-58e6-df11-971b-001d60e938c6",w="8038A396-7825-E011-8165-00155D043204"},95226:Q=>{Q.exports=`<svg width="56" height="50" viewBox="0 0 56 50" fill="none" xmlns="http://www.w3.org/2000/svg">
<g id="Icon">
<rect id="Rectangle 44864" x="0.5" y="0.5" width="55" height="49" rx="2.5" stroke="#70ACEE"/>
<g id="Group 17499">
<rect id="Rectangle 45179" x="5" y="13" width="46" height="10" rx="2" fill="#D1D1D1"/>
<line id="Line 2313" x1="8" y1="16.043" x2="16.8125" y2="16.043" stroke="white"/>
<line id="Line 2315" x1="8" y1="17.8145" x2="34.4375" y2="17.8145" stroke="white"/>
<line id="Line 2316" x1="8" y1="19.5859" x2="25.625" y2="19.5859" stroke="white"/>
<line id="Line 2314" x1="19.75" y1="16.043" x2="43.25" y2="16.043" stroke="white"/>
</g>
<g id="Group 17500">
<rect id="Rectangle 45179_2" x="5" y="24" width="46" height="10" rx="2" fill="#80C8F5"/>
<line id="Line 2313_2" x1="7.93652" y1="27.1367" x2="16.5615" y2="27.1367" stroke="white"/>
<line id="Line 2315_2" x1="7.93652" y1="28.9546" x2="33.8115" y2="28.9546" stroke="white"/>
<line id="Line 2316_2" x1="7.93652" y1="30.7729" x2="25.1865" y2="30.7729" stroke="white"/>
<line id="Line 2314_2" x1="19.4365" y1="27.1367" x2="42.4365" y2="27.1367" stroke="white"/>
</g>
<g id="Group 17501">
<rect id="Rectangle 45179_3" x="5" y="35" width="46" height="10" rx="2" fill="#80C8F5"/>
<line id="Line 2313_3" x1="7.93652" y1="38.1367" x2="16.5615" y2="38.1367" stroke="white"/>
<line id="Line 2315_3" x1="7.93652" y1="39.9546" x2="33.8115" y2="39.9546" stroke="white"/>
<line id="Line 2316_3" x1="7.93652" y1="41.7729" x2="25.1865" y2="41.7729" stroke="white"/>
<line id="Line 2314_3" x1="19.4365" y1="38.1367" x2="42.4365" y2="38.1367" stroke="white"/>
</g>
<g id="31">
<path d="M25.8078 10C25.2682 10 24.7876 9.92681 24.366 9.78042C23.9468 9.63213 23.6155 9.42871 23.3722 9.17015C23.1313 8.9097 23.0072 8.60932 23 8.26901H24.5756C24.5852 8.4116 24.6442 8.53707 24.7526 8.64544C24.8635 8.7519 25.0104 8.8346 25.1935 8.89354C25.3766 8.95247 25.5826 8.98194 25.8115 8.98194C26.05 8.98194 26.2608 8.94867 26.4439 8.88213C26.6269 8.81559 26.7703 8.72338 26.8739 8.60551C26.9775 8.48764 27.0293 8.35171 27.0293 8.19772C27.0293 8.04183 26.9739 7.90399 26.863 7.78422C26.7546 7.66255 26.598 7.56749 26.3933 7.49905C26.1909 7.43061 25.95 7.39639 25.6705 7.39639H24.9803V6.48954H25.6705C25.9066 6.48954 26.115 6.45722 26.2957 6.39259C26.4788 6.32795 26.6209 6.23859 26.7221 6.12453C26.8233 6.00856 26.8739 5.87357 26.8739 5.71958C26.8739 5.57319 26.8293 5.44487 26.7402 5.3346C26.6534 5.22243 26.5306 5.13498 26.3716 5.07224C26.215 5.00951 26.0319 4.97814 25.8223 4.97814C25.6103 4.97814 25.4164 5.00856 25.2405 5.06939C25.0646 5.12833 24.9237 5.21293 24.8177 5.32319C24.7117 5.43346 24.6551 5.56274 24.6478 5.71103H23.1482C23.1554 5.37452 23.2771 5.07795 23.5131 4.82129C23.7492 4.56464 24.0672 4.36407 24.4672 4.21958C24.8695 4.07319 25.3236 4 25.8295 4C26.3403 4 26.7872 4.07319 27.1702 4.21958C27.5533 4.36597 27.8508 4.56369 28.0628 4.81274C28.2772 5.05989 28.3832 5.33745 28.3808 5.64544C28.3832 5.97243 28.2543 6.24525 27.9941 6.46388C27.7364 6.68251 27.4003 6.82129 26.9859 6.88023V6.92586C27.5304 6.98099 27.9447 7.13023 28.229 7.37357C28.5157 7.61502 28.6578 7.9173 28.6554 8.28042C28.6578 8.61312 28.5362 8.90875 28.2905 9.1673C28.0471 9.42586 27.7111 9.62928 27.2822 9.77757C26.8534 9.92586 26.3619 10 25.8078 10Z" fill="#0D2E4E"/>
<path d="M33 4.07985V9.92015H31.4353V5.2519H31.3919L29.6971 6.0903V4.99525L31.5292 4.07985H33Z" fill="#0D2E4E"/>
</g>
</g>
</svg>
`}}]);
