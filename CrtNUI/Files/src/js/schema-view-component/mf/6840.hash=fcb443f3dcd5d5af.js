(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[6840],{43272:(K,T,e)=>{e.d(T,{A:()=>M});var s=e(18587),I=e(49973),t=e(58504),A=e(74709),P=e(43785),L=e(62278),r=e.n(L),g=e(36486),C=e.n(g);class M{constructor(d,n,u){this.queryExecutor=d,this._translateService=n,this.entityConverter=u,this.absentDataErrorKey="BaseSection.AbsentDataErrorMessage",this.primaryColumnName="Id"}_convertToErrorInfo(d){return{errorCode:null,message:d.message,stackTrace:d.stack}}_addColumnsToEsq(d){this.entityConverter.getEntityColumns({}).forEach(u=>{d.addSchemaColumn(u.path)})}_createDeleteQuery(){return new s.x(this.entitySchemaName)}getBaseErrorResponse(d){return(0,L.of)({success:!1,errorInfo:this._convertToErrorInfo(d),result:null})}handleResponse(d){return d.pipe((0,g.map)(()=>({success:!0,errorInfo:null,result:[]})),(0,g.catchError)(n=>(0,L.of)({success:!1,errorInfo:this._convertToErrorInfo(n),result:[]})))}getItemByIdEsq(d){const n=new I.s(this.entitySchemaName);return this._addColumnsToEsq(n),n.filters.addSchemaColumnFilterWithParameter(t.H.Equal,this.primaryColumnName,d),n}createGetAllItemsEsq(){const d=new I.s(this.entitySchemaName);return this._addColumnsToEsq(d),d}getUpdateQuery(d){const n=new A.N(this.entitySchemaName);return this.entityConverter.getEntityColumns(d).forEach(O=>{this.primaryColumnName===O.path?n.filters.addSchemaColumnFilterWithParameter(t.H.Equal,this.primaryColumnName,O.value):n.addColumn(O.path,O.value,O.type)}),n}getInsertQuery(d){const n=new P.L(this.entitySchemaName);return this.entityConverter.getEntityColumns(d).forEach(O=>{this.primaryColumnName===O.path&&!O.value||n.addColumn(O.path,O.value,O.type)}),n}getDeleteQuery(d){return this.getDeleteQueryWithPrimaryColumnFilter(d.id)}getDeleteQueryWithPrimaryColumnFilter(d){const n=this._createDeleteQuery();return n.filters.addSchemaColumnFilterWithParameter(t.H.Equal,this.primaryColumnName,d),n}loadAdditionalInfo(d){return(0,L.of)(d)}getItems(){const d=this.createGetAllItemsEsq();return this.queryExecutor.executeSelectQuery(d).pipe((0,g.mergeMap)(n=>this.loadAdditionalInfo(n)),(0,g.map)(n=>({success:!0,errorInfo:null,result:n.map(u=>this.entityConverter.getEntity(u))})),(0,g.catchError)(n=>this.getBaseErrorResponse(n)))}getItem(d){const n=this.getItemByIdEsq(d);return this.queryExecutor.executeSelectQuery(n).pipe((0,g.tap)(u=>{if(!(u&&u[0])){const O=this._translateService.instant(this.absentDataErrorKey);throw new Error(O)}}),(0,g.mergeMap)(u=>this.loadAdditionalInfo(u)),(0,g.map)(u=>({success:!0,errorInfo:null,result:[this.entityConverter.getEntity(u[0])]})),(0,g.catchError)(u=>this.getBaseErrorResponse(u)))}insertItem(d){const n=this.getInsertQuery(d),u=this.queryExecutor.executeInsertQuery(n);return this.handleResponse(u)}updateItem(d){const n=this.getUpdateQuery(d),u=this.queryExecutor.executeUpdateQuery(n);return this.handleResponse(u)}deleteItem(d){const n=this.getDeleteQuery(d),u=this.queryExecutor.executeDeleteQuery(n);return this.handleResponse(u)}deleteById(d){const n=this.getDeleteQueryWithPrimaryColumnFilter(d),u=this.queryExecutor.executeDeleteQuery(n);return this.handleResponse(u)}}},45328:(K,T,e)=>{e.d(T,{D:()=>W});var s=e(5960),I=e.n(s),t=e(59131),A=e.n(t),P=e(6530),L=e(77592),r=e(34760),g=e(79772),C=e.n(g),M=e(62278),B=e.n(M),d=e(29957),n=e.n(d),u=e(32072),O=e(56704),D=e(23092),m=e(40297),h=e.n(m),v=e(97696);function U(i,a){if(i&1){const c=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",1)(1,"span",2),t.\u0275\u0275text(2),t.\u0275\u0275elementStart(3,"a",3),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(c);const x=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(x.contactClicked(x.chat.operator.contact==null?null:x.chat.operator.contact.id))}),t.\u0275\u0275text(4),t.\u0275\u0275elementEnd()()()}if(i&2){const c=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",c.getEndDateCaption(c.chat.completionDate)," "),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(c.chat.operator.contact==null?null:c.chat.operator.contact.name)}}function E(i,a){if(i&1){const c=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div")(1,"div",1)(2,"span",2),t.\u0275\u0275text(3),t.\u0275\u0275elementStart(4,"a",3),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(c);const x=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(x.contactClicked(x.chat.contact.id))}),t.\u0275\u0275text(5),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementStart(6,"div",4)(7,"crt-chat-messages",5),t.\u0275\u0275twoWayListener("chatChange",function(x){t.\u0275\u0275restoreView(c);const j=t.\u0275\u0275nextContext();return t.\u0275\u0275twoWayBindingSet(j.chat,x)||(j.chat=x),t.\u0275\u0275resetView(x)}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275template(8,U,5,2,"div",6),t.\u0275\u0275elementEnd()}if(i&2){const c=t.\u0275\u0275nextContext();t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",c.getStartDateCaption(c.chat.chatStartDate)," "),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(c.chat.contact.name),t.\u0275\u0275advance(2),t.\u0275\u0275property("messages",c.messages),t.\u0275\u0275twoWayProperty("chat",c.chat),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",c.isChatCompleted())}}class W{constructor(a,c,f){this.chatService=a,this._userInfo=c,this._translateService=f,this.contactClick=new t.EventEmitter,this.messagesLoaded=new t.EventEmitter}_loadHistory(){this.chatService.getChatHistory(this.chatId).pipe((0,M.tap)(a=>{a&&(this.messages=a,this._setChatInfo())})).subscribe()}_setChatInfo(){this.chatService.getItem(this.chatId).subscribe(a=>{a.success&&(this.chat=a.result[0],this.messagesLoaded.emit())})}getStartDateCaption(a){const c=this._translateService.instant("ChatSettings.History.Captions.StartDate");return d.String.Format(c,this.formatChatDate(a))}getEndDateCaption(a){const c=this._translateService.instant("ChatSettings.History.Captions.EndDate");return d.String.Format(c,this.formatChatDate(a))}formatChatDate(a){const c={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},f=a?new Date(a):new Date;return new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName,c).format(f)}ngOnInit(){(0,P.gZ)(this.chatId)||this._loadHistory()}contactClicked(a){this.contactClick.emit({contactId:a})}isChatCompleted(){return this.chat.status.value===u.BA.Completed}static{this.\u0275fac=function(c){return new(c||W)(t.\u0275\u0275directiveInject(O.I),t.\u0275\u0275directiveInject(D.oq),t.\u0275\u0275directiveInject(g.TranslateService))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:W,selectors:[["crt-omnichannel-messaging-chat-history"]],inputs:{chatId:[t.\u0275\u0275InputFlags.None,"chatid","chatId"]},outputs:{contactClick:"contactClick",messagesLoaded:"messagesLoaded"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"chat-status-info-container"],[1,"chat-date"],[1,"contact-name",3,"click"],[1,"chat-history-component-container"],[3,"chatChange","messages","chat"],["class","chat-status-info-container",4,"ngIf"]],template:function(c,f){c&1&&t.\u0275\u0275template(0,E,9,5,"div",0),c&2&&t.\u0275\u0275property("ngIf",f.chat)},dependencies:[m.NgIf,v.z],styles:[`.chat-date{color:#999;font-size:13px;font-family:Open Sans,serif}.chat-history-component-container{margin-bottom:19px}.contact-name{font-size:13px;color:#4e7bd8;cursor:pointer}.contact-name:hover{text-decoration:underline}.full-chat-image-container{top:0;width:100%;height:100%;z-index:999999999999;position:fixed;align-items:center;background-position:center;background-repeat:no-repeat;background-color:#000000b3}
`],encapsulation:2})}}(0,s.__decorate)([(0,L.k)(),(0,s.__metadata)("design:type",d.String)],W.prototype,"chatId",void 0),(0,s.__decorate)([(0,r.j)(),(0,s.__metadata)("design:type",Object)],W.prototype,"contactClick",void 0),(0,s.__decorate)([(0,r.j)(),(0,s.__metadata)("design:type",Object)],W.prototype,"messagesLoaded",void 0)},97696:(K,T,e)=>{e.d(T,{z:()=>z});var s=e(5960),I=e.n(s),t=e(59131),A=e.n(t),P=e(77592),L=e(34760),r=e(79772),g=e.n(r),C=e(84323),M=e(90983),B=e(28399),d=e.n(B),n=e(62278),u=e.n(n),O=e(48594),D=e(32072),m=e(56704),h=e(23092),v=e(19816),U=e(38071),E=e(40297),W=e.n(E),i=e(84011);const a=R=>({"bot-message":R}),c=R=>({display:R}),f=()=>({}),x=(R,l)=>({"first-in-sequence":R,"last-in-sequence":l}),j=(R,l)=>({width:R,height:l});function k(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",2)(1,"span"),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd()()),R&2){const _=t.\u0275\u0275nextContext();t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(_.firstMessageDate)}}function Z(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",10)(1,"span"),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd()()),R&2){const _=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(_.separatorText)}}function H(R,l){if(R&1){const _=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",11)(1,"label",12),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"ts-contact-photo",13),t.\u0275\u0275listener("contactClick",function(){t.\u0275\u0275restoreView(_);const o=t.\u0275\u0275nextContext().$implicit,p=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(p.openContact(o.author.id))}),t.\u0275\u0275elementEnd()()}if(R&2){const _=t.\u0275\u0275nextContext().$implicit,y=t.\u0275\u0275nextContext();t.\u0275\u0275property("hidden",!y.isContactChanged(_)),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",_.isBotMessage?y.bot.name:_.author.name," "),t.\u0275\u0275advance(),t.\u0275\u0275property("contact",_.isBotMessage?t.\u0275\u0275pureFunction0(4,f):_.author)("contactColor",y.getContactBackground(_))}}function V(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",14)(1,"span"),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd()()),R&2){const _=t.\u0275\u0275nextContext().$implicit,y=t.\u0275\u0275nextContext();t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(y.formatSystemMessage(_))}}function G(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",15)(1,"span",16),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"span",17),t.\u0275\u0275text(4),t.\u0275\u0275elementEnd()()),R&2){const _=t.\u0275\u0275nextContext().$implicit,y=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction2(3,x,y.isFirstMessageInSequence(_),y.isLastMessageInSequence(_))),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(_.text),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(y.getLocalTime(_.time))}}function Q(R,l){if(R&1){const _=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",24)(1,"img",25),t.\u0275\u0275listener("click",function(o){t.\u0275\u0275restoreView(_);const p=t.\u0275\u0275nextContext(4);return t.\u0275\u0275resetView(p.openImage(o))})("load",function(o){t.\u0275\u0275restoreView(_);const p=t.\u0275\u0275nextContext(4);return t.\u0275\u0275resetView(p.onChatImgLoaded(o))}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(2,"span",26),t.\u0275\u0275text(3),t.\u0275\u0275elementEnd()()}if(R&2){const _=t.\u0275\u0275nextContext().$implicit,y=t.\u0275\u0275nextContext(2).$implicit,o=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction2(3,j,o.imageContainerSize.width+"px",o.imageContainerSize.height+"px"))("src",o.getImageUrl(_.fileId),t.\u0275\u0275sanitizeUrl),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(o.getLocalTime(y.time))}}function Y(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",27)(1,"span",28)(2,"a",29),t.\u0275\u0275text(3),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(4,"span",17),t.\u0275\u0275text(5),t.\u0275\u0275elementEnd()()),R&2){const _=t.\u0275\u0275nextContext().$implicit,y=t.\u0275\u0275nextContext(2).$implicit,o=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction2(4,x,o.isFirstMessageInSequence(y),o.isLastMessageInSequence(y))),t.\u0275\u0275advance(2),t.\u0275\u0275property("href",o.getFileUrl(_.fileId),t.\u0275\u0275sanitizeUrl),t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(_.fileName),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(o.getLocalTime(y.time))}}function w(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",21),t.\u0275\u0275template(1,Q,4,6,"div",22)(2,Y,6,7,"div",23),t.\u0275\u0275elementEnd()),R&2){const _=l.$implicit,y=t.\u0275\u0275nextContext(3);t.\u0275\u0275property("ngSwitch",_.fileType),t.\u0275\u0275advance(),t.\u0275\u0275property("ngSwitchCase",y.messageType.Image)}}function J(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",30)(1,"span",16),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"span",17),t.\u0275\u0275text(4),t.\u0275\u0275elementEnd()()),R&2){const _=t.\u0275\u0275nextContext(2).$implicit,y=t.\u0275\u0275nextContext();t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(_.text),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(y.getLocalTime(_.time))}}function X(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",18),t.\u0275\u0275template(1,w,3,2,"div",19)(2,J,5,2,"div",20),t.\u0275\u0275elementEnd()),R&2){const _=t.\u0275\u0275nextContext().$implicit,y=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275property("ngForOf",_.attachments),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",y.showMessageFromAttachment(_))}}function $(R,l){if(R&1&&(t.\u0275\u0275elementStart(0,"div",3),t.\u0275\u0275text(1),t.\u0275\u0275template(2,Z,3,1,"div",4)(3,H,4,5,"div",5),t.\u0275\u0275elementStart(4,"div",6),t.\u0275\u0275template(5,V,3,1,"div",7)(6,G,5,6,"div",8)(7,X,3,2,"div",9),t.\u0275\u0275elementEnd()()),R&2){const _=l.$implicit,y=l.index,o=t.\u0275\u0275nextContext();t.\u0275\u0275classMap(o.getDirectionName(_.direction)+"-message"),t.\u0275\u0275propertyInterpolate1("id","message_",_.id,""),t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction1(12,a,_.isBotMessage))("ngStyle",t.\u0275\u0275pureFunction1(14,c,o.getIsDuplicateMessage(_.id)?"none":"")),t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate1(" ",o.cachePreviousMessage(y)," "),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.isShowSeparator(_,y)),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",!o.isSystemMessage(_)),t.\u0275\u0275advance(),t.\u0275\u0275property("ngSwitch",_.type),t.\u0275\u0275advance(),t.\u0275\u0275property("ngSwitchCase",o.messageType.System),t.\u0275\u0275advance(),t.\u0275\u0275property("ngSwitchCase",o.messageType.Text)}}class z{constructor(l,_,y,o,p){this._userInfo=l,this._translateService=_,this.injector=y,this._contactColorService=o,this.featureService=p,this._omnichannelMessageFileSchema={name:"OmnichannelMessageFile",uid:"E6B4C4D4-0A51-4A6D-A8C5-18B63FADDAD4"},this._isFileApiEnabled=!1,this._fileServiceUrl=`rest/FileService/GetFile/${this._omnichannelMessageFileSchema.uid}/`,this._imageUrl=`img/entity/hash/${this._omnichannelMessageFileSchema.name}/Data/`,this._duplicateIds=[],this.messagesCounter=0,this.contactClick=new t.EventEmitter,this.messageType=O.Go,this.bot={name:this._translateService.instant("ChatSettings.ChatWindow.Bots.Name")||"Creatio.ai"},this.imageContainerSize={width:200,height:120},this.lastSystemMessageIndex=0,this.featureService.getFeatureState("UseFileApiInChats").pipe((0,n.shareReplay)({bufferSize:1,refCount:!1})).subscribe(S=>this._isFileApiEnabled=S)}set messages(l){this._messages=l,l&&this._findDuplicateMessagesWithoutAttachments(),this._setLastSystemMessageIndex()}get messages(){return this._messages}static _trimSlashes(l){return l.replace(/(^([/\\])+)|(([/\\])+$)/,"")}static _isLargeImage(l,_){return l.naturalWidth>=_.offsetWidth||l.naturalHeight>=_.offsetHeight}_isNewDay(l){return this._previousMessage&&this._previousMessage.time&&l.time&&this._previousMessage.time.getDay()!==l.time.getDay()}_isNewMessages(l){const _=this.messages.length-this.messagesCounter;return l===_&&_>0}_formatDate(l){const _=new Date(l);return(0,C.v8)(_,this._userInfo.timeZoneOffsetHours),new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName).format(_)}_joinPath(...l){return l.map(_=>z._trimSlashes(_)).join("/")}_setFirstMessageData(){if(this.messages?.length>0){const l=this.messages.find(_=>_.direction===O.Tt.Incoming);if(!l)return;this.firstMessageDate=this._formatDate(l.time),this.contactColor=this._contactColorService.getNextColor(l.author.id)}}_setLastSystemMessageIndex(){this._messages&&(this._messages.length<m.I.rowsCount?this.lastSystemMessageIndex=0:this._messages.length===m.I.rowsCount?this.lastSystemMessageIndex=m.I.rowsCount-1:this.lastSystemMessageIndex=d().findLastIndex(this._messages,l=>l.type===O.Go.System)+1)}_isAuthorChanged(l,_){return l.author.id!==_.author.id||this.isSystemMessage(_)}_findDuplicateMessagesWithoutAttachments(){const l=this.messages.reduce((o,p)=>{const{text:S,time:N}=p,b=`${S}-${N}`;return o[b]||(o[b]=[]),o[b].push(p),o},{}),y=Object.values(l).flat().filter(o=>{const{text:p,time:S}=o,b=l[`${p}-${S}`].some(F=>!(0,B.isEmpty)(F.attachments));return(0,B.isEmpty)(o.attachments)&&b});this._duplicateIds=y.map(o=>o.id)}getDirectionName(l){return O.Tt[l].toLowerCase()}getContactBackground(l){return l.isBotMessage?"none":l.direction===1?this.contactColor:"#40bf62"}isContactChanged(l){return this._previousMessage?this._previousMessage.author.id!==l.author.id||this._previousMessage.isBotMessage!==l.isBotMessage||this._previousMessage.type===O.Go.System:!0}ngOnChanges(){this._setFirstMessageData()}cachePreviousMessage(l){this._previousMessage=l>0?this.messages[l-1]:void 0}openContact(l){return this.contactClick.emit({contactId:l}),!1}trackMessageById(l,_){return _.id}isShowSeparator(l,_){return this._isNewDay(l)?this.separatorText=this._formatDate(l.time):this.separatorText=this._isNewMessages(_)?this._translateService.instant("ChatSettings.ChatWindow.NewMessages"):"",this.separatorText!==""}openImage(l){const _=l.target,y=document.body,o=document.createElement("div");o.classList.add("full-chat-image-container"),o.style.backgroundImage="url('"+_.src+"')",o.style.backgroundSize=z._isLargeImage(_,y)?"contain":"auto",o.addEventListener("click",function(){y.removeChild(o)}),y.appendChild(o)}getFileUrl(l){return this._joinPath((0,M.cI)(),this._fileServiceUrl,l)}getImageUrl(l){return this._isFileApiEnabled?this.getFileUrl(l):this._joinPath((0,M.cI)(),this._imageUrl,l)}isFirstMessageInSequence(l){const _=this.messages.findIndex(o=>o.id===l.id);if(_===0)return!0;const y=this.messages[_-1];return this._isAuthorChanged(l,y)}isLastMessageInSequence(l){const _=this.messages.findIndex(o=>o.id===l.id);if(_===this.messages.length-1)return!0;const y=this.messages[_+1];return this._isAuthorChanged(l,y)}isSystemMessage(l){return l.type===O.Go.System}onChatImgLoaded(l){const _=l.target;this.isImageOversize(_.width,_.height)&&_.parentElement.classList.add("img-contain")}isImageOversize(l,_){const y=l/_,o=this.imageContainerSize.width/this.imageContainerSize.height;return Math.max(y,o)/Math.min(y,o)<=2&&l>this.imageContainerSize.width&&_>this.imageContainerSize.height}formatSystemMessage(l){const _=new Date(l.time);(0,C.v8)(_,this._userInfo.timeZoneOffsetHours);const y=this._formatDate(_),o=(0,C.a8)(_,this._userInfo.cultureInfo);return l.text.replace("{datePart}",y).replace("{timePart}",o)}getLocalTime(l){const _=new Date(l);return(0,C.v8)(_,this._userInfo.timeZoneOffsetHours),(0,C.a8)(_,this._userInfo.cultureInfo)}showMessageFromAttachment(l){return l.text}getIsDuplicateMessage(l){return this.messages?this._duplicateIds.indexOf(l)!==-1:!1}static{this.\u0275fac=function(_){return new(_||z)(t.\u0275\u0275directiveInject(h.oq),t.\u0275\u0275directiveInject(r.TranslateService),t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(v.d),t.\u0275\u0275directiveInject(U.wf))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:z,selectors:[["crt-chat-messages"]],inputs:{messages:"messages",messagesCounter:"messagesCounter",chat:"chat"},outputs:{contactClick:"contactClick"},features:[t.\u0275\u0275NgOnChangesFeature],decls:2,vars:3,consts:[["class","first-message-date-separator messages-separator",4,"ngIf"],["class","message",3,"class","id","ngClass","ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"first-message-date-separator","messages-separator"],[1,"message",3,"id","ngClass","ngStyle"],["class","messages-separator",4,"ngIf"],["class","message-author",3,"hidden",4,"ngIf"],[1,"text-block",3,"ngSwitch"],["class","system-message-type",4,"ngSwitchCase"],["class","message-type text-message-type",3,"ngClass",4,"ngSwitchCase"],["class","attachment-message-type",4,"ngSwitchDefault"],[1,"messages-separator"],[1,"message-author",3,"hidden"],[1,"author-name"],[1,"author-photo",3,"contactClick","contact","contactColor"],[1,"system-message-type"],[1,"message-type","text-message-type",3,"ngClass"],[1,"message-text"],[1,"message-time"],[1,"attachment-message-type"],[3,"ngSwitch",4,"ngFor","ngForOf"],["class","message-type text-message-type",4,"ngIf"],[3,"ngSwitch"],["class","message-type image-message-type",4,"ngSwitchCase"],["class","message-type file-message-type",3,"ngClass",4,"ngSwitchDefault"],[1,"message-type","image-message-type"],["alt","",1,"image-container",3,"click","load","ngStyle","src"],[1,"image-time"],[1,"message-type","file-message-type",3,"ngClass"],[1,"download-file","message-text"],[1,"file-message-type-link",3,"href"],[1,"message-type","text-message-type"]],template:function(_,y){_&1&&t.\u0275\u0275template(0,k,3,1,"div",0)(1,$,8,16,"div",1),_&2&&(t.\u0275\u0275property("ngIf",y.firstMessageDate),t.\u0275\u0275advance(),t.\u0275\u0275property("ngForOf",y.messages)("ngForTrackBy",y.trackMessageById))},dependencies:[E.NgClass,E.NgForOf,E.NgIf,E.NgStyle,E.NgSwitch,E.NgSwitchCase,E.NgSwitchDefault,i.u],styles:[".message[_ngcontent-%COMP%]{flex-direction:column;display:flex}.message[_ngcontent-%COMP%]:last-child{animation:_ngcontent-%COMP%_fadein .5s ease 1 alternate}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}.message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{font-family:Open Sans,serif;font-size:11px;text-align:center;letter-spacing:0;color:#999;opacity:1;vertical-align:top}.message[_ngcontent-%COMP%]   .author-photo[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;cursor:pointer}.message[_ngcontent-%COMP%]   .message-author[_ngcontent-%COMP%]{margin-bottom:-13px;margin-top:17px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{display:block;position:relative;bottom:-3px;float:right;text-align:center;font-family:Open Sans,serif;letter-spacing:0;color:#999;opacity:1;padding-top:2px;font-size:11px;margin-left:13px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:3px;display:inline-block;padding:8px 10px;margin:1px 0 1px 39px;text-align:left}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{text-align:left;font-family:Open Sans,serif;font-size:15px;letter-spacing:0;color:#444;opacity:1;white-space:pre-wrap;word-break:break-word}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .image-time[_ngcontent-%COMP%]{position:absolute;right:18px;bottom:18px;color:#fff;background-color:#999;font-size:11px;border-radius:12px;padding-left:5px;padding-right:5px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .message-image-item[_ngcontent-%COMP%]{position:relative}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:auto;background-position:center;object-fit:none}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .system-message-type[_ngcontent-%COMP%]{font-size:11px;text-align:center;color:#999;margin-top:17px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{padding-left:22px;text-decoration:none}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzQ2OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA0Njkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzQ5MiIgZGF0YS1uYW1lPSJHcm91cCA3NDkyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTguNSAtNDM4LjA0MikiPg0KICAgIDxwYXRoIGlkPSJQYXRoXzY5NDQiIGRhdGEtbmFtZT0iUGF0aCA2OTQ0IiBkPSJNLTMxNSw0NDUuNTQybDUsNC41LDUtNC41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogIDwvZz4NCiAgPGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguNSAwLjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzc3OSIgZGF0YS1uYW1lPSJMaW5lIDc3OSIgeDI9IjEyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgMTQuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU0NjU3ZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K);background-repeat:no-repeat;background-position:2px 5px}.message.incoming-message[_ngcontent-%COMP%]{text-align:left}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:0 16px 16px 0;padding-right:16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.text-message-type[_ngcontent-%COMP%]{padding-left:14px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence[_ngcontent-%COMP%]:not(.last-in-sequence){border-radius:16px 16px 16px 0}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.last-in-sequence[_ngcontent-%COMP%]:not(.first-in-sequence){border-radius:0 16px 16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence.last-in-sequence[_ngcontent-%COMP%]{border-radius:16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{color:#4e7bd8}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzQ2OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA0Njkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzQ5MiIgZGF0YS1uYW1lPSJHcm91cCA3NDkyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTguNSAtNDM4LjA0MikiPg0KICAgIDxwYXRoIGlkPSJQYXRoXzY5NDQiIGRhdGEtbmFtZT0iUGF0aCA2OTQ0IiBkPSJNLTMxNSw0NDUuNTQybDUsNC41LDUtNC41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogIDwvZz4NCiAgPGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguNSAwLjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzc3OSIgZGF0YS1uYW1lPSJMaW5lIDc3OSIgeDI9IjEyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgMTQuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU0NjU3ZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K)}.message.incoming-message[_ngcontent-%COMP%]   .author-photo[_ngcontent-%COMP%]{float:left}.message.incoming-message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{margin-left:7px}.message.outcoming-message[_ngcontent-%COMP%]{text-align:right}.message.outcoming-message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{margin-right:7px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:16px 0 0 16px;padding-left:16px;padding-right:14px;margin-right:0}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence[_ngcontent-%COMP%]:not(.last-in-sequence){border-radius:16px 16px 0}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.last-in-sequence[_ngcontent-%COMP%]:not(.first-in-sequence){border-radius:16px 0 16px 16px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence.last-in-sequence[_ngcontent-%COMP%]{border-radius:16px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{color:#e5e8ee}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGRhdGEtbmFtZT0iQ29tcG9uZW50IDQ2OSDigJMgMSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBzdHlsZT0iIj48cmVjdCBpZD0iYmFja2dyb3VuZHJlY3QiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHg9IjAiIHk9IjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIvPgogIAogIAogIAogIAo8ZyBjbGFzcz0iY3VycmVudExheWVyIiBzdHlsZT0iIj48dGl0bGU+TGF5ZXIgMTwvdGl0bGU+PGcgaWQ9Ikdyb3VwXzc0OTIiIGRhdGEtbmFtZT0iR3JvdXAgNzQ5MiIgY2xhc3M9IiIgc3Ryb2tlPSIjZGFkYWRhIiBzdHJva2Utb3BhY2l0eT0iMSI+CiAgICA8cGF0aCBpZD0iUGF0aF82OTQ0IiBkYXRhLW5hbWU9IlBhdGggNjk0NCIgZD0iTTMuNSw3LjUwMDAwNzgxMjQ5OTk3MyBsNSw0LjUgbDUsLTQuNSAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2RhZGFkYSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjAuOCIgc3Ryb2tlLW9wYWNpdHk9IjEiLz4KICA8L2c+PGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIgeTI9IjAuNSIgeDI9IjguNSIgeDE9IjguNSIgY2xhc3M9IiIvPjxsaW5lIGRhdGEtbmFtZT0iTGluZSA3NzgiIHkxPSIxMS41IiBmaWxsPSJub25lIiBzdHJva2U9IiNkYWRhZGEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIiB5Mj0iMC41IiB4Mj0iOC41IiB4MT0iOC41IiBjbGFzcz0iIiBpZD0ic3ZnXzEiLz48bGluZSBpZD0iTGluZV83NzkiIGRhdGEtbmFtZT0iTGluZSA3NzkiIHgyPSIxNC41IiBmaWxsPSJub25lIiBzdHJva2U9IiNkYWRhZGEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIiB5Mj0iMTQuNDgxNzAxNzM5MTMyNDA0IiB5MT0iMTQuNDgxNzAxNzM5MTMyNDA0IiB4MT0iMi41IiBjbGFzcz0iIi8+PHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiIGNsYXNzPSIiIHk9IjIuMTk3ODAyNTQzNjQwMTM2NyIgeD0iNTEuMDk4OTAzNjU2MDA1ODYiIHRyYW5zZm9ybT0icm90YXRlKC0xLjU5MTE0NTE1NzgxNDAyNTkgNTkuMDk4OTAzNjU2MDA2MDE2LDEwLjE5NzgwMjU0MzY0MDAzNCkgIi8+PC9nPjwvc3ZnPg==)}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo[_ngcontent-%COMP%]   .contact-photo.no-photo[_ngcontent-%COMP%]{font-size:12px!important}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]{display:inline-block;width:16px}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]     .contact-photo{line-height:1.6em;font-size:1em;width:16px;height:16px;min-width:16px;min-height:16px}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]{background:linear-gradient(#fafcfe,#fafcfe) padding-box,linear-gradient(to bottom right,#0077ff40,#8a1fe640,#f1255b40,#ff180040) border-box;border:1px solid transparent}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{color:#444}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#999}.message.bot-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]     .contact-photo{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9Ikljb24gfCBBSSBDb3BpbG90IC0gMTZ4MTYgfCBoZWF2eSI+CjxnIGlkPSJTdWJ0cmFjdCI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMC4yMzU3NjEgNi4wNjQzNEMwLjA4MTc0MTkgNi42ODQxNiAwIDcuMzMyNTMgMCA4QzAgMTIuNDE4MyAzLjU4MTcyIDE2IDggMTZDMTAuOTYxMSAxNiAxMy41NDY1IDE0LjM5MTIgMTQuOTI5NyAxMkgxMi43MzYxQzExLjU5OSAxMy4zNDUgOS44OTkyMSAxNC4xOTkxIDggMTQuMTk5MUM0LjU3NjMzIDE0LjE5OTEgMS44MDA4OSAxMS40MjM3IDEuODAwODkgOEMxLjgwMDg5IDcuNjUzNzkgMS44MjkyNyA3LjMxNDIxIDEuODgzODMgNi45ODM0NkwwLjIzNTc2MSA2LjA2NDM0Wk0xMi43MzYxIDQuMDAwMDFDMTEuNTk5IDIuNjU0OTggOS44OTkyMyAxLjgwMDg5IDggMS44MDA4OUM3LjMzNTY1IDEuODAwODkgNi42OTU3MSAxLjkwNTQgNi4wOTU3MiAyLjA5ODg3TDMuNTI4NDcgMS4zNjUzN0M0LjgwNTAxIDAuNTAzMzI3IDYuMzQzNzMgMCA4IDBDMTAuOTYxMSAwIDEzLjU0NjUgMS42MDg4IDE0LjkyOTggNC4wMDAwMUgxMi43MzYxWiIgZmlsbD0idXJsKCNwYWludDBfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMC4yMzU3NjEgNi4wNjQzNEMwLjA4MTc0MTkgNi42ODQxNiAwIDcuMzMyNTMgMCA4QzAgMTIuNDE4MyAzLjU4MTcyIDE2IDggMTZDMTAuOTYxMSAxNiAxMy41NDY1IDE0LjM5MTIgMTQuOTI5NyAxMkgxMi43MzYxQzExLjU5OSAxMy4zNDUgOS44OTkyMSAxNC4xOTkxIDggMTQuMTk5MUM0LjU3NjMzIDE0LjE5OTEgMS44MDA4OSAxMS40MjM3IDEuODAwODkgOEMxLjgwMDg5IDcuNjUzNzkgMS44MjkyNyA3LjMxNDIxIDEuODgzODMgNi45ODM0NkwwLjIzNTc2MSA2LjA2NDM0Wk0xMi43MzYxIDQuMDAwMDFDMTEuNTk5IDIuNjU0OTggOS44OTkyMyAxLjgwMDg5IDggMS44MDA4OUM3LjMzNTY1IDEuODAwODkgNi42OTU3MSAxLjkwNTQgNi4wOTU3MiAyLjA5ODg3TDMuNTI4NDcgMS4zNjUzN0M0LjgwNTAxIDAuNTAzMzI3IDYuMzQzNzMgMCA4IDBDMTAuOTYxMSAwIDEzLjU0NjUgMS42MDg4IDE0LjkyOTggNC4wMDAwMUgxMi43MzYxWiIgZmlsbD0idXJsKCNwYWludDFfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjwvZz4KPGcgaWQ9InNoYXBlIj4KPHBhdGggZD0iTTE2IDhMNyAxMS41TDguNSA4TDAgMkwxNiA4WiIgZmlsbD0idXJsKCNwYWludDJfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjxwYXRoIGQ9Ik0xNiA4TDcgMTEuNUw4LjUgOEwwIDJMMTYgOFoiIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbF80NzQ3Xzc4MTAyKSIvPgo8L2c+CjwvZz4KPGRlZnM+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQwX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMTg3OTk3IC0wLjgyMjgyOSkgcm90YXRlKDcyLjA0NjgpIHNjYWxlKDM2LjYyNyAxNS43Mzc5KSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjYxIiBzdG9wLWNvbG9yPSIjOEExRkU2Ii8+CjxzdG9wIG9mZnNldD0iMC45MzUiIHN0b3AtY29sb3I9IiNGMTI1NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxODAwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQxX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjM1OTE5IC01LjEpIHJvdGF0ZSg1My43Njk0KSBzY2FsZSgzNi45NDMyIDE2LjQ2NSkiPgo8c3RvcCBzdG9wLWNvbG9yPSIjMDgxQTJGIi8+CjxzdG9wIG9mZnNldD0iMC42MSIgc3RvcC1jb2xvcj0iIzhBMUZFNiIvPgo8c3RvcCBvZmZzZXQ9IjAuOTM1IiBzdG9wLWNvbG9yPSIjRjEyNTVCIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0ZGMTgwMCIvPgo8L3JhZGlhbEdyYWRpZW50Pgo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50Ml9yYWRpYWxfNDc0N183ODEwMiIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgwLjIwMTQ3NCAxLjUxMTQ1KSByb3RhdGUoNTkuNjc5NCkgc2NhbGUoMjMuOTY2NiAxNS4zMDQzKSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjYxIiBzdG9wLWNvbG9yPSIjOEExRkU2Ii8+CjxzdG9wIG9mZnNldD0iMC45MzUiIHN0b3AtY29sb3I9IiNGMTI1NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxODAwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQzX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjYgLTEuMDI4MTMpIHJvdGF0ZSgzNy4wOTQ1KSBzY2FsZSgyOS4zMzY1IDEzLjE5MzQpIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzA4MUEyRiIvPgo8c3RvcCBvZmZzZXQ9IjAuNjEiIHN0b3AtY29sb3I9IiM4QTFGRTYiLz4KPHN0b3Agb2Zmc2V0PSIwLjkzNSIgc3RvcC1jb2xvcj0iI0YxMjU1QiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGRjE4MDAiLz4KPC9yYWRpYWxHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K)!important;background-size:16px 16px;cursor:default}.messages-separator[_ngcontent-%COMP%]{width:100%;text-align:center;border-bottom:1px solid #e3e6ec;line-height:.1em;margin:17px 0}.messages-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;letter-spacing:0;color:#999;opacity:1;font-family:Open Sans,serif;font-size:11px}.first-message-date-separator[_ngcontent-%COMP%]{border:none;margin-top:8px}.incoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{background-color:#eaedf3;border:1px solid #e3e6ec;align-self:flex-start}.outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{background-color:#006ce0;align-self:flex-end}.outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%], .outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fff}.text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{position:relative;background-color:#fff;border:none}.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{padding-left:0}.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{padding-right:0}"]})}}(0,s.__decorate)([(0,P.k)(),(0,s.__metadata)("design:type",Array),(0,s.__metadata)("design:paramtypes",[Array])],z.prototype,"messages",null),(0,s.__decorate)([(0,P.k)(),(0,s.__metadata)("design:type",Object)],z.prototype,"messagesCounter",void 0),(0,s.__decorate)([(0,P.k)(),(0,s.__metadata)("design:type",D.Hh)],z.prototype,"chat",void 0),(0,s.__decorate)([(0,L.j)(),(0,s.__metadata)("design:type",Object)],z.prototype,"contactClick",void 0)},91308:(K,T,e)=>{e.d(T,{p:()=>u});var s=e(62278),I=e.n(s),t=e(59131),A=e.n(t),P=e(76732),L=e(23023),r=e.n(L),g=e(76923),C=e.n(g),M=e(40297),B=e.n(M),d=e(79772),n=e.n(d);class u{constructor(D){this._academyService=D,this.academyUrl$=new s.BehaviorSubject("")}ngOnInit(){this._academyService.getAcademyHelpUrl("ChatAccess").pipe((0,s.take)(1)).subscribe(D=>{this.academyUrl$.next(D)})}static{this.\u0275fac=function(m){return new(m||u)(t.\u0275\u0275directiveInject(P.k))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:u,selectors:[["ts-facebook-channel-error-dialog"]],decls:12,vars:12,consts:[["mat-dialog-content",""],[1,"message"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(m,h){m&1&&(t.\u0275\u0275elementStart(0,"div",0)(1,"span",1),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementStart(4,"a",2),t.\u0275\u0275pipe(5,"async"),t.\u0275\u0275text(6),t.\u0275\u0275pipe(7,"translate"),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementStart(8,"div",3)(9,"button",4),t.\u0275\u0275text(10),t.\u0275\u0275pipe(11,"translate"),t.\u0275\u0275elementEnd()()),m&2&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,4,"ChatSettings.ChannelDetail.FacebookSettings.InvalidSettings.Message")," "),t.\u0275\u0275advance(2),t.\u0275\u0275propertyInterpolate("href",t.\u0275\u0275pipeBind1(5,6,h.academyUrl$),t.\u0275\u0275sanitizeUrl),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(7,8,"ChatSettings.ChannelDetail.FacebookSettings.InvalidSettings.Link.Text")," "),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(11,10,"InfoDialog.OK")," "))},dependencies:[L.MatLegacyButton,g.MatLegacyDialogClose,g.MatLegacyDialogContent,g.MatLegacyDialogActions,M.AsyncPipe,d.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{float:right;margin-left:auto;border-radius:4px}"]})}}},31576:(K,T,e)=>{e.d(T,{C:()=>s});const s={OK:{key:"OK",config:{color:"primary",caption:"Dialog.Ok"}},YES:{key:"YES",config:{color:"primary",caption:"Dialog.Yes"}},NO:{key:"NO",config:{color:"default",caption:"Dialog.No"}}}},98647:(K,T,e)=>{e.d(T,{C:()=>s});var s;(function(I){I.FacebookMessenger="50491c6c-d82b-4b86-b38c-99262d11a5ac",I.Telegram="645170ab-c67a-4dcc-9def-c0e5236bdfe0",I.WhatsApp="1398dc73-b428-4e21-b97a-c1bb6b4bc621",I.AdaConnector="fd6491c5-0ebe-408a-a4c3-057a1ac79dd4"})(s||(s={}))},90150:(K,T,e)=>{e.d(T,{x:()=>E});var s=e(73308),I=e(5960),t=e.n(I),A=e(41287),P=e(6530),L=e(82517),r=e(91775),g=e(61541),C=e(844),M=e(22592),B=e(80939),d=e(49213),n=e(62278),u=e.n(n),O=e(91308),D=e(31576),m=e(98647),h=e(75169),v=e(33856),U=e(21896);let E=class extends A.l{constructor(i,a,c,f,x,j){super(),this._facebookApiProvider=i,this._channelService=a,this._facebookRegistrationService=c,this._maskService=f,this._dialogProvider=x,this._messageDialogProvider=j}_isCreateFacebookChannelRequest(i){return i.entityName==="Channel"&&this._getDefaultValue(i,"Provider")===m.C.FacebookMessenger}_getDefaultValue(i,a){return i.defaultValues.find(c=>c.attributeName===a)?.value}_getChannel(i){return{id:(0,P.qv)(),name:i.name,typeId:m.C.FacebookMessenger,source:i.id,isActive:!1}}_addFacebookMessengerChannels(i){var a=this;return(0,s.A)(function*(){if(!(yield a._facebookApiProvider.isFacebookSettingValid())){yield(0,n.firstValueFrom)(a._dialogProvider.open(O.p,{panelClass:["crt-message-dialog"]}));return}a.initFacebookPages().pipe((0,n.concatMap)(c=>(0,n.from)(c)),(0,n.concatMap)(c=>a._facebookApiProvider.attachPage(c.token).pipe((0,n.concatMap)(()=>{const f=a._getChannel(c);return a._maskService.showBodyMask(),a._facebookRegistrationService.registerFacebookChannel(c.token,c.id).pipe((0,n.concatMap)(x=>x?.success?(f.msgSettingsId=x.SettingsId,f.id=(0,P.qv)(),f.isActive=!0,(0,n.from)(a._channelService.insertItem(f)).pipe((0,n.concatMap)(()=>a._openChannelEditingPage(i,c.id,c.name,f.id)))):(a._messageDialogProvider.open({data:{message:x?.errorInfo?.message||"An unknown error occurred during the operation.",actions:[D.C.OK]}}),n.EMPTY)))})))).subscribe(()=>{console.log("FB channel connected")},null,()=>{(0,n.from)(a._reloadChannelsList(i)),a._maskService.hideBodyMask()})})()}_reloadChannelsList(i){return(0,s.A)(function*(){const{$context:a,scopes:c}=i,f=i.$context.models.find(j=>j.dataSource.initialConfig.entitySchemaName==="Channel"),x={type:"crt.LoadDataRequest",scopes:c,config:{loadType:L.I.Reload},$context:a,dataSourceName:f.dataSource.dataSourceName};yield r.t.instance.process(x)})()}_openChannelEditingPage(i,a,c,f){return(0,s.A)(function*(){const x=i.$context;yield x.executeRequest({type:"crt.OpenPageRequest",schemaName:"FBMessengerChannel_EditPage",modelInitConfigs:[{recordId:f,action:g.n.Edit}],$context:x})})()}initFacebookPages(){return this._facebookApiProvider.initApi().pipe((0,n.concatMap)(()=>this._facebookApiProvider.login()),(0,n.concatMap)(()=>this._facebookApiProvider.getPages()))}handle(i){var a=this;return(0,s.A)(function*(){if(!a._isCreateFacebookChannelRequest(i))return a.next?.handle(i);yield a._addFacebookMessengerChannels(i)})()}};E=(0,I.__decorate)([(0,C.l)({requestType:"crt.CreateRecordRequest",type:"crt.FacebookChannelCreateRecordHandler",scopes:["ChatSettingsPage"]}),(0,I.__metadata)("design:paramtypes",[h.I,v.l,U.T,M.s,B.g,d.L])],E)},91438:(K,T,e)=>{e.d(T,{F:()=>g});var s=e(5960),I=e.n(s),t=e(59131),A=e.n(t),P=e(844),L=e(7471),r=e(90023);let g=class extends r._{constructor(M){super(M),this._operation="CanManageChats",this._dialogService=M.get(L.o)}getOperation(){return this._operation}showMessage(){this._dialogService.openOperationPermissionsErrorDialog(this._operation)}};g=(0,s.__decorate)([(0,P.l)({type:"crt.ChatSettingsPageInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["ChatSettingsPage","ChatQueues_FormPage"]}),(0,s.__metadata)("design:paramtypes",[t.Injector])],g)},10414:(K,T,e)=>{e.d(T,{A:()=>E,D:()=>W});var s=e(73308),I=e(5960),t=e.n(I),A=e(41287),P=e(43785),L=e(86464),r=e(91775),g=e(82517),C=e(844),M=e(79772),B=e.n(M),d=e(7471),n=e(65751),u=e(57372),O=e(89285),D=e(3284),m=e(28399),h=e.n(m),v=e(62278),U=e.n(v);class E extends D.H{}let W=class extends A.l{constructor(a,c,f){super(),this.dialogService=a,this.queryExecutor=c,this.translateService=f,this._dataSourceName="QueueAgentsListDS"}_getEntityName(a){return a.$context.dataSchemas[this._dataSourceName]?.dataSourceConfig?.config?.entitySchemaName}_getInsertQuery(a,c){var f=this;return(0,s.A)(function*(){const x=f._getEntityName(a),j=new P.L(x);return[{path:"Operator",value:c,type:L.r.Guid},{path:"ChatQueue",value:yield a.$context.Id,type:L.r.Guid}].forEach(Z=>{j.addColumn(Z.path,Z.value,Z.type)}),j})()}_createDuplicationsValidator(a){return c=>{const f=a.find(x=>x.attributes.QueueAgentsListDS_Operator.value===c.id);return{success:(0,m.isEmpty)(f),message:this.translateService.instant("ChatSettings.ChatQueueOperatorDetail.DuplicationMessage")}}}_saveViewModel(a){return(0,s.A)(function*(){const{$context:c,scopes:f}=a,x={type:"crt.SaveRecordRequest",preventCardClose:!0,scopes:f,$context:c};return yield r.t.instance.process(x)})()}_reloadAgentDetail(a){return(0,s.A)(function*(){const c=a.$context,f=yield c.getPrimaryModelName(),x=yield c.getPrimaryDataSchema(),j={type:"crt.LoadDataRequest",config:{loadType:g.I.Reload},$context:c,parameters:[{type:"primaryColumnValue",value:x.primaryAttributeName}],dataSourceName:f};yield r.t.instance.process(j)})()}handle(a){var c=this;return(0,s.A)(function*(){if(a.$context.PrimaryModelMode===O.b.Create&&!(yield c._saveViewModel(a)))return;const x=yield a.$context.QueueAgentsList,j=yield(0,v.lastValueFrom)(c.dialogService.open(u.q,{data:{validator:c._createDuplicationsValidator(x)}}));if(j?.id){const k=yield c._getInsertQuery(a,j.id),Z=c.queryExecutor.executeInsertQuery(k);yield(0,v.lastValueFrom)(Z),yield c._reloadAgentDetail(a)}yield c.next?.handle(a)})()}};W=(0,I.__decorate)([(0,C.l)({type:"crt.CreateQueueAgentHandler",requestType:"crt.CreateQueueAgentHandlerRequest"}),(0,I.__metadata)("design:paramtypes",[d.o,n.w,M.TranslateService])],W)},69906:(K,T,e)=>{e.d(T,{z:()=>r});var s=e(73308),I=e(5960),t=e.n(I),A=e(41287),P=e(844),L=e(44488);let r=class extends A.l{constructor(C){super(),this.telegramService=C,this._telegramBotAttrName="TelegramBot"}_setTelegramBotLink(C,M){const B=`<a target='_blank' href='https://t.me/${C}'>${C}</a>`;M[this._telegramBotAttrName]=B}handle(C){var M=this;return(0,s.A)(function*(){const B=C.$context,d=B.getViewModelAttributePaths(yield B.getPrimaryModelName(),"MsgSettingsId")[0],n=yield B[d],u=yield B[M._telegramBotAttrName];return n&&!u&&!M._getUserName$&&(M._getUserName$=M.telegramService.getTelegramUserName(n).subscribe(O=>{M._setTelegramBotLink(O,B),M._getUserName$.unsubscribe()})),yield M.next?.handle(C)})()}};r=(0,I.__decorate)([(0,P.l)({type:"crt.TelegramChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["TelegramChannel_EditPage"]}),(0,I.__metadata)("design:paramtypes",[L.A])],r)},42498:(K,T,e)=>{e.d(T,{c:()=>u});var s=e(73308),I=e(5960),t=e.n(I),A=e(41287),P=e(844),L=e(22592),r=e(79772),g=e.n(r),C=e(49213),M=e(62278),B=e.n(M),d=e(31576),n=e(44488);let u=class extends A.l{constructor(D,m,h,v){super(),this._telegramService=D,this._messageDialogProvider=m,this._translateService=h,this._maskService=v}_setModelValue(D,m,h,v){const U=D.getViewModelAttributePaths(m,h)[0];D[U]=v}_setModelValues(D,m){var h=this;return(0,s.A)(function*(){const v=yield D.getPrimaryModelName();h._setModelValue(D,v,"Name",m.ChannelName),h._setModelValue(D,v,"Source",m.TelegramId),h._setModelValue(D,v,"MsgSettingsId",m.SettingsId)})()}handle(D){var m=this;return(0,s.A)(function*(){const h=D.$context,v=yield h.validate();if(Object.keys(v).length>0)return;yield m._maskService.showBodyMask();const U=yield h.TelegramToken,E=yield(0,M.firstValueFrom)(m._telegramService.registerTelegramChannel(U)),W=m._telegramService.validateRegisterChannel(E);if(yield m._maskService.hideBodyMask(),W?.length>0)m._messageDialogProvider.open({data:{message:m._translateService.instant(W),actions:[d.C.OK]}});else return yield m._setModelValues(h,E),m.next?.handle(D)})()}};u=(0,I.__decorate)([(0,P.l)({requestType:"crt.SaveRecordRequest",type:"crt.TelegramChannelSaveHandler",scopes:["TelegramChannel_AddingPage"]}),(0,I.__metadata)("design:paramtypes",[n.A,C.L,r.TranslateService,L.s])],u)},90090:(K,T,e)=>{e.d(T,{X:()=>D});var s=e(73308),I=e(5960),t=e.n(I),A=e(41287),P=e(844),L=e(22592),r=e(79772),g=e.n(r),C=e(49213),M=e(62278),B=e.n(M),d=e(31576),n=e(98647),u=e(24788),O=e(33856);let D=class extends A.l{constructor(h,v,U,E,W){super(),this._whatsAppService=h,this._channelService=v,this._messageDialogProvider=U,this._translateService=E,this._maskService=W}_handleConnectError(h){if(h?.errorInfo?.errorCode){const v=this._whatsAppService.validateRegisterChannel(h);this._messageDialogProvider.open({data:{message:this._translateService.instant(v),actions:[d.C.OK]}})}}_getDigits(h){return h.replace(/\D+/g,"")}_setModelValue(h,v,U,E){const W=h.getViewModelAttributePaths(v,U)[0];h[W]=E}_setModelValues(h,v,U){var E=this;return(0,s.A)(function*(){const W=yield h.getPrimaryModelName();E._setModelValue(h,W,"MsgSettingsId",v.SettingsId),E._setModelValue(h,W,"Source",U),E._setModelValue(h,W,"Name",U)})()}handle(h){var v=this;return(0,s.A)(function*(){const U=h.$context,E=yield U.validate();if(Object.keys(E).length>0)return;yield v._maskService.showBodyMask();const W=yield U.TwilioToken,i=yield U.ApplicationId,a=v._getDigits(yield U.PhoneNumber);if(yield(0,M.firstValueFrom)(v.validateIntegration(a,W,i))){const f=yield(0,M.firstValueFrom)(v._whatsAppService.register(W,i,a)),x=v._whatsAppService.validateRegisterChannel(f);if(yield v._maskService.hideBodyMask(),x?.length>0)v._messageDialogProvider.open({data:{message:v._translateService.instant(x),actions:[d.C.OK]}});else return yield v._setModelValues(h.$context,f,a),v.next?.handle(h)}})()}validateIntegration(h,v,U){return new M.Observable(E=>{this._channelService.checkCanSaveChannel(h,n.C.WhatsApp,W=>{W?this._whatsAppService.tryConnect(v,U,h).subscribe(i=>{i?.IsConnectionSuccess?E.next(!0):(this._maskService.hideBodyMask(),this._handleConnectError(i),E.next(!1)),E.complete()}):(this._maskService.hideBodyMask(),this._messageDialogProvider.open({data:{message:this._translateService.instant("ChatSettings.ChannelPage.WhatsApp.ChannelDuplicatedErrorMessage"),actions:[d.C.OK]}}),E.next(!1),E.complete())})})}};D=(0,I.__decorate)([(0,P.l)({requestType:"crt.SaveRecordRequest",type:"crt.WhatsAppSaveChannelHandler",scopes:["WhatsAppChannel_AddingPage"]}),(0,I.__metadata)("design:paramtypes",[u.J,O.l,C.L,r.TranslateService,L.s])],D)},71640:(K,T,e)=>{e.d(T,{c:()=>I});var s=e(98647);class I{get type(){switch(this.typeId){case s.C.FacebookMessenger:return s.C.FacebookMessenger;case s.C.Telegram:return s.C.Telegram;default:throw new Error(`Type with id ${this.typeId} not found`)}}}},44459:(K,T,e)=>{e.d(T,{B:()=>_});var s=e(5960),I=e(40297),t=e(63721),A=e(56711),P=e(23023),L=e(76923),r=e(55642),g=e(79772),C=e(74501),M=e(61267),B=e(23092),d=e(45328),n=e(97696),u=e(91308),O=e(42498),D=e(90090),m=e(10414),h=e(69906),v=e(90150),U=e(91438),E=e(73308),W=e(41287),i=e(844),a=e(22592),c=e(49213),f=e(62278),x=e(31576),j=e(56704);let k=class extends W.l{constructor(o,p,S,N){super(),this._chatService=o,this._maskService=p,this._messageDialogProvider=S,this._translateService=N,this._channelsListName="ChannelsList",this._activeChatsValidationErrorMsgCode="ChatSettings.Channel.ActiveChatsValidationError"}_validateForActiveChats(o){var p=this;return(0,E.A)(function*(){yield p._maskService.showBodyMask();const S=yield(0,f.lastValueFrom)(p._chatService.hasUncompletedChats(o));if(yield p._maskService.hideBodyMask(),S){const N=p._translateService.instant(p._activeChatsValidationErrorMsgCode);return p._messageDialogProvider.open({data:{message:N,actions:[x.C.OK]}}),!1}return!0})()}_isValid(o){return this._validateForActiveChats(o)}handle(o){var p=this;return(0,E.A)(function*(){if(o.itemsAttributeName===p._channelsListName){const S=o.recordId;if(!(yield p._isValid(S)))return}p.next?.handle(o)})()}};k=(0,s.__decorate)([(0,i.l)({requestType:"crt.DeleteRecordRequest",type:"crt.ChanelDeleteRecordHandler",scopes:["ChatSettingsPage"]}),(0,s.__metadata)("design:paramtypes",[j.I,a.s,c.L,g.TranslateService])],k);var Z=e(65576);let H=class extends W.l{constructor(o){super(),this._translateService=o,this._channelsListAttribute="ChannelsList",this._validationImageAttribute="ValidationImage"}_getAttributeValue(o,p,S){const N=o.getViewModelAttributePaths(p,S);return!N||N.length===0?"":o.attributes[N[0]]}_setupValidationError(o,p,S,N){const b=this._getAttributeValue(o,p,"Name"),F=this._translateService.instant(`ChatSettings.ChannelPage.ErrorCodes.${S}`,{channelName:b});N.tooltip=F,o.set(this._validationImageAttribute,N)}_resetValidationError(o){o.set(this._validationImageAttribute,null)}_validateChannelRecord(o){var p=this;return(0,E.A)(function*(){const S=o.attributes[p._validationImageAttribute];if(!S)return;const N=yield o.getPrimaryModelName(),b=p._getAttributeValue(o,N,"ErrorCode");return b?p._setupValidationError(o,N,b,S):p._resetValidationError(o)})()}_subscribeViewModelEvents(o){var p=this;const S=new f.Subscription;S.add(o.events$.pipe((0,f.filter)(({type:N,payload:b})=>N===Z.n.FinishLoadModelAttributes&&b&&b[this._channelsListAttribute])).subscribe({next:function(){var N=(0,E.A)(function*(){const b=o.attributes[p._channelsListAttribute];for(const F of b)yield p._validateChannelRecord(F)});return function(){return N.apply(this,arguments)}}(),complete:()=>{S.unsubscribe()}}))}handle(o){var p=this;return(0,E.A)(function*(){yield p.next?.handle(o),p._subscribeViewModelEvents(o.$context)})()}};H=(0,s.__decorate)([(0,i.l)({requestType:"crt.HandleViewModelInitRequest",type:"crt.ChannelErrorValidationHandler",scopes:["ChatSettingsPage"]}),(0,s.__metadata)("design:paramtypes",[g.TranslateService])],H);var V=e(91820);let G=class extends W.l{_setFacebookPageLink(o,p,S){const N=`<a target='_blank' href='https://facebook.com/${p}'>${o}</a>`;S[this._facebookPageLinkAttrName]=N}constructor(o){super(),this._facebookSettingsService=o,this._facebookPageLinkAttrName="FacebookLink"}handle(o){var p=this;return(0,E.A)(function*(){const S=o.$context,N=S.getViewModelAttributePaths(yield S.getPrimaryModelName(),"Source")[0],b=yield S[N],F=yield S[p._facebookPageLinkAttrName];if(b&&!F&&!p._pageRequested){p._pageRequested=!0;const ee=S.getViewModelAttributePaths(yield S.getPrimaryModelName(),"Id")[0],te=yield S[ee];p._getPageName$=p._facebookSettingsService.getPageName(b,te).subscribe(ae=>{p._setFacebookPageLink(ae,b,S),p._getPageName$.unsubscribe()})}return yield p.next?.handle(o)})()}};G=(0,s.__decorate)([(0,i.l)({type:"crt.FacebookChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["FBMessengerChannel_EditPage"]}),(0,s.__metadata)("design:paramtypes",[V.d])],G);let Q=class extends W.l{constructor(o,p,S){super(),this._messageDialogProvider=o,this._translateService=p,this._maskService=S}_savePrimaryData(o){var p=this;return(0,E.A)(function*(){const S={type:"crt.SavePrimaryDataRequest",$context:o.$context,scopes:o.scopes},N=yield p.handlerChain.process(S);return N.find(F=>F.success===!1)||N[0]})()}handle(o){var p=this;return(0,E.A)(function*(){const N=yield o.$context.validate();if(!(Object.keys(N).length>0)){yield p._maskService.showBodyMask();try{const b=yield p._savePrimaryData(o);if(!b.success)throw new Error(b.errorInfo);yield p.handlerChain.process({$context:o.$context,type:"crt.ClosePageRequest"})}catch(b){p._messageDialogProvider.open({data:{message:p._translateService.instant(b?.message),actions:[x.C.OK]}})}finally{p._maskService.hideBodyMask()}}})()}};Q=(0,s.__decorate)([(0,i.l)({requestType:"crt.SaveRecordRequest",type:"crt.TelegramUpdateChannelHandler",scopes:["TelegramChannel_EditPage"]}),(0,s.__metadata)("design:paramtypes",[c.L,g.TranslateService,a.s])],Q);let Y=class extends W.l{constructor(){super(...arguments),this._whatsappAttrName="WhatsAppLink"}_setWhatsAppLink(o,p){const S=`<a target='_blank' href='https://wa.me/${o}'>${o}</a>`;p[this._whatsappAttrName]=S}handle(o){var p=this;return(0,E.A)(function*(){const S=o.$context,N=S.getViewModelAttributePaths(yield S.getPrimaryModelName(),"Source")[0],b=yield S[N],F=yield S[p._whatsappAttrName];return b&&!F&&p._setWhatsAppLink(b,S),yield p.next?.handle(o)})()}};Y=(0,s.__decorate)([(0,i.l)({type:"crt.WhatsAppChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["WhatsAppChannel_EditPage"]})],Y);var w=e(33856),J=e(75169),X=e(53136),$=e(82134),z=e(14876),R=e(30700),l=e(59131);let _=class q{static{this.\u0275fac=function(p){return new(p||q)}}static{this.\u0275mod=l.\u0275\u0275defineNgModule({type:q})}static{this.\u0275inj=l.\u0275\u0275defineInjector({providers:[w.l,$.p,j.I,z.K,J.I,V.d,R.Z,B.vn,{provide:C.L,useClass:X.J}],imports:[I.CommonModule,M.B,A.FormsModule,t.HttpClientModule,g.TranslateModule,P.MatLegacyButtonModule,L.MatLegacyDialogModule]})}};_=(0,s.__decorate)([(0,r.g)({requestHandlers:[O.c,D.X,m.D,h.z,v.x,k,H,G,Y,U.F,Q]})],_),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.\u0275\u0275setNgModuleScope(_,{declarations:[d.D,n.z,u.p],imports:[I.CommonModule,M.B,A.FormsModule,t.HttpClientModule,g.TranslateModule,P.MatLegacyButtonModule,L.MatLegacyDialogModule],exports:[d.D,n.z,u.p]})}()},33856:(K,T,e)=>{e.d(T,{l:()=>O});var s=e(6530),I=e(49973),t=e(61320),A=e(58504),P=e(79772),L=e.n(P),r=e(43272),g=e(36486),C=e.n(g),M=e(71640),B=e(59131),d=e.n(B),n=e(65751),u=e(82134);class O extends r.A{constructor(m,h,v){super(m,h,v),this.entitySchemaName="Channel"}_createNewChannel(m){const h=new M.c;return h.id=(0,s.qv)(),h.typeId=m,h}getLookupValues(m){const h=new I.s(m);return h.addSchemaColumn("Id"),h.addSchemaColumn("Name").withOrdering(t.Z.Asc,0),this.queryExecutor.executeSelectQuery(h).pipe((0,g.map)(v=>v.map(U=>({value:U.Id,displayValue:U.Name}))))}getChannelTypeItems(){const m=new I.s("ChannelProvider");return m.addSchemaColumn("Id"),m.addSchemaColumn("Name").withOrdering(t.Z.Asc,0),m.addSchemaColumn("PageUrl"),this.queryExecutor.executeSelectQuery(m).pipe((0,g.map)(h=>h.map(v=>({value:v.Id,displayValue:v.Name,pageUrl:v.PageUrl}))))}getChannelQueueItems(){const m=new I.s("ChatQueue");return m.addSchemaColumn("Id"),m.addSchemaColumn("Name").withOrdering(t.Z.Asc,0),m.addSchemaColumn("[ChatQueueOperator:ChatQueue].Id","Operator"),this.queryExecutor.executeSelectQuery(m).pipe((0,g.map)(h=>{const v=h.filter(E=>!!E.Operator);return v.filter((E,W)=>v.findIndex(i=>i.Id===E.Id)===W).map(E=>({value:E.Id,displayValue:E.Name}))}))}getActiveLanguages(){const m=new I.s("SysLanguage");return m.addSchemaColumn("Id"),m.addSchemaColumn("Name").withOrdering(t.Z.Asc,0),m.filters.addSchemaColumnFilterWithParameter(A.H.Equal,"IsUsed",1),this.queryExecutor.executeSelectQuery(m).pipe((0,g.map)(h=>h.map(v=>({value:v.Id,displayValue:v.Name}))))}generateNewChannelResponse(m){return{success:!0,result:[this._createNewChannel(m)]}}checkCanSaveChannel(m,h,v){const U=new I.s("Channel");U.filters.addSchemaColumnFilterWithParameter(A.H.Equal,"Source",m),U.filters.addSchemaColumnFilterWithParameter(A.H.Equal,"Provider",h),this.queryExecutor.executeSelectQuery(U).subscribe(E=>{v(!(E&&E[0]))})}static{this.\u0275fac=function(h){return new(h||O)(B.\u0275\u0275inject(n.w),B.\u0275\u0275inject(P.TranslateService),B.\u0275\u0275inject(u.p))}}static{this.\u0275prov=B.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}}},53136:(K,T,e)=>{e.d(T,{J:()=>u});var s=e(41108),I=e(56267),t=e(58504),A=e(49973),P=e(79772),L=e.n(P),r=e(43272),g=e(36486),C=e.n(g),M=e(59131),B=e.n(M),d=e(65751),n=e(30700);class u extends r.A{constructor(D,m,h){super(D,m,h),this.entitySchemaName="ChatQueueOperator"}mapSysAdminUnit(D){return{id:D.Id,name:D.Name,parentRoleId:D.ParentRole&&D.ParentRole.value,sysAdminUnitTypeValue:D.SysAdminUnitTypeValue}}addSysAdminUnitQueryFilters(D){const m=new s.X;m.logicalOperation=I.H.Or,m.addSchemaColumnFilterWithParameter(t.H.Not_equal,"SysAdminUnitTypeValue",4),m.addSchemaColumnFilterWithParameter(t.H.Equal,"Active",1),D.filters.addSchemaColumnFilterWithParameter(t.H.Equal,"ConnectionType",0),D.filters.add(m)}getSysAdminUnitQuery(){const D=new A.s("SysAdminUnit");return D.addSchemaColumn("Id"),D.addSchemaColumn("Name"),D.addSchemaColumn("ParentRole"),D.addSchemaColumn("SysAdminUnitTypeValue"),D.addSchemaColumn("ConnectionType"),D.addSchemaColumn("Active"),this.addSysAdminUnitQueryFilters(D),D}getItemsByChatQueueId(D){const m=this.createGetAllItemsEsq();return m.filters.addSchemaColumnFilterWithParameter(t.H.Equal,"ChatQueue",D),this.queryExecutor.executeSelectQuery(m).pipe((0,g.map)(h=>({success:!0,errorInfo:null,result:h.map(v=>this.entityConverter.getEntity(v))})),(0,g.catchError)(h=>this.getBaseErrorResponse(h)))}getSysAdminUnitList(){const D=this.getSysAdminUnitQuery();return this.queryExecutor.executeSelectQuery(D).pipe((0,g.map)(m=>({success:!0,errorInfo:null,sysAdminUnits:m.map(h=>this.mapSysAdminUnit(h))})))}static{this.\u0275fac=function(m){return new(m||u)(M.\u0275\u0275inject(d.w),M.\u0275\u0275inject(P.TranslateService),M.\u0275\u0275inject(n.Z))}}static{this.\u0275prov=M.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac})}}},75169:(K,T,e)=>{e.d(T,{I:()=>M});var s=e(73308),I=e(28399),t=e.n(I),A=e(62278),P=e.n(A),L=e(59131),r=e.n(L),g=e(95145),C=e(91820);class M{constructor(d,n,u){this._sysSettingsService=d,this._facebookSettingsService=n,this._window=u,this._permissions="pages_show_list,pages_messaging,pages_manage_metadata,business_management,pages_read_engagement",this._fieldsToSubscribe="messages,messaging_postbacks,message_echoes,standby,messaging_handovers",this._sdkUrl="https://connect.facebook.net/en_US/sdk.js"}get fbApiLibrary(){return this._window.FB||null}_initApi(d){console.log(`FB.init call for appId:${d}`),this.fbApiLibrary.init({appId:d,autoLogAppEvents:!0,cookie:!0,xfbml:!0,version:this._facebookSettingsService.getApiVersion()})}_getSubscribedApps(d){return new A.Observable(n=>{console.log(`FB.api call for path '/me/subscribed_apps?access_token=${d}'`),this.fbApiLibrary.api(`/me/subscribed_apps?access_token=${d}`,"GET",{},u=>{const O=u?.data?.[0]?.subscribed_fields||[];n.next(O),n.complete()})})}isFacebookSettingValid(){var d=this;return(0,s.A)(function*(){return(yield(0,A.firstValueFrom)(d._sysSettingsService.getValueByCode("IdentityServerUrl")))&&d._window.location.protocol==="https:"})()}initApi(){return this.fbApiLibrary?(0,A.of)(!0):this.loadLibrary().pipe((0,A.concatMap)(()=>this._facebookSettingsService.getApplicationId()),(0,A.concatMap)(d=>{const n=d.replace(/\D+/g,"").trim();return this._initApi(n),(0,A.of)(!0)}))}loadLibrary(){return new A.Observable(d=>{console.log("Loading FB SDK...");const n=document.createElement("script");n.src=this._sdkUrl,n.onload=()=>{console.log("FB SDK loaded"),d.next(),d.complete()},n.onerror=u=>{d.error(u)},document.body.appendChild(n)})}login(){const d={scope:this._permissions,return_scopes:!0,auth_type:"rerequest"};return new A.Observable(n=>{console.log("FB.login call"),this.fbApiLibrary.login(u=>{u.authResponse&&u.status==="connected"&&(n.next(),n.complete())},d)})}getPages(){return new A.Observable(d=>{console.log("FB.api call for path 'me/accounts'"),this.fbApiLibrary.api("me/accounts",n=>{const u=[];n.data.forEach(O=>{u.push({id:O.id,name:O.name,token:O.access_token})}),d.next(u),d.complete()})})}subscribeApps(d,n){return new A.Observable(u=>{console.log(`FB.api call for path '/me/subscribed_apps?subscribed_fields=${n}&access_token=${d}'`),this.fbApiLibrary.api(`/me/subscribed_apps?subscribed_fields=${n}&access_token=${d}`,"POST",{},O=>{u.next(!!O),u.complete()})})}attachPage(d){return this._getSubscribedApps(d).pipe((0,A.concatMap)(n=>{const u=(0,I.union)(n,this._fieldsToSubscribe.split(",")).join(",");return this.subscribeApps(d,u)}))}static{this.\u0275fac=function(n){return new(n||M)(L.\u0275\u0275inject(g.A),L.\u0275\u0275inject(C.d),L.\u0275\u0275inject("Window"))}}static{this.\u0275prov=L.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac})}}},21896:(K,T,e)=>{e.d(T,{T:()=>P});var s=e(63721),I=e.n(s),t=e(59131),A=e.n(t);class P{constructor(r){this.httpClient=r,this._serviceUrl="/rest/FacebookOmnichannelMessagingService/"}registerFacebookChannel(r,g){const C=new s.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),M=this._serviceUrl+"Register";return this.httpClient.post(M,{token:r,source:g},{headers:C})}removeFacebookChannel(r){const g=new s.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),C=this._serviceUrl+"RemoveChannel";return this.httpClient.post(C,{facebookId:r},{headers:g})}static{this.\u0275fac=function(g){return new(g||P)(t.\u0275\u0275inject(s.HttpClient))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac,providedIn:"root"})}}},56704:(K,T,e)=>{e.d(T,{I:()=>E});var s=e(63721),I=e.n(s),t=e(49973),A=e(58504),P=e(41108),L=e(56267),r=e(79772),g=e.n(r),C=e(43272),M=e(23872),B=e(62278),d=e.n(B),n=e(36486),u=e.n(n),O=e(59131),D=e.n(O),m=e(50485),h=e(65751),v=e(14876),U=e(23092);class E extends C.A{static get rowsCount(){return 30}constructor(i,a,c,f,x,j){super(a,c,f),this.rightsService=i,this.httpClient=x,this.userInfo=j,this._serviceUrl="/rest/OmnichannelChatService/",this._canManageChatsOperationCode="CanManageChats",this._cacheChatActions={},this.entitySchemaName="OmniChat"}_postWithChatId(i,a){const c=this._serviceUrl+a;return this.httpClient.post(c,{chatId:i})}_getMessages(i,a){const c=this._serviceUrl+a;return this.httpClient.post(c,{chatId:i}).pipe((0,n.map)(this._mapChatMessage()))}_getAllConversationMessages(i,a,c){const f=new s.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),x=this._serviceUrl+"GetAllConversation";return this.httpClient.post(x,{contactId:i,channelId:a,rowCount:E.rowsCount,rowOffset:c},{headers:f}).pipe((0,n.map)(this._mapChatMessage()))}_mapChatMessage(){return i=>(i.forEach(a=>{a.time=new Date(a.time),a.author=new M.B(a.author.id,a.author.name,a.author.photoId),a.macrosTemplate&&this._handleMessageMacros(a)}),i)}_handleMessageMacros(i){let a;try{a=JSON.parse(i.macrosTemplate.tokens)}catch(c){console.error("Failed to parse tokens:",c)}i.macrosTemplate.tokens=a}acceptChat(i){return this._postWithChatId(i,"AcceptChat")}getAllConversationByChat(i,a=0){const c=new s.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),f=this._serviceUrl+"GetAllConversationByChat";return this.httpClient.post(f,{chatId:i,rowCount:E.rowsCount,rowOffset:a},{headers:c}).pipe((0,n.map)(this._mapChatMessage()))}getAllConversation(i,a,c=0){return this._getAllConversationMessages(i,a,c)}getConversation(i){const a=new s.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),c=this._serviceUrl+"GetConversation";return this.httpClient.post(c,{chatId:i},{headers:a}).pipe((0,n.map)(this._mapChatMessage()))}markAsRead(i){const a=this._serviceUrl+"MarkChatAsRead";this.httpClient.post(a,{chatId:i}).subscribe()}getMessageTemplate(i){const a=this._serviceUrl+"GetUnifiedMessageTemplate";return this.httpClient.post(a,{chatId:i})}getPreviousChatId(i){const a=this._serviceUrl+"GetPreviousChatId";return this.httpClient.post(a,{chatId:i})}sendMessage(i){const a="/rest/OmnichannelOutcomeMessagingService/SendMessage",c={message:i};return this.httpClient.post(a,c)}sendMessageWithAttachments(i,a){const c="/rest/OmnichannelOutcomeMessagingService/SendMessageWithAttachments",f=new FormData;return f.append("message",JSON.stringify(i)),Array.from(a).forEach((x,j)=>{f.append("file"+j,x,x.name)}),this.httpClient.post(c,f)}completeChat(i){return this._postWithChatId(i,"CloseActiveChat")}getOperatorChats(){const i=this._serviceUrl+"GetChats";return this.httpClient.post(i,{operatorId:this.userInfo.id}).pipe((0,n.map)(a=>({success:!0,errorInfo:null,result:a.Chats.map(c=>this.entityConverter.getEntity(c))})),(0,n.catchError)(a=>this.getBaseErrorResponse(a)))}getChatHistory(i){return this._getMessages(i,"GetHistory")}getChatActions(i){if(this._cacheChatActions[i])return(0,B.of)(this._cacheChatActions[i]);const a=this._serviceUrl+"GetChatActions";return this.httpClient.post(a,{chatId:i}).pipe((0,n.tap)(c=>this._cacheChatActions[i]=c))}isOperatorCanManageChats(){return this.rightsService.getCanExecuteOperation(this._canManageChatsOperationCode).pipe((0,n.map)(i=>i))}isOperatorActive(){const i=new t.s("OperatorSession");return i.rowCount=1,i.addSchemaColumn("OperatorState.OperatorAvailable","IsActive"),i.filters.addSchemaColumnFilterWithParameter(A.H.Is_null,"SessionEndDate",null),i.filters.addSchemaColumnFilterWithParameter(A.H.Equal,"SysUser",this.userInfo.id),this.queryExecutor.executeSelectQuery(i).pipe((0,n.map)(a=>a&&a[0].IsActive||!1),(0,n.catchError)(()=>(0,B.of)(!1)))}isOperatorHasActiveChannel(){const i=new t.s("Channel");i.rowCount=1;const a=new P.X;return a.logicalOperation=L.H.Or,a.addSchemaColumnFilterWithParameter(A.H.Equal,"ChatQueue.[ChatQueueOperator:ChatQueue:Id].[SysAdminUnitInRole:SysAdminUnit:Operator].SysAdminUnit",this.userInfo.id),a.addSchemaColumnFilterWithParameter(A.H.Equal,"ChatQueue.[ChatQueueOperator:ChatQueue:Id].[SysAdminUnitInRole:SysAdminUnitRoleId:Operator].SysAdminUnit",this.userInfo.id),i.filters.add(a),i.filters.addSchemaColumnFilterWithParameter(A.H.Equal,"IsActive",!0),this.queryExecutor.executeSelectQuery(i).pipe((0,n.map)(c=>c&&c.length>0||!1),(0,n.catchError)(()=>(0,B.of)(!1)))}hasUncompletedChats(i){const a=this._serviceUrl+"GetHasUncompletedChats";return this.httpClient.post(a,{channelId:i})}static{this.\u0275fac=function(a){return new(a||E)(O.\u0275\u0275inject(m.f),O.\u0275\u0275inject(h.w),O.\u0275\u0275inject(r.TranslateService),O.\u0275\u0275inject(v.K),O.\u0275\u0275inject(s.HttpClient),O.\u0275\u0275inject(U.oq))}}static{this.\u0275prov=O.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}},44488:(K,T,e)=>{e.d(T,{A:()=>P});var s=e(63721),I=e.n(s),t=e(59131),A=e.n(t);class P{constructor(r){this.httpClient=r,this._serviceUrl="/rest/TelegramOmnichannelMessagingService/"}registerTelegramChannel(r){const g=this._serviceUrl+"RegisterChannel";return this.httpClient.post(g,{token:r})}validateRegisterChannel(r){return[{condition:!r.IsTokenValid,message:"ChatSettings.ChannelPage.Telegram.InvalidTelegramToken"},{condition:r.IsTokenExist,message:"ChatSettings.ChannelPage.Telegram.TelegramTokenAlreadyExists"},{condition:r.IsActiveWebhook,message:"ChatSettings.ChannelPage.Telegram.ActiveWebhookErrorMessageForCreating"}].find(C=>C.condition)?.message||""}getTelegramUserName(r){const g=this._serviceUrl+"GetUserName";return this.httpClient.post(g,{settingsId:r})}removeTelegramChannel(r){const g=new s.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),C=this._serviceUrl+"RemoveChannel";return this.httpClient.post(C,{telegramId:r},{headers:g})}static{this.\u0275fac=function(g){return new(g||P)(t.\u0275\u0275inject(s.HttpClient))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac,providedIn:"root"})}}},24788:(K,T,e)=>{e.d(T,{J:()=>P});var s=e(63721),I=e.n(s),t=e(59131),A=e.n(t);class P{wrapPhoneNumber(r){return`+${r}`}getRequestData(r,g,C){return{token:r,appId:g,channelPhoneNumber:this.wrapPhoneNumber(C)}}constructor(r){this.httpClient=r,this._serviceUrl="/rest/WhatsAppOmnichannelMessagingService/"}tryConnect(r,g,C){const M=this._serviceUrl+"Validate";return this.httpClient.post(M,this.getRequestData(r,g,C))}register(r,g,C){const M=this._serviceUrl+"RegisterChannel";return this.httpClient.post(M,this.getRequestData(r,g,C))}validateRegisterChannel(r){let g="";if(!r?.IsConnectionSuccess&&r?.errorInfo?.errorCode){const C=r.errorInfo.errorCode;["InvalidAppSidException","InvalidAccountPhoneNumberException","AuthenticateException"].indexOf(C)>-1?g=`ChatSettings.ChannelPage.WhatsApp.ErrorMessages.${C}`:g=r.errorInfo.message}return g}removeWhatsAppChannel(r){const g=new s.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),C=this._serviceUrl+"RemoveChannel";return this.httpClient.post(C,{whatsAppId:r},{headers:g})}static{this.\u0275fac=function(g){return new(g||P)(t.\u0275\u0275inject(s.HttpClient))}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac,providedIn:"root"})}}},82134:(K,T,e)=>{e.d(T,{p:()=>P});var s=e(86464),I=e(55363),t=e(59131),A=e.n(t);class P{_createChannel(r){const g=r.Provider,C=r.ChatQueue,M=r.Language;return{id:r.Id,name:r.Name,typeId:g.value,typeName:g.displayValue,msgSettingsId:r.MsgSettingsId,queueId:C.value,queueName:C.displayValue,source:r.Source,isActive:r.IsActive,languageId:M.value,languageName:M.displayValue}}getEntity(r){return this._createChannel(r)}getEntityColumns(r){return[new I.a("Id",r.id,s.r.Guid),new I.a("Name",r.name,s.r.Text),new I.a("Provider",r.typeId,s.r.Lookup),new I.a("MsgSettingsId",r.msgSettingsId,s.r.Guid),new I.a("ChatQueue",r.queueId,s.r.Lookup),new I.a("Source",r.source,s.r.Text),new I.a("IsActive",r.isActive,s.r.Boolean),new I.a("Language",r.languageId,s.r.Lookup)]}static{this.\u0275fac=function(g){return new(g||P)}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac})}}},30700:(K,T,e)=>{e.d(T,{Z:()=>r});var s=e(86464),I=e(55363),t=e(28399),A=e.n(t),P=e(59131),L=e.n(P);class r{_createChatQueueOperator(C){return{id:C.Id,operator:C.Operator,chatQueue:C.ChatQueue}}getValueFromLookup(C,M){return C.hasOwnProperty(M)&&!(0,t.isEmpty)(C[M])?C[M].value:void 0}getEntity(C){return this._createChatQueueOperator(C)}getEntityColumns(C){return[new I.a("Id",C.id,s.r.Guid),new I.a("Operator",this.getValueFromLookup(C,"operator"),s.r.Lookup),new I.a("ChatQueue",this.getValueFromLookup(C,"chatQueue"),s.r.Lookup)]}static{this.\u0275fac=function(M){return new(M||r)}}static{this.\u0275prov=P.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac})}}}}]);
