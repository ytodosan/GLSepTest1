(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[6592],{56592:(D,m,e)=>{e.r(m),e.d(m,{GoogleAnalyticsLoginHandler:()=>R,GoogleAnalyticsLoginRequest:()=>P,GoogleAnalyticsModule:()=>E,GoogleAnalyticsRefreshStreamHandler:()=>T,GoogleAnalyticsRefreshStreamRequest:()=>O});var i=e(5960),a=e(40297),r=e(59131),d=e(10067),j=e(83836),f=e(94933);class v extends f.I{constructor(){super(...arguments),this.requestType="crt.DialogService"}}(0,i.__decorate)([(0,j.D)({methodName:"openDialog"}),(0,i.__metadata)("design:type",Function)],v.prototype,"open",void 0);var L=e(55642),y=e(79772),x=e(59969),C=e(23092),l=e(62278),A=e(844),N=e(40968),s=e(6503),t=e(78037),c=e(76499),h=e(34845),I=e(13443);let R=class extends c.N{constructor(n,o,p,g,u,S){super(o,p,g,u,S),this.translateService=n,this.httpClient=o,this.notifyService=p,this.restErrorHandler=g,this.sessionIdentifierService=u,this.window=S}getInvalidPlatformMessage(){return this.translateService.instant("GoogleAnalytics.PlatformUndefinedMessage")}getInvalidApplicationMessage(){return this.translateService.instant("GoogleAnalytics.ApplicationUndefinedMessage")}};R=(0,i.__decorate)([(0,A.l)({type:"crt.GoogleAnalyticsLoginHandler",requestType:"crt.GoogleAnalyticsLogin"}),(0,i.__param)(5,(0,N.j)(x.ZP)),(0,i.__metadata)("design:paramtypes",[y.TranslateService,t.v,s.F,I.x,h.b,Window])],R);var G=e(73308),U=e(41287),w=e(22592);let T=class F extends U.l{constructor(n,o,p,g,u){super(),this.translateService=n,this.httpClient=o,this.notifyService=p,this.dialogService=g,this.maskService=u,this._confirmationOkButtonKey="confirm",this._isRefreshingAttributeName="IsRefreshing"}_refreshStreams(){return this.httpClient.post("/rest/GoogleAnalyticsAccountService/RefreshStreams",{},{responseType:"json"})}_showConfirmation(){var n=this;return(0,G.A)(function*(){const o=n.translateService.instant("GoogleAnalytics.RefreshStreamConfirmationTitle"),p=n.translateService.instant("GoogleAnalytics.RefreshStreamConfirmationMessage"),g=n.translateService.instant("GoogleAnalytics.RefreshStreamConfirmationCancel"),u=n.translateService.instant("GoogleAnalytics.RefreshStreamConfirmationOk");return(yield n.dialogService.open({title:o,message:p,actions:[{key:"cancel",config:{caption:g,color:"default"}},{key:n._confirmationOkButtonKey,config:{caption:u,color:"primary"}}]}))===n._confirmationOkButtonKey})()}_showSuccessMessage(){const n=this.translateService.instant("GoogleAnalytics.RefreshStreamSuccessMessage");this.notifyService.info({message:n})}_showErrorMessage(){const n=this.translateService.instant("GoogleAnalytics.RefreshStreamErrorMessage");this.notifyService.error({message:n})}handle(n){var o=this;return(0,G.A)(function*(){if(!(yield o._showConfirmation()))return;const g=n.$context;g[o._isRefreshingAttributeName]=!0,o._refreshStreams().pipe((0,l.catchError)(function(){var u=(0,G.A)(function*(S){return o._showErrorMessage(),g[o._isRefreshingAttributeName]=!1,(0,l.of)(null)});return function(S){return u.apply(this,arguments)}}())).subscribe(function(){var u=(0,G.A)(function*(S){g[o._isRefreshingAttributeName]=!1,o._showSuccessMessage()});return function(S){return u.apply(this,arguments)}}())})()}static{this.\u0275fac=function(o){return new(o||F)(r.\u0275\u0275inject(y.TranslateService),r.\u0275\u0275inject(t.v),r.\u0275\u0275inject(s.F),r.\u0275\u0275inject(v),r.\u0275\u0275inject(w.s))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac})}};T=(0,i.__decorate)([(0,A.l)({type:"crt.GoogleAnalyticsRefreshStreamHandler",requestType:"crt.GoogleAnalyticsRefreshStreamRequest"}),(0,i.__metadata)("design:paramtypes",[y.TranslateService,t.v,s.F,v,w.s])],T);var B=e(2828),W=e(93993);let P=class extends W.i{constructor(){super(...arguments),this.type="crt.GoogleAnalyticsLogin"}};P=(0,i.__decorate)([(0,B.$)({type:"crt.GoogleAnalyticsLogin",scopes:["WebAnalytics_SectionPage","LandingPages_FormPage"],propertiesPanelComponentTypeName:"crt.GoogleAnalyticsLoginPropertiesPanel",position:960,title:"GoogleAnalytics.LoginRequestTitle"})],P);function $(){const M=[P]}$();function b(M,n){return()=>(0,l.lastValueFrom)(M.loadCurrentUserInfo().pipe((0,l.tap)(o=>{n.use(o?.userInfo?.cultureInfo?.sysCultureName)})),{defaultValue:null})}let E=class K{static{this.\u0275fac=function(o){return new(o||K)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:K})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[x.rK,v,{provide:r.APP_INITIALIZER,useFactory:b,deps:[C.fv,y.TranslateService],multi:!0}],imports:[a.CommonModule,d.MatSnackBarModule,y.TranslateModule]})}};E=(0,i.__decorate)([(0,L.g)({requestHandlers:[R,T]})],E),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(E,{imports:[a.CommonModule,d.MatSnackBarModule,y.TranslateModule]})}();let O=class extends W.i{constructor(){super(...arguments),this.type="crt.GoogleAnalyticsRefreshStreamRequest"}};O=(0,i.__decorate)([(0,B.$)({type:"crt.GoogleAnalyticsRefreshStreamRequest",position:970})],O)},76499:(D,m,e)=>{e.d(m,{N:()=>A});var i=e(73308),a=e(5960),r=e(41287),d=e(40968),j=e(6503),f=e(59969),v=e(78037),L=e(13443),y=e(62278);class x{constructor(s,t,c){this.application=s,this.platform=t,this.websocketSessionId=c}}var C=e(34845),l=e(59131);let A=class H extends r.l{constructor(s,t,c,h,I){super(),this.httpClient=s,this.notifyService=t,this.restErrorHandler=c,this.sessionIdentifierService=h,this.window=I,this._snackbarDuration=3e3}_validateRequest(s){return s.platform===void 0?(this._showMessage(this.getInvalidPlatformMessage()),!1):s.app===void 0?(this._showMessage(this.getInvalidApplicationMessage()),!1):!0}_getFlowUrl(s){const t=this.sessionIdentifierService.identifier,c=new x(s.app,s.platform,t);return this.restErrorHandler.handleRequest(this.httpClient.post("/rest/SocialOAuthProxyService/AuthenticateToPlatform",c,{responseType:"json"})).pipe((0,y.map)(h=>{if(h.body!=="")return new URL(h.body)}))}_showMessage(s){var t=this;return(0,i.A)(function*(){yield t.notifyService.show({message:s,duration:t._snackbarDuration})})()}_showLoginWindow(s){const t="Login",I=window.screenLeft+(window.innerWidth-650)/2,R=window.screenTop+(window.innerHeight-650)/2,G=`width=650,height=650,left=${I},top=${R},
		  scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no`;this.window.open(s.toString(),t,G)}handle(s){var t=this;return(0,i.A)(function*(){t._context=s.$context;const c=t._context.attributes.Connect_account_button_enabled;if(c&&c===!0){t._context.attributes.Connect_account_button_enabled=!1;try{if(!t._validateRequest(s))return;t._getFlowUrl(s).subscribe(h=>{h&&t._showLoginWindow(h)})}finally{t._context.attributes.Connect_account_button_enabled=!0,yield t.next?.handle(s)}}})()}static{this.\u0275fac=function(t){return new(t||H)(l.\u0275\u0275inject(v.v),l.\u0275\u0275inject(j.F),l.\u0275\u0275inject(L.x),l.\u0275\u0275inject(C.b),l.\u0275\u0275inject(Window))}}static{this.\u0275prov=l.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac})}};A=(0,a.__decorate)([(0,a.__param)(4,(0,d.j)(f.ZP)),(0,a.__metadata)("design:paramtypes",[v.v,j.F,L.x,C.b,Window])],A)},93993:(D,m,e)=>{e.d(m,{i:()=>a});var i=e(81517);class a extends i.S{}},34845:(D,m,e)=>{e.d(m,{b:()=>d});var i=e(35293),a=e(59131),r=e.n(a);class d{constructor(){this._storageKey="uniqueIdentifier",sessionStorage.removeItem(this._storageKey)}get identifier(){let f=sessionStorage.getItem(this._storageKey);return f||(f=(0,i.A)(),sessionStorage.setItem(this._storageKey,f)),f}static{this.\u0275fac=function(v){return new(v||d)}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}}}]);
