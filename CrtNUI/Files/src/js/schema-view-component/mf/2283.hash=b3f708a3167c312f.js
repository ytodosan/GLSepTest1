(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[2283],{22283:(dt,pt,s)=>{s.r(pt),s.d(pt,{ChangeCommunicationInvalidStateHandler:()=>G,ChangeCommunicationInvalidStateRequest:()=>mt,CommunicationEnum:()=>F,CommunicationOptionTypeEnum:()=>_,CommunicationOptionValidators:()=>Y,CreateCommunicationOptionHandler:()=>H,CreateCommunicationOptionRequest:()=>at,CrtCommunicationOptionsComponent:()=>C,CrtCommunicationOptionsModule:()=>Z,MakeCommunicationOptionPrimaryHandler:()=>L,MakeCommunicationOptionPrimaryRequest:()=>st,RemoveCommunicationOptionHandler:()=>W,RemoveCommunicationOptionRequest:()=>rt,communicationOptionsToConfigArray:()=>T,findLatestValidOption:()=>it,getCommunicationTypeValue:()=>N});var l=s(5960),w=s(40297),Q=s(52989),Tt=s(55642),M=s(79772),Ct=s(5476),yt=s(28627),ht=s(50663),$t=s(48067),ft=s(66989),gt=s(78781),vt=s(94439),z=s(83515),K=s(57274),It=s(31149),_t=s(44267),J=s(78007),X=s(75034),bt=s(96176),At=s(63096),Mt=s(12841),f=s(73308),a=s(59131),I=s(77592),xt=s(66823),Dt=s(3671),wt=s(96677),Ft=s(52793),jt=s(10098),St=s(59969),Bt=s(68712),Ot=s(89285),Nt=s(73723),p=s(62278),_;(function(m){m.Email="email",m.Phone="phone",m.Web="web",m.Google="google",m.Facebook="facebook",m.LinkedIn="linkedin",m.Twitter="twitter",m.Skype="skype",m.Text="text"})(_||(_={}));var F;(function(m){m.SMS="a09511b4-13f0-e011-a86b-00155d04c01d"})(F||(F={}));var Pt=s(29957);class Y{static numberDuplicate(t,e,n,o,i){const r=function(){var c=(0,f.A)(function*(u){const d=u.value,{primaryColumnName:g,typeColumnName:y,numberColumnName:v}=n,A=(yield Promise.all(o.map(function(){var h=(0,f.A)(function*(O){return{id:yield O[g],type:yield O[y],typeName:yield O[y+"Name"],number:yield O[v]}});return function(O){return h.apply(this,arguments)}}()))).find(h=>h.id!==t&&h.number===d&&(h.type===e||h.type?.value===e));return A?{invalidValueSyntax:{message:(0,Pt.formatString)(i,A.typeName,d)}}:null});return function(d){return c.apply(this,arguments)}}();return c=>r(c)}}var Et=s(12886),kt=s(6975),Ht=s(58433),Wt=s(22817),Lt=s(19517);const Gt=["container"],Ut=()=>({columnGap:"large",rowGap:"none"}),Zt=()=>({top:"none",right:"none",bottom:"none",left:"none"}),Qt=m=>[m];function zt(m,t){if(m&1&&a.\u0275\u0275element(0,"crt-skeleton-loader",4),m&2){const e=a.\u0275\u0275nextContext();a.\u0275\u0275property("styles",e.skeletonStyles)}}function Kt(m,t){if(m&1&&(a.\u0275\u0275elementStart(0,"div",11),a.\u0275\u0275elementContainer(1,12),a.\u0275\u0275elementEnd()),m&2){const e=t.$implicit,n=a.\u0275\u0275nextContext(4);a.\u0275\u0275advance(),a.\u0275\u0275property("crtViewModel",e)("viewConfig",a.\u0275\u0275pureFunction1(2,Qt,n.getTemplate(e)))}}function Jt(m,t){if(m&1&&(a.\u0275\u0275elementStart(0,"div",8)(1,"crt-grid",9),a.\u0275\u0275template(2,Kt,2,4,"div",10),a.\u0275\u0275elementEnd()()),m&2){const e=a.\u0275\u0275nextContext(3);a.\u0275\u0275advance(),a.\u0275\u0275property("columns",e.columns)("gap",a.\u0275\u0275pureFunction0(6,Ut))("padding",a.\u0275\u0275pureFunction0(7,Zt))("borderRadius",e.none)("color",e.transparent),a.\u0275\u0275advance(),a.\u0275\u0275property("ngForOf",e.dataItems)}}function Xt(m,t){if(m&1&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275template(1,Jt,3,8,"div",7),a.\u0275\u0275elementContainerEnd()),m&2){const e=a.\u0275\u0275nextContext(2);a.\u0275\u0275advance(),a.\u0275\u0275property("ngIf",e.dataItems.length>0)}}function Yt(m,t){m&1&&(a.\u0275\u0275elementContainerStart(0,14),a.\u0275\u0275element(1,"crt-placeholder",15),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275elementContainerEnd()),m&2&&(a.\u0275\u0275advance(),a.\u0275\u0275propertyInterpolate("subhead",a.\u0275\u0275pipeBind1(2,1,"CommunicationOptions.NoDataPlaceholderText")))}function qt(m,t){if(m&1&&a.\u0275\u0275template(0,Yt,3,3,"ng-container",13),m&2){const e=a.\u0275\u0275nextContext(2);a.\u0275\u0275property("ngIf",e.showNoDataPlaceholder)}}function te(m,t){if(m&1&&(a.\u0275\u0275elementStart(0,"div",5,1),a.\u0275\u0275template(2,Xt,2,1,"ng-container",6)(3,qt,1,1,"ng-template",null,2,a.\u0275\u0275templateRefExtractor),a.\u0275\u0275elementEnd()),m&2){const e=a.\u0275\u0275reference(4),n=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",n.masterRecordColumnValue&&n.dataItems&&n.dataItems.length>0)("ngIfElse",e)}}let C=class lt extends Bt.K{constructor(t){super(t),this.injector=t,this._defaultGridColumn="minmax(64px, 1fr)",this._columnsCount=2,this._templates={},this._subscriptions=new p.Subscription,this._columns=[this._defaultGridColumn],this.translatePrefix="CommunicationOptions",this.skeletonStyles={height:"52px",width:"100%"},this.width=Number.MAX_VALUE,this.placeholderImage={type:"icon",icon:"communication-options",width:null,height:null,padding:null},this.labelPosition="auto",this.showNoDataPlaceholder=!0,this.window=this.injector.get(St.ZP),this.translateService=this.injector.get(M.TranslateService)}set templates(t){this._templates=t}get templates(){return this._templates}set masterRecordColumnValue(t){this._masterRecordColumnValue=t}get masterRecordColumnValue(){return this._masterRecordColumnValue}set columnsCount(t){this._columnsCount=t||1,this._columns=new Array(this.columnsCount).fill(this._defaultGridColumn)}get columnsCount(){return this._columnsCount}set items(t){this._subscriptions.unsubscribe(),this._subscriptions=new p.Subscription,this._subscriptions.add(t?.changed?.subscribe(()=>{this._items=t,this.changeDetectorRef.markForCheck()})),this._items=t,this.setCollectionValidator(t)}get columns(){return this._columns}get dataItems(){return this._items}_translate(t){return this.translateService.instant(`${this.translatePrefix}.${t}`)}setCollectionValidator(t){var e=this;return(0,f.A)(function*(){if(!t)return;const n=yield Promise.all(t.map(function(){var o=(0,f.A)(function*(i){return{id:yield i[e.primaryColumnName],type:yield i[e.typeColumnName],control:i.getControl(e.numberColumnName)}});return function(i){return o.apply(this,arguments)}}()));for(const o of n){const i=typeof o.type=="string"?o.type:o.type.value,r={primaryColumnName:e.primaryColumnName,typeColumnName:e.typeColumnName,numberColumnName:e.numberColumnName};o.control.formControl.setAsyncValidators([Y.numberDuplicate(o.id,i,r,t,e._translate("Validations.DuplicateNumberMessage"))])}})()}getTemplate(t){const e=t.attributes[this.displayFormatColumnName],n=this.templates[_.Text],o=this.templates[e]||n;return o.autofocus=t.PrimaryModelMode===Ot.b.Create,o}static{this.\u0275fac=function(e){return new(e||lt)(a.\u0275\u0275directiveInject(a.Injector))}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:lt,selectors:[["crt-communication-options"]],viewQuery:function(e,n){if(e&1&&a.\u0275\u0275viewQuery(Gt,5),e&2){let o;a.\u0275\u0275queryRefresh(o=a.\u0275\u0275loadQuery())&&(n.container=o.first)}},inputs:{templates:"templates",readonly:"readonly",masterRecordColumnValue:"masterRecordColumnValue",masterRecordColumnName:"masterRecordColumnName",columnsCount:"columnsCount",optionActions:"optionActions",items:"items",typeColumnName:"typeColumnName",displayFormatColumnName:"displayFormatColumnName",primaryColumnName:"primaryColumnName",numberColumnName:"numberColumnName",defaultOptionConfig:"defaultOptionConfig",labelPosition:"labelPosition",showNoDataPlaceholder:"showNoDataPlaceholder"},features:[a.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[["comm_options_template",""],["container",""],["no_data_placeholder",""],[3,"styles",4,"ngIf","ngIfElse"],[3,"styles"],[1,"crt-communication-options"],[4,"ngIf","ngIfElse"],["class","option-list",4,"ngIf"],[1,"option-list"],[3,"columns","gap","padding","borderRadius","color"],["class","option-wrap",4,"ngFor","ngForOf"],[1,"option-wrap"],["crtViewGenerator","",3,"crtViewModel","viewConfig"],["class","no-data-placeholder-wrap",4,"ngIf"],[1,"no-data-placeholder-wrap"],["skeleton","","image","","title","",3,"subhead"]],template:function(e,n){if(e&1&&a.\u0275\u0275template(0,zt,1,1,"crt-skeleton-loader",3)(1,te,5,2,"ng-template",null,0,a.\u0275\u0275templateRefExtractor),e&2){const o=a.\u0275\u0275reference(2);a.\u0275\u0275property("ngIf",n.masterRecordColumnValue&&n.loading)("ngIfElse",o)}},dependencies:[Et.N,w.NgForOf,w.NgIf,kt.aD,Ht.W,Wt.Q,Lt.k,M.TranslatePipe],styles:[".crt-communication-options[_ngcontent-%COMP%] > .option-list[_ngcontent-%COMP%]{width:100%}.crt-communication-options[_ngcontent-%COMP%] > .no-data-placeholder-wrap[_ngcontent-%COMP%]{min-height:52px;padding:22px 0}"],changeDetection:0})}};(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Object),(0,l.__metadata)("design:paramtypes",[Object])],C.prototype,"templates",null),(0,l.__decorate)([(0,I.k)({propertyBindable:!0,defaultValue:!1,propertyName:xt.R.Readonly}),(0,l.__metadata)("design:type",Boolean)],C.prototype,"readonly",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String),(0,l.__metadata)("design:paramtypes",[String])],C.prototype,"masterRecordColumnValue",null),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],C.prototype,"masterRecordColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Number),(0,l.__metadata)("design:paramtypes",[Number])],C.prototype,"columnsCount",null),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Array)],C.prototype,"optionActions",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Nt.A),(0,l.__metadata)("design:paramtypes",[Nt.A])],C.prototype,"items",null),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],C.prototype,"typeColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],C.prototype,"displayFormatColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],C.prototype,"primaryColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],C.prototype,"numberColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Object)],C.prototype,"defaultOptionConfig",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Object)],C.prototype,"labelPosition",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Object)],C.prototype,"showNoDataPlaceholder",void 0),C=(0,l.__decorate)([(0,Dt.v)({type:"crt.CommunicationOptions",contentSlots:["templates"],reuseStrategy:wt.B.Reuse}),(0,Ft.f)({designViewItemCommands:{copy:"crt.CopyDataGridItemCommand",delete:"crt.RemoveCollectionViewItemCommand"},propertiesPanelComponentTypeName:"crt.CommunicationOptionsPropertiesPanel",typeCaption:"Components.CommunicationOptions.Caption",viewElementGroupType:jt.J.Components}),(0,l.__metadata)("design:paramtypes",[a.Injector])],C);var q=s(4164),ee=s(50485);let tt=class{constructor(t,e){this._rightsService=t,this._translateService=e,this._translatePrefix="CommunicationOptions"}_translate(t){return this._translateService.instant(`${this._translatePrefix}.${t}`)}_getValidationResult(t,e=""){return{success:t,errorMessage:e}}convert(t){var e=this;return(0,f.A)(function*(){const n=e._getValidationResult(!0);if(!t.masterRecordColumnName||!t.masterRecordColumnValue)return e._getValidationResult(!1,e._translate("Validations.IncorrectSetupComponentMessage"));if(t.readonly)return e._getValidationResult(!1,e._translate("Validations.ReadOnlyStateMessage"));const o={isNew:!0,schemaName:t.entitySchemaName},i=yield(0,p.lastValueFrom)(e._rightsService.getCanEdit(o));return i&&!i.result?e._getValidationResult(!1,i.message):n})()}};tt=(0,l.__decorate)([(0,q.a)({type:"crt.CommunicationOptionsValidation"}),(0,l.__metadata)("design:paramtypes",[ee.f,M.TranslateService])],tt);var ne=s(71252),oe=s(41314);let et=class{constructor(t,e){this._domSanitizer=t,this._matIconRegistry=e}_getMenuItem(t,e){return{type:"crt.MenuItem",caption:e,items:[],...t&&{icon:`${t}`}}}_getMenuItemClickRequest(t,e,n,o,i,r){return{request:"crt.CreateCommunicationOptionRequest",params:{componentName:t,indexToInsert:"@event.index",masterRecordColumnName:i,values:{CommunicationType:e,[i]:o,CommunicationTypeName:r,CommunicationTypeDisplayFormat:n}},useRelativeContext:!0}}_getSubMenuItem(t,e,n,o,i,r,c){return{type:"crt.MenuItem",caption:t,clicked:this._getMenuItemClickRequest(e,n,o,i,r,t),...c&&{icon:`${c}`}}}_getSubMenuItemFromType(t,e,n,o){const i=this._getSubMenuItem(t.displayValue,e,t.value,t.displayFormat,n,o,t.typeIcon?.value);return this._registerIcon(t?.typeIcon?.value),this._registerIcon(t?.groupIcon?.value),i}_registerIcon(t){if(!t)return;const e=this._domSanitizer.bypassSecurityTrustResourceUrl(window.location.origin+(0,oe.Mc)(t));this._matIconRegistry.addSvgIcon(t,e)}convert(t,e,n=[]){const[o,i]=t,r=[...new Set(o.map(u=>u.typeOrGroupId))],c=[];for(const u of r){const d=o.filter(v=>v.typeOrGroupId===u),g=d[0],y=g?.groupIcon?.value;if(d.length>1){const v=this._getMenuItem(y,g.groupName);v.items=d.map(b=>this._getSubMenuItemFromType(b,i.componentName,i.masterRecordColumnValue,i.masterRecordColumnName)),c.push(v)}else{const v=this._getSubMenuItemFromType(g,i.componentName,i.masterRecordColumnValue,i.masterRecordColumnName);c.push(v)}}return[...c,...n]}};et=(0,l.__decorate)([(0,q.a)({type:"crt.CommunicationMenuItems"}),(0,l.__metadata)("design:paramtypes",[ne.DomSanitizer,Q.MatIconRegistry])],et);var ie=s(49973),Rt=s(92831),nt=s(58504),ae=s(65751),re=s(41483),se=s(64748);const me="communication-options";let ot=class{constructor(t,e){this._queryExecutor=t,this._cacheManager=e}_getCache(){var t=this;return(0,f.A)(function*(){return yield t._cacheManager.getOrCreate({name:me,type:re.P.Memory})})()}_createQuery(t){const e=new ie.s("CommunicationType");return e.addMacrosFunctionColumn(Rt.V.PrimaryColumn,"typeId"),e.addMacrosFunctionColumn(Rt.V.PrimaryDisplayColumn,"typeName"),e.addSchemaColumn("ImageLink","typeIcon"),e.addSchemaColumn("DisplayFormat","displayFormat"),e.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Id","groupId"),e.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Name","groupName"),e.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.ImageLink","groupIcon"),e.filters.addSchemaColumnFilterWithParameter(nt.H.Not_equal,"[ComTypebyCommunication:CommunicationType:Id].Communication",F.SMS),t==="ContactCommunication"?e.filters.addSchemaColumnFilterWithParameter(nt.H.Equal,"UseforContacts",!0):t==="AccountCommunication"&&e.filters.addSchemaColumnFilterWithParameter(nt.H.Equal,"UseforAccounts",!0),e}convert(t){var e=this;return(0,f.A)(function*(){const n=yield e._getCache();if(yield n.has(t))return n.get(t);const o=e._createQuery(t);try{const r=(yield(0,p.firstValueFrom)(e._queryExecutor.executeSelectQuery(o).pipe((0,p.catchError)(()=>(0,p.of)([]))))).map(c=>({typeOrGroupId:c.groupId||c.typeId,value:c.typeId,displayValue:c.typeName,groupName:c.groupName,typeIcon:c.typeIcon,groupIcon:c.groupIcon,displayFormat:c.displayFormat}));return yield n.set(t,r),r}catch{return[]}})()}};ot=(0,l.__decorate)([(0,q.a)({type:"crt.CommunicationTypeProvider"}),(0,l.__metadata)("design:paramtypes",[ae.w,se.G])],ot);var j=s(81517),B=s(2828),E=s(844),ce=s(6503),le=s(52439),ue=s(92009);function it(m,t){const e=N(t),n=m.filter(o=>o.id!==t.id&&!o.isInvalid&&N(o)===e);return n.length>0?n.reduce((o,i)=>o.createdOn>i.createdOn?o:i):null}function N(m){return typeof m.communicationType=="string"?m.communicationType:m.communicationType?.value}function T(m,t){return Promise.all(m.map(function(){var e=(0,f.A)(function*(n){return{id:yield n[`${t}_Id`],createdOn:yield n[`${t}_CreatedOn`],communicationType:yield n[`${t}_CommunicationType`],isPrimary:yield n[`${t}_Primary`],isInvalid:yield n[`${t}_NonActual`],number:yield n[`${t}_Number`]}});return function(n){return e.apply(this,arguments)}}()))}var de=s(41287);class k extends de.l{constructor(t){super(),this.injector=t,this.translatePrefix="CommunicationOptions",this._announcementKey="Announcement.Option",this.injectDependencies()}injectDependencies(){this.translateService=this.injector.get(M.TranslateService),this.liveAnnouncementService=this.injector.get(St.DW)}translate(t){return this.translateService.instant(`${this.translatePrefix}.${t}`)}announceChanges(t,e,n=""){var o=this;return(0,f.A)(function*(){const i=Pt.String.format(o.translate(`${o._announcementKey}.${t}`),e||"",n);yield o.liveAnnouncementService.announce(i)})()}}let at=class extends j.S{};at=(0,l.__decorate)([(0,B.$)({type:"crt.CreateCommunicationOptionRequest"})],at);let H=class extends k{constructor(t,e,n){super(t),this.injector=t,this._schemaService=e,this._notifyService=n}_setDuplicateValidator(t,e,n,o){var i=this;return(0,f.A)(function*(){const r=`${n}_Id`,c=`${n}_Number`,u=`${n}_CommunicationType`,d=yield t[r],g=t.getControl(c),y={primaryColumnName:r,typeColumnName:u,numberColumnName:c};g.formControl.setAsyncValidators([Y.numberDuplicate(d,o,y,e,i.translate("Validations.DuplicateNumberMessage"))])})()}_getComponentViewConfig(t){return this._schemaService.getViewConfigInfoByProperty("type","crt.CommunicationOptions")?.map(e=>e?.viewConfig)?.find(e=>e?.name===t)??null}_getDefaultItemValues(t,e){return(0,f.A)(function*(){const o=t.getModelByName(e)?.getDataSource()?.getDefaultValues();if(!o)return{};const i=(yield(0,p.firstValueFrom)(o))||{},r={};return Object.entries(i).forEach(([c,u])=>{const d=e+"_"+c;r[d]=u}),r})()}_createNewItem(t,e,n,o){var i=this;return(0,f.A)(function*(){if(!(0,le.qG)(t.items))return null;const r=t.items.slice(1),c=n.getBoundDataSourceNameByAttributePath(r),u=yield n[r];if(!u)return null;const d=o.CommunicationType.toLowerCase(),g=o.CommunicationTypeName;(yield T(u,c)).findIndex(O=>O.isPrimary===!0&&N(O)===d)===-1&&(o.Primary=!0);const b=yield i._getDefaultItemValues(n,c),A=u.createItem({index:e,initialModelValues:{...b,...o}}),h=yield A;return h&&i._setDuplicateValidator(h,u,c,d),i.announceChanges("Added",g),A})()}checkRequestParams(t){const{masterRecordColumnName:e,values:n}=t;let o=!0;return n[e]||(this._notifyService.show({message:this.translate("Validations.EmptyMasterRecordColumnNameInRequestMessage"),duration:1e4}),o=!1),o}handle(t){var e=this;return(0,f.A)(function*(){const{$context:n,componentName:o,indexToInsert:i,values:r}=t;if(!e.checkRequestParams(t))return null;const c=e._getComponentViewConfig(o);if(!c)return null;const u=yield e._createNewItem(c,i,n,r||{});return u?.formApiModel?.markAsDirty(),u})()}};H=(0,l.__decorate)([(0,E.l)({type:"crt.CreateCommunicationOptionHandler",requestType:"crt.CreateCommunicationOptionRequest"}),(0,l.__metadata)("design:paramtypes",[a.Injector,ue.R,ce.F])],H);let rt=class extends j.S{};rt=(0,l.__decorate)([(0,B.$)({type:"crt.RemoveCommunicationOptionRequest"})],rt);let W=class extends k{constructor(t){super(t),this.injector=t}handle(t){var e=this;return(0,f.A)(function*(){const n=t.collectionAttributeName,o=t.$context.getBoundDataSourceNameByAttributePath(n),i=yield t.$context[n],r=yield T(i,o),c=r.findIndex(y=>y.id===t.recordId);if(c===-1)return(0,p.lastValueFrom)((0,p.of)(null));const u=r[c];if(u.isPrimary){const y=it(r,u);if(y){const v=r.findIndex(h=>h.id===y.id),b=yield i[v],A=`${o}_Primary`;b[A]=!0}}(yield i[c]).markPrimaryModelFor(Ot.b.Delete);const g=u.communicationType.displayValue;return yield e.announceChanges("Deleted",g,u.number),(0,p.lastValueFrom)((0,p.of)(null))})()}};W=(0,l.__decorate)([(0,E.l)({type:"crt.RemoveCommunicationOptionHandler",requestType:"crt.RemoveCommunicationOptionRequest"}),(0,l.__metadata)("design:paramtypes",[a.Injector])],W);let st=class extends j.S{};st=(0,l.__decorate)([(0,B.$)({type:"crt.MakeCommunicationOptionPrimaryRequest"})],st);let L=class extends k{constructor(t){super(t),this.injector=t}handle(t){var e=this;return(0,f.A)(function*(){const n=t.collectionAttributeName,o=t.$context.getBoundDataSourceNameByAttributePath(n),i=yield t.$context[n],r=yield T(i,o),c=r.findIndex(h=>h.id===t.recordId),u=r[c],d=N(u),g=r.findIndex(h=>h.isPrimary===!0&&h.id!==t.recordId&&N(h)===d),y=`${o}_Primary`,v=g!==-1?yield i[g]:null;v&&(v[y]=!1);const b=yield i[c];b[y]=!0;const A=u.communicationType.displayValue;return yield e.announceChanges("SetAsPrimary",A,u.number),(0,p.lastValueFrom)((0,p.of)(null))})()}};L=(0,l.__decorate)([(0,E.l)({type:"crt.MakeCommunicationOptionPrimaryHandler",requestType:"crt.MakeCommunicationOptionPrimaryRequest"}),(0,l.__metadata)("design:paramtypes",[a.Injector])],L);let mt=class extends j.S{};mt=(0,l.__decorate)([(0,B.$)({type:"crt.ChangeCommunicationInvalidStateRequest"})],mt);let G=class extends k{constructor(t){super(t),this.injector=t}handle(t){var e=this;return(0,f.A)(function*(){const n=t.collectionAttributeName,o=t.$context.getBoundDataSourceNameByAttributePath(n),i=yield t.$context[n],r=yield T(i,o),c=r.findIndex(b=>b.id===t.recordId);if(c===-1)return(0,p.lastValueFrom)((0,p.of)(null));const u=yield i[c],d=r[c];if(d.isPrimary&&!d.isInvalid){const b=`${o}_Primary`;u[b]=!1;const A=it(r,d);if(A){const h=r.findIndex(ge=>ge.id===A.id),O=yield i[h];O[b]=!0}}const g=`${o}_NonActual`,y=!d.isInvalid;u[g]=y;const v=d.communicationType.displayValue;return e.announceChanges(y?"MarkedAsInvalid":"MarkedAsValid",v,d.number),(0,p.lastValueFrom)((0,p.of)(null))})()}};G=(0,l.__decorate)([(0,E.l)({type:"crt.ChangeCommunicationInvalidStateHandler",requestType:"crt.ChangeCommunicationInvalidStateRequest"}),(0,l.__metadata)("design:paramtypes",[a.Injector])],G);var ct=s(74368),pe=s(55041),Vt=s(38071);class ${constructor(t){this._featureService=t,this._metadataSchemaUtils=(0,a.inject)(ct.u),this._commonCommunicationsBehaviorFeature="CommonCommunicationsBehavior",this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this._replacementConfig={ContactCommunicationOptions:{replaceData:[{type:"crt.EmailInput",label:"Email",labelPosition:"above",control:"$Email",visible:!0,placeholder:"",tooltip:"",name:"Email"},{type:"crt.PhoneInput",label:"Mobile phone",labelPosition:"above",control:"$MobilePhone",visible:!0,placeholder:"",tooltip:"",name:"MobilePhone"}],additionalAttributesConfig:{MobilePhone:{modelConfig:{path:"PDS.MobilePhone"}},Email:{modelConfig:{path:"PDS.Email"}}}},AccountCommunicationOptions:{replaceData:[{type:"crt.WebInput",label:"Web",labelPosition:"above",control:"$Web",visible:!0,placeholder:"",tooltip:"",name:"Web"},{type:"crt.PhoneInput",label:"Primary phone",labelPosition:"above",control:"$Phone",visible:!0,placeholder:"",tooltip:"",name:"Phone"}],additionalAttributesConfig:{Phone:{modelConfig:{path:"PDS.Phone"}},Web:{modelConfig:{path:"PDS.Web"}}}}},this._namesToDelete=[...Object.keys(this._replacementConfig),"ContactCommunicationOptionsAddButton","AccountCommunicationOptionsAddButton"]}get isCommonCommunicationsBehaviorEnabled(){return(0,p.lastValueFrom)(this._featureService.getFeatureState(this._commonCommunicationsBehaviorFeature))}get isProcessingDisabled(){return(0,p.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_prepareAttibutesBeforeReplacement(t,e){const n=t?.additionalAttributesConfig||{};for(const[o,i]of Object.entries(n)){const r=(0,pe.v)(e,i.modelConfig?.path);r&&r!==o&&(n[r]=e[r],delete n[o],t.replaceData=[...t.replaceData].map(c=>c.control===`$${o}`?{...c,control:`$${r}`}:c))}Object.assign(e,n)}_replaceCommOptionsWithFields(t){t.viewModelConfig={attributes:{},...t.viewModelConfig},this._metadataSchemaUtils.getViewConfigInfoByPropertyForValues("name",this._namesToDelete,t.viewConfig).forEach(n=>{const i=this._metadataSchemaUtils.getViewConfigInfoByProperty("name",n.parentName,t.viewConfig)[0].viewConfig,r=n.viewConfig.name,c=i[n.parentPropertyName],u=c.indexOf(n.viewConfig);this._prepareAttibutesBeforeReplacement(this._replacementConfig[n.viewConfig.name],t.viewModelConfig.attributes);const d=this._replacementConfig[r]?.replaceData||[];c.splice(u,1,...d)})}_makeOtherCommOptionsComponentsReadonly(t){t.filter(n=>!this._namesToDelete.includes(n.viewConfig.name)).forEach(n=>n.viewConfig.readonly=!0)}crtOnMetaDataInit(t){var e=this;return(0,f.A)(function*(){if((yield e.isProcessingDisabled)||(yield e.isCommonCommunicationsBehaviorEnabled))return t;const n=t,o=e._metadataSchemaUtils.getViewConfigInfoByProperty("type","crt.CommunicationOptions",n.viewConfig);return e._replaceCommOptionsWithFields(n),e._makeOtherCommOptionsComponentsReadonly(o),t})()}static{this.\u0275fac=function(e){return new(e||$)(a.\u0275\u0275inject(Vt.wf))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac})}}var Ce=s(55932),ye=s(26746);class U{constructor(t){this.translateService=t,this.translatePrefix="CommunicationOptions"}translate(t){return this.translateService.instant(`${this.translatePrefix}.${t}`)}}var S;(function(m){m.ValidationStateSuffix="_ValidationState",m.ValidationStateRawDataSuffix="_ValidationStateRawData",m.MenuItemsSuffix="_MenuItems",m.MenuItemsRawDataSuffix="_MenuItemsRawData",m.MenuItemsInitialItemsSuffix="_MenuItemsInitialItems",m.MenuItemsInvalidSuffix="_MenuItemsInvalidSuffix",m.CommTypesSuffix="_CommTypes",m.CommTypesRawDataSuffix="_CommTypesRawData"})(S||(S={}));class P extends U{constructor(t){super(t),this.translateService=t,this._metadataSchemaUtils=(0,a.inject)(ct.u),this._addCommunicationOptionsRequestName="crt.AddCommunicationOptionsRequest"}_createCommunicationTypesAttribute(t,e,n){const o=`${t}${S.CommTypesRawDataSuffix}`;n.viewModelConfig.attributes[o]={value:e};const i=`${t}${S.CommTypesSuffix}`;return n.viewModelConfig.attributes[i]={from:o,converter:"crt.CommunicationTypeProvider"},i}_createMenuItemsRawDataAttribute(t,e,n,o){const i=`${t}${S.MenuItemsRawDataSuffix}`;return o.viewModelConfig.attributes[i]={value:{componentName:t,masterRecordColumnValue:e,masterRecordColumnName:n}},i}_createValidationStateAttribute(t,e,n,o){const i=`${n}${S.ValidationStateRawDataSuffix}`;o.viewModelConfig.attributes[i]={value:{masterRecordColumnValue:t.masterRecordColumnValue,masterRecordColumnName:t.masterRecordColumnName,entitySchemaName:e,readonly:t.readonly}};const r=`${n}${S.ValidationStateSuffix}`;return o.viewModelConfig.attributes[r]={from:i,converter:"crt.CommunicationOptionsValidation"},r}_createMenuItemsAttribute(t,e,n,o){const i=`${n.name}${S.MenuItemsInitialItemsSuffix}`;o.viewModelConfig.attributes[i]={value:n.menuItems||[]};const r=`${n.name}${S.MenuItemsSuffix}`;return o.viewModelConfig.attributes[r]={from:[t,e],converter:`crt.CommunicationMenuItems:$${i}`},r}_createMenuItemsInvalidAttribute(t,e){const n=`${t}${S.MenuItemsInvalidSuffix}`;return e.viewModelConfig.attributes[n]={value:[]},n}_applyAddButtonState(t,e,n,o,i){const r=this._createValidationStateAttribute(e,o,e.name,i),c=this._createMenuItemsInvalidAttribute(e.name,i),u=this._createMenuItemsRawDataAttribute(e.name,e.masterRecordColumnValue,e.masterRecordColumnName,i);t.forEach(d=>{const g=this._createMenuItemsAttribute(n,u,d,i);d.clicked={request:"crt.NotificationRequest",params:{message:`$${r} | crt.ToObjectProp:'errorMessage'`,duration:1e4}};const y=`crt.ToObjectProp:'success' | crt.IfElse:$${g}:$${c}`,v="crt.ToObjectProp:'success' | crt.IfElse:'menu':'default'";d.clickMode=`$${r} | ${v}`,d.menuItems=`$${r} | ${y}`})}_getAddCommOptionsButtonsConfigs(t){return this._metadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],t.viewConfig).filter(e=>e.viewConfig.clicked?.request===this._addCommunicationOptionsRequestName).map(e=>e.viewConfig)}processAddButton(t,e,n){const o=this._getAddCommOptionsButtonsConfigs(e),r=e?.modelConfig?.dataSources?.[n]?.config?.entitySchemaName||"",c=this._createCommunicationTypesAttribute(t.name,r,e),u=o.filter(d=>t.name===d.clicked?.params?.viewElementName);this._applyAddButtonState(u,t,c,r,e)}static{this.\u0275fac=function(e){return new(e||P)(a.\u0275\u0275inject(M.TranslateService))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac})}}var he=s(96252);class R extends U{constructor(t){super(t),this.translateService=t}_getActionClickedRequest(t,e,n){return{request:t,params:{recordId:`$${e}.${n}_Id`,collectionAttributeName:e}}}_getDefaultOptionActions(t,e){const n=`${t}.${e}_Primary`,o=`${t}.${e}_NonActual`,i=this.translate("MarkAsPrimary"),r=this.translate("MarkAsValid"),c=this.translate("MarkAsInvalid"),u=this.translate("DeleteOption");return[{type:"crt.MenuItem",caption:i,icon:"flag-button-icon",visible:`$${n} | crt.NorCondition : $${o}`,clicked:this._getActionClickedRequest("crt.MakeCommunicationOptionPrimaryRequest",t,e)},{type:"crt.MenuItem",caption:`$${o}
					| crt.BooleanToStringValue : '${r}' : '${c}'`,icon:`$${o}
					| crt.BooleanToStringValue : 'valid-circle' : 'invalid-circle'`,clicked:this._getActionClickedRequest("crt.ChangeCommunicationInvalidStateRequest",t,e)},{type:"crt.MenuItem",caption:u,icon:"delete-button-icon",clicked:this._getActionClickedRequest("crt.RemoveCommunicationOptionRequest",t,e)}]}_getOptionActions(t,e,n){const o=this._getDefaultOptionActions(e,n),i=t.optionActions??[];return[...o,...i]}_extendViewConfig(t,e,n){t.primaryColumnName=`${n}_Id`,t.numberColumnName=`${n}_Number`,t.typeColumnName=`${n}_CommunicationType`,t.displayFormatColumnName=`${n}_CommunicationTypeDisplayFormat`,t.optionActions=this._getOptionActions(t,e,n)}_getDefaultOptionConfig(t,e,n){return{label:`$${`${`${t}.${e}_CommunicationTypeName`}_Extended`}`,control:`$${t}.${e}_Number`,labelPosition:n}}_applyReadonlyState(t,e){Object.entries(t).forEach(([,n])=>{e.readonly&&(n.readonly=e.readonly),n.bindTo=`$${(0,he.W)(e.name)}`})}_getToolsTemplate(t){return[{type:"crt.Button",ariaLabel:this.translate("ToolsAriaLabel"),icon:"actions-button-icon",iconPosition:"only-icon",color:"default",size:"none",clickMode:"menu",displayType:"text",classes:["actions-btn"],menuItems:t.optionActions}]}_extendWithProperties(t,e){Object.keys(t).forEach(n=>{t[n]={...e,...t[n]}})}_initTemplates(t,e,n){const o=this._getDefaultOptionConfig(e,n,t.labelPosition??"auto"),i=t.templates??{},r=this._getToolsTemplate(t),c={[_.Email]:{type:"crt.EmailInput"},[_.Phone]:{type:"crt.PhoneInput",phoneAsLink:!0,displayAsPhone:!1,displayPhoneMask:!1},[_.Web]:{type:"crt.WebInput"},[_.Google]:{type:"crt.WebInput",icon:"google-web-icon"},[_.Facebook]:{type:"crt.WebInput",icon:"facebook-web-icon"},[_.LinkedIn]:{type:"crt.WebInput",icon:"linkedin-web-icon"},[_.Twitter]:{type:"crt.WebInput",icon:"twitter-web-icon"},[_.Skype]:{type:"crt.WebInput",icon:"skype-web-icon"},[_.Text]:{type:"crt.Input"}};this._extendWithProperties(c,{tools:r});const u={...c,...i};this._extendWithProperties(u,o),this._applyReadonlyState(u,t),t.templates=u}processViewConfig(t,e,n){this._extendViewConfig(t,e,n),this._initTemplates(t,e,n)}static{this.\u0275fac=function(e){return new(e||R)(a.\u0275\u0275inject(M.TranslateService))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac})}}var fe=s(65967);class V extends U{constructor(t){super(t),this.translateService=t}_setSortingConfig(t,e){const n=t.items.slice(1),o=`${n}_Sorting`,i=e.viewModelConfig.attributes;i[o]={isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}};const r=i[n];r.modelConfig={...r.modelConfig,sortingConfig:{...r.modelConfig?.sortingConfig,attributeName:o,default:[{columnName:"CreatedOn",direction:"asc"}]}}}_initTypeNameAttribute(t,e){const n=`${e}_CommunicationTypeName`,o=`${e}_Primary`,i=`${e}_NonActual`,r=" \u2022 "+this.translate("Primary"),c=" \u2022 "+this.translate("Invalid"),u=`${n}_Extended`,d=t?.viewModelConfig.attributes??{};d[u]={from:[n,o,i],converter:`crt.AppendConditionalParts : '${r}' : '${c}'`}}_prepareAttributes(t,e,n,o){(0,fe.o)(n)&&!n.modelConfig?.sortingConfig?.attributeName&&this._setSortingConfig(t,e),this._initTypeNameAttribute(n,o)}processAttributes(t,e,n,o){this._prepareAttributes(t,e,n,o)}static{this.\u0275fac=function(e){return new(e||V)(a.\u0275\u0275inject(M.TranslateService))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}class x extends U{constructor(t,e,n,o,i){super(e),this._featureService=t,this.translateService=e,this._addButtonService=n,this._viewConfigService=o,this._attributesService=i,this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this._metadataSchemaUtils=(0,a.inject)(ct.u),this.translatePrefix="CommunicationOptions"}get isProcessingDisabled(){return(0,p.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_isValidItemsBinding(t,e){return(0,Ce.j)(t.items,e.viewModelConfig?.attributes)?!0:(console.warn(`The setup property [items] for component [${t.name}] is incorrect.Only binding to the ViewModel collection attribute is allowed for this property.`),!1)}processItem(t,e){if(this._isValidItemsBinding(t,e)){const n=t.items.split("$")[1],o=e.viewModelConfig?.attributes?.[n]??{},i=o?.modelConfig?.path||"";this._viewConfigService.processViewConfig(t,n,i),this._attributesService.processAttributes(t,e,o,i),ye.F.addDependencies(e,t,i),this._addButtonService.processAddButton(t,e,i)}}processItems(t,e){t.forEach(n=>{this.processItem(n.viewConfig,e)})}crtOnMetaDataInit(t){var e=this;return(0,f.A)(function*(){if(yield e.isProcessingDisabled)return t;const n=t,o=e._metadataSchemaUtils.getViewConfigInfoByProperty("type","crt.CommunicationOptions",n.viewConfig);return e.processItems(o,n),t})()}static{this.\u0275fac=function(e){return new(e||x)(a.\u0275\u0275inject(Vt.wf),a.\u0275\u0275inject(M.TranslateService),a.\u0275\u0275inject(P),a.\u0275\u0275inject(R),a.\u0275\u0275inject(V))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}class D{static{this.\u0275fac=function(e){return new(e||D)}}static{this.\u0275mod=a.\u0275\u0275defineNgModule({type:D})}static{this.\u0275inj=a.\u0275\u0275defineInjector({providers:[P,R,V]})}}let Z=class ut{constructor(t){this._materialIconsRegistrator=t,this._materialIconsRegistrator.addIcons([{name:"communication-options",icon:s(42978)}])}static{this.\u0275fac=function(e){return new(e||ut)(a.\u0275\u0275inject(ht.K))}}static{this.\u0275mod=a.\u0275\u0275defineNgModule({type:ut})}static{this.\u0275inj=a.\u0275\u0275defineInjector({providers:[{provide:Mt.m,useClass:$,multi:!0},{provide:Mt.m,useClass:x,multi:!0}],imports:[ft.V,gt.C,w.CommonModule,Q.MatIconModule,bt.c,Ct.q,yt.f,vt.y,z.y,X.u,K.u,It.q,At.h,_t.D,J.s,D,M.TranslateModule]})}};Z=(0,l.__decorate)([(0,Tt.g)({viewElements:[C],requestHandlers:[H,W,L,G],converters:[tt,et,ot],includes:[K.u,z.y,X.u,J.s]}),(0,l.__metadata)("design:paramtypes",[ht.K])],Z),function(){(typeof ngJitMode>"u"||ngJitMode)&&a.\u0275\u0275setNgModuleScope(Z,{declarations:[C],imports:[ft.V,gt.C,w.CommonModule,Q.MatIconModule,bt.c,$t.C,Ct.q,yt.f,vt.y,z.y,X.u,K.u,It.q,At.h,_t.D,J.s,D,M.TranslateModule],exports:[C]})}()},42978:dt=>{dt.exports=`<svg width="72" height="64" viewBox="0 0 72 64" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M51.9044 17L60 17C62.2091 17 64 18.7909 64 21L64 45C64 47.2091 62.2091 49 60 49L12 49C9.79086 49 8 47.2091 8 45L8 27.24" stroke="#70ACEE"/>
<rect x="14.001" y="26" width="43.998" height="6" rx="3" fill="#D1D1D1"/>
<rect x="14.001" y="35" width="35.9995" height="6" rx="3" fill="#D1D1D1"/>
<path d="M22.7946 15.268C22.4642 15.0271 22 15.2631 22 15.672V20.75C22 21.4375 22.54 22 23.2 22H32.8C33.46 22 34 21.4375 34 20.75V15.6707C34 15.2618 33.5358 15.0258 33.2054 15.2667L28.4301 18.7487C28.1713 18.9374 27.8269 18.9374 27.5681 18.7487L22.7946 15.268Z" fill="#FF8800"/>
<path d="M33.63 13.046C33.8077 12.9164 33.8877 12.6788 33.7588 12.5005C33.5393 12.1971 33.1907 12 32.8 12H23.2C22.8088 12 22.4598 12.1976 22.2404 12.5017C22.1117 12.68 22.1918 12.9174 22.3694 13.0469L27.7045 16.9371C27.88 17.0651 28.1181 17.0651 28.2937 16.9371L33.63 13.046Z" fill="#FF8800"/>
<path d="M17.533 20.0298C18.6608 20.9345 17.4582 21.992 16.9317 22.5954C16.5558 23.0478 16.1041 23.5001 12.8749 21.6908C11.7006 21.0614 10.6352 20.2462 9.71967 19.2763C8.74935 18.3421 7.91405 17.2763 7.23788 16.1099C5.50789 12.8649 5.95946 12.3366 6.41022 12.039C7.01152 11.5106 8.06453 10.3789 8.96694 11.4355C10.4707 13.2448 10.6212 14.0772 10.0947 14.5295C9.71878 14.7557 9.79362 14.8316 9.56824 14.9818C8.96694 15.5852 9.11747 16.5668 10.5455 18.0007L10.7708 18.3028C11.8238 19.3594 13.177 19.8878 13.7792 19.3595C13.9727 19.1477 14.1488 18.9204 14.3057 18.68C14.8321 18.1517 15.3587 18.3028 17.5394 20.037" fill="#22AC14"/>
<path d="M40.9354 16.2082C40.9203 16.3699 40.7892 16.4959 40.6305 16.4959H38.2933C38.117 16.4959 37.9776 16.3414 38.0017 16.1626C38.3182 13.8162 39.9618 11.8942 42.1467 11.1878C42.4072 11.1036 42.6019 11.4071 42.4565 11.6439C41.6103 13.0228 41.0874 14.5842 40.9354 16.2082Z" fill="#0048D1"/>
<path d="M42.2216 16.4959C42.0461 16.4959 41.9073 16.3432 41.9262 16.1645C42.1103 14.4217 42.7492 12.528 43.7745 11.1168C43.8876 10.9611 44.112 10.9611 44.2251 11.1168C45.2505 12.528 45.8894 14.4217 46.0735 16.1645C46.0924 16.3432 45.9535 16.4959 45.778 16.4959H42.2216Z" fill="#0048D1"/>
<path d="M49.9979 16.1626C50.022 16.3414 49.8826 16.4959 49.7063 16.4959H47.3691C47.2104 16.4959 47.0794 16.3699 47.0642 16.2082C46.9123 14.5842 46.3894 13.0228 45.5432 11.6439C45.3978 11.4071 45.5925 11.1036 45.853 11.1878C48.0378 11.8942 49.6815 13.8162 49.9979 16.1626Z" fill="#0048D1"/>
<path d="M45.853 22.792C45.5925 22.8763 45.3978 22.5728 45.5432 22.3359C46.3894 20.9571 46.9123 19.3957 47.0642 17.7716C47.0794 17.6099 47.2104 17.4839 47.3691 17.4839H49.7063C49.8826 17.4839 50.022 17.6384 49.9979 17.8172C49.6815 20.1637 48.0378 22.0856 45.853 22.792Z" fill="#0048D1"/>
<path d="M45.778 17.4839C45.9535 17.4839 46.0924 17.6366 46.0735 17.8153C45.8894 19.5601 45.2504 21.4698 44.225 22.8832C44.112 23.0389 43.8876 23.0389 43.7746 22.8832C42.7492 21.4698 42.1103 19.5601 41.9261 17.8153C41.9073 17.6366 42.0461 17.4839 42.2216 17.4839H45.778Z" fill="#0048D1"/>
<path d="M38.0017 17.8172C37.9776 17.6384 38.117 17.4839 38.2933 17.4839H40.6305C40.7892 17.4839 40.9203 17.6099 40.9354 17.7716C41.0874 19.3956 41.6103 20.9571 42.4565 22.3359C42.6019 22.5728 42.4072 22.8763 42.1467 22.792C39.9618 22.0856 38.3182 20.1637 38.0017 17.8172Z" fill="#0048D1"/>
</svg>
`}}]);
