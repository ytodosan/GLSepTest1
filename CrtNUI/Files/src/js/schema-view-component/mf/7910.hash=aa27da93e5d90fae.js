(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[7910],{57910:(g,Ie,l)=>{l.r(Ie),l.d(Ie,{CallDirection:()=>he,CrtTimelineComponent:()=>h,CrtTimelineIconModule:()=>b,CrtTimelineLabelComponent:()=>w,CrtTimelineLookupComponent:()=>O,CrtTimelineModule:()=>oe,CrtTimelineSkeletonComponent:()=>T,CrtTimelineTileBaseHeadComponent:()=>f,CrtTimelineTileCallHeadComponent:()=>X,CrtTimelineTileCaseHeadComponent:()=>ee,CrtTimelineTileChatHeadComponent:()=>J,CrtTimelineTileComponent:()=>C,CrtTimelineTileEmailComponent:()=>A,CrtTimelineTileEmailRecipientsComponent:()=>L,CrtTimelineTileFeedComponent:()=>q,CrtTimelineTileFileHeadComponent:()=>Y,CrtTimelineTileHeadDirective:()=>k,DefaultTimelineTile:()=>Oi,EmailRecipientsType:()=>_,TimelineBoundEntity:()=>Ti,TimelineColumnConfig:()=>Mi,TimelineEmailService:()=>V,TimelineFilter:()=>Ei,TimelinePreprocessor:()=>Q,TimelineQuote:()=>bi,TimelineRequest:()=>wt,TimelineResourcesService:()=>B,TimelineService:()=>I,TimelineSingleRecordRequest:()=>vi,TimelineTileColumn:()=>xi});var s=l(5960),d=l(40297),Se=l(6675),R=l(52989),Fe=l(67047),Dt=l(55642),u=l(79772),ke=l(5476),we=l(92527),De=l(1891),Ve=l(47951),Le=l(28627),Re=l(65471),Ne=l(66989),Be=l(31149),je=l(625),He=l(46272),Ae=l(78781),Qe=l(44267),Ue=l(24091),Ke=l(48629),Ge=l(25063),ze=l(57274),$e=l(76509),We=l(90895),Ze=l(39809),Xe=l(78007),Je=l(83515),Ye=l(69015),qe=l(65269),et=l(39596),tt=l(15841),nt=l(44459),it=l(75034),ot=l(29091),at=l(96176),Vt=l(12841),lt=l(43691),rt=l(8346),st=l(1624),ct=l(24507),de=l(19059),e=l(59131),Lt=l(50663);class b{constructor(t){this._materialIconsRegistrator=t;const n=[];n.push({name:"photo-placeholder-timeline",icon:l(19202)}),n.push({name:"arrow-up-recipients",icon:l(25608)}),n.push({name:"arrow-down-recipients",icon:l(69303)}),n.push({name:"arrow-up-heavy",icon:l(12190)}),n.push({name:"arrow-down-heavy",icon:l(73869)}),this._materialIconsRegistrator.addIcons(n)}static{this.\u0275fac=function(n){return new(n||b)(e.\u0275\u0275inject(Lt.K))}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:b})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[d.CommonModule,R.MatIconModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(b,{imports:[d.CommonModule,R.MatIconModule]})})();var N=l(61320),$=l(41108),mt=l(58504),Rt=l(56267),p=l(77592),v=l(3671),dt=l(52793),Nt=l(50999),pt=l(10098),Bt=l(88033),jt=l(18357),Ht=l(65485),ut=l(67772),ht=l(38160),gt=l(13622),pe=l(68712),At=l(72882),Qt=l(23092),W=l(91065),Ut=l(92009),Kt=l(72572),Ct=l(85604),c=l(62278);const ue={};function P(o,t){return function(n){const i={component:n,columns:t};ue[o]=i}}function yt(o){return ue[o]??ue.Base}var Gt=l(48899);class B{constructor(t,n){this._entitySchemaService=t,this._translateService=n,this._customEntitiesList=["Email","Feed","Task","SysFile"],this._cachedSchemes=[]}_loadEntitySchemes(t){const n=t.filter(i=>this._cachedSchemes.findIndex(a=>a.name===i)===-1);if(n.length>0){const i={requests:[]};return n.forEach(a=>i.requests.push({name:a})),this._entitySchemaService.getEntitySchemes(i).pipe((0,c.map)(a=>(a.schemes.forEach(r=>{this._cachedSchemes.includes(r)||this._cachedSchemes.push(r)}),this._cachedSchemes.filter(r=>t.includes(r.name)))),(0,c.take)(1))}else return(0,c.of)(this._cachedSchemes.filter(i=>t.includes(i.name)))}getCaption(t,n){return this.getCaptions([t],n).pipe((0,c.map)(i=>i[0]?.caption),(0,c.take)(1))}getCaptions(t,n){const i=[];t.forEach(r=>{if(this._customEntitiesList.some(m=>m===r)){const m=this._translateService.instant(n+"."+r);i.push({schemaName:r,caption:m?.Caption||r})}else{const m=this._cachedSchemes.find(x=>x.name===r)?.caption;m&&i.push({schemaName:r,caption:m.toString()})}});const a=t.filter(r=>i.findIndex(m=>m.schemaName===r)===-1);return a.length>0?this._loadEntitySchemes(a).pipe((0,c.map)(r=>(r.forEach(m=>{i.push({schemaName:m.name,caption:m.caption.toString()})}),i))):(0,c.of)(i)}getEntitySchema(t){return this._loadEntitySchemes([t]).pipe((0,c.map)(n=>n[0]))}getEntitySchemes(t){return this._loadEntitySchemes(t)}static{this.\u0275fac=function(n){return new(n||B)(e.\u0275\u0275inject(Gt.e),e.\u0275\u0275inject(u.TranslateService))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac,providedIn:"root"})}}var ft=l(63721),zt=l(26594);class I{constructor(t,n){this._httpClient=t,this._featureValues=n,this._serviceUrl="/rest/TimelineService/",this._entityServiceUrl="/ServiceModel/TimelineEntityService.svc/",this._dataSources=["SysFile","Feed"],this._getEmptyResponse=()=>(0,c.of)({success:!1,entities:[],hasPostponedColumns:!1}),this._featureValues["LargeEmailsInTimeline.DisableEmailPreviewLoader"]||this._dataSources.push("Email")}_createTimelineRequestConfig(t,n){const i={masterEntitySchemaName:t.schemaName,masterRecordId:t.id,rowCount:t.rowCount,offset:t.offset,filters:"",orderDirection:t.orderDirection,boundEntities:[],search:t.search};for(const[,a]of Object.entries(n)){const r={schemaName:a.schemaName||a.boundEntityName,boundEntityName:a.boundEntityName,tileFilter:a.tileFilter,filters:JSON.stringify(a?.filters?.toJson()),dateColumnName:"CreatedOn",authorColumnName:"CreatedBy",sortColumnName:a.sortedByColumnName,ownerColumnName:a.ownerColumnName,iconId:a.iconId,masterEntityColumnName:a.linkedColumnName,entitySchemaDataSource:this._dataSources.includes(a.boundEntityName)?a.boundEntityName:"",columns:[]};for(const[m]of Object.entries(a.timelineTileColumnConfigs))r.columns.push({columnName:m});i.boundEntities.push(r)}return i}_createSingleRecordRequestConfig(t,n,i){const a=this._createTimelineRequestConfig(t,n);return a.recordId=i,a.offset=0,a.rowCount=1,a}_convertTimelineEntityDtoToTimelineEntity(t){return{id:t.id,schemaName:t.schemaName,tileEntityName:t.boundEntityName,entityId:t.entityId,date:t.date,sortColumn:t.sortColumn,author:t.author,displayColumnName:t.primaryDisplayColumnName,userAccess:t.userAccess,columns:t.columnValues.map(i=>({columnName:i.columnName,columnValue:i.columnValue,columnCaption:i.columnCaption,columnDataType:{dataValueType:i.columnDataType?.dataValueType,isLookup:i.columnDataType?.isLookup,referenceSchemaName:i.columnDataType?.referenceSchemaName}}))}}_handleResponse(t,n){let i=[];return t&&t.success?i=n(t):console.error(`Error while fetch timeline data: ${t.errorInfo?.message}`),i}loadData(t,n){const i=this._createTimelineRequestConfig(t,n),a=this._serviceUrl+"LoadData";return this._httpClient.post(a,i).pipe((0,c.catchError)(()=>this._getEmptyResponse()),(0,c.map)(r=>this._handleResponse(r,()=>(this._isNeedToLoadLargeData=r.hasPostponedColumns,r.entities.map(m=>this._convertTimelineEntityDtoToTimelineEntity(m))))))}loadTimelineConfig(t,n){const i=this._entityServiceUrl+"GetTimelineEntities";return this._httpClient.post(i,{schemaName:t,excludedTiles:n})}loadLargeData(t,n){if(this._isNeedToLoadLargeData){const i=this._createTimelineRequestConfig(t,n),a=this._serviceUrl+"LoadLargeColumns";return this._httpClient.post(a,i).pipe((0,c.catchError)(()=>this._getEmptyResponse()),(0,c.map)(r=>this._handleResponse(r,()=>(this._isNeedToLoadLargeData=!1,r.entities.map(m=>this._convertTimelineEntityDtoToTimelineEntity(m))))))}else return(0,c.of)([])}getTimelineEntity(t,n,i){const a=this._createSingleRecordRequestConfig(t,n,i),r=this._serviceUrl+"GetSingleEntityData";return this._httpClient.post(r,a).pipe((0,c.catchError)(()=>this._getEmptyResponse()),(0,c.map)(m=>this._handleResponse(m,()=>m?.entities?.map(x=>this._convertTimelineEntityDtoToTimelineEntity(x)))[0]),(0,c.filter)(m=>m!==void 0))}static{this.\u0275fac=function(n){return new(n||I)(e.\u0275\u0275inject(ft.HttpClient),e.\u0275\u0275inject(zt.G))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"})}}var U=l(73308),S=l(86464),F=l(96677),$t=l(60776),K=l(90983);class k{constructor(t){this.viewContainerRef=t}static{this.\u0275fac=function(n){return new(n||k)(e.\u0275\u0275directiveInject(e.ViewContainerRef))}}static{this.\u0275dir=e.\u0275\u0275defineDirective({type:k,selectors:[["","crtTileHead",""]]})}}var G=l(58433),Wt=l(12886);const Zt=()=>({height:"32px"});function Xt(o,t){}function Jt(o,t){o&1&&e.\u0275\u0275element(0,"crt-skeleton-loader",6),o&2&&e.\u0275\u0275property("styles",e.\u0275\u0275pureFunction0(1,Zt))}function Yt(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275element(1,"crt-grid",4),e.\u0275\u0275template(2,Jt,1,2,"crt-skeleton-loader",5),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("items",n.gridConfig),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.hasNotLoadedData())}}let C=class fe{set entity(t){this._entity=t,this._mapEntityValueToComponent(this.entity,!0)}get entity(){return this._entity}set isTileReadOnly(t){this._isTileReadOnly=t,this._customHeadComponentRef&&(this._customHeadComponentRef.instance.isTileReadOnly=t)}get isTileReadOnly(){return this._isTileReadOnly}constructor(t){this.injector=t,this.gridConfig=[],this._recordUrlCreator=this.injector.get(de.k)}_mapEntityValueToComponent(t,n){this.tileColumnsConfig&&(this.gridConfig=[],t.columns.forEach(i=>{this._createAndAppendColumnToGrid(i)}),n&&this._reloadCustomTileComponent())}_createAndAppendColumnToGrid(t){if(this.tileColumnsConfig[t.columnName]?.layoutConfig){const n=this._getColumnComponentType(t.columnDataType),i=this._formatColumnValue(t);this.gridConfig.push({...this.tileColumnsConfig[t.columnName],caption:t.columnCaption,value:i,dataValueType:t.columnDataType?.dataValueType,type:n})}}_formatColumnValue(t){const n=t.columnValue?.displayValue||t.columnValue?.value;let i={};return n&&(t.columnDataType.isLookup?(i.displayValue=n,i.href=this._getEntityLink(t.columnValue.value,t.columnDataType.referenceSchemaName),i.entityName=t.columnDataType.referenceSchemaName,i.recordId=t.columnValue.value,i.primaryColorValue=t.columnValue.primaryColorValue):(i=this._customHeadComponentRef.instance.formatCustomValue?this._customHeadComponentRef.instance.formatCustomValue(t.columnName,n):n,t.columnDataType.dataValueType!==S.r.RICH_TEXT&&(i=i.replaceAll(`
`,"<br>")))),i}_getColumnComponentType(t){switch(t.dataValueType){case S.r.Lookup:return"crt.TimelineLookup";case S.r.WEB_TEXT:return"crt.TimelineWebLabel";case S.r.EMAIL_TEXT:return"crt.TimelineEmailLabel";case S.r.PHONE_TEXT:return"crt.TimelinePhoneLabel";default:return"crt.TimelineLabel"}}_getEntityLink(t,n){var i=this;return(0,U.A)(function*(){return window.Terrasoft?.isAngularHost?yield i._recordUrlCreator.getUrl({entityName:n,recordId:t}):(0,K.TX)(n,t)})()}_createCustomTileComponent(t){const n=yt(t).component,i=this.tileHead.viewContainerRef,a=(0,e.createEnvironmentInjector)([],this.injector);this._customHeadComponentRef=this._customHeadComponentRef??i.createComponent(n,{environmentInjector:a}),this._customHeadComponentRef.instance.entity=this.entity,this._customHeadComponentRef.instance.tileViewConfig=this.tileViewConfig,this._customHeadComponentRef.instance.tileEntityConfig=this.tileEntityConfig,this._customHeadComponentRef.instance.isTileReadOnly=this.isTileReadOnly,this._customHeadComponentRef.changeDetectorRef.detectChanges()}_reloadCustomTileComponent(){this._createCustomTileComponent(this.entity.tileEntityName)}_subscribeUpdateEntity(){this.updatedEntity.pipe((0,c.filter)(t=>t.id===this.entity.id),(0,c.take)(1)).subscribe(t=>{this.entity=t})}ngOnInit(){this._createCustomTileComponent(this.entity.tileEntityName),this._mapEntityValueToComponent(this.entity,!1),this._subscribeUpdateEntity()}isLookupValue(t){return t!==null&&typeof t=="object"&&"value"in t&&"displayValue"in t}hasNotLoadedData(){for(const[t]of Object.entries(this.tileColumnsConfig))if(!this.entity.columns.find(n=>n.columnName===t))return!0;return!1}static{this.\u0275fac=function(n){return new(n||fe)(e.\u0275\u0275directiveInject(e.Injector))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:fe,selectors:[["crt-timeline-tile"]],viewQuery:function(n,i){if(n&1&&e.\u0275\u0275viewQuery(k,7),n&2){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.tileHead=a.first)}},inputs:{entity:"entity",tileColumnsConfig:"tileColumnsConfig",tileViewConfig:"tileViewConfig",tileEntityConfig:"tileEntityConfig",updatedEntity:"updatedEntity",isTileReadOnly:"isTileReadOnly"},decls:3,vars:1,consts:[[1,"timeline-tile"],["crtTileHead",""],["class","tile-body",4,"ngIf"],[1,"tile-body"],[3,"items"],[3,"styles",4,"ngIf"],[3,"styles"]],template:function(n,i){n&1&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Xt,0,0,"ng-template",1)(2,Yt,3,2,"div",2),e.\u0275\u0275elementEnd()),n&2&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(i.gridConfig==null?null:i.gridConfig.length)>0))},dependencies:[d.NgIf,G.W,Wt.N,k],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{display:block;padding:4px 0}[_nghost-%COMP%]:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}[_nghost-%COMP%]   .timeline-tile[_ngcontent-%COMP%]{margin-bottom:24px;max-width:980px}[_nghost-%COMP%]   .timeline-tile[_ngcontent-%COMP%]   .tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}"]})}};(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Object),(0,s.__metadata)("design:paramtypes",[Object])],C.prototype,"entity",null),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Array)],C.prototype,"tileColumnsConfig",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Object)],C.prototype,"tileViewConfig",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Object)],C.prototype,"tileEntityConfig",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",c.ReplaySubject)],C.prototype,"updatedEntity",void 0),C=(0,s.__decorate)([(0,v.v)({type:"crt.TimelineTile",contentSlots:["items","filters"],reuseStrategy:F.B.Reuse,compatibleAPIs:{[$t.I.Filtration]:{enable:!0,aggregation:!0}}}),(0,dt.f)({propertiesPanelComponentTypeName:"crt.TimelineItemPropertiesPanel",viewElementGroupType:pt.J.CustomElements,typeCaption:"TypeCaptions.TimelineTile"}),(0,s.__metadata)("design:paramtypes",[e.Injector])],C);var _t=l(62115),qt=l(30491),Z=l(12325),en=l(41571),tn=l(86432),nn=l(22817),on=l(66675);const vt=()=>[1,2,3,4];function an(o,t){if(o&1&&e.\u0275\u0275elementContainer(0,7),o&2){e.\u0275\u0275nextContext(2);const n=e.\u0275\u0275reference(3);e.\u0275\u0275property("ngTemplateOutlet",n)}}function ln(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275template(1,an,1,1,"ng-container",4),e.\u0275\u0275elementStart(2,"div",5),e.\u0275\u0275element(3,"crt-skeleton-loader",6),e.\u0275\u0275elementContainer(4,7),e.\u0275\u0275elementEnd()()),o&2){const n=e.\u0275\u0275nextContext(),i=e.\u0275\u0275reference(3);e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pureFunction0(3,vt)),e.\u0275\u0275advance(2),e.\u0275\u0275property("styles",n.skeletonConfig.circleSmall),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",i)}}function rn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",8),e.\u0275\u0275element(1,"crt-skeleton-loader",9),e.\u0275\u0275elementStart(2,"div",10),e.\u0275\u0275element(3,"crt-skeleton-loader",11)(4,"crt-skeleton-loader",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",13),e.\u0275\u0275element(6,"crt-skeleton-loader",14)(7,"crt-skeleton-loader",12),e.\u0275\u0275elementEnd()()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("styles",n.skeletonConfig.circle),e.\u0275\u0275advance(2),e.\u0275\u0275property("styles",n.skeletonConfig.headItem),e.\u0275\u0275advance(),e.\u0275\u0275property("styles",n.skeletonConfig.headItems),e.\u0275\u0275advance(2),e.\u0275\u0275property("styles",n.skeletonConfig.bodyTopItem),e.\u0275\u0275advance(),e.\u0275\u0275property("styles",n.skeletonConfig.bodyItem)}}function sn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",15),e.\u0275\u0275element(1,"crt-skeleton-loader",16)(2,"crt-skeleton-loader",14),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("styles",n.skeletonConfig.circleSmall),e.\u0275\u0275advance(),e.\u0275\u0275property("styles",n.skeletonConfig.labelSmall)}}class T extends pe.K{constructor(){super(...arguments),this.isShownFilters=!0,this.skeletonConfig={circle:{height:"32px",width:"32px",margin:0},circleSmall:{height:"24px",width:"24px",margin:0},labelSmall:{height:"16px",width:"80px",margin:0},headItem:{display:"inline-flex",height:"12px",width:"288px"},headItems:{display:"inline-flex",height:"16px",width:"40px","margin-right":"8px"},bodyTopItem:{height:"56px"},bodyItem:{height:"16px",width:"120px","margin-right":"8px"}}}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(T)))(i||T)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:T,selectors:[["crt-timeline-skeleton"]],inputs:{isShownFilters:"isShownFilters"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["skeletonFilterItem",""],["class","skeleton-filters",4,"ngIf"],["class","main-skeleton-container",4,"ngFor","ngForOf"],[1,"skeleton-filters"],[3,"ngTemplateOutlet",4,"ngFor","ngForOf"],[1,"filter-right-container"],["appearance","circle","count","1",1,"lookup-filter",3,"styles"],[3,"ngTemplateOutlet"],[1,"main-skeleton-container"],["appearance","circle","count","1",1,"left-head",3,"styles"],[1,"right-head"],["appearance","line","count","1",1,"right-top-head",3,"styles"],["appearance","line","count","2",3,"styles"],[1,"skeleton-body"],["appearance","line","count","1",3,"styles"],[1,"skeleton-filter-item"],["appearance","circle","count","1",3,"styles"]],template:function(n,i){n&1&&e.\u0275\u0275template(0,ln,5,4,"div",1)(1,rn,8,5,"div",2)(2,sn,3,2,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),n&2&&(e.\u0275\u0275property("ngIf",i.isShownFilters),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pureFunction0(2,vt)))},dependencies:[d.NgForOf,d.NgIf,d.NgTemplateOutlet,G.W],styles:[".main-skeleton-container[_ngcontent-%COMP%]{margin-bottom:24px}.main-skeleton-container[_ngcontent-%COMP%]   .left-head[_ngcontent-%COMP%]{display:inline-flex;width:48px}.main-skeleton-container[_ngcontent-%COMP%]   .right-head[_ngcontent-%COMP%]{display:inline-block;width:500px}.main-skeleton-container[_ngcontent-%COMP%]   .skeleton-body[_ngcontent-%COMP%]{margin-left:48px}.skeleton-filters[_ngcontent-%COMP%]{margin:36px 0}.skeleton-filters[_ngcontent-%COMP%]   .skeleton-filter-item[_ngcontent-%COMP%]{display:inline-block;margin-right:16px}.skeleton-filters[_ngcontent-%COMP%]   .skeleton-filter-item[_ngcontent-%COMP%]   crt-skeleton-loader[_ngcontent-%COMP%]{display:inline-block;width:auto;vertical-align:middle}.skeleton-filters[_ngcontent-%COMP%]   .filter-right-container[_ngcontent-%COMP%]{display:inline-block;position:absolute;right:0}.skeleton-filters[_ngcontent-%COMP%]   .filter-right-container[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{width:auto;display:inline-block}.skeleton-filters[_ngcontent-%COMP%]   .filter-right-container[_ngcontent-%COMP%]   .lookup-filter[_ngcontent-%COMP%]{vertical-align:middle;margin-right:64px}"]})}}const cn=["customFilters"],mn=["tools"],dn=["timelineContainer"];function pn(o,t){o&1&&e.\u0275\u0275elementContainer(0)}function un(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,pn,1,0,"ng-container",9),e.\u0275\u0275elementEnd()),o&2){const n=t.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)}}function hn(o,t){if(o&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",7),e.\u0275\u0275template(2,un,2,1,"div",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.toolsTemplates)}}function gn(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",21)(1,"crt-quick-filter",22),e.\u0275\u0275listener("valueChange",function(a){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.handleFilterByEntityValueChange(a))}),e.\u0275\u0275elementEnd()()}if(o&2){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("filterType","lookup")("config",n.getFilterByEntityConfig())("value",n.quickFilterByEntitySelectedValue)}}function Cn(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",23)(1,"crt-quick-filter",24),e.\u0275\u0275listener("valueChange",function(a){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.handleFilterByDateValueChange(a))}),e.\u0275\u0275elementEnd()()}if(o&2){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("filterType","date-range")("config",n.getFilterByDateConfig())("value",n.quickFilterDateSelectedValue)}}function yn(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0,27),e.\u0275\u0275listener("viewElementShow",function(a){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(r.onQuickFilterByOwnerElementShow(a))}),e.\u0275\u0275elementContainerEnd()}if(o&2){const n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("crtViewElement",n.quickFilterByOwnerConfig)}}function fn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",25),e.\u0275\u0275template(1,yn,1,1,"ng-container",26),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.quickFilterByOwnerConfig)}}function _n(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",28)(1,"crt-quick-filter",29),e.\u0275\u0275twoWayListener("valueChange",function(a){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275twoWayBindingSet(r.hideSystemMessagesFilterValue,a)||(r.hideSystemMessagesFilterValue=a),e.\u0275\u0275resetView(a)}),e.\u0275\u0275listener("valueChange",function(a){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.handleFilterBySystemMessagesChange(a))}),e.\u0275\u0275elementEnd()()}if(o&2){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("filterType","custom"),e.\u0275\u0275twoWayProperty("value",n.hideSystemMessagesFilterValue),e.\u0275\u0275property("config",n.getSystemMessagesFilterConfig())}}function vn(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11),e.\u0275\u0275template(2,gn,2,3,"div",12)(3,Cn,2,3,"div",13)(4,fn,2,1,"div",14)(5,_n,2,3,"div",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",16)(7,"div",17)(8,"crt-search-filter",18),e.\u0275\u0275listener("valueChange",function(a){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onSearchFilterChanged(a))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",19)(10,"crt-button",20),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.updateTimelineOrderDirection())}),e.\u0275\u0275elementEnd()()()()}if(o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("crtKeyboardFocusContainerFocusEnterElement",n.firstFilterElement==null?null:n.firstFilterElement.nativeElement),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.isFilterVisible("TimelineFilter_Entity")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isFilterVisible("TimelineFilter_Date")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isFilterVisible("TimelineFilter_Owner")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isFilterVisible("TimelineFilter_SystemMessages")),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("icon",n.orderDirection===n.ascOrderDirection?"arrow-up-heavy":"arrow-down-heavy"),e.\u0275\u0275property("caption",e.\u0275\u0275pipeBind1(11,8,"Timeline.DateSort"))("ariaLabel",n.getSortButtonTitle())}}function Tn(o,t){o&1&&e.\u0275\u0275elementContainer(0)}function Mn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,Tn,1,0,"ng-container",9),e.\u0275\u0275elementEnd()),o&2){const n=t.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)}}function En(o,t){if(o&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",30),e.\u0275\u0275template(2,Mn,2,1,"div",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.customFiltersTemplates)}}function On(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",36),e.\u0275\u0275element(1,"crt-label",37),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("caption",i.getMonthSeparatorText(n.date))}}function xn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,On,2,1,"div",34),e.\u0275\u0275element(2,"crt-timeline-tile",35),e.\u0275\u0275elementEnd()),o&2){const n=t.$implicit,i=t.index,a=e.\u0275\u0275nextContext(2);e.\u0275\u0275attribute("tile-id",i),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",a.isShowMonthSeparator(n.date,i)),e.\u0275\u0275advance(),e.\u0275\u0275property("entity",n)("updatedEntity",a.entitySubject$)("tileColumnsConfig",a.getTileColumnsConfig(n.tileEntityName))("tileViewConfig",a.getTileViewConfig(n.tileEntityName))("tileEntityConfig",a.getTimeLineEntityConfig(n.tileEntityName))("isTileReadOnly",a.isTileReadOnly)}}function bn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",38),e.\u0275\u0275element(1,"crt-lottie",39)(2,"crt-label",40),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275element(4,"crt-label",41),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("config",n.noDataAnimationOptions),e.\u0275\u0275advance(),e.\u0275\u0275property("caption",e.\u0275\u0275pipeBind1(3,3,"Timeline.NoDataMessage")),e.\u0275\u0275advance(2),e.\u0275\u0275property("caption",e.\u0275\u0275pipeBind1(5,5,"Timeline.FillActionMessage"))}}function Pn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",42),e.\u0275\u0275element(1,"crt-placeholder",43),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(2,3,"Timeline.NoDataByFilterMessage")),e.\u0275\u0275propertyInterpolate("subhead",e.\u0275\u0275pipeBind1(3,5,"Timeline.FillActionByFilterMessage")),e.\u0275\u0275property("image",n.placeholder)}}function In(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",null,1)(2,"div",31),e.\u0275\u0275template(3,xn,3,8,"div",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,bn,6,7,"div",32)(5,Pn,4,7,"div",33),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("crtKeyboardFocusContainerFocusEnterElement",n.firstTileElement==null?null:n.firstTileElement.nativeElement),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.timelineData),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.isLoading&&(n.timelineData==null?null:n.timelineData.length)===0&&!n.hasActiveFilter()),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.isLoading&&(n.timelineData==null?null:n.timelineData.length)===0&&n.hasActiveFilter())}}function Sn(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",44),e.\u0275\u0275listener("crtObserveElementInViewportStateChange",function(a){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onLastTileStateChange(a))}),e.\u0275\u0275elementEnd()}}function Fn(o,t){o&1&&e.\u0275\u0275element(0,"crt-timeline-skeleton",45),o&2&&e.\u0275\u0275property("isShownFilters",!1)}var M;(function(o){o.ByDate="date",o.ByOwner="owner"})(M||(M={}));let h=class _e extends pe.K{set masterSchemaId(t){t&&!this._useMasterEntity&&(this._masterEntitySchemaName=this.getMasterSchemaName(),this._masterSchemaId=t,this.name&&this._init())}set masterEntitySchemaName(t){this._masterEntitySchemaName=t}set masterEntity(t){this._useMasterEntity=!0,t&&(this._masterSchemaId=t.value||t,this._init())}constructor(t,n){super(t),this._injector=t,this.timelineService=n,this._timelineEntityConfigs=[],this._filteredTimelineEntityConfigs=[],this._rowsToLoadCount=15,this._defaultSortColumnName="CreatedOn",this._entityCaptions=[],this._timelineFilters={},this._timelineSearch="",this._defaultOrderDirection=N.Z.Desc,this._subscriptions=new c.Subscription,this._isInitialized=!1,this.ascOrderDirection=N.Z.Asc,this.isLoading=!1,this.entitySubject$=new c.ReplaySubject(this._rowsToLoadCount,2e3),this.isViewConfigInited=!1,this.noDataAnimationOptions={animationData:()=>l.e(2159).then(l.t.bind(l,14540,19)),autoplay:!0,loop:!1},this.quickFilterByEntityInitialItems=[],this.quickFilterByEntitySelectedValue=[],this.quickFilterByOwnerSelectedValue=[],this.hideSystemMessagesFilterValue=!0,this.placeholder={type:"icon",icon:"empty-search-result",width:null,height:null,padding:null},this._schemaService=this._injector.get(Ut.R),this._liveEditingService=this._injector.get(Kt.m),this._feedNotificationService=this._injector.get(At.Z),this._translateService=this.injector.get(u.TranslateService),this._timelineResourceService=this.injector.get(B),this._maskService=this.injector.get(Bt.s),this._subscriptions.add(this._liveEditingService.liveEditingEvent$.subscribe(i=>{this._addOrUpdate(i)})),this._userProfileService=this._injector.get(jt.c),this._userInfo=this._injector.get(Qt.oq),this._dateRangeMacrosConverter=this._injector.get(Ht.j),this._subscribeFeedPostPublished()}_applyDefaultTimelineTiles(t){return t.values.forEach(n=>{const i=n.schemaName,a=[];n.predefinedColumns?.forEach(r=>{a[r.ColumnName]=this._getSimpleTimelineTile({columnName:r.ColumnName,columnLayout:JSON.parse(r.ColumnLayout)})}),this._appendCustomObjectsColumns(a,i),this._timelineEntityConfigs[i]={schemaName:i,boundEntityName:i,tileFilter:n.timelineFilter,filters:new $.X,sortedByColumnName:n.sortColumn||this._defaultSortColumnName,linkedColumnName:n.defaultMasterEntityColumnName,timelineTileColumnConfigs:a,ownerColumnName:n.ownerColumn,iconId:n.iconId}}),this._timelineEntityConfigs=Object.fromEntries(Object.entries(this._timelineEntityConfigs).filter(([n,i])=>!i?.viewElementConfig?.data?.isDeleted)),(0,c.of)(this._timelineEntityConfigs)}_getSimpleTimelineTile(t){return{columnName:t.columnName,layoutConfig:t.columnLayout}}_subscribeFeedPostPublished(){this._subscriptions.add((0,c.merge)(this._feedNotificationService.feedPostPublishedEvent,this._feedNotificationService.newMessageEvent).pipe((0,c.filter)(t=>t.EntityId===this._masterSchemaId&&(t.Operation===W.x.Insert&&!t.ParentId||t.Operation===W.x.Update)),(0,c.switchMap)(t=>{const n=this._formatMasterRecordConfig(),i=Object.values(this._timelineEntityConfigs).filter(a=>a.boundEntityName==="Feed");return this.timelineService.getTimelineEntity(n,i,t.MessageId).pipe((0,c.map)(a=>({notification:t,entity:a})))})).subscribe(({notification:t,entity:n})=>{switch(t.Operation){case W.x.Insert:this._insertRecord(n);break;case W.x.Update:this._updateRecord({primaryColumnValue:n.id},n);break}this.changeDetectorRef.detectChanges()}))}_addOrUpdate(t){if(this._isBelongToTimeline(t)){const i=this._formatMasterRecordConfig(),a=this._getTilesConfigBySchema(t.entitySchemaName);this._subscriptions.add(this.timelineService.getTimelineEntity(i,a,t.primaryColumnValue).subscribe(r=>{switch(t.eventType){case Ct.M.Create:this._insertRecord(r);break;case Ct.M.Update:this._isRecordExistsInTimeline(t.primaryColumnValue)?this._updateRecord(t,r):this._insertRecord(r);break;default:break}this.changeDetectorRef.detectChanges()}))}}_updateRecord(t,n){const i=this.timelineData.findIndex(a=>a.entityId===t.primaryColumnValue||a.id===t.primaryColumnValue);i<0||(this.timelineData[i]=n)}_insertRecord(t){this.timelineData.unshift(t)}_isBelongToTimeline(t){return this._isRecordExistsInTimeline(t.primaryColumnValue)||this._isTimelineEntitySchema(t.entitySchemaName)&&this._hasMasterRecordConnection(t)}_isRecordExistsInTimeline(t){return this.timelineData.some(n=>n.entityId===t)}_getTilesConfigBySchema(t){const n=Object.values(this._timelineEntityConfigs).filter(i=>i.schemaName===t);if(this._isFileSchema(t)){const i=this._timelineEntityConfigs.SysFile;i&&n.push(i)}return n}_isTimelineEntitySchema(t){return this._isFileSchema(t)||this._getTilesConfigBySchema(t).some(n=>n.schemaName===t)}_isFileSchema(t){return/.*File$/.test(t)}_hasMasterRecordConnection(t){return t.connectedLiveSchemaColumns?Object.keys(t.connectedLiveSchemaColumns).map(i=>t.connectedLiveSchemaColumns[i]).some(i=>i===this._masterSchemaId):!1}_initFiltersConfig(){const t=this._schemaService.getViewConfigInfoByName(this.name)?.viewConfig;this._filterConfig=t?.filters||[],this._applyDefaultTimelineFilters()}_initTilesConfigs(){return(this._schemaService.getViewConfigInfoByName(this.name).viewConfig?.items||[]).forEach(i=>{const a=i.data.schemaType||i.data.schemaName,r=[];i.data.columns?.forEach(m=>{r[m.columnName]=this._getSimpleTimelineTile(m)}),this._appendCustomObjectsColumns(r,a),this._timelineEntityConfigs[a]={schemaName:i.data.schemaName,boundEntityName:a,tileFilter:i.data.filter,filters:new $.X,sortedByColumnName:i.sortedByColumn||i.data.sortedByColumn||this._defaultSortColumnName,linkedColumnName:i.linkedColumn||i.data.linkedColumn,timelineTileColumnConfigs:r,viewElementConfig:i,ownerColumnName:i.ownerColumn,iconId:i.iconId}}),(0,c.of)(this._timelineEntityConfigs)}_appendCustomObjectsColumns(t,n){const i=yt(n);i&&i.columns.forEach(a=>{t[a]={schemaName:a}})}getMasterSchemaName(){if(this._masterEntitySchemaName)return this._masterEntitySchemaName;const t=this._schemaService.getModelConfig();return t.dataSources[t.primaryDataSourceName].config.entitySchemaName}_formatMasterRecordConfig(){const t=this.timelineData?.length-this.timelineData?.length%this._rowsToLoadCount||0;return{id:this._masterSchemaId,schemaName:this.getMasterSchemaName(),rowCount:this._rowsToLoadCount,offset:t,orderDirection:this.orderDirection,search:this._timelineSearch}}_getTimelineEntityConfig(){return this._filteredTimelineEntityConfigs.length===0?this._timelineEntityConfigs:this._filteredTimelineEntityConfigs}_loadData(t=!1){this.isLoading=!0,t&&(this._maskService.showBodyMask(),this.timelineData=[]);const n=this._formatMasterRecordConfig(),i=this._getTimelineEntityConfig();this._composeFilters(),this._subscriptions.add(this.timelineService.loadData(n,i).pipe((0,c.map)(a=>{if(a){this.isLoading=!1;const r=a.filter(m=>!this.timelineData?.some(x=>x.id===m.id));this.timelineData=(this.timelineData||[]).concat(r),this._maskService.hideBodyMask(),this.changeDetectorRef.detectChanges(),this._subscriptions.add(this.timelineService.loadLargeData(n,i).subscribe(m=>this._appendAdditionalData(m)))}})).subscribe())}_appendAdditionalData(t){t&&t.forEach(n=>{if(n.columns.length>0){const i=this.timelineData.find(a=>a.id===n.id);i.columns=i.columns.concat(n.columns),this.entitySubject$.next(i)}})}_getLastTileId(){return this.timelineContainer?.nativeElement?.querySelector("[tile-id]:last-of-type")?.getAttribute("tile-id")}_init(){this._isInitialized=!0,this._subscriptions.add(this._schemaService.schemaLoaded$.pipe((0,c.take)(1),(0,c.mergeMap)(()=>(this._initializeFilters(),this._initTilesConfigs())),(0,c.mergeMap)(t=>{const n=Object.keys(t);return this.timelineService.loadTimelineConfig(this.getMasterSchemaName(),n)}),(0,c.mergeMap)(t=>this._applyDefaultTimelineTiles(t)),(0,c.mergeMap)(t=>this._initQuickFilterByEntityInitialItems(t)),(0,c.mergeMap)(t=>this._initQuickFiltersFromProfile(t)),(0,c.tap)(()=>{this.isViewConfigInited=!0,this._loadData()})).subscribe())}_initializeFilters(){this._initFiltersConfig(),this.isFilterVisible("Owner")&&(this._timelineFilters[M.ByOwner]=this._addFilterByOwner.bind(this)),this.isFilterVisible("Date")&&(this._timelineFilters[M.ByDate]=this._addFilterByDate.bind(this))}_initQuickFilterByEntityInitialItems(t){return this._timelineResourceService.getCaptions(Object.keys(t),"Timeline.TileCaptions").pipe((0,c.tap)(n=>{n.forEach(i=>{this._entityCaptions.push({displayValue:i.caption,value:i.schemaName})})}),(0,c.map)(()=>(this.quickFilterByEntityInitialItems=Object.values(this._timelineEntityConfigs).map(n=>this._generateQuickFilterByEntitiesItem(n)).sort((n,i)=>n.displayValue>i.displayValue?1:-1),t)))}_getTimelineEntitiesFilteredByType(t){return this.isFilterVisible("Entity")&&t&&t.length>0?Object.values(this._timelineEntityConfigs).filter(n=>t.includes(n.boundEntityName)):[]}_initQuickFiltersFromProfile(t){return this._userProfileService.getProfile(this._getEntityFilterProfileKey()).pipe((0,c.map)(n=>(this._savedFiltersInProfile=n,this._filteredTimelineEntityConfigs=this._getTimelineEntitiesFilteredByType(n?.entities),this.orderDirection=n?.orderDirection??this._defaultOrderDirection,this.hideSystemMessagesFilterValue=n?.hideSystemMessages!==!1,this._toggleSystemMessagesFilter(this.hideSystemMessagesFilterValue),this._setQuickFilterByOwnerValues(n?.owners),this._setQuickFilterByDate(n?.date),this._setQuickFilterByEntityValues(this._filteredTimelineEntityConfigs),this.detectChanges(),t)))}_setQuickFilterByEntityValues(t){this.quickFilterByEntitySelectedValue=t.map(n=>this._generateQuickFilterByEntitiesItem(n))}_generateQuickFilterByEntitiesItem(t){return{value:t.boundEntityName,displayValue:this._entityCaptions.find(n=>n.value===t.boundEntityName)?.displayValue||t.boundEntityName,checkedState:!0}}_setQuickFilterByOwnerValues(t){this.quickFilterByOwnerSelectedValue=t||[]}_setQuickFilterByDate(t){let n={};t&&(t.macros?n=this._dateRangeMacrosConverter.convert(t.macros):n=t,this.quickFilterDateSelectedValue=n)}_getFilterByEntityViewConfig(){return{type:"crt.ComboBox",useMultiChoice:!0,useStaticFiltering:!0,items:this.quickFilterByEntityInitialItems}}_getEntityFilterProfileKey(){return"TimelineEntityFilterProfileDataIn"+this.getMasterSchemaName()+"PageFor"+this.name}_addFilter(t,n){Object.values(this._timelineEntityConfigs).forEach(i=>{const a=n(i)||new $.X;i.filters.filters.set(t,a)})}_removeFilter(t){Object.values(this._timelineEntityConfigs).forEach(n=>{n.filters.filters.delete(t)})}_composeFilters(){Object.values(this._timelineFilters).forEach(t=>t())}_updateFiltersInProfile(t){Object.assign(this._savedFiltersInProfile,t),this._subscriptions.add(this._userProfileService.saveProfile(this._getEntityFilterProfileKey(),this._savedFiltersInProfile).subscribe())}_addFilterByDate(){this.quickFilterDateSelectedValue&&this._addFilter(M.ByDate,t=>{const n={filterColumn:t.sortedByColumnName};return ut.U.create(ht.U.DateRange,{value:this.quickFilterDateSelectedValue,target:n})})}_addFilterByOwner(){this.quickFilterByOwnerSelectedValue.length>0&&this._addFilter(M.ByOwner,t=>{const n={filterColumn:t.ownerColumnName||"CreatedBy"};return ut.U.create(ht.U.Lookup,{value:this.quickFilterByOwnerSelectedValue,target:n})})}_toggleSystemMessagesFilter(t){const n=this._timelineEntityConfigs.Email,i="hideSystemMessages";n&&(this.isFilterVisible("SystemMessages")&&t?n.filters.addSchemaColumnFilterWithParameter(mt.H.Equal,"IsAutoSubmitted",!1,i):n.filters.filters.delete(i))}_toggleOrderDirection(){this.orderDirection=this.orderDirection===N.Z.Asc?N.Z.Desc:N.Z.Asc}_hasFilterByDate(){return!!(this.quickFilterDateSelectedValue?.start&&this.quickFilterDateSelectedValue?.end)}_formatMonthSeparatorText(t){return t.toLocaleDateString(this._userInfo.cultureInfo.sysCultureName,{month:"long"})+` ${t.toLocaleDateString(this._userInfo.cultureInfo.sysCultureName,{year:"numeric"})}`}_applyDefaultTimelineFilters(){const t=this.getQuickFiltersDefaultConfig(this.name);for(const n of t)this._filterConfig.find(a=>a.type===n.type)||this._filterConfig.push({name:n.name,type:n.type,visible:n.visible})}_mergeFilterGroups(t){if(!t||!t.filter)return null;const n=t.filter.filter(a=>!!a);if(!n)return null;if(n.length===1)return n[0];const i=new $.X(Rt.H.And);return n.forEach(a=>{a.filters.forEach((r,m)=>{i.add(r,m)})}),i}handleFinishLoadViewModelAttributes(){this._useMasterEntity&&!this._masterSchemaId&&(this.timelineData=[],this.isViewConfigInited=!0)}onQuickFilterByOwnerElementShow(t){const n=t?.componentRef?.instance;n&&(this.quickFilterByOwnerSelectedValue.length>0&&(n.value=this.quickFilterByOwnerSelectedValue),this._subscriptions.add(n.valueChange.subscribe(i=>this.handleFilterByOwnerValueChange(i))))}getTileColumnsConfig(t){return this._timelineEntityConfigs[t]?.timelineTileColumnConfigs}getTimeLineEntityConfig(t){return this._timelineEntityConfigs[t]}getTileViewConfig(t){return this._timelineEntityConfigs[t]?.viewElementConfig}onLastTileStateChange(t){if(t.visible===!1||this.isLoading||this.timelineData.length<this._rowsToLoadCount)return;const n=this._getLastTileId();n!==this._lastTileId&&(this._lastTileId=n,this._loadData())}handleFilterByEntityValueChange(t){const n=t.map(i=>i.value);this._filteredTimelineEntityConfigs=this._getTimelineEntitiesFilteredByType(n),this._updateFiltersInProfile({entities:n}),this._loadData(!0)}handleFilterByDateValueChange(t){this._updateFiltersInProfile({date:t}),t?.start&&t?.end?(this.quickFilterDateSelectedValue=t,this._loadData(!0)):t===null&&(this.quickFilterDateSelectedValue=null,this._removeFilter(M.ByDate),this._loadData(!0))}handleFilterByOwnerValueChange(t){this._updateFiltersInProfile({owners:t}),this._setQuickFilterByOwnerValues(t),t&&t.length>0?this._loadData(!0):(this._removeFilter(M.ByOwner),this._loadData(!0))}handleFilterBySystemMessagesChange(t){this._updateFiltersInProfile({hideSystemMessages:t}),this._toggleSystemMessagesFilter(t),this._loadData(!0)}getFilterByEntityConfig(){return{icon:"filter-column-icon",iconPosition:"left-icon",caption:this._translateService.instant("Timeline.EntityFilterCaption"),showRecordsInWindows:!1,hint:this._translateService.instant("Timeline.EntityFilterHint"),comboboxViewElementConfig:this._getFilterByEntityViewConfig()}}getFilterByDateConfig(){return{icon:"date",iconPosition:"left-icon",caption:this._translateService.instant("Timeline.DateFilterCaption"),hint:this._translateService.instant("Timeline.DateFilterHint")}}getSystemMessagesFilterConfig(){return{defaultValue:!0,caption:this._translateService.instant("Timeline.HideSystemMessagesCaption"),hint:this._translateService.instant("Timeline.HideSystemMessagesHint")}}hasActiveFilter(){return this._filteredTimelineEntityConfigs.length>0||this.quickFilterByOwnerSelectedValue?.length>0||this._timelineSearch!==""||this._hasFilterByDate()||!this.hideSystemMessagesFilterValue}updateTimelineOrderDirection(){this._toggleOrderDirection(),this._updateFiltersInProfile({orderDirection:this.orderDirection}),this._loadData(!0)}onSearchFilterChanged(t){this._timelineSearch=t?.value||"",this._loadData(!0)}isShowMonthSeparator(t,n){if(!t||t==="")return!1;if(n===0)return!0;const i=new Date(this.timelineData[n-1].sortColumn),a=new Date(t);return i?.getMonth()!==a.getMonth()||i?.getFullYear()!==a.getFullYear()}getMonthSeparatorText(t){const n=new Date(t);return this._formatMonthSeparatorText(n)}getQuickFiltersDefaultConfig(t){return[{name:t+"_TimelineFilter_Entity",type:"TimelineFilter_Entity",icon:"filter-column-icon",visible:!0},{name:t+"_TimelineFilter_Date",type:"TimelineFilter_Date",icon:"date",visible:!0},{name:t+"_TimelineFilter_Owner",type:"TimelineFilter_Owner",icon:"person-button-icon",visible:!0},{name:t+"_TimelineFilter_SystemMessages",type:"TimelineFilter_SystemMessages",icon:"checkmark-icon",visible:!0}]}ngOnChanges(t){if(t)switch(!0){case("name"in t&&this._masterSchemaId&&!this._isInitialized):this._init();break;case"filterValues"in t:{const n=t.filterValues.currentValue;n?.length>0&&(n.forEach(i=>{Object.values(this._timelineEntityConfigs).forEach(a=>{const r=this._mergeFilterGroups(i);a.boundEntityName===i.type&&r&&a.filters.filters.set(`QuickFilter_${i.type}`,r)})}),this._loadData(!0));break}}}ngOnDestroy(){this._subscriptions.unsubscribe()}isFilterVisible(t){const n=this._filterConfig.find(i=>i.type===t||i.name===t);return!n||n.visible}getSortButtonTitle(){const t="Timeline.ARIA.SortButton";return this._translateService.instant(`${t}.Title`).replace("{0}",this.orderDirection===N.Z.Asc?this._translateService.instant(`${t}.Ascending`):this._translateService.instant(`${t}.Descending`))}static{this.\u0275fac=function(n){return new(n||_e)(e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(I))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:_e,selectors:[["crt-timeline"]],contentQueries:function(n,i,a){if(n&1&&(e.\u0275\u0275contentQuery(a,cn,4,e.TemplateRef),e.\u0275\u0275contentQuery(a,mn,4,e.TemplateRef)),n&2){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(i.customFiltersTemplates=r),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(i.toolsTemplates=r)}},viewQuery:function(n,i){if(n&1&&(e.\u0275\u0275viewQuery(dn,5),e.\u0275\u0275viewQuery(gt.c,5,e.ElementRef),e.\u0275\u0275viewQuery(C,5,e.ElementRef)),n&2){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.timelineContainer=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.firstFilterElement=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.firstTileElement=a.first)}},inputs:{customFilters:"customFilters",tools:"tools",masterSchemaId:"masterSchemaId",masterEntitySchemaName:"masterEntitySchemaName",masterEntity:"masterEntity",quickFilterByOwnerConfig:"quickFilterByOwnerConfig",isTileReadOnly:"isTileReadOnly",filterValues:"filterValues"},features:[e.\u0275\u0275InheritDefinitionFeature,e.\u0275\u0275NgOnChangesFeature],decls:8,vars:6,consts:[["timelineSkeleton",""],["timelineContainer",""],[4,"ngIf"],["class","filters-container","tabindex","0","role","group","crtKeyboardFocusContainer","",3,"crtKeyboardFocusContainerFocusEnterElement",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"observe-last-row"],["crtObserveElementInViewport","",3,"crtObserveElementInViewportStateChange",4,"ngIf"],[1,"timeline-tools-container"],[4,"ngFor","ngForOf"],[4,"ngTemplateOutlet"],["tabindex","0","role","group","crtKeyboardFocusContainer","",1,"filters-container",3,"crtKeyboardFocusContainerFocusEnterElement"],[1,"timeline-quick-filters"],["class","quick-filter-by-entity filter-item",4,"ngIf"],["class","quick-filter-by-date filter-item",4,"ngIf"],["class","quick-filter-by-owner filter-item","data-item-marker","owner-filter",4,"ngIf"],["class","hide-system-messages filter-item",4,"ngIf"],[1,"right-filter-container"],[1,"search-container"],["iconOnly","true",3,"valueChange"],[1,"sort-container"],["iconPosition","left-icon","size","small","displayType","text","color","default",3,"clicked","icon","caption","ariaLabel"],[1,"quick-filter-by-entity","filter-item"],["data-item-marker","entity-filter",3,"valueChange","filterType","config","value"],[1,"quick-filter-by-date","filter-item"],["data-item-marker","date-filter",3,"valueChange","filterType","config","value"],["data-item-marker","owner-filter",1,"quick-filter-by-owner","filter-item"],["tabindex","0",3,"crtViewElement","viewElementShow",4,"ngIf"],["tabindex","0",3,"viewElementShow","crtViewElement"],[1,"hide-system-messages","filter-item"],["data-item-marker","hide-system-messages-filter",3,"valueChange","filterType","value","config"],[1,"custom-filters-container"],["tabindex","0","crtKeyboardFocusContainer","",1,"tiles-container",3,"crtKeyboardFocusContainerFocusEnterElement"],["class","no-data-container",4,"ngIf"],["class","no-data-container no-data-by-filter-container",4,"ngIf"],["class","month-separator-container",4,"ngIf"],["tabindex","0","crtKeyboardFocusContainer","",3,"entity","updatedEntity","tileColumnsConfig","tileViewConfig","tileEntityConfig","isTileReadOnly"],[1,"month-separator-container"],[1,"month-separator-text",3,"caption"],[1,"no-data-container"],[3,"config"],[1,"no-data-label",3,"caption"],["labelType","caption",1,"fill-action-label",3,"caption"],[1,"no-data-container","no-data-by-filter-container"],[3,"image","title","subhead"],["crtObserveElementInViewport","",3,"crtObserveElementInViewportStateChange"],[3,"isShownFilters"]],template:function(n,i){if(n&1&&(e.\u0275\u0275template(0,hn,3,1,"ng-container",2)(1,vn,12,10,"div",3)(2,En,3,1,"ng-container",2)(3,In,6,4,"div",4),e.\u0275\u0275elementStart(4,"div",5),e.\u0275\u0275template(5,Sn,1,0,"div",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,Fn,1,1,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)),n&2){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("ngIf",i.toolsTemplates==null?null:i.toolsTemplates.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.quickFilterByEntityInitialItems.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.customFiltersTemplates==null?null:i.customFiltersTemplates.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!i.isLoading&&i.isViewConfigInited)("ngIfElse",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(i.timelineData==null?null:i.timelineData.length)>0)}},dependencies:[_t.B,d.NgForOf,d.NgIf,d.NgTemplateOutlet,qt.H,Z.V,en.w,tn.w,gt.c,nn.Q,on.d,Re.x,C,T,u.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{margin:0 1px}[_nghost-%COMP%]   .no-data-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding-top:150px}[_nghost-%COMP%]   .no-data-container.no-data-by-filter-container[_ngcontent-%COMP%]{padding-top:192px}[_nghost-%COMP%]   #timeline-no-data-animation[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .fill-action-label[_ngcontent-%COMP%]{padding-top:16px}[_nghost-%COMP%]   .timeline-tools-container[_ngcontent-%COMP%]{border-bottom:1px solid var(--crt-palette-border-700);margin-bottom:2em;padding-bottom:2em}[_nghost-%COMP%]   .filters-container[_ngcontent-%COMP%]{margin-bottom:16px;display:flex}[_nghost-%COMP%]   .filters-container[_ngcontent-%COMP%]:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}[_nghost-%COMP%]   .filters-container[_ngcontent-%COMP%]   .timeline-quick-filters[_ngcontent-%COMP%]{gap:16px;flex-wrap:wrap;align-items:center;width:70%;display:flex;row-gap:8px}[_nghost-%COMP%]   .filters-container[_ngcontent-%COMP%]   .timeline-quick-filters[_ngcontent-%COMP%]   .filter-item[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .filters-container[_ngcontent-%COMP%]   .right-filter-container[_ngcontent-%COMP%]{display:flex;align-items:baseline;margin-left:auto}[dir=rtl]   [_nghost-%COMP%]   .filters-container[_ngcontent-%COMP%]   .right-filter-container[_ngcontent-%COMP%]{margin-right:auto;margin-left:0}[_nghost-%COMP%]   .filters-container[_ngcontent-%COMP%]   .right-filter-container[_ngcontent-%COMP%]   .sort-container[_ngcontent-%COMP%]{margin:0 12px}[_nghost-%COMP%]   .filters-container[_ngcontent-%COMP%]   .right-filter-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{margin-right:16px}[_nghost-%COMP%]   .custom-filters-container[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .tiles-container[_ngcontent-%COMP%]:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}[_nghost-%COMP%]   .month-separator-container[_ngcontent-%COMP%]{margin-bottom:24px}"],changeDetection:0})}};(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Array)],h.prototype,"customFilters",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Array)],h.prototype,"tools",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",String),(0,s.__metadata)("design:paramtypes",[String])],h.prototype,"masterSchemaId",null),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",String),(0,s.__metadata)("design:paramtypes",[String])],h.prototype,"masterEntitySchemaName",null),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Object),(0,s.__metadata)("design:paramtypes",[Object])],h.prototype,"masterEntity",null),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Object)],h.prototype,"quickFilterByOwnerConfig",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Boolean)],h.prototype,"isTileReadOnly",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Array)],h.prototype,"filterValues",void 0),h=(0,s.__decorate)([(0,v.v)({type:"crt.Timeline",contentSlots:[{name:"tools",lazy:!0,input:!0},{name:"customFilters",lazy:!0,input:!0}]}),(0,dt.f)({toolbarConfig:{position:260,groupType:Nt.h.Components,hint:"Components.Timeline.Hint",icon:l(6117),defaultPropertyValues:{items:[],tools:[],customFilters:[],hideTools:!1,masterSchemaId:"$Id"},defaultLocalizableStrings:{caption:"Components.Timeline.Caption",label:"Components.Timeline.Caption"}},propertiesPanelComponentTypeName:"crt.TimelinePropertiesPanel",viewElementGroupType:pt.J.Components,typeCaption:"Components.Timeline.Caption",designControlConfig:{allowDesignContent:!0}}),(0,s.__metadata)("design:paramtypes",[e.Injector,I])],h);let y=class ve{static{this.\u0275fac=function(n){return new(n||ve)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ve,selectors:[["ts-base-timeline-label"]],inputs:{caption:"caption",value:"value"},decls:0,vars:0,template:function(n,i){},styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}"]})}};(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",String)],y.prototype,"caption",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",String)],y.prototype,"value",void 0),y=(0,s.__decorate)([(0,v.v)({type:"crt.BaseTimelineLabel",reuseStrategy:F.B.Reuse})],y);var kn=l(27252),j=l(38914),wn=l(8017),Dn=l(78027);const Vn=()=>({mode:"default"});let w=class ae extends y{get isDate(){return this.dataValueType===S.r.Date||this.dataValueType===S.r.DateTime}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(ae)))(i||ae)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ae,selectors:[["crt-timeline-label"]],inputs:{dataValueType:"dataValueType"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:6,vars:12,consts:[[1,"label-container","timeline-tile-label"],[1,"caption",3,"caption","labelType"],["crtReadMore","",1,"value",3,"innerHTML"]],template:function(n,i){n&1&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"crt-label",1)(2,"div",2),e.\u0275\u0275pipe(3,"smartDateTimeFormat"),e.\u0275\u0275pipe(4,"sanitizeHtml"),e.\u0275\u0275pipe(5,"bypassSecurityTrust"),e.\u0275\u0275elementEnd()),n&2&&(e.\u0275\u0275advance(),e.\u0275\u0275property("caption",i.caption)("labelType","caption"),e.\u0275\u0275advance(),e.\u0275\u0275property("innerHTML",i.isDate?e.\u0275\u0275pipeBind1(3,3,i.value):e.\u0275\u0275pipeBind2(5,8,e.\u0275\u0275pipeBind2(4,5,i.value,e.\u0275\u0275pureFunction0(11,Vn)),"html"),e.\u0275\u0275sanitizeHtml))},dependencies:[Z.V,kn.Z,j.O,wn.b,Dn.v],styles:[".label-container[_ngcontent-%COMP%]{margin-bottom:8px}.label-container[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{margin-top:4px}.label-container[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]:focus{outline:none}"]})}};(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Number)],w.prototype,"dataValueType",void 0),w=(0,s.__decorate)([(0,v.v)({type:"crt.TimelineLabel",reuseStrategy:F.B.Reuse})],w);var Tt=l(66446),Mt=l(91775),E=l(53703),Ln=l(80615);function Rn(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-link",7),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.openRecord())}),e.\u0275\u0275elementEnd()}if(o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("href",e.\u0275\u0275pipeBind1(1,3,n.value==null?null:n.value.href))("caption",n.value==null?null:n.value.displayValue)("underlining",n.value!=null&&n.value.primaryColorValue?"hover":"always")}}function Nn(o,t){o&1&&e.\u0275\u0275elementContainer(0)}function Bn(o,t){if(o&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Nn,1,0,"ng-container",9),e.\u0275\u0275elementContainerEnd()),o&2){e.\u0275\u0275nextContext(2);const n=e.\u0275\u0275reference(3);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)}}function jn(o,t){o&1&&e.\u0275\u0275elementContainer(0)}function Hn(o,t){if(o&1&&e.\u0275\u0275template(0,jn,1,0,"ng-container",9),o&2){e.\u0275\u0275nextContext(2);const n=e.\u0275\u0275reference(8);e.\u0275\u0275property("ngTemplateOutlet",n)}}function An(o,t){if(o&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"crt-chip",8),e.\u0275\u0275template(2,Bn,2,1,"ng-container",6)(3,Hn,1,1,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),o&2){const n=e.\u0275\u0275reference(4),i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("color",i.value.primaryColorValue),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.hasEntityEditPage)("ngIfElse",n)}}function Qn(o,t){o&1&&e.\u0275\u0275elementContainer(0)}function Un(o,t){if(o&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Qn,1,0,"ng-container",9),e.\u0275\u0275elementContainerEnd()),o&2){e.\u0275\u0275nextContext(2);const n=e.\u0275\u0275reference(3);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)}}function Kn(o,t){if(o&1&&e.\u0275\u0275template(0,Un,2,1,"ng-container",6),o&2){const n=e.\u0275\u0275nextContext(),i=e.\u0275\u0275reference(8);e.\u0275\u0275property("ngIf",n.hasEntityEditPage)("ngIfElse",i)}}function Gn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",10),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(n.value==null?null:n.value.displayValue)}}let O=class le extends pe.K{set value(t){if(t){this._value=t;const n={entityName:t.entityName,recordId:t.recordId};Tt.a.hasEntityEditPage(n).then(i=>{this.hasEntityEditPage=i})}}get value(){return this._value}openRecord(){var t=this;return(0,U.A)(function*(){const n={type:"crt.UpdateRecordRequest",entityName:t._value.entityName,recordId:t._value.recordId,$context:null};yield Mt.t.instance.process(n)})()}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(le)))(i||le)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:le,selectors:[["crt-timeline-lookup"]],inputs:{caption:"caption",value:"value"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:9,vars:4,consts:[["linkContent",""],["notColored",""],["entityCaption",""],["plainValue",""],[1,"lookup-container","timeline-tile-label"],[1,"caption",3,"caption","labelType"],[4,"ngIf","ngIfElse"],["mode","'preventDefault'",1,"value",3,"clicked","href","caption","underlining"],[3,"color"],[4,"ngTemplateOutlet"],[1,"value"]],template:function(n,i){if(n&1&&(e.\u0275\u0275elementStart(0,"div",4),e.\u0275\u0275element(1,"crt-label",5),e.\u0275\u0275template(2,Rn,2,5,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(4,An,5,3,"ng-container",6)(5,Kn,1,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(7,Gn,2,1,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),n&2){const a=e.\u0275\u0275reference(6);e.\u0275\u0275advance(),e.\u0275\u0275property("caption",i.caption)("labelType","caption"),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",i.value==null?null:i.value.primaryColorValue)("ngIfElse",a)}},dependencies:[d.NgIf,d.NgTemplateOutlet,Z.V,E.h,Ln.j,d.AsyncPipe],styles:[".lookup-container[_ngcontent-%COMP%]{margin-bottom:8px}.lookup-container[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%], .lookup-container[_ngcontent-%COMP%]   crt-chip[_ngcontent-%COMP%]{margin-top:4px;width:-moz-fit-content;width:fit-content}.lookup-container[_ngcontent-%COMP%]   crt-chip[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{margin-top:0}.lookup-container[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]:focus{outline:none}"]})}};(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",String)],O.prototype,"caption",void 0),(0,s.__decorate)([(0,p.k)(),(0,s.__metadata)("design:type",Object),(0,s.__metadata)("design:paramtypes",[Object])],O.prototype,"value",null),O=(0,s.__decorate)([(0,v.v)({type:"crt.TimelineLookup",reuseStrategy:F.B.Reuse})],O);var zn=l(6530),D=l(20405);function $n(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-link",10),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onLinkClick(a.entity.schemaName,a.entity.entityId))}),e.\u0275\u0275elementEnd()}if(o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("caption",n.getPrimaryColumnDisplayValue(n.entity.columns)),e.\u0275\u0275property("href",n.entityLinks[n.entity.schemaName])}}function Wn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(n.getPrimaryColumnDisplayValue(n.entity.columns))}}function Zn(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"crt-link",11),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onLinkClick("Contact",a.entity.author.value))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(2,"div",12),e.\u0275\u0275elementContainerEnd()}if(o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("caption",n.entity.author.displayValue),e.\u0275\u0275property("href",n.entityLinks.Contact)}}let f=class Te{set entity(t){t&&(this._entity=t,this.buildEntityLinks())}get entity(){return this._entity}set isTileReadOnly(t){this._isTileReadOnly=t}get isTileReadOnly(){return this._isTileReadOnly}get emptyGuid(){return zn.To}constructor(t){this.injector=t,this.skeletonStyles={height:"32px","margin-top":"8px"},this.entityLinks=[],this._recordUrlCreator=this.injector.get(de.k),this.changeDetectorRef=this.injector.get(e.ChangeDetectorRef)}_getDisplayValue(t){return t?.displayValue||t?.value}buildEntityLinks(){this.buildEntityLink(this.entity.schemaName,this.entity.entityId),this.buildEntityLink("Contact",this.entity.author?.value?.toString())}getPrimaryColumnDisplayValue(t){const n=t.find(i=>i.columnName===this.entity.displayColumnName);return this._getDisplayValue(n?.columnValue)}getEntityColumnValue(t){return this.entity.columns.find(i=>i.columnName===t)?.columnValue.value}getEntityColumnImageValue(t){return this.entity.columns.find(i=>i.columnName===t)?.columnValue.primaryImageValue}getEntityColumnDisplayValue(t){const n=this.entity.columns.find(i=>i.columnName===t);return this._getDisplayValue(n?.columnValue)}buildEntityLink(t,n,i=null){const a=i||t;window.Terrasoft?.isAngularHost?this._recordUrlCreator.getUrl({entityName:t,recordId:n}).then(r=>{this.entityLinks[a]=r,this.changeDetectorRef.detectChanges()}):(this.entityLinks[a]=(0,K.TX)(t,n),this.changeDetectorRef.detectChanges())}ngOnInit(){if(this.entity){const t={entityName:this.entity.schemaName,recordId:this.entity.entityId};Tt.a.hasEntityEditPage(t).then(n=>{this.hasEntityEditPage=n,this.changeDetectorRef.detectChanges()})}}onLinkClick(t,n){return(0,U.A)(function*(){const i={type:"crt.UpdateRecordRequest",entityName:t,recordId:n,$context:null};yield Mt.t.instance.process(i)})()}static{this.\u0275fac=function(n){return new(n||Te)(e.\u0275\u0275directiveInject(e.Injector))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Te,selectors:[["crt-timeline-tile-base-head"]],inputs:{entity:"entity",tileViewConfig:"tileViewConfig",tileEntityConfig:"tileEntityConfig",isTileReadOnly:"isTileReadOnly"},decls:14,vars:8,consts:[["entityCaption",""],[1,"base-head","tile-head"],[1,"object-caption-container"],[1,"icon-container"],["tabindex","-1",3,"tileKey","tileIconId"],[1,"object-caption"],["mode","'preventDefault'",3,"href","caption","clicked",4,"ngIf","ngIfElse"],[1,"sub-title"],[4,"ngIf"],[1,"object-date"],["mode","'preventDefault'",3,"clicked","href","caption"],["mode","'preventDefault'",1,"author",3,"clicked","href","caption"],[1,"separator"]],template:function(n,i){if(n&1&&(e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"div",3),e.\u0275\u0275element(3,"crt-entity-icon",4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",5),e.\u0275\u0275template(5,$n,1,2,"crt-link",6)(6,Wn,2,1,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(8,"div",7),e.\u0275\u0275template(9,Zn,3,2,"ng-container",8),e.\u0275\u0275elementStart(10,"div",9)(11,"span"),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"smartDateTimeFormat"),e.\u0275\u0275elementEnd()()()()()()),n&2){const a=e.\u0275\u0275reference(7);e.\u0275\u0275advance(3),e.\u0275\u0275property("tileKey",i.entity.tileEntityName)("tileIconId",i.tileEntityConfig==null?null:i.tileEntityConfig.iconId),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.hasEntityEditPage)("ngIfElse",a),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",i.entity.author==null?null:i.entity.author.displayValue),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(13,6,i.entity.date))}},dependencies:[d.NgIf,E.h,D.N,j.O],styles:[".tile-head[_ngcontent-%COMP%]{margin-bottom:8px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]{display:flex}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{display:inline-block;height:32px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{display:inline-flex;align-items:baseline;margin:0;margin-inline-start:16px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .word-separator[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{display:flex;margin-inline-start:48px;margin-top:-12px;gap:8px}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:4px;width:0px;height:12px}.tile-head.base-head[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{flex-direction:column}.tile-head.base-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{margin-inline-start:0;margin-top:0}.tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}.tile-body.tile-body-margin-top[_ngcontent-%COMP%]{margin-top:8px}.recipient[_ngcontent-%COMP%]{border-radius:8px;padding:0 8px}.toggle-button[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer}.toggle-button[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin:auto 4px auto 0}"],changeDetection:0})}};f=(0,s.__decorate)([P("Base",[]),(0,s.__metadata)("design:paramtypes",[e.Injector])],f);const he={Incoming:"1d96a65f-2131-4916-8825-2d142b1000b2",Outgoing:"53f71b5f-7e17-4cf5-bf14-6a59212db422"};let X=class Me extends f{constructor(t,n){super(n),this._translateService=t,this._injector=n}_getCallOperatorData(){return{href:this.entityLinks.ContactCaller,caption:this.entity.author.displayValue,linkClick:this.entity.author.value}}_getCallRecipientData(){return{href:this.entityLinks.ContactRecipient,caption:this.getEntityColumnDisplayValue("Contact.Name"),linkClick:this.getEntityColumnDisplayValue("Contact.Id")}}formatCustomValue(t,n){return t==="Duration"?`${n} ${this._translateService.instant("Timeline.TileHeads.Call.Sec")}`:n}buildEntityLinks(){super.buildEntityLinks(),this.buildEntityLink("Contact",this.entity.author.value,"ContactCaller"),this.buildEntityLink("Contact",this.getEntityColumnDisplayValue("Contact.Id"),"ContactRecipient")}getCalledFrom(){return this.getEntityColumnValue("Direction.Id")===he.Incoming?this._getCallRecipientData():this._getCallOperatorData()}getCalledTo(){return this.getEntityColumnValue("Direction.Id")===he.Outgoing?this._getCallRecipientData():this._getCallOperatorData()}static{this.\u0275fac=function(n){return new(n||Me)(e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(e.Injector))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Me,selectors:[["crt-timeline-tile-call-head"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:18,vars:19,consts:[[1,"tile-head"],[1,"object-caption-container"],[1,"icon-container"],[3,"tileKey","photoImageId","authorName","authorId","tileIconId"],[1,"object-caption"],["mode","'preventDefault'",3,"clicked","href","caption"],[1,"word-separator"],[1,"recipient","recipient-label"],[1,"sub-title"],[1,"separator"],[1,"date"]],template:function(n,i){n&1&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275element(3,"crt-entity-icon",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",4)(5,"crt-link",5),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick("Contact",i.getCalledFrom().linkClick)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"span",6),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",7)(10,"crt-link",5),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick("Contact",i.getCalledTo().linkClick)}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(11,"div",8)(12,"crt-link",5),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick(i.entity.schemaName,i.entity.entityId)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"div",9),e.\u0275\u0275elementStart(15,"span",10),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"smartDateTimeFormat"),e.\u0275\u0275elementEnd()()()),n&2&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("tileKey",i.entity.tileEntityName)("photoImageId",(i.entity.author==null?null:i.entity.author.primaryImageValue)||i.emptyGuid)("authorName",i.entity.author==null?null:i.entity.author.displayValue)("authorId",i.entity.author==null?null:i.entity.author.value)("tileIconId",i.tileEntityConfig==null?null:i.tileEntityConfig.iconId),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("caption",i.getCalledFrom().caption),e.\u0275\u0275property("href",i.getCalledFrom().href),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,13,"Timeline.TileHeads.Call.Called")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("caption",i.getCalledTo().caption),e.\u0275\u0275property("href",i.getCalledTo().href),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("caption",e.\u0275\u0275pipeBind1(13,15,"Timeline.TileHeads.Call.DetailsLinkCaption")),e.\u0275\u0275property("href",i.entityLinks[i.entity.schemaName]),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,17,i.entity.date)))},dependencies:[E.h,D.N,u.TranslatePipe,j.O],styles:[".tile-head[_ngcontent-%COMP%]{margin-bottom:8px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]{display:flex}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{display:inline-block;height:32px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{display:inline-flex;align-items:baseline;margin:0;margin-inline-start:16px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .word-separator[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{display:flex;margin-inline-start:48px;margin-top:-12px;gap:8px}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:4px;width:0px;height:12px}.tile-head.base-head[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{flex-direction:column}.tile-head.base-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{margin-inline-start:0;margin-top:0}.tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}.tile-body.tile-body-margin-top[_ngcontent-%COMP%]{margin-top:8px}.recipient[_ngcontent-%COMP%]{border-radius:8px;padding:0 8px}.toggle-button[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer}.toggle-button[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin:auto 4px auto 0}"],changeDetection:0})}};X=(0,s.__decorate)([P("Call",["Contact.Id","Contact.Name","Direction.Id"]),(0,s.__metadata)("design:paramtypes",[u.TranslateService,e.Injector])],X);var Et=l(59969),z;(function(o){o.FacebookMessenger="50491c6c-d82b-4b86-b38c-99262d11a5ac",o.Telegram="645170ab-c67a-4dcc-9def-c0e5236bdfe0",o.WhatsApp="1398dc73-b428-4e21-b97a-c1bb6b4bc621"})(z||(z={}));var Xn=l(45328);const Jn=o=>({"hide-class":o});function Yn(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",17)(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.getEntityColumnDisplayValue("ChatPreview"))}}function qn(o,t){if(o&1&&e.\u0275\u0275element(0,"crt-skeleton-loader",18),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("styles",n.skeletonStyles)}}function ei(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",19)(1,"crt-omnichannel-messaging-chat-history",20),e.\u0275\u0275listener("messagesLoaded",function(){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.handleMessagesLoaded())})("contactClick",function(a){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.contactClicked(a.contactId))}),e.\u0275\u0275elementEnd()()}if(o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(2,Jn,!n.showFullChat)),e.\u0275\u0275advance(),e.\u0275\u0275property("chatid",n.entity.id)}}let J=class Ee extends f{constructor(t){super(t),this._injector=t,this.isLoading=!1,this.showFullChat=!1,this.isChatMessagesInitialized=!1,this._window=this.injector.get(Et.ZP)}buildEntityLinks(){super.buildEntityLinks(),this.buildEntityLink("Contact",this.getEntityColumnValue("Contact.Id"),"ChatContact"),this.buildEntityLink("Contact",this.getEntityColumnValue("Operator.Contact.Id"),"ChatOperator")}getChatProviderIconName(t){switch(t){case z.Telegram:return"telegram";case z.FacebookMessenger:return"facebook";case z.WhatsApp:return"whatsapp";default:return"omnichat"}}toggleChat(){this.showFullChat=!this.showFullChat,this.isLoading=this.showFullChat}handleMessagesLoaded(){this.isLoading=!1,this.isChatMessagesInitialized=!0}contactClicked(t){const n=(0,K.TX)("Contact",t);this._window.open(n,"_self")}static{this.\u0275fac=function(n){return new(n||Ee)(e.\u0275\u0275directiveInject(e.Injector))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ee,selectors:[["crt-timeline-tile-chat-head"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:25,vars:26,consts:[[1,"tile-head"],[1,"object-caption-container"],[1,"icon-container"],[3,"tileKey","photoImageId","authorName","authorId","tileIconId"],[1,"object-caption"],["mode","'preventDefault'",3,"clicked","href","caption"],[1,"word-separator"],[1,"recipient","recipient-label"],[1,"sub-title"],[1,"separator"],[1,"date"],[1,"tile-body","tile-body-margin-top"],["class","tile-body-text",4,"ngIf"],[3,"styles",4,"ngIf"],["class","chat-messages-container",3,"ngClass",4,"ngIf"],[1,"toggle-container","toggle-button",3,"click"],["iconPosition","left-icon","size","small","displayType","text","color","default",3,"clicked","icon","caption"],[1,"tile-body-text"],[3,"styles"],[1,"chat-messages-container",3,"ngClass"],[1,"timeline-chat-history",3,"messagesLoaded","contactClick","chatid"]],template:function(n,i){n&1&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275element(3,"crt-entity-icon",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",4)(5,"crt-link",5),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick("Contact",i.getEntityColumnValue("Contact.Id"))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"span",6),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",7)(10,"crt-link",5),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick("Contact",i.getEntityColumnValue("Operator.Contact.Id"))}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(11,"div",8)(12,"crt-link",5),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick(i.entity.schemaName,i.entity.entityId)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"div",9),e.\u0275\u0275elementStart(15,"span",10),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"smartDateTimeFormat"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",11),e.\u0275\u0275template(19,Yn,3,1,"div",12)(20,qn,1,1,"crt-skeleton-loader",13)(21,ei,2,4,"div",14),e.\u0275\u0275elementStart(22,"div",15),e.\u0275\u0275listener("click",function(){return i.toggleChat()}),e.\u0275\u0275elementStart(23,"crt-button",16),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275listener("clicked",function(){return i.toggleChat()}),e.\u0275\u0275elementEnd()()()()),n&2&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("tileKey",i.getChatProviderIconName(i.getEntityColumnValue("Channel.Provider.Id")))("photoImageId",i.getEntityColumnValue("Contact.Photo.Id")||i.emptyGuid)("authorName",i.getEntityColumnDisplayValue("Contact.Name"))("authorId",i.getEntityColumnValue("Contact.Id"))("tileIconId",i.tileEntityConfig==null?null:i.tileEntityConfig.iconId),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("caption",i.getEntityColumnDisplayValue("Contact.Name")),e.\u0275\u0275property("href",i.entityLinks.ChatContact),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,18,"Timeline.TileHeads.Chat.ChatWith")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("caption",i.getEntityColumnDisplayValue("Operator.Name")),e.\u0275\u0275property("href",i.entityLinks.ChatOperator),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("caption",e.\u0275\u0275pipeBind1(13,20,"Timeline.TileHeads.Chat.DetailsLinkCaption")),e.\u0275\u0275property("href",i.entityLinks[i.entity.schemaName]),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,22,i.entity.date)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!i.showFullChat),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.isLoading&&!i.isChatMessagesInitialized),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.showFullChat||i.isChatMessagesInitialized),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("icon",i.showFullChat?"arrow-up-recipients":"arrow-down-recipients"),e.\u0275\u0275property("caption",e.\u0275\u0275pipeBind1(24,24,i.showFullChat?"Timeline.TileHeads.Chat.Hide":"Timeline.TileHeads.Chat.Show")))},dependencies:[_t.B,d.NgClass,d.NgIf,E.h,G.W,Xn.D,D.N,u.TranslatePipe,j.O],styles:[".tile-head[_ngcontent-%COMP%]   .toggle-container[_ngcontent-%COMP%]{margin-top:8px}.tile-head[_ngcontent-%COMP%]   .hide-class[_ngcontent-%COMP%]{display:none}.tile-head[_ngcontent-%COMP%]   .tile-body-text[_ngcontent-%COMP%]{max-height:62px;overflow-y:hidden;text-overflow:ellipsis;-webkit-line-clamp:3;-webkit-box-orient:vertical;display:-webkit-box}.tile-head[_ngcontent-%COMP%]   .chat-messages-container[_ngcontent-%COMP%]{max-height:350px;overflow-y:scroll}",".tile-head[_ngcontent-%COMP%]{margin-bottom:8px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]{display:flex}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{display:inline-block;height:32px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{display:inline-flex;align-items:baseline;margin:0;margin-inline-start:16px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .word-separator[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{display:flex;margin-inline-start:48px;margin-top:-12px;gap:8px}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:4px;width:0px;height:12px}.tile-head.base-head[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{flex-direction:column}.tile-head.base-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{margin-inline-start:0;margin-top:0}.tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}.tile-body.tile-body-margin-top[_ngcontent-%COMP%]{margin-top:8px}.recipient[_ngcontent-%COMP%]{border-radius:8px;padding:0 8px}.toggle-button[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer}.toggle-button[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin:auto 4px auto 0}"],changeDetection:0})}};J=(0,s.__decorate)([P("OmniChat",["Contact.Id","Contact.Name","Contact.Photo.Id","Operator.Contact.Id","Operator.Name","ChatPreview","Channel.Provider.Id"]),(0,s.__metadata)("design:paramtypes",[e.Injector])],J);var Ot=l(54918),xt=l(26628),ti=l(59834);let Y=class Oe extends f{constructor(t,n,i){super(i),this._fileIconService=t,this._fileApiService=n,this._injector=i,this._sysFileUrl="/rest/FileService/Download"}get fileSize(){return parseInt(this.getEntityColumnDisplayValue("Size"))}get fileUrl(){return(0,K.uJ)((0,K.cI)(),this._sysFileUrl,this.entity.schemaName,this.entity.entityId)}get fileIcon(){return this._fileIconService.getFileIcon(this.getEntityColumnDisplayValue("Name"))}download(){this._fileApiService.download(this.fileUrl,this.getEntityColumnDisplayValue("Name"))}buildEntityLinks(){this.buildEntityLink("Contact",this.entity.author.value)}static{this.\u0275fac=function(n){return new(n||Oe)(e.\u0275\u0275directiveInject(Ot.H),e.\u0275\u0275directiveInject(xt.k),e.\u0275\u0275directiveInject(e.Injector))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Oe,selectors:[["crt-timeline-tile-file-head"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:24,vars:16,consts:[[1,"tile-head"],[1,"object-caption-container"],[1,"icon-container"],[3,"tileKey","tileIconId"],[1,"object-caption"],["mode","'preventDefault'",3,"clicked","href","caption"],[1,"word-separator"],[1,"sub-title"],[1,"file-word-separator"],[1,"tile-body"],[1,"file-caption-container"],[1,"file-caption"],[1,"file-icon-container"],["matSuffix","",1,"file-icon",3,"svgIcon"],[1,"file-link",3,"clicked","href","caption"]],template:function(n,i){n&1&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275element(3,"crt-entity-icon",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",4)(5,"crt-link",5),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick("Contact",i.entity.author.value)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"span",6),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div",7)(10,"span"),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"memoryFormat"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"span",8),e.\u0275\u0275text(14,"|"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"span"),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"smartDateTimeFormat"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",9)(19,"div",10)(20,"div",11)(21,"div",12),e.\u0275\u0275element(22,"mat-icon",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"crt-link",14),e.\u0275\u0275listener("clicked",function(){return i.download()}),e.\u0275\u0275elementEnd()()()()()),n&2&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("tileKey",i.entity.tileEntityName)("tileIconId",i.tileEntityConfig==null?null:i.tileEntityConfig.iconId),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("caption",i.entity.author.displayValue),e.\u0275\u0275property("href",i.entityLinks.Contact),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,10,"Timeline.TileHeads.File.AddedFile")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,12,i.fileSize)),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,14,i.entity.date)),e.\u0275\u0275advance(6),e.\u0275\u0275property("svgIcon",i.fileIcon),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("caption",i.getEntityColumnDisplayValue("Name")),e.\u0275\u0275property("href",i.fileUrl))},dependencies:[R.MatIcon,E.h,D.N,u.TranslatePipe,j.O,ti.l],styles:["[_nghost-%COMP%]   .tile-body[_ngcontent-%COMP%]{margin-top:8px}[_nghost-%COMP%]   .tile-body[_ngcontent-%COMP%]   .file-caption[_ngcontent-%COMP%]{display:inline-flex;gap:8px}[_nghost-%COMP%]   .file-icon-container[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:4px;border:1px solid}[_nghost-%COMP%]   .file-icon[_ngcontent-%COMP%]{width:16px;height:16px;padding:8px}[_nghost-%COMP%]   .file-link[_ngcontent-%COMP%]{margin:auto 0}",".tile-head[_ngcontent-%COMP%]{margin-bottom:8px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]{display:flex}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{display:inline-block;height:32px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{display:inline-flex;align-items:baseline;margin:0;margin-inline-start:16px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .word-separator[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{display:flex;margin-inline-start:48px;margin-top:-12px;gap:8px}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:4px;width:0px;height:12px}.tile-head.base-head[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{flex-direction:column}.tile-head.base-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{margin-inline-start:0;margin-top:0}.tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}.tile-body.tile-body-margin-top[_ngcontent-%COMP%]{margin-top:8px}.recipient[_ngcontent-%COMP%]{border-radius:8px;padding:0 8px}.toggle-button[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer}.toggle-button[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin:auto 4px auto 0}"],changeDetection:0})}};Y=(0,s.__decorate)([P("SysFile",["Name","Size"]),(0,s.__metadata)("design:paramtypes",[Ot.H,xt.k,e.Injector])],Y);var ni=l(2106),bt=l(72615),Pt=l(67159),It=l(94404);class H{constructor(t,n){this.el=t,this.renderer=n,this.tabIndexValue="0"}ngAfterViewInit(){const t=this.el.nativeElement.querySelector(".feed-item-content-desc");t&&(this.renderer.setAttribute(t,"tabIndex",this.tabIndexValue),this.renderer.addClass(t,"no-outline"))}static{this.\u0275fac=function(n){return new(n||H)(e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(e.Renderer2))}}static{this.\u0275dir=e.\u0275\u0275defineDirective({type:H,selectors:[["","crtTimelineFeedTabIndex",""]],inputs:{tabIndexValue:"tabIndexValue"}})}}function ii(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"crt-feed-item",1),e.\u0275\u0275element(1,"crt-entity-icon",2)(2,"crt-skeleton-loader",3),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("item",n.message)("feedType",n.feedType)("schemaName",n.entity.schemaName)("useCustomPhoto",!0)("showMenuActionItems",!0)("isEditMode",n.isEditMode)("itemActionItems",n.itemActionItems)("allowExternalPost",n.getAllowExternalPosts())("isReadOnly",n.isTileReadOnly),e.\u0275\u0275advance(),e.\u0275\u0275property("tileKey",n.entity.tileEntityName)("photoImageId",(n.entity.author==null?null:n.entity.author.primaryImageValue)||n.emptyGuid)("authorName",n.entity.author.displayValue)("authorId",n.entity.author.value)("tileIconId",n.tileEntityConfig==null?null:n.tileEntityConfig.iconId),e.\u0275\u0275advance(),e.\u0275\u0275property("styles",n.skeletonStyles)}}let q=class xe extends f{set entity(t){if(t){super.entity=t;const n=this._formatFeedMessage();this.message={...this.message,...n},this.changeDetectorRef.detectChanges()}}get entity(){return super.entity}set isTileReadOnly(t){super.isTileReadOnly=t,this.changeDetectorRef.detectChanges()}get isTileReadOnly(){return super.isTileReadOnly}constructor(t,n,i){super(i),this._reactionService=t,this._translateService=n,this._reactionSubscription=null,this.isEditMode=!1,this.feedType=Pt.Q.Record,this.itemActionItems=[{caption:this._translateService.instant("Feed.Item.Edit"),type:"crt.MenuItem",name:"Edit",icon:"feed-edit",handleItemClick:()=>this.isEditMode=!0}]}_initTileFeedContent(){this._reactionSubscription?.unsubscribe(),this.message=this._formatFeedMessage(),this._reactionSubscription=this._reactionService.getUserMessagesReactions([this.getEntityColumnDisplayValue("Id")]).pipe((0,c.map)(t=>t&&t.length>0)).subscribe(t=>{this.message.ReactionsCounters[0].currentUserReacted=t,this.message={...this.message},this.changeDetectorRef.detectChanges()})}_formatFeedMessage(){return{Id:this.getEntityColumnDisplayValue("Id"),EntityId:this.entity.entityId,EntitySchemaName:this.getEntityColumnDisplayValue("EntitySchemaName"),EntitySchemaCaption:this.getEntityColumnDisplayValue("EntitySchemaCaption"),EntitySchemaUId:this.getEntityColumnDisplayValue("EntitySchemaUId"),Message:this.getEntityColumnDisplayValue("Message"),CommentCount:parseInt(this.getEntityColumnDisplayValue("CommentCount")),UserAccess:parseInt(this.getEntityColumnDisplayValue("UserAccess")),CreatedBy:this.entity.author,CreatedOn:this.entity.date,ReactionsCounters:[{type:ni.U.Like,count:parseInt(this.getEntityColumnDisplayValue("LikeCount"))}],FileSchemaName:"FeedFile",FileColumnName:"RecordId"}}ngOnInit(){this._initTileFeedContent()}buildEntityLinks(){}getAllowExternalPosts(){return!!this.tileViewConfig?.allowFeedExternalPost}static{this.\u0275fac=function(n){return new(n||xe)(e.\u0275\u0275directiveInject(bt.d),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(e.Injector))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:xe,selectors:[["crt-timeline-tile-feed"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["crtTimelineFeedTabIndex","",3,"item","feedType","schemaName","useCustomPhoto","showMenuActionItems","isEditMode","itemActionItems","allowExternalPost","isReadOnly",4,"ngIf"],["crtTimelineFeedTabIndex","",3,"item","feedType","schemaName","useCustomPhoto","showMenuActionItems","isEditMode","itemActionItems","allowExternalPost","isReadOnly"],["userPhoto","",3,"tileKey","photoImageId","authorName","authorId","tileIconId"],["skeletonLoader","",3,"styles"]],template:function(n,i){n&1&&e.\u0275\u0275template(0,ii,3,15,"crt-feed-item",0),n&2&&e.\u0275\u0275property("ngIf",i.message)},dependencies:[d.NgIf,G.W,It.G,D.N,H],styles:[".feed-item-content-desc[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .feed-item-content-user-head-actions-button{bottom:5px!important}.feed-item[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .feed-item-content[_ngcontent-%COMP%]{margin-top:0!important}",".tile-head[_ngcontent-%COMP%]{margin-bottom:8px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]{display:flex}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{display:inline-block;height:32px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{display:inline-flex;align-items:baseline;margin:0;margin-inline-start:16px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .word-separator[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{display:flex;margin-inline-start:48px;margin-top:-12px;gap:8px}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:4px;width:0px;height:12px}.tile-head.base-head[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{flex-direction:column}.tile-head.base-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{margin-inline-start:0;margin-top:0}.tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}.tile-body.tile-body-margin-top[_ngcontent-%COMP%]{margin-top:8px}.recipient[_ngcontent-%COMP%]{border-radius:8px;padding:0 8px}.toggle-button[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer}.toggle-button[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin:auto 4px auto 0}"],changeDetection:0})}};q=(0,s.__decorate)([P("Feed",["Id","EntitySchemaName","EntitySchemaCaption","EntitySchemaUId","Message","CommentCount","LikeCount"]),(0,s.__metadata)("design:paramtypes",[bt.d,u.TranslateService,e.Injector])],q);var oi=l(49973),St=l(65751),Ft=l(5240),ge=l(28399),_;(function(o){o.From="From",o.To="To",o.CC="CC"})(_||(_={}));class V{constructor(t){this._serviceUrl="/rest/TimelineEmailService",this._quotesCache=new Map,this._httpClient=t.get(ft.HttpClient)}_replaceCache(t,n,i){this._quotesCache=new Map;let a=i;t.timelineQuotes.forEach(r=>{r.isLastQuote=!1,this._quotesCache.set(a++,r)}),t.isLastQuote&&(this._quotesCache.get(Math.max(...this._quotesCache.keys())).isLastQuote=!0),this._quotesCacheEmailId=n}_tryGetFromCache(t,n){return t!==this._quotesCacheEmailId||!this._quotesCache||!this._quotesCache.has(n)?null:(0,c.of)(this._quotesCache.get(n))}getQuote(t,n){const i={emailId:t,quoteNumber:n},a=this._tryGetFromCache(t,n);return a||this._httpClient.post(`${this._serviceUrl}/GetQuotesList`,i).pipe((0,c.catchError)(()=>(0,c.of)(null)),(0,c.tap)(r=>r&&this._replaceCache(r,t,n)),(0,c.map)(r=>r?this._quotesCache.get(n):null))}static{this.\u0275fac=function(n){return new(n||V)(e.\u0275\u0275inject(e.Injector))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}function ai(o,t){if(o&1&&e.\u0275\u0275element(0,"crt-link",11),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("caption",n.getEntityColumnDisplayValue("SenderContact")||n.getEntityColumnDisplayValue("CreatedBy")),e.\u0275\u0275property("href",n.entityLinks.SenderContact||n.entityLinks.CreatedBy)}}function li(o,t){if(o&1&&e.\u0275\u0275element(0,"crt-link",11),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate1("href","mailto:",n.getEntityColumnDisplayValue("Sender"),""),e.\u0275\u0275propertyInterpolate("caption",n.getEntityColumnDisplayValue("Sender"))}}function ri(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",12),e.\u0275\u0275element(1,"crt-link",13),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate1("href","mailto:",n.extractEmail(n.getFirstRecipient()),""),e.\u0275\u0275propertyInterpolate("caption",n.getFirstRecipient())}}let A=class be extends f{set hasLoadableReadMore(t){this._hasLoadableReadMore=t,this.isQuotationMode===null&&(this.isQuotationMode=t)}get hasLoadableReadMore(){return this._hasLoadableReadMore}constructor(t,n,i,a,r){super(t),this.injector=t,this._domPurifier=n,this._translateService=i,this._messageChannelService=a,this._queryExecutor=r,this._recipientsSeparator=";",this._generatedAuthorId="F3ADBFF6-0275-5216-40DA-BA1A1DBC0B23",this._activitySchemaUId="C449D832-A4CC-4B01-B9D5-8A12C42A9F89",this._subscriptions=new c.Subscription,this._quoteNumber=2,this._hasLoadableReadMore=!1,this.feedType=Pt.Q.Record,this.isQuotationMode=null,this._subscribeMessageChannelEvents(),this._timelineEmailService=t.get(V)}_initData(){this._isDraft=(0,ge.isEmpty)(this.getEntityColumnDisplayValue("SendDate")),this.message=this._formatMessage(this.getEntityColumnDisplayValue("Body")),this.recipients=this._formatRecipients(),this.itemActionItems=this.getItemActionItems(),this.hasLoadableReadMore=!!this.getEntityColumnValue("IsReadMoreVisible")}_formatMessage(t){return t=this._domPurifier.sanitize(t,{FORBID_TAGS:["style"]}),{Id:this.entity.entityId,Message:t,CreatedOn:this.entity.date,FileSchemaName:"ActivityFile",FileColumnName:"Activity",UserAccess:this.entity.userAccess,EntitySchemaUId:this._activitySchemaUId,EntityId:this.entity.entityId}}_splitRecipients(t){return t?.replace("; ",";").split(this._recipientsSeparator).filter(n=>n.length>0&&n!==" ")}_formatRecipients(){const t=[];return t.push({emails:[this.getEntityColumnDisplayValue("Sender")],type:_.From}),t.push({emails:this._splitRecipients(this.getEntityColumnDisplayValue("Recepient")),type:_.To}),t.push({emails:this._splitRecipients(this.getEntityColumnDisplayValue("CopyRecepient")),type:_.CC}),t}_subscribeMessageChannelEvents(){this._subscriptions.add(this._messageChannelService.messageEvent$.pipe((0,c.filter)(t=>t.header.sender==="EmailPreview"),(0,c.map)(t=>{const n=t.body;return{emailId:n.id,content:n.content}}),(0,c.take)(1)).subscribe(({emailId:t,content:n})=>{this.entity?.entityId?.toLowerCase()===t?.toLowerCase()&&(this.message=this._formatMessage(n),this.changeDetectorRef.detectChanges())}))}_loadPreviewIfBodyEmpty(){if(this.entity.entityId&&(0,ge.isEmpty)(this.message.Message)){const t=new oi.s("EmailMetadata");t.addSchemaColumn("Preview"),t.filters.addSchemaColumnFilterWithParameter(mt.H.Equal,"Activity",this.entity.entityId),this._queryExecutor.executeSelectQuery(t).subscribe(n=>{const i=n?.[0]?.Preview;i&&(this.message=this._formatMessage(i),this.changeDetectorRef.detectChanges())})}}getItemActionItems(){return this._isDraft?[{caption:this._translateService.instant("MessageComposer.Email.ContinueEditing"),type:"crt.MenuItem",name:"ContinueEditing",icon:"pen",clicked:{request:"crt.EditDraftEmailComposerRequest",params:{recordId:this.entity?.entityId}}}]:[{caption:this._translateService.instant("MessageComposer.Email.Reply"),type:"crt.MenuItem",name:"Reply",icon:"reply-message",clicked:{request:"crt.ReplyEmailComposerRequest",params:{recordId:this.entity?.entityId}}},{caption:this._translateService.instant("MessageComposer.Email.ReplyAll"),type:"crt.MenuItem",name:"ReplyAll",icon:"reply-all-message",clicked:{request:"crt.ReplyAllEmailComposerRequest",params:{recordId:this.entity?.entityId}}},{caption:this._translateService.instant("MessageComposer.Email.Forward"),type:"crt.MenuItem",name:"Forward",icon:"forward-message",clicked:{request:"crt.ForwardEmailComposerRequest",params:{recordId:this.entity?.entityId}}}]}customVisibleItemActionsMenu(){return!0}loadMoreHandler(t){this._timelineEmailService.getQuote(t.item.EntityId,this._quoteNumber++).subscribe(n=>{t.item.Message=t.item.Message+n.content,this.hasLoadableReadMore=!1,n.isLastQuote||(this.changeDetectorRef.detectChanges(),this.hasLoadableReadMore=!0),this.changeDetectorRef.detectChanges()})}extractEmail(t){return t?t.substring(t.indexOf("<")+1,t.lastIndexOf(">"))||t:""}hasRecipient(){return this.recipients.find(t=>t.type===_.To)?.emails?.length>0}getFirstRecipient(){return this.recipients.find(t=>t.type===_.To).emails[0]}buildEntityLinks(){this._initData(),this._loadPreviewIfBodyEmpty(),this.buildEntityLink("Activity",this.entity.entityId),this.buildEntityLink("Contact",this.getEntityColumnValue("SenderContact")||this.getEntityColumnValue("Sender"),"SenderContact")}isDraftEmail(){return this._isDraft}getAuthorName(){return this.getEntityColumnDisplayValue("SenderContact")||this.getEntityColumnDisplayValue("Sender")||this.getEntityColumnDisplayValue("CreatedBy")}getAuthorId(){return this.getEntityColumnValue("SenderContact")||((0,ge.isEmpty)(this.getEntityColumnDisplayValue("Sender"))?this.getEntityColumnValue("CreatedBy"):this._generatedAuthorId)}ngOnDestroy(){this._subscriptions.unsubscribe()}static{this.\u0275fac=function(n){return new(n||be)(e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(Et.MV),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Ft.A),e.\u0275\u0275directiveInject(St.w))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:be,selectors:[["crt-timeline-tile-email"]],features:[e.\u0275\u0275ProvidersFeature([V]),e.\u0275\u0275InheritDefinitionFeature],decls:14,vars:27,consts:[["sender",""],["crtTimelineFeedTabIndex","",3,"readMoreClick","item","feedType","schemaName","useCustomPhoto","useCustomHead","disableLikesComments","showMenuActionItems","isDraftItem","itemActionItems","customVisibleItemActionsMenu","hasExternalLoadMore","isQuotationMode"],["userPhoto","",3,"tileKey","photoImageId","authorName","authorId","tileIconId"],["customHead",""],[1,"email-recipients-head"],["class","sender-label",3,"href","caption",4,"ngIf","ngIfElse"],[1,"mailed-caption"],["class","recipient recipient-label",4,"ngIf"],[3,"emailRecipients"],["customBody","","mode","'preventDefault'",1,"email-title",3,"clicked","href","caption"],["skeletonLoader","",3,"styles"],[1,"sender-label",3,"href","caption"],[1,"recipient","recipient-label"],[3,"href","caption"]],template:function(n,i){if(n&1){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-feed-item",1),e.\u0275\u0275listener("readMoreClick",function(m){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(i.loadMoreHandler(m))}),e.\u0275\u0275element(1,"crt-entity-icon",2),e.\u0275\u0275elementStart(2,"div",3)(3,"div",4),e.\u0275\u0275template(4,ai,1,2,"crt-link",5)(5,li,1,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(7,"span",6),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,ri,2,3,"div",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"crt-timeline-tile-email-recipients",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"crt-link",9),e.\u0275\u0275listener("clicked",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(i.onLinkClick(i.entity.schemaName,i.entity.entityId))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"crt-skeleton-loader",10),e.\u0275\u0275elementEnd()}if(n&2){const a=e.\u0275\u0275reference(6);e.\u0275\u0275property("item",i.message)("feedType",i.feedType)("schemaName",i.entity.schemaName)("useCustomPhoto",!0)("useCustomHead",!0)("disableLikesComments",!0)("showMenuActionItems",!0)("isDraftItem",i.isDraftEmail())("itemActionItems",i.itemActionItems)("customVisibleItemActionsMenu",i.customVisibleItemActionsMenu)("hasExternalLoadMore",i.hasLoadableReadMore)("isQuotationMode",i.isQuotationMode),e.\u0275\u0275advance(),e.\u0275\u0275property("tileKey",i.entity.tileEntityName)("photoImageId",i.getEntityColumnImageValue("SenderContact")||i.emptyGuid)("authorName",i.getAuthorName())("authorId",i.getAuthorId())("tileIconId",i.tileEntityConfig==null?null:i.tileEntityConfig.iconId),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",i.getEntityColumnValue("Sender")==="")("ngIfElse",a),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,25,"Timeline.TileHeads.Email.MailedTo")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.hasRecipient()),e.\u0275\u0275advance(),e.\u0275\u0275property("emailRecipients",i.recipients),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("caption",i.getEntityColumnDisplayValue("Title")),e.\u0275\u0275property("href",i.entityLinks.Activity),e.\u0275\u0275advance(),e.\u0275\u0275property("styles",i.skeletonStyles)}},styles:["[_nghost-%COMP%]     .feed-item .inner{width:calc(100% - 24px)}[_nghost-%COMP%]     .feed-item .inner .feed-item-content-user-head-posted{width:auto;max-width:calc(100% - 48px);min-height:24px}[_nghost-%COMP%]     .feed-item .inner .feed-item-content-desc{margin-top:0;overflow-x:scroll}[_nghost-%COMP%]     .feed-item .inner .feed-item-content-user-desc{margin-top:-4px}[_nghost-%COMP%]     .feed-item .inner .feed-item-content{margin-top:0}[_nghost-%COMP%]     .feed-item.feed-item-post{margin-bottom:24px}[_nghost-%COMP%]     .feed-item-content-desc.no-outline{outline:none}[_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]{display:inline-flex;position:relative;bottom:4px;max-width:calc(100% - 24px)}[_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]   .recipient[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-right:8px}[_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]   .mailed-caption[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase;min-width:-moz-fit-content;min-width:fit-content}[_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]   .sender-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]   .recipient-label[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .email-title[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}",".tile-head[_ngcontent-%COMP%]{margin-bottom:8px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]{display:flex}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{display:inline-block;height:32px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{display:inline-flex;align-items:baseline;margin:0;margin-inline-start:16px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .word-separator[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{display:flex;margin-inline-start:48px;margin-top:-12px;gap:8px}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:4px;width:0px;height:12px}.tile-head.base-head[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{flex-direction:column}.tile-head.base-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{margin-inline-start:0;margin-top:0}.tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}.tile-body.tile-body-margin-top[_ngcontent-%COMP%]{margin-top:8px}.recipient[_ngcontent-%COMP%]{border-radius:8px;padding:0 8px}.toggle-button[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer}.toggle-button[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin:auto 4px auto 0}"],changeDetection:0})}};A=(0,s.__decorate)([P("Email",["Title","Body","Sender","Recepient","CopyRecepient","SendDate","SenderContact"]),(0,s.__metadata)("design:paramtypes",[e.Injector,Function,u.TranslateService,Ft.A,St.w])],A);function si(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.toggleDetails())}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" +",n.additionalRecipientsAmount,`
`)}}function ci(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",12),e.\u0275\u0275element(1,"crt-link",13),e.\u0275\u0275elementEnd()),o&2){const n=t.$implicit,i=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate1("href","mailto:",i.extractEmail(n),""),e.\u0275\u0275propertyInterpolate("caption",n)}}function mi(o,t){if(o&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",9),e.\u0275\u0275element(2,"crt-label",10),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div"),e.\u0275\u0275template(5,ci,2,3,"div",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),o&2){const n=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("caption",e.\u0275\u0275pipeBind1(3,2,i.getTranslateKey(n.type))),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.emails)}}function di(o,t){if(o&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,mi,6,4,"ng-container",8),e.\u0275\u0275elementContainerEnd()),o&2){const n=t.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",(n.emails==null?null:n.emails.length)>0)}}function pi(o,t){if(o&1&&(e.\u0275\u0275elementStart(0,"div",6),e.\u0275\u0275template(1,di,2,1,"ng-container",7),e.\u0275\u0275elementEnd()),o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.emailRecipients)}}class L extends A{constructor(){super(...arguments),this._translationBaseKey="Timeline.TileHeads.Email.",this.expandDetails=!1}getTranslateKey(t){return this._translationBaseKey+t}toggleDetails(){this.expandDetails=!this.expandDetails}get additionalRecipientsAmount(){return this.emailRecipients?.find(t=>t.type===_.To)?.emails?.length+this.emailRecipients?.find(t=>t.type===_.CC)?.emails?.length-1}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(L)))(i||L)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:L,selectors:[["crt-timeline-tile-email-recipients"]],inputs:{emailRecipients:"emailRecipients"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:6,consts:[["class","recipient recipients-amount",3,"click",4,"ngIf"],["tabindex","0","role","button",1,"toggle-button",3,"click","keydown.enter"],[1,"arrow-icon",3,"svgIcon"],[1,"toggle-caption"],["class","main-container",4,"ngIf"],[1,"recipient","recipients-amount",3,"click"],[1,"main-container"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"label-container"],[1,"caption",3,"caption"],["class","recipient recipient-label recipient-cc",4,"ngFor","ngForOf"],[1,"recipient","recipient-label","recipient-cc"],[3,"href","caption"]],template:function(n,i){n&1&&(e.\u0275\u0275template(0,si,2,1,"div",0),e.\u0275\u0275elementStart(1,"div",1),e.\u0275\u0275listener("click",function(){return i.toggleDetails()})("keydown.enter",function(){return i.toggleDetails()}),e.\u0275\u0275element(2,"mat-icon",2),e.\u0275\u0275elementStart(3,"span",3),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,pi,2,1,"div",4)),n&2&&(e.\u0275\u0275property("ngIf",i.additionalRecipientsAmount>0&&!i.expandDetails),e.\u0275\u0275advance(2),e.\u0275\u0275property("svgIcon",i.expandDetails?"arrow-up-recipients":"arrow-down-recipients"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,4,i.expandDetails?"Timeline.TileHeads.Email.Hide":"Timeline.TileHeads.Email.Details")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.expandDetails))},dependencies:[d.NgForOf,d.NgIf,R.MatIcon,Z.V,E.h,u.TranslatePipe],styles:["[_nghost-%COMP%]   .main-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:max-content auto;grid-template-rows:max-content auto;margin-bottom:8px;position:relative;width:800px;margin-left:-800px;left:800px}[dir=rtl]   [_nghost-%COMP%]   .main-container[_ngcontent-%COMP%]{margin-right:-800px;right:800px}[_nghost-%COMP%]   .caption[_ngcontent-%COMP%]{width:auto;display:inline-block;margin-right:8px}[_nghost-%COMP%]   .recipient[_ngcontent-%COMP%]{display:inline-block;margin-right:4px}[_nghost-%COMP%]   .recipient-cc[_ngcontent-%COMP%]{margin-bottom:4px}[_nghost-%COMP%]   .recipients-amount[_ngcontent-%COMP%]{display:inline-block;position:relative;top:-4px;cursor:pointer}","[_nghost-%COMP%]     .feed-item .inner{width:calc(100% - 24px)}[_nghost-%COMP%]     .feed-item .inner .feed-item-content-user-head-posted{width:auto;max-width:calc(100% - 48px);min-height:24px}[_nghost-%COMP%]     .feed-item .inner .feed-item-content-desc{margin-top:0;overflow-x:scroll}[_nghost-%COMP%]     .feed-item .inner .feed-item-content-user-desc{margin-top:-4px}[_nghost-%COMP%]     .feed-item .inner .feed-item-content{margin-top:0}[_nghost-%COMP%]     .feed-item.feed-item-post{margin-bottom:24px}[_nghost-%COMP%]     .feed-item-content-desc.no-outline{outline:none}[_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]{display:inline-flex;position:relative;bottom:4px;max-width:calc(100% - 24px)}[_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]   .recipient[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-right:8px}[_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]   .mailed-caption[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase;min-width:-moz-fit-content;min-width:fit-content}[_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]   .sender-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .email-recipients-head[_ngcontent-%COMP%]   .recipient-label[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .email-title[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}",".tile-head[_ngcontent-%COMP%]{margin-bottom:8px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]{display:flex}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{display:inline-block;height:32px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{display:inline-flex;align-items:baseline;margin:0;margin-inline-start:16px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .word-separator[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{display:flex;margin-inline-start:48px;margin-top:-12px;gap:8px}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:4px;width:0px;height:12px}.tile-head.base-head[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{flex-direction:column}.tile-head.base-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{margin-inline-start:0;margin-top:0}.tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}.tile-body.tile-body-margin-top[_ngcontent-%COMP%]{margin-top:8px}.recipient[_ngcontent-%COMP%]{border-radius:8px;padding:0 8px}.toggle-button[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer}.toggle-button[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin:auto 4px auto 0}"],changeDetection:0})}}function ui(o,t){if(o&1){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"crt-link",9),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onLinkClick("Contact",a.getEntityColumnValue("Owner.Id")))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(2,"div",10),e.\u0275\u0275elementContainerEnd()}if(o&2){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("caption",n.getEntityColumnValue("Owner.Name")),e.\u0275\u0275property("href",n.entityLinks.CaseOwner)}}let ee=class re extends f{buildEntityLinks(){this.buildEntityLink("Case",this.entity.id,"CaseTitle"),this.buildEntityLink("Contact",this.getEntityColumnValue("Owner.Id"),"CaseOwner")}getHeadCaseCaption(){return this.getEntityColumnValue("Number")+" : "+this.getEntityColumnValue("Subject")}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(re)))(i||re)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:re,selectors:[["crt-timeline-tile-case-head"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:12,vars:8,consts:[[1,"tile-head"],[1,"object-caption-container"],[1,"icon-container"],[3,"tileKey","tileIconId"],[1,"object-caption"],["mode","'preventDefault'",3,"clicked","href","caption"],[1,"sub-title"],[4,"ngIf"],[1,"object-date"],["mode","'preventDefault'",1,"author",3,"clicked","href","caption"],[1,"separator"]],template:function(n,i){n&1&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275element(3,"crt-entity-icon",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",4)(5,"crt-link",5),e.\u0275\u0275listener("clicked",function(){return i.onLinkClick(i.entity.schemaName,i.entity.entityId)}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(6,"div",6),e.\u0275\u0275template(7,ui,3,2,"ng-container",7),e.\u0275\u0275elementStart(8,"div",8)(9,"span"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"smartDateTimeFormat"),e.\u0275\u0275elementEnd()()()()),n&2&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("tileKey",i.entity.tileEntityName)("tileIconId",i.tileEntityConfig==null?null:i.tileEntityConfig.iconId),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("caption",i.getHeadCaseCaption()),e.\u0275\u0275property("href",i.entityLinks.CaseTitle),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.getEntityColumnValue("Owner.Name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,6,i.entity.date)))},dependencies:[d.NgIf,E.h,D.N,j.O],styles:[".tile-head[_ngcontent-%COMP%]{margin-bottom:8px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]{display:flex}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{display:inline-block;height:32px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{display:inline-flex;align-items:baseline;margin:0;margin-inline-start:16px}.tile-head[_ngcontent-%COMP%]   .object-caption-container[_ngcontent-%COMP%]   .word-separator[_ngcontent-%COMP%]{margin:0 8px;text-transform:lowercase}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{display:flex;margin-inline-start:48px;margin-top:-12px;gap:8px}.tile-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:4px;width:0px;height:12px}.tile-head.base-head[_ngcontent-%COMP%]   .object-caption[_ngcontent-%COMP%]{flex-direction:column}.tile-head.base-head[_ngcontent-%COMP%]   .sub-title[_ngcontent-%COMP%]{margin-inline-start:0;margin-top:0}.tile-body[_ngcontent-%COMP%]{margin-inline-start:48px}.tile-body.tile-body-margin-top[_ngcontent-%COMP%]{margin-top:8px}.recipient[_ngcontent-%COMP%]{border-radius:8px;padding:0 8px}.toggle-button[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer}.toggle-button[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin:auto 4px auto 0}"],changeDetection:0})}};ee=(0,s.__decorate)([P("Case",["Subject","Number","Owner.Id","Owner.Name"])],ee);var hi=l(32300);let te=class se extends y{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(se)))(i||se)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:se,selectors:[["crt-timeline-email-label"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:4,consts:[[1,"timeline-tile-label",3,"value","label","labelPosition","readonly"]],template:function(n,i){n&1&&e.\u0275\u0275element(0,"crt-email-input",0),n&2&&e.\u0275\u0275property("value",i.value)("label",i.caption)("labelPosition","above")("readonly",!0)},dependencies:[hi.d],encapsulation:2})}};te=(0,s.__decorate)([(0,v.v)({type:"crt.TimelineEmailLabel",reuseStrategy:F.B.Reuse})],te);var gi=l(75214);let ne=class ce extends y{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(ce)))(i||ce)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ce,selectors:[["crt-timeline-phone-label"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:5,consts:[[1,"timeline-tile-label",3,"value","label","labelPosition","readonly","displayAsPhone"]],template:function(n,i){n&1&&e.\u0275\u0275element(0,"crt-phone-input",0),n&2&&e.\u0275\u0275property("value",i.value)("label",i.caption)("labelPosition","above")("readonly",!0)("displayAsPhone",!1)},dependencies:[gi.F],encapsulation:2})}};ne=(0,s.__decorate)([(0,v.v)({type:"crt.TimelinePhoneLabel",reuseStrategy:F.B.Reuse})],ne);var Ci=l(26168);let ie=class me extends y{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.\u0275\u0275getInheritedFactory(me)))(i||me)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:me,selectors:[["crt-timeline-web-label"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:4,consts:[[1,"timeline-tile-label",3,"value","label","labelPosition","readonly"]],template:function(n,i){n&1&&e.\u0275\u0275element(0,"crt-web-input",0),n&2&&e.\u0275\u0275property("value",i.value)("label",i.caption)("labelPosition","above")("readonly",!0)},dependencies:[Ci.r],encapsulation:2})}};ie=(0,s.__decorate)([(0,v.v)({type:"crt.TimelineWebLabel",reuseStrategy:F.B.Reuse})],ie);var kt=l(4164);let Ce=class{convert(t,n,i){return Promise.resolve({filter:t,type:i})}};Ce=(0,s.__decorate)([(0,kt.a)({type:"crt.ToTileFilter"})],Ce);let ye=class{convert(t,n){return Promise.resolve(t)}};ye=(0,s.__decorate)([(0,kt.a)({type:"crt.ToTileFilterGroup"})],ye);var yi=l(74368),fi=l(29423),_i=l(72782);class Q{constructor(t,n,i=!1){this._quickFilterPreprocessorService=t,this._translateService=n,this._isDesignTime=i,this._metadataSchemaUtils=(0,e.inject)(yi.u)}_getTimelineViewConfigs(t){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Timeline",t.viewConfig).map(n=>n?.viewConfig).filter(Boolean)}_getFilterByOwnerConfig(t){const n={caption:this._translateService.instant("Timeline.OwnerFilterCaption"),hint:this._translateService.instant("Timeline.OwnerFilterHint"),icon:"person-button-icon",iconPosition:"left-icon",entitySchemaName:"Contact"};return{filterType:"lookup",name:"ByOwnerQuickFilterIn"+t,type:"crt.QuickFilter",config:n}}crtOnMetaDataInit(t){var n=this;return(0,U.A)(function*(){if(!n._isDesignTime){const i=t,a=n._getTimelineViewConfigs(i);yield Promise.all(a.map(function(){var r=(0,U.A)(function*(m){const x=n._getFilterByOwnerConfig(m.name);yield n._quickFilterPreprocessorService.crtOnMetaDataInit(x,t),m.quickFilterByOwnerConfig=x});return function(m){return r.apply(this,arguments)}}()))}return Promise.resolve(t)})()}static{this.\u0275fac=function(n){return new(n||Q)(e.\u0275\u0275inject(_i.S),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(fi.w,8))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac})}}let oe=class Pe{static{this.\u0275fac=function(n){return new(n||Pe)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Pe})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[{provide:Vt.m,useClass:Q,multi:!0},de.k],imports:[Be.q,d.CommonModule,je.R,He.c,Ae.C,Qe.D,R.MatIconModule,Fe.MatLegacyMenuModule,u.TranslateModule,at.c,Se.MatExpansionModule,Ue.S,Ke.U,lt.X,rt.d,Ge.D,ke.q,Ne.V,ze.u,we.Q,$e.Y,De.H,et.S,st.X,ct.P,Ve.x,We.J,ot.V,Le.f,Ze.E,Xe.s,Je.y,it.u,b,tt.Q,nt.B,Ye.Q,qe.a]})}};oe=(0,s.__decorate)([(0,Dt.g)({viewElements:[h,C,w,O,ie,te,ne,y],converters:[Ce,ye]})],oe),function(){(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(oe,{declarations:[h,C,w,ie,te,ne,O,k,f,X,J,Y,q,A,L,y,ee,T,H],imports:[Be.q,d.CommonModule,je.R,He.c,Ae.C,Qe.D,R.MatIconModule,Fe.MatLegacyMenuModule,u.TranslateModule,at.c,Se.MatExpansionModule,Ue.S,Ke.U,lt.X,rt.d,Ge.D,ke.q,Ne.V,ze.u,we.Q,$e.Y,De.H,et.S,st.X,ct.P,Ve.x,We.J,ot.V,Le.f,Ze.E,Xe.s,Je.y,it.u,b,tt.Q,nt.B,Ye.Q,Re.x,qe.a],exports:[h,w,O,T]})}(),e.\u0275\u0275setComponentScope(A,[d.NgIf,E.h,G.W,It.G,D.N,L,H],[u.TranslatePipe]);class wt{}class vi extends wt{}class Ti{}class Mi{}class Ei{}class Oi{}class xi{}class bi{}},73869:g=>{g.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M8.58802 13.7571C8.43705 13.9072 8.22896 14 7.99921 14C7.75841 14 7.54141 13.8981 7.38902 13.735L3.25662 9.7663C2.92401 9.44687 2.91333 8.91829 3.23276 8.58568C3.55219 8.25307 4.08078 8.24239 4.41339 8.56182L7.16421 11.2037L7.16421 2.835C7.16421 2.37384 7.53805 2 7.99921 2C8.46037 2 8.83421 2.37384 8.83421 2.835L8.83421 11.2052L11.5866 8.56182C11.9192 8.24239 12.4478 8.25307 12.7672 8.58568C13.0867 8.91829 13.076 9.44687 12.7434 9.7663L8.58802 13.7571Z" fill="currentColor"/>
</svg>
`},69303:g=>{g.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M3.27572 5.27844C3.64335 4.90719 4.2394 4.90719 4.60703 5.27844L8 8.70489L11.393 5.27844C11.7606 4.90719 12.3566 4.90719 12.7243 5.27844C13.0919 5.6497 13.0919 6.25163 12.7243 6.62289L8.66565 10.7216C8.29802 11.0928 7.70198 11.0928 7.33435 10.7216L3.27572 6.62289C2.90809 6.25163 2.90809 5.6497 3.27572 5.27844Z" fill="currentColor"/>
</svg>
`},12190:g=>{g.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M8.58802 2.24295C8.43705 2.09279 8.22896 2 7.99921 2C7.75841 2 7.54141 2.10193 7.38902 2.265L3.25662 6.2337C2.92401 6.55313 2.91333 7.08171 3.23276 7.41432C3.55219 7.74693 4.08078 7.75761 4.41339 7.43818L7.16421 4.79633L7.16421 13.165C7.16421 13.6262 7.53805 14 7.99921 14C8.46037 14 8.83421 13.6262 8.83421 13.165L8.83421 4.79481L11.5866 7.43818C11.9192 7.75761 12.4478 7.74693 12.7672 7.41432C13.0867 7.08171 13.076 6.55313 12.7434 6.2337L8.58802 2.24295Z" fill="currentColor"/>
</svg>
`},25608:g=>{g.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M7.33435 5.27844C7.70198 4.90719 8.29802 4.90719 8.66565 5.27844L12.7243 9.37711C13.0919 9.74837 13.0919 10.3503 12.7243 10.7216C12.3566 11.0928 11.7606 11.0928 11.393 10.7216L8 7.29511L4.60703 10.7216C4.2394 11.0928 3.64335 11.0928 3.27572 10.7216C2.90809 10.3503 2.90809 9.74837 3.27572 9.37711L7.33435 5.27844Z" fill="currentColor"/>
</svg>
`},19202:g=>{g.exports=`<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<g id="Photo Placeholder ">
<g clip-path="url(#clip0_6984_8837)">
<path id="Rectangle 7758" d="M32 0H0V32H32V0Z" fill="white"/>
<path id="Vector" d="M31.6858 28.0662L22.6858 24.0751L22.3429 22.9917C22.2286 22.6202 22.0858 22.2505 21.7429 22.1648C21.6716 22.1305 21.6103 22.0782 21.5653 22.0131C21.5202 21.948 21.4928 21.8723 21.4858 21.7934L21.2858 19.6551C21.281 19.4862 21.3425 19.3221 21.4572 19.198C22.0162 18.5001 22.372 17.6617 22.4858 16.7748C22.5429 16.3177 22.8001 15.8911 22.9143 15.4348L23.4001 12.8974C23.4572 12.5545 23.4286 12.2974 23.0572 12.1845C22.9429 12.156 22.8572 11.9845 22.8572 11.7274C22.8572 11.7274 23.3143 8.42024 23.1715 7.25138C22.9715 5.71196 21.8001 2.60453 18.6001 2.77538C10.0858 0.298527 10.7143 4.43224 7.77149 5.65824C8.60006 6.25824 9.17149 6.17253 9.62863 6.0011C9.48578 6.11538 8.4572 6.17253 7.97149 8.22481C8.5682 7.45931 8.88233 7.45512 9.27921 7.23082C8.31835 7.78464 9.20013 11.0195 9.22863 11.3325V11.7611C9.22863 11.9611 9.14292 12.1897 9.02863 12.2182C8.6572 12.3611 8.6572 12.6182 8.68578 12.9311L9.17149 15.4662C9.28578 15.9234 9.54292 16.35 9.60006 16.8062C9.71381 17.6931 10.0697 18.5315 10.6286 19.2294C10.7316 19.3604 10.7915 19.5201 10.8001 19.6865L10.6001 21.8248C10.5715 21.9677 10.4572 22.1677 10.3429 22.1962C10.0001 22.282 9.82863 22.6534 9.74292 23.0231L9.40006 24.1065L0.314347 28.0662C0.217795 28.1199 0.137584 28.1987 0.0822438 28.2943C0.0269036 28.3899 -0.00149736 28.4987 6.08349e-05 28.6091V32.0005H32.0001V28.6091C32.0016 28.4987 31.9732 28.3899 31.9179 28.2943C31.8625 28.1987 31.7823 28.1199 31.6858 28.0662Z" fill="#D9D9D9"/>
</g>
<rect x="0.5" y="0.5" width="31" height="31" rx="15.5" stroke="#181818" stroke-opacity="0.05"/>
</g>
<defs>
<clipPath id="clip0_6984_8837">
<rect width="32" height="32" rx="16" fill="white"/>
</clipPath>
</defs>
</svg>
`},6117:g=>{g.exports=`<svg width="72" height="64" viewBox="0 0 72 64" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M58 15H28C26.3431 15 25 16.3431 25 18C25 19.6569 26.3431 21 28 21H58C59.6569 21 61 19.6569 61 18C61 16.3431 59.6569 15 58 15Z" fill="#40ACF0"/>
<path d="M58 36H40C38.3431 36 37 37.3431 37 39C37 40.6569 38.3431 42 40 42H58C59.6569 42 61 40.6569 61 39C61 37.3431 59.6569 36 58 36Z" fill="#D1D1D1"/>
<path d="M58 26H40C38.3431 26 37 27.3431 37 29C37 30.6569 38.3431 32 40 32H58C59.6569 32 61 30.6569 61 29C61 27.3431 59.6569 26 58 26Z" fill="#D1D1D1"/>
<path d="M58 46H40C38.3431 46 37 47.3431 37 49C37 50.6569 38.3431 52 40 52H58C59.6569 52 61 50.6569 61 49C61 47.3431 59.6569 46 58 46Z" fill="#D1D1D1"/>
<circle cx="29" cy="39" r="4" fill="#004FD6"/>
<circle cx="29" cy="29" r="4" fill="#004FD6"/>
<circle cx="29" cy="49" r="4" fill="#004FD6"/>
<path d="M15 26C18.3137 26 21 23.3137 21 20C21 16.6863 18.3137 14 15 14C11.6863 14 9 16.6863 9 20C9 23.3137 11.6863 26 15 26Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M15 17.1152V20.3722L16.682 22.3302" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round"/>
</svg>
`}}]);
