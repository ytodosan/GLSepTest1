(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[2826],{42826:($,Oe,s)=>{s.r(Oe),s.d(Oe,{CrtFolderTreeActionsComponent:()=>N,CrtFolderTreeComponent:()=>p,CrtFolderTreeModule:()=>q,CrtFolderTreeSelectFolderComponent:()=>O,CrtSetupFolderTreeFilterComponent:()=>K,DEFAULT_FOLDER_TREE_FAVORITE_SCHEMA_NAME:()=>m.J8,DEFAULT_FOLDER_TREE_SOURCE_SCHEMA_NAME:()=>m.uE,DYNAMIC_FOLDER_TYPE_ID:()=>m.Ss,EMPTY_FOLDER_FILTER:()=>dt,FOCUSED_NODE_ELEMENT_CLASS:()=>Yt,FolderManagerService:()=>E,FolderTreeAccessRightsAuditor:()=>vr.Q,FolderTreeAdminUnitRoleSourcesService:()=>Ft.R,FolderTreeDataProvider:()=>G,FolderTreeFilterOptionsBackwardCompatibilityModifier:()=>vt.j,FolderTreeIdResolver:()=>gt.W,FolderTreeModelRequestHandlerService:()=>M,FolderTreeNodeSortingOrder:()=>R,FolderTreeUseStaticFolderService:()=>U,FolderTreeUserProfileService:()=>x,OLD_FOLDER_TREE_FAVORITE_SCHEMA_NAME:()=>m.hc,SECURED_DEFAULT_FOLDER_TREE_FAVORITE_SCHEMA_NAME:()=>m.HT,SECURED_OLD_FOLDER_TREE_FAVORITE_SCHEMA_NAME:()=>m.HD,STATIC_FOLDER_COLUMN_NAME:()=>m.lb,STATIC_FOLDER_TYPE_ID:()=>m.Xi,SelectFolderDialogCloseState:()=>H,SetupFolderTreeFilterDialogCloseState:()=>B,StaticFolderService:()=>V,TreeBuilderService:()=>D,VIRTUAL_FAVORITE_ROOT_NODE_ID:()=>m.NQ,VIRTUAL_ROOT_NODE_ID:()=>m.EM,createStaticFolderFilter:()=>f.po,getActiveFolderIdAttributeName:()=>f.tt,getFolderFilterColumnName:()=>f.ic,getOldFolderEntitySchemaName:()=>f.dn,getOldInFolderEntitySchemaName:()=>f.sh,getOldInFolderReferenceColumnName:()=>f.d8,isOldSourceSchema:()=>f.SK,isStaticFolder:()=>f.$K});var m=s(7477),a=s(5960),P=s(40297),W=s(52989),Re=s(23023),Ct=s(55642),A=s(79772),De=s(5476),ke=s(79877),$e=s(28627),je=s(50663),He=s(66989),Be=s(76260),Ke=s(31149),Ue=s(43981),Le=s(44267),Ze=s(57274),Ge=s(82294),ze=s(39809),Qe=s(80953),Je=s(12841),u=s(73308),r=s(59131),It=s(56711),j=s(6530),v=s(77592),yt=s(66823),C=s(34760),We=s(3671),Xe=s(96677),Ye=s(52793),qe=s(10098),et=s(7471),tt=s(50485),z=s(65001),St=s(31774),rt=s(19344),ot=s(91244),nt=s(68712),Nt=s(8525),ie=s(73723),g=s(28399),l=s(62278),T=s(89422),b=s(29957),X=s(76923),Tt=s(7622),H;(function(d){d.Cancelled="cancelled",d.Selected="selected"})(H||(H={}));class O extends Tt.c{constructor(e,t,o){super(t,e),this._dialogRef=t,this._changeDetectorRef=o,this.selectFolderParameters=e}_getFolderId(e){return e.isFavorite?e.folderTreeId:e.id}onSelectButtonClick(){const e={status:H.Selected,selectedFolderId:this.selectedFolderId};this._dialogRef.close(e)}onCloseButtonClick(){const e={status:H.Cancelled};this._dialogRef.close(e)}onFolderSelected(e){const t=this._getFolderId(e);this.selectedFolderId=t||m.EM,this._changeDetectorRef.detectChanges()}static{this.\u0275fac=function(t){return new(t||O)(r.\u0275\u0275directiveInject(X.MAT_LEGACY_DIALOG_DATA),r.\u0275\u0275directiveInject(X.MatLegacyDialogRef),r.\u0275\u0275directiveInject(r.ChangeDetectorRef))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:O,selectors:[["crt-folder-tree-select-folder"]],features:[r.\u0275\u0275InheritDefinitionFeature],decls:12,vars:15,consts:[[3,"title","displayCloseButton"],["content",""],[1,"folder-tree-select-folder-content"],[3,"activeFolderChanged","items","favoriteItems","rootSchemaName","readonly"],["actions",""],[3,"clicked"],["color","primary",3,"clicked","disabled"]],template:function(t,o){t&1&&(r.\u0275\u0275elementStart(0,"crt-dialog",0),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275elementContainerStart(2,1),r.\u0275\u0275elementStart(3,"div",2)(4,"crt-folder-tree",3),r.\u0275\u0275listener("activeFolderChanged",function(i){return o.onFolderSelected(i)}),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementContainerEnd(),r.\u0275\u0275elementContainerStart(5,4),r.\u0275\u0275elementStart(6,"crt-button",5),r.\u0275\u0275listener("clicked",function(){return o.onCloseButtonClick()}),r.\u0275\u0275text(7),r.\u0275\u0275pipe(8,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(9,"crt-button",6),r.\u0275\u0275listener("clicked",function(){return o.onSelectButtonClick()}),r.\u0275\u0275text(10),r.\u0275\u0275pipe(11,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd(),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275property("title",r.\u0275\u0275pipeBind1(1,9,"FolderTreeSelectFolder.SelectFolderCaption"))("displayCloseButton",!0),r.\u0275\u0275advance(4),r.\u0275\u0275property("items",o.selectFolderParameters.folderTreeItems)("favoriteItems",o.selectFolderParameters.favoriteTreeItems)("rootSchemaName",o.selectFolderParameters.rootSchemaName)("readonly",!0),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(8,11,"FolderTreeSelectFolder.CancelButton")," "),r.\u0275\u0275advance(2),r.\u0275\u0275property("disabled",!o.selectedFolderId),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(11,13,"FolderTreeSelectFolder.SelectFolderButtonCaption")," "))},styles:["[_nghost-%COMP%]{width:100%;height:100%}crt-dialog[_ngcontent-%COMP%]{height:inherit;width:inherit}crt-dialog[_ngcontent-%COMP%]     [mat-dialog-actions].crt-dialog-actions{margin-top:auto}crt-dialog[_ngcontent-%COMP%]   .folder-tree-select-folder-content[_ngcontent-%COMP%]{height:100%;width:100%}crt-dialog[_ngcontent-%COMP%]   .folder-tree-select-folder-content[_ngcontent-%COMP%]     crt-folder-tree .folder-tree-container .folder-tree-header crt-search-filter{max-width:none}crt-dialog[_ngcontent-%COMP%]   .folder-tree-select-folder-content[_ngcontent-%COMP%]     crt-folder-tree .folder-tree-container .folder-tree-header button.close-tree-btn{display:none}"]})}}var Mt=s(86561),it=s(62115),at=s(82491),wt=s(83181);function At(d,e){d&1&&r.\u0275\u0275element(0,"ts-mask",9)}var B;(function(d){d.Cancelled="cancelled",d.Saved="saved"})(B||(B={}));class K{constructor(e,t,o,n){this._dialogRef=t,this._extResourceFrameWindowMessenger=o,this._changeDetectorRef=n,this._subscription=new l.Subscription,this.loading=!0,this.filtersModalOpened=!1,this.filterParams=e}ngOnInit(){this._subscription.add(this._extResourceFrameWindowMessenger.designerLoaded$.subscribe(()=>{this.loading=!1,this._changeDetectorRef.detectChanges()})),this._subscription.add(this._extResourceFrameWindowMessenger.modalOpening$.subscribe(()=>{this.filtersModalOpened=!0,this._changeDetectorRef.detectChanges()})),this._subscription.add(this._extResourceFrameWindowMessenger.modalClosing$.subscribe(()=>{this.filtersModalOpened=!1,this._changeDetectorRef.detectChanges()}))}getClasses(){return{"folder-tree-filters-panel":!0,"folder-tree-filters-panel-cover":this.filtersModalOpened}}onFiltersParamsChanged(e){this.filterParams=e}onSaveButtonClick(){const e={status:B.Saved,filterParams:this.filterParams};this._dialogRef.close(e)}onCloseButtonClick(){const e={status:B.Cancelled};this._dialogRef.close(e)}ngOnDestroy(){this._subscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||K)(r.\u0275\u0275directiveInject(X.MAT_LEGACY_DIALOG_DATA),r.\u0275\u0275directiveInject(X.MatLegacyDialogRef),r.\u0275\u0275directiveInject(Mt.b),r.\u0275\u0275directiveInject(r.ChangeDetectorRef))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:K,selectors:[["crt-setup-filter"]],decls:15,vars:14,consts:[[3,"ngClass"],[1,"folder-tree-filters-panel-header"],[1,"folder-tree-filters-panel-caption"],[1,"folder-tree-filters-panel-buttons"],["color","primary",1,"action-button",3,"clicked","disabled"],[1,"action-button",3,"clicked","disabled"],[1,"folder-tree-filters-panel-content"],["class","folder-tree-filters-panel-mask",4,"ngIf"],[3,"filterParamsChange","filterParams"],[1,"folder-tree-filters-panel-mask"]],template:function(t,o){t&1&&(r.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),r.\u0275\u0275text(3),r.\u0275\u0275pipe(4,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(5,"div",3)(6,"crt-button",4),r.\u0275\u0275listener("clicked",function(){return o.onSaveButtonClick()}),r.\u0275\u0275text(7),r.\u0275\u0275pipe(8,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(9,"crt-button",5),r.\u0275\u0275listener("clicked",function(){return o.onCloseButtonClick()}),r.\u0275\u0275text(10),r.\u0275\u0275pipe(11,"translate"),r.\u0275\u0275elementEnd()()(),r.\u0275\u0275elementStart(12,"div",6),r.\u0275\u0275template(13,At,1,0,"ts-mask",7),r.\u0275\u0275elementStart(14,"crt-filters",8),r.\u0275\u0275listener("filterParamsChange",function(i){return o.onFiltersParamsChanged(i)}),r.\u0275\u0275elementEnd()()()),t&2&&(r.\u0275\u0275property("ngClass",o.getClasses()),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(4,8,"FolderTreeFilters.DialogTitle")),r.\u0275\u0275advance(3),r.\u0275\u0275property("disabled",o.loading||o.filtersModalOpened),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(8,10,"FolderTreeFilters.SaveButton")),r.\u0275\u0275advance(2),r.\u0275\u0275property("disabled",o.filtersModalOpened),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(11,12,"FolderTreeFilters.CancelButton")),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngIf",o.loading),r.\u0275\u0275advance(),r.\u0275\u0275property("filterParams",o.filterParams))},dependencies:[P.NgClass,P.NgIf,it.B,at.I,wt.E,A.TranslatePipe],styles:["[_nghost-%COMP%]{width:100%}.folder-tree-filters-panel[_ngcontent-%COMP%]{flex-direction:column;display:flex;height:100%}.folder-tree-filters-panel-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-inline:40px}.folder-tree-filters-panel-header[_ngcontent-%COMP%]   .folder-tree-filters-panel-caption[_ngcontent-%COMP%]{margin:8px 0}.folder-tree-filters-panel-header[_ngcontent-%COMP%]   .folder-tree-filters-panel-buttons[_ngcontent-%COMP%]{display:flex;justify-items:flex-start;align-items:flex-start;flex-flow:row nowrap;margin-bottom:32px;gap:16px}.folder-tree-filters-panel-content[_ngcontent-%COMP%]{position:relative;height:100%}.folder-tree-filters-panel-content[_ngcontent-%COMP%]   .folder-tree-filters-panel-mask[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%}"]})}}var R;(function(d){d.ORIG="ORIG",d.ASC="ASC",d.DESC="DESC"})(R||(R={}));class D{_getSortedItems(e,t){return t===R.ORIG?e:[...e].sort((o,n)=>o.name.localeCompare(n.name)*(t===R.ASC?1:-1))}_createTreeFromItems(e){const t=[],o=[];if(!e)return t;const n=e.map((i,c)=>(o[i.id]=c,this.createNode(i)),this);return e.forEach(i=>{const c=n[o[i.id]];if((0,j.gZ)(i.parentId))t.push(c);else{const _=n[o[i.parentId]];if(!_)return;_.children.push(c)}}),t}createNode(e){return{id:e.id,name:e.name,filterData:e.filterData,editable:e.editable,isNew:e.isNew,folderTreeId:e.folderTreeId,folderTypeId:e.folderTypeId,hasFavorite:e.hasFavorite,isFavorite:e.isFavorite,favoriteId:e.favoriteId,children:[]}}build(e,t=R.ORIG){return e?this._createTreeFromItems(this._getSortedItems(e,t)):[]}filterTreeBySearchText(e,t,o){if(!t||t==="")return e;if(!e||e.length===0)return[];const n=t.toLowerCase(),i=[];for(const c of e){const _=this.filterTreeBySearchText(c.children,t,o),F=_.length>0;c.children=_,(F||c.name.toLowerCase().includes(n)&&o.findIndex(y=>y===c.id)<0||c.isNew||c.isCopy)&&i.push(c)}return i}static{this.\u0275fac=function(t){return new(t||D)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})}}var f=s(21747),bt=s(58433),xt=s(22817),st=s(4227),ae=s(54653),Et=s(66675),Pt=s(46558);const Vt=d=>({"folder-tree":!0,"crt-folder-tree-search-applied":d}),Ot=d=>({"node-text":!0,"node-name-input":d}),Rt=d=>({$implicit:d});function Dt(d,e){d&1&&r.\u0275\u0275element(0,"crt-skeleton-loader")}function kt(d,e){d&1&&r.\u0275\u0275element(0,"ts-mask",16)}function $t(d,e){if(d&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"button",17),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(n.addNewItem(null))}),r.\u0275\u0275element(3,"mat-icon",18),r.\u0275\u0275text(4),r.\u0275\u0275pipe(5,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()}d&2&&(r.\u0275\u0275advance(),r.\u0275\u0275property("title",r.\u0275\u0275pipeBind1(2,2,"FolderTree.AddFilterHint")),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(5,4,"FolderTree.AddFilter")," "))}function jt(d,e){if(d&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"button",19),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275element(3,"mat-icon",18),r.\u0275\u0275text(4),r.\u0275\u0275pipe(5,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275element(6,"crt-menu",20,2),r.\u0275\u0275elementContainerEnd()),d&2){const t=r.\u0275\u0275reference(7),o=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(),r.\u0275\u0275property("crtMenuTriggerFor",t)("title",r.\u0275\u0275pipeBind1(2,4,"FolderTree.AddFilterHint")),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(5,6,"FolderTree.AddFilter")," "),r.\u0275\u0275advance(2),r.\u0275\u0275property("menuItems",o.getAddMenuItems())}}function Ht(d,e){d&1&&(r.\u0275\u0275elementStart(0,"div",21)(1,"div",22),r.\u0275\u0275text(2),r.\u0275\u0275pipe(3,"translate"),r.\u0275\u0275elementEnd()()),d&2&&(r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(3,1,"FolderTree.BlankslateMessage")))}function Bt(d,e){if(d&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",24),r.\u0275\u0275element(2,"mat-icon",25),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(3,"div",26),r.\u0275\u0275elementContainerStart(4),r.\u0275\u0275text(5),r.\u0275\u0275elementContainerEnd(),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()),d&2){const t=r.\u0275\u0275nextContext().node;r.\u0275\u0275advance(5),r.\u0275\u0275textInterpolate(t.name)}}function Kt(d,e){if(d&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"crt-input",29),r.\u0275\u0275listener("blurred",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext(2).node,i=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(i.onNameEnter(n))})("keyDown",function(n){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2).node,c=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(c.onNameKeydown(n,i))})("focusin",function(n){return r.\u0275\u0275restoreView(t),r.\u0275\u0275resetView(n.cancelBubble=!0)})("focusout",function(n){return r.\u0275\u0275restoreView(t),r.\u0275\u0275resetView(n.cancelBubble=!0)}),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()}if(d&2){const t=r.\u0275\u0275nextContext(5);r.\u0275\u0275advance(),r.\u0275\u0275property("control",t.folderNameControl)}}function Ut(d,e){if(d&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275text(1),r.\u0275\u0275elementContainerEnd()),d&2){const t=r.\u0275\u0275nextContext(2).node;r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(t.name)}}function Lt(d,e){if(d&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"button",38),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext(4).node,i=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(i.createOrEditFolderFilters(n))}),r.\u0275\u0275element(2,"mat-icon",39),r.\u0275\u0275elementEnd()}if(d&2){const t=r.\u0275\u0275nextContext(4).node;r.\u0275\u0275property("id","filter-btn--"+t.id)("title",r.\u0275\u0275pipeBind1(1,2,"FolderTree.SetUpFilter"))}}function Zt(d,e){if(d&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",32)(1,"button",33),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275listener("click",function(n){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(3).node,c=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(c.onToggleFolderFavorite(n,i))}),r.\u0275\u0275element(3,"mat-icon",34),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(4,Lt,3,4,"button",35),r.\u0275\u0275elementStart(5,"button",36),r.\u0275\u0275pipe(6,"translate"),r.\u0275\u0275listener("click",function(n){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(6);return r.\u0275\u0275resetView(i.onMenuActionsClick(n))})("menuClosed",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext(6);return r.\u0275\u0275resetView(n.onCloseMenu())})("menuOpened",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext(6);return r.\u0275\u0275resetView(n.onOpenMenu())}),r.\u0275\u0275element(7,"mat-icon",37),r.\u0275\u0275elementEnd(),r.\u0275\u0275element(8,"crt-menu",20,3),r.\u0275\u0275elementEnd()}if(d&2){const t=r.\u0275\u0275reference(9),o=r.\u0275\u0275nextContext(3).node,n=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(),r.\u0275\u0275property("id","toggle-favorite-btn--"+o.id)("title",r.\u0275\u0275pipeBind1(2,12,"FolderTree.MenuActions."+(o.hasFavorite||o.isFavorite?"RemoveFromFavorite":"AddToFavorite")))("disabled",o.isFavoriteToggleInProgress),r.\u0275\u0275advance(2),r.\u0275\u0275classProp("in-favorite",o.hasFavorite||o.isFavorite),r.\u0275\u0275property("svgIcon",o.hasFavorite||o.isFavorite?"star-filled-icon":"star-icon"),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!n.isStaticNode(o)),r.\u0275\u0275advance(),r.\u0275\u0275property("id","node-menu-btn--"+o.id)("crtMenuTriggerFor",t)("crtMenuTriggerData",r.\u0275\u0275pureFunction1(16,Rt,o))("title",r.\u0275\u0275pipeBind1(6,14,"FolderTree.ShowMenuActions")),r.\u0275\u0275advance(3),r.\u0275\u0275property("menuItems",n.getNodeMenuItems(o))}}function Gt(d,e){if(d&1&&(r.\u0275\u0275elementStart(0,"div",30),r.\u0275\u0275template(1,Zt,10,18,"div",31),r.\u0275\u0275elementEnd()),d&2){const t=r.\u0275\u0275nextContext(2).node,o=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!t.editable&&!o.readonly)}}function zt(d,e){if(d&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",24),r.\u0275\u0275element(2,"mat-icon",27),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(3,"div",12),r.\u0275\u0275template(4,Kt,2,1,"ng-container",9)(5,Ut,2,1,"ng-container",9),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(6,Gt,2,1,"div",28),r.\u0275\u0275elementContainerEnd()),d&2){const t=r.\u0275\u0275nextContext().node,o=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(2),r.\u0275\u0275property("svgIcon",o.isStaticNode(t)?"folder-static-icon":"folder-icon"),r.\u0275\u0275advance(),r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction1(5,Ot,t.editable)),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.editable),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!t.editable),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!o.isRootNode(t))}}function Qt(d,e){if(d&1&&(r.\u0275\u0275elementStart(0,"div",23),r.\u0275\u0275template(1,Bt,6,1,"ng-container",9)(2,zt,7,7,"ng-container",9),r.\u0275\u0275elementEnd()),d&2){const t=e.node,o=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",o.isFavoriteRoot(0,t)),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",o.isFolderNode(0,t))}}function Jt(d,e){if(d&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",5),r.\u0275\u0275template(2,kt,1,0,"ts-mask",6),r.\u0275\u0275elementStart(3,"div",7)(4,"crt-search-filter",8),r.\u0275\u0275listener("valueChange",function(n){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(i.onSearchFilterChanged(n))}),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(5,$t,6,6,"ng-container",9)(6,jt,8,8,"ng-container",9),r.\u0275\u0275elementStart(7,"button",10),r.\u0275\u0275pipe(8,"translate"),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(n.onFolderTreeHideClick())})("keydown.enter",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(n.onFolderTreeHideClick())}),r.\u0275\u0275element(9,"mat-icon",11),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementStart(10,"div",12),r.\u0275\u0275template(11,Ht,4,3,"div",13),r.\u0275\u0275elementStart(12,"crt-virtual-scroll-tree-view",14),r.\u0275\u0275listener("expandedItemsChanged",function(n){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(i.onExpandedItemsChanged(n))})("selectedItemKeyChange",function(n){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(i.onSelectedItemKeyChange(n))}),r.\u0275\u0275template(13,Qt,3,2,"ng-template",15),r.\u0275\u0275elementEnd()()(),r.\u0275\u0275elementContainerEnd()}if(d&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngClass",t.classes),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.showMask||t.loadingView),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngIf",!t.useStaticFolders&&!t.readonly),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.useStaticFolders&&!t.readonly),r.\u0275\u0275advance(),r.\u0275\u0275property("crtAccessibleAttributes",r.\u0275\u0275pipeBind1(8,17,"FolderTree.CloseFolderTree")),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction1(19,Vt,t.isSearchApplied)),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.flatItems.length===0&&!t.loadingView),r.\u0275\u0275advance(),r.\u0275\u0275property("items",t.flatItems)("expandedItems",t.expandedItems)("selectedItemKey",t.selectedItemKey)("minVisibleItemsCount",t.minVisibleItemsCount)("treeNodeTrackerFn",t.treeNodeTrackerFn)("processOnViewItemActionFn",t.processOnViewItemActionFn)("isStrictCheckElementInViewportFn",t.isStrictCheckElementInViewportFn)("getFocusElementFn",t.getFocusElementFn)("getFocusActionFn",t.getFocusActionFn)("onToggleNodeSelectedItemChangeFn",t.onToggleNodeSelectedItemChangeFn)}}function Wt(d,e){if(d&1&&r.\u0275\u0275element(0,"crt-placeholder",40),d&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275property("image",t.placeholder)}}function Xt(d,e){if(d&1&&r.\u0275\u0275template(0,Jt,14,21,"ng-container",4)(1,Wt,1,1,"ng-template",null,1,r.\u0275\u0275templateRefExtractor),d&2){const t=r.\u0275\u0275reference(2),o=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngIf",o.rootSchemaName)("ngIfElse",t)}}const dt="{}",Yt="node-element-in-focus";let p=class te extends nt.K{constructor(){super(...arguments),this._dialogService=(0,r.inject)(et.o),this._messageDialogProvider=(0,r.inject)(St.r),this._rightsService=(0,r.inject)(tt.f),this._translateService=(0,r.inject)(A.TranslateService),this._treeBuilder=(0,r.inject)(D),this._translatePrefix="FolderTree",this._reloadTreeDelay=50,this._processOnNameEnterDelay=100,this._changeSelectedNodeDelay=50,this._focusNodeNameInputDelay=10,this._resetExpandedItemsIfNeedDelay=20,this._setFocusItemDelay=100,this._setFocusItemAfterAddEditableItemDelay=20,this._items$=new l.BehaviorSubject([]),this._favoriteItems$=new l.BehaviorSubject([]),this._hierarchicalItems=[],this._flatItems=[],this._itemsSubscriptions$=new l.Subscription,this._favoriteItemsSubscriptions$=new l.Subscription,this._expandedItems=[m.EM,m.NQ],this._folderNameEntering=!1,this._nodeMenuOpened=!1,this._searchTextValue="",this._canAddNewRecord=!0,this._isConvertFolderAction=!1,this._selectedNodeHasChangesOnSearchMode=!1,this._showMask=!1,this._reloadTreeDebounce=(0,g.debounce)(()=>this._reloadTree(),this._reloadTreeDelay),this._processOnNameEnterDebounce=(0,g.debounce)(e=>this._processOnNameEnter(e),this._processOnNameEnterDelay),this._changeSelectedNodeDebounce=(0,g.debounce)(e=>this._changeSelectedNode(e),this._changeSelectedNodeDelay),this._focusNodeNameInputDebounce=(0,g.debounce)(()=>this._focusNodeNameInput(),this._focusNodeNameInputDelay),this._resetExpandedItemsIfNeedDebounce=(0,g.debounce)(()=>this._resetExpandedItemsIfNeed(),this._resetExpandedItemsIfNeedDelay),this.loadingView=!1,this.placeholder={type:"icon",icon:"folder_tree",width:null,height:null,padding:null},this.folderNameControl=new It.FormControl(null),this.isViewInitializing=!0,this.processOnViewItemActionFn=this._processOnViewItemAction.bind(this),this.isStrictCheckElementInViewportFn=this._isStrictCheckElementInViewport.bind(this),this.getFocusElementFn=this._getFocusElement.bind(this),this.getFocusActionFn=this._getFocusAction.bind(this),this.onToggleNodeSelectedItemChangeFn=()=>{},this.hostBorderRadius=null,this.minVisibleItemsCount=5,this.useStaticFolders=!1,this.sortingOrder=R.ASC,this.readonly=!1,this.activeFolderChanged=new r.EventEmitter,this.folderTreeVisibleChanged=new r.EventEmitter,this.addFolder=new r.EventEmitter,this.copyFolder=new r.EventEmitter,this.deleteFolder=new r.EventEmitter,this.moveFolder=new r.EventEmitter,this.folderRenamed=new r.EventEmitter,this.folderFiltersUpdated=new r.EventEmitter,this.toggleFolderFavorite=new r.EventEmitter,this.folderTreeExpandedItemsChanged=new r.EventEmitter,this.folderChangeRights=new r.EventEmitter,this.convertToStaticFolder=new r.EventEmitter,this._isFavoriteRootNode=e=>this._isFavoriteRootNodeId(e?.id),this._isFavoriteRootNodeId=e=>e===m.NQ,this._isRootNode=e=>this._isRootNodeId(e?.id),this._isRootNodeId=e=>e===m.EM,this.isFavoriteRoot=(e,t)=>this._isFavoriteRootNode(t),this.isFolderNode=(e,t)=>!this._isFavoriteRootNode(t),this.isStaticNode=e=>(0,f.$K)(e.folderTypeId),this.hasChildren=e=>e.expandable,this.isRootNode=e=>this._isRootNode(e)}set selectedNode(e){this._isNotNeedChangeSelectedNode(e)||this._changeSelectedNodeDebounce(e)}get selectedNode(){return this._selectedNode}get selectedItemKey(){return this.selectedNode?.id}get flatItems(){return this._flatItems}get isSearchApplied(){return!(0,g.isEmpty)(this._searchTextValue)}set sourceSchemaName(e){this._sourceSchemaName!==e&&(this._sourceSchemaName=e,this._initializeCanAddNewRecord())}get sourceSchemaName(){return this._sourceSchemaName}set rootSchemaName(e){this._rootSchemaName=e,this.detectChanges()}get rootSchemaName(){return this._rootSchemaName}set showMask(e){setTimeout(()=>{this._showMask=e,this.detectChanges()},e?0:50)}get showMask(){return this._showMask}set items(e){e instanceof ie.A&&(this._itemsSubscriptions$.unsubscribe(),this._itemsSubscriptions$=new l.Subscription,this._itemsSubscriptions$.add(e.changed.subscribe(()=>{this._updateItems(e)}))),this._updateItems(e)}set favoriteItems(e){e instanceof ie.A&&(this._favoriteItemsSubscriptions$.unsubscribe(),this._favoriteItemsSubscriptions$=new l.Subscription,this._favoriteItemsSubscriptions$.add(e.changed.subscribe(()=>{this._updateFavoriteItems(e)}))),this._updateFavoriteItems(e)}set activeFolderId(e){this._isNotNeedChangeActiveFolderId(e)||(this._activeFolderId=e,!this._isUnsavedFolder(e)&&this._initSelectedNode(e))}set expandedItems(e){Array.isArray(e)&&this._hasExpandedItemsChanges(e)&&(this._expandedItems=e)}get expandedItems(){return this._expandedItems}set borderRadius(e){this._initializeHostBorderRadius(e)}_initSelectedNode(e){this.selectedNode=this._flatItems.find(t=>t.id===e)}_changeSelectedNode(e){if(this.isSearchApplied&&(this._selectedNodeHasChangesOnSearchMode=!0),this._isNeedChangeSelectedNodeToRootNode(e)){this._changeSelectedNodeToRootNode();return}this._selectedNode=e,this._emitActiveFolderChanged(this._isRootNode(e)?null:e),this._expandParentsIfNeed(e)}_changeSelectedNodeToRootNode(){this._selectedNode=this._flatItems.find(e=>this._isRootNode(e)),this._emitActiveFolderChanged(null)}_isNeedChangeSelectedNodeToRootNode(e){return!e&&!this._isRootNode(this._selectedNode)||!!e&&!this._flatItems.some(t=>t.id===e.id)}_isNotNeedChangeSelectedNode(e){return this._selectedNode===e||!e&&this._isRootNode(this._selectedNode)}_isNotNeedChangeActiveFolderId(e){return this._activeFolderId===e||(0,j.gZ)(this._activeFolderId)&&(0,j.gZ)(e)}_updateItems(e){Promise.all((e??[]).map(function(){var t=(0,u.A)(function*(o){return{id:yield o.Id,name:yield o.Name,parentId:yield o.ParentId,filterData:yield o.FilterData,isFavorite:!1,folderTreeId:yield o.Id,folderTypeId:yield o.FolderTypeId,isFavoriteToggleInProgress:!1}});return function(o){return t.apply(this,arguments)}}())).then(t=>{this._items$.next(t||[]),this._setLoadingView(!0),this._reloadTreeDebounce()})}_updateFavoriteItems(e){Promise.all((e??[]).map(function(){var t=(0,u.A)(function*(o){return{id:yield o.Id,name:yield o.Name,parentId:null,folderTreeId:yield o.FolderTreeId,folderTypeId:yield o.FolderTypeId,filterData:yield o.FilterData,isFavorite:!0,isFavoriteToggleInProgress:!1}});return function(o){return t.apply(this,arguments)}}())).then(t=>{this._favoriteItems$.next(t||[]),this._setLoadingView(!0),this._reloadTreeDebounce()})}_reloadTree(){this._mapHasFavoriteItems(),this._updateTreeData(),(0,j.gZ)(this._activeFolderId)||this._initSelectedNode(this._activeFolderId)}_mapHasFavoriteItems(){this._items$.value.forEach(e=>{const t=this._favoriteItems$.value.find(o=>o.folderTreeId===e.id);e.hasFavorite=!!t,e.favoriteId=t?.id})}_updateTreeData(){this._hierarchicalItems=this._getFolderTreeHierarchicalNodes(),this._flatItems=this._getFlatNodesFromHierarchicalItems(),this._resetExpandedItemsIfNeedDebounce(),this._setLoadingView(!1)}_getFolderTreeHierarchicalNodes(){const e=[this._getVirtualNode(this._createVirtualFavoriteRootNodeItem(),this._favoriteItems$.value),this._getVirtualNode(this._createVirtualRootNodeItem(),this._items$.value)].filter(Boolean),t=this._treeBuilder.filterTreeBySearchText(e,this._searchTextValue,[m.EM,m.NQ]);return this._verifyAvailableFavoriteChildNodes(t),t}_getVirtualNode(e,t){if(!e)return null;const o=this._treeBuilder.createNode(e);return o.children=this._treeBuilder.build(t,this.sortingOrder),o}_createVirtualFavoriteRootNodeItem(){return(0,g.isEmpty)(this._items$.value)||(0,g.isEmpty)(this._favoriteItems$.value)?null:{id:m.NQ,name:this._translate("FavoritesNodeCaption"),isFavorite:!0}}_createVirtualRootNodeItem(){return{id:m.EM,name:this._translate("RootNodeCaption")}}_verifyAvailableFavoriteChildNodes(e){const t=e.find(n=>this._isFavoriteRootNode(n)),o=e.find(n=>this._isRootNode(n));!t&&!o||!t||(t.children=t.children.filter(n=>this._hasParentHierarchicalNode(this._items$.value,n)))}_hasParentHierarchicalNode(e,t){const o=e.find(n=>n.folderTreeId===t.folderTreeId);return this._hasParentNode(e,o)}_hasParentNode(e,t){if(!t)return!1;if(!t.parentId)return!0;const o=e.find(n=>n.folderTreeId===t.parentId);return this._hasParentNode(e,o)}_getFlatNodesFromHierarchicalItems(){const e=[];return this._addFlatNodesToArray(e,this._hierarchicalItems,null,0),e}_addFlatNodesToArray(e,t,o,n){t?.forEach(i=>{e.push(this._castHierarchicalNodeToFlat(i,o,n)),i.children?.length>0&&this._addFlatNodesToArray(e,i.children,i.id,n+1)})}_castHierarchicalNodeToFlat(e,t,o){return{id:e.id,name:e.name,folderTreeId:e.folderTreeId,folderTypeId:e.folderTypeId,parentId:t,favoriteId:e.favoriteId,filterData:e.filterData,isNew:e.isNew,isCopy:e.isCopy,isMove:e.isMove,sourceId:e.sourceId,editable:e.editable,hasFavorite:e.hasFavorite,isFavorite:e.isFavorite,isFavoriteToggleInProgress:e.isFavoriteToggleInProgress,expandable:e.children?.length>0,level:o}}_resetExpandedItemsIfNeed(){let e=[];if(this.isSearchApplied){this.virtualScrollTreeView.expandAll();return}this._activeFolderId&&!this.isSearchApplied&&this._selectedNodeHasChangesOnSearchMode&&(e=this._getParentIdsForExpand(this._flatItems.find(t=>t.id===this._activeFolderId))),e=(0,g.uniq)([...e,...this._getParentIdsForExpand(this._flatItems.find(t=>t.isNew||t.isCopy||t.isMove))]),e.length&&this._updateExpandedItems([...this._expandedItems,...e])}_expandParentsIfNeed(e,t=!1){if(!e)return;if(this.isSearchApplied){this.virtualScrollTreeView.expandAll();return}const o=this._getParentIdsForExpand(e);!o.length&&!t||this._updateExpandedItems([...this._expandedItems,...o])}_getParentIdsForExpand(e){if(!e)return[];const t=this._getHierarchicalParentIds(e),o=[];return t.forEach(n=>{this._expandedItems.includes(n)||o.push(n)}),o}_getHierarchicalParentIds(e){return!e||(0,g.isEmpty)(e.parentId)?[]:[e.parentId,...this._getHierarchicalParentIds(this._flatItems.find(t=>t.id===e.parentId))].filter(Boolean)}_updateSearchFilterValue(e){this._searchTextValue=e||"",this._updateTreeData(),this.isSearchApplied||(this._selectedNodeHasChangesOnSearchMode?this._expandParentsIfNeed(this._selectedNode,!0):this._expandedItems=[...this._expandedItems]),!this.isSearchApplied&&this._selectedNodeHasChangesOnSearchMode&&(this._selectedNodeHasChangesOnSearchMode=!1,this.virtualScrollTreeView.virtualScrollViewport.scrollToItem(this._activeFolderId))}_initializeHostBorderRadius(e){let t;switch(e){case z.Z.Small:t="4px";break;case z.Z.Medium:t="8px";break;case z.Z.Large:t="16px";break;case z.Z.Default:case z.Z.None:t=null;break;default:t=null;break}this.hostBorderRadius=t}_initializeCanAddNewRecord(){var e=this;return(0,u.A)(function*(){if(!e.sourceSchemaName)return;const t=yield(0,l.firstValueFrom)(e._rightsService.getCanEdit({schemaName:e.sourceSchemaName,isNew:!0}));e._canAddNewRecord=t.result})()}_getAddFolderMenuItems(e){const t=[{type:"action",icon:"folder-icon",caption:this._translate("MenuActions.AddFolder"),code:"addFolder",handler:this._addNewItem.bind(this,e,m.Ss)}];return this.useStaticFolders&&t.push({type:"action",icon:"folder-static-icon",caption:this._translate("MenuActions.AddStaticFolder"),code:"addStaticFolder",handler:this._addNewItem.bind(this,e,m.Xi)}),t}_addNewItem(e,t){if(this._folderNameEntering)return;if(!this._canAddNewRecord){this._showHasNotPermissionDialog();return}this._setFolderNameControlValue(this._translate("DefaultFolderName"));const o=this._getSelectedNodeForNewItem(e),n=o?this._getFolderId(o):null;this._addNewEditableItemAndFocusOnIt({name:"",parentId:n,isCopy:!1,folderTypeId:t})}_moveItemNode(e){var t=this;return(0,u.A)(function*(){if(!(yield t._isCanEditFolder(e))){t._showHasNotPermissionDialog();return}const n=yield t._openSelectFolderDialog(e);t._processFolderTreeSelectFolderDialogResponse(n,e)})()}_openSelectFolderDialog(e){const t=this._getFolderId(e);return(0,l.lastValueFrom)(this._dialogService.open(O,{data:{folderTreeItems:this._getFolderDataItems(this._items$.value,t),favoriteTreeItems:this._getFolderDataItems(this._favoriteItems$.value,t),rootSchemaName:this.rootSchemaName},width:"600px",height:"700px",panelClass:"crt-folder-tree-select-folder-dialog"}))}_getFolderDataItems(e,t){return e.filter(o=>o.folderTreeId!==t).map(o=>this._convertFolderTreeNodeDataToDataItem(o))}_convertFolderTreeNodeDataToDataItem(e){return{Id:e.id,Name:e.name,ParentId:e.parentId,FolderTreeId:e.folderTreeId,FilterData:e.filterData,FolderTypeId:e.folderTypeId,IsFavorite:e.isFavorite}}_processFolderTreeSelectFolderDialogResponse(e,t){e.status!==H.Selected||!e?.selectedFolderId||(this._updateNodePropertyValue(t,"parentId",e.selectedFolderId),this._updateNodePropertyValue(t,"isMove",!0),this._resetExpandedItemsIfNeed(),this._updateTreeData(),this.activeFolderId=t.id,this._emitMoveFolder(t,e.selectedFolderId),setTimeout(()=>{this.virtualScrollTreeView.focusedItemKey=t.id,this.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,t.id)},this._setFocusItemDelay))}_emitMoveFolder(e,t){const o=this._getFolderId(e);this.moveFolder.emit({folderId:o,sourceSchemaName:this.sourceSchemaName,reloadFavorites:e.isFavorite||e.hasFavorite,parentId:this._getCorrectParentIdForMoveFolder(t)})}_getCorrectParentIdForMoveFolder(e){return e===m.EM?null:e}_renameItemNode(e){var t=this;return(0,u.A)(function*(){if(!(yield t._isCanEditFolder(e))){t._showHasNotPermissionDialog();return}t._setFolderNameControlValue(e.name),t._setEditableMode(e,!0),t._focusNodeNameInputDebounce()})()}_copyItemNode(e){if(!this._canAddNewRecord){this._showHasNotPermissionDialog();return}const t=this._flatItems.find(i=>i.id===this._getFolderId(e)),o=`${t.name} - ${this._translate("CopyFolderSuffix")}`;this._setFolderNameControlValue(o);const n=this._findDirectParentId(t.id);this._addNewEditableItemAndFocusOnIt({name:o,parentId:n,isCopy:!0,sourceId:t.id,filterData:t.filterData,folderTypeId:t.folderTypeId})}_removeItemNode(e){var t=this;return(0,u.A)(function*(){if(!(yield t._isCanRemoveFolder(e))){t._showHasNotPermissionDialog();return}if(yield(0,l.lastValueFrom)(t._messageDialogProvider.confirmation(t._translate("DeleteConfirmation")))){if(t._emitDeleteFolder(t._getFolderId(e)),e.id===t.selectedNode?.id){t.selectedNode=null,t.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,m.EM,!1);return}t.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,t.selectedNode?.id,!1);return}t.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,e.id)})()}_loadRightsModule(e){this._emitFolderChangeRights(e)}_convertToStaticFolder(e){this._isConvertFolderAction=!0,this._addNewItem(e,m.Xi)}_processSetupFolderDialogResponse(e,t){if(e.status!==B.Saved)return;let o=e.filterParams.filters;(0,f.SK)(this.sourceSchemaName)&&(o=(0,Nt.s)(o));const n=JSON.stringify(o);this._emitFolderFiltersUpdated(t,n),this._updateNodePropertyValue(t,"filterData",n)}_processOnNameEnter(e){try{this._processingFolderNameEnter(e)}finally{this._updateTreeData(),setTimeout(()=>{this.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,e.id),this._folderNameEntering=!1},this._setFocusItemDelay)}}_processingFolderNameEnter(e){this._findNewItem()?this._emitInsertFolder()||this._removeNewItemNode():this._emitRenameFolder(e)}_removeNewItemNode(){this._items$.next(this._items$.value.filter(e=>!e.editable))}_emitInsertFolder(){const e=this.folderNameControl.value;if(!e)return!1;const t=this._findNewItem(),o=this._flatItems.find(n=>n.id===t.id);return t.isCopy?this._emitCopyFolder(t,t.sourceId,e):this._isConvertFolderAction?this._emitConvertToStaticFolder(t,e):this._emitAddFolder(t,e),this.activeFolderId=t.id,this._setupDefaultValuesForNewItem(t,e),this._setupDefaultValuesForNewItem(o,e),!0}_emitRenameFolder(e){const t=this.folderNameControl.value;if(!t){this._setEditableMode(e,!1);return}this._emitFolderRenamed(e,t),this._updateNodePropertyValue(e,"name",t),this._setEditableMode(e,!1)}_setupDefaultValuesForNewItem(e,t){e.name=t,e.editable=!1,e.isNew=!1,e.isCopy=!1,e.sourceId=void 0}_setEditableMode(e,t){const o=(e.isFavorite?this._favoriteItems$.value:this._items$.value).find(n=>n.id===e.id);o.editable=t,e.editable=t,this.detectChanges()}_updateNodePropertyValue(e,t,o){const n=this._getFolderId(e),i=this._items$.value.find(_=>_.id===n);i[t]=o;const c=this._flatItems.find(_=>_.id===n);if(c[t]=o,e.isFavorite){const _=this._favoriteItems$.value.find(y=>y.id===e.id);_[t]=o;const F=this._flatItems.find(y=>y.id===e.id);F[t]=o}}_getSelectedNodeForNewItem(e){return e||(this.selectedNode&&this._flatItems.some(t=>t.id===this.selectedNode.id)&&this.selectedNode.id!==m.EM?this.selectedNode:null)}_setFolderNameControlValue(e){this.folderNameControl.setValue(e)}_addNewEditableItemAndFocusOnIt(e){const t=this._addNewEditableItem(e);this._updateTreeData(),setTimeout(()=>{this.virtualScrollTreeView.focusedItemKey=t,this.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,t)},this._setFocusItemAfterAddEditableItemDelay)}_addNewEditableItem(e){const t=(0,j.qv)();return this._items$.value.push({name:e.name,id:t,editable:!0,isNew:!0,isCopy:e.isCopy,sourceId:e.sourceId,parentId:e.parentId??null,filterData:e.filterData,folderTreeId:t,folderTypeId:e.folderTypeId}),t}_isCanEditFolder(e){var t=this;return(0,u.A)(function*(){if(!t.sourceSchemaName||!e)return!0;const o=t._getFolderId(e);return(yield(0,l.firstValueFrom)(t._rightsService.getCanEdit({schemaName:t.sourceSchemaName,isNew:!1,primaryColumnValue:o}))).result})()}_isCanRemoveFolder(e){var t=this;return(0,u.A)(function*(){if(!t.sourceSchemaName||!e)return!0;const o=t._getFolderId(e);return(yield(0,l.firstValueFrom)(t._rightsService.getCanDelete({schemaName:t.sourceSchemaName,primaryColumnValue:o}))).result})()}_showHasNotPermissionDialog(){var e=this;return(0,u.A)(function*(){yield(0,l.lastValueFrom)(e._messageDialogProvider.error(e._translate("HasNotPermission")))})()}_emitActiveFolderChanged(e){this._activeFolderId=e?.id,this.activeFolderChanged.emit({id:e?.id??"",filterData:e?.filterData??dt,folderTreeId:e?.folderTreeId??"",folderTypeId:e?.folderTypeId,rootSchemaName:this.rootSchemaName,name:e?.name??"",isFavorite:e?.isFavorite??!1})}_emitFolderTreeVisibleChanged(){this.folderTreeVisibleChanged.emit({visible:!1})}_emitAddFolder(e,t){this.addFolder.emit(this._getAddFolderEmitParameters(e,t))}_emitCopyFolder(e,t,o){const n=this._flatItems.find(i=>i.id===e.sourceId).name;this._messageDialogProvider.confirmation(b.String.format(this._translate("CopyRightsQuestion"),n)).subscribe(i=>this.copyFolder.emit({folderId:e.id,folderName:o,rootSchemaName:this.rootSchemaName,sourceSchemaName:this.sourceSchemaName,sourceId:t,filterData:e.filterData,parentId:e.parentId,reloadFavorites:!1,copyRights:i}))}_emitDeleteFolder(e){this.deleteFolder.emit({folderId:e,reloadFavorites:this._hasAnyFavoriteChildrenNodes(this._searchNode(this._hierarchicalItems,e)),sourceSchemaName:this.sourceSchemaName})}_emitFolderRenamed(e,t){this.folderRenamed.emit({folderId:this._getFolderId(e),folderName:t,sourceSchemaName:this.sourceSchemaName,reloadFavorites:e.isFavorite||e.hasFavorite})}_emitFolderFiltersUpdated(e,t){this.folderFiltersUpdated.emit({folderId:this._getFolderId(e),sourceSchemaName:this.sourceSchemaName,filterData:t,reloadFavorites:e.isFavorite||e.hasFavorite})}_emitToggleFolderFavorite(e){this.toggleFolderFavorite.emit({id:e.id,favoriteId:e.isFavorite?e.id:e.favoriteId,rootSchemaName:this.rootSchemaName,sourceSchemaName:this.sourceSchemaName,status:!(e.hasFavorite||e.isFavorite)})}_emitFolderTreeExpandedItemsChanged(){this.folderTreeExpandedItemsChanged.emit({expandedItems:this._expandedItems})}_emitFolderChangeRights(e){this.folderChangeRights.emit({entitySchemaName:this.sourceSchemaName,primaryColumnValue:this._getFolderId(e),primaryDisplayColumnValue:e.name})}_emitConvertToStaticFolder(e,t){this._isConvertFolderAction=!1,this.convertToStaticFolder.emit(this._getAddFolderEmitParameters(e,t))}_getAddFolderEmitParameters(e,t){return{folderId:e.id,folderName:t,rootSchemaName:this.rootSchemaName,sourceSchemaName:this.sourceSchemaName,folderTypeId:e.folderTypeId,filterData:e.filterData,parentId:e.parentId,reloadFavorites:!1}}_hasAnyFavoriteChildrenNodes(e){if(e.isFavorite||e.hasFavorite)return!0;if(e.children)for(const t of e.children){const o=this._hasAnyFavoriteChildrenNodes(t);if(o)return o}return!1}_searchNode(e,t){for(const o of e){const n=this._hierarchicalSearchNode(o,t);if(n)return n}}_hierarchicalSearchNode(e,t){if(e&&e.id===t)return e;if(e.children)for(const o of e.children){const n=this._hierarchicalSearchNode(o,t);if(n)return n}return null}_preventEventDefault(e){e?.preventDefault(),e?.stopPropagation()}_translate(e){return this._translateService.instant(`${this._translatePrefix}.${e}`)}_isUnsavedFolder(e){const t=this._items$.value.find(o=>o.id===e);return!!(t?.isCopy||t?.isNew||t?.isMove)}_hasExpandedItemsChanges(e){return(0,g.difference)(e,this._expandedItems).length>0||(0,g.difference)(this._expandedItems,e).length>0}_focusNodeNameInput(){this.folderNameInput.focus(),this.folderNameInput.select()}_findDirectParentId(e){return this._items$.value.find(t=>t.id===e)?.parentId}_findNewItem(){return this._items$.value.find(e=>e.isNew)}_getFolderId(e){return e.isFavorite?e.folderTreeId:e.id}_updateExpandedItems(e){this._expandedItems=(0,g.uniq)([...e].filter(Boolean)),this._emitFolderTreeExpandedItemsChanged()}_createOrEditFolderFilters(e){var t=this;return(0,u.A)(function*(){if(!(yield t._isCanEditFolder(e))){t._showHasNotPermissionDialog();return}const n=e?.filterData,i=yield(0,l.lastValueFrom)(t._dialogService.open(K,{data:{entitySchemaName:t.rootSchemaName,filters:n?JSON.parse(n):void 0},panelClass:"folder-tree-filters-dialog",disableClose:!0}));t._processSetupFolderDialogResponse(i,e)})()}_getEditableNode(){return this._flatItems.find(e=>e.editable)}_setLoadingView(e){setTimeout(()=>{this.loadingView=e,this.detectChanges()},e?0:50)}_processOnViewItemAction(e,t,o,n){switch(e){case"viewItemElementClick":this._processViewItemElementClick(t,o,n);break;case"viewItemElementKeyDown":this._processViewItemElementKeydown(t,o,n);break;case"viewTreeItemElementExpand":case"viewTreeItemElementCollapse":this._processTreeViewItemElemendToggle(n);break;case"viewItemElementFocusIn":this._processViewItemElementFocusIn(t,o,n);break;case"viewItemElementFocusOut":this._processViewItemElementFocusOut(t,o,n);break;case"resetFocusState":this._processResetFocusState(n);break;default:n();break}}_processViewItemElementClick(e,t,o){this._isNotAllowProcessViewItemElementClick(e,t)||o()}_isNotAllowProcessViewItemElementClick(e,t){return t.target.tagName==="INPUT"||this._isFavoriteRootNodeId(e)}_processViewItemElementKeydown(e,t,o){const n=this._getEditableNode();n&&this._processViewItemElementKeydownOnEditableNode(n,t)||!n&&this._processViewItemElementKeydownOnNonEditableNode(e,t)||o()}_processViewItemElementKeydownOnEditableNode(e,t){return this.virtualScrollTreeView.virtualScrollViewport.isVirtualFocusItemInFocus?this._processViewItemElementKeydownOnVirtualEditableNode(e,t):this._processViewItemElementKeydownOnNonVirtualEditableNode(e,t)}_processViewItemElementKeydownOnVirtualEditableNode(e,t){if(this._isNavigationKeydownEvent(t))return!0;if(t.key===T.Key.Enter)return this.virtualScrollTreeView.virtualScrollViewport.isVirtualFocusItemInFocus=!1,this._preventEventDefault(t),this.onNameEnter(e),!0;if(t.key.length!==1)return!1;this._preventEventDefault(t);const o=this.folderNameControl.value||"";return this.folderNameControl.setValue(o+t.key),this.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,e.id),!0}_isNavigationKeydownEvent(e){return e.key===T.Key.ArrowDown||e.key===T.Key.ArrowUp||this._isHorizontalNavigationKeydownEvent(e)}_isHorizontalNavigationKeydownEvent(e){return e.key===T.Key.ArrowLeft||e.key===T.Key.ArrowRight}_processViewItemElementKeydownOnNonVirtualEditableNode(e,t){return t.key===T.Key.Enter||this._isHorizontalNavigationKeydownEvent(t)?!0:t.key!==T.Key.Escape?!1:(this.folderNameControl.setValue("",{emitEvent:!1}),this._preventEventDefault(t),this.onNameEnter(e),!0)}_processViewItemElementKeydownOnNonEditableNode(e,t){return this._isNotAllowProcessViewItemElementSelectKeydownEvent(e,t)||this._isNotAllowProcessViewItemElementCollapseExpandKeydownEvent(t)}_isNotAllowProcessViewItemElementSelectKeydownEvent(e,t){return(t.key===T.Key.Enter||t.key===" ")&&(this._isFavoriteRootNodeId(e)||!this._isKeyboardEventOnSameTargetElement(t))}_isNotAllowProcessViewItemElementCollapseExpandKeydownEvent(e){return(e.key===T.Key.ArrowLeft||e.key===T.Key.ArrowRight)&&(this.isSearchApplied||!this._isKeyboardEventOnSameTargetElement(e))}_processTreeViewItemElemendToggle(e){this.isSearchApplied||e()}_processViewItemElementFocusIn(e,t,o){this._nodeMenuOpened=!1,o()}_processViewItemElementFocusOut(e,t,o){if(this._nodeMenuOpened||this.virtualScrollTreeView.viewItems.find(c=>c.itemKey===e)?.nativeElement.contains(t.relatedTarget||t.target))return;const i=this._getEditableNode();if(i){this._preventEventDefault(t),this.onNameEnter(i);return}!i&&this._flatItems.find(_=>_.id===e)?.isFavoriteToggleInProgress||o()}_processResetFocusState(e){const t=this._getEditableNode();t&&this.virtualScrollTreeView.focusedItemKey!==t.id&&(this.virtualScrollTreeView.focusedItemKey=t.id),e()}_isStrictCheckElementInViewport(e){return!this._getEditableNode()}_getFocusElement(e,t,o){const n=this._getEditableNode();return n?t.find(i=>i.itemKey===n.id)?.nativeElement:o()}_getFocusAction(e,t,o){return this._getEditableNode()?this._focusNodeNameInputDebounce.bind(this):o}_isKeyboardEventOnSameTargetElement(e){return e.target===e.currentTarget&&e.currentTarget instanceof HTMLElement}getClasses(){const e=super.getClasses()||[];return this.readonly&&e.push("crt-folder-tree-readonly"),e}getAddMenuItems(){return this._getAddFolderMenuItems(null)}getNodeMenuItems(e){const t=this._getAddFolderMenuItems(e),o={type:"action",icon:"edit-icon",caption:this._translate("MenuActions.RenameFolder"),code:"renameFolder",handler:this._renameItemNode.bind(this)},n={type:"action",icon:"copy-icon",caption:this._translate("MenuActions.CopyFolder"),code:"copyFolder",handler:this._copyItemNode.bind(this)},i={type:"action",icon:"move-folder",caption:this._translate("MenuActions.MoveFolder"),code:"moveFolder",handler:this._moveItemNode.bind(this)},c={type:"action",icon:"trash-icon",caption:this._translate("MenuActions.DeleteFolder"),code:"deleteFolder",handler:this._removeItemNode.bind(this)},_={type:"action",icon:"contact-lock-icon",caption:this._translate("MenuActions.ChangeFolderRights"),code:"changeFolderRights",handler:this._loadRightsModule.bind(this)},F={type:"action",icon:"convert-to-static-icon",caption:this._translate("MenuActions.ConvertToStaticFolder"),code:"convertToStaticFolder",visible:this.useStaticFolders,handler:this._convertToStaticFolder.bind(this)},y=this.isStaticNode(e)?[...t,o,i,c,_]:[...t,F,o,n,i,c,_],Ee=[o,c,_];return e.isFavorite?Ee:y}createOrEditFolderFilters(e){this._createOrEditFolderFilters(e)}onFolderTreeHideClick(){this._emitFolderTreeVisibleChanged()}onNameKeydown(e,t){e.key===T.Key.Enter&&this.onNameEnter(t)}addNewItem(e,t){this._addNewItem(e,t)}onNameEnter(e){this.virtualScrollTreeView.virtualScrollViewport.isVirtualFocusItemInFocus||this._folderNameEntering||(this._folderNameEntering=!0,this._processOnNameEnterDebounce(e))}onToggleFolderFavorite(e,t){const o=!(t.hasFavorite||t.isFavorite);t.isFavorite&&!o&&this._preventEventDefault(e),this._updateNodePropertyValue(t,"isFavoriteToggleInProgress",!0),o&&!this._expandedItems.includes(m.NQ)&&this._expandedItems.push(m.NQ),this._emitToggleFolderFavorite(t)}ngAfterViewInit(){this.isViewInitializing=!1}ngOnDestroy(){this._itemsSubscriptions$.unsubscribe(),this._favoriteItemsSubscriptions$.unsubscribe()}onMenuActionsClick(e){this._preventEventDefault(e)}treeNodeTrackerFn(e,t){return{id:t.key,name:t.item.name,parentId:t.parentKey,level:t.level,hasFavorite:t.item.hasFavorite,expandable:t.expandable,editable:t.item.editable,isCopy:t.item.isCopy,isMove:t.item.isMove}}onCloseMenu(){this._nodeMenuOpened=!1}onOpenMenu(){this._nodeMenuOpened=!0}onSearchFilterChanged(e){this._updateSearchFilterValue(e?.value)}onExpandedItemsChanged(e){this.isSearchApplied||this._updateExpandedItems(e)}onSelectedItemKeyChange(e){this._initSelectedNode(e)}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=r.\u0275\u0275getInheritedFactory(te)))(o||te)}})()}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:te,selectors:[["crt-folder-tree"]],viewQuery:function(t,o){if(t&1&&(r.\u0275\u0275viewQuery(ot.o,5),r.\u0275\u0275viewQuery(rt.j,5)),t&2){let n;r.\u0275\u0275queryRefresh(n=r.\u0275\u0275loadQuery())&&(o.virtualScrollTreeView=n.first),r.\u0275\u0275queryRefresh(n=r.\u0275\u0275loadQuery())&&(o.folderNameInput=n.first)}},hostVars:2,hostBindings:function(t,o){t&2&&r.\u0275\u0275styleProp("border-radius",o.hostBorderRadius)},inputs:{sourceSchemaName:"sourceSchemaName",rootSchemaName:"rootSchemaName",showMask:"showMask",minVisibleItemsCount:"minVisibleItemsCount",useStaticFolders:"useStaticFolders",sortingOrder:"sortingOrder",readonly:"readonly",items:"items",favoriteItems:"favoriteItems",activeFolderId:"activeFolderId",expandedItems:"expandedItems",borderRadius:"borderRadius"},outputs:{activeFolderChanged:"activeFolderChanged",folderTreeVisibleChanged:"folderTreeVisibleChanged",addFolder:"addFolder",copyFolder:"copyFolder",deleteFolder:"deleteFolder",moveFolder:"moveFolder",folderRenamed:"folderRenamed",folderFiltersUpdated:"folderFiltersUpdated",toggleFolderFavorite:"toggleFolderFavorite",folderTreeExpandedItemsChanged:"folderTreeExpandedItemsChanged",folderChangeRights:"folderChangeRights",convertToStaticFolder:"convertToStaticFolder"},features:[r.\u0275\u0275ProvidersFeature([D]),r.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[["folder_tree_template",""],["no_schema_root",""],["addMenu",""],["nodeMenu",""],[4,"ngIf","ngIfElse"],[1,"folder-tree-container",3,"ngClass"],["class","component-mask",4,"ngIf"],[1,"folder-tree-header"],["data-item-marker","folderTreeSearch",3,"valueChange"],[4,"ngIf"],[1,"close-tree-btn",3,"click","keydown.enter","crtAccessibleAttributes"],["svgIcon","close-icon"],[3,"ngClass"],["class","folder-tree-blankslate",4,"ngIf"],["itemKeyPropertyName","id","itemParentKeyPropertyName","parentId","itemExpandablePropertyName","expandable","itemLevelPropertyName","level",3,"expandedItemsChanged","selectedItemKeyChange","items","expandedItems","selectedItemKey","minVisibleItemsCount","treeNodeTrackerFn","processOnViewItemActionFn","isStrictCheckElementInViewportFn","getFocusElementFn","getFocusActionFn","onToggleNodeSelectedItemChangeFn"],["crtVirtualScrollTreeViewItemOutlet",""],[1,"component-mask"],[1,"new-folder-btn",3,"click","title"],["svgIcon","folder-add-icon"],[1,"new-folder-btn",3,"crtMenuTriggerFor","title"],[3,"menuItems"],[1,"folder-tree-blankslate"],[1,"blankslate-message"],[1,"crt-folder-tree-view-node"],[1,"prefix-node"],["svgIcon","star-filled-icon"],[1,"node-text"],[3,"svgIcon"],["class","suffix-node-sticky-container",4,"ngIf"],["labelPosition","hidden",1,"node-name-input",3,"blurred","keyDown","focusin","focusout","control"],[1,"suffix-node-sticky-container"],["class","suffix-node",4,"ngIf"],[1,"suffix-node"],[1,"node-menu-button","add-to-favorite",3,"click","id","title","disabled"],[1,"node-menu-icon",3,"svgIcon"],["class","node-menu-button",3,"id","title","click",4,"ngIf"],[1,"node-menu-button",3,"click","menuClosed","menuOpened","id","crtMenuTriggerFor","crtMenuTriggerData","title"],["svgIcon","more-vertical-button-icon",1,"node-menu-icon"],[1,"node-menu-button",3,"click","id","title"],["svgIcon","filter-column-icon",1,"node-menu-icon"],["title","","subhead","",3,"image"]],template:function(t,o){if(t&1&&r.\u0275\u0275template(0,Dt,1,0,"crt-skeleton-loader",4)(1,Xt,3,2,"ng-template",null,0,r.\u0275\u0275templateRefExtractor),t&2){const n=r.\u0275\u0275reference(2);r.\u0275\u0275property("ngIf",o.isViewInitializing)("ngIfElse",n)}},dependencies:[P.NgClass,P.NgIf,bt.W,W.MatIcon,at.I,xt.Q,st.IK,ae.O,rt.j,Et.d,ot.o,Pt.c,Be.X,A.TranslatePipe],styles:["[_nghost-%COMP%]{display:block;height:100%;background-color:unset;overflow:auto;transform:translateZ(0)}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]{position:relative;display:inherit;width:inherit;height:inherit;--padding-left: 24px}[_nghost-%COMP%]   .folder-tree-container.crt-folder-tree-readonly[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button.close-tree-btn[_ngcontent-%COMP%]{margin-inline-start:auto}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{height:16px;width:16px;font-size:16px;line-height:16px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]{height:40px;display:flex;justify-content:flex-start;align-items:center;padding-inline-start:var(--padding-left);box-sizing:border-box}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   crt-search-filter[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background-color:inherit;display:flex;align-items:center;cursor:pointer;padding:0}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button.new-folder-btn[_ngcontent-%COMP%]{margin-inline-start:auto;margin-inline-end:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button.new-folder-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:4px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button.close-tree-btn[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]{width:100%;height:calc(100% - 40px)}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   .folder-tree-blankslate[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   .folder-tree-blankslate[_ngcontent-%COMP%]   .blankslate-message[_ngcontent-%COMP%]{padding:20px 0}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;min-height:40px;white-space:nowrap;outline:none;align-items:center;flex:1;word-wrap:break-word}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .suffix-node-sticky-container[_ngcontent-%COMP%]{display:flex;flex-direction:row-reverse;width:100%}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .suffix-node-sticky-container[_ngcontent-%COMP%]   .suffix-node[_ngcontent-%COMP%]{display:flex;position:sticky;right:8px;left:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .suffix-node-sticky-container[_ngcontent-%COMP%]   .suffix-node[_ngcontent-%COMP%]   .node-menu-button[_ngcontent-%COMP%]{padding:0;border:none;background-color:transparent;display:flex;align-items:center;justify-content:center;width:16px;height:16px;cursor:pointer;margin-inline-start:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .suffix-node-sticky-container[_ngcontent-%COMP%]   .suffix-node[_ngcontent-%COMP%]   .node-menu-button[_ngcontent-%COMP%]:focus   .node-menu-icon[_ngcontent-%COMP%]{visibility:inherit}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .prefix-node[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .node-text[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;padding-inline-start:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .node-name-input[_ngcontent-%COMP%]{padding-top:6px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .node-menu-icon[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node{gap:unset;--node-padding: 16px;--root-node-padding: var(--padding-left)}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.child-node .prefix-node{margin-inline-start:16px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node:hover .crt-folder-tree-view-node .node-menu-icon, [_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.crt-virtual-scroll-view-item-focused .crt-folder-tree-view-node .node-menu-icon{visibility:unset}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree.crt-folder-tree-search-applied[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node .node-toggle-icon{cursor:default;pointer-events:none}"],changeDetection:0})}};(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",b.String),(0,a.__metadata)("design:paramtypes",[b.String])],p.prototype,"sourceSchemaName",null),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",b.String),(0,a.__metadata)("design:paramtypes",[b.String])],p.prototype,"rootSchemaName",null),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],p.prototype,"showMask",null),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",Object)],p.prototype,"minVisibleItemsCount",void 0),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",Object)],p.prototype,"useStaticFolders",void 0),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",Object)],p.prototype,"sortingOrder",void 0),(0,a.__decorate)([(0,v.k)({propertyBindable:!0,defaultValue:!1,propertyName:yt.R.Readonly}),(0,a.__metadata)("design:type",Object)],p.prototype,"readonly",void 0),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",Object),(0,a.__metadata)("design:paramtypes",[Object])],p.prototype,"items",null),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",Object),(0,a.__metadata)("design:paramtypes",[Object])],p.prototype,"favoriteItems",null),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",b.String),(0,a.__metadata)("design:paramtypes",[b.String])],p.prototype,"activeFolderId",null),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],p.prototype,"expandedItems",null),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",b.String),(0,a.__metadata)("design:paramtypes",[b.String])],p.prototype,"borderRadius",null),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"activeFolderChanged",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderTreeVisibleChanged",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"addFolder",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"copyFolder",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"deleteFolder",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"moveFolder",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderRenamed",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderFiltersUpdated",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"toggleFolderFavorite",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderTreeExpandedItemsChanged",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderChangeRights",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"convertToStaticFolder",void 0),p=(0,a.__decorate)([(0,We.v)({type:"crt.FolderTree",reuseStrategy:Xe.B.Rerender}),(0,Ye.f)({toolbarConfig:{position:60,hint:"Components.FolderTree.Hint",icon:s(19010),defaultPropertyValues:{sourceSchemaName:m.uE}},designViewItemCommands:{create:"crt.AddFilterViewItemCommand",update:"crt.ChangeFolderTreeViewItemCommand",delete:"crt.RemoveFolderTreeViewItemCommand",copy:"crt.CopyFolderTreeViewItemCommand"},propertiesPanelComponentTypeName:"crt.FolderTreePropertiesPanel",typeCaption:"Components.FolderTree.Caption",viewElementGroupType:qe.J.Components,placeholderSize:{height:"49px"}})],p);const qt=["menuTrigger"],er=(d,e)=>({"crt-folder-tree-actions-container-disabled":d,"crt-folder-tree-actions-container-loading":e}),tr=d=>({$implicit:d});function rr(d,e){d&1&&(r.\u0275\u0275elementStart(0,"div",12),r.\u0275\u0275element(1,"div",13),r.\u0275\u0275elementEnd())}function or(d,e){d&1&&r.\u0275\u0275element(0,"mat-icon",14)}function nr(d,e){if(d&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",15),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(n.onClearFolderButtonClicked())})("keydown.enter",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(n.onClearFolderButtonClicked())})("keydown.space",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(n.onClearFolderButtonClicked())}),r.\u0275\u0275element(3,"mat-icon",16),r.\u0275\u0275elementEnd()}if(d&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("tabindex",t.getTabIndex())("title",r.\u0275\u0275pipeBind1(1,3,"FolderTreeActions.ClearButtonCaption")),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(2,5,"FolderTreeActions.ClearButtonCaption"))}}function ir(d,e){d&1&&r.\u0275\u0275element(0,"div",17)}function ar(d,e){if(d&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",18,1),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275listener("keydown.enter",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(n.onArrowButtonEnterPressed())})("keydown.space",function(){r.\u0275\u0275restoreView(t);const n=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(n.onArrowButtonEnterPressed())}),r.\u0275\u0275element(3,"mat-icon",19),r.\u0275\u0275elementEnd()}if(d&2){const t=r.\u0275\u0275nextContext(),o=r.\u0275\u0275reference(13);r.\u0275\u0275property("tabindex",t.getTabIndex())("crtMenuTriggerFor",o)("crtMenuTriggerData",r.\u0275\u0275pureFunction1(6,tr,t.data)),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(2,4,"FolderTreeActions.FavoriteItemsMenuButtonAriaLabel"))}}let N=class Pe extends nt.K{get _favoriteFolderTreeMenuItems(){return this._favoriteItems.map(e=>({type:"action",caption:e.name,icon:"star-filled-icon",code:e.id,handler:()=>this.activeFolderChanged.emit({id:e.id,name:e.name,filterData:e.filterData,folderTreeId:e.folderTreeId,folderTypeId:e.folderTypeId,isFavorite:!0})}))}set favoriteItems(e){e instanceof ie.A&&(this._favoriteItemsSubscriptions$.unsubscribe(),this._favoriteItemsSubscriptions$=new l.Subscription,this._favoriteItemsSubscriptions$.add(e.changed.subscribe(()=>{this._updateFavoriteItems(e)}))),this._updateFavoriteItems(e)}constructor(e){super(e),this._itemsSubscriptions$=new l.Subscription,this._favoriteItemsSubscriptions$=new l.Subscription,this._folderButtonCaption="",this._favoriteItems=[],this.skeletonStyles={height:"20px"},this.activeFolderChanged=new r.EventEmitter,this.folderTreeVisibleChanged=new r.EventEmitter,this.isFolderTreeDefined=()=>!!this.folderTree&&this.folderTree.length>0,this.isHasActiveFolder=()=>!!this.activeFolderId&&!!this.activeFolderName,this._initDependencies(e),this._folderButtonCaption=this._translate.instant("FolderTreeActions.MenuButton")}_initDependencies(e){this._translate=e.get(A.TranslateService)}_updateFavoriteItems(e){Promise.all((e??[]).map(function(){var t=(0,u.A)(function*(o){return{id:yield o.Id,name:yield o.Name,folderTreeId:yield o.FolderTreeId,filterData:yield o.FilterData,folderTypeId:yield o.FolderTypeId}});return function(o){return t.apply(this,arguments)}}())).then(t=>{this._favoriteItems=t,this.detectChanges()})}getFolderButtonCaption(){return this.isHasActiveFolder()?this.activeFolderName:this._folderButtonCaption}onFolderButtonClick(){this.folderTreeVisibleChanged.emit({togglePanel:!0})}getMenuItems(){return this._favoriteFolderTreeMenuItems}isFavoriteItemsEmpty(){return!this._favoriteItems||this._favoriteItems.length===0}onClearFolderButtonClicked(){this.activeFolderChanged.emit({id:"",name:"",folderTreeId:"",filterData:"{}",isFavorite:!1})}onArrowButtonEnterPressed(){this.menuTrigger.toggleMenu()}getTabIndex(){return this.isFolderTreeDefined()&&!this.loading?0:-1}ngOnDestroy(){this._itemsSubscriptions$.unsubscribe(),this._favoriteItemsSubscriptions$.unsubscribe()}static{this.\u0275fac=function(t){return new(t||Pe)(r.\u0275\u0275directiveInject(r.Injector))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Pe,selectors:[["crt-folder-tree-actions"]],viewQuery:function(t,o){if(t&1&&r.\u0275\u0275viewQuery(qt,5,ae.O),t&2){let n;r.\u0275\u0275queryRefresh(n=r.\u0275\u0275loadQuery())&&(o.menuTrigger=n.first)}},inputs:{folderTree:"folderTree",activeFolderId:"activeFolderId",activeFolderName:"activeFolderName",favoriteItems:"favoriteItems"},outputs:{activeFolderChanged:"activeFolderChanged",folderTreeVisibleChanged:"folderTreeVisibleChanged"},features:[r.\u0275\u0275InheritDefinitionFeature],decls:14,vars:18,consts:[["rowMenu",""],["menuTrigger",""],[1,"crt-folder-tree-actions-container",3,"ngClass"],[1,"crt-folder-tree-actions-folder-wrapper"],["role","button",1,"crt-folder-tree-actions-folder-button",3,"click","keydown.enter","keydown.space","tabindex","title"],["class","crt-folder-tree-actions-folder-button-loading-icon-wrap",4,"ngIf"],["svgIcon","folder-icon",4,"ngIf"],[1,"crt-folder-tree-actions-folder-button-caption"],["class","crt-folder-tree-actions-folder-clear-button","role","button",3,"tabindex","title","click","keydown.enter","keydown.space",4,"ngIf"],["class","crt-folder-tree-actions-divider",4,"ngIf"],["class","crt-folder-tree-actions-menu-trigger","role","button",3,"tabindex","crtMenuTriggerFor","crtMenuTriggerData","keydown.enter","keydown.space",4,"ngIf"],[3,"menuItems"],[1,"crt-folder-tree-actions-folder-button-loading-icon-wrap"],[1,"crt-folder-tree-actions-folder-button-loading-icon"],["svgIcon","folder-icon"],["role","button",1,"crt-folder-tree-actions-folder-clear-button",3,"click","keydown.enter","keydown.space","tabindex","title"],["svgIcon","small-close"],[1,"crt-folder-tree-actions-divider"],["role","button",1,"crt-folder-tree-actions-menu-trigger",3,"keydown.enter","keydown.space","tabindex","crtMenuTriggerFor","crtMenuTriggerData"],["svgIcon","caret-arrow"]],template:function(t,o){if(t&1){const n=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"div",4),r.\u0275\u0275pipe(3,"translate"),r.\u0275\u0275pipe(4,"translate"),r.\u0275\u0275listener("click",function(){return r.\u0275\u0275restoreView(n),r.\u0275\u0275resetView(o.onFolderButtonClick())})("keydown.enter",function(){return r.\u0275\u0275restoreView(n),r.\u0275\u0275resetView(o.onFolderButtonClick())})("keydown.space",function(){return r.\u0275\u0275restoreView(n),r.\u0275\u0275resetView(o.onFolderButtonClick())}),r.\u0275\u0275template(5,rr,2,0,"div",5)(6,or,1,0,"mat-icon",6),r.\u0275\u0275elementStart(7,"span",7),r.\u0275\u0275text(8),r.\u0275\u0275elementEnd()(),r.\u0275\u0275template(9,nr,4,7,"div",8),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(10,ir,1,0,"div",9)(11,ar,4,8,"div",10),r.\u0275\u0275element(12,"crt-menu",11,0),r.\u0275\u0275elementEnd()}t&2&&(r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction2(15,er,!o.isFolderTreeDefined(),o.loading)),r.\u0275\u0275advance(2),r.\u0275\u0275property("tabindex",o.getTabIndex())("title",r.\u0275\u0275pipeBind1(3,11,"FolderTreeActions.FolderButtonAriaLabel")),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(4,13,"FolderTreeActions.FolderButtonAriaLabel")),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngIf",o.loading),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!o.loading),r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(o.getFolderButtonCaption()),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",o.isHasActiveFolder()),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!o.isFavoriteItemsEmpty()),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!o.isFavoriteItemsEmpty()),r.\u0275\u0275advance(),r.\u0275\u0275property("menuItems",o.getMenuItems()))},dependencies:[P.NgClass,P.NgIf,W.MatIcon,st.IK,ae.O,A.TranslatePipe],styles:[".crt-folder-tree-actions-container[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:4px;flex-direction:row;align-content:center;overflow:hidden;padding:1px}.crt-folder-tree-actions-container.crt-folder-tree-actions-container-disabled[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-loading[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-disabled[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-loading[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-disabled[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-loading[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%]{pointer-events:none}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:4px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button-loading-icon-wrap[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:4px;height:16px;width:16px;padding-inline-start:2px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button-loading-icon-wrap[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button-loading-icon[_ngcontent-%COMP%]{height:8px;width:8px;border-width:2px;border-style:solid;border-left-color:transparent;border-right-color:transparent;border-bottom-color:transparent;border-radius:50%;animation:_ngcontent-%COMP%_loadingIconLoop .5s linear infinite}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:4px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:16px;width:16px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%]:hover{cursor:pointer}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button-caption[_ngcontent-%COMP%]{max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:16px;width:16px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%]:hover{cursor:pointer}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-divider[_ngcontent-%COMP%]{height:11px;width:0;border-left-width:1px;border-left-style:solid}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%], .crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:16px;width:16px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%]:hover{cursor:pointer}@keyframes _ngcontent-%COMP%_loadingIconLoop{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}};(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",String)],N.prototype,"folderTree",void 0),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",String)],N.prototype,"activeFolderId",void 0),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",String)],N.prototype,"activeFolderName",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],N.prototype,"activeFolderChanged",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],N.prototype,"folderTreeVisibleChanged",void 0),(0,a.__decorate)([(0,v.k)(),(0,a.__metadata)("design:type",Object),(0,a.__metadata)("design:paramtypes",[Object])],N.prototype,"favoriteItems",null),N=(0,a.__decorate)([(0,We.v)({type:"crt.FolderTreeActions",reuseStrategy:Xe.B.Reuse}),(0,Ye.f)({toolbarConfig:{position:50,hint:"Components.FolderTreeActions.Hint",icon:s(41456),defaultPropertyValues:{folderTree:null}},propertiesPanelComponentTypeName:"crt.FolderTreeActionsPropertiesPanel",viewElementGroupType:qe.J.Components,typeCaption:"Components.FolderTreeActions.Caption",placeholderSize:{height:"18px"}}),(0,a.__metadata)("design:paramtypes",[r.Injector])],N);var se=s(4164);let de=class{convert([e,t]){return(0,j.gZ)(e)?null:Promise.resolve(t)}};de=(0,a.__decorate)([(0,se.a)({type:"crt.FolderTreeActiveFilterAttributeConverter"})],de);var lt=s(40968),le=s(26594),sr=s(97842),k=s(51406);class U{getAllowedEntitySchemaNames(){return this._dataLoading$?this._dataLoading$:this._dataLoading$=k.K.create("FolderTreeStaticFolderSchemas").pipe((0,l.switchMap)(e=>e.load({attributes:["EntitySchemaName"]})),(0,l.map)(e=>e.map(t=>t.EntitySchemaName)),(0,l.shareReplay)({bufferSize:1,refCount:!1}))}isEnabled(e){return this.getAllowedEntitySchemaNames().pipe((0,l.map)(t=>t.includes(e)))}static{this.\u0275fac=function(t){return new(t||U)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}}let ce=class{constructor(e,t){this._featureValues=e,this._folderTreeUseStaticFolderService=t}convert(e,t,o){var n=this;return(0,u.A)(function*(){return n._featureValues.IsAllowUseStaticFolders&&(yield(0,l.firstValueFrom)(n._folderTreeUseStaticFolderService.isEnabled(o)))})()}};ce=(0,a.__decorate)([(0,se.a)({type:"crt.FolderTreeAllowUseStaticFoldersConverter"}),(0,a.__param)(0,(0,lt.j)(le.G)),(0,a.__metadata)("design:paramtypes",[sr.x,U])],ce);var Y=s(41108),me=s(56267),L=s(58504);let ue=class{constructor(){this._folderTreeItemsFilterName="folderTreeItemsFilter"}_createOldStructureItemsFilterGroup(e){const t=new Y.X(me.H.Or),o=[m.Ss];return e&&o.push(m.Xi),t.addSchemaColumnInFilterWithParameters(L.H.Equal,"FolderType",o,this._folderTreeItemsFilterName),t}_createNewStructureItemsFilterGroup(e){const t=new Y.X(me.H.Or);return t.addSchemaColumnFilterWithParameter(L.H.Equal,"EntitySchemaName",e,this._folderTreeItemsFilterName),t}convert(e,t,o,n){return(0,f.SK)(o)?this._createOldStructureItemsFilterGroup(e):this._createNewStructureItemsFilterGroup(n)}};ue=(0,a.__decorate)([(0,se.a)({type:"crt.FolderTreeFilterConverter"})],ue);var w=s(41287),S=s(844),dr=s(97229),h=s(7240),lr=s(13111);class x{constructor(e){this._schemaPartsService=e}_saveToProfile(e,t){var o=this;return(0,u.A)(function*(){yield o._schemaPartsService.apply(function(){var n=(0,u.A)(function*([i]){i.setViewModelAttribute(e,t)});return function(i){return n.apply(this,arguments)}}()),yield o._schemaPartsService.commit()})()}setFolderTreeExpandedItems(e,t){var o=this;return(0,u.A)(function*(){const{expandedItemsAttrName:n}=(0,h.Z)(e),i={value:t};yield o._saveToProfile(n,i)})()}setFolderTreeVisibleState(e,t){var o=this;return(0,u.A)(function*(){const{visibleAttrName:n}=(0,h.Z)(e),i={value:t};yield o._saveToProfile(n,i)})()}setFolderTreeSelectedNode(e){var t=this;return(0,u.A)(function*(){const{folderTreeName:o,id:n,activeFolderFolderTreeId:i,isFavorite:c}=e,{activeFolderIdAttrName:_,activeFolderFavoriteStateAttrName:F,activeFolderFolderTreeIdAttrName:y}=(0,h.Z)(o);yield t._schemaPartsService.apply(function(){var Ee=(0,u.A)(function*([ee]){ee.setViewModelAttribute(_,{value:n}),ee.setViewModelAttribute(y,{value:i}),ee.setViewModelAttribute(F,{value:c})});return function(ee){return Ee.apply(this,arguments)}}()),yield t._schemaPartsService.commit()})()}static{this.\u0275fac=function(t){return new(t||x)(r.\u0275\u0275inject(lr.N))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}}let _e=class extends w.l{constructor(e,t){super(),this._folderTreeUserProfileService=e,this._dataGridActiveFolderDesignSettingsApplier=t}_isNeedSaveToProfile(e){const t=e.$context,{activeFolderIdAttrName:o}=(0,h.Z)(e.folderTreeName),n=this._prepareFolderId(t.attributes[o]),i=this._prepareFolderId(e.id);return n!==i}_prepareFolderId(e){return e||""}_updateViewModel(e){var t=this;return(0,u.A)(function*(){const o=e.$context,n=(0,h.Z)(e.folderTreeName),i=yield t._getFolderFilter(e);return(0,l.lastValueFrom)(o.setValue({[e.activeFolderIdAttrName??n.activeFolderIdAttrName]:e.id,[n.activeFolderFolderTreeIdAttrName]:e.folderTreeId,[e.activeFolderNameAttrName??n.activeFolderNameAttrName]:e.name,[n.activeFolderFilterDataAttrName]:i,[e.activeFolderFavoriteStateAttrName??n.activeFolderFavoriteStateAttrName]:e.isFavorite}),{defaultValue:null})})()}_getFolderFilter(e){return(0,f.$K)(e.folderTypeId)?(0,f.po)(e.folderTreeId,e.rootSchemaName):Promise.resolve(e.filterData)}handle(e){var t=this;return(0,u.A)(function*(){return t._isNeedSaveToProfile(e)&&(yield t._folderTreeUserProfileService.setFolderTreeSelectedNode({folderTreeName:e.folderTreeName,id:e.id,activeFolderFolderTreeId:e.folderTreeId,isFavorite:e.isFavorite})),yield t._dataGridActiveFolderDesignSettingsApplier.apply(e),t._updateViewModel(e)})()}};_e=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeActiveFolderChangedHandler",requestType:"crt.FolderTreeActiveFolderChangedRequest"}),(0,a.__metadata)("design:paramtypes",[x,dr.T])],_e);var ct=s(82517),I=s(36486);class M{constructor(e,t){this._ngZone=e,this._dialogService=t}_handleError(e,t,o){const n=o.process({type:"crt.FolderTreeActiveFolderChangedRequest",folderTreeName:t.folderTreeName,$context:t.$context});return this._ngZone.run(()=>this._dialogService.openInfoDialog(e.message)).pipe((0,I.switchMap)(()=>n),(0,I.switchMap)(()=>this._setShowMask(!1,t)),(0,I.switchMap)(()=>(0,l.of)({success:!1})))}_setShowMask(e,t){const o=t.$context,{showMaskAttrName:n}=(0,h.Z)(t.folderTreeName);return o.setValue({[n]:e})}_getErrorMessage(e){const t=e.errorInfo;return e.message||((0,g.isString)(t)?t:t.message)}_reloadFavoritesDataSource(e){if(!e.reloadFavorites)return(0,l.of)({});const t=e.$context,{favoriteItemsAttrName:o}=(0,h.Z)(e.folderTreeName),n=t.getBoundDataSourceNameByAttributePath(o);return t.load(n,[],{loadType:ct.I.Reload})}handle(e,t,o){return(0,l.lastValueFrom)(this._setShowMask(!0,t).pipe((0,I.switchMap)(()=>e),(0,I.switchMap)(n=>this._reloadFavoritesDataSource(t).pipe((0,I.map)(()=>n))),(0,I.switchMap)(n=>n.success?this._setShowMask(!1,t):(0,l.throwError)(()=>new Error(this._getErrorMessage(n)))),(0,I.switchMap)(()=>(0,l.of)({success:!0})),(0,I.catchError)(n=>this._handleError(n,t,o))))}static{this.\u0275fac=function(t){return new(t||M)(r.\u0275\u0275inject(r.NgZone),r.\u0275\u0275inject(et.o))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac,providedIn:"any"})}}class mt extends w.l{constructor(e){super(),this.folderTreeModelRequestService=e.get(M)}insertModel(e){return k.K.create(e.sourceSchemaName).pipe((0,l.switchMap)(t=>{let o={Id:e.folderId,Name:e.folderName,Parent:e.parentId};return(0,f.SK)(e.sourceSchemaName)?o={...o,FolderType:e.folderTypeId||m.Ss,SearchData:e.filterData}:o={...o,EntitySchemaName:e.rootSchemaName,FilterData:e.filterData},t.insert(o)}))}}let he=class re extends mt{constructor(e){super(e)}handle(e){return this.folderTreeModelRequestService.handle(this.insertModel(e),e,this.handlerChain)}static{this.\u0275fac=function(t){return new(t||re)(r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac,providedIn:"any"})}};he=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeAddFolderDataHandler",requestType:"crt.AddFolderDataRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],he);var Z=s(65288),cr=s(63721),ut=s(23092);class E{constructor(){this._userInfo=(0,r.inject)(ut.oq),this._featureValues=(0,r.inject)(le.G),this._httpClient=(0,r.inject)(cr.HttpClient),this._translateService=(0,r.inject)(A.TranslateService),this._serviceEndpoint=(this._userInfo.isSSP?"ssp/":"")+"rest/FolderManagerService/"}_asyncConvert(e){return this._callService("ConvertToStaticFolder",{newFolderId:e.newFolderId,parentFolderId:e.parentFolderId,entitySchemaName:e.rootSchemaName}).pipe((0,l.map)(t=>(t?.success&&(t.additionalNotification=this._translateService.instant("StaticFolderConvertor.AsyncConvertMessage")),t)))}_convert(e){return this._callService("ConvertFolder",{newFolderId:e.newFolderId,parentFolderId:e.parentFolderId,entitySchemaName:e.rootSchemaName}).pipe((0,l.map)(t=>((0,g.isEmpty)(t)&&(t={success:!0}),t)))}_deleteFolders(e){return this._callService("DeleteFolder",{sourceSchemaName:e.sourceSchemaName,records:e.folderIds})}_callService(e,t){const o=`${this._serviceEndpoint}${e}`,n=`${e}Result`;return this._httpClient.post(o,t).pipe((0,l.map)(i=>this._getServiceResultFromResponse(i,n)),(0,l.catchError)(i=>this._catchHttpErrorResponse(i)))}_getServiceResultFromResponse(e,t){return t in(e||{})?e[t]:e}_catchHttpErrorResponse(e){return(0,l.of)({success:!1,errorInfo:{message:e.error?.errorInfo?.message??e.message}})}convertToStatic(e){return this._featureValues.ConvertDynamicToStaticFolderByChunk?this._asyncConvert(e):this._convert(e)}deleteFolders(e){return this._deleteFolders(e)}static{this.\u0275fac=function(t){return new(t||E)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac})}}let pe=class extends w.l{constructor(e){super(),this._folderTreeModelRequestService=e.get(M),this._folderManagerService=e.get(E)}_createDeleteFolderRequest(e){return(0,f.SK)(e.sourceSchemaName)?this._createDeleteOldFolderRequest(e):this._createDeleteNewFolderRequest(e)}_createDeleteOldFolderRequest(e){return this._folderManagerService.deleteFolders({sourceSchemaName:e.sourceSchemaName,folderIds:[e.folderId]}).pipe((0,l.map)(t=>({success:t.success,errorInfo:t.errorInfo?.message,rowsAffected:t.success?1:0})))}_createDeleteNewFolderRequest(e){return e.$context.delete(e.dataSourceName,[{type:Z.E.PrimaryColumnValue,value:e.folderId}])}_removeFolderFromItemViewModel(e){return(0,u.A)(function*(){if(!e.folderId)return Promise.resolve();const t=e.$context,{itemsAttrName:o}=(0,h.Z)(e.folderTreeName),n=yield t[o],i=yield n.findByPrimaryAttribute(e.folderId);return i?n.remove(i):Promise.resolve()})()}_createDeleteFolderRequestWithUpdateViewModel(e){return this._createDeleteFolderRequest(e).pipe((0,l.switchMap)(t=>t.success?(0,l.from)(this._removeFolderFromItemViewModel(e)).pipe((0,l.map)(()=>t)):(0,l.of)(t)))}handle(e){return this._folderTreeModelRequestService.handle(this._createDeleteFolderRequestWithUpdateViewModel(e),e,this.handlerChain)}};pe=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeDeleteFolderDataHandler",requestType:"crt.DeleteFolderDataRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],pe);let fe=class extends w.l{constructor(e){super(),this._folderTreeUserProfileService=e,this._systemFolderIds=[m.EM,m.NQ]}_isNeedSaveToProfile(e){const t=e.$context,{expandedItemsAttrName:o}=(0,h.Z)(e.folderTreeName);let n=t.attributes[o];n=this._prepareExpandedItems(n);const i=this._prepareExpandedItems(e.expandedItems);return!(0,g.isEqual)(n,i)}_saveToProfile(e){const t=[...this._systemFolderIds,...this._prepareExpandedItems(e.expandedItems)];return this._folderTreeUserProfileService.setFolderTreeExpandedItems(e.folderTreeName,t)}_prepareExpandedItems(e){return(0,g.uniq)(e?.filter(t=>!this._systemFolderIds.includes(t))||[])}handle(e){var t=this;return(0,u.A)(function*(){t._isNeedSaveToProfile(e)&&(yield t._saveToProfile(e));const o=(0,h.Z)(e.folderTreeName),n=e.$context;return(0,l.firstValueFrom)(n.setValue({[o.expandedItemsAttrName]:e.expandedItems}))})()}};fe=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeExpandedItemsHandler",requestType:"crt.FolderTreeExpandedItemsRequest"}),(0,a.__metadata)("design:paramtypes",[x])],fe);let ge=class extends w.l{constructor(e){super(),this._folderTreeModelRequestService=e.get(M)}_createMoveFolderRequest(e){return k.K.create(e.sourceSchemaName).pipe((0,l.switchMap)(t=>t.update({Parent:e.parentId},[{type:Z.E.PrimaryColumnValue,value:e.folderId}])))}handle(e){return this._folderTreeModelRequestService.handle(this._createMoveFolderRequest(e),e,this.handlerChain)}};ge=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeMoveRequest",requestType:"crt.FolderTreeMoveRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],ge);let Fe=class extends w.l{constructor(e){super(),this._folderTreeModelRequestService=e.get(M)}_createUpdateRequest(e){return this._createUpdateFolderModelRequest(e).pipe((0,l.switchMap)(t=>t.success?this._updateActiveFolderNameIfNeed(e).pipe((0,l.map)(()=>t)):(0,l.of)(t)))}_createUpdateFolderModelRequest(e){return k.K.create(e.sourceSchemaName).pipe((0,l.switchMap)(t=>t.update({Name:e.folderName},[{type:Z.E.PrimaryColumnValue,value:e.folderId}])))}_updateActiveFolderNameIfNeed(e){const t=(0,h.Z)(e.folderTreeName),o=e.$context;return(0,l.from)(o[t.activeFolderFolderTreeIdAttrName]).pipe((0,l.switchMap)(n=>n!==e.folderId?(0,l.of)(null):o.setValue({[t.activeFolderNameAttrName]:e.folderName})))}handle(e){return this._folderTreeModelRequestService.handle(this._createUpdateRequest(e),e,this.handlerChain)}};Fe=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeRenameHandler",requestType:"crt.FolderTreeRenameRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],Fe);var mr=s(48899);let ve=class extends w.l{_getEntitySchemaUId(e){return this._entitySchemaService.getEntitySchemaByName(e).pipe((0,I.map)(t=>t.entitySchema.uId))}_insertFolder(e,t){return this._getDtoForInsert(e).pipe((0,l.switchMap)(o=>t.insert(o)))}_getDtoForInsert(e){return(0,f.SK)(e.sourceSchemaName)?this._getEntitySchemaUId(e.sourceSchemaName).pipe((0,I.map)(t=>({FolderId:e.id,FolderEntitySchemaUId:t}))):(0,l.of)({FolderTree:e.id,EntitySchemaName:e.rootSchemaName})}_deleteFolder(e,t){return t.delete([{type:Z.E.PrimaryColumnValue,value:e.favoriteId}])}constructor(e){super(),this._injector=e,this._entitySchemaService=this._injector.get(mr.e),this._folderTreeModelRequestService=this._injector.get(M)}_createToggleFavoriteFolderModelRequest(e){const t=(0,f.SK)(e.sourceSchemaName)?m.hc:m.J8;return k.K.create(t).pipe((0,l.switchMap)(o=>e.status?this._insertFolder(e,o):this._deleteFolder(e,o)))}handle(e){return this._folderTreeModelRequestService.handle(this._createToggleFavoriteFolderModelRequest(e),e,this.handlerChain)}};ve=(0,a.__decorate)([(0,S.l)({type:"crt.ToggleFolderFavoriteHandler",requestType:"crt.ToggleFolderFavoriteRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],ve);let Ce=class extends w.l{constructor(e){super(),this._folderTreeModelRequestService=e.get(M)}_createUpdateFolderTreeModelRequest(e){let t={};return(0,f.SK)(e.sourceSchemaName)?t={SearchData:e.filterData}:t={FilterData:e.filterData},k.K.create(e.sourceSchemaName).pipe((0,l.switchMap)(o=>o.update(t,[{type:Z.E.PrimaryColumnValue,value:e.folderId}])),(0,l.mergeMap)(o=>o?.success?(0,l.from)(this._updateFilterData(e).then(()=>o)):(0,l.of)(o)))}_updateFilterData(e){return(0,u.A)(function*(){const t=e.$context,o=(0,h.Z)(e.folderTreeName);yield(0,l.lastValueFrom)(t.setValue({[o.activeFolderFilterDataAttrName]:e.filterData}),{defaultValue:null})})()}handle(e){return this._folderTreeModelRequestService.handle(this._createUpdateFolderTreeModelRequest(e),e,this.handlerChain)}};Ce=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeUpdateFiltersHandler",requestType:"crt.FolderTreeUpdateFiltersRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],Ce);let Ie=class extends w.l{constructor(e){super(),this._folderTreeUserProfileService=e}_getIsIsFolderTreeVisible(e,t){return(0,u.A)(function*(){const o=e.$context;let n=e.visible;if(e.togglePanel){let i=yield o[t];i=(0,g.isNil)(i)?!1:i,n=!i}return n})()}_setFolderTreeVisible(e,t,o,n){var i=this;return(0,u.A)(function*(){return yield i._folderTreeUserProfileService.setFolderTreeVisibleState(n,t),e.set(o,t)})()}handle(e){var t=this;return(0,u.A)(function*(){const o=e.$context,{visibleAttrName:n}=(0,h.Z)(e.folderTreeName),i=yield t._getIsIsFolderTreeVisible(e,n);return t._setFolderTreeVisible(o,i,n,e.folderTreeName)})()}};Ie=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeVisibleHandler",requestType:"crt.FolderTreeVisibleRequest"}),(0,a.__metadata)("design:paramtypes",[x])],Ie);var ur=s(63438);let ye=class oe extends mt{constructor(e){super(e),this._rightsService=e.get(tt.f),this._folderTreeRelatedElementConfigsRepository=e.get(ur.x),this._featureValues=e.get(le.G)}_copyRelatedElementConfigs(e,t){return!t||this._featureValues.DisableDataGridSettingsByFolders?(0,l.of)({success:!1}):this._folderTreeRelatedElementConfigsRepository.copy(e,t)}_copyRights(e){return!e.copyRights||!e.folderId?(0,l.of)({}):this._rightsService.copyRights({schemaName:e.sourceSchemaName,sourceId:e.sourceId,targetId:e.folderId,options:{overwrite:!1}})}_revertRelatedElementConfigs(e){return(0,l.lastValueFrom)(this._folderTreeRelatedElementConfigsRepository.delete({folderId:e.folderId}))}_createCopyFolderModelRequest(e){return this._copyRelatedElementConfigs(e.sourceId,e.folderId).pipe((0,I.switchMap)(()=>this.insertModel(e)),(0,I.switchMap)(t=>this._copyRights(e).pipe((0,I.map)(()=>t))))}handle(e){var t=this;return(0,u.A)(function*(){const o=yield t.folderTreeModelRequestService.handle(t._createCopyFolderModelRequest(e),e,t.handlerChain);return o.success||(yield t._revertRelatedElementConfigs(e)),Promise.resolve(o)})()}static{this.\u0275fac=function(t){return new(t||oe)(r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:oe,factory:oe.\u0275fac})}};ye=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeCopyFolderDataHandler",requestType:"crt.CopyFolderDataRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],ye);var _t=s(22592),ht=s(6503),_r=s(99298);let Se=class ne extends w.l{constructor(e,t,o){super(),this._folderManagerService=e,this._notifyService=t,this._maskService=o}_addNewFolder(e){return this.handlerChain.process({...e,type:"crt.AddFolderDataRequest"})}_convert(e){return this._showLoadingMask(e),(0,l.lastValueFrom)(this._folderManagerService.convertToStatic({newFolderId:e.folderId,parentFolderId:e.parentId,rootSchemaName:e.rootSchemaName}).pipe((0,l.tap)(()=>this._hideLoadingMask(e))))}_showLoadingMask(e){this._maskService.showMask(this._getTaskName(e.rootSchemaName),e.$context)}_hideLoadingMask(e){this._maskService.hideMask(this._getTaskName(e.rootSchemaName),e.$context)}_getTaskName(e){return`ConvertToStaticFolder_${e}`}_notify(e){let t="";if(e.success&&e.additionalNotification)t=e.additionalNotification;else if(!e.success)t=e.errorInfo?.message;else return;this._notifyService.show({message:t})}handle(e){var t=this;return(0,u.A)(function*(){if(!(yield t._addNewFolder(e)).success)return;const n=yield t._convert(e);return t._notify(n),n})()}static{this.\u0275fac=function(t){return new(t||ne)(r.\u0275\u0275inject(E),r.\u0275\u0275inject(ht.F),r.\u0275\u0275inject(_t.s))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac})}};Se=(0,a.__decorate)([(0,S.l)({type:"crt.FolderTreeConvertToStaticFolderHandler",requestType:"crt.ConvertToStaticFolderRequest"}),(0,a.__param)(2,(0,lt.j)(_r.V)),(0,a.__metadata)("design:paramtypes",[E,ht.F,_t.s])],Se);var hr=s(10278),Ne=s(81159);class V extends Ne.W{constructor(){super(...arguments),this.relatedInMainRecordsServiceName="StaticFolderService",this.relatedRecordsActionsNames=new Map([[Ne.m.AddRelatedRecords,"AddRecords"],[Ne.m.RemoveRelatedRecords,"RemoveRecords"]])}createRequest(e,t,o){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),foldersEsqSerialized:JSON.stringify(t.getMetadata()),recordInFolderRecordsSchemaName:o.relatedInMainRecordsSchemaName,recordColumnName:o.relatedRecordColumnName,folderColumnName:o.mainRecordColumnName,defaultValues:o.defaultValues?JSON.stringify(o.defaultValues):null}}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=r.\u0275\u0275getInheritedFactory(V)))(o||V)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}class pt extends hr.l{get invalidErrorMessageForSelectRecordsValidator(){return`InfoDialog.RecordsInStaticFolders.SelectRecordsTo${this.openLookupPageMode}Message`}constructor(e){super(e),this.injector=e,this.baseRelatedInMainRecordsService=e.get(V)}_updateStaticFolderDataSource(e){var t=this;if(!e.$context.isDataSourceForCollection(e.dataSourceName))return;const n={type:"crt.LoadDataRequest",$context:e.$context,dataSourceName:e.dataSourceName,config:{loadType:ct.I.Reload}};setTimeout((0,u.A)(function*(){yield t.handlerChain.process(n)}))}showSuccessNotification(e,t){super.showSuccessNotification(e,t),this._updateStaticFolderDataSource(e)}createServiceData(e,t){const o=this.getRelatedRecordsSchemaName(e);return{relatedRecordsSchemaName:o,relatedRecordColumnName:this._oldInFolderColumnSchemaName,relatedRecordsFilters:e.filters,relatedInMainRecordsSchemaName:(0,f.sh)(o),mainRecordsSchemaName:(0,f.dn)(o),mainRecordColumnName:m.lb,mainRecordsFilters:t}}getLookupPageEntitySchemaName(e){const t=e.$context.dataSchemas[e.dataSourceName]?.name;return(0,f.dn)(t)}getLookupPageCaption(e){}getLookupPageFilter(e){const t=new Y.X;return t.addSchemaColumnFilterWithParameter(L.H.Equal,"FolderType",m.Xi,"StaticFolderTypeFilter"),t}getMaskTaskName(e){return`RecordsInStaticFolders_${this.getRelatedRecordsSchemaName(e)}`}initializeData(e){var t=this;return(0,u.A)(function*(){const o=t.getRelatedRecordsSchemaName(e);t._oldInFolderColumnSchemaName=yield(0,f.d8)(o)})()}}let Te=class extends pt{constructor(e){super(e),this._injector=e,this.openLookupPageMode="AddRecords"}};Te=(0,a.__decorate)([(0,S.l)({requestType:"crt.AddRecordsInStaticFoldersRequest",type:"crt.AddRecordsInStaticFoldersHandler"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],Te);let Me=class extends pt{constructor(e){super(e),this._injector=e,this.openLookupPageMode="RemoveRecords"}};Me=(0,a.__decorate)([(0,S.l)({requestType:"crt.RemoveRecordsInStaticFoldersRequest",type:"crt.RemoveRecordsInStaticFoldersHandler"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],Me);var we=s(73335),Ae=s(5704),be=s(29025),xe=s(53163),pr=s(86464),ft=s(74368),fr=s(16319),gr=s(65967),gt=s(25096);class G{_getColumns(e){const t=["Id","Name"],o=(0,f.ic)(e);return t.push(o),(0,f.SK)(e)&&t.push("FolderType.Id"),t}_getParameters(e){return[{type:Z.E.PrimaryColumnValue,value:e}]}_createItem(e,t){const o=(0,f.ic)(t);return{id:e.Id,name:e.Name,filter:e[o],folderTypeId:e["FolderType.Id"]}}getFolderData(e,t=m.uE){return(0,l.lastValueFrom)(k.K.create(t).pipe((0,l.switchMap)(o=>o.load({attributes:this._getColumns(t),parameters:this._getParameters(e)})),(0,l.map)(o=>o?.map(n=>this._createItem(n,t))),(0,l.map)(o=>(0,g.isEmpty)(o)?null:o[0])))}static{this.\u0275fac=function(t){return new(t||G)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac,providedIn:"root"})}}var Ft=s(93534);class Q{constructor(){this._userInfo=(0,r.inject)(ut.oq),this._dataSchemaRepository=(0,r.inject)(fr.J),this._folderTreeIdResolver=(0,r.inject)(gt.W),this._folderTreeDataProvider=(0,r.inject)(G),this._folderTreeAdminUnitRoleSourcesService=(0,r.inject)(Ft.R),this._metadataSchemaUtils=(0,r.inject)(ft.u)}_initializeAdminUnitRoleSources(){var e=this;return(0,u.A)(function*(){e._adminUnitRoleSources=yield e._folderTreeAdminUnitRoleSourcesService.getAsArray()})()}_getFolderTreeViewConfigs(e){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FolderTree",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processFolderTree(e,t){var o=this;return(0,u.A)(function*(){if(!t.rootSchemaName){o._resetActiveFolderIdAttributesValue(e,t);return}yield o._prepareActiveFolderIdAttributeValue(e,t),o._setUseStaticFoldersAttributeValue(e,t),yield o._setItemsConfig(e,t),o._setFolderTreeInputs(e,t),o._setFolderTreeOutputs(e,t),o._setFavoriteItemsConfig(e,t)})()}_setFolderTreeInputs(e,t){this._setExpandedItemsAttrValue(e,t),this._setVisibleAttrValue(e,t),this._setActiveFolderAttributes(e,t),this._setShowMaskAttrValue(e,t)}_setFolderTreeOutputs(e,t){this._setActiveFolderChanged(t),this._setFolderTreeVisibleChanged(t),this._setAddFolderRequest(t),this._setCopyFolderRequest(t),this._setFolderRenameRequest(t),this._setMoveFolderRequest(t),this._setFolderFiltersUpdatedRequest(t),this._setDeleteFolderRequest(e,t),this._setFolderTreeExpandedItemsChanged(t),this._setConvertToStaticFolder(t),this._setFolderChangeRights(t),this._setToggleFolderFavoriteRequest(t)}_isOldSourceSchema(e){return(0,f.SK)(e.sourceSchemaName)}_getFolderFilterColumnName(e){return(0,f.ic)(e.sourceSchemaName)}_setActiveFolderChanged(e){e.activeFolderChanged||(e.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:e.name,id:"@event.id",name:"@event.name",folderTreeId:"@event.folderTreeId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId",rootSchemaName:"@event.rootSchemaName",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChanged(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.name,visible:"@event.visible"}})}_setAddFolderRequest(e){e.addFolder||(e.addFolder={request:"crt.AddFolderDataRequest",params:this._getAddFolderRequestParameters(e)})}_getAddFolderRequestParameters(e){return{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId"}}_setCopyFolderRequest(e){e.copyFolder||(e.copyFolder={request:"crt.CopyFolderDataRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",sourceId:"@event.sourceId",copyRights:"@event.copyRights",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setFolderRenameRequest(e){e.folderRenamed||(e.folderRenamed={request:"crt.FolderTreeRenameRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setMoveFolderRequest(e){e.moveFolder||(e.moveFolder={request:"crt.FolderTreeMoveRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",parentId:"@event.parentId",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setToggleFolderFavoriteRequest(e){e.toggleFolderFavorite||(e.toggleFolderFavorite={request:"crt.ToggleFolderFavoriteRequest",params:{folderTreeName:e.name,id:"@event.id",favoriteId:"@event.favoriteId",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",status:"@event.status",reloadFavorites:!0}})}_setFolderFiltersUpdatedRequest(e){e.folderFiltersUpdated||(e.folderFiltersUpdated={request:"crt.FolderTreeUpdateFiltersRequest",params:{folderTreeName:e.name,filterData:"@event.filterData",sourceSchemaName:"@event.sourceSchemaName",folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}})}_setDeleteFolderRequest(e,t){if(t.deleteFolder)return;const{itemsAttrName:o}=(0,h.Z)(t.name);t.deleteFolder={request:"crt.DeleteFolderDataRequest",params:{dataSourceName:this._getDataSourceNameByItems(e,o),sourceSchemaName:"@event.sourceSchemaName",folderTreeName:t.name,folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}}}_getDataSourceNameByItems(e,t){const o=this._getViewModelConfigAttribute(e,t)??{};return"embeddedModel"in o?o?.embeddedModel?.name??"":""}_setItemsConfig(e,t){var o=this;return(0,u.A)(function*(){o._setItemsAttrValue(t),yield o._addItemsViewModelAttribute(e,t),o._setItemsFilterAttrValue(e,t)})()}_setItemsAttrValue(e){if(e.items)return;const{itemsAttrName:t}=(0,h.Z)(e.name);e.items=`$${t}`}_updateItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:o}=(0,h.Z)(t.name),n=this._getFolderFilterColumnName(t);if(!this._isOldSourceSchema(t)){e.attributes.FilterData={modelConfig:{path:`${o}.${n}`}};return}e.attributes.FolderTypeId={modelConfig:{path:`${o}.FolderType.Id`}},e.attributes.FilterData={modelConfig:{path:`${o}.${n}`}}}_addItemsViewModelAttribute(e,t){var o=this;return(0,u.A)(function*(){const{itemsAttrName:n,itemsModelName:i,itemsFilterAttrName:c}=(0,h.Z)(t.name),_=t.sourceSchemaName,F=yield o._getDataSchema(_),y={isCollection:!0,viewModelConfig:o._createItemsViewModelAttributeViewModelConfig(t,F),modelConfig:o._createItemsViewModelAttributeModelConfig(i,c),embeddedModel:o._createItemsViewModelAttributeEmbeddedModel(i,_)};o._isOldItemsCollectionViewModelAttribute(e,t)&&o._addViewModelConfigAttribute(e,n,y,!0),o._mergeViewModelConfigAttribute(e,n,y)})()}_getDataSchema(e){return(0,l.lastValueFrom)(this._dataSchemaRepository.get(e))}_createItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:o}=(0,h.Z)(e.name),n=this._getFolderFilterColumnName(e),i={attributes:{Id:{modelConfig:{path:`${o}.${t.primaryAttributeName}`}},Name:{modelConfig:{path:`${o}.${t.primaryDisplayAttributeName}`}},ParentId:{modelConfig:{path:`${o}.${t.hierarchyAttributeName}.${t.primaryAttributeName}`}},FilterData:{modelConfig:{path:`${o}.${n}`}}}};return this._updateItemsViewModelAttributeViewModelConfig(i,e),i}_createItemsViewModelAttributeModelConfig(e,t){return{path:e,filterAttributes:[{name:t,loadOnChange:!0}]}}_createItemsViewModelAttributeEmbeddedModel(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t,adminUnitRoleSources:this._adminUnitRoleSources}}}}_isOldItemsCollectionViewModelAttribute(e,t){const{itemsAttrName:o}=(0,h.Z)(t.name),n=this._getViewModelConfigAttribute(e,o);return this._isOldCollectionViewModelAttribute(n)}_isOldCollectionViewModelAttribute(e){return!!e&&!!e.isCollection&&!!e.viewModelConfig&&!!e.embeddedModel&&!!e.modelConfig}_setItemsFilterAttrValue(e,t){if(!this._getViewModelConfigAttributes(e))return;const{itemsFilterAttrName:o,allowUseStaticFoldersAttrName:n}=(0,h.Z)(t.name),i=t.sourceSchemaName,c=t.rootSchemaName,_=`'${i}':'${c}'`,F={from:n,converter:`crt.FolderTreeFilterConverter:${_}`};this._addViewModelConfigAttribute(e,o,F,!0)}_setVisibleAttrValue(e,t){if(t.visible)return;const{visibleAttrName:o}=(0,h.Z)(t.name);t.visible=`$${o}`,this._addViewModelConfigAttribute(e,o,{value:!0})}_setShowMaskAttrValue(e,t){if(t.showMask)return;const{showMaskAttrName:o}=(0,h.Z)(t.name);t.showMask=`$${o}`,this._addViewModelConfigAttribute(e,o,{value:!1})}_setActiveFolderAttributes(e,t){t.activeFolderId||(this._setActiveFolderIdAttribute(t),this._setActiveFolderFilterAttribute(e,t),this._addActiveFolderNameAttribute(e,t))}_setActiveFolderIdAttribute(e){const{activeFolderIdAttrName:t}=(0,h.Z)(e.name);e.activeFolderId=`$${t}`}_addActiveFolderNameAttribute(e,t){const{activeFolderNameAttrName:o}=(0,h.Z)(t.name);this._addViewModelConfigAttribute(e,o,{})}_setActiveFolderFilterAttribute(e,t){if(!this._isNeedToSetFolderFilterAttribute(e,t))return;const{activeFolderFolderTreeIdAttrName:o,activeFolderFilterAttrName:n,activeFolderFilterDataAttrName:i}=(0,h.Z)(t.name);this._addViewModelConfigAttribute(e,n,{from:[o,i],converter:"crt.FolderTreeActiveFilterAttributeConverter"},!0)}_isNeedToSetFolderFilterAttribute(e,t){const{activeFolderFilterAttrName:o}=(0,h.Z)(t.name),n=this._getViewModelConfigAttribute(e,o);return!(n&&(0,gr.t)(n))}_setFavoriteItemsConfig(e,t){const{favoriteItemsAttrName:o}=(0,h.Z)(t.name);t.favoriteItems=`$${o}`;const n=`${o}_DS`,i=`${n}_filter`;this._setFavoriteItemsFilterAttr(i,e,t);const c={isCollection:!0,modelConfig:{path:n,filterAttributes:[{name:i,loadOnChange:!0}]}};this._addFavoriteItemsViewModelConfig(c,t,n),this._addFavoriteItemsEmbeddedModel(c,t,n),this._isOldFavoriteItemsCollectionViewModelAttribute(e,t)&&this._addViewModelConfigAttribute(e,o,c,!0),this._mergeViewModelConfigAttribute(e,o,c)}_addFavoriteItemsViewModelConfig(e,t,o){const n=this._isOldSourceSchema(t),i=n?"":".FolderTree",c=n?"FolderId":"Id",_={Id:{modelConfig:{path:`${o}.Id`}},Name:{modelConfig:{path:`${o}${i}.Name`}},FolderTreeId:{modelConfig:{path:`${o}${i}.${c}`}},FilterData:{modelConfig:{path:`${o}${i}.FilterData`}}};n&&(_.FolderTypeId={modelConfig:{path:`${o}${i}.FolderTypeId`}}),e.viewModelConfig={attributes:_}}_addFavoriteItemsEmbeddedModel(e,t,o){const n=this._isOldSourceSchema(t),i=n?m.HD:m.HT,c={name:o,config:{type:"crt.EntityDataSource",config:{entitySchemaName:i,adminUnitRoleSources:this._adminUnitRoleSources},hiddenInPageDesigner:!1}};if(n){const _=t.sourceSchemaName,F=this._getFolderFilterColumnName(t);c.config.config.attributes={Name:{path:`[${_}:Id:FolderId].Name`,type:we.D.ForwardReferenceAttribute},FilterData:{path:`[${_}:Id:FolderId].${F}`,type:we.D.ForwardReferenceAttribute},FolderTypeId:{path:`[${_}:Id:FolderId].FolderType.Id`,type:we.D.ForwardReferenceAttribute}}}e.embeddedModel=c}_isOldFavoriteItemsCollectionViewModelAttribute(e,t){const{favoriteItemsAttrName:o}=(0,h.Z)(t.name),n=this._getViewModelConfigAttribute(e,o);return this._isOldCollectionViewModelAttribute(n)}_setFavoriteItemsFilterAttr(e,t,o){const n=this._getViewModelConfigAttributes(t);if(n?.[e]||!n)return;const i=this._isOldSourceSchema(o),c=new Y.X(me.H.And),_=new Ae.x(L.H.Equal,new be.g({columnPath:"SysAdminUnit"}),new xe.J({value:this._userInfo?.id,dataValueType:pr.r.Guid}));if(c.add(_,"adminUnitFilter"),i){const F=o.sourceSchemaName,y=new Ae.x(L.H.Equal,new be.g({columnPath:"FolderEntitySchemaName"}),new xe.J({value:F}));c.add(y,"folderEntitySchemaNameFilter")}else{const F=new Ae.x(L.H.Equal,new be.g({columnPath:"EntitySchemaName"}),new xe.J({value:o.rootSchemaName}));c.add(F,"schemaFilter")}n[e]={value:c.toJson()}}_setExpandedItemsAttrValue(e,t){if(t.expandedItems)return;const{expandedItemsAttrName:o}=(0,h.Z)(t.name);t.expandedItems=`$${o}`,this._addViewModelConfigAttribute(e,o,{})}_getViewModelConfigAttribute(e,t){return(this._getViewModelConfigAttributes(e)||{})[t]}_getViewModelConfigAttributes(e){return e?.viewModelConfig?.attributes}_mergeViewModelConfigAttribute(e,t,o){const n=this._getViewModelConfigAttribute(e,t);n&&(o=(0,g.mergeWith)(o,n,(i,c)=>(0,g.isArray)(c)?c:void 0)),this._addViewModelConfigAttribute(e,t,o,!0)}_addViewModelConfigAttribute(e,t,o,n=!1){const i=this._getViewModelConfigAttribute(e,t);if(!n&&i)return;const c=this._getViewModelConfigAttributes(e)||{};c[t]=o}_setFolderTreeExpandedItemsChanged(e){e.folderTreeExpandedItemsChanged||(e.folderTreeExpandedItemsChanged={request:"crt.FolderTreeExpandedItemsRequest",params:{folderTreeName:e.name,expandedItems:"@event.expandedItems"}})}_setFolderChangeRights(e){e.folderChangeRights||(e.folderChangeRights={request:"crt.LoadRightsModuleRequest",params:{payload:{entitySchemaName:"@event.entitySchemaName",entitySchemaCaption:"@event.entitySchemaCaption",primaryColumnValue:"@event.primaryColumnValue",primaryDisplayColumnValue:"@event.primaryDisplayColumnValue",hideAdditionalLookupButtons:!0}}})}_setConvertToStaticFolder(e){e.convertToStaticFolder||!this._isOldSourceSchema(e)||(e.convertToStaticFolder={request:"crt.ConvertToStaticFolderRequest",params:this._getAddFolderRequestParameters(e)})}_prepareActiveFolderIdAttributeValue(e,t){var o=this;return(0,u.A)(function*(){const n=yield o._folderTreeIdResolver.getActiveFolderFolderTreeId(t,e);if((0,g.isEmpty)(n)){o._resetActiveFolderIdAttributesValue(e,t);return}yield o._updateActiveFolderIdAttributesValue(n,e,t)})()}_resetActiveFolderIdAttributesValue(e,t){const{activeFolderFolderTreeIdAttrName:o,activeFolderIdAttrName:n,activeFolderNameAttrName:i,activeFolderFilterDataAttrName:c}=(0,h.Z)(t.name);[o,n,i,c].forEach(F=>{this._addViewModelConfigAttribute(e,F,{value:null},!0)})}_updateActiveFolderIdAttributesValue(e,t,o){var n=this;return(0,u.A)(function*(){const i=yield n._folderTreeDataProvider.getFolderData(e,o.sourceSchemaName);if(!i)return;const{activeFolderNameAttrName:c,activeFolderFilterDataAttrName:_}=(0,h.Z)(o.name),F=yield n._getFolderFilterFromFolderData(i,o);n._addViewModelConfigAttribute(t,c,{value:i.name},!0),n._addViewModelConfigAttribute(t,_,{value:F},!0)})()}_getFolderFilterFromFolderData(e,t){return(0,f.$K)(e.folderTypeId)?(0,f.po)(e.id,t.rootSchemaName):Promise.resolve(e.filter)}_setUseStaticFoldersAttributeValue(e,t){if(!this._isOldSourceSchema(t))return;const{allowUseStaticFoldersAttrName:o}=(0,h.Z)(t.name),n={converter:`crt.FolderTreeAllowUseStaticFoldersConverter:'${t.rootSchemaName}'`};this._addViewModelConfigAttribute(e,o,n,!0),t.useStaticFolders=`$${o}`}crtOnMetaDataInit(e){var t=this;return(0,u.A)(function*(){const o=e,n=t._getFolderTreeViewConfigs(o);return(0,g.isEmpty)(n)?e:(yield t._initializeAdminUnitRoleSources(),yield Promise.all(n.map(i=>t._processFolderTree(o,i))),o)})()}static{this.\u0275fac=function(t){return new(t||Q)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac})}}class J{constructor(){this._metadataSchemaUtils=(0,r.inject)(ft.u)}_getFolderTreeActionViewConfigs(e){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FolderTreeActions",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_setProperties(e){const t=e.folderTree,{activeFolderIdAttrName:o,activeFolderNameAttrName:n,activeFolderFavoriteStateAttrName:i,favoriteItemsAttrName:c}=(0,h.Z)(t);e.activeFolderId||(e.activeFolderId=t?`$${o}`:null),e.activeFolderName||(e.activeFolderName=t?`$${n}`:null),e.activeFolderFavoriteState||(e.activeFolderFavoriteState=t?`$${i}`:null),e.favoriteItems||(e.favoriteItems=t?`$${c}`:null)}_setActiveFolderChangedRequest(e,t){if(t.activeFolderChanged)return;const o=t.folderTree??null;if(!o)return;const n=this._getFolderTreeRootSchemaName(e,o);t.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:o,id:"@event.id",name:"@event.name",folderTreeId:"@event.folderTreeId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId",rootSchemaName:n,isFavorite:"@event.isFavorite"}}}_setFolderTreeVisibleChangedRequest(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.folderTree??null,togglePanel:"@event.togglePanel"}})}_getFolderTreeRootSchemaName(e,t){return this._metadataSchemaUtils.getViewConfigInfoByName(e,t)?.viewConfig?.rootSchemaName}crtOnMetaDataInit(e){const t=e,o=this._getFolderTreeActionViewConfigs(t);for(const n of o)this._setProperties(n),this._setActiveFolderChangedRequest(t,n),this._setFolderTreeVisibleChangedRequest(n);return Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||J)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}var vt=s(41012),Fr=s(15112);let q=class Ve{constructor(e){this._materialIconsRegistrator=e,this._iconRegistration()}_iconRegistration(){this._materialIconsRegistrator.addIcons([{name:"folder_tree",icon:s(19010)},{name:"move-folder",icon:s(61137)}])}static{this.\u0275fac=function(t){return new(t||Ve)(r.\u0275\u0275inject(je.K))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Ve})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[{provide:Je.m,useClass:Q,multi:!0},{provide:Je.m,useClass:J,multi:!0},vt.j,E,x,V],imports:[P.CommonModule,De.q,Ke.q,Ue.k,He.V,W.MatIconModule,ke.R,Re.MatLegacyButtonModule,$e.f,Le.D,Ze.u,Ge.n,ze.E,Qe.x,A.TranslateModule]})}};q=(0,a.__decorate)([(0,Ct.g)({viewElements:[p,N],converters:[de,ce,ue],requestHandlers:[_e,he,pe,fe,ge,Fe,ve,Ce,Ie,ye,Se,Te,Me]}),(0,a.__metadata)("design:paramtypes",[je.K])],q),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(q,{declarations:[p,K,O,N],imports:[P.CommonModule,De.q,Ke.q,Ue.k,He.V,W.MatIconModule,ke.R,Re.MatLegacyButtonModule,$e.f,Le.D,Ze.u,Ge.n,ze.E,Qe.x,Be.X,A.TranslateModule],exports:[p,N]})}(),r.\u0275\u0275setComponentScope(O,[it.B,Fr.H,p],[A.TranslatePipe]);var vr=s(81331)},41456:$=>{$.exports=`
<svg xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64">
	<g id="Group_12169" data-name="Group 12169" transform="translate(-464 -425)">
		<g id="Group_9771" data-name="Group 9771" transform="translate(399 129)">
			<rect id="Rectangle_21438" data-name="Rectangle 21438" width="56" height="24" rx="3" transform="translate(73 316)" fill="#004fd6"/>
			<path id="Path_9868" data-name="Path 9868" d="M788.408-567v3.36a4.876,4.876,0,0,0-2.112,1.056l-2.592-2.592-2.88,2.976,2.592,2.592a4.051,4.051,0,0,0-1.056,2.016H779v5.184h3.36c.192,0,.576,1.248,1.056,2.016l-2.592,2.5,2.976,2.976,2.5-2.592a4.8,4.8,0,0,0,2.112.96V-543H791v-23.792ZM791-551.64a3.4,3.4,0,0,1-3.36-3.36,3.4,3.4,0,0,1,3.36-3.36C792.847-558.339,792.847-551.661,791-551.64Z" transform="translate(-662 883)" fill="#fff" opacity="0.2"/>
			<g id="Group_16211" data-name="Group 16211" transform="translate(-1167 -209)">
				<path id="Path_11757" data-name="Path 11757" d="M7,7.885V12.5H7V7.885l4.5-3.846V2.5h-9V4.038Z" transform="translate(1255.5 533.5)" fill="none" stroke="#fff" stroke-width="2"/>
				<path id="Path_11756" data-name="Path 11756" d="M-450.8,601.4h-6v-9h3.3l2.2,2h5.5v1.5" transform="translate(1706.798 -62.401)" fill="none" stroke="#fff" stroke-width="2"/>
			</g>
		</g>
		<rect id="Rectangle_24800" data-name="Rectangle 24800" width="72" height="64" rx="6" transform="translate(464 425)" fill="none"/>
	</g>
</svg>
`},61137:$=>{$.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M12.4403 8.54175L13.6957 9.30902C13.829 9.39048 14 9.29456 14 9.13837V5.83333C14 5.47971 13.8595 5.14057 13.6095 4.89052C13.3594 4.64048 13.0203 4.5 12.6667 4.5H8.10704C8.04017 4.5 7.97772 4.46658 7.94063 4.41094L6.72604 2.58906C6.68895 2.53342 6.6265 2.5 6.55963 2.5H3.33333C2.97971 2.5 2.64057 2.64048 2.39052 2.89052C2.14048 3.14057 2 3.47971 2 3.83333V12.1667C2 12.5203 2.14048 12.8594 2.39052 13.1095C2.64057 13.3595 2.97971 13.5 3.33333 13.5H7.45659C7.58153 13.5 7.9162 12.9166 7.9162 12.7916V10.8952C7.9162 9.98898 8.65045 9.25435 9.5562 9.25435H9.96518C10.0433 9.25435 10.1134 9.2082 10.1516 9.14002C10.5811 8.37331 11.6018 8.02924 12.4403 8.54175ZM11.7678 13.4553C11.5679 13.5783 11.3105 13.4344 11.3105 13.1998V12.6555C11.3105 12.545 11.221 12.4555 11.1105 12.4555H9.44258C9.27689 12.4555 9.14258 12.3212 9.14258 12.1555V11.05C9.14258 10.8843 9.27689 10.75 9.44258 10.75H11.1105C11.221 10.75 11.3105 10.6605 11.3105 10.55V10.0075C11.3105 9.77282 11.5679 9.62901 11.7678 9.752L14.3618 11.3481C14.5522 11.4653 14.5522 11.742 14.3618 11.8591L11.7678 13.4553Z" fill="currentColor"/>
</svg>
`},19010:$=>{$.exports=`<svg id="Component_669_2" data-name="Component 669 \u2013 2" xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64">
	<rect id="Rectangle_24800" data-name="Rectangle 24800" width="72" height="64" rx="6" fill="none"/>
	<rect id="Rectangle_6612" data-name="Rectangle 6612" width="42" height="6" rx="3" transform="translate(22 8)" fill="#d1d1d1"/>
	<rect id="Rectangle_42316" data-name="Rectangle 42316" width="30" height="6" rx="3" transform="translate(34 22)" fill="#d1d1d1"/>
	<rect id="Rectangle_42318" data-name="Rectangle 42318" width="30" height="6" rx="3" transform="translate(34 46)" fill="#d1d1d1"/>
	<rect id="Rectangle_42317" data-name="Rectangle 42317" width="18" height="6" rx="3" transform="translate(34 34)" fill="#d1d1d1"/>
	<path id="Path_6339" data-name="Path 6339" d="M0,4,3.962,0,8,4" transform="translate(16 13) rotate(180)" fill="none" stroke="#004fd6" stroke-width="2"/>
	<path id="Path_11752" data-name="Path 11752" d="M0,4,3.962,0,8,4" transform="translate(28 21) rotate(90)" fill="none" stroke="#004fd6" stroke-width="2"/>
	<path id="Path_11753" data-name="Path 11753" d="M0,4,3.962,0,8,4" transform="translate(28 45) rotate(90)" fill="none" stroke="#004fd6" stroke-width="2"/>
</svg>
`}}]);
