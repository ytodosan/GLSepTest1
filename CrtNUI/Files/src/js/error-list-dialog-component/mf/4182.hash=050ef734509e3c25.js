(self.webpackChunkapp_studio_enterprise_error_list_dialog=self.webpackChunkapp_studio_enterprise_error_list_dialog||[]).push([[4182,3308],{48422:(x,G,y)=>{var _={"./error-icon.svg":77017,"./warning-icon.svg":64207};function p(V){var c=w(V);return y(c)}function w(V){if(!y.o(_,V)){var c=new Error("Cannot find module '"+V+"'");throw c.code="MODULE_NOT_FOUND",c}return _[V]}p.keys=function(){return Object.keys(_)},p.resolve=w,x.exports=p,p.id=48422},74182:(x,G,y)=>{var _=y(71252),p=y(74369),w=y(40297),V=y(63721),c=y(59131),k=y(48059),U=y(27397),O=y(79772),P=y(23176),C=y(73308),L=y(6530);class ee extends Error{constructor(){super("Next handler already specified")}}var D=y(28399);class J{constructor(){this._refs=new Set,this.lazyLoadingDisabled=!1}static#e=this._globalInstancePath="creatio._lazyModulesManager";static get instance(){if(!this._instance){let e=(0,D.get)(window,this._globalInstancePath);e||(e=new this,(0,D.set)(window,this._globalInstancePath,e)),this._instance=e}return this._instance}add(e){this._refs.add(e)}size(){return this._refs.size}loadAll(){return Promise.all(Array.from(this._refs).map(e=>e.loadAndBootstrap()))}clear(){this._refs.clear()}}var ke;(function(i){i[i.Schema=0]="Schema",i[i.Remote=1]="Remote",i[i.Host=2]="Host"})(ke||(ke={}));const We=window;class he{constructor(){this.store={typeInfos:new Map}}static#e=this._prefix="creatio.registry.";static get store(){if(!this._instance){let e=(0,D.get)(We,this._prefix+this.registryKey);e||(e=new this,(0,D.set)(We,this._prefix+this.registryKey,e)),this._instance=e}return this._instance.store}}class Pt extends he{static#e=this.registryKey="pkgTopology";static get items(){return this.store.typeInfos}static get(e){const t=this.items.get(e);if(t===void 0)throw new Error(`Package with name ${e} not found in topology`);return t}}class m{constructor(e){this._request=e;const t=[...this._request.scopes??[]].reverse().map((s,r)=>[s,r]);this._scopesOrder=Object.fromEntries(t)}_getOrderByScopes(e){if(!e.scopes)return Number.MAX_VALUE;const t=e.scopes.filter(s=>s in this._scopesOrder).map(s=>this._scopesOrder[s]);return Math.min(...t)}_getOrderByPkgTopology(e){return e.source.type===ke.Host?Number.MAX_VALUE:Pt.get(e.source.packageName)}compare(e,t){const s=this._getOrderByScopes(e),r=this._getOrderByScopes(t);let n=s-r;if(n)return n;const a=this._getOrderByPkgTopology(e),u=this._getOrderByPkgTopology(t);return n=a-u,n||(n=e.source.type-t.source.type,n)}}var A=y(4930);const I="module",$="viewElement",K="mobileViewElement",Ie="interfaceDesignerItem",Ce="mobileInterfaceDesignerItem",Yt="requestHandler",An="designTimeViewElement",ut="validator",xi="converter";function Qt(i,e){Reflect.defineMetadata(I,i,e)}function Ac(i){const e=Reflect.getMetadata(I,i);if(!e)throw new Error(`Module metadata was not found on '${i.name}' class`);return e}function Bl(i,e){Reflect.defineMetadata($,i,e)}function or(i,e){Reflect.defineMetadata(K,i,e)}function vc(i){return Reflect.getMetadata($,i)}function Ec(i){return Reflect.getMetadata(K,i)}function cr(i,e){Reflect.defineMetadata(ut,i,e)}function Mc(i){const e=Reflect.getOwnMetadata(ut,i);if(!e)throw new Error(`Validator metadata was not found on '${i.name}' class`);return e}function Ic(i,e){Reflect.defineMetadata(xi,i,e)}function Rc(i){const e=Reflect.getOwnMetadata(xi,i);if(!e)throw new Error(`Converter metadata was not found on '${i.name}' class`);return e}function kl(i,e){Reflect.defineMetadata(Ie,i,e)}function wc(i,e){Reflect.defineMetadata(Ce,i,e)}function Fl(i){return Reflect.getOwnMetadata(Ie,i)}function Pc(i){return Reflect.getOwnMetadata(Ce,i)}function Dc(i,e){Reflect.defineMetadata(An,i,e)}function Tc(i){const e=Reflect.getOwnMetadata(An,i);if(!e)throw new Error(`Design time view element metadata was not found on '${i.name}' class`);return e}function Nc(i){return Reflect.hasOwnMetadata(Ie,i)}function Vc(i){return Reflect.hasOwnMetadata(Ce,i)}function Oi(i,e){Reflect.defineMetadata(Yt,i,e)}function jl(i){const e=Reflect.getMetadata(Yt,i);if(!e)throw new Error(`Request handler metadata was not found on '${i.name}' class`);return e}function vn(i){const e=Reflect.getMetadata("requestType",i);if(!e)throw new Error(`requestType was not found on '${i.name}' class`);return{requestType:e,typeRef:i}}function Li(i){const t=Reflect.getMetadataKeys(i).filter(s=>s.startsWith(crtInputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,i);return[s.replace(crtInputPrefix,""),r]}))}function $l(i){const t=Reflect.getMetadataKeys(i).filter(s=>s.startsWith(crtOutputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,i);return[s.replace(crtOutputPrefix,""),r]}))}function xc(i){const t=Reflect.getMetadataKeys(i).filter(s=>s.startsWith(crtValidationInputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,i);return[s.replace(crtValidationInputPrefix,""),r]}))}function En(i){const t=Reflect.getOwnMetadataKeys(i).filter(s=>s.startsWith(crtInjectPrefix));return Object.fromEntries(t.map(s=>{const r=Number(s.replace(crtInjectPrefix,"")),n=Reflect.getMetadata(s,i);return[r,n]}))}function Oc(i){const e=i.prototype?Object.getPrototypeOf(i.prototype):null;return e?e.constructor:null}function Lc(i){const e=Reflect.getOwnMetadata("design:paramtypes",i);if(!e){if(i.length>0)throw new Error(`Dependency Injection error. Cannot read dependencies of class '${i.name}'. Please make sure class '${i.name}' has decorator and 'emitDecoratorMetadata' option is enabled in your 'tsconfig.json' file.`);const s=Oc(i);return s&&s!==Object?Lc(s):[]}const t=En(i);return Object.entries(t).forEach(([s,r])=>e[s]=r),e}function Dt(i){console.error("Not supported: lazy modules should not be dependent on other lazy modules. Some functions may not work correctly",i)}function Mn(i){if(!Array.isArray(i))return[];if(i.length===0)return[];const e=new Set,t=[...i];for(;t.length>0;){const s=t.pop();if(!s||e.has(s))continue;if(typeof s!="function"){Dt(s);continue}e.add(s);const r=Ac(s)?.includes||[];t.push(...r)}return[...e]}function Bi(i,e){return i?.length?i.some(t=>e?.includes(t)):!0}const lt=window;lt.creatio??={},lt.creatio._bootstrappedCrtModules??=new Map;const In=lt.creatio._bootstrappedCrtModules;function Ze(i){In.forEach((e,t)=>{e.root&&i(e,t)})}function Bc(i){Ze(e=>e.options?.onContextCreate?.(i))}function kc(i){Ze(e=>e.options?.onContextUpdate?.(i))}function Rn(i){Ze(e=>e.options?.onContextDestroy?.(i))}class es{constructor(){var e=this;this._handlers=[],this._requestListeners=new Map,this._handlersCache=new Map,this._handlersScopesByContextId=new Map,this.handlerChain$={process:function(){var t=(0,C.A)(function*(s){let r;if(e._hasCacheHandler(s))r=e._getCacheHandler(s);else{const n=e._getMatchedHandlers(s);J.instance.lazyLoadingDisabled||(yield e._loadLazyHandlers(s,n)),r=e._buildHandlersChain(s,n)}return e._requestListeners.forEach(n=>n?.(s)),r?.handle(s)});return function(r){return t.apply(this,arguments)}}(),register:t=>(this._handlersCache.delete(t.requestType),this._handlers.push(t),()=>{const s=this._handlers.indexOf(t);s>-1?(this._handlers.splice(s,1),this._handlersCache.delete(t.requestType)):console.warn(`${t?.requestType} not found to unsubscribe`)}),update:t=>{const s=this._handlers.find(r=>r.type===t.type);s&&(s.createHandler=t.createHandler)},subscribe:(t,s)=>{if(!t)return()=>{};const r=(0,L.qv)(),n=a=>{(!s||a.$context===s)&&t(a)};return this._requestListeners.set(r,n),()=>this._requestListeners.delete(r)}}}clearContextedHandlersCache(e){return(this._handlersScopesByContextId.get(e)??[]).every(({requestType:s,scope:r})=>this._handlersCache.get(s)?.delete(r))}clear(){this._handlers.splice(0),this._requestListeners.clear(),this._handlersCache.clear(),this._handlersScopesByContextId.clear()}_getCacheHandler(e){const t=this._handlersCache.get(e.type),s=this._getCacheScopesKey(e);return t.get(s)}_hasCacheHandler(e){const t=this._handlersCache.get(e.type),s=this._getCacheScopesKey(e);return t&&t.has(s)}_getCacheScopesKey(e){const t=this._getInjectionContext(e?.$context)?.id??"";return(e.scopes||[""]).join("_").concat(t)}_getInjectionContext(e){return e?._injectionContext||e?.parent&&this._getInjectionContext(e.parent)}_setContextedScopes(e,t){const s=this._getInjectionContext(e?.$context)?.id,r=this._handlersScopesByContextId.has(s)?this._handlersScopesByContextId.get(s):[];r.push({requestType:e.type,scope:t}),this._handlersScopesByContextId.set(s,r)}_setCacheHandler(e,t){const s=this._handlersCache.has(e.type)?this._handlersCache.get(e.type):new Map,r=this._getCacheScopesKey(e);s.set(r,t),this._getInjectionContext(e?.$context)?.id&&this._setContextedScopes(e,r),this._handlersCache.set(e.type,s)}_isRequestHandler(e){return typeof e.handle=="function"&&typeof e.setNext=="function"}_checkHandlerInstanceOf(e){if(!this._isRequestHandler(e))throw new Error('Handler should implement "BaseRequestHandler"')}_loadLazyHandlers(e,t){var s=this;return(0,C.A)(function*(){const r=new Set;t.forEach(u=>{u.lazy&&!u.createHandler&&r.add(u.lazyModuleRef)});const n=[...r];yield Promise.all(n.map(u=>u.loadAndBootstrap()));const a=s._getInjectionContext(e?.$context);if(a&&r.size){const u=yield Mn(n.map(d=>d.typeRef));for(const d of u)a.addLazyModule(d);kc(a)}})()}_getMatchedHandlers(e){return this._handlers.filter(t=>t.requestType!==e.type?!1:Bi(t.scopes,e.scopes))}_buildHandlersChain(e,t){const s=new m(e);t.sort((u,d)=>s.compare(u,d));const r=this._getInjectionContext(e?.$context),n=t.map(u=>u.createHandler.call(u,r));n.forEach(u=>this._checkHandlerInstanceOf(u)),this._joinHandlersInChain(n);const a=n[0];return this._setCacheHandler(e,a),a}_joinHandlersInChain(e){for(let t=0;t<e.length-1;t++)try{e[t].setNext(e[t+1])}catch(s){throw s instanceof ee?new Error("Handler factory should return new instance of BaseRequestHandler class or its subclass (next handler should not be specified)"):s}}}const ts=window;class ce{get _chain(){return ts.handlerChain}set _chain(e){ts.handlerChain=e}static get instance(){return ce._instance||(ce._instance=new ce)}constructor(){this._chain||this._createGlobalHandlerChain()}_createGlobalHandlerChain(){this._chain=new es}clearContextedHandlersCache(e){return this._chain.clearContextedHandlersCache(e)}register(e){return this._chain.handlerChain$.register(e)}update(e){return this._chain.handlerChain$.update(e)}process(e){return this._chain.handlerChain$.process(e)}subscribe(e,t){return this._chain.handlerChain$.subscribe(e,t)}clear(){this._chain.clear()}}function Ae(i,e){if(i.split(".").length<2)throw new Error(`Error when register ${i}. Type property should have format "VendorPrefix.${e}"`)}function ur(i,e){return Ae(i,e)}function Je(i){const[e,t]=i.split("."),s=ki(t);if(!e||s!==t)throw new Error(`Error when register ${i}. Type property should have Pascal case, e.g. ${e+"."+s}. The first letter of each word in a compound word should be capitalized`)}function Fe(i){const[e,t]=i.split("."),s=ki(t);if(e.toLowerCase()==="crt"&&s!==t)throw new Error(`Error when register ${i}. Type property should have Pascal case, e.g. ${e+"."+s}. The first letter of each word in a compound word should be capitalized`)}function ki(i){return(0,D.upperFirst)((0,D.camelCase)(i))}function wn(i,e){if(!e)throw new Error(`Error when resolve ${i}. Type was not registered.`)}function Fc(i,e,t){if(t.has(i)&&!isEqual(t.get(i),e))throw new Error(`Error when register ${i}. Element with this type has already exist`)}class Fi extends he{static#e=this.registryKey="HandlerChainServicesRegistry";static validate({requestType:e}){Ae(e,this.registryKey),Fe(e),this.checkUniqueRequestType(e)}static checkUniqueRequestType(e){if(this.services.get(e))throw new Error(`${e} already registered`)}static register(e){this.validate(e),this.services.set(e.requestType,e)}static get services(){return this.store.typeInfos}}class te{constructor(){this.handlerChain=ce.instance}static#e=this._instanceOfKey="devkit_BaseRequestHandler";get next(){return this._next}static[Symbol.hasInstance](e){return e?.constructor?._instanceOfKey===te._instanceOfKey}setNext(e){if(this._next)throw new ee;this._next=e}}var l=y(62278);class Xe{constructor(e){this._injector=e,this._handlerChain=ce.instance,this._unsubscribesHandlers=[],this._registerHandlerChain()}_registerHandlerChain(){Fi.services.forEach((e,t)=>{Ae(t,"HandlerChainServiceTypeName"),Fe(t);const s=class extends te{constructor(n){super(),this._innerInjector=n}handle(n){const u=this._innerInjector.get(e.typeRef)[n.method](...n.args);let d;return u instanceof Promise?d=u:u instanceof l.Observable?d=(0,l.lastValueFrom)(u,{defaultValue:null}):d=Promise.resolve(u),d}},r=()=>new s(this._injector);this._unsubscribesHandlers.push(this._handlerChain.register({requestType:t,createHandler:r,source:{type:ke.Host}}))})}ngOnDestroy(){this._unsubscribesHandlers.forEach(e=>e())}static#e=this.\u0275fac=function(t){return new(t||Xe)(c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Xe,factory:Xe.\u0275fac})}const Pn={provide:c.APP_INITIALIZER,useFactory:()=>()=>{},deps:[Xe],multi:!0};var f=y(5960);const E=new c.InjectionToken("FEATURE_VALUES",{factory:()=>({})});var o=y(36486);const S=new Array("constructor","ngOnDestroy");let R=!1;const N=new Proxy({},{get(i,e){if(R||S.includes(e))return i[e];throw new Error(`FEATURE_VALUES. "${String(e)}" not loaded`)}}),Q={provide:E,useFactory:()=>N},se=new c.InjectionToken("FEATURE_SERVICE_GET_FEATURES_STATES_ENDPOINT",{factory:()=>"rest/FeatureService/GetFeatureStates",providedIn:"root"});let ye=class Ri{constructor(e,t){this.httpClient=e,this._getFeatureStatesEndpoint=t,this._cachedCodes=new Map,this._destroyed$=new l.Subject}_checkFeaturesFromURL(){const e=r=>{new URLSearchParams(r.startsWith("?")?r.slice(1):r).forEach((a,u)=>{if(u.startsWith("feature:")){const d=u.substring(8),h=a==="true";this._cachedCodes.set(d,h)}})},t=location.hash,s=t.indexOf("?");if(s>=0){const r=t.substring(s+1);e(r)}}loadFeatureStates(){return this._featureStates$?this._featureStates$:(this._featureStates$=this.httpClient.post(this._getFeatureStatesEndpoint,{}).pipe((0,o.map)(e=>(e.GetFeatureStatesResult.forEach(t=>{this._cachedCodes.set(t.Key,t.Value===1)}),(0,c.isDevMode)()&&this._checkFeaturesFromURL(),Object.fromEntries(this._cachedCodes.entries()))),(0,o.tap)(e=>{Object.assign(N,e),Object.freeze(N),R=!0}),(0,o.catchError)(()=>(R=!0,(0,l.of)(null))),(0,l.shareReplay)({bufferSize:1,refCount:!1}),(0,o.takeUntil)(this._destroyed$)),this._featureStates$)}getFeatureState(e){return e?this._cachedCodes.size>0?(0,l.of)(this._cachedCodes.get(e)||!1):this.loadFeatureStates().pipe((0,o.map)(()=>this._cachedCodes.get(e)||!1)):(0,l.of)(!1)}getFeaturesState(e){return(0,l.from)(this.getFeaturesStateAsync(e))}getFeaturesStateAsync(e){return Promise.all(e.map(t=>{const s=typeof t=="string"?this.getFeatureState(t):t;return new Promise(r=>s.pipe((0,o.first)()).subscribe({next:r}))}))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static#e=this.\u0275fac=function(t){return new(t||Ri)(c.\u0275\u0275inject(V.HttpClient),c.\u0275\u0275inject(se))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ri,factory:Ri.\u0275fac,providedIn:"root"})};ye=(0,f.__decorate)([(0,P.op)({requestType:"crt.FeatureService"}),(0,f.__metadata)("design:paramtypes",[V.HttpClient,String])],ye);function dt(i){return()=>(0,l.lastValueFrom)(i.loadFeatureStates(),{defaultValue:null})}const Tt={provide:c.APP_INITIALIZER,useFactory:dt,deps:[ye],multi:!0};function jc(i){return i.endsWith("/")||(i+="/"),i}function Ul(i){return i.replace(/(^([/\\])+)|(([/\\])+$)/,"")}function ql(i){return i=i.replace(location.hash,""),i.replace(location.search,"")}function Hl(i){return`${Kl()}/Navigation/Navigation.aspx?schemaName=${i}`}function em(){return"/"}function ht(){let i=location.pathname;const e=i.match(/.*?\/\d\/?/);return e&&e.length===1?i=jc(e[0]):i="",zl(location.origin,i)}function $c(){let i=location.href.replace(ht(),"");return i=ql(i),i||"/"}function tm(){const i=$c(),e=ht(),t=i.split("/").filter(Boolean)[0];return t?`${e}${t}/`:e}function Dn(){let e=ht().replace(location.origin,"");return e.endsWith("/")&&(e=e.substring(0,e.length-1)),e}function Kl(){return ht().replace(/\/0\/?$|\/+$/,"")}function zl(...i){return i.map(e=>Ul(e)).join("/")}function sm(i,e){return`${Hl(i)}&recordId=${e}`}function rm(i,e){function t(a,u){return a.toLowerCase().replace(u,"").split("/").filter(d=>d).join("/")}const s=ht().toLowerCase(),r=t(i,s),n=t(e,s);return r===n}function nm(i){return i?Dn()+imageServiceUrl+i:null}function im(){return Dn()+esqServiceUrl}function am(i){const{uId:e,name:t,packageUId:s,userLevelSchema:r}=i;if(!e&&!t)throw new Error("uId or name is required");const n=ht(),a=$c(),u=`#/InterfaceDesigner/${e||t}`,d=new URLSearchParams;return s&&d.append("packageUId",s),r&&d.append("userLevelSchema","true"),`${n}${a}${u}?${d.toString()}`}const Gl="Translations/Custom/",Wl="CommonFeatures.UseCustomCoreLocalizations",Uc=new c.InjectionToken("FETCH_MULTI_TRANSLATE_RESOURCES_SOURCES"),qc=new c.InjectionToken("FETCH_MULTI_TRANSLATE_CUSTOM_RESOURCES_SOURCES");class pt{constructor(e,t,s){this._resourceSources=e,this._customResourceSources=t,this._featureService=s}_getCustomResourcesSource(){return this._customResourceSources?.length?this._customResourceSources:[{prefix:w.Location.joinWithSlash(ht(),Gl),suffix:".json"}]}getResourceOptions(){return(0,l.from)(this._featureService.getFeatureState(Wl)).pipe((0,l.map)(e=>e?this._getCustomResourcesSource():[]),(0,l.map)(e=>[...this._resourceSources??[],...e]))}static#e=this.\u0275fac=function(t){return new(t||pt)(c.\u0275\u0275inject(Uc),c.\u0275\u0275inject(qc,8),c.\u0275\u0275inject(ye))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:pt,factory:pt.\u0275fac})}const Hc=new c.InjectionToken("NestedTranslateLoader");class Nt{constructor(e){this._optionsProvider=e}_fetchTranslation(e){return fetch(e,{cache:"no-cache"}).then(t=>{if(!t.ok&&t.status!==304)throw new Error(`Loading translations failed: ${e} (${t.status})`);return t.json()})}_handleFetchResults(e){for(const s of e.filter(r=>r.status==="rejected"))console.error(s.reason);const t=e.filter(s=>s.status==="fulfilled").map(s=>s.value||{});return(0,D.merge)({},...t)}getTranslation(e){return this._optionsProvider.getResourceOptions().pipe((0,l.switchMap)(t=>{const s=t.map(({prefix:r,suffix:n})=>this._fetchTranslation(`${r}${e}${n}`));return(0,l.from)(Promise.allSettled(s)).pipe((0,l.map)(r=>this._handleFetchResults(r)))}))}static#e=this.\u0275fac=function(t){return new(t||Nt)(c.\u0275\u0275inject(pt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Nt,factory:Nt.\u0275fac})}class lr{static _getResourceSourcesProviders(e){const{resourceSources:t,customResourceSources:s}=e??{},r=(s??[]).map(n=>({...n,provide:qc,multi:!0}));return[{provide:Uc,useValue:t},...r]}static forRoot(e){const t=O.TranslateModule.forRoot({...e,loader:{provide:O.TranslateLoader,useClass:Nt}});return t.providers.push(pt,...this._getResourceSourcesProviders(e)),t}static forNested(e){const t=O.TranslateModule.forRoot(e);return t.providers.push({provide:Hc,useClass:Nt},pt,...this._getResourceSourcesProviders(e)),t}static with(e){return{ngModule:lr,providers:[Nt,pt,...this._getResourceSourcesProviders(e)]}}static#e=this.\u0275fac=function(t){return new(t||lr)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:lr});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({})}var v=y(86464),ji=y(52989);class Kc{constructor(e){Object.assign(this,e)}}class om extends Kc{constructor(e){super(e),this.externalLink=!1}}class zc extends Kc{}var Gc=y(91592),Vt;(function(i){i[i.Error=1]="Error",i[i.Warning=2]="Warning",i[i.Information=4]="Information"})(Vt||(Vt={}));function Zl(i,e){if(i&1&&c.\u0275\u0275element(0,"mat-icon",1),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275property("svgIcon",t.svgIconName)}}class Jl extends zc{constructor(e){super(e),this.cellComponentClass=Tn}}class Tn extends Gc.X{get svgIconName(){return{[Vt.Error]:this.errorIconName,[Vt.Warning]:this.warningIconName,[Vt.Information]:""}[this.getValue()]??""}constructor(e,t){super(),this._matIconRegistry=e,this._domSanitizer=t,this.errorIconName="error-icon",this.warningIconName="warning-icon",this._registerIcons()}_registerIcons(){[this.warningIconName,this.errorIconName].forEach(e=>{this._matIconRegistry.addSvgIconLiteral(e,this._domSanitizer.bypassSecurityTrustHtml(y(48422)("./"+e+".svg")))})}static#e=this.\u0275fac=function(t){return new(t||Tn)(c.\u0275\u0275directiveInject(ji.MatIconRegistry),c.\u0275\u0275directiveInject(_.DomSanitizer))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:Tn,selectors:[["ts-error-type-icon-table-cell"]],features:[c.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","error-type-icon",3,"svgIcon",4,"ngIf"],[1,"error-type-icon",3,"svgIcon"]],template:function(t,s){t&1&&c.\u0275\u0275template(0,Zl,1,1,"mat-icon",0),t&2&&c.\u0275\u0275property("ngIf",!s.isEmpty()&&s.getValue())},dependencies:[w.NgIf,ji.MatIcon],styles:[".error-type-icon[_ngcontent-%COMP%]{height:16px;width:16px}"]})}function Xl(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"div",1),c.\u0275\u0275element(1,"mat-icon",2),c.\u0275\u0275elementEnd()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("svgIcon",t.iconName)}}class Yl extends zc{constructor(e,t){super(e),this.cellComponentClass=dr,this.iconName=t}}class dr extends Gc.X{get iconName(){return this.columnDataSchema.iconName.length?this.columnDataSchema.iconName:this.getValue()}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(dr)))(s||dr)}})();static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:dr,selectors:[["ts-icon-table-cell"]],features:[c.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","drag-drop-icon-wrapper","cdkDragHandle","",4,"ngIf"],["cdkDragHandle","",1,"drag-drop-icon-wrapper"],[3,"svgIcon"]],template:function(t,s){t&1&&c.\u0275\u0275template(0,Xl,2,1,"div",0),t&2&&c.\u0275\u0275property("ngIf",!s.isEmpty())},dependencies:[w.NgIf,ji.MatIcon]})}var re=y(76923),Ql=y(14715);class ed extends Ql.MatLegacyTableDataSource{constructor(e=[]){super(e),this._visibleContentSize=0,this._pageSize=40,this.resetVisibleContentSize()}resetVisibleContentSize(){this._visibleContentSize=this._pageSize}loadNext(){this._visibleContentSize+=this._pageSize,this._updateChangeSubscription()}_pageData(e){return this._visibleContentSize>=e.length?e:e.slice(0,this._visibleContentSize)}}class $i extends Error{constructor(e){super(`Argument with name '${e}' is empty.`)}}class Nn extends Error{constructor(e){super(`Argument with name '${e}' is out of range.`)}}class q{static checkArgumentEmpty(e,t){if(t==null)throw new $i(e)}static checkArrayEmpty(e,t){if(q.checkArgumentEmpty(e,t),t.length===0)throw new $i(e)}static checkStringIsNotEmpty(e,t){if(this.checkArgumentEmpty(e,t),t==="")throw new $i(e);return t}static checkArgumentOutOfRange(e,t,s){if(s.begin&&t<s.begin)throw new Nn(e);if(s.end&&t>s.end)throw new Nn(e)}static checkEnumOutOfRange(e,t,s){if(!s||!Object.values(s).includes(t))throw new Nn(e)}}class hr{createObserver(e,t,s){return new td(e,t,s)}static#e=this.\u0275fac=function(t){return new(t||hr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:hr,factory:hr.\u0275fac,providedIn:"root"})}class td{constructor(e,t,s){if(this._bottomBuffer=100,this._lastScrollMaxPosition=0,this._emitter=new c.EventEmitter,q.checkArgumentEmpty("element",e),this._element=e,this._subscribeOnScroll(),s){if(s<=0)throw new Error(`Value of 'bottomBuffer' paramter must be positive, but actual value is ${s}.`);this._bottomBuffer=s}t&&this.subscribe(t)}_isWindowObserved(e){return!(this._element instanceof HTMLElement)}_scrolledToBottom(){const e=this._element,t=this._isWindowObserved(e)?e.document.documentElement.scrollTop:e.scrollTop,s=this._isWindowObserved(e)?e.document.body.scrollHeight:e.scrollHeight,r=this._isWindowObserved(e)?e.innerHeight:e.offsetHeight;if(!s||!r)return!1;const n=s-r-this._bottomBuffer;return this._lastScrollMaxPosition=t>this._lastScrollMaxPosition?t:this._lastScrollMaxPosition,this._lastScrollMaxPosition===t&&t>=n}_processScroll(){this._scrolledToBottom()&&this._emitter.emit()}_subscribeOnScroll(){this._eventListener=this._processScroll.bind(this),this._element.addEventListener("scroll",this._eventListener)}subscribe(e){this._emitter.subscribe(e)}resetScrollMaxPosition(){this._lastScrollMaxPosition=0}destroy(){this._element.removeEventListener("scroll",this._eventListener),this._element=null,this._emitter.unsubscribe()}}var ss=y(23023);const sd=["dataViewWrapper"],rd=["tableNgContainer"];function nd(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"div",10),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.additionalText)}}function id(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"div",11)(1,"a",12),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("href",t.helpLinkUrl.url,c.\u0275\u0275sanitizeUrl),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.helpLinkUrl.caption)}}function ad(i,e){if(i&1&&(c.\u0275\u0275elementContainerStart(0),c.\u0275\u0275elementStart(1,"button",13),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(4,"button",14),c.\u0275\u0275text(5),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementContainerEnd()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("mat-dialog-close",!1),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(3,4,"TableDialog.Cancel")," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",!0),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.continueButtonCaption)}}function od(i,e){i&1&&(c.\u0275\u0275elementStart(0,"button",13),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),i&2&&(c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,1,"TableDialog.Close")," "))}class rs{constructor(e,t){this.dialogData=e,this.scrollToBottomObserverFactory=t,this.title="",this.sortColumn="",this.additionalText="",this.continueButtonCaption=""}_renderTableComponent(e){var t=this;return(0,C.A)(function*(){yield Promise.all([y.e(5567),y.e(2225),y.e(8585)]).then(y.bind(y,88585)).then(s=>{const r=s.TableComponent;t._table=e.createComponent(r).instance,t._table.dataSchema=t.dataSchema,t._table.dataSource=t.tableDataSource,t._table.sortColumn=t.sortColumn,t._table.headerSticky=!0})})()}_initScrollToBottomObserver(){const e=this.dataViewWrapper.nativeElement;this._scrollToBottomObserver=this.scrollToBottomObserverFactory.createObserver(e,this._loadNextData.bind(this))}_loadNextData(){this.tableDataSource&&this.tableDataSource.loadNext()}ngAfterViewInit(){this._initScrollToBottomObserver()}ngOnInit(){var e=this;return(0,C.A)(function*(){!e.dialogData||!e.dialogData.data||(e.tableDataSource=new ed(e.dialogData.data),e.dataSchema=e.dialogData.dataSchema,e.title=e.dialogData.title||e.title,e.sortColumn=e.dialogData.sortColumn,e.additionalText=e.dialogData.additionalText,e.helpLinkUrl=e.dialogData.helpLinkUrl,e.continueButtonCaption=e.dialogData.continueButtonCaption,yield e._renderTableComponent(e.tableNgContainer))})()}ngOnDestroy(){this._scrollToBottomObserver&&this._scrollToBottomObserver.destroy()}static#e=this.\u0275fac=function(t){return new(t||rs)(c.\u0275\u0275directiveInject(re.MAT_LEGACY_DIALOG_DATA),c.\u0275\u0275directiveInject(hr))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:rs,selectors:[["ts-table-dialog"]],viewQuery:function(t,s){if(t&1&&(c.\u0275\u0275viewQuery(sd,7),c.\u0275\u0275viewQuery(rd,7,c.ViewContainerRef)),t&2){let r;c.\u0275\u0275queryRefresh(r=c.\u0275\u0275loadQuery())&&(s.dataViewWrapper=r.first),c.\u0275\u0275queryRefresh(r=c.\u0275\u0275loadQuery())&&(s.tableNgContainer=r.first)}},decls:14,vars:5,consts:[["dataViewWrapper",""],["tableNgContainer",""],["withoutContinue",""],["mat-dialog-title",""],[1,"dialog-content-wrapper"],["class","table-dialog-additional-text",4,"ngIf"],["class","table-dialog-help-link-url",4,"ngIf"],["mat-dialog-content","",1,"data-table"],["mat-dialog-actions",""],[4,"ngIf","ngIfElse"],[1,"table-dialog-additional-text"],[1,"table-dialog-help-link-url"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-flat-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,s){if(t&1&&(c.\u0275\u0275elementStart(0,"div",3)(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",4),c.\u0275\u0275template(4,nd,2,1,"div",5)(5,id,3,2,"div",6),c.\u0275\u0275elementStart(6,"div",7,0),c.\u0275\u0275elementContainer(8,null,1),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(10,"div",8),c.\u0275\u0275template(11,ad,6,6,"ng-container",9)(12,od,3,3,"ng-template",null,2,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()()),t&2){const r=c.\u0275\u0275reference(13);c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.title),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",s.additionalText),c.\u0275\u0275advance(),c.\u0275\u0275property("ngIf",s.helpLinkUrl),c.\u0275\u0275advance(6),c.\u0275\u0275property("ngIf",s.continueButtonCaption)("ngIfElse",r)}},dependencies:[w.NgIf,ss.MatLegacyButton,re.MatLegacyDialogClose,re.MatLegacyDialogTitle,re.MatLegacyDialogContent,re.MatLegacyDialogActions,O.TranslatePipe],styles:[`ts-table-dialog{min-width:850px;max-width:900px;margin:0 8px!important;padding:0}ts-table-dialog .table-dialog-additional-text{margin-bottom:4px;display:inline}ts-table-dialog .table-dialog-help-link-url{display:inline;cursor:pointer}ts-table-dialog .data-table{overflow-y:auto!important;max-height:330px;margin:0;padding:0}ts-table-dialog .data-table table{padding-top:0}ts-table-dialog [mat-dialog-actions]{display:flex;flex-direction:row;justify-content:flex-end;margin:20px 0 10px!important}
`],encapsulation:2})}var mt=y(29957),ns;(function(i){i[i.Primary=0]="Primary",i[i.Secondary=1]="Secondary",i[i.Cancel=2]="Cancel",i[i.Delete=3]="Delete"})(ns||(ns={}));const cd={caption:"ConfirmationDialog.YES",result:ns.Secondary},ud={caption:"ConfirmationDialog.NO",result:ns.Primary},cm={caption:"ConfirmationDialog.CANCEL",result:ns.Cancel},um={caption:"ConfirmationDialog.DELETE",result:ns.Delete};function ld(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"button",6),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275property("mat-dialog-close",t.secondaryButton.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,2,t.secondaryButton.caption)," ")}}function dd(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"button",6),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),i&2){const t=e.$implicit;c.\u0275\u0275property("mat-dialog-close",t.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,2,t.caption)," ")}}class is{constructor(e){this.data=e,this.buttons=[],e&&(this.primaryButton=e.primaryButton,this.secondaryButton=e.secondaryButton,this.message=e.message,this.buttons=e.buttons),this.buttons?.length||(this.primaryButton??=ud,this.secondaryButton??=cd)}static#e=this.\u0275fac=function(t){return new(t||is)(c.\u0275\u0275directiveInject(re.MAT_LEGACY_DIALOG_DATA))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:is,selectors:[["ts-confirmation-dialog"]],decls:9,vars:7,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngIf"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngFor","ngForOf"],["mat-button","",1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0)(1,"span",1),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",2)(4,"button",3),c.\u0275\u0275text(5),c.\u0275\u0275pipe(6,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(7,ld,3,4,"button",4)(8,dd,3,4,"button",5),c.\u0275\u0275elementEnd()),t&2&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.data==null?null:s.data.message),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",s.primaryButton.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(6,5,s.primaryButton.caption)," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",s.secondaryButton),c.\u0275\u0275advance(),c.\u0275\u0275property("ngForOf",s.buttons))},dependencies:[w.NgForOf,w.NgIf,ss.MatLegacyButton,re.MatLegacyDialogClose,re.MatLegacyDialogContent,re.MatLegacyDialogActions,O.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{margin:27px 0 0!important;justify-content:flex-end}"]})}class as{constructor(e){this.data=e}static#e=this.\u0275fac=function(t){return new(t||as)(c.\u0275\u0275directiveInject(re.MAT_LEGACY_DIALOG_DATA))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:as,selectors:[["ts-error-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","warn","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0)(1,"span",1),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",2)(4,"button",3),c.\u0275\u0275text(5),c.\u0275\u0275pipe(6,"translate"),c.\u0275\u0275elementEnd()()),t&2&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.data==null?null:s.data.message),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[ss.MatLegacyButton,re.MatLegacyDialogClose,re.MatLegacyDialogContent,re.MatLegacyDialogActions,O.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}class os{constructor(e){this.data=e}static#e=this.\u0275fac=function(t){return new(t||os)(c.\u0275\u0275directiveInject(re.MAT_LEGACY_DIALOG_DATA))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:os,selectors:[["ts-info-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0)(1,"span",1),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",2)(4,"button",3),c.\u0275\u0275text(5),c.\u0275\u0275pipe(6,"translate"),c.\u0275\u0275elementEnd()()),t&2&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.data==null?null:s.data.message),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[ss.MatLegacyButton,re.MatLegacyDialogClose,re.MatLegacyDialogContent,re.MatLegacyDialogActions,O.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}class xt{constructor(e,t,s,r){this.document=e,this._ngZone=t,this._translateService=s,this.dialog=r}_stopEventPropagation(e,t){e.afterOpened().pipe((0,o.takeUntil)(t)).subscribe(s=>{const n=this.document.getElementsByClassName("cdk-overlay-container")[0];n&&n.addEventListener("click",function(a){a.stopImmediatePropagation()})})}getMessageDialogConfig(e){const t={width:"450px",panelClass:["dialog-top-border"],data:{}};if(typeof e=="string")return t.data.message=e,t;e.panelClass&&e.panelClass.length&&t.panelClass.push(...e.panelClass);const s=e;return s.primaryButton&&(t.data.primaryButton=s.primaryButton),s.secondaryButton&&(t.data.secondaryButton=s.secondaryButton),s.buttons&&(t.data.buttons=s.buttons),t.data.message=s.message,t}open(e,t){return this._ngZone.run(()=>{const s=this.dialog.open(e,t),r=s.afterClosed();return this._stopEventPropagation(s,r),r})}openInfoDialog(e){return this.open(os,this.getMessageDialogConfig(e))}openErrorDialog(e){return this.open(as,this.getMessageDialogConfig(e))}openConfirmationDialog(e){return this.open(is,this.getMessageDialogConfig(e))}openOperationPermissionsErrorDialog(e){const t=mt.String.format(this._translateService.instant("OperationPermissionsErrorDialog.ErrorTemplate"),e);return this.openInfoDialog(t)}closeById(e){this.dialog.getDialogById(e)?.close()}closeAll(){this.dialog.closeAll()}hasOpenDialogs(){return!!this.dialog.openDialogs?.length}getOpenDialogs(){return this.dialog.openDialogs}static#e=this.\u0275fac=function(t){return new(t||xt)(c.\u0275\u0275inject(w.DOCUMENT),c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(O.TranslateService),c.\u0275\u0275inject(re.MatLegacyDialog))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:xt,factory:xt.\u0275fac})}var F;(function(i){i.PrimaryColumnValue="primaryColumnValue",i.ColumnValue="columnValue",i.Filter="filter",i.PrimaryDisplayValueFilter="primaryDisplayValueFilter",i.Empty="empty",i.Never="never"})(F||(F={}));var ue=y(78240);class pr{static#e=this._instanceOfKey="devkit_BaseFilter";static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isEnabled=!0,this.trimDateTimeParameterToDate=!1,this.filterType=e}static fromJson(e,t,s){throw new Error(`fromJson not supported on filter type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,ue.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,ue.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class je extends pr{static#e=this._instanceOfKey="devkit_SingleFilter";static get _instanceOfKeys(){return[...pr._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(e),this.comparisonType=t,this.leftExpression=s?.clone()}toJson(){return{...super.toJson(),leftExpression:this.serializeItem(this.leftExpression)}}_getUsedColumns(){return this.leftExpression._getUsedColumns()}}var ie;(function(i){i[i.None=0]="None",i[i.Compare=1]="Compare",i[i.IsNull=2]="IsNull",i[i.Between=3]="Between",i[i.In=4]="In",i[i.Exists=5]="Exists",i[i.FilterGroup=6]="FilterGroup"})(ie||(ie={}));class Re extends je{static#e=this._instanceOfKey="devkit_CompareFilter";static get _instanceOfKeys(){return[...je._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(ie.Compare,e,t),this.filterType=ie.Compare,this.rightExpression=s?.clone()}static fromJson(e,t,s){return new Re(e.comparisonType,s.fromJson(e.leftExpression,t),s.fromJson(e.rightExpression,t))}clone(){const e=new Re(this.comparisonType,this.leftExpression,this.rightExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpression:this.serializeItem(this.rightExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightExpression._getUsedColumns()]}}var ne;(function(i){i[i.Between=0]="Between",i[i.Contain=11]="Contain",i[i.End_with=13]="End_with",i[i.Equal=3]="Equal",i[i.Exists=15]="Exists",i[i.Greater=7]="Greater",i[i.Greater_or_equal=8]="Greater_or_equal",i[i.Is_not_null=2]="Is_not_null",i[i.Is_null=1]="Is_null",i[i.Less=5]="Less",i[i.Less_or_equal=6]="Less_or_equal",i[i.Not_contain=12]="Not_contain",i[i.Not_end_with=14]="Not_end_with",i[i.Not_equal=4]="Not_equal",i[i.Not_exists=16]="Not_exists",i[i.Not_start_with=10]="Not_start_with",i[i.Start_with=9]="Start_with"})(ne||(ne={}));var fe;(function(i){i[i.SchemaColumn=0]="SchemaColumn",i[i.Function=1]="Function",i[i.Parameter=2]="Parameter",i[i.SubQuery=3]="SubQuery",i[i.ArithmeticOperation=4]="ArithmeticOperation"})(fe||(fe={}));class $e{static#e=this._instanceOfKey="devkit_BaseExpression";static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isBlock=!1,this.isBlock=e?.isBlock}static fromJson(e,t,s){throw new Error(`fromJson not supported on expression type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,ue.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,ue.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class X extends $e{static#e=this._instanceOfKey="devkit_ColumnExpression";static get _instanceOfKeys(){return[...$e._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=fe.SchemaColumn,this.columnPath=e?.columnPath}static fromJson(e){return new X({columnPath:e.columnPath})}clone(){return new X(this)}_getUsedColumns(){return[{path:this.columnPath}]}}function hd(i){return i.getFullYear()<1970}function pd(i){const e=i.getTimezoneOffset()*6e4;return new Date(i.getTime()-e).toISOString().slice(0,-1)}function md(i){const e=i.getFullYear(),t=mr(i.getMonth()+1),s=mr(i.getDate()),r=mr(i.getHours()),n=mr(i.getMinutes()),a=mr(i.getSeconds()),u=fd(i.getMilliseconds());return`${e}-${t}-${s}T${r}:${n}:${a}.${u}`}function mr(i){return String(i).padStart(2,"0")}function fd(i){return String(i).padStart(3,"0")}function Ui(i){if(!(i instanceof Date))throw new TypeError;return hd(i)?md(i):pd(i)}function Wc(i){return`"${Ui(i)}"`}class ae extends $e{static#e=this._instanceOfKey="devkit_ParameterExpression";static get _instanceOfKeys(){return[...$e._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=fe.Parameter;const t=e?.value;if(t instanceof Date){const s=new Date;s.setTime(t.getTime()),this.value=s}else t?this.value=typeof t=="object"?{...t}:t:this.value=t;this.dataValueType=e?.dataValueType??v.r.Text,this.parameter={dataValueType:this.dataValueType,...this._getParameterValueMetadata()}}static fromJson(e){return new ae(e.parameter)}_convertStringToBlobArray(e){const t=[];let s=0;for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);n<128?t[s++]=String.fromCharCode(n):n<2048?(t[s++]=String.fromCharCode(n>>6|192),t[s++]=String.fromCharCode(n&63|128)):(t[s++]=String.fromCharCode(n>>12|224),t[s++]=String.fromCharCode(n>>6&63|128),t[s++]=String.fromCharCode(n&63|128))}return t}_getParameterValueMetadata(){return this.dataValueType===v.r.Blob?{arrayValue:this.value?this._convertStringToBlobArray(this.value):[]}:this.value instanceof Date?{value:Wc(this.value)}:{value:this.value}}clone(){return new ae(this)}_getUsedColumns(){return[]}}(0,f.__decorate)([(0,ue.Exclude)(),(0,f.__metadata)("design:type",Object)],ae.prototype,"value",void 0),(0,f.__decorate)([(0,ue.Exclude)(),(0,f.__metadata)("design:type",Number)],ae.prototype,"dataValueType",void 0);class lm{}const Zc=new c.InjectionToken("ContextService");var De;(function(i){i.ViewElement="viewElement",i.Page="page"})(De||(De={}));var z;(function(i){i.OwnAttribute="Own",i.ForwardReferenceAttribute="ForwardReference",i.BackReferenceAttribute="BackReference",i.AggregationAttribute="Aggregation",i.FunctionAttribute="Function"})(z||(z={}));var Jc;(function(i){i[i.General=0]="General",i[i.Advanced=1]="Advanced",i[i.None=2]="None"})(Jc||(Jc={}));class ge{constructor(e){this._featureValues=e,this._consequentMeasureStartTimeCorrection=.001,this._lastNowStartTime=0,this.rendering$=new l.BehaviorSubject(null),this._useMeasurePerformanceTools=this._featureValues?.UseMeasurePerformanceTools}_getNowStartTimeWithCorrection(){const e=performance.now(),t=e<=this._lastNowStartTime?this._lastNowStartTime+this._consequentMeasureStartTimeCorrection:e;return this._lastNowStartTime=t,t}measure(e,t,s){if(!this._useMeasurePerformanceTools)return t();const r=s||this._getNowStartTimeWithCorrection(),n=t();return performance.measure(e,{start:r}),n}measureCallback(e,t){var s=this;return(0,C.A)(function*(){if(!s._useMeasurePerformanceTools)return t();const r=s._getNowStartTimeWithCorrection(),n=yield t();return performance.measure(e,{start:r}),n})()}measure$(e){if(!this._useMeasurePerformanceTools)return s=>s;let t;return s=>(0,l.of)(null).pipe((0,o.tap)(()=>t=this._getNowStartTimeWithCorrection()),(0,l.switchMap)(()=>s),(0,o.tap)(()=>{const r=typeof e=="string"?e:e();performance.measure(r,{start:t})}))}static#e=this.\u0275fac=function(t){return new(t||ge)(c.\u0275\u0275inject(E,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac,providedIn:"root"})}var cs;(function(i){i[i.EntitySchema=3]="EntitySchema",i[i.ClientUnitSchema=4]="ClientUnitSchema"})(cs||(cs={}));class gd{get closed(){return this._closed}constructor(e){this._initialTeardown=e,this._closed=!1}unsubscribe(){this._closed||(this._closed=!0,(0,D.isFunction)(this._initialTeardown)&&this._initialTeardown())}}var fr;(function(i){i.PTP="PTPMsg",i.BROADCAST="BroadcastMsg",i.SERVER="ServerMsg"})(fr||(fr={}));var _d=y(52874);const yd=new c.InjectionToken("MessageChannelAccessTokenFactory");var Xc=y(66736);class gr{constructor(e){this._zone=e,this._message$=new l.Subject}init(e,t){return this._zone.runOutsideAngular(()=>{const s=t?{accessTokenFactory:t,withCredentials:!0}:void 0;return this._connection=new Xc.HubConnectionBuilder().withUrl(e,s).withAutomaticReconnect().withHubProtocol(new Xc.JsonHubProtocol).build(),this._connection.on("ServerMessage",r=>this._zone.run(()=>this._message$.next(r))),(0,l.from)(this._connection.start())})}sendMessage(e){return(0,l.from)(this._connection.send("SendMessage",e))}getMessages(){return this._message$}ngOnDestroy(){this._connection.off("ServerMessage"),this._message$.complete(),this._connection.stop().then()}static#e=this.\u0275fac=function(t){return new(t||gr)(c.\u0275\u0275inject(c.NgZone))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:gr,factory:gr.\u0275fac,providedIn:"root"})}var bd=y(5766);const Sd=1e3,Yc=3e4,Qc=1e4,eu="ping",qi="pong";class _r{constructor(e){this._ngZone=e}_createHeartbeatRequestMessage(){return{Id:(0,L.qv)(),Header:{Sender:"ConsoleCommand",BodyTypeName:"System.String"},Body:eu}}_isHeartbeatRequestMessage(e){const t=e.Header?.Sender==="ConsoleCommand",s=e.Body===eu;return t&&s}_isHeartbeatResponseMessage(e){const t=e.Header?.Sender==="CommandService",s=e.Body===qi;return t&&s}startHeartbeat(e){this.stopHeartbeat(),this._ngZone.runOutsideAngular(()=>{console.log(`WS-Heartbeat: connection ping scheduled for every [${Yc/1e3}] sec`);const t=(0,l.timer)(Sd,Yc).pipe((0,l.tap)(()=>{e.next(this._createHeartbeatRequestMessage())}),(0,l.concatMap)(()=>(0,l.race)(e.pipe((0,l.filter)(s=>this._isHeartbeatResponseMessage(s)),(0,l.take)(1),(0,l.map)(s=>s.Body)),(0,l.of)("timeout").pipe((0,l.delay)(Qc)))));this._subscription=t.subscribe(s=>{switch(s){case qi:console.log(`WS-Heartbeat: Server responded with: ${qi}`);break;case"timeout":console.error(`WS-Heartbeat: Server failed to respond in ${Qc/1e3} seconds`);break}})})}stopHeartbeat(){this._subscription?.unsubscribe()}excludeHeartbeatResponses(){return(0,l.filter)(e=>!this._isHeartbeatRequestMessage(e)&&!this._isHeartbeatResponseMessage(e))}ngOnDestroy(){this.stopHeartbeat()}static#e=this.\u0275fac=function(t){return new(t||_r)(c.\u0275\u0275inject(c.NgZone))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:_r,factory:_r.\u0275fac,providedIn:"root"})}const tu=[1,2e3,5e3,1e4,2e4,...Array(10).fill(3e4)],Cd=tu.length;class yr{constructor(e){this._heartbeatService=e,this._reconnectAttempts=0,this._webSocketCreated$=new l.ReplaySubject(1)}_maxReconnectAttemptsReached(){return this._reconnectAttempts>=Cd}_resetReconnectAttempts(){this._reconnectAttempts=0}_getWebSocketUrl(){var e=this;return(0,C.A)(function*(){const t=yield e._accessTokenFactory?.();return t?`${e._serverUrl}?access_token=${encodeURIComponent(t)}`:e._serverUrl})()}_scheduleReconnectionAttempt(e){if(this._maxReconnectAttemptsReached()){console.error("WebSocket: Max reconnect attempts reached",e);return}const t=tu[this._reconnectAttempts];setTimeout(()=>{this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!0}).catch(console.error),this._reconnectAttempts++},t)}_handleWebSocketClosed(e){this._heartbeatService.stopHeartbeat(),this._scheduleReconnectionAttempt(e)}_createAndConnectWebSocketAsync(e){var t=this;return(0,C.A)(function*(){let s;try{s=yield t._getWebSocketUrl()}catch(r){throw e.reconnectOnAccessTokenFactoryError&&t._scheduleReconnectionAttempt(r),r}return new Promise(r=>{t._webSocket$=(0,bd.webSocket)({url:s,openObserver:{next:()=>{console.log(`Websocket channel opened for url: ${t._serverUrl}`),t._heartbeatService.startHeartbeat(t._webSocket$),t._resetReconnectAttempts(),r()}}}),t._webSocketSubscription?.unsubscribe(),t._webSocketSubscription=t._webSocket$.subscribe({error:n=>t._handleWebSocketClosed(n),complete:()=>t._handleWebSocketClosed()}),t._webSocketCreated$.next(t._webSocket$)})})()}_subscribeToSocketMessages(e,t){return e.pipe(this._heartbeatService.excludeHeartbeatResponses()).subscribe({next:s=>t.next(s),error:()=>{this._maxReconnectAttemptsReached()&&t.error(new Error("Max reconnect attempts reached"))}})}init(e,t){return this._serverUrl=e,this._accessTokenFactory=t,(0,l.from)(this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!1}))}sendMessage(e){return new l.Observable(t=>{this._webSocket$.next(e),t.next(),t.complete()})}getMessages(){return new l.Observable(e=>{let t;const s=this._webSocketCreated$.subscribe(r=>{t?.unsubscribe(),t=this._subscribeToSocketMessages(r,e)});return()=>{t.unsubscribe(),s.unsubscribe()}})}ngOnDestroy(){this._heartbeatService.stopHeartbeat(),this._webSocket$?.complete(),this._webSocketSubscription?.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||yr)(c.\u0275\u0275inject(_r))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:yr,factory:yr.\u0275fac,providedIn:"root"})}class Te{static create(e){const t=new Te;return Object.assign(t,e),t}get isDebugEnabled(){return!!window.Terrasoft?.isDebug}static#e=this.\u0275fac=function(t){return new(t||Te)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Te,factory:Te.\u0275fac,providedIn:"root"})}var su=y(93248),Hi;(function(i){i.Production="production",i.PreProduction="pre-production",i.Development="development"})(Hi||(Hi={}));var Vn=y(49820);const ru=Te.create({serviceUrl:"",clientConnectionClassName:""}),dm={provide:Te,useFactory:()=>ru};let br=class wi{constructor(e,t){this._httpClient=e,this._cacheManager=t,this._serviceEndpoint="ServiceModel/ApplicationInfoService.svc/"}_initApplicationInfo(){const e=this._serviceEndpoint+"GetApplicationInfo";this._applicationInfoObservable$=this._cacheManager.executeWithCache(su.HO,su.oy,this._httpClient.post(e,null)).pipe((0,o.map)(t=>{const s=t?.applicationInfo,r=Te.create(s);return Object.assign(ru,r),t}),(0,o.shareReplay)({bufferSize:1,refCount:!1})),this._applicationInfoObservable$.subscribe()}loadApplicationInfo(){return this._applicationInfoObservable$||this._initApplicationInfo(),this._applicationInfoObservable$}loadSysValues(){return this.loadApplicationInfo().pipe((0,o.map)(e=>e?.applicationInfo?.sysValues))}getCoreVersion(){return this._coreVersion?(0,l.of)(this._coreVersion):this.loadSysValues().pipe((0,l.tap)(e=>this._coreVersion=e?.coreVersion),(0,o.map)(()=>this._coreVersion))}getIsProductionEnvironment(){return(this._environmentType?(0,l.of)(this._environmentType):this.loadSysValues().pipe((0,l.tap)(t=>this._environmentType=t?.environmentType),(0,o.map)(()=>this._environmentType))).pipe((0,o.map)(t=>t===Hi.Production))}static#e=this.\u0275fac=function(t){return new(t||wi)(c.\u0275\u0275inject(V.HttpClient),c.\u0275\u0275inject(Vn.G))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:wi,factory:wi.\u0275fac,providedIn:"root"})};br=(0,f.__decorate)([(0,P.op)({requestType:"crt.SysValuesService"}),(0,f.__metadata)("design:paramtypes",[V.HttpClient,Vn.G])],br);const hm={provide:c.APP_INITIALIZER,useFactory:i=>()=>i.loadApplicationInfo(),deps:[br],multi:!0};let xn=class Pi{constructor(e,t,s,r){this.injector=r,this._destroyed$=new l.Subject,this.init$=new l.ReplaySubject(1),this.messageEvent$=new l.Subject,!e.clientConnectionClassName||e.clientConnectionClassName===""?t.loadApplicationInfo().subscribe(n=>{this._initialize(n.applicationInfo,s)}):this._initialize(e,s)}_initialize(e,t){this.msgChannel=this._getChannel(e.clientConnectionClassName),this._initChannel(e.serviceUrl,t)}_getChannel(e){switch(e){case"Terrasoft.WebSocketChannel":return this.injector.get(yr);case"Terrasoft.SignalRChannel":return this.injector.get(gr)}}_buildMessageEvent(e){let t;if(e.Body&&typeof e.Body=="string")try{t=JSON.parse(e.Body)}catch(s){return(0,c.isDevMode)()&&console.warn(`MessageChannelService. Parse error: ${s}`),null}else e.Body&&typeof e.Body=="object"&&(t=e.Body);return{header:{sender:e?.Header?.Sender,bodyTypeName:e?.Header?.BodyTypeName},body:t,id:e.Id}}_subscribeToMsgChannel(){this.msgChannel.getMessages().pipe((0,o.takeUntil)(this._destroyed$)).subscribe(e=>{const t=this._buildMessageEvent(e);t&&this.messageEvent$.next(t)})}_initChannel(e,t){this.msgChannel.init(e,t).subscribe({complete:()=>{this.init$.next(this.msgChannel),this._subscribeToMsgChannel()}})}_sendMessageInternal(e,t,s){const r={Id:_d.Guid.create().toString(),Header:{Sender:e,BodyTypeName:"System.String",ChannelType:t},Body:JSON.stringify(s)};return this.init$.pipe((0,l.take)(1),(0,o.switchMap)(()=>this.msgChannel.sendMessage(r)))}getMessages(e){return q.checkArgumentEmpty("sender",e),this.messageEvent$.pipe((0,o.filter)(t=>t.header.sender===e))}subscribe(e,t){q.checkArgumentEmpty("sender",e),q.checkArgumentEmpty("callback",t);const s=this.getMessages(e).subscribe(t);return Promise.resolve(new gd(()=>s.unsubscribe()))}sendMessage(e,t,s){let r,n;const a=!!s;a?(r=e,n=t,q.checkStringIsNotEmpty("sender",r),q.checkEnumOutOfRange("channelType",s,fr)):(n=e,r=t,q.checkArgumentEmpty("channelType",r),q.checkEnumOutOfRange("channelType",r,fr));const u=this._sendMessageInternal(r,s,n);return a?(0,l.firstValueFrom)(u):u}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.init$.complete(),this.messageEvent$.complete()}static#e=this.\u0275fac=function(t){return new(t||Pi)(c.\u0275\u0275inject(Te),c.\u0275\u0275inject(br),c.\u0275\u0275inject(yd,8),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Pi,factory:Pi.\u0275fac,providedIn:"root"})};xn=(0,f.__decorate)([(0,P.op)({requestType:"crt.MessageChannelService"}),(0,f.__metadata)("design:paramtypes",[Te,br,Function,c.Injector])],xn);const Ad=new c.InjectionToken("Represents a list of schema change message predicates"),vd=new c.InjectionToken("Represents a list of schema remove message predicates"),Ed=new c.InjectionToken("Represents a list of schema rights message predicates");class Ot{constructor(e,t,s,r,n){this._messageChannelService=e,this._broadcastChannelFactory=t,this._changePredicates=s,this._removePredicates=r,this._rightsPredicates=n,this._destroyed$=new l.Subject,this.schemaChanged$=new l.Subject,this.schemaRemoved$=new l.Subject,this.rightsChanged$=new l.Subject,this.requireJsChanged$=new l.Subject,this._subscribeMessageChannelEvent()}_getSchemaType(e){let t;switch(e){case"ClientUnitSchemaManager":t=cs.ClientUnitSchema;break;case"EntitySchemaManager":t=cs.EntitySchema;break}return t}_processMessage(e,t){const s=e.body,r=this._getSchemaType(s.ManagerName);r&&t.next({name:s.Name,uId:s.UId,schemaType:r,userId:s.UserId,isNew:s.IsNew,extendParent:s.ExtendParent})}_subscribeMessageChannelEvent(){this._messageChannelService.messageEvent$.pipe((0,o.filter)(e=>this._changePredicates?.some(t=>t(e))),(0,o.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaChanged$)),this._messageChannelService.messageEvent$.pipe((0,o.filter)(e=>this._removePredicates?.some(t=>t(e))),(0,o.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaRemoved$)),this._messageChannelService.messageEvent$.pipe((0,o.filter)(e=>this._rightsPredicates?.some(t=>t(e))),(0,o.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.rightsChanged$)),this._broadcastChannelFactory.createInstance("schema-requirejs-path-changed").messages$.subscribe(e=>this._processMessage({body:e},this.requireJsChanged$))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.schemaChanged$.complete()}static#e=this.\u0275fac=function(t){return new(t||Ot)(c.\u0275\u0275inject(xn),c.\u0275\u0275inject(P.Vx),c.\u0275\u0275inject(Ad,8),c.\u0275\u0275inject(vd,8),c.\u0275\u0275inject(Ed,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ot,factory:Ot.\u0275fac,providedIn:"root"})}class Sr{constructor(e){this.schemaChangeListener=e,this._repository=new Map,this._uIdMap=new Map,this._destroyed$=new l.Subject,this.schemaChangeListener.schemaChanged$.pipe((0,o.filter)(t=>t.schemaType===this.provider.schemaType),(0,o.takeUntil)(this._destroyed$)).subscribe(t=>this.clearSchemaCacheByUId(t.uId))}add(e){this._repository.set(e.name,e),this._uIdMap.set(e.uId,e.name)}getCachedSchema(e){return this._repository.get(e)}getIsSchemaCached(e){return this._repository.has(e)}getCachedSchemesNames(){return[...this._repository.keys()]}getSchemaByName(e){const t=this.getCachedSchema(e);return t?(0,l.of)(t):this.provider.getSchemaByName(e).pipe((0,o.tap)(s=>this.add(s)))}getSchemaByUId(e){const t=this._uIdMap.get(e),s=t&&this.getCachedSchema(t);return s?(0,l.of)(s):this.provider.getSchemaByUId(e).pipe((0,o.tap)(r=>this.add(r)))}clearSchemaCacheByName(e){const t=this.getCachedSchema(e);t&&this._uIdMap.delete(t.uId),this._repository.delete(e)}clearSchemaCacheByUId(e){const t=this._uIdMap.get(e);t&&this._repository.delete(t),this._uIdMap.delete(e)}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static#e=this.\u0275fac=function(t){return new(t||Sr)(c.\u0275\u0275inject(Ot))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Sr,factory:Sr.\u0275fac})}class On{static getPathItemInfo(e){const s=/\[([\w-]+):([\w-]+):?([\w-]*)]$/g.exec(e);if(s){const r=s[1],n=s[2],a=s[3];return{isBackReference:!0,referenceSchemaName:r,referenceSchemaColumnName:n,columnName:a}}return{isBackReference:!1,columnName:e}}static getLastBackwardSchemaNameByColumnPath(e){let t="";return e?.split(".").reverse()?.forEach(r=>{t||r.includes("[")&&(t=this.getPathItemInfo(r).referenceSchemaName)}),t}static getLastForwardColumnPath(e){const t=e?.split(".")||[],s=t.map(r=>r.includes("[")).lastIndexOf(!0);return s===-1?e:t.slice(s+1).join(".")}}var Ln;(function(i){i.List="List",i.SelectionWindow="SelectionWindow"})(Ln||(Ln={}));class Ki{get isLookupType(){return this.dataValueType?this.dataValueType===v.r.Lookup:!1}constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.columnCaptionPath=e.columnCaptionPath,this.dataValueType=e.dataValueType,this.usageType=e.usageType,this.referenceSchemaUId=e.referenceSchemaUId,this.referenceSchemaName=e.referenceSchemaName,this.isRequired=e.isRequired,this.isValueCloneable=e.isValueCloneable,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.defaultValueSchema=e.defaultValueSchema,this.lookupMode=e.lookupMode)}}class Md{constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.extendParent=e.extendParent,this.packageUId=e.packageUId)}}class nu extends Md{getPrimaryColumn(){return this.primaryColumnUId&&this.columns?.find(e=>e.uId===this.primaryColumnUId)}getPrimaryDisplayColumn(){return this.primaryDisplayColumnUId&&this.columns?.find(e=>e.uId===this.primaryDisplayColumnUId)}getPrimaryColorColumn(){return this.primaryColorColumnUId&&this.columns?.find(e=>e.uId===this.primaryColorColumnUId)}getHierarchyColumn(){return this.hierarchyColumnUId&&this.columns?.find(e=>e.uId===this.hierarchyColumnUId)}getCreatedOnColumn(){return this.createdOnColumnUId&&this.columns?.find(e=>e.uId===this.createdOnColumnUId)}getCreatedByColumn(){return this.createdByColumnUId&&this.columns?.find(e=>e.uId===this.createdByColumnUId)}getModifiedOnColumn(){return this.modifiedOnColumnUId&&this.columns?.find(e=>e.uId===this.modifiedOnColumnUId)}getModifiedByColumn(){return this.modifiedByColumnUId&&this.columns?.find(e=>e.uId===this.modifiedByColumnUId)}}var Id=y(61843),Ue=y(23092),qe;(function(i){i[i.None=0]="None",i[i.Const=1]="Const",i[i.Settings=2]="Settings",i[i.SystemValue=3]="SystemValue",i[i.Sequence=4]="Sequence"})(qe||(qe={}));var Bn=y(47149);class Rd{static _getDefaultValue(e){if(!e)return null;if(e.source===qe.Sequence)return{valueSourceType:qe.Sequence,value:"Sequence",sequencePrefix:e.sequencePrefix,sequenceNumberOfChars:e.sequenceNumberOfChars};if(e.source===qe.Const){const t=e.value,s=typeof t=="string"?t:t.value;return{valueSourceType:qe.Const,value:s,valueSource:s,sequenceNumberOfChars:0}}return e.source===qe.Settings?{valueSourceType:qe.Settings,value:e.calculatedValue,valueSource:e.value,sequenceNumberOfChars:0}:e.source===qe.SystemValue?{valueSourceType:qe.SystemValue,value:e.calculatedValue,valueSource:e.sourceValue,sequenceNumberOfChars:0}:{valueSourceType:e.source,value:null,sequenceNumberOfChars:0}}static _getPrimaryDisplayColorColumnUId(e){if(!e.primaryColorColumnName)return null;const t=Object.values(e.columns).find(s=>s.name===e.primaryColorColumnName);if(!t)throw new Error(`Primary color column set in object ${e.name} but column ${e.primaryColorColumnName} does not exist`);return t?.uId}static map(e,t){const s={};return Object.entries(e.columns).forEach(([,r])=>{const n=r,a=n.dataValueTypeName==="Binary"?"Blob":n.dataValueTypeName,u=Object.entries(Bn.Q).find(([,g])=>g.name===a),d=u?Number(u[0]):n.dataValueType,h=this._getDefaultValue(n.defaultValue);s[n.uId]={uId:n.uId,name:n.name,caption:{[t]:n.caption},dataValueType:d,isInherited:!!n.isInherited,isRequired:!!n.isRequired,isValueCloneable:!!n.isValueCloneable,usageType:n.usageType,referenceSchemaName:n.referenceSchemaName,isMasked:!!n.isMasked,isFormatValidated:!!n.isFormatValidated,isSimpleLookup:!!n.isSimpleLookup,isSensitiveData:!!n.isSensitiveData,isValueMasked:!!n.isValueMasked,valueMaskingSettings:n.valueMaskingSettings,defValue:h}}),{administratedByOperations:e.administratedByOperations,administratedByRecords:e.administratedByRecords,useMasterRecordRights:e.useMasterRecordRights,masterRecordSchemaName:e.masterRecordSchemaName,primaryColumnUId:e.primaryColumn?.uId,primaryDisplayColumnUId:e.primaryDisplayColumn?.uId,primaryColorColumnUId:this._getPrimaryDisplayColorColumnUId(e),hierarchyColumnUId:e.hierarchyColumnUId,createdOnColumnUId:e.createdOnColumnUId,createdByColumnUId:e.createdByColumnUId,modifiedOnColumnUId:e.modifiedOnColumnUId,modifiedByColumnUId:e.modifiedByColumnUId,uId:e.uId,name:e.name,caption:{[t]:e.caption},columns:{Items:s},isVirtual:!!e.isVirtual,isDBView:!!e.isDBView,administratedByColumns:!!e.administratedByColumns,description:{[t]:e.description},parentUId:e.parentUId,isTrackChangesInDB:!!e.isTrackChangesInDB,extendParent:!!e.extendParent}}}const wd="runtime-entity-schema";var iu=y(41483);let zi=class{constructor(e){this._window=e}_getItems(e,t=[]){var s=this;let r=[];const n=[...t];return new Promise(a=>{this._window.require(e,(0,C.A)(function*(...u){r=yield Promise.all(u.map(d=>s.map(d))),a({schemes:r,notFoundSchemes:n})}),u=>{const d=u.requireModules??[];n.push(...d),e=e.filter(h=>!d.includes(h)),e.length===0&&a({schemes:r,notFoundSchemes:n}),a(this._getItems(e,n))})})}map(e){return Promise.resolve(e)}get(e){var t=this;return new Promise(s=>{this._window.require([e],function(){var r=(0,C.A)(function*(n){const a=yield t.map(n);s(a)});return function(n){return r.apply(this,arguments)}}(),()=>{s(null)})})}getItems(e){return this._getItems(e,[])}};zi=(0,f.__decorate)([(0,f.__param)(0,(0,c.Inject)(P.ZP)),(0,f.__metadata)("design:paramtypes",[Object])],zi);class Lt{constructor(e,t){this._userInfo=e,this._httpClient=t}_getServiceUrlSspPart(){return this._userInfo.isSSP?"ssp/":""}_getDataServiceUrlWithSspPart(){return`DataService/${this._getServiceUrlSspPart()}`}getSchemaDesignerServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/SchemaDesignerRequest"}getRuntimeEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemaRequest"}getEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/EntitySchemaRequest"}getRuntimeEntitySchemeServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemesRequest"}getEntity(e){return(0,l.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemaServiceEndpoint(),{name:e}))}getEntities(e){return(0,l.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemeServiceEndpoint(),e))}static#e=this.\u0275fac=function(t){return new(t||Lt)(c.\u0275\u0275inject(Ue.oq),c.\u0275\u0275inject(V.HttpClient))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Lt,factory:Lt.\u0275fac,providedIn:"root"})}const Gi=["SysSettings"];class Cr extends zi{constructor(e,t,s,r,n,a){super(e),this._featureValues=t,this._userInfo=s,this._entityHttpService=r,this._cacheManager=n,this._schemaChangeListener=a,this._destroyed$=new l.Subject,this._schemaChangeListener.schemaChanged$.pipe((0,o.filter)(u=>u.schemaType===cs.EntitySchema),(0,o.switchMap)(u=>(0,l.from)(this._clearSchemaCacheByName(u.name))),(0,o.takeUntil)(this._destroyed$)).subscribe()}get _entitySchemaCache(){return this._cacheManager.getOrCreate({name:wd,type:iu.P.Memory})}_clearSchemaCacheByName(e){var t=this;return(0,C.A)(function*(){t._featureValues.DisableRuntimeEntitySchemaCaching||(yield(yield t._entitySchemaCache).delete(e))})()}_getLookupEntities(e){const t=e.flatMap(r=>Object.values(r.columns.Items).filter(n=>n.dataValueType===v.r.Lookup&&n.referenceSchemaName&&!e.find(a=>a.name===n.referenceSchemaName)).map(n=>n.referenceSchemaName)),s=[...new Set(t)];return this.getItems(s)}_getReferenceEntityNameFromBackReferencePath(e){return On.getPathItemInfo(e).referenceSchemaName}_getReferenceSchemaName(e,t){const s=this._getReferenceEntityNameFromBackReferencePath(e);let r;if(s)r=s;else{const n=Object.entries(t.columns.Items).find(([,u])=>u.name===e);if(!n)throw new Error(`Can't find column '${e}' in EntitySchema '${t.name}'`);const[,a]=n;r=a.referenceSchemaName}return r}_loadSchemasByPath(e,t,s){var r=this;return(0,C.A)(function*(){const n=s.find(b=>b.name===e);if(!n)return{schemas:[],notFoundSchemas:[e]};const a=[...t],u=a.shift(),d=r._getReferenceSchemaName(u,n);if(!d)return{schemas:[],notFoundSchemas:[]};let h=s.find(b=>b.name===d);if(!h)try{if(h=yield r.get(d),h)s.push(h);else return{schemas:[],notFoundSchemas:[d]}}catch{return{schemas:[],notFoundSchemas:[d]}}const g=a.length?yield r._loadSchemasByPath(h.name,a,s):{schemas:[],notFoundSchemas:[]};return{schemas:[h,...g.schemas],notFoundSchemas:g.notFoundSchemas}})()}_getForwardReferenceSchemas(e,t){var s=this;return(0,C.A)(function*(){const r=yield Promise.all(e.filter(n=>n.forwardReferencePaths).flatMap(n=>n.forwardReferencePaths.flatMap(a=>s._loadSchemasByPath(n.name,a.split("."),t))));return{schemes:r.flatMap(n=>n.schemas),notFoundSchemes:r.flatMap(n=>n.notFoundSchemas)}})()}_getEntitiesToLoadLookups(e,t){return t.schemes.filter(s=>e.requests.find(r=>r.loadLookupColumns===!0&&r.name===s.name))}map(e){return Promise.resolve(Rd.map(e,this._userInfo.cultureInfo.sysCultureName))}get(e){var t=()=>super.get,s=this;return(0,C.A)(function*(){let r;if(!s._featureValues.DisableRuntimeEntitySchemaCaching){const a=yield(yield s._entitySchemaCache).get(e);if(a)return a}return Gi.includes(e)?r=(yield s._entityHttpService.getEntity(e)).schema:r=yield t().call(s,e),s._featureValues.DisableRuntimeEntitySchemaCaching||(yield(yield s._entitySchemaCache).set(e,r)),r})()}getItems(e){var t=()=>super.getItems,s=this;return(0,C.A)(function*(){const r=[...new Set(e)];let n=r,a=[];if(!s._featureValues.DisableRuntimeEntitySchemaCaching){const M=yield s._entitySchemaCache;a=(yield Promise.all(r.map(j=>M.get(j)))).filter(j=>!!j);const Y=a.map(j=>j.name);if(n=r.filter(j=>!Y.includes(j)),n.length===0)return{schemes:[...a],notFoundSchemes:[]}}const u=n.filter(M=>Gi.includes(M)),d=n.filter(M=>!Gi.includes(M));let h={success:!0,schemes:[],notFoundSchemes:[]};if(u.length!==0){const M={requests:u.map(Z=>({name:Z,loadLookupColumns:!1}))};h=yield s._entityHttpService.getEntities(M)}const g=yield t().call(s,d),b=[...g.schemes,...h.schemes];return s._featureValues.DisableRuntimeEntitySchemaCaching||(yield(yield s._entitySchemaCache).bulkSet((0,D.uniqBy)(b,"name").map(Z=>({key:Z.name,value:Z})))),{schemes:[...b,...a],notFoundSchemes:[...g.notFoundSchemes,...h.notFoundSchemes]}})()}getEntity(e){var t=this;return(0,C.A)(function*(){const s=yield t.get(e);return{success:!!s,schema:s}})()}getEntities(e){var t=this;return(0,C.A)(function*(){const s=e.requests.map(d=>d.name),r=yield t.getItems(s),n=t._getEntitiesToLoadLookups(e,r),a=yield t._getLookupEntities(n),u=yield t._getForwardReferenceSchemas(e.requests,[...r.schemes,...a.schemes]);return{success:!0,schemes:[...r.schemes,...a.schemes,...u.schemes],notFoundSchemes:[...r.notFoundSchemes,...a.notFoundSchemes,...u.notFoundSchemes]}})()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static#e=this.\u0275fac=function(t){return new(t||Cr)(c.\u0275\u0275inject(P.ZP),c.\u0275\u0275inject(E),c.\u0275\u0275inject(Ue.oq),c.\u0275\u0275inject(Lt),c.\u0275\u0275inject(Vn.G),c.\u0275\u0275inject(Ot))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Cr,factory:Cr.\u0275fac,providedIn:"root"})}class Ar{constructor(e,t,s,r){this.httpClient=e,this._entityRequire=t,this._entityHttp=s,this._featureValues=r}_useRequire(){return this._featureValues?.UseRequireEntitySchema8x??!1}getEntity(e){var t=this;return(0,C.A)(function*(){return t._useRequire()?t._entityRequire.getEntity(e):t._entityHttp.getEntity(e)})()}getEntities(e){var t=this;return(0,C.A)(function*(){return t._useRequire()?t._entityRequire.getEntities(e):t._entityHttp.getEntities(e)})()}static#e=this.\u0275fac=function(t){return new(t||Ar)(c.\u0275\u0275inject(V.HttpClient),c.\u0275\u0275inject(Cr),c.\u0275\u0275inject(Lt),c.\u0275\u0275inject(E,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ar,factory:Ar.\u0275fac,providedIn:"root"})}class ft{constructor(e,t,s,r){this.httpClient=e,this._userInfo=t,this._schemaLoader=s,this._entityHttp=r,this._entitySchemaServiceRequests=new Map,this._destroyed$=new l.Subject}_convertToEntitySchema(e){const t=new nu;return t.uId=e.uId,t.name=e.name,t.caption=this._getCaptionElement(e),t.extendParent=e.extendParent,t.packageUId=e.packageUId,t.administratedByColumns=e.administratedByColumns,t.administratedByOperations=e.administratedByOperations,t.administratedByRecords=e.administratedByRecords,t.description=e.description,t.isDBView=e.isDBView,t.isTrackChangesInDB=e.isTrackChangesInDB,t.isVirtual=e.isVirtual,t.masterRecordSchemaName=e.masterRecordSchemaName,t.primaryColumnUId=e.primaryColumnUId,t.primaryDisplayColumnUId=e.primaryDisplayColumnUId,t.primaryColorColumnUId=e.primaryColorColumnUId,t.hierarchyColumnUId=e.hierarchyColumnUId,t.createdOnColumnUId=e.createdOnColumnUId,t.createdByColumnUId=e.createdByColumnUId,t.modifiedOnColumnUId=e.modifiedOnColumnUId,t.modifiedByColumnUId=e.modifiedByColumnUId,t.useMasterRecordRights=e.useMasterRecordRights,t.parentUId=e.parentUId,t.columns=Object.values(e.columns.Items).map(s=>{const r=new Ki;return r.uId=s.uId,r.name=s.name,r.caption=this._getCaptionElement(s),r.dataValueType=s.dataValueType,r.usageType=s.usageType,r.referenceSchemaUId=s.referenceSchemaUId,r.referenceSchemaName=s.referenceSchemaName,r.isRequired=s.isRequired,r.isValueCloneable=s.isValueCloneable,r.isMasked=s.isMasked,r.isFormatValidated=s.isFormatValidated,r.isSensitiveData=s.isSensitiveData,r.isValueMasked=s.isValueMasked,r.valueMaskingSettings=s.valueMaskingSettings,r.defaultValueSchema=s.defValue,r.lookupMode=s.isSimpleLookup?Ln.List:Ln.SelectionWindow,r}),t}_getCaptionElement(e){return e.caption[this._userInfo.cultureInfo.sysCultureName]||e.caption[Id.dJ]}_createEntitySchemaColumnFromInformationObject(e){const t=new Ki;return t.uId=e.columnUId,t.name=e.columnName,t.caption=e.columnCaption,t.dataValueType=e.columnDataValueType,t.usageType=e.columnUsageType,t.referenceSchemaUId=e.referenceSchemaUId,t.referenceSchemaName=e.referenceSchemaName,t.columnCaptionPath=e.columnCaptionPath,t}_getEntitySchemaFromEndpoint(e,t){return this.httpClient.post(e,t).pipe((0,o.mergeMap)(s=>s.schema?(0,l.of)({success:!0,entitySchema:this._convertToEntitySchema(s.schema)}):(0,l.throwError)({success:!1,entitySchema:null,errorInfo:s.errorInfo})))}_getEntitySchemaColumnByPath(e,t,s="."){const r=`${e}_${s}_${t}`;if(this._entitySchemaServiceRequests.has(r))return this._entitySchemaServiceRequests.get(r);const n=this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),{getSchemaColumnInformation:{entitySchemaUId:e,schemaColumnPath:t,schemaColumnCaptionPathDelimiter:s}}).pipe((0,o.tap)(({success:a})=>{if(!a)throw new Error("SchemaDesignerService request has failed")}),(0,o.map)(({getSchemaColumnInformationResponse:a})=>this._createEntitySchemaColumnFromInformationObject(a)),(0,o.tap)(()=>this._entitySchemaServiceRequests.delete(r)),(0,o.share)());return this._entitySchemaServiceRequests.set(r,n),n}_combineEntitySchemaColumnInformationRequestsWithPaths(e,t){return t.reduce((s,r)=>({...s,[r]:this._getEntitySchemaColumnByPath(e,r)}),{})}getEntitySchemaByUId(e,t){const s=`${e}_${t}`;if(this._entitySchemaServiceRequests.has(s))return this._entitySchemaServiceRequests.get(s);const r=t?this._entityHttp.getEntitySchemaServiceEndpoint():this._entityHttp.getRuntimeEntitySchemaServiceEndpoint(),n={uId:e};t&&(n.packageUId=t);const a=this._getEntitySchemaFromEndpoint(r,n).pipe((0,o.tap)(()=>this._entitySchemaServiceRequests.delete(s)),(0,o.share)());return this._entitySchemaServiceRequests.set(s,a),a}getEntitySchemaByName(e){if(this._entitySchemaServiceRequests.has(e))return this._entitySchemaServiceRequests.get(e);const t=(0,l.from)(this._schemaLoader.getEntity(e)).pipe((0,o.map)(s=>({success:s.success,entitySchema:s.schema?this._convertToEntitySchema(s.schema):null,errorInfo:s.errorInfo})),(0,o.tap)(()=>this._entitySchemaServiceRequests.delete(e)),(0,o.share)(),(0,o.catchError)(s=>(this._entitySchemaServiceRequests.delete(e),(0,l.throwError)(()=>s))));return this._entitySchemaServiceRequests.set(e,t),t}getEntitySchemes(e){const t=JSON.stringify(e);if(this._entitySchemaServiceRequests.has(t))return this._entitySchemaServiceRequests.get(t);const s=(0,l.from)(this._schemaLoader.getEntities(e)).pipe((0,o.map)(r=>({success:r.success,schemes:r.schemes.map(n=>this._convertToEntitySchema(n)),notFoundSchemes:r.notFoundSchemes})),(0,o.tap)(()=>this._entitySchemaServiceRequests.delete(t)),(0,o.share)(),(0,o.catchError)(r=>(0,l.throwError)(()=>r)));return this._entitySchemaServiceRequests.set(t,s),s}getEntitySchemaColumnsInformationByMetaPath(e,t){const s={getSchemaColumnsInformation:{entitySchemaUId:e,schemaColumnMetaPaths:t}};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),s).pipe((0,o.tap)(({success:r})=>{if(!r)throw new Error("SchemaDesignerService request is failed")}),(0,o.map)(({getSchemaColumnsInformationResponse:r})=>r.map(n=>({column:this._createEntitySchemaColumnFromInformationObject(n),columnMetaPath:n.columnMetaPath,columnPath:n.columnPath,columnCaptionPath:n.columnCaptionPath}))))}getEntitySchemaColumnsInformationByPath(e,t,s){return this._getEntitySchemaColumnByPath(e,t,s)}getEntitySchemaColumnsInformationByPathsArray(e,t){return(0,l.forkJoin)(this._combineEntitySchemaColumnInformationRequestsWithPaths(e,t))}getColumnCaptionPathByMetaPath(e){const t={getColumnCaptionPathByMetaPath:e};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),t).pipe((0,o.tap)(({success:s})=>{if(!s)throw new Error("SchemaDesignerService request is failed")}),(0,o.map)(({columnCaptionPath:s})=>s))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static#e=this.\u0275fac=function(t){return new(t||ft)(c.\u0275\u0275inject(V.HttpClient),c.\u0275\u0275inject(Ue.oq),c.\u0275\u0275inject(Ar),c.\u0275\u0275inject(Lt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ft,factory:ft.\u0275fac,providedIn:"root"})}class vr{constructor(e){this._entitySchemaService=e,this.schemaType=cs.EntitySchema}_getSchema(e){return e.pipe((0,o.switchMap)(t=>t.success===!0?(0,l.of)(t):(0,l.throwError)(()=>new Error(t.errorInfo.message))),(0,o.map)(t=>t.entitySchema))}_getScheme(e){return e.pipe((0,o.switchMap)(t=>t.success===!0?(0,l.of)(t):(0,l.throwError)(()=>new Error(t.errorInfo.message))),(0,o.map)(t=>t.schemes))}getSchemaByUId(e){const t=this._entitySchemaService.getEntitySchemaByUId(e);return this._getSchema(t)}getSchemaByName(e){const t=this._entitySchemaService.getEntitySchemaByName(e);return this._getSchema(t)}getSchemes(e){const t=this._entitySchemaService.getEntitySchemes(e);return this._getScheme(t)}static#e=this.\u0275fac=function(t){return new(t||vr)(c.\u0275\u0275inject(ft))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:vr,factory:vr.\u0275fac,providedIn:"root"})}class Ye extends Sr{constructor(e,t){super(t),this.provider=e,this.schemaChangeListener=t}_checkPath(e){if(!e||e.length===0)throw new Error("Path is null or empty")}_checkLookupColumn(e,t){if(!e.isLookupType)throw new Error(`Column '${e.name}' for schema '${t.name}' is not lookup`)}_getEntitySchemaColumn(e,t){const s=e.columns.find(r=>r.name===t);if(!s)throw new Error(`Can not find column '${t}' in schema '${e.name}'`);return s}_findEntitySchemesByPath(e,t){this._checkPath(t);const s=[...t],r=this.getCachedSchema(e);if(!r)return null;const n=s.shift(),a=On.getPathItemInfo(n);let u=[];if(a.isBackReference)u=this._findEntitySchemesByPath(a.referenceSchemaName,s);else{const h=this._getEntitySchemaColumn(r,a.columnName);if(s.length===0)return[r];this._checkLookupColumn(h,r),u=this._findEntitySchemesByPath(h.referenceSchemaName,s)}if(!u)return null;const d=u.filter(h=>h.name!==r.name);return[r,...d]}_getAreSchemesCached(e){for(const t of e){const s=this.getCachedSchema(t.name);if(!s)return!1;const r=s.columns.filter(a=>a.isLookupType).every(a=>this.getIsSchemaCached(a.referenceSchemaName));if(t.loadLookupColumns&&!r)return!1;const n=t.forwardReferencePaths??[];for(const a of n){const u=a.split(".");if(!this.findEntitySchemaColumnByPath(t.name,u))return!1}}return!0}_addSchemaIfNotExists(e,t){e.has(t.name)||e.set(t.name,t)}_addSchemesIfNotExists(e,t){t.forEach(s=>{this._addSchemaIfNotExists(e,s)})}_getCachedSchemes(e){const t=new Map;return e.forEach(s=>{const r=this.getCachedSchema(s.name);if(!r)return;if(this._addSchemaIfNotExists(t,r),s.loadLookupColumns){const a=r.columns.filter(u=>u.isLookupType).map(u=>this.getCachedSchema(u.referenceSchemaName)).filter(u=>u!=null);this._addSchemesIfNotExists(t,a)}(s.forwardReferencePaths??[]).forEach(a=>{const u=a.split("."),d=this._findEntitySchemesByPath(s.name,u);d&&this._addSchemesIfNotExists(t,d)})}),[...t.values()]}getSchemes(e){if(this._getAreSchemesCached(e))return(0,l.of)(this._getCachedSchemes(e));const t={requests:e,cachedSchemesNames:this.getCachedSchemesNames()};return this.provider.getSchemes(t).pipe((0,o.tap)(s=>s.forEach(r=>this.add(r))),(0,o.map)(()=>this._getCachedSchemes(e)))}findEntitySchemaByPath(e,t){this._checkPath(t);const s=this.getCachedSchema(e);if(!s)return null;const r=[...t],n=r.shift(),a=On.getPathItemInfo(n);if(a.isBackReference)return this.findEntitySchemaByPath(a.referenceSchemaName,r);const u=this._getEntitySchemaColumn(s,a.columnName);return r.length===0?s:(this._checkLookupColumn(u,s),this.findEntitySchemaByPath(u.referenceSchemaName,r))}findEntitySchemaColumnByPath(e,t){const s=this.findEntitySchemaByPath(e,t);if(!s)return null;const r=[...t].pop(),n=On.getPathItemInfo(r);return this._getEntitySchemaColumn(s,n.columnName)}static#e=this.\u0275fac=function(t){return new(t||Ye)(c.\u0275\u0275inject(vr),c.\u0275\u0275inject(Ot))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ye,factory:Ye.\u0275fac,providedIn:"root"})}class Wi{}class gt{get attributes(){return this._parent?[...this._parent.attributes,...this._attributes]:[...this._attributes]}get parent(){return this._parent}constructor(e){if(e!=null){this.name=e.name,this.type=e.type,e.caption&&(this.caption=typeof e.caption=="string"?e.caption:{...e.caption}),this.primaryAttributeName=e.primaryAttributeName,this.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this.primaryColorAttributeName=e.primaryColorAttributeName,this.hierarchyAttributeName=e.hierarchyAttributeName,this.createdByAttributeName=e.createdByAttributeName,this.createdOnAttributeName=e.createdOnAttributeName,this.modifiedByAttributeName=e.modifiedByAttributeName,this.modifiedOnAttributeName=e.modifiedOnAttributeName,e.dataSourceConfig&&(this.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig.config}}),this._parent=e.parent;const t=e.attributes??[];this._attributes=[],t.forEach(s=>{if(this._parent){this._parent.findAttributeByName(s.name)||this._attributes.push(s.clone());return}this._attributes.push(s.clone())})}else this._attributes=[]}clearAttributes(){this._attributes=[]}addAttribute(e){if(this._parent){this._parent.findAttributeByName(e.name)||this._attributes.push(e);return}this._attributes.push(e)}findAttributeByName(e){return this.attributes.find(t=>t.name===e)??null}getPrimaryAttributesNames(){return[this.primaryAttributeName]}getPrimaryLoadAttributes(){const e=[];return this.primaryAttributeName&&e.push(this.primaryAttributeName),this.primaryDisplayAttributeName&&e.push(this.primaryDisplayAttributeName),e}clone(){return new gt(this)}createChild(){const e=new gt;return e.name=this.name,e.type=this.type,this.caption&&(e.caption=typeof this.caption=="string"?this.caption:{...this.caption}),e.primaryAttributeName=this.primaryAttributeName,e.primaryDisplayAttributeName=this.primaryDisplayAttributeName,e.primaryColorAttributeName=this.primaryColorAttributeName,e.hierarchyAttributeName=this.hierarchyAttributeName,e.createdByAttributeName=this.createdByAttributeName,e.createdOnAttributeName=this.createdOnAttributeName,e.modifiedByAttributeName=this.modifiedByAttributeName,e.modifiedOnAttributeName=this.modifiedOnAttributeName,this.dataSourceConfig&&(e.dataSourceConfig={...this.dataSourceConfig,config:{...this.dataSourceConfig.config}}),e._attributes=[],e._parent=this,e}}class au extends Error{get isCritical(){return!0}constructor(e,t){super(t),this.dataSource=e}}class Zi extends au{constructor(e,t){super(e,t)}}class Pd extends au{get isCritical(){return!1}constructor(e,t){super(e,t)}}class Ji{constructor(e,t){this.dataSourceName=e,this.injector=t,this._errors=[],this.supportTransactions=!1}get scope(){return this._scope}get hasErrors(){return this._errors.length!==0}get hasCriticalErrors(){return this._errors.some(e=>e.isCritical)}get affectedAttributes(){return[]}get isForceUpdateUnchangedData(){return!1}getLastError(){return this.hasErrors?this._errors[this._errors.length-1]:null}get isAggregate(){return!1}getEmptySchema(){return new gt}init(e,t){return this.initialConfig=e,this._scope=t,(0,l.of)(this)}load(e,t,s){return this.innerLoad(e,t,s)}save(e,t){return this.innerSave(e,t)}insert(e){return this.innerInsert(e)}delete(e){return this.innerDelete(e)}getSchema(){return this.dataSchema?(0,l.of)(this.dataSchema):this.innerGetSchema().pipe((0,o.tap)(e=>{this.dataSchema=e}))}getLookupDataSchema(e){return this.innerGetLookupDataSchema(e)}getDefaultValues(){return this.innerGetDefaultValues()}canEdit(e){return this.innerCanEdit(e)}canDelete(e){return this.innerCanDelete(e)}canCreate(e){return this.innerCanCreate(e)}getOwnLoadParameters(){return null}getAllowCopyingRecords(){return!1}}const ou="crt.EntityDataSource",cu="crt.PageParametersDataSource",pm="PageParameters";function He(i){return function(e,t,s){const r=function(...n){return ce.instance.process({type:i?.requestType?i.requestType:this.requestType,method:i?.methodName?i.methodName:t,args:n})};s?s.value=r:e[t]=r}}class kn{}const Dd=Symbol("CreateModelFrom");class _t extends kn{constructor(e){super(),this.requestType="crt.ModelGenerator",this._crtModel=e}static get instance(){return this._instance||(this._instance=new _t),this._instance}get name(){return this._crtModel?.name}static[Dd](e){return new _t(e)}static create(e){var t=this;return(0,C.A)(function*(){const s=yield t.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},"");return new _t(s)})()}getSchema(){return this._crtModel._getAsyncResult(this._crtModel.getSchema())}load(e){return e?.loadOptions&&!e?.options&&(e.options=e.loadOptions),this._crtModel._getAsyncResult(this._crtModel.load(e))}insert(e){return this._crtModel._getAsyncResult(this._crtModel.insert(e))}update(e,t){var s=this;return(0,C.A)(function*(){const r=Object.keys(e);if(r.length){const a=(yield s.getSchema()).primaryAttributeName;r.filter(u=>u!==a).forEach(u=>s._crtModel.attributeChanged(u))}return s._crtModel._getAsyncResult(s._crtModel.update(e,t))})()}copy(e,t={}){return this._crtModel._getAsyncResult(this._crtModel.copy(e,t))}create(e={}){return this._crtModel._getAsyncResult(this._crtModel.create(e))}delete(e){return this._crtModel._getAsyncResult(this._crtModel.delete(e))}canSave(e){return this._crtModel._getAsyncResult(this._crtModel.canSave(e))}canDelete(e){return this._crtModel._getAsyncResult(this._crtModel.canDelete(e))}insertInTransaction(e,t){return this._crtModel.insertInTransaction(e,t)}updateInTransaction(e,t,s){return this._crtModel.updateInTransaction(e,t,s)}deleteInTransaction(e,t){return this._crtModel.deleteInTransaction(e,t)}}(0,f.__decorate)([He({methodName:"generateOne"}),(0,f.__metadata)("design:type",Function)],_t.prototype,"_create",void 0);const Td=new c.InjectionToken("COPILOT_INTENT_REPOSITORY_TOKEN");class ve extends kn{constructor(){super(...arguments),this.requestType="crt.SysSettingsService"}}(0,f.__decorate)([He(),(0,f.__metadata)("design:type",Function)],ve.prototype,"getByCodes",void 0),(0,f.__decorate)([He(),(0,f.__metadata)("design:type",Function)],ve.prototype,"getByCode",void 0),(0,f.__decorate)([He(),(0,f.__metadata)("design:type",Function)],ve.prototype,"update",void 0),(0,f.__decorate)([He(),(0,f.__metadata)("design:type",Function)],ve.prototype,"updateMany",void 0);class uu{static#e=this._codeCharactersRegex=new RegExp("^[A-Za-z0-9\\s_]*$");static#t=this._wordsMatchRegex=new RegExp(/\w+/g);static generateCode(e,t=-1){const r=(e.match(this._wordsMatchRegex)||[]).filter(n=>n.length!==0).map(n=>n[0].toUpperCase()+n.substring(1)).join("");return t>=0?r.slice(0,t):r}static isTextUsableForCodeGeneration(e){return this._codeCharactersRegex.test(e)}}class Er{constructor(){this._sysSettingsService=(0,c.inject)(ve),this._defaultCodeMaxLength=41}_checkCodeIsUnique(e,t){return e?!e.includes(t):!0}_generateCode(e){const{prefix:t,options:s,generateFromName:r,name:n}=e,{codeMaxLength:a,defaultNewCode:u}=s;if(r){if(!uu.isTextUsableForCodeGeneration(n))return null;const d=t+u,h=(a??this._defaultCodeMaxLength)-d.length,g=uu.generateCode(n,h);return d+g}return P.$A.generateUnique(u,t)}generate(e,t,s){const r={generateFromName:!!t,name:t,prefix:null,options:s};return(0,l.from)(this._sysSettingsService.getByCode("SchemaNamePrefix")).pipe((0,l.map)(n=>n.value),(0,l.tap)(n=>r.prefix=n),(0,l.repeat)(r.generateFromName?1:void 0),(0,l.map)(()=>this._generateCode(r)),(0,l.filter)(n=>this._checkCodeIsUnique(e,n)),(0,l.take)(1),(0,l.defaultIfEmpty)(null))}static#e=this.\u0275fac=function(t){return new(t||Er)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Er,factory:Er.\u0275fac})}class Mr{constructor(){this._designItems=new Map}getDesignItem(e){return this._designItems.get(e)}getDesignItems(){return Array.from(this._designItems.values())}setDesignItem(e){this._designItems.set(e.UId,e)}static#e=this.\u0275fac=function(t){return new(t||Mr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Mr,factory:Mr.\u0275fac})}class Bt{constructor(){this._repository=(0,c.inject)(Td),this._copilotCodeGenerator=(0,c.inject)(Er),this._designRepository=(0,c.inject)(Mr)}_loadIntentUIdByActionUId(e){return(0,l.from)(_t.create("CopilotAction")).pipe((0,l.switchMap)(t=>t.load({attributes:["Intent"],parameters:[{type:F.Filter,value:new Re(ne.Equal,new X({columnPath:"Id"}),new ae({value:e}))}]})),(0,l.map)(t=>{const s=t[0]||{};return(0,D.isEmpty)(s)?null:s.Intent?.value}))}_applyActionToIntent(e,t){const r=(e.Actions||[]).findIndex(a=>a.Id===t.Id);if(r===-1)return!1;const n=e.Actions[r];return e.Actions.splice(r,1,{...n,...t}),!0}_applyParameterToIntent(e,t){const s=t.SourceCollection==="InputParameters"?e.InputParameters:e.OutputParameters,r=s.findIndex(n=>n.UId===t.UId);return r!==-1?(s.splice(r,1,{...s[r],...t}),!0):!1}_getSuccessResponse(){return{success:!0}}_getSuccessResponseObservable(){return(0,l.of)(this._getSuccessResponse())}_getDesignIntent(e){return(0,l.of)(this._designRepository.getDesignItem(e))}_getDesignIntents(){return Array.from(this._designRepository.getDesignItems())}_setDesignIntent(e){this._designRepository.setDesignItem(e)}_getIntentByParameterUId(e){for(const t of this._getDesignIntents()){if(t.InputParameters.find(n=>n.UId===e))return(0,l.of)({intent:t,sourceCollection:"InputParameters"});if(t.OutputParameters.find(n=>n.UId===e))return(0,l.of)({intent:t,sourceCollection:"OutputParameters"})}return(0,l.of)({})}getIntent(e){return this._repository.get(e).pipe((0,l.tap)(t=>{this._setDesignIntent(t)}))}getAllSkills(){return this._repository.getAllCodes("CopilotIntent")}getAllAgents(){return this._repository.getAllCodes("CopilotAgent")}getIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,l.map)(({intent:t,sourceCollection:s})=>s==="InputParameters"?t.InputParameters:t.OutputParameters),(0,l.map)(t=>t.find(s=>s.UId===e)))}getIntentParameters(e,t){return this._getDesignIntent(e).pipe((0,l.map)(s=>t==="InputParameters"?s.InputParameters:s.OutputParameters))}updateIntentParameter(e){return this._getIntentByParameterUId(e.UId).pipe((0,l.switchMap)(({intent:t,sourceCollection:s})=>(e.SourceCollection=s,this._applyParameterToIntent(t,e)?this._getSuccessResponseObservable():this._getSuccessResponseObservable())))}createIntentParameter(e){return this._getDesignIntent(e.Intent.value).pipe((0,l.map)(t=>((e.SourceCollection==="InputParameters"?t.InputParameters:t.OutputParameters).push(e),this._getSuccessResponse())))}deleteIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,l.map)(({intent:t,sourceCollection:s})=>{const r=s==="InputParameters"?t?.InputParameters:t?.OutputParameters,n=(r??[]).findIndex(a=>a.UId===e);return n!==-1&&r.splice(n,1),t}),(0,l.switchMap)(t=>this._repository.update(t)))}createIntent(e){return this._repository.create(e.UId).pipe((0,l.map)(t=>(Object.assign(t,e),t)),(0,l.switchMap)(t=>this._repository.update(t)))}updateIntent(e){return(0,l.forkJoin)([this._getDesignIntent(e.UId),this._repository.get(e.UId)]).pipe((0,l.map)(([t,s])=>{const r={...s,...t,...e};return this._setDesignIntent(r),r}),(0,l.switchMap)(t=>this._repository.update(t)))}createAction(e){return this._repository.get(e.Intent.value).pipe((0,l.map)(t=>(t.Actions.push(e),t)),(0,l.switchMap)(t=>this._repository.update(t)))}createSubIntent(e,t){return this._repository.createSubIntent(e,t)}deleteSubIntent(e,t){return this._repository.deleteSubIntent(e,t)}getActionByUId(e){return this._loadIntentUIdByActionUId(e).pipe((0,l.switchMap)(t=>t?this._repository.get(t).pipe((0,l.map)(s=>s.Actions.filter(r=>r.Id===e)),(0,l.map)(s=>s[0])):(0,l.of)({})))}getIntentByActionUId(e){return this.getActionByUId(e).pipe((0,l.switchMap)(t=>t?.Intent?this.getIntent(t.Intent.value):(0,l.of)({})))}updateAction(e){return this._loadIntentUIdByActionUId(e.Id).pipe((0,l.switchMap)(t=>this._repository.get(t).pipe((0,l.switchMap)(s=>this._applyActionToIntent(s,e)?this._repository.update(s):(0,l.of)({})))))}generateActionCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Action"})}generateSkillCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Skill"})}generateAgentCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Agent"})}deleteAction(e,t){return this._repository.get(e).pipe((0,l.map)(s=>(s.Actions=s.Actions.filter(r=>r.Id!==t),s)),(0,l.switchMap)(s=>this._repository.update(s)))}static#e=this.\u0275fac=function(t){return new(t||Bt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Bt,factory:Bt.\u0275fac})}var Xi;(function(i){i[i.None=0]="None",i[i.Self=1]="Self",i[i.ExplicitEntry=2]="ExplicitEntry",i[i.Delegated=4]="Delegated",i[i.FuncRoleFromOrgRole=8]="FuncRoleFromOrgRole",i[i.UpHierarchy=16]="UpHierarchy",i[i.AsManager=32]="AsManager",i[i.All=63]="All"})(Xi||(Xi={}));class Fn{get queryDtoType(){return this._queryDtoType}constructor(e,t){this.operationType=e,this.rootSchemaName=t,q.checkArgumentEmpty("_operationType",e),q.checkArgumentEmpty("_rootSchemaName",t)}getMetadata(){return(0,ue.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}(0,f.__decorate)([(0,ue.Exclude)(),(0,f.__metadata)("design:type",String)],Fn.prototype,"_queryDtoType",void 0),(0,f.__decorate)([(0,ue.Expose)({name:"__type"}),(0,f.__metadata)("design:type",String),(0,f.__metadata)("design:paramtypes",[])],Fn.prototype,"queryDtoType",null);class Ir extends je{static#e=this._instanceOfKey="devkit_BetweenFilter";static get _instanceOfKeys(){return[...je._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(ie.Between,ne.Between,e),this.filterType=ie.Between,this.rightLessExpression=t?.clone(),this.rightGreaterExpression=s?.clone()}static fromJson(e,t,s){return new Ir(s.fromJson(e.leftExpression,t),s.fromJson(e.rightLessExpression,t),s.fromJson(e.rightGreaterExpression,t))}clone(){const e=new Ir(this.leftExpression,this.rightLessExpression,this.rightGreaterExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightLessExpression:this.serializeItem(this.rightLessExpression),rightGreaterExpression:this.serializeItem(this.rightGreaterExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightLessExpression._getUsedColumns(),...this.rightGreaterExpression._getUsedColumns()]}}class kt extends je{static#e=this._instanceOfKey="devkit_ExistsFilter";static get _instanceOfKeys(){return[...je._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s=ne.Exists,r=!0){super(ie.Exists,s,e),this.filterType=ie.Exists,this.subFilters=t?.clone(),this.isAggregative=r}static fromJson(e,t,s){const r=s.fromJson(e.leftExpression,t),n=e.subFilters;let a;return n&&(a=t.fromJson(e.subFilters)),new kt(r,a,e.comparisonType,e.isAggregative)}clone(){const e=new kt(this.leftExpression,this.subFilters,this.comparisonType,this.isAggregative);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[...super._getUsedColumns(),...this.subFilters?._getUsedColumns()??[]]}}class Ft extends je{static#e=this._instanceOfKey="devkit_InFilter";static get _instanceOfKeys(){return[...je._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(ie.In,e,t),this.filterType=ie.In,this.rightExpressions=s.map(r=>r?.clone())??[]}static fromJson(e,t,s){const r=e.rightExpressions??[];return new Ft(e.comparisonType,s.fromJson(e.leftExpression,t),r.map(n=>s.fromJson(n,t)))}clone(){const e=new Ft(this.comparisonType,this.leftExpression,this.rightExpressions);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpressions:this.rightExpressions.map(e=>this.serializeItem(e))}}_getUsedColumns(){const e=this.rightExpressions.map(t=>t._getUsedColumns()).flat();return[...super._getUsedColumns(),...e]}}class Qe extends je{static#e=this._instanceOfKey="devkit_IsNullFilter";static get _instanceOfKeys(){return[...je._instanceOfKeys,this._instanceOfKey]}constructor(e,t){[ne.Is_null,ne.Is_not_null].includes(e)||console.warn(`Invalid comparison type: ${ne[e]} in IsNullFilter.`),super(ie.IsNull,Qe._getComparisonType(e),t),this.filterType=ie.IsNull,this.isNull=!0,this.isNull=this.comparisonType===ne.Is_null}static _getComparisonType(e){return e===ne.Is_not_null?e:ne.Is_null}static fromJson(e,t,s){return new Qe(Qe._getComparisonType(e.comparisonType),s.fromJson(e.leftExpression,t))}clone(){const e=new Qe(Qe._getComparisonType(this.comparisonType),this.leftExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}}var us;(function(i){i[i.And=0]="And",i[i.Or=1]="Or"})(us||(us={}));var ls;(function(i){i[i.None=0]="None",i[i.CurrentUser=1]="CurrentUser",i[i.CurrentUserContact=2]="CurrentUserContact",i[i.Yesterday=3]="Yesterday",i[i.Today=4]="Today",i[i.Tomorrow=5]="Tomorrow",i[i.PreviousWeek=6]="PreviousWeek",i[i.CurrentWeek=7]="CurrentWeek",i[i.NextWeek=8]="NextWeek",i[i.PreviousMonth=9]="PreviousMonth",i[i.CurrentMonth=10]="CurrentMonth",i[i.NextMonth=11]="NextMonth",i[i.PreviousQuarter=12]="PreviousQuarter",i[i.CurrentQuarter=13]="CurrentQuarter",i[i.NextQuarter=14]="NextQuarter",i[i.PreviousHalfYear=15]="PreviousHalfYear",i[i.CurrentHalfYear=16]="CurrentHalfYear",i[i.NextHalfYear=17]="NextHalfYear",i[i.PreviousYear=18]="PreviousYear",i[i.CurrentYear=19]="CurrentYear",i[i.PreviousHour=20]="PreviousHour",i[i.CurrentHour=21]="CurrentHour",i[i.NextHour=22]="NextHour",i[i.NextYear=23]="NextYear",i[i.NextNDays=24]="NextNDays",i[i.PreviousNDays=25]="PreviousNDays",i[i.NextNHours=26]="NextNHours",i[i.PreviousNHours=27]="PreviousNHours",i[i.PrimaryColumn=34]="PrimaryColumn",i[i.PrimaryDisplayColumn=35]="PrimaryDisplayColumn",i[i.PrimaryImageColumn=36]="PrimaryImageColumn",i[i.DayOfYearToday=37]="DayOfYearToday",i[i.DayOfYearTodayPlusDaysOffset=38]="DayOfYearTodayPlusDaysOffset",i[i.NextNDaysOfYear=39]="NextNDaysOfYear",i[i.PreviousNDaysOfYear=40]="PreviousNDaysOfYear",i[i.PrimaryColorColumn=41]="PrimaryColorColumn"})(ls||(ls={}));class jn extends $e{static#e=this._instanceOfKey="devkit_FunctionExpression";static get _instanceOfKeys(){return[...$e._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=fe.Function}}var be;(function(i){i[i.None=0]="None",i[i.Macros=1]="Macros",i[i.Aggregation=2]="Aggregation",i[i.DatePart=3]="DatePart",i[i.Length=4]="Length",i[i.Window=5]="Window",i[i.DateAdd=6]="DateAdd",i[i.DateDiff=7]="DateDiff"})(be||(be={}));class jt extends jn{static#e=this._instanceOfKey="devkit_MacrosFunctionExpression";static get _instanceOfKeys(){return[...jn._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=be.Macros,this.macrosType=e?.macrosType,this.functionArgument=e?.functionArgument}static fromJson(e,t,s){const r=t&&s&&e.functionArgument?s.fromJson(e.functionArgument,t):void 0;return new jt({functionArgument:r,macrosType:e.macrosType})}clone(){return new jt(this)}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class _e extends pr{static#e=this._instanceOfKey="devkit_FilterGroup";static get _instanceOfKeys(){return[...pr._instanceOfKeys,this._instanceOfKey]}get items(){const e={};return this.filters.forEach((t,s)=>{e[s]=this.serializeItem(t)}),e}constructor(e=us.And,t){super(ie.FilterGroup),this.filterType=ie.FilterGroup,this.filters=new Map,this.logicalOperation=e,this.rootSchemaName=t}static fromJson(e,t){const s=e.logicalOperation,r=new _e(s||us.And,e.rootSchemaName);return Object.entries(e.items).forEach(([n,a])=>{r.add(t.fromJson(a),n)}),r}toJson(){const e={};return e.filterType=this.filterType,e.isEnabled=this.isEnabled,e.logicalOperation=this.logicalOperation,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e.items=this.items,this.rootSchemaName&&(e.rootSchemaName=this.rootSchemaName),e}_createParameterValueExpressions(e){return e.map(t=>new ae({value:t}))}getItemByIndex(e){return this.items[Object.keys(this.items)[e]]}addSchemaColumnFilterWithParameter(e,t,s,r){const n=new X({columnPath:t}),a=new ae({value:s}),u=new Re(e,n,a);this.add(u,r)}addSchemaColumnInFilterWithParameters(e,t,s,r){const n=new X({columnPath:t}),a=this._createParameterValueExpressions(s),u=new Ft(e,n,a);this.add(u,r)}addPrimarySchemaColumnInFilter(e,t){const s=new jt({macrosType:ls.PrimaryColumn}),r=this._createParameterValueExpressions(e),n=new Ft(ne.Equal,s,r);this.add(n,t)}addSchemaColumnIsNullFilter(e,t){const s=new X({columnPath:e}),r=new Qe(ne.Is_null,s);this.add(r,t)}addSchemaColumnIsNotNullFilter(e,t){const s=new X({columnPath:e}),r=new Qe(ne.Is_not_null,s);this.add(r,t)}addSchemaColumnBetweenFilterWithParameters(e,t,s,r){const n=new X({columnPath:e}),a=new ae({value:t}),u=new ae({value:s}),d=new Ir(n,a,u);this.add(d,r)}addExistsFilter(e,t,s){const r=new X({columnPath:e}),n=new kt(r,t);this.add(n,s)}addNotExistsFilter(e,t,s){const r=new X({columnPath:e}),n=new kt(r,t,ne.Not_exists);this.add(n,s)}add(e,t){q.checkArgumentEmpty("filter",e);const s=t||(0,L.qv)();this.filters.set(s,e)}clone(){const e=new _e(this.logicalOperation,this.rootSchemaName);return this.filters.forEach((t,s)=>{e.filters.set(s,t.clone())}),e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}_getUsedColumns(){const e=[];return this.filters.forEach(t=>{let s=t._getUsedColumns?t._getUsedColumns():[];s=s.map(r=>({path:r.path,schemaName:r.schemaName??this.rootSchemaName})),e.push(...s)}),e}}(0,f.__decorate)([(0,ue.Exclude)(),(0,f.__metadata)("design:type",Object)],_e.prototype,"filters",void 0),(0,f.__decorate)([(0,ue.Expose)(),(0,f.__metadata)("design:type",Object),(0,f.__metadata)("design:paramtypes",[])],_e.prototype,"items",null);class $n extends Fn{constructor(e,t){super(e,t),this.filters=new _e}clearFilters(){this.filters.filters.clear()}getMetadata(){return{...super.getMetadata(),filters:this.filters.toJson()}}_getUsedColumns(){const e=this.filters._getUsedColumns();return e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),e}}(0,f.__decorate)([(0,ue.Exclude)(),(0,f.__metadata)("design:type",Object)],$n.prototype,"filters",void 0);var ds;(function(i){i[i.Select=0]="Select",i[i.Insert=1]="Insert",i[i.Update=2]="Update",i[i.Delete=3]="Delete"})(ds||(ds={}));class Yi extends $n{constructor(e){super(ds.Update,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.UpdateQuery",this.isForceUpdate=!1}get columnValues(){return{items:(0,ue.classToPlain)(this._columnValues)}}addColumn(e,t,s){q.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new ae({value:t,dataValueType:s}))}}(0,f.__decorate)([(0,ue.Expose)(),(0,f.__metadata)("design:type",Object),(0,f.__metadata)("design:paramtypes",[])],Yi.prototype,"columnValues",null);class Qi extends Fn{constructor(e){super(ds.Insert,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.InsertQuery"}get columnValues(){return{items:(0,ue.classToPlain)(this._columnValues)}}addColumn(e,t,s){q.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new ae({value:t,dataValueType:s}))}}(0,f.__decorate)([(0,ue.Expose)(),(0,f.__metadata)("design:type",Object),(0,f.__metadata)("design:paramtypes",[])],Qi.prototype,"columnValues",null);class lu extends $n{constructor(e){super(ds.Delete,e),this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.DeleteQuery"}}var et;(function(i){i.None="",i.Count="Count",i.Sum="Sum",i.Avg="Avg",i.Min="Min",i.Max="Max",i.TopOne="TopOne"})(et||(et={}));class Nd{constructor(){this._cache=new Map}setToCache(e,t){this._cache.set(e,t)}deleteFromCache(e){this._cache.delete(e)}getFromCache(e){return this._cache.get(e)}}class Vd extends Nd{constructor(){super(...arguments),this.httpClient=(0,c.inject)(V.HttpClient)}_createCacheKey(e,t={}){return`${e}!${JSON.stringify(t)}`}_cacheRequest(e,t){const s=this.getFromCache(t);if((0,D.isUndefined)(s)){const r=e().pipe((0,l.shareReplay)({bufferSize:1,refCount:!1}));return this.setToCache(t,r),r}return s}_getMethodEndpoint(e){return`${this.serviceEndpoint.replace(/\/$/,"")}/${e}`}executePostRequestWithCache(e,t={}){const s=this._getMethodEndpoint(e),r=this._createCacheKey(e,t),n=()=>this.httpClient.post(s,t);return this._cacheRequest(n,r)}executeGetRequestWithCache(e){const t=this._getMethodEndpoint(e),s=this._createCacheKey(e),r=()=>this.httpClient.get(t);return this._cacheRequest(r,s)}resetCache(e,t={}){const s=this._createCacheKey(e,t);this.deleteFromCache(s)}}let ea=class Cn extends Vd{constructor(){super(...arguments),this.serviceEndpoint="rest/RightsService"}_getSchemaDeleteRights(e){return this.executePostRequestWithCache("GetSchemaDeleteRights",e).pipe((0,o.map)(t=>({result:t&&t.GetSchemaDeleteRightsResult?.length===0,message:t?.GetSchemaDeleteRightsResult})))}_getCanDeleteByRecord(e){const t=`${this.serviceEndpoint}/GetCanDelete`;return this.httpClient.post(t,e).pipe((0,o.map)(s=>({result:s&&s.GetCanDeleteResult?.length===0,message:s?.GetCanDeleteResult})))}_getCanAddData(e){const t=e.map(r=>this.getFromCache(`GetCanAdd_${r}`)).filter(r=>!!r),s=e.filter(r=>!t.find(n=>n.schemaName===r));return{cachedResult:t,requestSchemaNames:s}}getCanExecuteOperation(e){return this.getCanExecuteOperations([e]).pipe((0,o.mergeMap)(t=>(0,l.of)((t||[])[0])))}getCanExecuteOperations(e){return(0,l.combineLatest)(e.map(t=>this.executePostRequestWithCache("GetCanExecuteOperation",{operation:t}).pipe((0,o.map)(s=>s?.GetCanExecuteOperationResult))))}getIsTechnicalUser(){const e=`${this.serviceEndpoint}/GetIsTechnicalUser`;return this.httpClient.post(e,null).pipe((0,o.map)(t=>t?.GetIsTechnicalUserResult))}getCanAdd(e){const t="GetCanAdd",{cachedResult:s,requestSchemaNames:r}=this._getCanAddData(e);if(!r.length)return(0,l.of)(s);const n=`${this.serviceEndpoint}/${t}`;return this.httpClient.post(n,r).pipe((0,o.map)(a=>a.map(u=>({schemaName:u.Key,result:(0,D.isEmpty)(u.Value),errorMessage:u.Value}))),(0,o.tap)(a=>a.forEach(u=>this.setToCache(`${t}_${u.schemaName}`,u))),(0,o.map)(a=>a.concat(s)))}getCanEdit(e){const t=`${this.serviceEndpoint}/GetCanEdit`;return this.httpClient.post(t,e).pipe((0,o.map)(s=>({result:s&&s.GetCanEditResult?.length===0,message:s?.GetCanEditResult})))}getCanDelete(e){if(e.primaryColumnValue)return this._getCanDeleteByRecord(e);const t={schemaName:e.schemaName};return this._getSchemaDeleteRights(t)}copyRights(e){const t=`${this.serviceEndpoint}/CopyRights`;return this.httpClient.post(t,e)}getCanEditColumns(e){return this.executePostRequestWithCache("GetCanEditColumns",e).pipe((0,o.map)(t=>{const s=t?.GetCanEditColumnsResult??[],r={};return s.forEach(n=>r[n.Key]=n.Value),r}))}getCanReadColumns(e){return this.executePostRequestWithCache("GetCanReadColumns",e).pipe((0,o.map)(t=>{const s=t?.GetCanReadColumnsResult??[],r={};return s.forEach(n=>r[n.Key]=n.Value),r}))}getCanExecuteEntityOperation(e,t){const s=`${this.serviceEndpoint}/GetCanExecuteEntityOperation`,r={entitySchemaName:e,entityOperationCode:t};return this.httpClient.post(s,r).pipe((0,o.mergeMap)(n=>(0,l.of)(n?.GetCanExecuteEntityOperationResult)))}getAclGranted(e){return(0,l.firstValueFrom)(this.executeGetRequestWithCache("GetReadDeniedEntityList")).then(t=>!t.GetReadDeniedEntityListResult.includes(e),t=>(console.error(`Error while making request to ReadDeniedEntityList: ${t}`),!0))}applyChanges(e){const t=`${this.serviceEndpoint}/ApplyChanges`;return(0,l.firstValueFrom)(this.httpClient.post(t,e)).then(()=>!0,s=>{throw console.error(`Error while making request to ApplyChanges: ${s}`),s})}getRecordRights(e){return(0,l.firstValueFrom)(this.executePostRequestWithCache("GetRecordRights",e)).then(t=>t,t=>{throw console.error(`Error while making request to GetRecordRights: ${t}`),t})}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Cn)))(s||Cn)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Cn,factory:Cn.\u0275fac,providedIn:"root"})};ea=(0,f.__decorate)([(0,P.op)({requestType:"crt.RightsService"})],ea);class Ne{static#e=this.\u0275fac=function(t){return new(t||Ne)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ne,factory:Ne.\u0275fac})}function mm(i){return i=i||new Date,new Date(i.getFullYear(),i.getMonth(),i.getDate())}function fm(i){return i=i||new Date,new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59,999)}function du(i){if(!i)return null;function e(){throw new Error(`String "${i}" is not a valid serialized date.`)}typeof i!="string"&&e();const[t,s]=i.split("T");if(s&&(s[s.length-1]==="Z"||s.indexOf("+")!==-1||s.indexOf("-")!==-1)){const n=Date.parse(i);return isNaN(n)&&e(),new Date(n)}try{const[n,a,u]=t.split("-"),[d,h,g]=s.split(":"),[b,M]=g.split(".");return new Date(parseInt(n),parseInt(a)-1,parseInt(u),parseInt(d),parseInt(h),parseInt(b),parseInt(M))}catch{e()}}function gm(i,e){e==null&&(e=0),i.setSeconds(i.getSeconds()+e*3600)}function _m(i,e,t){const s=t||{hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat(e.sysCultureName,s).format(i)}function ta(i,e){switch(q.checkArgumentEmpty("dataValueType",e),e){case v.r.Date:case v.r.Time:case v.r.DateTime:return du(i);default:return i}}function xd(i,e){if(ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),!i)return i;const t={};return Object.keys(i).forEach(s=>{const r=i[s];t[s]=e[s]?ta(r,e[s]):r}),t}function ym(i,e){return ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),i&&i.map(t=>t&&xd(t,e))}var hs;(function(i){i.Entity="Entity",i.ClientUnit="ClientUnit",i.Intent="Intent"})(hs||(hs={}));class yt{constructor(){this._phoneUtil=null,this._phoneNumberType=null,this._phoneMaskOverrides=new Map([["id",["+{62} 000 000 000 000","+{62} 000 000 00"]]])}getAllPhoneMasks(e){let t=[];for(const r in this._phoneNumberType)if(isNaN(Number(r))){const n=this._phoneUtil.getExampleNumberForType(e,this._phoneNumberType[r]);if(!n)continue;const a=n.getCountryCode().toString(),u=this._phoneUtil.format(n,null),d=`+{${a.replace("0","\\0")}} ${u.replace(/-/g," ").replace(/\d/g,"0")}`;t.find(h=>h===d)||t.push(d)}const s=this._phoneMaskOverrides.get(e);return s&&(t.push(...s),t=Array.from(new Set(t))),t}initialize(){var e=this;return(0,C.A)(function*(){if(!(e._phoneUtil&&e._phoneNumberType))try{const t=yield y.e(1588).then(y.t.bind(y,1588,23));e._phoneUtil=t.PhoneNumberUtil.getInstance(),e._phoneNumberType=t.PhoneNumberType}catch(t){throw console.error("Error loading google-libphonenumber:",t),t}})()}isValidPhoneNumber(e){if(!this._phoneUtil)return!0;try{const t=this._phoneUtil.parse(e);return this._phoneUtil.isValidNumber(t)}catch{return!1}}static#e=this.\u0275fac=function(t){return new(t||yt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:yt,factory:yt.\u0275fac,providedIn:"root"})}const sa={ShortTextCaption:50,MediumTextCaption:250,LongTextCaption:500},Un={Integer:{max:2147483647,min:-2147483647},Float:{max:6999999999999999e-2,min:-6999999999999999e-2}};function Od(i){let e;switch(i){case v.r.SHORT_TEXT:e=sa.ShortTextCaption;break;case v.r.PHONE_TEXT:case v.r.MEDIUM_TEXT:e=sa.MediumTextCaption;break;case v.r.LONG_TEXT:case v.r.EMAIL_TEXT:e=sa.LongTextCaption;break;default:return}return{maxLength:e}}function Ld(i){if([v.r.Float,v.r.FLOAT1,v.r.FLOAT2,v.r.FLOAT3,v.r.FLOAT4,v.r.FLOAT8,v.r.Money].includes(i))return{minValue:Un.Float.min,maxValue:Un.Float.max};if(i===v.r.Integer)return{minValue:Un.Integer.min,maxValue:Un.Integer.max}}class Rr{get isDate(){return this.dataValueType===v.r.Date||this.dataValueType===v.r.DateTime||this.dataValueType===v.r.Time}get isImage(){return this.dataValueType===v.r.IMAGELOOKUP||this.dataValueType===v.r.Image}get isLookup(){return this.dataValueType===v.r.Lookup}set isSystem(e){this._isSystem=e}get isSystem(){return this._isSystem}get isAggregate(){return this.attributeType===z.AggregationAttribute?!0:this.attributeType===z.FunctionAttribute&&this.functionConfig?.type==="aggregation"}constructor(e){if(this._isSystem=!1,e!=null){this.name=e.name,this.caption=e.caption,this.path=e.path,this.dataValueType=e.dataValueType,e.validators&&(this.validators={...e.validators||{}});const t=e.defaultValue;t&&(t instanceof l.Observable?this.defaultValue=t.pipe((0,o.map)(s=>this._getConvertDefaultValue(s))):this.defaultValue=(0,l.of)(this._getConvertDefaultValue(t))),this.defaultValueSchema=e.defaultValueSchema,this.isValueCloneable=e.isValueCloneable,this.attributeType=e.attributeType,this.referenceSchemaName=e.referenceSchemaName,this.functionConfig=e.functionConfig,this.aggregationConfig=e.aggregationConfig,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.usageType=e.usageType,this.isRequired=e.isRequired,this.lookupMode=e.lookupMode,this.isSystem=!!e.isSystem}}_getConvertDefaultValue(e){if(this.isDate)if(e instanceof Date){const t=new Date;return t.setTime(e.getTime()),t}else return e;else return typeof e=="object"?{...e}:e}clone(){return new Rr(this)}addDefaultValidators(){const e=this.validators??{};this.isRequired&&(e["crt.Required"]={type:"crt.Required"}),!this.validators&&Object.keys(e).length>0&&(this.validators=e)}}class hu{constructor(e=null,t,s){e==null?this._dataSchema=new gt:this._dataSchema=t?.useClone?e.clone():e.createChild(),this._phoneValidationService=s||c.Injector.create({providers:[{provide:yt,useClass:yt}]}).get(yt)}_createDataSchemaAttributeByConfig(e){const t=new Rr;return t.name=e.name,t.caption=e.caption,t.path=e.path,t.dataValueType=e.dataValueType,t.validators={...e.validators||{}},t.defaultValue=(0,l.of)(typeof e.defaultValue=="object"?{...e.defaultValue}:e.defaultValue),t.defaultValueSchema=e.defaultValueSchema,t.isValueCloneable=e.isValueCloneable,t.attributeType=e.attributeType,t.referenceSchemaName=e.referenceSchemaName,t.functionConfig=e.functionConfig,t.aggregationConfig=e.aggregationConfig,t.usageType=e.usageType,t.isMasked=e.isMasked,t.isFormatValidated=e.isFormatValidated,t.isSensitiveData=e.isSensitiveData,t.isValueMasked=e.isValueMasked,t.valueMaskingSettings=e.valueMaskingSettings,t.isRequired=e.isRequired,t.lookupMode=e.lookupMode,t.isSystem=e.isSystem??!1,t}setEntitySchemaColumnValidators(e,t){return e.isRequired&&this.setAttributeRequiredValidator(t),this.setAttributeTextDataValueTypeValidator(t,e.dataValueType).setAttributeNumberDataValueTypeValidator(t,e.dataValueType).setAttributePhoneDataValueTypeValidator(t,e)}setAttributeValidator(e,t,s){const r=this._dataSchema.attributes.find(a=>a.name===e),n=r.validators||{};return n[t]=s,r.validators=n,this}setAttributeRequiredValidator(e){return this.setAttributeValidator(e,"crt.Required",{type:"crt.Required"})}setAttributeMaxLengthValidator(e,t){return this.setAttributeValidator(e,"crt.MaxLength",{type:"crt.MaxLength",params:{maxLength:t}})}setAttributeTextDataValueTypeValidator(e,t){const s=Od(t);return s?this.setAttributeMaxLengthValidator(e,s.maxLength):this}setAttributeMinValueValidator(e,t){return this.setAttributeValidator(e,"crt.Min",{type:"crt.Min",params:{min:t}})}setAttributeMaxValueValidator(e,t){return this.setAttributeValidator(e,"crt.Max",{type:"crt.Max",params:{max:t}})}setAttributeMinMaxValidator(e,t,s){return this.setAttributeMinValueValidator(e,t).setAttributeMaxValueValidator(e,s)}setAttributeNumberDataValueTypeValidator(e,t){const s=Ld(t);return s&&this.setAttributeMinMaxValidator(e,s.minValue,s.maxValue),this}setAttributePhoneDataValueTypeValidator(e,t){return[v.r.PHONE_TEXT].includes(t.dataValueType)&&t.isMasked&&(this._phoneValidationService.initialize().then(),this.setAttributeValidator(e,"crt.PhoneNumber",{type:"crt.PhoneNumber"})),this}setAttributesDefaultValue(e){return this._dataSchema.attributes.forEach(t=>{t.defaultValue=e.pipe((0,o.map)(s=>s[t.name]))}),this}addAttribute(e,t){const{name:s,caption:r,dataValueType:n,isValueCloneable:a,referenceSchemaName:u,isMasked:d,isFormatValidated:h,usageType:g,isRequired:b,isSensitiveData:M,isValueMasked:Z,valueMaskingSettings:Y}=e,j=new Rr;return j.name=t.attributeName||s,j.path=t.attributePath||s,j.caption=r,j.dataValueType=n,j.isValueCloneable=!!a,j.attributeType=t.attributeType||z.OwnAttribute,j.referenceSchemaName=u,j.validators={},j.isMasked=d,j.isFormatValidated=h,j.isSensitiveData=M,j.isValueMasked=Z,j.valueMaskingSettings=Y,j.usageType=g,j.isRequired=b,j.defaultValueSchema=e.defaultValueSchema,j.lookupMode=e.lookupMode,j.isSystem=(0,D.compact)([this._dataSchema.createdByAttributeName,this._dataSchema.createdOnAttributeName,this._dataSchema.modifiedByAttributeName,this._dataSchema.modifiedOnAttributeName,this._dataSchema.primaryAttributeName,"ProcessListeners"]).includes(j.name),this._dataSchema.addAttribute(j),t.attributeType===z.OwnAttribute&&this.setEntitySchemaColumnValidators(e,j.name),t.attributeType===z.AggregationAttribute&&(j.aggregationConfig=t.aggregationConfig),t.attributeType===z.FunctionAttribute&&(j.functionConfig=t.functionConfig),this}addOwnAttribute(e){return this.addAttribute(e,{attributeType:z.OwnAttribute})}setEntitySchema(e){return this._dataSchema.dataSourceConfig={type:"crt.EntityDataSource",config:{entitySchemaName:e.name}},this._dataSchema.name=e.name,this._dataSchema.type=hs.Entity,this._dataSchema.primaryAttributeName=e.getPrimaryColumn()?.name,this._dataSchema.primaryDisplayAttributeName=e.getPrimaryDisplayColumn()?.name,this._dataSchema.primaryColorAttributeName=e.getPrimaryColorColumn()?.name,this._dataSchema.hierarchyAttributeName=e.getHierarchyColumn()?.name,this._dataSchema.caption=e.caption,this._dataSchema.createdByAttributeName=e.columns.find(t=>t.uId===e.createdByColumnUId)?.name,this._dataSchema.createdOnAttributeName=e.columns.find(t=>t.uId===e.createdOnColumnUId)?.name,this._dataSchema.modifiedByAttributeName=e.columns.find(t=>t.uId===e.modifiedByColumnUId)?.name,this._dataSchema.modifiedOnAttributeName=e.columns.find(t=>t.uId===e.modifiedOnColumnUId)?.name,this._dataSchema.clearAttributes(),e.columns.forEach(t=>{this.addOwnAttribute(t)}),this}setDataSchemaConfig(e){return this._dataSchema.name=e.name,this._dataSchema.type=e.type,this._dataSchema.caption=typeof e.caption=="string"?e.caption:{...e.caption},this._dataSchema.primaryAttributeName=e.primaryAttributeName,this._dataSchema.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this._dataSchema.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig?.config}},(e.attributes||[]).forEach(s=>{const r=this._createDataSchemaAttributeByConfig(s);this._dataSchema.addAttribute(r)}),this}build(){return this._dataSchema.clone()}}class Bd extends Zi{get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,`Entity schema with name '${t}' not found.`),this._entitySchemaName=t}}class kd extends Zi{constructor(e){super(e,`Entity schema name for data source ${e.dataSourceName} is not provided`)}}class Fd extends Error{constructor(e){super(`Item with key '${e}' does not exist.`)}}var ps;(function(i){i[i.None=0]="None",i[i.Asc=1]="Asc",i[i.Desc=2]="Desc"})(ps||(ps={}));class tt{constructor(e){this.orderDirection=ps.None,this.orderPosition=-1,this.isVisible=!0,this.expression=e}withOrdering(e,t){return q.checkArgumentEmpty("orderDirection",e),q.checkArgumentEmpty("orderPosition",t),q.checkArgumentOutOfRange("orderPosition",t,{begin:-1}),this.orderDirection=e,this.orderPosition=t,this}withOptions(e){return q.checkArgumentEmpty("options",e),this.isVisible=e.isVisible??!0,this}withCaption(e){return q.checkArgumentEmpty("caption",e),this.caption=e,this}_getUsedColumns(){return this.expression._getUsedColumns()}toJson(){return(0,ue.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class jd extends tt{constructor(e){super(new X({columnPath:e}))}}class wr extends $e{static#e=this._instanceOfKey="devkit_SubQueryExpression";static get _instanceOfKeys(){return[...$e._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=fe.SubQuery,this.columnPath=e?.columnPath;const t=e?.subFilters;typeof t?.clone=="function"?this.subFilters=t.clone():t?(this.subFilters=new _e(t.logicalOperation,t.rootSchemaName),this.subFilters.isEnabled=t.isEnabled,Object.entries(t.items).forEach(([s,r])=>{this.subFilters.add(r,s)})):this.subFilters=t,this.subOrderDirection=e.subOrderDirection,this.subOrderColumn=e.subOrderColumn}static fromJson(e,t){return new wr({columnPath:e.columnPath,subFilters:t.fromJson(e.subFilters),subOrderDirection:e.subOrderDirection,subOrderColumn:e.subOrderColumn})}clone(){return new wr(this)}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[{path:this.columnPath},...this.subFilters?._getUsedColumns()??[]]}}class Pr extends wr{static#e=this._instanceOfKey="devkit_AggregationSubQueryExpression";static get _instanceOfKeys(){return[...wr._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.aggregationType=e?.aggregationType,this.functionType=e?.functionType}static fromJson(e,t){const s=super.fromJson(e,t);return new Pr({aggregationType:e.aggregationType,functionType:e.functionType,...s})}clone(){return new Pr(this)}}class $d extends tt{constructor(e,t,s,r,n){super(new Pr({aggregationType:t,columnPath:e,subFilters:s,subOrderDirection:r,subOrderColumn:n}))}}class Ud extends tt{constructor(e,t){super(new ae({value:e,dataValueType:t}))}}class Dr extends $e{static#e=this._instanceOfKey="devkit_ArithmeticExpression";static get _instanceOfKeys(){return[...$e._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=fe.ArithmeticOperation,this.arithmeticOperation=e?.arithmeticOperation,this.leftArithmeticOperand=e?.leftArithmeticOperand.clone(),this.rightArithmeticOperand=e?.rightArithmeticOperand.clone()}static fromJson(e,t,s){const r=s?.fromJson(e.leftArithmeticOperand,t),n=s?.fromJson(e.rightArithmeticOperand,t),a={leftArithmeticOperand:r,rightArithmeticOperand:n,arithmeticOperation:e.arithmeticOperation,isBlock:e.isBlock};return new Dr(a)}clone(){return new Dr(this)}_getUsedColumns(){return[...this.leftArithmeticOperand._getUsedColumns(),...this.rightArithmeticOperand._getUsedColumns()]}}class qd extends tt{constructor(e,t,s){super(new Dr({arithmeticOperation:e,leftArithmeticOperand:t,rightArithmeticOperand:s}))}}class Hd extends tt{constructor(e){super(new jt({macrosType:e}))}}class bt extends jn{static#e=this._instanceOfKey="devkit_ArgumentFunctionExpression";static get _instanceOfKeys(){return[...jn._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionArgument=e?.functionArgument?.clone()}toJson(){const e=super.toJson();return this.functionArgument&&(e.functionArgument=this.serializeItem(this.functionArgument)),e}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class $t extends bt{static#e=this._instanceOfKey="devkit_DatePartFunctionExpression";static get _instanceOfKeys(){return[...bt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=be.DatePart,this.datePartType=e?.datePartType}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t),n=e.datePartType;return new $t({functionArgument:r,datePartType:n,isBlock:e.isBlock})}clone(){return new $t(this)}}class Kd extends tt{constructor(e,t){super(new $t({datePartType:e,functionArgument:t}))}get datePartType(){return this.expression?.datePartType}}class Tr extends bt{static#e=this._instanceOfKey="devkit_AggregationFunctionExpression";static get _instanceOfKeys(){return[...bt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=be.Aggregation,this.aggregationType=e?.aggregationType,this.aggregationEvalType=e?.aggregationEvalType}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t),n=e.aggregationType,a=e.aggregationEvalType;return new Tr({functionArgument:r,aggregationType:n,aggregationEvalType:a,isBlock:e.isBlock})}clone(){return new Tr(this)}}class zd extends tt{constructor(e,t,s){super(new Tr({aggregationType:e,aggregationEvalType:t,functionArgument:s}))}}class Nr extends bt{static#e=this._instanceOfKey="devkit_LengthFunctionExpression";static get _instanceOfKeys(){return[...bt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=be.Length}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t);return new Nr({functionArgument:r,isBlock:e.isBlock})}clone(){return new Nr(this)}}class Gd extends tt{constructor(e){super(new Nr({functionArgument:e}))}}class Vr extends bt{static#e=this._instanceOfKey="devkit_WindowFunctionExpression";static get _instanceOfKeys(){return[...bt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=be.Window}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t);return new Vr({functionArgument:r,isBlock:e.isBlock})}clone(){return new Vr(this)}}class Wd extends tt{constructor(e){super(new Vr({functionArgument:e}))}}var Ut;(function(i){i[i.None=0]="None",i[i.All=1]="All",i[i.Distinct=2]="Distinct"})(Ut||(Ut={}));class xr extends $n{constructor(e){super(ds.Select,e),this._columns=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.SelectQuery",this.isDistinct=!1,this.rowCount=-1,this.rowsOffset=-1,this.useLocalization=!0,this.useRecordDeactivation=!1,this._getIsPageable=()=>this.rowCount>0&&this.rowsOffset>-1}_internalAddColumn(e,t){this._columns.has(e)||this._columns.set(e,t)}getColumn(e){if(!this._columns.has(e))throw new Fd(e);return this.findColumn(e)}findColumn(e){return this._columns.get(e)}getMetadata(){return{...super.getMetadata(),columns:{items:(0,ue.classToPlain)(this._columns,{exposeUnsetFields:!1,excludePrefixes:["_"]})},allColumns:!1,isDistinct:this.isDistinct,ignoreDisplayValues:!1,rowCount:this.rowCount,rowsOffset:this.rowsOffset,adminUnitRoleSources:this.adminUnitRoleSources,isPageable:this._getIsPageable(),conditionalValues:this.conditionalValues?this.conditionalValues:null,isHierarchical:!1,hierarchicalMaxDepth:0,hierarchicalColumnName:null,hierarchicalColumnValue:null,useLocalization:this.useLocalization,useRecordDeactivation:this.useRecordDeactivation}}addColumn(e,t){return this._internalAddColumn(t,e),e}addSchemaColumn(e,t){q.checkArgumentEmpty("columnPath",e);const s=new jd(e);return this._internalAddColumn(t||e,s),s}addAggregationSubQueryColumn(e,t,s,r){const n=new $d(e,t,s.filter,s.sortByDirection,s.sortByColumn);return this._internalAddColumn(r||e,n),n}addParameterColumn(e,t,s){const r=new Ud(e,t);return this._internalAddColumn(s,r),r}addArithmeticColumn(e,t,s,r){const n=new qd(e,t,s);return this._internalAddColumn(r,n),n}addMacrosFunctionColumn(e,t){const s=new Hd(e);return this._internalAddColumn(t,s),s}addDatePartFunctionColumn(e,t,s){const r=new X({columnPath:e}),n=new Kd(t,r);return this._internalAddColumn(s,n),n}addAggregationFunctionColumn(e,t,s,r=Ut.None){const n=new X({columnPath:e}),a=new zd(t,r,n);return this._internalAddColumn(s,a),a}addLengthFunctionColumn(e,t){const s=new X({columnPath:e}),r=new Gd(s);return this._internalAddColumn(t,r),r}addWindowFunctionColumn(e,t,s,r=Ut.None){const n=new Tr({aggregationType:t,aggregationEvalType:r,functionArgument:new X({columnPath:e})}),a=new Wd(n);return this._internalAddColumn(s,a),a}_getUsedColumns(){const e=[];return this._columns.forEach(t=>{e.push(...t._getUsedColumns())}),e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),[...e,...super._getUsedColumns()]}}function Zd(i){switch(i){case"asc":return ps.Asc;case"desc":return ps.Desc;default:return ps.None}}const pu=new c.InjectionToken("A factory of entity schema column appender"),mu=new c.InjectionToken("A factory of data schema to data source attribute converter");class Jd{_getExpressionColumnPath(e,t){const s="[{referenceSchemaName}:{referenceAttributeName}:{attributeName}]",r=e.relationData.map(h=>mt.String.format(s,h)).join("."),n=e.attributePath.split("."),a=n.length>1?"{ownColumnPath}.{relationString}.{columnPath}":"{relationString}.{columnPath}";n.pop();const d={ownColumnPath:n.join("."),relationString:r,columnPath:t};return mt.String.format(a,d)}_updateFilterLeftExpression(e,t){switch(e.expressionType){case fe.SchemaColumn:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case fe.SubQuery:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case fe.Function:e.functionType!==be.Macros&&this._updateFilterLeftExpression(e.functionArgument,t);break}}_updateRelatedFilterGroup(e,t){e instanceof _e?this._updateRelatedFilterGroupInstance(e,t):this._updateRelatedFilterGroupObject(e,t)}_updateRelatedFilterGroupObject(e,t){Object.values(e.items).forEach(s=>{this._updateRelatedFilter(s,t)})}_updateRelatedFilterGroupInstance(e,t){e.filters.forEach(s=>this._updateRelatedFilter(s,t))}_updateRelatedFilter(e,t){if(e.filterType!==ie.FilterGroup){const s=e.leftExpression;s&&this._updateFilterLeftExpression(s,t)}else this._updateRelatedFilterGroup(e,t)}convertToRelatedFilter(e,t=[]){if(!e)return e;let s;if(e instanceof pr)s=e.clone();else{const r=JSON.stringify(e);s=JSON.parse(r)}return[...t].reverse().forEach(r=>{r.relationData&&r.relationData.length!==0&&this._updateRelatedFilter(s,r)}),s}}const Xd="invalidate-data-schema-cache";class st{constructor(e,t){this._entitySchemaRepository=e,this._broadcastChannelFactory=t,this._dataSchemas=new Map,this._subscribeOnChangesInDesigner()}_subscribeOnChangesInDesigner(){this._broadcastChannelFactory.createInstance(Xd).messages$.subscribe(({schemaName:e})=>{this._removeCachedSchema(e)})}_createEntityDataSchema(e){const t=new hu;return t.setEntitySchema(e),(0,l.of)(t.build())}_getEntityDataSchema(e){return this._entitySchemaRepository.getSchemaByName(e).pipe((0,o.switchMap)(t=>this._createEntityDataSchema(t)))}_removeCachedSchema(e){this._dataSchemas.has(e)&&(this._dataSchemas.delete(e),this._entitySchemaRepository.clearSchemaCacheByName(e))}get(e){return this._dataSchemas.has(e)?(0,l.of)(this._dataSchemas.get(e)):this._getEntityDataSchema(e).pipe((0,o.tap)(t=>this._dataSchemas.set(e,t)))}getByEntitySchema(e){const t=e.name;return this._dataSchemas.has(t)?(0,l.of)(this._dataSchemas.get(t)):this._createEntityDataSchema(e).pipe((0,o.tap)(s=>this._dataSchemas.set(t,s)))}static#e=this.\u0275fac=function(t){return new(t||st)(c.\u0275\u0275inject(Ye),c.\u0275\u0275inject(P.Vx))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:st,factory:st.\u0275fac,providedIn:"platform"})}class Or{constructor(e,t){this._dataSchemaRepository=e,this._featureValues=t}_getDataSchema(e){var t=this;return(0,C.A)(function*(){const s=yield(0,l.firstValueFrom)(t._dataSchemaRepository.get(e));if(!s)throw new Error(`Can not find DataSchema with name '${e}'`);return s})()}_getDataSchemaAttribute(e,t){var s=this;return(0,C.A)(function*(){const r=e instanceof gt?e:yield s._getDataSchema(e),n=r.findAttributeByName(t);if(!n)throw new Error(`Can not find column '${t}' in Schema '${r.name}'`);return n})()}_getDataSchemaPrimaryAttribute(e){var t=this;return(0,C.A)(function*(){const s=yield t._getDataSchema(e);return t._getDataSchemaAttribute(s,s.primaryAttributeName)})()}_createRelationPathItemFromForwardPathItem(e,t){var s=this;return(0,C.A)(function*(){const r=yield s._getDataSchemaAttribute(e,t);let n=null,a=null;const u=r.dataValueType===v.r.Lookup;return u&&(n=r.referenceSchemaName,a=(yield s._getDataSchema(n)).primaryAttributeName),{isJoin:u,referenceSchemaName:n,referenceAttributeName:a,ownSchemaAttributeName:t,ownSchemaName:e}})()}_createRelationPathItemFromJoinPathItem(e,t,s,r){var n=this;return(0,C.A)(function*(){const a=s?yield n._getDataSchemaAttribute(t,s):yield n._getDataSchemaPrimaryAttribute(t);return{isJoin:!0,referenceSchemaName:t,referenceAttributeName:a.name,ownSchemaAttributeName:r,ownSchemaName:e}})()}_createRelationPathItem(e,t){const r=/(?<joinType>.*)\[(?<refSchema>.*?):(?<ownColumn>.*?)(?::(?<refColumn>.*))?]/.exec(t);if(r){const n=r.groups;return this._createRelationPathItemFromJoinPathItem(e,n.refSchema,n.refColumn,n.ownColumn)}return this._createRelationPathItemFromForwardPathItem(e,t)}_getReverseRelationPath(e){const t=[...e],s=[];let r;for(;(r=t.pop())!=null;)s.push({isJoin:!0,ownSchemaName:r.referenceSchemaName,ownSchemaAttributeName:r.referenceAttributeName,referenceSchemaName:r.ownSchemaName,referenceAttributeName:r.ownSchemaAttributeName});return s}_buildRelationPath(e,t){var s=this;return(0,C.A)(function*(){const r=t.split("."),n=[];let a=e;for(const u of r){const d=yield s._createRelationPathItem(a,u);a=d.referenceSchemaName,n.push(d)}return n})()}_getRelationPathToSourceSchema(e,t,s){var r=this;return(0,C.A)(function*(){const n=[...t],a=n.pop(),u=s.split("."),h=(yield r._buildRelationPath(e,s)).pop(),g={isJoin:!0,ownSchemaName:a.isJoin?a.referenceSchemaName:a.ownSchemaName,ownSchemaAttributeName:a.isJoin?a.referenceAttributeName:a.ownSchemaAttributeName,referenceSchemaName:h.ownSchemaName,referenceAttributeName:u.pop()},b=[...n,...a.isJoin?[a]:[],g];return r._featureValues.DisableDsDepsJoinOptimization||b.length===1?b:b.filter(M=>{if(!M.isJoin)return!0;const Z=M.ownSchemaName===M.referenceSchemaName,Y=M.ownSchemaAttributeName===M.referenceAttributeName;return!(Z&&Y)})})()}_buildRelationDataFromPath(e){return e.map(t=>({attributeName:t.ownSchemaAttributeName,referenceAttributeName:t.referenceAttributeName,referenceSchemaName:t.referenceSchemaName}))}_getDataSourceParameterRelationData(e,t){var s=this;return(0,C.A)(function*(){const r=yield s._buildRelationPath(t.dataSchemaName,t.relationPath),n=yield s._getRelationPathToSourceSchema(e,r,t.attributePath),a=s._getReverseRelationPath(n);return s._buildRelationDataFromPath(a)})()}_convertEntityDataSourceParameter(e,t){var s=this;return(0,C.A)(function*(){if(!t.relationsConfigs||t.relationsConfigs.length===0)return t;let r=e.name;const n=[];for(const a of t.relationsConfigs){const u=yield s._getDataSourceParameterRelationData(r,a);r=u[u.length-1].referenceSchemaName,n.push({...a,relationData:u})}return{...t,relationsConfigs:n}})()}convert(e,t,s=!1){return t.length===0?Promise.resolve([]):s?Promise.resolve(t):Promise.all(t.map(r=>this._convertEntityDataSourceParameter(e,r)))}static#e=this.\u0275fac=function(t){return new(t||Or)(c.\u0275\u0275inject(st),c.\u0275\u0275inject(E))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Or,factory:Or.\u0275fac,providedIn:"root"})}class ms{constructor(e,t){this._dataSchemaRepository=e,this._parametersConverter=t}_createPrimaryColumnValueFilter(e,t){const n=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(n).pipe((0,l.map)(a=>{const u=new X({columnPath:a.primaryAttributeName}),d=new ae({value:t.value});return new Re(ne.Equal,u,d)}))}_createColumnValueFilter(e){const t=e.value.attributePath,s=e.value.attributeValue,r=new X({columnPath:t}),n=new ae({value:s}),a=new Re(ne.Equal,r,n);return(0,l.of)(a)}_createPrimaryDisplayValueFilter(e,t){const n=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(n).pipe((0,l.map)(a=>{const u=new X({columnPath:a.primaryDisplayAttributeName}),d=new ae({value:t.value});return new Re(t.comparisonType,u,d)}))}_createCustomFilter(e){let t={};return e.value&&(t=typeof e.value=="string"?JSON.parse(e.value):e.value),(0,l.of)(t)}_createEmptyParameterFiler(e){const t=e.relationsConfigs||[];if(t.length===0)return(0,l.of)({});const s=t[0];return this._dataSchemaRepository.get(s.dataSchemaName).pipe((0,l.map)(r=>r.primaryAttributeName),(0,l.map)(r=>{const n=new X({columnPath:r});return new kt(n,null)}))}_createEsqFilter(e,t){switch(t.type){case F.PrimaryColumnValue:return this._createPrimaryColumnValueFilter(e,t);case F.ColumnValue:return this._createColumnValueFilter(t);case F.PrimaryDisplayValueFilter:return this._createPrimaryDisplayValueFilter(e,t);case F.Filter:return this._createCustomFilter(t);case F.Empty:return this._createEmptyParameterFiler(t)}}applyParameters(e,t){if(e.length===0)return(0,l.of)(t);const s=e.map(r=>this._createEsqFilter(t.rootSchemaName,r).pipe((0,l.map)(n=>new Jd().convertToRelatedFilter(n,r.relationsConfigs))));return(0,l.forkJoin)(s).pipe((0,l.tap)(r=>{r.forEach(n=>{(0,D.isEmpty)(n)||t.filters.add(n)})}),(0,l.map)(()=>t))}convertToEntityDataSourceParameters(e,t,s=!1){return(0,l.from)(this._parametersConverter.convert(e,t,s))}static#e=this.\u0275fac=function(t){return new(t||ms)(c.\u0275\u0275inject(st),c.\u0275\u0275inject(Or))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ms,factory:ms.\u0275fac,providedIn:"root"})}class fs{constructor(e,t,s){this.entitySchemaQueryUtils=e,this._entitySchemaColumnAppenderFactory=t,this._dataSchemaToDataSourceAttributeConverter=s}_addPagingToEsq(e,t){t&&(e.rowsOffset=t.rowsOffset,e.rowCount=t.rowCount)}_addSortingToEsq(e,t){t&&t.columns.forEach((s,r)=>{const n=e.findColumn(s.columnName),a=Zd(s.direction);n?n.withOrdering(a,r):e.addSchemaColumn(s.columnName).withOrdering(a,r)})}_addIsDistinctToEsq(e,t){t&&(e.isDistinct=!0)}_addColumnToEsq(e,t){t.filter(Boolean).forEach(s=>{this._entitySchemaColumnAppenderFactory.create(s).addColumn(e,s)})}_prepareAttributePairsForLoad(e,t){return t.map(s=>{if(typeof s=="string"){const r=s,n=e.attributes.find(a=>a.name===r);return n?this._dataSchemaToDataSourceAttributeConverter.create(n.attributeType).convert(n):{name:r,path:r}}else return s})}build(e,t,s,r){if(s.some(n=>n.type===F.Never))throw new Error('Failed to build entity schema query: parameters contains "Never" model parameter.');return(0,l.forkJoin)([this.entitySchemaQueryUtils.convertToEntityDataSourceParameters(e,s),(0,l.of)(this._prepareAttributePairsForLoad(e,t))]).pipe((0,l.map)(([n,a])=>({esq:new xr(e.name),esqParameters:n,dataSourceAttributes:a})),(0,l.tap)(({esq:n,dataSourceAttributes:a})=>this._addColumnToEsq(n,a)),(0,l.tap)(({esq:n})=>this._addSortingToEsq(n,r?.sortingConfig)),(0,l.tap)(({esq:n})=>this._addPagingToEsq(n,r?.pagingConfig)),(0,l.tap)(({esq:n})=>this._addIsDistinctToEsq(n,r?.isDistinct)),(0,l.switchMap)(({esq:n,esqParameters:a})=>this.entitySchemaQueryUtils.applyParameters(a,n)))}static#e=this.\u0275fac=function(t){return new(t||fs)(c.\u0275\u0275inject(ms),c.\u0275\u0275inject(pu),c.\u0275\u0275inject(mu))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:fs,factory:fs.\u0275fac,providedIn:"root"})}const ra=i=>{switch(i){case v.r.Guid:return v.r.Guid;case v.r.Text:case v.r.SHORT_TEXT:case v.r.PHONE_TEXT:case v.r.WEB_TEXT:case v.r.EMAIL_TEXT:case v.r.MEDIUM_TEXT:case v.r.MAXSIZE_TEXT:case v.r.LONG_TEXT:case v.r.HASH_TEXT:case v.r.SECURE_TEXT:case v.r.RICH_TEXT:return v.r.Text;case v.r.Integer:case v.r.Enum:return v.r.Integer;case v.r.Float:case v.r.FLOAT1:case v.r.FLOAT2:case v.r.FLOAT3:case v.r.FLOAT4:case v.r.FLOAT8:case v.r.Money:return v.r.Float;case v.r.DateTime:case v.r.Date:case v.r.Time:return v.r.DateTime;case v.r.Lookup:case v.r.IMAGELOOKUP:return v.r.Lookup;case v.r.Boolean:return v.r.Boolean;case v.r.Blob:return v.r.Blob;case v.r.Image:return v.r.Image;case v.r.Color:return v.r.Color;default:throw new Error(`Type ${i} not implemented`)}};function bm(i,e=null,t=DataValueType.Float){if(!i||i.length===0)return e;if(i.length===1)return i[0];let s=i.map(r=>ra(r)).map(r=>DataValueTypeGroup.Number.includes(r)?t:r);return s=[...new Set(s)],s.length===1?s[0]:e}class Yd extends Ji{constructor(){super(...arguments),this.supportTransactions=!0}}class Lr extends Yd{get isForceUpdateUnchangedData(){return!!this.initialConfig?.isForceUpdateUnchangedData}get affectedAttributes(){return[...this._affectedAttributes]}get isAggregate(){return this.dataSchema?this.dataSchema.attributes.some(t=>t.isAggregate):!1}constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._affectedAttributes=[],this._errorReferenceAttributes=[],this.type=ou,this._featureValues=t.get(E),this._queryExecutor=t.get(Ne),this._entitySchemaService=t.get(ft),this._httpClient=this.injector.get(V.HttpClient),this._rightsService=this.injector.get(ea),this.dataSchemaRepository=this.injector.get(st),this._entitySchemaRepository=this.injector.get(Ye),this._entitySchemaQueryBuilder=this.injector.get(fs),this._entitySchemaQueryUtils=this.injector.get(ms),this._window=this.injector.get(P.ZP),this._measurePerformanceService=this.injector.get(ge);const s=this.injector.get(Ue.oq);this._entityDefaultValuesUrl=s.isSSP?"/ssp/rest/EntitySchemaService/GetEntityDefaultValues":"/rest/EntitySchemaService/GetEntityDefaultValues",this.translateService=this.injector.get(O.TranslateService)}_buildSelectEsq(e,t,s){return this.getSchema().pipe((0,o.switchMap)(r=>this._entitySchemaQueryBuilder.build(r,e,t,s)),(0,o.map)(r=>(this._featureValues["DataSource-DisableRecordDeactivation"]!==!0&&(r.useRecordDeactivation=this.initialConfig.useRecordDeactivation),r.adminUnitRoleSources=this._getEsqAdminUnitRoleSources(),r)))}_getEsqAdminUnitRoleSources(){let e;const t=this.initialConfig.adminUnitRoleSources;return(0,D.isNumber)(t)?t:((0,D.isArray)(t)&&t.forEach(s=>{const r=Xi[s];(0,D.isNumber)(r)&&(e=e|r)}),e)}_normalizeValue(e,t){switch(t){case v.r.Lookup:return e||null;case v.r.Date:case v.r.Time:case v.r.DateTime:return e instanceof Date?Wc(e):typeof e=="string"&&Date.parse(e)>0?`"${e}"`:e;default:return e}}_buildUpdateEsq(e,t){return this.getSchema().pipe((0,o.switchMap)(s=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(s,e,!0)),(0,o.map)(s=>({updateQuery:new Yi(this._entitySchemaName),esqParameters:s})),(0,o.tap)(({updateQuery:s})=>{s.isForceUpdate=!!this.initialConfig.isForceUpdate,Object.keys(t).forEach(r=>{const n=this._findEntitySchemaColumn(r);if(!n)throw new Error(`Column ${r} not found`);const a=t[r];this._isEntityColumnValue(a)&&s.addColumn(n.name,this._normalizeValue(a,n.dataValueType),ra(n.dataValueType))})}),(0,o.switchMap)(({updateQuery:s,esqParameters:r})=>this._entitySchemaQueryUtils.applyParameters(r,s)),(0,o.catchError)(s=>(0,l.throwError)(()=>s)))}_buildInsertEsq(e){const t=new Qi(this._entitySchemaName);return Object.keys(e).forEach(s=>{const r=this._findEntitySchemaColumn(s);if(!r)throw new Error(`Column ${s} not found`);const n=e[s];this._isEntityColumnValue(n)&&t.addColumn(r.name,this._normalizeValue(n,r.dataValueType),ra(r.dataValueType))}),t}_buildDeleteEsq(e){return this.getSchema().pipe((0,o.switchMap)(t=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(t,e,!0)),(0,o.switchMap)(t=>{const s=new lu(this._entitySchemaName);return this._entitySchemaQueryUtils.applyParameters(t,s)}))}_checkOwnAttributes(e){return this.getSchema().pipe((0,o.switchMap)(t=>{const s=t.attributes.filter(r=>r.attributeType!==z.OwnAttribute).filter(r=>!(0,D.isUndefined)(e[r.name]));return s.length!==0?(0,l.throwError)(()=>new Error(`Not valid attributes for this data source: ${s.map(r=>r.name).join(",")}`)):(0,l.of)(null)}))}_findEntitySchemaColumn(e){return this._entitySchema.columns.find(t=>t.name===e)}_isEntityColumnValue(e){const t=s=>typeof s=="object"&&(s===null||"value"in s);return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"||e instanceof Date||t(e)}_parseDefaultValues(e,t){const s=new Map(e.attributes.map(r=>[r.name,r.dataValueType]));return t.reduce((r,n)=>{const{defaultValue:a,name:u}=n;if((0,D.isNil)(a.value))return r;if(a.displayValue)return{...r,[u]:a};const d=ta(a.value,s.get(u));return{...r,[u]:d}},{})}_getDefaultValues(e){const t=`${this._entityDefaultValuesUrl}?entityName=${e}`;return this._httpClient.get(t).pipe((0,o.catchError)(s=>this._catchErrorResponse(s)),(0,o.map)(s=>s.GetEntityDefaultValuesResult),(0,o.mergeMap)(s=>this.getSchema().pipe((0,o.tap)(r=>{let n=this._window.defaultValueStorage;const a=s?.find(u=>u.name===r.primaryAttributeName)?.defaultValue?.value;if(n=n||{},a){const u=`${e}_${a}`;n[u]=s,this._window.defaultValueStorage=n}}),(0,o.map)(r=>this._parseDefaultValues(r,s)))))}_catchErrorResponse(e){return console.log(e),(0,l.of)({GetEntityDefaultValuesResult:[]})}_requestEntitySchemaColumnsInfo(e){const t=e.map(s=>s.attributePath);return this._entitySchemaService.getEntitySchemaColumnsInformationByPathsArray(this._entitySchema.uId,t).pipe((0,o.map)(s=>e.map(r=>({column:s[r.attributePath],config:r}))))}_getEntitySchemaForwardReferenceColumnsInfo(e){const t={name:this._entitySchemaName,loadLookupColumns:!1,forwardReferencePaths:e.map(s=>s.attributePath)};return this._entitySchemaRepository.getSchemes([t]).pipe((0,o.map)(()=>e.map(s=>{const r=s.attributePath.split("."),n=this._entitySchemaRepository.findEntitySchemaColumnByPath(this._entitySchemaName,r);return{column:new Ki(n),config:s}})))}_createReferenceAttributes(e,t){return t.length===0?(0,l.of)(e):(0,l.of)(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"]).pipe((0,o.switchMap)(s=>s?this._requestEntitySchemaColumnsInfo(t):this._getEntitySchemaForwardReferenceColumnsInfo(t))).pipe((0,o.tap)(s=>{s.forEach(({column:r,config:n})=>{n.attributeType===z.AggregationAttribute&&n.aggregationConfig?.aggregationFunction===et.Count&&(r.dataValueType=v.r.Integer),e.addAttribute(r,n)})}),(0,o.map)(()=>e))}_createAttributesFromInitialConfig(e,t={}){const s=[];return Object.entries(t).forEach(([r,n])=>{const a=n;a.type===z.ForwardReferenceAttribute&&s.push({attributeName:r,attributeType:z.ForwardReferenceAttribute,attributePath:a.path}),a.type===z.AggregationAttribute&&s.push({attributeName:r,attributeType:z.AggregationAttribute,attributePath:a.path,aggregationConfig:a.aggregationConfig}),a.type===z.FunctionAttribute&&s.push({attributeName:r,attributeType:z.FunctionAttribute,attributePath:a.path,functionConfig:a.functionConfig})}),this._createReferenceAttributes(e,s).pipe((0,o.catchError)(r=>{const n=r.message&&r.toString(),a=new Pd(this,n);return this._errors.push(a),s.forEach(u=>{this._errorReferenceAttributes.push(u)}),(0,l.of)(e)}))}_shouldSkipLoad(e){return e.some(t=>t.type===F.Never)}_setValidValuesForLookupAttributes(e,t){return Object.keys(t).forEach(s=>{const r=e.attributes.find(n=>n.name===s);r&&(r.dataValueType===v.r.Lookup||r.dataValueType===v.r.IMAGELOOKUP)&&t[s]===""&&(t[s]=null)}),t}_throwErrorResponse(e){const t=typeof e=="string"?e:e?.message;return(0,l.throwError)(()=>({success:!1,rowsAffected:0,errorInfo:t}))}_mapOperationResult(e){return{success:e.success,rowsAffected:e.rowsAffected}}_getIsAffectedAttributeStored(e){return this._affectedAttributes.some(t=>t.path===e.path&&t.schemaName===e.schemaName)}_collectUsedAttributes(e){let t=e._getUsedColumns();t=t.filter(s=>!this._getIsAffectedAttributeStored(s)),this._affectedAttributes.push(...t)}_findErrorReferenceAttribute(e){const t=typeof e=="string"?e:e.name;return this._errorReferenceAttributes.find(s=>s.attributeName===t)}_load(e,t,s,r){if(this.hasErrors){if(this.hasCriticalErrors)return(0,l.throwError)(()=>this.getLastError());if(e.length!==0&&e.every(a=>this._findErrorReferenceAttribute(a)!=null))return(0,l.throwError)(()=>this.getLastError())}return this._shouldSkipLoad(t)?(0,l.of)([]):this._buildSelectEsq(e,t,s||{}).pipe((0,o.tap)(n=>this._collectUsedAttributes(n)),(0,o.switchMap)(n=>{let a;const u={throttled:s?.throttled};return r?(n.queryId=r.id,a=this._queryExecutor.executeSelectQuery(n,u,r.transactionId),r.markAsReady()):a=this._queryExecutor.executeSelectQuery(n,u),a.pipe(this._measurePerformanceService.measure$(`EntityDataSource.load.executeSelectQuery.${this.dataSourceName}`),(0,o.catchError)(()=>(0,l.throwError)(()=>new Error(this.translateService.instant("BaseViewModel.LoadingModelErrorMessage")))))}),(0,o.map)(n=>n),(0,o.mergeMap)(n=>this.getSchema().pipe((0,o.map)(a=>(a.attributes&&n.forEach(u=>{this._setValidValuesForLookupAttributes(a,u)}),n)))))}_save(e,t,s){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this._checkOwnAttributes(t).pipe((0,o.switchMap)(()=>this._buildUpdateEsq(e,t)),(0,o.switchMap)(r=>{if(s){r.queryId=s.id;const n=this._queryExecutor.executeUpdateQuery(r,s.transactionId);return s.markAsReady(),n}return this._queryExecutor.executeUpdateQuery(r)}),(0,o.map)(r=>this._mapOperationResult(r)),(0,o.catchError)(r=>this._throwErrorResponse(r)))}_insert(e,t){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this._checkOwnAttributes(e).pipe((0,o.map)(()=>this._buildInsertEsq(e)),(0,o.switchMap)(s=>{let r;return t?(s.queryId=t.id,r=this._queryExecutor.executeInsertQuery(s,t.transactionId),t.markAsReady()):r=this._queryExecutor.executeInsertQuery(s),(0,l.forkJoin)({response:r,dataSchema:this.getSchema()})}),(0,o.map)(({response:s,dataSchema:r})=>({...this._mapOperationResult(s),primaryAttributes:[{[r.primaryAttributeName]:s.id}]})),(0,o.catchError)(s=>this._throwErrorResponse(s)))}_delete(e,t){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this._buildDeleteEsq(e).pipe((0,o.tap)(s=>{s.queryId=t?.id}),(0,o.switchMap)(s=>{if(t){s.queryId=t.id;const r=this._queryExecutor.executeDeleteQuery(s,t.transactionId);return t.markAsReady(),r}return this._queryExecutor.executeDeleteQuery(s)}),(0,o.map)(s=>this._mapOperationResult(s)),(0,o.catchError)(s=>this._throwErrorResponse(s)))}innerLoad(e,t,s){return this._load(e,t,s)}innerSave(e,t){return this._save(e,t)}innerInsert(e){return this._insert(e)}innerDelete(e){return this._delete(e)}innerGetSchema(){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this.dataSchemaRepository.get(this._entitySchemaName).pipe((0,o.map)(e=>new hu(e)),(0,o.switchMap)(e=>this._createAttributesFromInitialConfig(e,this.initialConfig.attributes)),(0,o.tap)(e=>{const t=this._getDefaultValues(this._entitySchemaName).pipe((0,o.shareReplay)({bufferSize:1,refCount:!0}));e.setAttributesDefaultValue(t)}),(0,o.map)(e=>e.build()))}innerGetLookupDataSchema(e){if(this.hasCriticalErrors)return(0,l.throwError)(()=>this.getLastError());const s=e.split(".")[0],r=this._findEntitySchemaColumn(s);return r?r.dataValueType!==v.r.Lookup?(0,l.throwError)(()=>new Error(`DataValueType for column '${s}' isn't lookup`)):r.referenceSchemaName?this.dataSchemaRepository.get(r.referenceSchemaName):(0,l.throwError)(()=>new Error(`referenceSchemaName for column '${s}' is absent`)):(0,l.throwError)(()=>new Error(`Can't find column with name '${s}'`))}innerGetDefaultValues(){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this._getDefaultValues(this._entitySchemaName)}innerCanDelete(e){return this.hasCriticalErrors?(0,l.of)({result:!1}):this._rightsService.getCanDelete({schemaName:this.initialConfig.entitySchemaName,primaryColumnValue:e.primaryColumnValue})}innerCanCreate(e){if(this.hasCriticalErrors)return(0,l.of)({result:!1});const t={isNew:!0,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}innerCanEdit(e){if(this.hasCriticalErrors)return(0,l.of)({result:!1});const t={primaryColumnValue:e.primaryColumnValue,isNew:!1,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}getEmptySchema(){return this._entitySchemaName?new gt({name:this._entitySchemaName}):super.getEmptySchema()}init(e,t){return super.init(e,t).pipe((0,o.mergeMap)(s=>{if(!this.initialConfig.entitySchemaName){const r=new kd(this);return this._errors.push(r),(0,l.throwError)(()=>r)}return(0,l.of)(s)}),(0,o.tap)(()=>this._entitySchemaName=this.initialConfig.entitySchemaName),(0,o.mergeMap)(s=>this._entitySchemaRepository.getSchemaByName(this.initialConfig.entitySchemaName).pipe((0,o.tap)(r=>this._entitySchema=r),(0,o.catchError)(()=>{this._entitySchema=new nu,this._entitySchema.name=this._entitySchemaName,this._entitySchema.columns=[];const r=new Bd(this,this._entitySchemaName);return this._errors.push(r),(0,l.throwError)(()=>r)}),(0,o.map)(()=>s))))}getOwnLoadParameters(){return this.initialConfig?.loadParameters}getAllowCopyingRecords(){return this.initialConfig?.allowCopyingRecords}loadInTransaction(e,t,s,r){return this._load(t,s,r,e)}saveInTransaction(e,t,s){return this._save(t,s,e)}insertInTransaction(e,t){return this._insert(t,e)}deleteInTransaction(e,t){return this._delete(t,e)}}class Qd extends Lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotActionDataSource",this._intentManager=this.injector.get(Bt)}_getActionUId(e){return e.filter(s=>s.type===F.PrimaryColumnValue)[0]?.value}innerDelete(e){return(0,l.of)(void 0)}innerInsert(e){const t=e;return(0,l.forkJoin)([this._intentManager.createAction(t),this.getSchema()]).pipe((0,l.map)(([s,r])=>({success:s.success,rowsAffected:1,errorInfo:s.errorInfo?.message,primaryAttributes:s.success?[{[r.primaryAttributeName]:t.Id}]:null})))}innerLoad(e,t,s){const r=this._getActionUId(t);return r?this._intentManager.getActionByUId(r).pipe((0,l.map)(n=>[n])):(0,l.of)([])}innerSave(e,t){const s=this._getActionUId(e),r=t;return r.Id=s,this._intentManager.updateAction(r).pipe((0,l.map)(n=>({success:n.success,rowsAffected:1,errorInfo:n.errorInfo?.message})))}}class fu{}const eh="CopilotIntentStatus",th=new Map([["InDevelopment","4670b068-ad03-4364-9350-6cc61efd1b7f"],["Active","1d73b111-07a9-49e2-aa15-c9415cce7470"],["Deactivated","2c547e71-7a05-42e1-8b65-2bf63f200156"]]),sh="CopilotIntentMode",rh={Chat:"Chat",Api:"API"},nh=new Map([["Chat","326bba59-302a-4a5e-857c-2576e1a38ab0"],["API","5f2dc095-4543-4972-b6bc-6599bf6bc3fd"]]),gu={System:{value:"35f3b644-4fa3-4d1e-8e62-5c3fdc4d3e52",displayValue:"System",primaryColorValue:"#22AC14"},Skill:{value:"6d940b75-21c8-4a90-89ab-9867e6e4a045",displayValue:"Skill",primaryColorValue:"#7848EE"},Agent:{value:"a8fbe253-be1b-4ec4-bc58-65b8047013da",displayValue:"Agent",primaryColorValue:"#E67E22"}};function ih(){return(0,l.of)(Object.values(gu))}class Br{constructor(e){this._entitySchemaService=e}_loadPrimaryColumns(e){return this._entitySchemaService.getEntitySchemaByName(e).pipe((0,o.map)(t=>{const s=t.entitySchema.getPrimaryColumn(),r=t.entitySchema.getPrimaryDisplayColumn();if((0,D.isEmpty)(r))throw new Error(`Entity ${e} should have primary display column`);return{primaryColumnName:s.name,primaryDisplayColumnName:r?.name}}))}getColumnLookupValues(e){if((0,D.isEmpty)(e))return(0,l.of)(null);const t=this._loadPrimaryColumns(e),s=(0,l.from)(_t.create(e));return(0,l.forkJoin)([t,s]).pipe((0,o.switchMap)(([r,n])=>(0,l.from)(n.load({attributes:[r.primaryColumnName,r.primaryDisplayColumnName]})).pipe((0,o.map)(u=>u.map(d=>({value:d[r.primaryColumnName],displayValue:d[r.primaryDisplayColumnName]}))))))}static#e=this.\u0275fac=function(t){return new(t||Br)(c.\u0275\u0275inject(ft))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Br,factory:Br.\u0275fac,providedIn:"root"})}class kr{constructor(e,t){this._columnLookupValuesService=e,this._injector=t,this._intentStatuses=th,this._intentModes=nh}convertToDataSourceModel(e){const t=this._injector.get(fu);return(0,l.combineLatest)([this._columnLookupValuesService.getColumnLookupValues(eh),this._columnLookupValuesService.getColumnLookupValues(sh),ih(),t.getAllLlmModels()]).pipe((0,l.map)(([s,r,n])=>{const a=this._intentStatuses.get(e.Status),u=s.find(Y=>Y.value===a),d=this._intentModes.get(e.Mode)??this._intentModes.get(rh.Chat),h=r.find(Y=>Y.value===d),g=n.find(Y=>Y.displayValue===e.Type),b=t.getModelByCodeSync(e.LlmModel),M={Id:e.UId,Code:e.Code,Description:e.Description,Prompt:e.Prompt,Type:g,Name:e.Title,Status:u,PackageUId:e.PackageUId,LlmModel:b?{value:b.Id,displayValue:b.Name}:null};return e.Type==="Agent"?{...M,Restrictions:e.Restrictions,RoleDescription:e.RoleDescription}:{...M,Mode:h}}))}convertToModel(e){const t={};for(const[s,r]of Object.entries(e)){let n=s,a=r;s==="Name"&&(n="Title"),s==="Id"&&(n="UId"),s==="Status"&&(a=[...this._intentStatuses].filter(([,u])=>u===e.Status.value).map(([u])=>u).shift()),s==="Mode"&&(a=[...this._intentModes].filter(([,u])=>u===e.Mode.value).map(([u])=>u).shift()),s==="Type"&&(a=Object.values(gu).filter(u=>u.value===e.Type.value).map(u=>u.displayValue).shift()),s==="LlmModel"&&(a=this._injector.get(fu).getModelByNameSync(e.LlmModel?.displayValue)?.Code),t[n]=a}return t}static#e=this.\u0275fac=function(t){return new(t||kr)(c.\u0275\u0275inject(Br),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:kr,factory:kr.\u0275fac,providedIn:"root"})}class ah extends Lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._defaultValuesMap=new Map,this.type="crt.CopilotIntentDataSource",this._intentManager=this.injector.get(Bt),this._copilotIntentDataSourceModelConvertor=this.injector.get(kr),this._initDefaultValuesMap()}_initDefaultValuesMap(){this._defaultValuesMap.set("CopilotIntent",{UId:(0,L.qv)(),Status:"Active",Mode:"Chat",Type:"Skill",Prompt:this.translateService.instant("CopilotIntentDataSource.DefaultValues.Prompt")}),this._defaultValuesMap.set("CopilotAgent",{UId:(0,L.qv)(),Status:"Active",Type:"Agent"})}innerGetDefaultValues(){const e=this.initialConfig.entitySchemaName,t=this._defaultValuesMap.get(e);return this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(t)}innerInsert(e){const t=this._copilotIntentDataSourceModelConvertor.convertToModel({...e});return(0,l.forkJoin)([this._intentManager.createIntent(t),this.getSchema()]).pipe((0,l.map)(([s,r])=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message,primaryAttributes:[{[r.primaryAttributeName]:s.schemaUid}]})),(0,o.switchMap)(s=>s.success?(0,l.of)(s):(0,l.throwError)(()=>s)))}innerLoad(e,t,s){const r=t.filter(n=>n.type===F.PrimaryColumnValue);if(r.length)return this._intentManager.getIntent(r[0].value).pipe((0,o.switchMap)(n=>this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(n).pipe((0,l.map)(a=>[a]))))}innerSave(e,t){const r=e.filter(a=>a.type===F.PrimaryColumnValue)[0].value,n=this._copilotIntentDataSourceModelConvertor.convertToModel({...t});return n.UId=r,this._intentManager.updateIntent(n).pipe((0,l.map)(a=>({success:a.success,rowsAffected:a.success?1:0,errorInfo:a.errorInfo?.message})),(0,o.switchMap)(a=>a.success?(0,l.of)(a):(0,l.throwError)(()=>a)))}}class oh{static fromJson(e){throw new Error("not implemented")}}class ch{static resolve(e){return{[ie.Compare]:Re,[ie.FilterGroup]:_e,[ie.In]:Ft,[ie.IsNull]:Qe,[ie.Exists]:kt,[ie.Between]:Ir}[e]}}class uh{static fromJson(e,t){throw new Error("not implemented")}}class lh{static resolve(e){return{[be.Macros]:jt,[be.Length]:Nr,[be.Window]:Vr,[be.DatePart]:$t,[be.DateAdd]:$t,[be.DateDiff]:$t}[e.functionType]}}class dh{static resolve(e,t){return{[fe.SchemaColumn]:X,[fe.Parameter]:ae,[fe.SubQuery]:Pr,[fe.ArithmeticOperation]:Dr,[fe.Function]:lh.resolve(t)}[e]}}class na extends uh{static fromJson(e,t){const s=e.expressionType;return dh.resolve(s,e).fromJson(e,t,na)}}class qn extends oh{static fromJson(e){const t=e.filterType,s=e.isEnabled,r=e.trimDateTimeParameterToDate,n=ch.resolve(t).fromJson(e,qn,na);return n.isEnabled=s!==!1,n.trimDateTimeParameterToDate=r===!0,n}}class Fr{convertToDataSourceModel(e){return(0,l.of)({Id:e.UId,Intent:e.Intent,Code:e.Code,Name:e.Name,Description:e.Description,SourceCollection:e.SourceCollection,DataValueTypeUId:e.DataValueTypeUId})}convertToModel(e){const t={};return Object.entries(e).forEach(([s,r])=>{s==="Id"&&(s="UId"),t[s]=r}),t}static#e=this.\u0275fac=function(t){return new(t||Fr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Fr,factory:Fr.\u0275fac,providedIn:"root"})}class hh extends Lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotIntentParameterDataSource",this._intentManager=this.injector.get(Bt),this._modelConvertor=this.injector.get(Fr)}_getPrimaryColumnParameter(e){return e.find(t=>t.type===F.PrimaryColumnValue&&(0,L.n7)(t.value))}_getIsIntentUIdParameter(e){return(e.relationsConfigs??[]).some(t=>t.dataSchemaName==="CopilotIntent"&&t.attributePath==="Intent")}_getSourceCollectionFilterValue(e){const t=e.find(n=>n.type===F.Filter);if(!t?.value)return null;const s=qn.fromJson(t.value);let r;return s.filters.forEach(n=>{n instanceof Re&&n.leftExpression instanceof X&&n.leftExpression.columnPath==="SourceCollection"&&n.rightExpression instanceof ae&&(r=n.rightExpression.value)}),r}innerGetDefaultValues(){return this._modelConvertor.convertToDataSourceModel({UId:(0,L.qv)()})}innerInsert(e){const t=this._modelConvertor.convertToModel({...e});return this._intentManager.createIntentParameter(t).pipe((0,l.map)(s=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message,primaryAttributes:[{Id:t.UId}]})),(0,l.switchMap)(s=>s.success?(0,l.of)(s):(0,l.throwError)(()=>s)))}innerLoad(e,t,s){const r=this._getPrimaryColumnParameter(t),n=this._getSourceCollectionFilterValue(t)??"InputParameters";return r?(this._getIsIntentUIdParameter(r)?this._intentManager.getIntentParameters(r.value,n):this._intentManager.getIntentParameter(r.value).pipe((0,l.map)(u=>[u]))).pipe((0,l.mergeMap)(u=>(0,l.from)(u).pipe((0,l.mergeMap)(d=>this._modelConvertor.convertToDataSourceModel(d)),(0,l.toArray)())),(0,l.catchError)(()=>(0,l.of)([]))):(0,l.of)([])}innerSave(e,t){const s=this._getPrimaryColumnParameter(e)?.value,r=this._modelConvertor.convertToModel({...t});return r.UId=s,this._intentManager.updateIntentParameter(r).pipe((0,l.map)(n=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message})),(0,l.switchMap)(n=>n.success?(0,l.of)(n):(0,l.throwError)(()=>n)))}innerDelete(e){const t=this._getPrimaryColumnParameter(e)?.value;return this._intentManager.deleteIntentParameter(t).pipe((0,l.map)(s=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message})),(0,l.switchMap)(s=>s.success?(0,l.of)(s):(0,l.throwError)(()=>s)))}}class ph extends Lr{innerDelete(e){return(0,l.of)(null)}innerInsert(e){return(0,l.of)(null)}innerLoad(e,t){return(0,l.of)([])}innerSave(e,t){return(0,l.of)(null)}innerGetLookupDataSchema(e){return(0,l.of)(null)}innerGetDefaultValues(){return(0,l.of)(null)}innerCanDelete(e){return(0,l.of)(null)}innerCanEdit(e){return(0,l.of)(null)}innerCanCreate(e){return(0,l.of)(null)}}function Sm(i){const e=Object.keys(DataValueTypeGroup).find(t=>DataValueTypeGroup[t].includes(i));return DataValueTypeGroup[e]}function Cm(i){return i===DataValueType.Lookup||i===DataValueType.Guid}function Am(i){return DataValueTypeItems[i]?.icon||null}function ia(i){return Object.values(Bn.Q).find(e=>e.name===i)?.type}function mh(i){return!(i&&!i?.value)}var Ve;(function(i){i.Create="create",i.Update="update",i.Delete="delete"})(Ve||(Ve={}));const aa=window;class jr{constructor(){this._event$=new l.Subject}static get instance(){return aa.__modelEventNotificationService||(aa.__modelEventNotificationService=new jr),aa.__modelEventNotificationService}get event$(){return this._event$.asObservable()}notify(e){this._event$.next(e)}}class $r{constructor(){this.changedValues$=new l.Subject,this._valuesStore={}}setValues(e){if(e){const t={};Object.entries(e).forEach(([s,r])=>{const n=this._valuesStore[s]!==r;this._valuesStore[s]=(0,D.cloneDeep)(r),n&&(t[s]=this._valuesStore[s])}),(0,D.isEmpty)(t)||this.changedValues$.next(t)}}get values(){return this._valuesStore}static#e=this.\u0275fac=function(t){return new(t||$r)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:$r,factory:$r.\u0275fac})}const _u="PrimaryValue",yu="DisplayValue",oa="PrimaryColorValue";class Ur{constructor(e,t){this._queryExecutor=e,this._entitySchemaRepository=t}_getInFilter(e){const t=new jt({macrosType:ls.PrimaryColumn});return new Ft(ne.Equal,t,e.map(s=>new ae({value:s})))}_getEsq(e,t){const s=new xr(e);return this._entitySchemaRepository.getSchemaByName(e).pipe((0,o.map)(r=>{s.addMacrosFunctionColumn(ls.PrimaryColumn,_u),s.addMacrosFunctionColumn(ls.PrimaryDisplayColumn,yu);const n=r.getPrimaryColorColumn();n&&s.addSchemaColumn(n.name,oa);const a=this._getInFilter(t);return s.filters.add(a),s}))}_getSchemaLookupData(e,t){const s={};for(let r=0;r<t.length;r++){const n=t[r],[a,u]=e[r];s[a]={};for(const d of u){const h=n.find(g=>g[_u]===d);if(h){const g=[h[yu]];h[oa]&&g.push(h[oa]),s[a][d]=h?g:null}}}return s}load(e){const t=Object.entries(e);return(0,l.forkJoin)(t.map(([s,r])=>this._getEsq(s,r))).pipe((0,l.switchMap)(s=>this._queryExecutor.executeBatchSelectQuery(s).pipe((0,o.map)(r=>this._getSchemaLookupData(t,r)))))}static#e=this.\u0275fac=function(t){return new(t||Ur)(c.\u0275\u0275inject(Ne),c.\u0275\u0275inject(Ye))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ur,factory:Ur.\u0275fac,providedIn:"root"})}class fh extends Ji{constructor(e,t){super(e,t),this.dataSourceName=e,this._injector=t,this.type=cu,this._schemaParametersStore=this._injector.get($r),this._lookupDataLoadService=this._injector.get(Ur),this._featureValues=this._injector.get(E),this._featureValues.DisableCommunicationBetweenSchemas||this._subscribeParametersChanged()}_subscribeParametersChanged(){this._schemaParametersStore.changedValues$.subscribe(e=>{jr.instance.notify({modelId:(0,L.qv)(),dataSchemaName:this.dataSchema.name,type:Ve.Update,payload:{primaryAttributesValues:null,changedAttributes:Object.keys(e)}})})}_getCanSuccessfullyExecuteOperationResult(){return(0,l.of)({result:!0})}_fillLookupValues(e,t,s){Object.entries(s).forEach(([r,[n,a]])=>{(t[r]||[]).forEach(d=>{e[d]=a?{value:r,displayValue:n,primaryColorValue:a}:{value:r,displayValue:n}})})}_fillSchemaParameterValueNameMap(e,t,s,r){const n=r;let a=e[t];a||(a={},e[t]=a);let u=a[n];u||(u=[],a[n]=u),u.push(s)}_fillSchemaNamePrimaryValuesMap(e,t,s){const r=s;let n=e[t];n||(n=[],e[t]=n),n.push(r)}_isLookupValue(e){return!!e?.value}_shouldFillSchemaLookupValueMaps(e,t){return e&&t&&t.referenceSchemaName&&!this._isLookupValue(e)}_load(e,t){const s={},r=this._schemaParametersStore.values,n=t.attributes,a={},u={};for(const h of e){const g=r[h],b=n.find(M=>M.name===h);if(this._shouldFillSchemaLookupValueMaps(g,b)){this._fillSchemaNamePrimaryValuesMap(u,b.referenceSchemaName,g),this._fillSchemaParameterValueNameMap(a,b.referenceSchemaName,h,g);continue}s[h]=g??null}return Object.keys(u).length===0?(0,l.of)([s]):this._lookupDataLoadService.load(u).pipe((0,l.map)(h=>{for(const[g,b]of Object.entries(h)){const M=a[g];this._fillLookupValues(s,M,b)}return[s]}))}_getValuesForStore(e){const t={};return Object.entries(e).forEach(([s,r])=>{const n=this.initialConfig.parameters[s];if(!n)return;ia(n.dataValueTypeName)===v.r.Lookup?t[s]=r?.value:t[s]=r}),t}innerLoad(e,t,s){return this.getSchema().pipe((0,l.switchMap)(r=>this._load(e,r)))}innerSave(e,t){const s=this._getValuesForStore(t);return this._schemaParametersStore.setValues(s),(0,l.of)({success:!0,rowsAffected:1})}innerInsert(e){const t=this._getValuesForStore(e);return this._schemaParametersStore.setValues(t),(0,l.of)({success:!0,rowsAffected:1,primaryAttributes:[]})}innerDelete(e){return(0,l.of)({success:!0,rowsAffected:1})}innerGetSchema(){const e=[],t=this.initialConfig.parameters;return t&&Object.entries(t).forEach(([s,r])=>{const n=new Rr({name:s,caption:r.caption,dataValueType:ia(r.dataValueTypeName),attributeType:z.OwnAttribute,path:s,isRequired:!!r.isRequired,referenceSchemaName:r.referenceSchemaName,isMasked:!1,isFormatValidated:!0});n.addDefaultValidators(),e.push(n)}),(0,l.of)(new gt({name:this.initialConfig.schemaName,type:hs.ClientUnit,attributes:e}))}innerGetLookupDataSchema(e){return(0,l.of)(null)}innerGetDefaultValues(){return(0,l.of)({})}innerCanEdit(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanDelete(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanCreate(e){return this._getCanSuccessfullyExecuteOperationResult()}}class gh extends Ji{constructor(){super(...arguments),this.type="crt.WebServiceDataSource"}innerLoad(e,t,s){throw new Error("Method not implemented.")}innerSave(e,t){throw new Error("Method not implemented.")}innerInsert(e){throw new Error("Method not implemented.")}innerDelete(e){throw new Error("Method not implemented.")}innerGetSchema(){throw new Error("Method not implemented.")}innerGetLookupDataSchema(e){throw new Error("Method not implemented.")}innerGetDefaultValues(){throw new Error("Method not implemented.")}innerCanDelete(e){throw new Error("Method not implemented.")}innerCanEdit(e){throw new Error("Method not implemented.")}innerCanCreate(e){throw new Error("Method not implemented.")}}class gs{resolve(e){let t=null;switch(e){case ou:t=Lr;break;case cu:t=fh;break;case"crt.WebServiceDataSource":t=gh;break;case"crt.CopilotIntentDataSource":t=ah;break;case"crt.CopilotIntentParameterDataSource":t=hh;break;case"crt.CopilotActionDataSource":t=Qd;break;case"crt.DashboardDataSource":t=ph;break}return(0,l.of)(t)}static#e=this.\u0275fac=function(t){return new(t||gs)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:gs,factory:gs.\u0275fac})}class St{constructor(e,t){this.injector=e,this.resolver=t}create(e,t,s){const{type:r,scope:n,config:a}=t;return this.resolver.resolve(r).pipe((0,o.switchMap)(d=>d?new d(e,s||this.injector).init(a,n):(0,l.throwError)(()=>new Error(`Data source type '${r}' not supported.`))),(0,o.catchError)(d=>d instanceof Zi?(0,l.of)(d.dataSource):(0,l.throwError)(()=>d)))}static#e=this.\u0275fac=function(t){return new(t||St)(c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(gs))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:St,factory:St.\u0275fac})}var T;(function(i){i.Init="init",i.Create="create",i.Update="update",i.Copy="copy",i.Delete="delete",i.Unknown="unknown"})(T||(T={}));class _h{}var le;(function(i){i.LoadNext="loadNext",i.Load="load",i.Reload="reload"})(le||(le={}));function bu(i,e,t){return!i||!e||!t}function Su(i,e){return`/img/entity/hash/${i}/${e}/`}function Cu(i,e="SysImage",t="Data"){if(bu(i,e,t))return"";const s=Su(e,t);return`${Dn()}${s}${i}`}function vm(i,e="SysImage",t="Data"){return bu(i,e,t)?"":`${Su(e,t)}${i}`}function yh(i){let e="";if(typeof i=="string"){const s=new TextEncoder().encode(i);e=String.fromCharCode(...s)}else if(i instanceof ArrayBuffer){const t=new Uint8Array(i);for(let s=0;s<t?.byteLength;s++)e+=String.fromCharCode(t[s])}return window.btoa(e)}function Em(i){const e=new DOMParser().parseFromString(i,"text/html"),t=e?.querySelectorAll("svg");return t.length>0&&t.forEach(s=>{const r=e.createElement("img"),n=yh(s.outerHTML);r.src=`data:image/svg+xml;base64,${n}`,s?.parentNode.replaceChild(r,s)}),e?.body.innerHTML||i}class pe{static _setImageLookupTypeUrl(e,t){const s=e[t],r=s?.value;r&&(s.url=Cu(r))}static _setBlobTypeUrl(e,t,s){const r=t[s];if(r){const n=t.Id;t[s]={value:r,url:Cu(n,e,s)}}}static _addImageUrl(e,t,s){t.forEach(r=>{switch(r.dataValueType){case v.r.IMAGELOOKUP:{this._setImageLookupTypeUrl(s,r.name);break}case v.r.Image:{this._setBlobTypeUrl(e,s,r.name);break}default:break}})}static serializeRecordPrimaryAttributesValues(e){return e.map(t=>`${t.name}:${t.value}`).join(";")}static getModelPrimaryAttributeValues(e,t){const s=e.getPrimaryAttributesNames();return t.map(r=>s.map(n=>({name:n,value:r[n]})))}static getOwnColumnsValues(e,t){const s=t??{};if(e.attributes.length){const r=e.attributes.filter(n=>n.attributeType===z.OwnAttribute).map(n=>n.name).filter(n=>!(0,D.isUndefined)(s[n])).map(n=>[n,s[n]]);return Object.fromEntries(r)}else return s}static getPrimaryAttributeValuesFromParameters(e,t){const s=t.filter(r=>r.type===F.PrimaryColumnValue);return s.length?s.map(r=>({[e.primaryAttributeName]:r.value})):[]}static getPrimaryAttributeValuesFromData(e,t){const s=e.getPrimaryAttributesNames();return s.length?s.filter(r=>t[r]).map(r=>({[r]:t[r]})):[]}static getPrimaryAttributeValues(e,t,s){const r=this.getPrimaryAttributeValuesFromData(e,t);return r.length?r:this.getPrimaryAttributeValuesFromParameters(e,s)}static getDataSourceLoadOptions(e){const t={loadType:e?.loadType||le.Load};return e?.pagingConfig&&(t.pagingConfig=e.pagingConfig),e?.sortingConfig&&(t.sortingConfig=e.sortingConfig),e?.isDistinct&&(t.isDistinct=e.isDistinct),t}static getImageAttributes(e,t){const s=[];return(t||[]).forEach(r=>{const n=e.findAttributeByName(r);n?.isImage&&s.push(n)}),s}static processImageData(e,t,s){const r=pe.getImageAttributes(e,s);return r.length>0&&t.forEach(n=>this._addImageUrl(e.name,r,n)),t}static removeNotRequestedData(e,t){return Object.keys(t).forEach(s=>{e.includes(s)||delete t[s]}),t}static getLoadRequestSignature(e,t,s,r){return JSON.stringify(e)+JSON.stringify(t)+JSON.stringify(s)+JSON.stringify(r)}}class Au extends Error{}const bh={[T.Init]:[T.Create,T.Copy,T.Update,T.Delete],[T.Copy]:[T.Delete,T.Update],[T.Create]:[T.Copy,T.Delete,T.Update],[T.Delete]:[T.Copy,T.Create,T.Update,T.Init],[T.Update]:[T.Delete],[T.Unknown]:[]};function ca(i){const e={success:!1,rowsAffected:0,errorInfo:""};return typeof i=="string"?Object.assign(e,{errorInfo:i}):i instanceof Error?Object.assign(e,{errorInfo:i.message}):Object.assign(e,typeof i=="object"?i:{errorInfo:i})}class _s{get _children(){return this._children$.value}static get instance(){return this._instance||(this._instance=new _s(null,null)),this._instance}constructor(e,t){this.injector=e,this.dataSource=t,this._lookupDataSourceName="lookupDataSource",this._id=(0,L.qv)(),this._modeChanges=new l.Subject,this._destroyed$=new l.Subject,this._children$=new l.BehaviorSubject([]),this._childrenDirty$=new l.BehaviorSubject(!1),this._childrenModes$=new l.BehaviorSubject([]),this._isCollectionModel=!1,this._isCollectionItemModel=!1,this._mode=T.Init,this._isInitialized=!1,this._isLoaded=!1,this._dirtyAttributes=new Set,this._newLoadingRequestArrived=new l.Subject,this._attributesMap=[],this._selfDirty$=new l.BehaviorSubject(!1),this._isLoading=!1,this._destroyed=!1,this._doNotAllowCancelRequest=!1,this._dirty$=(0,l.combineLatest)([this._selfDirty$,this._childrenDirty$,this._childrenModes$]).pipe((0,o.map)(([s,r,n])=>s||r||n.includes(T.Copy)||n.includes(T.Create)),(0,o.distinctUntilChanged)()),this._loadedData=new Set,this.injector&&(this._dataSourceFactory=this.injector.get(St),this._lifecycleHookNotificationService=this.injector.get(_h,null,{optional:!0}),this._measurePerformanceService=this.injector.get(ge,null,{optional:!0}),this._doNotAllowCancelRequest=this.injector.get(E,null,{optional:!0})?.DoNotAllowCancelRequest)}static create(e){return(0,l.from)(this.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},""))}get name(){return this.dataSource?this.dataSource.dataSourceName:""}get mode(){return this._isCollectionModel?T.Unknown:this._mode}get _modeChanges$(){return this._modeChanges.asObservable()}get _isChanged(){return!!this._dirtyAttributes?.size}set _isCollection(e){this._isCollectionModel=e,this._isCollectionModel&&(this._mode=T.Unknown)}get isLoaded(){return this._isLoaded}get event$(){return jr.instance.event$.pipe((0,o.filter)(()=>this._isInitialized),(0,o.filter)(()=>!this._isCollectionItemModel),(0,o.filter)(({dataSchemaName:e})=>e===this._dataSchemaName),(0,o.tap)(({type:e,modelId:t,payload:s})=>this._updateLoadedData(e,t,s)),(0,o.filter)(({modelId:e})=>e!==this._id&&!this._isChild(e)),(0,o.map)(e=>({event:e,ownPrimaryAttributesValues:e.payload?.primaryAttributesValues?.filter(t=>{const s=pe.serializeRecordPrimaryAttributesValues(t);return this._loadedData.has(s)})})),(0,o.filter)(({event:e,ownPrimaryAttributesValues:t})=>e.type===Ve.Update||e.type===Ve.Delete?!t||t.length!==0:!0),(0,o.map)(({event:e,ownPrimaryAttributesValues:t})=>({event:e,primaryAttributesValues:e.type===Ve.Create?e.payload.primaryAttributesValues:t})),(0,o.map)(({event:e,primaryAttributesValues:t})=>({modelId:e.modelId,dataSchemaName:e.dataSchemaName,type:e.type,payload:{...e.payload,primaryAttributesValues:t}})),(0,o.takeUntil)(this._destroyed$))}get dataSchemaName(){return this._dataSchemaName}get allowSync(){return!this._disableSync}get disableSync(){return this._disableSync}set disableSync(e){this._disableSync=e}get isLoading(){return this._isLoading}get hasErrors(){return this.dataSource?this.dataSource.hasErrors:!0}get hasCriticalErrors(){return this.dataSource?this.dataSource.hasCriticalErrors:!0}get affectedAttributes(){return this.dataSource?this.dataSource.affectedAttributes:[]}get isAggregate(){return this.dataSource?this.dataSource.isAggregate:!1}get supportsTransactions(){return!1}get isCollectionItemModel(){return this._isCollectionItemModel}get isInitialized(){return this._isInitialized}_isChild(e){return this._children.some(t=>t?._id===e)}_subscribeChildrenModeChanges(){this._children$.pipe((0,o.map)(e=>e.map(t=>(0,l.merge)((0,l.of)(t.mode),t._modeChanges$))),(0,o.switchMap)(e=>e?.length?(0,l.combineLatest)(e):(0,l.of)([])),(0,o.tap)(e=>this._childrenModes$.next(e)),(0,o.takeUntil)(this._destroyed$)).subscribe()}_subscribeChildrenDirtyChanges(){this._children$.pipe((0,o.map)(e=>e.map(t=>t._dirty$)),(0,o.switchMap)(e=>e?.length?(0,l.combineLatest)(e):(0,l.of)([])),(0,o.map)(e=>e.some(t=>t)),(0,o.tap)(e=>this._childrenDirty$.next(e)),(0,o.takeUntil)(this._destroyed$)).subscribe()}_updateLoadedData(e,t,s){this._isCollectionModel&&e===Ve.Create&&this._isChild(t)&&s.primaryAttributesValues.forEach(r=>{const n=pe.serializeRecordPrimaryAttributesValues(r);this._loadedData.add(n)})}_setMode(e){if(this._mode===e)return;if(!bh[this._mode]?.includes(e))throw Error(`Unable to mark model with '${this._mode}' mode for '${e}'.`);const s=this._mode;this._mode=e,e===T.Delete&&this._selfDirty$.next(s!==T.Create)}_markForNotCollection(e){this._isCollectionModel||this.markFor(e)}_registerPrimaryAttributeValues(e){e.forEach(t=>{this._loadedData.add(pe.serializeRecordPrimaryAttributesValues(t))})}_getDependentAttributesNames(e){return this._attributesMap.filter(t=>e.includes(t.name)).filter(t=>t.dependentAttributes.length!==0).map(t=>t.dependentAttributes).flat()}_getDefaultLoadAttributes(){return this.getSchema().pipe((0,o.map)(e=>e.getPrimaryLoadAttributes()))}_checkAttributesInDataSchema(e){return this.getSchema().pipe((0,o.tap)(t=>{const s=e.filter(r=>t.findAttributeByName(r)==null);if(s.length>0)throw new Error(`data has unknown attributes names: ${s.join(", ")}`)}))}_createDataSource(e,t,s=null){const r=s??t.dataSourceConfig;return this._dataSourceFactory.create(e,r)}_notifyEventByParameters(e,t){return this.getSchema().pipe((0,o.map)(s=>pe.getPrimaryAttributeValuesFromParameters(s,e)),(0,o.mergeMap)(s=>this._notifyDataChange(s,t)))}_notifyDataChange(e,t){return this.getSchema().pipe((0,o.map)(s=>pe.getModelPrimaryAttributeValues(s,e)),(0,o.tap)(s=>{jr.instance.notify({modelId:this._id,dataSchemaName:this._dataSchemaName,type:t,payload:{primaryAttributesValues:s}})}),(0,o.map)(()=>null))}_mapSaveResult(e,t,s){return this.getSchema().pipe((0,o.map)(r=>({result:e,actionType:Ve.Update,data:pe.getPrimaryAttributeValues(r,t,s)})))}_mapInsertResult(e){return{data:e.primaryAttributes??[],result:e,actionType:Ve.Create}}_getLoadAttributes(e){if(e&&e.length!==0){let t=null;if(e.every(r=>(0,D.isString)(r)))return t=this._getDependentAttributesNames(e),(0,l.of)([...e,...t]);{const r=e.map(n=>n.name);return t=this._getDependentAttributesNames(r),this.getSchema().pipe((0,o.map)(n=>(t=t.map(a=>n.findAttributeByName(a)).map(a=>({name:a.name,path:a.path,caption:a.caption,dataValueType:a.dataValueType,aggregationConfig:a.aggregationConfig})),[...e,...t])))}}return this._getDefaultLoadAttributes()}_getChangedAttributesValues(e){return this._persistedState?Object.entries({...this._persistedState,...e}).filter(([t])=>this._dirtyAttributes.has(t)).reduce((t,[s,r])=>Object.assign(t,{[s]:r}),{}):e}_load(e,t,s,r,n=T.Update){const a={attributes:t,parameters:s,options:r,mode:n},u=(0,D.cloneDeep)(this._lastRequestPayload),d=(0,D.isEqual)((0,D.omit)(a,"options.loadType"),(0,D.omit)(u,"options.loadType"));return this._loadingRequest&&d?this._loadingRequest:(this._lastRequestPayload&&!d&&(this._newLoadingRequestArrived.next(null),this._newLoadingRequestArrived=new l.Subject),this._lastRequestPayload=a,this._loadingRequest=this._getLoadAttributes(t).pipe((0,P.pR)(()=>this._onBeforeLoad(a,u)),(0,o.switchMap)(h=>e(h,s,r)),(0,o.raceWith)(this._newLoadingRequestArrived.pipe((0,o.switchMap)(()=>(0,l.throwError)(()=>new Au)))),(0,o.tap)(()=>this._markForNotCollection(n)),(0,P.BB)(()=>this.getSchema()),(0,o.tap)(([h,g])=>{this._registerPrimaryAttributeValues(pe.getModelPrimaryAttributeValues(g,h))}),(0,o.tap)(()=>this._persistedState={}),(0,o.map)(([h,g])=>pe.processImageData(g,h,t)),(0,o.tap)(()=>this._isLoaded=!0),(0,P.pR)(()=>this._onAfterLoad(a,u)),(0,o.catchError)(h=>(this._isLoaded=!1,(0,l.throwError)(()=>h))),(0,o.tap)(()=>{this._dirtyAttributes.size===0&&this._markAsPristine(),this._loadingRequest=null}),(0,o.share)()),(0,l.iif)(()=>!this._doNotAllowCancelRequest,this._loadingRequest.pipe((0,o.takeUntil)(this._destroyed$)),this._loadingRequest))}_updateAttributesDependencies(){this._attributesMap.forEach(t=>t.dependentAttributes=[]),this._attributesMap.filter(t=>t.attributeType!==z.OwnAttribute).forEach(t=>{const s=t.path.split(".");if(s.length===1)return;const r=s.shift(),n=this._attributesMap.find(a=>a.path===r);n?.dependentAttributes.push(t.name)})}_buildAttributesMap(e){const t=e.attributes??[];this._attributesMap=t.map(s=>({name:s.name,path:s.path,attributeType:s.attributeType,dependentAttributes:[],isSchemaAttribute:!0})),this._updateAttributesDependencies()}_loadDependentDataForCreate(e){return this.getSchema().pipe((0,o.map)(t=>t.attributes.filter(s=>s.dataValueType===v.r.Lookup).filter(s=>s.name in e).map(s=>s.name)),(0,o.switchMap)(t=>{if(t.length===0)return(0,l.of)([]);const s=t.map(r=>this.reloadDependentData(r,e[r]));return(0,l.forkJoin)(s)}),(0,o.map)(t=>{let s={};return t.forEach(r=>{s={...s,...r[0]||{}}}),{...s,...e}}))}_getDependentAttributesInfo(e){return this.getSchema().pipe((0,o.map)(t=>e.map(s=>{const r=t.findAttributeByName(s),n=r?.path??s,a=r?.name??s,u=r?.aggregationConfig??null,d=r?.dataValueType??null,h=r?.attributeType??null,g=n.split(".");g.shift();const b=g.length===1?g[0]:a;let M;return h===z.AggregationAttribute?M=z.AggregationAttribute:M=g.length===1?z.OwnAttribute:z.ForwardReferenceAttribute,{alias:b,attributeName:a,config:{path:g.join("."),aggregationConfig:u,dataValueType:d,type:M},type:M}})))}_markAsPristine(){this._selfDirty$.next(!1)}_onBeforeLoad(e,t){return this._lifecycleHookNotificationService?.onBeforeLoad?(0,l.from)(this._lifecycleHookNotificationService.onBeforeLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})).pipe((0,o.map)(s=>{if(s===!1)throw Error('Loading is disallowed by a "OnBeforeLoad" model lifecycle event')})):(0,l.of)(void 0)}_onAfterLoad(e,t){return this._lifecycleHookNotificationService?.onAfterLoad?(0,l.from)(this._lifecycleHookNotificationService.onAfterLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})):(0,l.of)(void 0)}_onBeforeInsert(e){return this._lifecycleHookNotificationService?.onBeforeInsert?this.getSchema().pipe((0,o.map)(t=>pe.getModelPrimaryAttributeValues(t,[e])),(0,o.map)(t=>t.pop()),(0,o.switchMap)(t=>this._lifecycleHookNotificationService.onBeforeInsert({model:this,payload:{data:e,primaryAttributesValues:t}})),(0,o.map)(t=>{if(t===!1)throw Error('Inserting is disallowed by a "OnBeforeInsert" model lifecycle event')})):(0,l.of)(void 0)}_insert(e,t){return t(e).pipe((0,o.map)(s=>this._mapInsertResult(s)),(0,o.tap)(()=>this._persistedState={}),(0,o.tap)(()=>this._markAsPristine()),(0,o.tap)(()=>this._markForNotCollection(T.Update)),(0,P.BB)(()=>this.getSchema()),(0,o.tap)(([,s])=>{this._registerPrimaryAttributeValues(pe.getModelPrimaryAttributeValues(s,[e]))}),(0,o.map)(([s])=>s),(0,P.hk)(({data:s,actionType:r})=>this._notifyDataChange(s,r)),(0,o.map)(({result:s})=>s))}_onAfterInsert(e){return this._lifecycleHookNotificationService?.onAfterInsert?(0,l.from)(this._lifecycleHookNotificationService.onAfterInsert({model:this,payload:{data:e}})):(0,l.of)(void 0)}_onBeforeUpdate(e,t){return this._lifecycleHookNotificationService?.onBeforeUpdate?(0,l.from)(this._lifecycleHookNotificationService.onBeforeUpdate({model:this,payload:{data:e,parameters:t}})).pipe((0,o.map)(s=>{if(s===!1)throw Error('Updating is disallowed by a "OnBeforeUpdate" model lifecycle event')})):(0,l.of)(void 0)}_update(e,t,s){return s(t,e).pipe((0,o.mergeMap)(r=>this._mapSaveResult(r,e,t)),(0,P.hk)(()=>this._notifyEventByParameters(t,Ve.Update)),(0,o.map)(({result:r})=>r),(0,o.tap)(()=>this.setLoadedState()))}_onAfterUpdate(e,t){return this._lifecycleHookNotificationService?.onAfterUpdate?(0,l.from)(this._lifecycleHookNotificationService.onAfterUpdate({model:this,payload:{data:e,parameters:t}})):(0,l.of)(void 0)}_onBeforeDelete(e){return this._lifecycleHookNotificationService?.onBeforeDelete?(0,l.from)(this._lifecycleHookNotificationService.onBeforeDelete({model:this,payload:{parameters:e}})).pipe((0,o.map)(t=>{if(t===!1)throw Error('Deleting is disallowed by a "OnBeforeDelete" model lifecycle event')})):(0,l.of)(void 0)}_delete(e,t){return t(e).pipe((0,o.tap)(()=>this._markAsPristine()),(0,o.tap)(()=>this._markForNotCollection(T.Init)),(0,P.hk)(()=>this._notifyEventByParameters(e,Ve.Delete)))}_onAfterDelete(e){return this._lifecycleHookNotificationService?.onAfterDelete?(0,l.from)(this._lifecycleHookNotificationService.onAfterDelete({model:this,payload:{parameters:e}})):(0,l.of)(void 0)}innerInsert(e,t){const r=this.getSchema().pipe((0,o.map)(n=>({dataSchema:n,data:{...this._persistedState??{},...t}})),(0,o.map)(({data:n,dataSchema:a})=>pe.getOwnColumnsValues(a,n))).pipe((0,P.pR)(n=>this._onBeforeInsert(n)),(0,P.DH)(n=>this._insert(n,e)),(0,P.pR)(([n])=>this._onAfterInsert(n)),(0,o.map)(([,n])=>n),(0,o.tap)(()=>{this._isLoaded=!0}),(0,o.catchError)(n=>(0,l.of)(ca(n))));return(0,l.iif)(()=>!this._doNotAllowCancelRequest,r.pipe((0,o.takeUntil)(this._destroyed$)),r)}innerUpdate(e,t,s){const n=this.getSchema().pipe((0,o.map)(a=>pe.getOwnColumnsValues(a,t)),(0,o.map)(a=>this._getChangedAttributesValues(a))).pipe((0,P.pR)(a=>this._onBeforeUpdate(a,s)),(0,P.DH)(a=>this._update(a,s,e)),(0,P.pR)(([a])=>this._onAfterUpdate(a,s)),(0,o.map)(([,a])=>a),(0,o.catchError)(a=>(0,l.of)(ca(a))));return(0,l.iif)(()=>!this._doNotAllowCancelRequest,n.pipe((0,o.takeUntil)(this._destroyed$)),n)}innerDelete(e,t){return this._onBeforeDelete(t).pipe((0,o.switchMap)(()=>this._delete(t,e)),(0,P.pR)(()=>this._onAfterDelete(t)),(0,o.catchError)(s=>(0,l.of)(ca(s))))}innerLoad(e,t){if(this._destroyed)return(0,l.of)([]);this._isLoading=!0;const s=t?.attributes,r=t?.parameters||[],n=pe.getDataSourceLoadOptions(t?.options),a=this._load(e,s,r,n).pipe((0,o.tap)(()=>this._isLoading=!1),(0,o.catchError)(u=>(this._isLoading=!1,(0,l.throwError)(()=>u))));return(0,l.iif)(()=>!this._doNotAllowCancelRequest,a.pipe((0,o.takeUntil)(this._destroyed$)),a)}createChildModel(){return new _s(this.injector,this.dataSource)}init(){return this.getSchema().pipe((0,o.tap)(e=>this._dataSchemaName=e.name),(0,o.tap)(e=>this._buildAttributesMap(e)),(0,o.map)(()=>this),(0,o.tap)(()=>this._isInitialized=!this.hasCriticalErrors),(0,o.tap)(()=>{this._subscribeChildrenModeChanges(),this._subscribeChildrenDirtyChanges()}),(0,o.take)(1))}getSchema(){if(!this.dataSource)return(0,l.of)(null);if(this.hasCriticalErrors)return(0,l.of)(this.dataSource.getEmptySchema());const e=this.dataSource.getSchema();return this._measurePerformanceService?e.pipe(this._measurePerformanceService.measure$(`model.getSchema.${this.name}`)):e}getDataSource(){return this.dataSource}load(e){return this.innerLoad((t,s,r)=>this.dataSource.load(t,s,r),e)}updateDependentAttributes(e){this._attributesMap=this._attributesMap.filter(r=>r.isSchemaAttribute);const t=this._attributesMap.map(r=>r.name),s=e.filter(r=>!t.includes(r.path)).map(r=>({name:r.path,path:r.path,attributeType:r.type??z.ForwardReferenceAttribute,dependentAttributes:[],isSchemaAttribute:!1}));this._attributesMap.push(...s),this._updateAttributesDependencies()}canReloadDependentData(e){return this._getDependentAttributesNames([e]).length!==0}getDependentAttributesNames(e){return this._getDependentAttributesNames([e])}reloadDependentData(e,t){const s=this._getDependentAttributesNames([e]);if(s.length===0)return(0,l.of)([]);if(t==null)return(0,l.of)([Object.fromEntries(s.map(a=>[a,null]))]);const r=[{type:F.PrimaryColumnValue,value:t}],n=[];return(0,l.forkJoin)([this._getDependentAttributesInfo(s),this.dataSource.getLookupDataSchema(e)]).pipe((0,o.switchMap)(([a,u])=>{const d=a.filter(g=>g.type!==z.OwnAttribute).map(g=>[g.alias,g.config]),h={type:u.dataSourceConfig.type,config:{...u.dataSourceConfig.config,attributes:Object.fromEntries(d)}};return a.forEach(g=>{n.push({ownAttributeName:g.attributeName,alias:g.alias})}),this._createDataSource(`${this.name}_reloadData`,u,h)}),(0,o.switchMap)(a=>a.load([...new Set(n.map(u=>u.alias))],r,{throttled:!0})),(0,o.map)(a=>a.map(u=>{const d={};return n.forEach(h=>{d[h.ownAttributeName]=u[h.alias]}),d})))}create(e={}){return this._isLoading=!0,this.getSchema().pipe((0,o.map)(t=>pe.getOwnColumnsValues(t,e)),(0,o.switchMap)(t=>(0,l.forkJoin)([(0,l.of)(t),this.dataSource.getDefaultValues()])),(0,o.tap)(()=>this._markForNotCollection(T.Create)),(0,o.map)(([t,s])=>(this._persistedState={...s,...t},this._persistedState)),(0,o.switchMap)(t=>this._loadDependentDataForCreate(t)),(0,o.tap)(()=>this._isLoading=!1))}copy(e,t={}){return this._isLoading=!0,this.getSchema().pipe((0,o.map)(s=>({schema:s,attributes:s.attributes.filter(r=>r.attributeType===z.OwnAttribute&&r.isValueCloneable).map(r=>r.name),parameters:typeof e=="string"?[{type:F.PrimaryColumnValue,value:e}]:s.getPrimaryAttributesNames().filter(r=>e[r]).map(r=>({type:F.PrimaryColumnValue,value:{[r]:e[r]}}))})),(0,o.mergeMap)(({schema:s,attributes:r,parameters:n})=>this._load((a,u,d)=>this.dataSource.load(a,u,d),r,n,{},T.Copy).pipe((0,o.tap)(()=>{this._isLoaded=!1}),(0,o.tap)(a=>{if(a.length>1)throw new Error("More than one record loaded for copy");if(a.length===0)throw new Error("No records loaded for copy")}),(0,o.map)(a=>pe.removeNotRequestedData(r,{...a[0]})),(0,o.map)(a=>{s.getPrimaryAttributesNames().forEach(d=>delete a[d]);const u=pe.getOwnColumnsValues(s,t);return{...a,...u}}),(0,o.switchMap)(a=>this.dataSource.getDefaultValues().pipe((0,o.map)(u=>({...u,...a})))),(0,o.tap)(a=>{this._persistedState={...a}}),(0,o.switchMap)(a=>this._loadDependentDataForCreate(a)),(0,o.tap)(()=>{this._isLoaded=!0,this._isLoading=!1}),(0,o.catchError)(a=>(this._isLoading=!1,this._markForNotCollection(T.Update),(0,l.throwError)(()=>new Error(a)))))))}insert(e){return this.innerInsert(t=>this.dataSource.insert(t),e)}update(e,t){return this.innerUpdate((s,r)=>this.dataSource.save(s,r),e,t)}insertOrUpdate(e,t){return this._mode===T.Update?this.update(e,t):this.insert(e)}delete(e){return this.innerDelete(t=>this.dataSource.delete(t),e)}setValue(e){const t=Object.keys(e);return this._checkAttributesInDataSchema(t).pipe((0,o.tap)(()=>{t.length>0&&(this._dirtyAttributes=new Set([...this._dirtyAttributes,...t]),this._persistedState={...this._persistedState??{},...e})}),(0,o.map)(()=>null))}_getPersistedState(){return{...this._persistedState??{}}}markFor(e){this.mode!==e&&(this._setMode(e),this._modeChanges.next(e))}resetMode(){this._mode!==T.Init&&(this._mode=T.Init,this._modeChanges.next(this._mode))}loadLookupList(e,t,s={}){if(!this.dataSource)throw Error("DataSource is null");const r=this.dataSource.getLookupDataSchema(e).pipe((0,o.switchMap)(n=>{const a=n.getPrimaryLoadAttributes();return this._createDataSource(this._lookupDataSourceName,n).pipe((0,o.switchMap)(u=>u.load(a,t,s)),(0,o.map)(u=>({primaryAttributeName:n.primaryAttributeName,primaryDisplayAttributeName:n.primaryDisplayAttributeName,data:u})))}));return(0,l.iif)(()=>!this._doNotAllowCancelRequest,r.pipe((0,o.takeUntil)(this._destroyed$)),r)}canDelete(e){return(0,l.lastValueFrom)(this.dataSource.canDelete(e),{defaultValue:null})}canSave(e){switch(this._mode){case T.Init:return Promise.resolve({result:!1});case T.Create:case T.Copy:return(0,l.lastValueFrom)(this.dataSource.canCreate(e),{defaultValue:null});case T.Update:return(0,l.lastValueFrom)(this.dataSource.canEdit(e),{defaultValue:null});case T.Delete:return this.canDelete(e);default:throw Error(`Unable to verify the possibility of operation executing: the '${this._mode}' is not supported.`)}}attributeChanged(e,t){t||this._selfDirty$.next(!0),this._dirtyAttributes.add(e)}setLoadedState(e=null){if(this._isCollectionModel||!e){this._dirtyAttributes.clear(),this._markAsPristine();return}e.forEach(t=>this._dirtyAttributes.delete(t)),this._dirtyAttributes.size||this._markAsPristine()}createCollectionItemModel(e){const t=this.createChildModel();return t._isCollectionItemModel=!0,t._isLoaded=!0,t._isInitialized=!0,t._persistedState={},t._dataSchemaName=this._dataSchemaName,t._attributesMap=this._attributesMap,e!=null&&(t._setMode(e),t._selfDirty$.next(!1)),this._children.push(t),t}childrenChange(){this._children$.next(this._children)}removeChild(e){const t=e?._id,s=this._children.findIndex(r=>r?._id===t);s!==-1&&this._children.splice(s,1)}_getAsyncResult(e){return(0,l.firstValueFrom)(e)}getLastError(){return this.dataSource?this.dataSource.getLastError():new Error("DataSource is null")}destroy(){this._isInitialized=!1,this._destroyed$.next(),this._destroyed$.complete(),this._selfDirty$.complete(),this._children$.complete(),this._childrenDirty$.complete(),this._childrenModes$.complete(),this._destroyed=!0}getOwnLoadParameters(){return this.dataSource.getOwnLoadParameters()}getAllowCopyingRecords(){return this.dataSource.getAllowCopyingRecords()}}(0,f.__decorate)([He({requestType:"crt.ModelGenerator",methodName:"generateOne"}),(0,f.__metadata)("design:type",Function)],_s.prototype,"_create",void 0);class Hn extends _s{get supportsTransactions(){return this.dataSource?this.dataSource.supportTransactions:!1}createChildModel(){return new Hn(this.injector,this.dataSource)}loadInTransaction(e,t){return e.createOperation(s=>(0,l.firstValueFrom)(this.innerLoad((r,n,a)=>this.dataSource.loadInTransaction(s,r,n,a),t)))}insertInTransaction(e,t){return e.createOperation(s=>(0,l.firstValueFrom)(this.innerInsert(r=>this.dataSource.insertInTransaction(s,r),t)))}updateInTransaction(e,t,s){return e.createOperation(r=>(0,l.firstValueFrom)(this.innerUpdate((n,a)=>this.dataSource.saveInTransaction(r,n,a),t,s)))}insertOrUpdateInTransaction(e,t,s){return this.mode===T.Update?this.updateInTransaction(e,t,s):this.insertInTransaction(e,t)}deleteInTransaction(e,t){return e.createOperation(s=>(0,l.firstValueFrom)(this.innerDelete(r=>this.dataSource.deleteInTransaction(s,r),t)))}}let qr=class Di{constructor(e,t,s,r){this.dataSourceFactory=e,this.entitySchemaRepository=t,this._featureValues=s,this._injector=r}get _transactionsEnabled(){return this._featureValues["DataSource-DisableTransactions"]!==!0}_createModel(e=null,t=!1,s){const r=e.supportTransactions&&this._transactionsEnabled?new Hn(s||this._injector,e):new _s(s||this._injector,e);return r.disableSync=t,r.init()}_validateModelConfig(e){if(e.primaryDataSourceName&&!e.dataSources[e.primaryDataSourceName])throw new Error(`Data source "${e.primaryDataSourceName}" cannot be primary data source. Data source "${e.primaryDataSourceName}" not found in model config.`);if(e.primaryDataSourceName&&e.dataSources[e.primaryDataSourceName]?.scope===De.ViewElement)throw new Error(`Data source "${e.primaryDataSourceName}" with scope "viewElement" cannot be primary. Only data sources with scope "page" can be primary`)}_getEntitySchemesRequest(e){return e.map(([,t])=>t).filter(t=>t.type==="crt.EntityDataSource").map(t=>t.config).filter(t=>!!t.entitySchemaName).map(t=>{let s=[];return t.attributes&&(s=Object.entries(t.attributes).filter(([,r])=>r.type===z.ForwardReferenceAttribute).map(([,r])=>r.path)),{name:t.entitySchemaName,loadLookupColumns:!0,forwardReferencePaths:s}})}_generateFromConfig(e,t){let s,r;const n=t?.get(ge,null,{optional:!0});return n?(s=Object.entries(e?.dataSources||{}).filter(([a,u])=>u.type?!0:(console.warn(`Data source ${a} without type not supported.`),!1)),s.length===0?(0,l.of)([]):(this._validateModelConfig(e),r=s.map(([a,u])=>this.generateOne(u,a,t)),this.preInitializeDataSources(s).pipe(n.measure$("modelGenerator.generateFromConfig"),(0,l.switchMap)(()=>(0,l.forkJoin)(r))))):(s=Object.entries(e?.dataSources||{}).filter(([a,u])=>u.type?!0:(console.warn(`Data source ${a} without type not supported.`),!1)),s.length===0?(0,l.of)([]):(this._validateModelConfig(e),r=s.map(([a,u])=>this.generateOne(u,a,t)),this.preInitializeDataSources(s).pipe((0,l.switchMap)(()=>(0,l.forkJoin)(r)))))}preInitializeDataSources(e){if(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"])return(0,l.of)(null);const t=this._getEntitySchemesRequest(e);return this.entitySchemaRepository.getSchemes(t).pipe((0,o.catchError)(s=>(0,l.of)([])),(0,o.map)(s=>null))}generate(e,t){return this._generateFromConfig(e,t)}generateOne(e,t,s){const r=s?.get(ge,null,{optional:!0});return r?this.dataSourceFactory.create(t,e,s).pipe(r.measure$(`modelGenerator.generateOne.${t}`),(0,o.mergeMap)(n=>this._createModel(n,e.disableSync,s))):this.dataSourceFactory.create(t,e,s).pipe((0,o.mergeMap)(n=>this._createModel(n,e.disableSync,s)))}static#e=this.\u0275fac=function(t){return new(t||Di)(c.\u0275\u0275inject(St),c.\u0275\u0275inject(Ye),c.\u0275\u0275inject(E),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Di,factory:Di.\u0275fac})};qr=(0,f.__decorate)([(0,P.op)({requestType:"crt.ModelGenerator"}),(0,f.__metadata)("design:paramtypes",[St,Ye,Wi,c.Injector])],qr);class Hr{get contextService(){return this._contextService===void 0&&(this._contextService=this._injector.get(Zc,null)),this._contextService}constructor(e,t,s){this._modelGenerator=e,this._window=t,this._injector=s,this._schemaName="AcademyUrlData"}_createAcademyHelpUrlDataItem(e){return{configurationVersion:e.ConfigurationVersion,contextHelpCode:e.Code,contextHelpId:e.ContextHelpId,enableContextHelp:e.EnableContextHelp,lmsUrl:e.LMSUrl,productEdition:e.ProductEdition,useLmsDocumentation:e.UseLmsDocumentation}}_getSchemaColumns(){return["ContextHelpId","EnableContextHelp","Code","ProductEdition","ConfigurationVersion","UseLmsDocumentation","LMSUrl"]}_createDataSourceParameters(e){return[{type:F.Filter,value:this._getContextHelpCodeFilter(e)}]}_getContextHelpCodeFilter(e){return new Re(ne.Equal,new X({columnPath:"Code"}),new ae({value:e}))}_getAcademyHelpUrlData(e){return this._modelGenerator.generateOne({type:"crt.EntityDataSource",config:{entitySchemaName:this._schemaName}},"").pipe((0,o.switchMap)(t=>t.load({attributes:this._getSchemaColumns(),parameters:e})),(0,o.map)(t=>t.length===1?this._createAcademyHelpUrlDataItem(t[0]):null))}_buildUrl(e){let t="#";return e&&(t=e.useLmsDocumentation?this._getLmsDocumentationUrl(e):mt.String.empty),t}_getLmsDocumentationUrl(e){const t=[],s=e.productEdition;s&&t.push("product="+encodeURIComponent(s));const r=e.configurationVersion;r&&t.push("ver="+encodeURIComponent(r));const n=e.enableContextHelp,a=e.contextHelpId;return n&&a&&t.push("id="+encodeURIComponent(a)),`${e.lmsUrl}?${t.join("&")}`}getAcademyHelpUrl(e){if(e===mt.String.empty)return(0,l.of)(mt.String.empty);const t=this._createDataSourceParameters(e);return this._getAcademyHelpUrlData(t).pipe((0,o.map)(s=>s?this._buildUrl(s):mt.String.empty))}openContextHelp(){const e=this.contextService;if(!e)throw new Error(`${Zc.toString()} was not provided`);const t=e.getContextCode();this.getAcademyHelpUrl(t).subscribe(s=>{this._window.open(s)})}static#e=this.\u0275fac=function(t){return new(t||Hr)(c.\u0275\u0275inject(qr),c.\u0275\u0275inject(P.ZP),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Hr,factory:Hr.\u0275fac,providedIn:"root"})}class Ct{constructor(e,t,s,r){this._dialogService=e,this._translateService=t,this._academyHelpUrlService=s,this._domSanitizer=r,this._codeErrorDataSchema={columns:[new Jl({name:"errorTypeIcon",formatter:(n,a)=>a.warning?Vt.Warning:Vt.Error}),{name:"fileName",caption:this._translateService.instant("ErrorListDialogService.FileNameColumn"),valueType:v.r.Text},{name:"errorText",caption:this._translateService.instant("ErrorListDialogService.ErrorTextColumn"),valueType:v.r.Text},{name:"errorNumber",caption:this._translateService.instant("ErrorListDialogService.ErrorNumberColumn"),valueType:v.r.Text},{name:"line",caption:this._translateService.instant("ErrorListDialogService.LineColumn"),valueType:v.r.Text}]},this._savePackagePropertiesErrorDataSchema={columns:[new Yl({name:"itemType",caption:this._translateService.instant("ErrorListDialogService.ItemTypeColumn"),formatter:(n,a)=>this._getTypeIconName(a.itemType)},""),{name:"itemName",caption:this._translateService.instant("ErrorListDialogService.ItemNameColumn"),valueType:v.r.Text},{name:"message",caption:this._translateService.instant("ErrorListDialogService.DescriptionColumn"),valueType:v.r.Text},{name:"packageName",caption:this._translateService.instant("ErrorListDialogService.PackageNameColumn"),valueType:v.r.Text}]},this._codeValidationErrorDataSchema={columns:[{name:"source",caption:this._translateService.instant("ErrorListDialogService.SourceColumn"),valueType:v.r.Text},{name:"reference",caption:this._translateService.instant("ErrorListDialogService.ReferenceColumn"),valueType:v.r.Text},{name:"package",caption:this._translateService.instant("ErrorListDialogService.PackageColumn"),valueType:v.r.Text}]}}_getCompilationErrorsDialogData(e){return{title:this._translateService.instant("ErrorListDialogService.CodeErrorListDialogCaption"),dataSchema:this._codeErrorDataSchema,data:e,sortColumn:"fileName"}}_getPackagePropertiesErrorDialogData(e){return{title:this._translateService.instant("ErrorListDialogService.PackagePropertiesErrorDialogCaption"),additionalText:this._translateService.instant("ErrorListDialogService.PackagePropertiesErrorMessage"),dataSchema:this._savePackagePropertiesErrorDataSchema,data:e,sortColumn:"itemType"}}_getValidationErrorsDialogData(e,t){return{title:this._translateService.instant("ErrorListDialogService.CodeValidationErrorListDialogCaption"),dataSchema:this._codeValidationErrorDataSchema,data:t,sortColumn:"source",additionalText:e,helpLinkUrl:this._getHelpLinkUrl()}}_getTypeIconName(e){switch(e){case"Schema":return"workspace-item-entity-schema";case"Assembly":return"workspace-item-assembly";case"SqlScript":return"workspace-item-sql-script";case"SchemaData":return"workspace-item-schema-data";case"Package":return"workspace-item-package";default:return""}}_getHelpLinkUrl(){return{url:this._domSanitizer.bypassSecurityTrustUrl(this._academyUrl),caption:this._translateService.instant("ErrorListDialogService.AcademyHelpUrlCaption")}}_getAcademyHelpUrl(){return this._academyHelpUrlService.getAcademyHelpUrl("PackageHierarchyLoops")}showCompilationErrors(e){return this._dialogService.open(rs,{data:this._getCompilationErrorsDialogData(e),panelClass:"compilation-error-dialog",disableClose:!0})}showValidationErrors(e,t,s=[]){return this._getAcademyHelpUrl().pipe((0,o.switchMap)(r=>(this._academyUrl=r,this._dialogService.open(rs,{data:this._getValidationErrorsDialogData(e,t),panelClass:["validation-error-dialog",...s],disableClose:!0}))))}showSavePackagePropertiesErrors(e){return this._dialogService.open(rs,{data:this._getPackagePropertiesErrorDialogData(e),panelClass:"save-package-properties-error-dialog",disableClose:!0})}static#e=this.\u0275fac=function(t){return new(t||Ct)(c.\u0275\u0275inject(xt),c.\u0275\u0275inject(O.TranslateService),c.\u0275\u0275inject(Hr),c.\u0275\u0275inject(_.DomSanitizer))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ct,factory:Ct.\u0275fac})}class Kr{constructor(e){this._errorListDialogService=e,this._subscription=new l.Subscription}ngOnInit(){this.validationErrorsList?.length>0?this._subscription.add(this._errorListDialogService.showValidationErrors(this.validationErrorMessage,this.validationErrorsList).subscribe()):this._errorListDialogService.showCompilationErrors(this.errorsList)}ngOnDestroy(){this._subscription.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||Kr)(c.\u0275\u0275directiveInject(Ct))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:Kr,selectors:[["ts-error-list-dialog-proxy"]],inputs:{errorsList:"errorsList",validationErrorsList:"validationErrorsList",validationErrorMessage:"validationErrorMessage"},decls:0,vars:0,template:function(t,s){},encapsulation:2})}const Sh="DataService/json/SyncReply",Ch="DataService/ssp/json/SyncReply",Kn=new c.InjectionToken("DataServiceUri"),vu={provide:Kn,useFactory:i=>i?.isSSP?Ch:Sh,deps:[[new c.Optional,Ue.oq]]},zn=new c.InjectionToken("TransactionFactory");class ys{_getEntitySchemaColumnsDataValueTypesMap(e){return e.columns.reduce((t,s)=>(t[s.name]=s.dataValueType,t),{})}_getEntityColumnsDataValueTypesMap(e){return Object.keys(e).reduce((t,s)=>(t[s]=e[s].dataValueType,t),{})}_parseRawColumnValue(e,t){switch(t){case v.r.Date:case v.r.Time:case v.r.DateTime:return du(e);default:return e}}_parseRawEntityObject(e,t){const s={};return Object.keys(e).forEach(r=>{const n=e[r];s[r]=t[r]?this._parseRawColumnValue(n,t[r]):n}),s}deserializeEntity(e,t){q.checkArgumentEmpty("columnsConfig",e),q.checkArgumentEmpty("rawEntity",t);const s=this._getEntityColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,s)}deserializeEntities(e,t){q.checkArgumentEmpty("columnsConfig",e),q.checkArgumentEmpty("rawEntities",t);const s=this._getEntityColumnsDataValueTypesMap(e);return t.map(r=>this._parseRawEntityObject(r,s))}deserializeEntitySchemaRecord(e,t){q.checkArgumentEmpty("entitySchema",e),q.checkArgumentEmpty("rawEntities",t);const s=this._getEntitySchemaColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,s)}deserializeEntitySchemaRecords(e,t){q.checkArgumentEmpty("entitySchema",e),q.checkArgumentEmpty("rawEntities",t);const s=this._getEntitySchemaColumnsDataValueTypesMap(e);return t.map(r=>this._parseRawEntityObject(r,s))}static#e=this.\u0275fac=function(t){return new(t||ys)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ys,factory:ys.\u0275fac,providedIn:"root"})}class Ah extends xr{}var zr;(function(i){i[i.General=0]="General",i[i.Limited=1]="Limited"})(zr||(zr={}));var ua;(function(i){i[i.Undefined=0]="Undefined",i[i.Filter=1]="Filter",i[i.FilterSummary=2]="FilterSummary"})(ua||(ua={}));var la;(function(i){i[i.Session=0]="Session",i[i.Workspace=1]="Workspace",i[i.Application=2]="Application"})(la||(la={}));class vh{constructor(e=la.Session,t="",s=""){this._cacheLevel=e,this._cacheGroup=t,this._cacheItemName=s}getMetadata(){return{cacheLevel:this._cacheLevel,cacheGroup:this._cacheGroup,cacheItemName:this._cacheItemName}}}class Gr extends Error{constructor(e){const t=e?.error?.responseStatus?.Message||e?.responseStatus?.Message||e?.message;super(t),this.errorCode=e?.error?.responseStatus?.ErrorCode}}class Eu extends Error{constructor(e){super(`Query with config
${JSON.stringify(e.getMetadata())}
finished with error.`)}}let Gn=class extends Ne{constructor(e,t,s){super(),this._sysSettingsService=e,this._httpClient=t,this._dataServiceUri=s,this._defaultDebounceTime=200,this._debounceTimeSysSettingName="QueryExecutorDebounceTime",this._requests=new l.Subject,q.checkArgumentEmpty("_httpClient",t),q.checkArgumentEmpty("_dataServiceUri",s),this._transactions=new Map,this._transactions$=new Map}_executeWritableQuery(e,t){const r={...e.getMetadata(),queryKind:zr.General};return this._httpClient.post(t,r).pipe((0,o.catchError)(n=>{throw new Gr(n)}),(0,o.tap)(n=>{if(!(n&&n.success))throw new Eu(e)}))}_getQueryUri(e){if(e instanceof Ah)return`${this._dataServiceUri}/SelectLocalizationQuery`;if(e instanceof xr)return`${this._dataServiceUri}/SelectQuery`;if(e instanceof Qi)return`${this._dataServiceUri}/InsertQuery`;if(e instanceof Yi)return`${this._dataServiceUri}/UpdateQuery`;if(e instanceof lu)return`${this._dataServiceUri}/DeleteQuery`;throw new Error("Unsupported query type")}_getBundleSettings(){var e=this;return(0,C.A)(function*(){return e._sysSettingsService?{executionDebounceTime:(yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName])).values[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime}:Promise.resolve({executionDebounceTime:e._defaultDebounceTime})})()}_prepareDebouncedResponsesStream(){if(this._responses)return;let e=0;const t=(0,o.buffer)(this._requests.pipe((0,o.switchMap)(()=>(0,l.from)(this._getBundleSettings())),(0,o.tap)(s=>e=s.executionDebounceTime),(0,o.debounceTime)(e)));this._responses=this._requests.pipe(t,(0,o.filter)(s=>!!s.length),(0,o.mergeMap)(s=>{const r=s.map(a=>a.id),n=s.map(a=>a.query);return this.executeBatchSelectQuery(n).pipe((0,o.map)(a=>r.reduce((u,d,h)=>u.set(d,a[h]),new Map)))}),(0,o.share)())}_executeThrottled(e){this._prepareDebouncedResponsesStream();const t={id:(0,L.qv)(),query:e},s=this._responses.pipe((0,o.filter)(r=>r.has(t.id)),(0,o.map)(r=>r.get(t.id)),(0,o.take)(1));return s.subscribe(),this._requests.next(t),s}_executeImmediate(e){q.checkArgumentEmpty("query",e);const t=this._getQueryUri(e),s=this._getQueryRequest(e);return this._httpClient.post(t,s).pipe((0,o.catchError)(r=>{throw new Gr(r)}),(0,o.tap)(r=>{if(!r?.rows)throw new Eu(e)}),(0,o.map)(r=>this._toSelectQueryResponse(r)))}_toSelectQueryResponse(e){const t=this.getRowsFromResponse(e);return t.rowsAffected=e.rowsAffected,e.errorInfo&&(t.errorInfo=e.errorInfo),t}_getQueryRequest(e){const t=e.getMetadata();return e instanceof xr?{...t,queryKind:zr.General,serverESQCacheParameters:new vh().getMetadata(),queryOptimize:!1,useMetrics:!1,querySource:ua.Undefined}:{...t,queryKind:zr.General}}_getTransactionQueries(e){return this._transactions.has(e)||this._transactions.set(e,[]),this._transactions.get(e)}_executeInTransaction(e,t){q.checkArgumentEmpty("transactionId",t),this._getTransactionQueries(t).push(e);const r=new l.Subject;return this._transactions$.set(e.queryId,r),r.asObservable()}_executeBatchQuery(e){if(q.checkArgumentEmpty("config",e),q.checkArgumentEmpty("queries",e.queries),e.queries.length===0)return e.throwIfNoQueries===!0?(0,l.throwError)(()=>new Error("Queries array is empty")):(0,l.of)({hasErrors:!1,queryResults:[]});const t=`${this._dataServiceUri}/BatchQuery`,s={items:e.queries.map(r=>this._getQueryRequest(r))};return e.continueIfError!=null&&(s.continueIfError=e.continueIfError),this._httpClient.post(t,s).pipe((0,o.catchError)(r=>{throw new Gr(r)}),(0,o.tap)(r=>{if(!r||r.hasErrors)throw new Gr(r);for(const n of r.queryResults)if(!n?.success)throw new Gr(n)}))}getRowsFromResponse(e){return e.rows}executeSelectQuery(e,t={throttled:!1},s){return s?(0,l.throwError)(()=>new Error("Not implemented")):t.throttled?this._executeThrottled(e):this._executeImmediate(e)}executeInsertQuery(e,t){return this.execute(e,t)}executeUpdateQuery(e,t){return this.execute(e,t)}executeDeleteQuery(e,t){return this.execute(e,t)}execute(e,t){if(q.checkArgumentEmpty("query",e),t)return this._executeInTransaction(e,t);const s=this._getQueryUri(e);return this._executeWritableQuery(e,s)}executeBatchSelectQuery(e){return this._executeBatchQuery({queries:e}).pipe((0,o.map)(t=>t.queryResults.map(s=>this._toSelectQueryResponse(s))))}commitTransaction(e){const t=this._getTransactionQueries(e);return this._executeBatchQuery({queries:t,continueIfError:!1,throwIfNoQueries:!0}).pipe((0,o.catchError)(s=>(t.forEach(r=>{const n=r.queryId;this._transactions$.get(n).error(s),this._transactions$.delete(n)}),(0,l.throwError)(()=>s))),(0,o.map)(s=>{const r={};return s.queryResults.forEach(n=>{const a=n.queryId,u=this._transactions$.get(a);u.next(n),u.complete(),this._transactions$.delete(a),r[a]=n}),r}),(0,o.tap)(()=>{this._transactions.delete(e)}))}rollbackTransaction(e){const t=this._getTransactionQueries(e),s={};return t.forEach(r=>{const n=r.queryId,a=this._transactions$.get(n),u={success:!1,rowsAffected:0,errorInfo:{message:"Transaction rollback",errorCode:"TransactionRollback",stackTrace:null}};s[n]=u,a.error(u),this._transactions$.delete(n)}),this._transactions.delete(e),(0,l.of)(s)}};Gn=(0,f.__decorate)([(0,f.__param)(0,(0,c.Optional)()),(0,f.__param)(2,(0,c.Inject)(Kn)),(0,f.__metadata)("design:paramtypes",[ve,V.HttpClient,String])],Gn);let da=class Ti extends Gn{constructor(e,t,s,r){super(e,t,r),this._entityDeserializer=s}getRowsFromResponse(e){return this._entityDeserializer.deserializeEntities(e.rowConfig,e.rows)}static#e=this.\u0275fac=function(t){return new(t||Ti)(c.\u0275\u0275inject(ve,8),c.\u0275\u0275inject(V.HttpClient),c.\u0275\u0275inject(ys),c.\u0275\u0275inject(Kn))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ti,factory:Ti.\u0275fac})};da=(0,f.__decorate)([(0,P.op)({requestType:"crt.DataServiceQueryExecutor"}),(0,f.__metadata)("design:paramtypes",[ve,V.HttpClient,ys,String])],da);class Mu{constructor(e,t){this._transaction=e,this._action=t,this._id=(0,L.qv)(),this._payload={},this._ready=new Promise(s=>{this._readyResolve=s,this._asyncResult=this._action(this)})}get id(){return this._id}get transactionId(){return this._transaction.id}get asyncResult(){return this._asyncResult}get ready(){return this._ready}get payload(){return this._payload}markAsReady(){this._readyResolve()}}class Eh{get id(){return this._id}constructor(e){this._queryExecutor=e,this._id=(0,L.qv)(),this._transactionOperations=[]}createOperation(e){const t=new Mu(this,e);return this._transactionOperations.push(t),t}createFailureOperation(e){const t=new Mu(this,s=>(s.markAsReady(),Promise.reject(e)));return this._transactionOperations.push(t),t}commit(){var e=this;return(0,C.A)(function*(){yield Promise.all(e._transactionOperations.map(r=>r.ready));let t=null;try{yield(0,l.firstValueFrom)(e._queryExecutor.commitTransaction(e._id))}catch(r){t=r}const s={};for(const r of e._transactionOperations)s[r.id]=yield r.asyncResult;if(t)throw t;return s})()}rollback(){var e=this;return(0,C.A)(function*(){yield(0,l.firstValueFrom)(e._queryExecutor.rollbackTransaction(e._id))})()}}let Wn=class Ni{constructor(e){this._queryExecutor=e}create(){return Promise.resolve(new Eh(this._queryExecutor))}static#e=this.\u0275fac=function(t){return new(t||Ni)(c.\u0275\u0275inject(Ne))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ni,factory:Ni.\u0275fac})};Wn=(0,f.__decorate)([(0,P.op)({requestType:"crt.TransactionFactoryService"}),(0,f.__metadata)("design:paramtypes",[Ne])],Wn);class Wr{static#e=this.\u0275fac=function(t){return new(t||Wr)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Wr});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[vu,{provide:Ne,useClass:da},{provide:zn,useClass:Wn}]})}class ha{static#e=this.\u0275fac=function(t){return new(t||ha)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:ha});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[vu,{provide:Ne,useFactory:(e,t,s)=>new Gn(e,t,s),deps:[[new c.Optional,ve],V.HttpClient,Kn]},{provide:zn,useClass:Wn}]})}var Iu=y(93277);class Zr{constructor(e){this.data=e}static#e=this.\u0275fac=function(t){return new(t||Zr)(c.\u0275\u0275directiveInject(re.MAT_LEGACY_DIALOG_DATA))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:Zr,selectors:[["ts-info-with-header-dialog"]],decls:9,vars:10,consts:[[1,"header-message"],[1,"message"],[1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(3,"div",1),c.\u0275\u0275text(4),c.\u0275\u0275pipe(5,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(6,"button",2),c.\u0275\u0275text(7),c.\u0275\u0275pipe(8,"translate"),c.\u0275\u0275elementEnd()),t&2&&(c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(2,4,s.data==null?null:s.data.headerMessage)),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(5,6,s.data==null?null:s.data.message)),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",s.data==null||s.data.button==null?null:s.data.button.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(8,8,s.data==null||s.data.button==null?null:s.data.button.caption),`
`))},dependencies:[re.MatLegacyDialogClose,O.TranslatePipe],styles:[".header-message[_ngcontent-%COMP%]{margin-bottom:24px}.message[_ngcontent-%COMP%]{margin-bottom:40px;white-space:pre-wrap}.action-button[_ngcontent-%COMP%]{float:right;text-transform:none;border-radius:16px;padding:0 16px}"]})}class bs{static#e=this.\u0275fac=function(t){return new(t||bs)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:bs});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[xt,{provide:Iu.FocusTrapFactory,useClass:Iu.ConfigurableFocusTrapFactory}],imports:[w.CommonModule,ss.MatLegacyButtonModule,re.MatLegacyDialogModule,O.TranslateModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(bs,{declarations:[is,as,os,Zr],imports:[w.CommonModule,ss.MatLegacyButtonModule,re.MatLegacyDialogModule,O.TranslateModule],exports:[is,os,Zr,as]})})();class Mh{processResponse(e,t){return e.skipUnsuccessfulResponse||(t=t.pipe((0,o.tap)(s=>this.processUnsuccessfulResponse(s)))),t}processUnsuccessfulResponse(e){const{success:t,errorInfo:s}=e||{};!t&&s&&this.processErrorMessage(s.message)}handleRequest(e,t={}){let s=e;return s=this.processResponse(t,s),s.pipe((0,o.catchError)(r=>{let n;return r instanceof Error?n=r.message:(typeof r.error?.errorInfo=="object"&&(n=r.error.errorInfo.message),typeof r.error=="string"&&(n=r.error)),n||(n=JSON.stringify(r.message)),this.processErrorMessage(n),(0,l.throwError)(()=>new Error(n))}))}}class Ih extends Mh{constructor(){super(...arguments),this._accumulatedErrorResponses=[]}_accumulateError(e){const t=(0,D.cloneDeep)(e);this._accumulatedErrorResponses.push(t)}_stopAccumulatingErrors(){this._accumulatedErrorResponses=[]}get accumulatedErrorResponses(){return this._accumulatedErrorResponses}processUnsuccessfulResponse(e){if(this._accumulateErrors&&this.canAccumulate(e)){this._accumulateError(e),this.processAccumulatedResponse(e);return}this.processSeparatedResponse(e)}handleRequestWithAccumulation(e,t){let s=!1;return this._accumulateErrors||(this._accumulateErrors=!0,s=!0),this.handleRequest(e,t).pipe((0,o.tap)(()=>{s&&(this.showAccumulatedErrors(),this._stopAccumulatingErrors())}),(0,o.catchError)(r=>{throw this._stopAccumulatingErrors(),r}))}}class Jr extends Ih{constructor(e,t){super(),this._dialogService=e,this._errorListDialogService=t,this._subscription=new l.Subscription}_showValidationErrors(e,t){this._subscription.add(this._errorListDialogService.showValidationErrors(e,t).subscribe())}processAccumulatedResponse(e){const t=e;t.success=!0,delete t.errorInfo,delete t.validationErrors}canAccumulate(e){return e?.errorInfo?.errorCode==="AutoAddPackageDependenciesValidateException"}showAccumulatedErrors(){const e=(0,D.cloneDeep)(this.accumulatedErrorResponses),t=e.shift();if(e.forEach(s=>{const r=s,n=t.validationErrors??[],a=r.validationErrors,u=n.some(d=>a?.find(h=>(0,D.isEqual)(h,d)));!(0,D.isEmpty)(a)&&!u&&(t.validationErrors=[...n,...a])}),t){const s=t.errorInfo?.message;this._showValidationErrors(s,t.validationErrors)}}processSeparatedResponse(e){const{validationErrors:t,errorInfo:s}=e||{};t?.length>0?this._showValidationErrors(s.message,t):s&&s.message&&this.processErrorMessage(s.message)}processErrorMessage(e){this._dialogService.openErrorDialog(e)}ngOnDestroy(){this._subscription.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||Jr)(c.\u0275\u0275inject(xt),c.\u0275\u0275inject(Ct))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Jr,factory:Jr.\u0275fac})}class Ss{static#e=this.\u0275fac=function(t){return new(t||Ss)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Ss});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Ct,Jr],imports:[w.CommonModule,bs]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Ss,{imports:[w.CommonModule,bs]})})();var xe=y(56711);class Xr extends kn{constructor(){super(...arguments),this.requestType="crt.FeatureService"}}(0,f.__decorate)([He(),(0,f.__metadata)("design:type",Function)],Xr.prototype,"getFeatureState",void 0),(0,f.__decorate)([He(),(0,f.__metadata)("design:type",Function)],Xr.prototype,"getFeaturesState",void 0);function Ru(i){return e=>Qt(i,e)}var Rh=y(72051),wh=y(30293);const wu="crt-business-rules-cache";var oe;(function(i){i.ChangeAttributeValue="ChangeAttributeValue",i.ChangeAttributeProperty="ChangeAttributeProperty",i.DataLoaded="DataLoaded",i.ContextReady="ContextReady"})(oe||(oe={}));var Oe;(function(i){i.Model="Model",i.ViewModel="ViewModel"})(Oe||(Oe={}));var At;(function(i){i.Unknown="Unknown",i.Init="Init",i.Create="Create",i.Copy="Copy",i.Update="Update"})(At||(At={}));const Pu=new Map([[0,oe.ChangeAttributeValue],[1,oe.ChangeAttributeProperty],[2,oe.DataLoaded]]);function Zn(i){return Pu.has(i)?Pu.get(i):oe.DataLoaded}class Cs{canExecute(e,t,s){const r=s.map(a=>a.triggers).flat();return r.length===0?!1:(e?.triggers??[]).some(a=>a.type===oe.ContextReady)?s.some(a=>a.triggers.some(u=>Zn(u.type)===oe.DataLoaded&&!u.name)):r.some(a=>{const u=Zn(a.type);if(u===oe.DataLoaded&&e.scopeType===Oe.Model)return e.triggers.some(h=>h.type===oe.DataLoaded);if(!a.scopeId)return e.triggers.some(h=>h.name===a.name&&h.type===u);const d=t.find(h=>h.scopeId===a.scopeId);return d==null?!1:d.triggers.some(h=>h.name===a.name&&h.type===u)})}static#e=this.\u0275fac=function(t){return new(t||Cs)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Cs,factory:Cs.\u0275fac})}const Ph="Terrasoft.Core.BusinessRules.Models.Conditions.BusinessRuleGroupCondition";function Du(i){return i&&"path"in i?i.path:""}function Dh(i){const e=[];return i.conditions&&i.conditions.forEach(t=>{const s=Tu(t);e.push(...s)}),e}function Tu(i){if(Nu(i))return Dh(i);const e=i;return[Du(e.leftExpression),Du(e.rightExpression)].filter(t=>t)}function Th(i,e){return i.flatMap(t=>e.get(t).getRequiredItems()).map(t=>t.name)}function Nu(i){return i.typeName===Ph}function Vu(i){return i.map(e=>Tu(e)).flat().filter(e=>e!=null)}function Nh(i,e){return i.flatMap(t=>t.cases.flatMap(s=>Th(s.actions,e)))}function Vh(i){return!i.cases||i.cases.length===0?[]:i.cases.map(e=>e.condition).filter(e=>e!=null)}function xu(i){return i.map(e=>Vh(e)).flat()}var As;(function(i){i.Const="Const",i.SysValue="SysValue",i.SysSetting="SysSetting",i.AttributeValue="AttributeValue",i.AttributeProperty="AttributeProperty",i.Formula="Formula"})(As||(As={}));const xh=[As.Const,As.SysValue,As.SysSetting],Oh=new Set(xh);function Ou(i){return i?!!i.type&&Oh.has(i.type):!0}function Lh(i){return i.conditions?i.conditions.every(e=>Lu(e)):!1}function Lu(i){if(!i)return!1;if(Nu(i))return Lh(i);const e=i;return(0,D.isNil)(e.leftExpression)&&(0,D.isNil)(e.rightExpression)?!1:Ou(e.leftExpression)&&Ou(e.rightExpression)}function Bu(i){return i.some(e=>e.type===oe.ContextReady)}function Bh(i,e){return Bu(i)?e.some(t=>Lu(t)):!1}function kh(i,e){return Bu(i)?e.some(t=>t.cases?.some(s=>!s.condition)):!1}class vs{_canExecuteByConditionsAttributePaths(e,t){const s=e.filter(n=>n.type!==oe.DataLoaded).map(n=>n.name);if(!s||s.length===0)return!1;const r=new Set(Vu(t));return s.some(n=>r.has(n))}canExecute(e,t){if(!t||t.length===0)return!1;const s=xu(t),r=Bh(e.triggers,s),n=kh(e.triggers,t);return r||n?!0:this._canExecuteByConditionsAttributePaths(e.triggers,s)}static#e=this.\u0275fac=function(t){return new(t||vs)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:vs,factory:vs.\u0275fac})}class rt{static#e=this._actionAppliers=new Map;static register(e,t){rt._actionAppliers.set(e,t)}get(e){const t=rt._actionAppliers.get(e.typeName);if(!t)throw new Error(`Business rule applier for change type ${e.typeName} not found.`);return new t(e)}static#t=this.\u0275fac=function(t){return new(t||rt)};static#s=this.\u0275prov=c.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac})}class Es{constructor(e){this._actionApplierFactory=e}_applyBusinessRuleAction(e,t,s){const r=this._actionApplierFactory.get(s);return(0,l.firstValueFrom)(r.apply(e,t))}_applyBusinessRule(e,t){var s=this;return(0,C.A)(function*(){const r={id:t.scopeId,name:t.scopeName,type:t.scopeType,triggers:t.triggers};if(t.actions.length===0)return Promise.resolve(null);const n=[];for(const a of t.actions){const u=yield s._applyBusinessRuleAction(e,r,a);n.push(u)}return n})()}_applyBusinessRules(e,t){var s=this;return(0,C.A)(function*(){const r=[];for(const n of t){const a=yield s._applyBusinessRule(e,n);r.push(a)}return r})()}applyRules(e,t){return t&&t.length>0?(0,l.from)(this._applyBusinessRules(e,t)):(0,l.of)(null)}static#e=this.\u0275fac=function(t){return new(t||Es)(c.\u0275\u0275inject(rt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Es,factory:Es.\u0275fac})}class ku{constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.enabled=!0,this.uId=e?.uId||(0,L.qv)(),e&&(this.enabled=e.enabled)}toMetadata(){return{typeName:this.typeName,uId:this.uId,enabled:this.enabled}}getTypeName(){return this.typeName}getApplicability(){return[]}isValid(){return!0}onDataSourceAttributeNameChanged(e,t,s){}isAttributeUsed(e,t){return!1}getAffectedItems(){return[]}getRequiredItems(){return[]}}const Fh="businessRuleActionDesignerType";function we(i){return function(e){Reflect.defineMetadata(Fh,i,e)}}class qt{get dataValueTypeName(){return this._dataValueTypeName}set dataValueTypeName(e){this._dataValueTypeName=e}get isLookup(){return this.dataValueTypeName===Bn.Q[v.r.Lookup].name}get referenceSchemaName(){return this._referenceSchemaName}set referenceSchemaName(e){this._referenceSchemaName!==e&&(this._referenceSchemaName=e)}constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleExpression",this._dataValueTypeName="",this._referenceSchemaName="",this.type=As.Const,this.uId=e?.uId||(0,L.qv)(),e&&(this._dataValueTypeName=e.dataValueTypeName??"",this.type=e.type||this.type,this._referenceSchemaName=e.referenceSchemaName??"")}toMetadata(){return{typeName:this.typeName,uId:this.uId,type:this.type,dataValueTypeName:this.dataValueTypeName,referenceSchemaName:this.referenceSchemaName}}copy(){return new qt({...this.toMetadata(),uId:(0,L.qv)()})}isValid(){return!!this.uId}onDataSourceAttributeNameChanged(e,t,s){}getAffectedItem(){return null}clear(){throw new Error(`clear not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}setValue(e){throw new Error(`setValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}getValue(){throw new Error(`getValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isEmpty(){throw new Error(`isEmpty not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isAttributeUsed(e,t){return!1}}class Jn{static#e=this._expressionsTypes=new Map;static register(e,t){this._expressionsTypes.set(e,t)}static _getExpressionType(e){return this._expressionsTypes.get(e)??null}get(e){if(!e)return new qt;const t=Jn._getExpressionType(e.typeName);return t?new t(e):new qt(e)}}function jh(i,e){return!!e?.find(s=>!s.scopeId&&s.triggers.find(r=>r.name===i.name))}function $h(i,e){return!!e?.find(s=>s.scopeName===i.scopeName&&s.triggers?.find(r=>r.name===i.name))}function Uh(i,e,t){if(e.scopeName===i){if(jh(e,t))return!1}else if($h(e,t))return!1;return!0}function Fu(i,e){return i===e||ju(i)&&ju(e)}function ju(i){return!i||i==="null"}function pa(i){return function(e){Jn.register(i.typeName,e)}}var ma;let fa=ma=class extends qt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression",this.path="",this.scopeId="",e&&(this.path=e.path,this.scopeId=e.scopeId==="null"?"":e.scopeId)}toMetadata(){return{...super.toMetadata(),path:this.path,scopeId:this.scopeId}}copy(){return new ma({...this.toMetadata(),uId:(0,L.qv)()})}isValid(){return super.isValid()&&!!this.path}onDataSourceAttributeNameChanged(e,t,s){this.scopeId===e&&this.path===t&&(this.path=s)}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t&&Fu(this.scopeId,e)}};fa=ma=(0,f.__decorate)([pa({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression"}),(0,f.__metadata)("design:paramtypes",[Object])],fa);var Xn;let vt=Xn=class extends ku{constructor(e){super(e),this._expressionFactory=new Jn,this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.executorName="",e&&(this.executorName=e.executorName,this.expression=new fa(e.expression),e.value&&(this.value=this._expressionFactory.get(e.value)))}getExpressionAffectedItems(){const e=this.expression?.getAffectedItem()??null;return e?[e]:[]}toMetadata(){return{...super.toMetadata(),executorName:this.executorName,expression:this.expression?.toMetadata(),value:this.value?.toMetadata()}}clone(){return new Xn(this.toMetadata())}copy(){const e=new Xn({...this.toMetadata(),uId:(0,L.qv)()});return e.expression=this.expression?.copy(),e.value=this.value?.copy(),e}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();return t?[{path:t}]:[]}isValid(){return super.isValid()&&!!this.expression?.isValid()&&!!this.value?.isValid()}getAffectedItems(){const e=this.getExpressionAffectedItems();return[...super.getAffectedItems(),...e]}};vt=Xn=(0,f.__decorate)([we("BusinessRuleDesignAction"),(0,f.__metadata)("design:paramtypes",[Object])],vt);class qh extends ku{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetProperty"}}class Ms extends qh{constructor(e){super(e),this.items=[],e&&(Array.isArray(e.items)?this.items=e.items:this.items=e.items?.length>0?e.items.split(","):[])}_getAffectedItems(){return(this.items??[]).map(t=>({name:t}))}toMetadata(){return{...super.toMetadata(),items:this.items?.length>0?this.items.join(","):""}}getApplicability(){return this.isValid()?this.items.map(e=>({path:e})):[]}isValid(){return super.isValid()&&this.items?.length>0}getAffectedItems(){return[...super.getAffectedItems(),...this._getAffectedItems()]}isAttributeUsed(e,t){return this.items.includes(t)}}var Yn;const Hh="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement";let ga=Yn=class extends Ms{constructor(){super(...arguments),this.typeName=Hh}clone(){return new Yn(this.toMetadata())}copy(){return new Yn({...this.toMetadata(),uId:(0,L.qv)()})}};ga=Yn=(0,f.__decorate)([we("BusinessRuleEditableElementDesignAction")],ga);var _a;let Qn=_a=class extends qt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression",this.path="",this.filterExpression="",e&&(this.path=e.path,this.filterExpression=e.filterExpression==="null"?"":e.filterExpression)}toMetadata(){return{...super.toMetadata(),path:this.path,filterExpression:this.filterExpression}}copy(){return new _a({...this.toMetadata(),uId:(0,L.qv)()})}isValid(){return super.isValid()&&!!this.path&&!!this.filterExpression}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t}};Qn=_a=(0,f.__decorate)([pa({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression"}),(0,f.__metadata)("design:paramtypes",[Object])],Qn);var ei;let ya=ei=class extends vt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup",this.clearValue=!1,this.populateValue=!1,e?(this.clearValue=e.clearValue??!1,this.populateValue=e.populateValue??!1):(this.clearValue=!0,this.populateValue=!0),this._processMetadata(e)}_isOldMetadataFormat(e){const t=!!e.expression?.path&&e.expression.path!=="null",s=e.value,r=!!s?.value&&s.value!=="null";return t&&r}_convertOldMetadata(e){const t={...e},s=e.expression?.path||"",n=e.value?.value,a={path:n,filterExpression:""},u={path:s,filterExpression:""};if(n.includes(".")){const[d,...h]=n.split(".");a.path=d,a.filterExpression=h.join(".")}return{...t,leftExpression:a,rightExpression:u}}_processMetadata(e){e&&(this._isOldMetadataFormat(e)&&(e=this._convertOldMetadata(e)),delete this.expression,delete this.value,this.leftExpression=new Qn(e?.leftExpression),this.rightExpression=new Qn(e?.rightExpression))}toMetadata(){return{...super.toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue}}clone(){return new ei({...this.toMetadata()})}copy(){return new ei({...super.copy().toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue})}getApplicability(){return this.leftExpression?.path?[{path:this.leftExpression.path}]:[]}isValid(){return!!this.leftExpression?.isValid()&&!!this.rightExpression?.path}getAffectedItems(){const e=this.leftExpression?.getAffectedItem()??null,t=[...super.getAffectedItems()];return e&&t.push(e),t}getRequiredItems(){return[this.rightExpression?.getAffectedItem()].filter(e=>e)}isAttributeUsed(e,t){return this.leftExpression.isAttributeUsed(e,t)||this.rightExpression.isAttributeUsed(e,t)}};ya=ei=(0,f.__decorate)([we("BusinessRuleFilterLookupAction"),(0,f.__metadata)("design:paramtypes",[Object])],ya);var ti;let ba=ti=class extends Ms{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"}clone(){return new ti(this.toMetadata())}copy(){return new ti({...this.toMetadata(),uId:(0,L.qv)()})}};ba=ti=(0,f.__decorate)([we("BusinessRuleHideElementDesignAction")],ba);var si;const $u="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionOptionalElement";let Sa=si=class extends Ms{constructor(){super(...arguments),this.typeName=$u}clone(){return new si(this.toMetadata())}copy(){return new si({...this.toMetadata(),uId:(0,L.qv)()})}};Sa=si=(0,f.__decorate)([we("BusinessRuleOptionalElementDesignAction")],Sa);var ri;const Kh="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement";let Ca=ri=class extends Ms{constructor(){super(...arguments),this.typeName=Kh}clone(){return new ri(this.toMetadata())}copy(){return new ri({...this.toMetadata(),uId:(0,L.qv)()})}};Ca=ri=(0,f.__decorate)([we("BusinessRuleReadOnlyElementDesignAction")],Ca);var ni;const Uu="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionRequiredElement";let Aa=ni=class extends Ms{constructor(){super(...arguments),this.typeName=Uu}clone(){return new ni(this.toMetadata())}copy(){return new ni({...this.toMetadata(),uId:(0,L.qv)()})}};Aa=ni=(0,f.__decorate)([we("BusinessRuleRequiredElementDesignAction")],Aa);class qu{static _getPrimaryDisplayAttributeName(e){return(0,C.A)(function*(){return(yield e.getSchema()).primaryDisplayAttributeName})()}static getLookupValue(e,t){var s=this;return(0,C.A)(function*(){const r=yield _t.create(e),n=yield r.getSchema(),a=[n.primaryAttributeName,n.primaryDisplayAttributeName];n.primaryColorAttributeName&&a.push(n.primaryColorAttributeName);const u=yield r.load({parameters:[{type:F.PrimaryColumnValue,value:t}],attributes:a});if(!u||u.length===0)throw new Error(`Can't find value for '${t}'`);if(u.length>1)throw new Error(`Load more than 1 data row for '${t}'`);const d=u[0],h=yield s._getPrimaryDisplayAttributeName(r),g={value:t,displayValue:d[h]};return n.primaryColorAttributeName&&(g.primaryColorValue=d[n.primaryColorAttributeName]),g})()}}var va;let Ea=va=class extends qt{get value(){return this._value}set value(e){this._value!==e&&(this._displayValueInitialized=!1,this._value=e)}get referenceSchemaName(){return super.referenceSchemaName}set referenceSchemaName(e){this.referenceSchemaName!==e&&(super.referenceSchemaName=e,this._displayValueInitialized=!1)}get displayValue(){return this.isLookup&&this.referenceSchemaName?this._displayValueInitialized?this._displayValue:null:(this._displayValue=this.value,this._displayValueInitialized=!0,this._displayValue)}set displayValue(e){this._displayValue=e??"",this._displayValueInitialized=e!=null}get dataValueTypeName(){return super.dataValueTypeName}set dataValueTypeName(e){this.dataValueTypeName!==e&&(super.dataValueTypeName=e,this._displayValueInitialized=!1)}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression",this._value="",this._displayValue="",this._displayValueInitialized=!1,e&&(this._value=e.value)}initDisplayValue(){var e=this;return(0,C.A)(function*(){if(e._displayValueInitialized)return Promise.resolve(e._displayValue);if(e.isLookup&&e.referenceSchemaName&&e._value){const t=yield qu.getLookupValue(e.referenceSchemaName,e._value);e._displayValue=t.displayValue}else e._displayValue=e.value;return e._displayValueInitialized=!0,Promise.resolve(e._displayValue)})()}toMetadata(){return{...super.toMetadata(),value:this.value}}copy(){return new va({...this.toMetadata(),uId:(0,L.qv)()})}isValid(){return super.isValid()?this.isLookup?(0,L.n7)(this.value):this.value!=null&&this.value!=="":!1}clear(){this._value="",this._displayValue="",this._displayValueInitialized=!1}setValue(e){e?(this.value=e.value,this.displayValue=e.displayValue):this.clear()}getValue(){return{value:this.value,displayValue:this.displayValue}}isEmpty(){return!this.value}};Ea=va=(0,f.__decorate)([pa({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression"}),(0,f.__metadata)("design:paramtypes",[Object])],Ea);var ii;let Ma=ii=class extends vt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter",e&&(this.value=new Ea(e.value))}clone(){return new ii(this.toMetadata())}copy(){return new ii(super.copy().toMetadata())}getApplicability(){return this.expression?.path?[{path:this.expression.path}]:[]}isAttributeUsed(e,t){return this.expression.isAttributeUsed(e,t)}};Ma=ii=(0,f.__decorate)([we("BusinessRuleSetFilterAction"),(0,f.__metadata)("design:paramtypes",[Object])],Ma);var ai;let Ia=ai=class extends vt{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"}clone(){return new ai(this.toMetadata())}copy(){return new ai(super.copy().toMetadata())}};Ia=ai=(0,f.__decorate)([we("BusinessRuleSetValueDesignAction")],Ia);var Ra;(function(i){i.DataSource="DataSource",i.Page="Page"})(Ra||(Ra={}));var oi;let wa=oi=class extends vt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleSetValueItem",this.scope=e?.scopeId??"",this.scope==="null"&&(this.scope="")}clone(){return new oi(this.toMetadata())}copy(){return new oi({...super.copy().toMetadata(),scopeId:this.scope})}toMetadata(){return{...super.toMetadata(),scopeId:this.scope}}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();if(!t)return[];const s={path:t};return this.scope!==""&&(s.applicability=Ra.DataSource,s.scope=this.scope),[s]}isAttributeUsed(e,t){return this.expression.path===t&&Fu(this.scope,e)}};wa=oi=(0,f.__decorate)([we("BusinessRuleSetValueItem"),(0,f.__metadata)("design:paramtypes",[Object])],wa);var ci;let Pa=ci=class extends vt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues",this.items=[],e&&(this.items=e.items?.map(t=>new wa(t)))}getExpressionAffectedItems(){return[]}clone(){return new ci(this.toMetadata())}copy(){return new ci({...super.copy().toMetadata(),items:this.items.map(e=>e.toMetadata())})}toMetadata(){const e={...super.toMetadata(),items:this.items?.length>0?this.items.map(t=>t.toMetadata()):[]};return this.items?.length>0&&(delete e.expression,delete e.value),e}getApplicability(){return this.items?.length?this.items.flatMap(e=>e.getApplicability()):[]}isValid(){return this.items?.length>0&&this.items.every(e=>e.isValid())}getAffectedItems(){const t=(this.items??[]).map(s=>s.getAffectedItems()).flat();return[...super.getAffectedItems(),...t]}getRequiredItems(){return this.getAffectedItems()}isAttributeUsed(e,t){return this.items.some(s=>s.isAttributeUsed(e,t))}};Pa=ci=(0,f.__decorate)([we("BusinessRuleSetValuesDesignAction"),(0,f.__metadata)("design:paramtypes",[Object])],Pa);var ui;let Da=ui=class extends Ms{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"}clone(){return new ui(this.toMetadata())}copy(){return new ui({...this.toMetadata(),uId:(0,L.qv)()})}};Da=ui=(0,f.__decorate)([we("BusinessRuleShowElementDesignAction")],Da);class Is{get(e){return e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"?new Da(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"?new ba(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement"?new Ca(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement"?new ga(e):e.typeName===$u?new Sa(e):e.typeName===Uu?new Aa(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup"?new ya(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter"?new Ma(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"?new Ia(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues"?new Pa(e):new vt(e)}static#e=this.\u0275fac=function(t){return new(t||Is)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Is,factory:Is.\u0275fac,providedIn:"root"})}var li;(function(i){i[i.Condition=0]="Condition",i[i.Action=1]="Action",i[i.Trigger=2]="Trigger",i[i.Context=3]="Context",i[i.Unknown=4]="Unknown"})(li||(li={}));class zh{}class Rs extends zh{constructor(e,t){super(),this._httpClient=e,this._cacheManager=t,this._cachedLoadScopesRequests=new Map,this.serviceEndpoint="/ServiceModel/BusinessRulesManagerService.svc/",this.getBusinessRulesConfigMethodName="GetBusinessRules"}_getBusinessRulesCache(){return(0,l.from)(this._cacheManager.get(wu))}_getCachedBusinessRulesScopes(e){const t=e.map(s=>{const r=this._getContextCacheKey(s.scopeType,s.scopeName);return this._getBusinessRulesCache().pipe((0,l.switchMap)(n=>(0,l.from)(n.get(r))),(0,l.map)(n=>n?{rules:n,scopeName:s.scopeName,scopeType:s.scopeType}:null))});return t.length?(0,l.forkJoin)(t):(0,l.of)([])}_getScopeType(e){return e==="Model"?Oe.Model:Oe.ViewModel}_mapResponseToBusinessRules(e){return!e?.businessRules||e.businessRules.length===0?[]:e.businessRules.map(t=>{const s=JSON.parse(t.businessRulesConfig);return{scopeName:t.schemaName,scopeType:this._getScopeType(t.type),rules:s}})}_getContextsScopeNames(e){return e.map(t=>t.scopeName)}_getContextCacheKey(e,t){return`Type:#${e}#-Name:#${t}#`}_getContextsScopeNamesRequestKey(e){return e.map(s=>this._getContextCacheKey(s.scopeType,s.scopeName)).join("_")}_getCachedLoadScopesRequest(e){const t=e.map(r=>this._getContextCacheKey(r.scopeType,r.scopeName)),s=[...this._cachedLoadScopesRequests.keys()].find(r=>t.every(n=>r.includes(n)));return this._cachedLoadScopesRequests.get(s)}_getNotLoadedBusinessRulesScopes(e){if(e.length===0)return(0,l.of)([]);const t=this._getContextsScopeNames(e),s=this._getCachedLoadScopesRequest(e);if(s)return s.request$.pipe((0,l.map)(u=>u.filter(d=>t.includes(d.scopeName))));const r=`${this.serviceEndpoint}${this.getBusinessRulesConfigMethodName}`,n={scopes:Array.from(new Map(e.map(u=>[this._getContextCacheKey(u.scopeType,u.scopeName),{name:u.scopeName,type:u.scopeType,modelType:u.modelType}])).values())},a=this._httpClient.post(r,n).pipe((0,l.map)(u=>this._mapResponseToBusinessRules(u)),(0,l.switchMap)(u=>{const d=u.map(h=>{const g=this._getContextCacheKey(h.scopeType,h.scopeName);return this._getBusinessRulesCache().pipe((0,l.switchMap)(b=>(0,l.from)(b.set(g,h.rules))))});return d.length?(0,l.forkJoin)(d).pipe((0,l.map)(()=>u)):(0,l.of)(u)}),(0,l.tap)(()=>{const u=this._getContextsScopeNamesRequestKey(e);this._cachedLoadScopesRequests.delete(u)}),(0,l.share)());return this._cachedLoadScopesRequests.set(this._getContextsScopeNamesRequestKey(e),{request$:a,scopeNames:t}),a}getBusinessRulesByContexts(e){const t=e.filter(s=>s.scopeName&&s.modelType!=="crt.PageParametersDataSource");return(0,l.from)(this._getCachedBusinessRulesScopes(t)).pipe((0,l.switchMap)(s=>{const r=t.filter(a=>!s?.some(u=>u?.scopeName===a.scopeName&&u.scopeType===a.scopeType));return this._getNotLoadedBusinessRulesScopes(r).pipe((0,l.map)(a=>[...s,...a].filter(Boolean)),(0,l.catchError)(a=>{const u=t?.map(d=>d.scopeName).join(", ");return console.warn(`An error occurred during getting business rules execution for scopes: ${u}.`,a),(0,l.of)([])}))}))}clearCachedBusinessRules(){return this._getBusinessRulesCache().pipe((0,l.switchMap)(e=>(0,l.from)(e.clear())),(0,l.map)(()=>!0))}static#e=this.\u0275fac=function(t){return new(t||Rs)(c.\u0275\u0275inject(V.HttpClient),c.\u0275\u0275inject(Vn.G))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Rs,factory:Rs.\u0275fac,providedIn:"root"})}class Yr{constructor(e,t){this._businessRulesManager=e,this._businessRuleDesignActionFactory=t,this._scopeAttributes=[]}_filterTriggers(e,t){const s=t.filter(a=>a.scopeName===e.parentScopeId),n=t.find(a=>a.scopeName===e.scopeName&&a.scopeType===e.scopeType)?.rules.map(a=>a.triggers).flat();return e.triggers.filter(a=>{if(a.type===oe.ContextReady||a.type===oe.DataLoaded)return!0;const u=n?.some(g=>g&&g.name===a.name&&Zn(g.type)===a.type),h=s.flatMap(g=>g.rules.flatMap(b=>b.triggers)).some(g=>g.name===a.name&&Zn(g.type)===a.type);return u||h})}_filterAttributes(e){const s=this._scopeAttributes.filter(a=>a.scopeName===e.scopeName).map(a=>a.attributes).flat(),r=this._scopeAttributes.filter(a=>a.scopeName!==e.scopeName).flatMap(a=>[...a.attributes]);return e.attributes.filter(a=>s.includes(a.attributeName)||r.includes(a.attributeName)||a.isSignificant)}_cacheUsedAttributes(e){e.forEach(t=>{if(!this._scopeAttributes.find(s=>s.scopeName===t.scopeName&&s.scopeType===t.scopeType)){const s=xu(t.rules),r=Vu(s),n=Nh(t.rules,this._businessRuleDesignActionFactory),a=t.rules.flatMap(u=>u.triggers?.map(d=>d.name)).filter(Boolean);this._scopeAttributes.push({scopeName:t.scopeName,scopeType:t.scopeType,attributes:[...r,...n,...a]})}})}_hasActiveRules(e,t){return(t.find(a=>a.scopeName===e.scopeName&&a.scopeType===e.scopeType)?.rules??[]).filter(a=>a.enabled===!0).length>0}clearCachedScopeAttributes(){this._scopeAttributes=[]}filter(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,l.tap)(t=>this._cacheUsedAttributes(t)),(0,l.map)(t=>e.map(r=>({...r,attributes:this._filterAttributes(r),triggers:this._filterTriggers(r,t)})).filter(r=>this._hasActiveRules(r,t)?!0:r.attributes.length>0)))}static#e=this.\u0275fac=function(t){return new(t||Yr)(c.\u0275\u0275inject(Rs),c.\u0275\u0275inject(Is))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Yr,factory:Yr.\u0275fac,providedIn:"root"})}class ws{constructor(e,t,s,r,n,a,u){this._businessRulesManager=e,this._businessRulesTriggerExecutor=t,this._businessRulesConditionExecutor=s,this._httpClient=r,this._messageChannelService=n,this._featureService=a,this._contextFilter=u,this._businessRulesResponseEventName="BusinessRuleExecutionResponse",this._serviceUrl="ServiceModel/BusinessRulesEngineService.svc/Execute",this._businessRulesRequestEventName="BusinessRuleExecutionRequest",this._businessRuleDesignActionFactory=new Is,this._configurationStructureChangedSubscribe()}_configurationStructureChangedSubscribe(){this._messageChannelService.getMessages("ConfigurationStructureChanged").pipe((0,o.switchMap)(()=>(this._contextFilter.clearCachedScopeAttributes(),this._businessRulesManager.clearCachedBusinessRules()))).subscribe()}_featureStates(){return(0,l.from)(this._featureService.getFeaturesState(["BRules-UseWebSocketChannel","BRules-DisableContextOptimization"])).pipe((0,o.map)(([e,t])=>({useHttpChannel:!e,disableContextOptimization:t})))}_sendWebSocketMessage(e){const t=(0,L.qv)();return e.businessRulesSessionId=t,new l.Observable(s=>{const r=this._messageChannelService.messageEvent$.pipe((0,o.map)(n=>n.body),(0,o.filter)(n=>n!=null),(0,o.filter)(n=>n.eventName===this._businessRulesResponseEventName),(0,o.filter)(n=>n.businessRulesSessionId===t),(0,o.map)(n=>n.payload)).subscribe({next:n=>{r.unsubscribe(),n.success?s.next(n.businessRulesResponse):(console.error("An error occurred during business rules execution. "+n.errorInfo.errorCode+": "+n.errorInfo.message),s.next([])),s.complete()},error:n=>{r.unsubscribe(),console.error("An error occurred during business rules execution. "+n.errorCode+": "+n.message),s.next([]),s.complete()},complete:()=>{r.unsubscribe(),s.error("WebSocket channel closed")}});this._messageChannelService.sendMessage(e,fr.PTP).pipe((0,l.take)(1)).subscribe()})}_createWebSocketRequest(e){return{eventName:this._businessRulesRequestEventName,contexts:e}}_executeUsingWebSocket(e){const t=this._createWebSocketRequest(e);return this._sendWebSocketMessage(t)}_logErrorMessageAndReturnDefBusinessRuleResponse(e){return console.error("An error occurred during business rules execution. "+e.errorCode+": "+e.message),(0,l.of)([])}_executeUsingHttp(e){return this._httpClient.post(this._serviceUrl,{contexts:e},{headers:new V.HttpHeaders({"Content-Type":"application/json"})}).pipe((0,o.mergeMap)(t=>t.success?(0,l.of)(t.businessRulesResponse):this._logErrorMessageAndReturnDefBusinessRuleResponse(t.errorInfo)),(0,o.catchError)(t=>this._logErrorMessageAndReturnDefBusinessRuleResponse(t)))}_canExecuteBusinessRulesByContexts(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,o.map)(t=>{const s=t.filter(r=>r.rules&&r.rules.length>0);return s.length===0?!1:s.some(r=>{const n=e.find(h=>h.scopeName===r.scopeName&&h.scopeType===r.scopeType),a=e.filter(h=>h.parentScopeId===n.scopeId),u=this._businessRulesTriggerExecutor.canExecute(n,a,r.rules),d=this._businessRulesConditionExecutor.canExecute(n,r.rules);return u||d})}))}_getContextsWithScope(e){return e.filter(t=>t.scopeName&&t.scopeId)}_getBusinessRuleActions(e){return e.cases.map(t=>t.actions).flat().filter(t=>t.enabled).map(t=>this._businessRuleDesignActionFactory.get(t))}_getBusinessRuleAffectedAttributes(e){return this._getBusinessRuleActions(e).map(s=>s.getAffectedItems()).flat()}_getAffectedAttributes(e){let t=e.rules.filter(s=>s.enabled).map(s=>this._getBusinessRuleAffectedAttributes(s)).flat();return t=this._getUniqueAffectedAttributes(t),t.forEach(s=>{s.scopeName=e.scopeName}),t}_getUniqueAffectedAttributes(e){const t=e.map(r=>[r.name,r]);return[...new Map(t).values()]}_execute(e){return this._featureStates().pipe((0,o.switchMap)(({useHttpChannel:t,disableContextOptimization:s})=>(0,l.forkJoin)({useHttpChannel:(0,l.of)(t),executionContexts:s?(0,l.of)(e):this._contextFilter.filter(e)})),(0,o.switchMap)(({useHttpChannel:t,executionContexts:s})=>(t?this._executeUsingHttp(s):this._executeUsingWebSocket(s)).pipe((0,o.map)(r=>({executionResults:r,executionContexts:s})))),(0,o.switchMap)(({executionResults:t,executionContexts:s})=>this._logUnsuccessfulBusinessRulesExecution(t,s).pipe((0,o.map)(()=>t))))}_logUnsuccessfulBusinessRulesExecution(e,t){const s=e?.filter(r=>r?.errors?.length>0).map(r=>r.errors).flat();return s?.length===0?(0,l.of)(void 0):(0,l.from)(this._featureService.getFeatureState("BRules-ShowChildRules")).pipe((0,o.switchMap)(r=>this._businessRulesManager.getBusinessRulesByContexts(t).pipe((0,o.map)(n=>n.map(a=>a.rules).flat()),(0,o.tap)(n=>{s.map(a=>this._getUnsuccessfulBusinessRuleExecutionMessage(a,n,r)).forEach(a=>{console.error(a)})}),(0,o.map)(()=>{}))))}_getUnsuccessfulBusinessRuleExecutionMessage(e,t,s){const r="Business rule execution error: ",n=`Error message: "${e.message}"`,a=e.type===li.Unknown?"":`The error occurred in the business rule ${li[e.type]?.toLocaleLowerCase()}s.`;let u=t.find(M=>M.uId===e.businessRuleId);if(!u)return`${r}Rule id - "${e.businessRuleId}". ${n}. ${a}`;!(0,L.gZ)(u.parentUId)&&!s&&(u=t.find(M=>M.uId===u.parentUId));const d=u.caption||"",h=u.name,g=`Rule Title - "${d}"`,b=`Rule Code - "${h}"`;return`${r}${g}, ${b}. ${n}. ${a}`}execute(e){const t=this._getContextsWithScope(e);return t.length===0?(0,l.of)([]):this._canExecuteBusinessRulesByContexts(e).pipe((0,o.switchMap)(s=>s?this._execute(t):(0,l.of)([])),(0,o.catchError)(s=>(console.warn(`An error occurred during business rules execution for scopes: ${e?.map(r=>r.scopeName).join(", ")}.`,s),(0,l.of)([]))))}getAffectedAttributes(e){var t=this;return(0,C.A)(function*(){if(e.length===0)return[];const s=e.filter(a=>a.scopeName!=null),n=(yield(0,l.firstValueFrom)(t._businessRulesManager.getBusinessRulesByContexts(s))).filter(a=>a.rules&&a.rules.length>0);return n.length===0?[]:n.map(a=>t._getAffectedAttributes(a)).flat()})()}static#e=this.\u0275fac=function(t){return new(t||ws)(c.\u0275\u0275inject(Rs),c.\u0275\u0275inject(Cs),c.\u0275\u0275inject(vs),c.\u0275\u0275inject(V.HttpClient),c.\u0275\u0275inject(xn),c.\u0275\u0275inject(Xr),c.\u0275\u0275inject(Yr))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ws,factory:ws.\u0275fac})}function Ps(i){return function(e){Ae(i.type,"BusinessRulesActionApplierTypeName"),Fe(i.type),rt.register(i.type,e)}}class di{constructor(e){this.action=e}_logError(e){return console.error("Error when applying business rule",this.action),console.error(e),(0,l.of)(null)}apply(e,t){let s;try{s=this.innerApply(e,t)}catch(r){return this._logError(r)}return s.pipe((0,l.catchError)(r=>this._logError(r)))}}function Gh(i){return`${i}_List`}function Wh(i){return`${i}_BusinessRule_Filter`}function Hu(i,e){return Ta.apply(this,arguments)}function Ta(){return Ta=(0,C.A)(function*(i,e){let t=yield i[e];return t instanceof _e||(t=new _e,i[e]=t),t}),Ta.apply(this,arguments)}function Zh(i,e,t){return Na.apply(this,arguments)}function Na(){return Na=(0,C.A)(function*(i,e,t){return(yield Hu(i,e)).filters.get(t)||new _e(us.And)}),Na.apply(this,arguments)}function Jh(i,e,t,s){return Va.apply(this,arguments)}function Va(){return Va=(0,C.A)(function*(i,e,t,s){const r=yield Hu(i,e);r.add(s,t),i[e]=r}),Va.apply(this,arguments)}function Xh(i,e,t){return(i.getViewModelAttributePaths(e,t)??[]).map(n=>Gh(n)).map(n=>Wh(n))}function xa(i,e,t,s,r,n){return Oa.apply(this,arguments)}function Oa(){return Oa=(0,C.A)(function*(i,e,t,s,r,n){const a=Xh(i,e,t);for(const u of a){const d=yield Zh(i,u,r);d.add(s,n),yield Jh(i,u,r,d)}}),Oa.apply(this,arguments)}let La=class extends di{_createLookupFilterGroup(e,t){const s=new _e(us.And),r=new Re(ne.Equal,new X({columnPath:e}),new ae({value:t}));return s.add(r,"lookupFilter"),s}_setFilterForScope(e,t){const s=this.action,r=s.path;if(s.value){const{leftExpression:n,rightExpression:a}=s.value,u=this._createLookupFilterGroup(n,a.value);return xa(e,t,r,u,s.businessRuleUId,s.actionUId)}return xa(e,t,r,new _e,s.businessRuleUId,s.actionUId)}innerApply(e,t){const s=this._setFilterForScope(e,t.id);return(0,l.from)(s)}};La=(0,f.__decorate)([Ps({type:"crt.FilterLookup"})],La);let Ba=class extends di{_getFilter(e){if(e){const t=e.value,s=JSON.parse(t);return qn.fromJson(s)}else return new _e}innerApply(e,t){const s=this.action,r=this._getFilter(s.value),n=xa(e,t.id,s.path,r,s.businessRuleUId,s.actionUId);return(0,l.from)(n)}};Ba=(0,f.__decorate)([Ps({type:"crt.SetFilter"})],Ba);let ka=class extends di{_getValue(e){const t=e.value,s=t.value;if(s==null)return(0,l.of)(s);const r=t.dataValueTypeName,a=Object.values(Bn.Q).find(d=>d.name===r)?.type??v.r.Text,u=ta(s,a);return a===v.r.Lookup?(0,l.from)(qu.getLookupValue(t.referenceSchemaName,t.value)):(0,l.of)(u)}_setValue(e,t,s){const r=this.action.path,n=e.getViewModelAttributePath(t,r);return n?e.setValue({[n]:s}):e.setModelValues(t,{[r]:s})}innerApply(e,t){const s=this.action,r=s.value;return s.skip===!0?(0,l.of)(null):this._getValue(s).pipe((0,l.switchMap)(n=>{if(t.type===Oe.Model)return this._setValue(e,t.id,n);if(r.scope)return this._setValue(e,r.scope,n);const a=e.getAttributeNameByViewItemName(s.path);return a?e.setValue({[a]:n}):e.setValue({[s.path]:n})}))}};ka=(0,f.__decorate)([Ps({type:"crt.SetValue"})],ka);const Yh=i=>i.replace(/\./g,"")+"_PropertiesBindingAttribute";class Fa extends di{_getAttributeNames(e,t,s){if(t.type===Oe.Model)return e.getViewModelAttributePaths(t.id,s);let r=e.getAttributeNameByViewItemName(s);return r||(r=Yh(s)),[r]}setAttributePropertyValue(e,t,s){e.setAttributePropertyValue(t,this.propertyName,s)}resetAttributePropertyValue(e,t){e.resetAttributePropertyValue(t,this.propertyName)}innerApply(e,t){const s=this.action.path;if(!s)return(0,l.of)(!0);const n=s.split(":")[0],a=this._getAttributeNames(e,t,n);return a&&a.forEach(u=>{this.action.resetToDefault?this.resetAttributePropertyValue(e,u):this.setAttributePropertyValue(e,u,this.action.value)}),(0,l.of)(!0)}}let ja=class extends Fa{constructor(){super(...arguments),this.propertyName="readonly"}_getPropertyName(e,t){return e.getInvariabilityPropertyName(t)??this.propertyName}setAttributePropertyValue(e,t,s){const r=this._getPropertyName(e,t);e.setAttributePropertyValue(t,r,s)}resetAttributePropertyValue(e,t){const s=this._getPropertyName(e,t);e.resetAttributePropertyValue(t,s)}};ja=(0,f.__decorate)([Ps({type:"crt.SetReadonlyPropertyActionApplier"})],ja);let $a=class extends Fa{constructor(){super(...arguments),this.propertyName="required"}};$a=(0,f.__decorate)([Ps({type:"crt.SetRequiredPropertyActionApplier"})],$a);let Ua=class extends Fa{constructor(){super(...arguments),this.propertyName="visible"}};Ua=(0,f.__decorate)([Ps({type:"crt.SetVisibilityPropertyActionApplier"})],Ua);function Qh(){const i=[La,Ba,ka,ja,$a,Ua]}Qh();class Qr{static#e=this.\u0275fac=function(t){return new(t||Qr)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Qr});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[ws,Es,rt,Cs,vs,{provide:Rh.P,useValue:{name:wu,type:iu.P.PersistentAndMemory,options:{tableName:wh.w.BusinessRules}},multi:!0}]})}var Ds;(function(i){i.string="Strings",i.image="Images"})(Ds||(Ds={}));const en="Resources";class tn extends Array{constructor(e){super(),Object.setPrototypeOf(this,Object.create(tn.prototype)),Array.isArray(e)&&this._fillFromSource(e)}_fillFromSource(e){e.filter(t=>t?.cultureName!=null).forEach(t=>{this.setValueLocalizableString(t.cultureName,t.value)})}getValue(e){const t=this.getLocalizableString(e);return t?t.value:""}hasCultureValue(e,t=!1){const s=this.getLocalizableString(e);return t?(s?.value||null)!=null:s?.value!=null}getLocalizableString(e){return this.find(t=>t.cultureName===e)||null}setValueLocalizableString(e,t){const s=this.getLocalizableString(e);return s?s.value=t:this.push({cultureName:e,value:t}),this}setValues(e,t=!1){return e.forEach(s=>{this.hasCultureValue(s.cultureName)&&t||this.setValueLocalizableString(s.cultureName,s.value)}),this}clone(){return new tn(this)}}class Ts{constructor(e){this.userInfo=e,this._resourceMacrosRegExpPattern="(?<macrosBody>#ResourceString\\((?<macrosArgs>[^)]*)\\)#)",this._viewModelAttributeRegExpPattern=`\\$${en}.${Ds.string}.(?<macrosArgs>[\\S\\s]*)`,this._sysCultureName=this.userInfo.cultureInfo.sysCultureName,this._defCultureName=this.userInfo.defCultureInfo.sysCultureName}_getLczResource(e){const t={};return e.forEach(s=>t[s.cultureName]=s.value),t}_getResourceValueMatches(e){const t=new RegExp(this._resourceMacrosRegExpPattern,"g"),s=new RegExp(this._viewModelAttributeRegExpPattern,"g");let r=[...(e??"").matchAll(s)];return r.length||(r=[...(e??"").matchAll(t)]),r}_findStringPropertyResource(e,t){const{resourceName:s,useMacrosTemplate:r}=this.findResourcesName(e);if(s)return{path:t,resourceName:s,useMacrosTemplate:r}}_findArrayPropertyResources(e,t=""){return e.flatMap((s,r)=>this.findPropertyResources(s,t?`${t}.${r}`:`${r}`))}_findObjectPropertyResources(e,t=""){return Object.entries(e).flatMap(([s,r])=>this.findPropertyResources(r,t?`${t}.${s}`:s))}findLocalizableValue(e){if(typeof e=="string")return e;if(!e||typeof e!="object")return null;let t;return Array.isArray(e)?t=e?.filter(s=>s.value).reduce((s,r)=>Object.assign(s,{[r.cultureName]:r.value}),{}):t=e,(t[this._sysCultureName]??t[this._defCultureName])?.toString()??null}findResourcesName(e){const s=this._getResourceValueMatches(e)[0]?.groups.macrosArgs,r=e?.startsWith("#MacrosTemplateString");return{resourceName:s,useMacrosTemplate:r}}findLocalizationFromResourceString(e,t,s=""){const{resourceName:r}=this.findResourcesName(e),n=r!==void 0&&t.strings[r];if(n){const d=Object.entries(n).map(([h,g])=>({cultureName:h,value:g}));return new tn(d)}const a=r===void 0&&e||s,u=this._sysCultureName||this._defCultureName;return new tn([{cultureName:u,value:a}])}findValueFromResource(e,t){const s=this.findLocalizationFromResourceString(e,t),r=this._getLczResource(s);return this.findLocalizableValue(r)}findViewModelResourceValue(e,t,s){var r=this;return(0,C.A)(function*(){const{resourceName:n}=r.findResourcesName(e);let a;return n&&(a=yield t.Strings[n]),a||s||e})()}findPropertyResources(e,t=""){return e?Array.isArray(e)?this._findArrayPropertyResources(e,t):typeof e=="object"?this._findObjectPropertyResources(e,t):typeof e=="string"?[this._findStringPropertyResource(e,t)].filter(Boolean):[]:[]}static#e=this.\u0275fac=function(t){return new(t||Ts)(c.\u0275\u0275inject(Ue.oq))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ts,factory:Ts.\u0275fac,providedIn:"root"})}var Et;(function(i){i.Root="root",i.Angular="angular"})(Et||(Et={}));const ep=new c.InjectionToken("CrtNavigationLock");class qa{static#e=this.instance=new qa;wait(e){return e()}}class Mt{static#e=this.\u0275fac=function(t){return new(t||Mt)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Mt});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({imports:[w.CommonModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Mt,{imports:[w.CommonModule]})})();function tp(i){return i?function(e){const t=typeof i=="string"?i:i.type;Ae(t,"converterTypeName"),Ic({type:t,typeRef:e},e)}:e=>{}}let Ha=class{convert(e,t){const s={type:"crt.ExecuteExpressionRequest",$context:t,metadata:e};return ce.instance.process(s).then(r=>r).catch(r=>({success:!1,result:null,errorInfo:r}))}};Ha=(0,f.__decorate)([tp({type:"crt.ToExpressionResult"})],Ha);class H{}class Ht{static#e=this._requestsMap=new Map;static#t=this._requestsRegistrationInfos=new Map;static get requestsRegistrationInfos(){return this._requestsRegistrationInfos}static register(e,t){const s=e.type;Ht._requestsMap.set(s,t),Ht._requestsRegistrationInfos.set(s,e)}static get(e){const t=Ht._requestsMap.get(e);return wn(e,t),t&&new t}}function B(i){return function(e){Ae(i.type,"RequestTypeName"),Fe(i.type),Ht.register(i,e)}}function Se(i){return i?function(e){Ae(i.type,"RequestHandlerTypeName"),Fe(i.type),Oi(i,e)}:e=>{}}class Ns{_getDataValueTypeName(e){switch(e){case v.r.FLOAT1:return"Float1";case v.r.FLOAT2:return"Float2";case v.r.FLOAT3:return"Float3";case v.r.FLOAT4:return"Float4";case v.r.FLOAT8:return"Float8";case v.r.CUSTOM_OBJECT:return"Object";case v.r.COMPOSITE_OBJECT_LIST:return"CompositeObjectList";default:return v.r[e]}}_getRequestParameterValueDto(e){const t=e.value;if(Array.isArray(t)){const s=t[0];return Array.isArray(s)?t.map(r=>r.map(n=>({...n,value:this._encodeValue(n.value,n.dataValueType),dataValueType:this._getDataValueTypeName(n.dataValueType)}))):t.map(r=>({...r,value:this._encodeValue(r.value,r.dataValueType),dataValueType:this._getDataValueTypeName(r.dataValueType)}))}return this._encodeValue(t,e.dataValueType)}_encodeValue(e,t){return[v.r.Date,v.r.Time,v.r.DateTime].includes(t)?Ui(e):e}decodeValue(e,t){return[v.r.Date,v.r.Time,v.r.DateTime].includes(t)?new Date(e):e}getExecutionMetadata(e){const t=e.parameters.map(r=>({...r,dataValueType:this._getDataValueTypeName(r.dataValueType),value:this._getRequestParameterValueDto(r)})),s=e.expressionVariables.map(r=>({...r,dataValueType:this._getDataValueTypeName(r.dataValueType)}));return JSON.stringify({...e,parameters:t,expressionVariables:s,resultDataValueType:this._getDataValueTypeName(e.resultDataValueType)})}static#e=this.\u0275fac=function(t){return new(t||Ns)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ns,factory:Ns.\u0275fac,providedIn:"root"})}class Vs{constructor(e,t,s,r){this._httpClient=e,this._featureService=t,this._sysSettingsService=s,this._expressionMetadataAdapter=r,this._expressionEngineEndpoint="ServiceModel/ExpressionService.svc/Execute",this._expressionsEngineEndpoint="ServiceModel/ExpressionService.svc/ExecuteMany",this._expressionEngineValidationEndpoint="ServiceModel/ExpressionService.svc/Validate",this._defaultDebounceTime=200,this._defaultBundleCount=20,this._debounceTimeSysSettingName="ExpressionEngineDebounceTime",this._bundleCountSysSettingName="ExpressionEngineBundleCount",this._requests=new l.Subject}_executeImmediate(e){const t={metadata:e};return(0,l.lastValueFrom)(this._httpClient.post(this._expressionEngineEndpoint,t,{headers:new V.HttpHeaders({"Content-Type":"application/json"})}))}_getBundleSettings(){var e=this;return(0,C.A)(function*(){const{values:t}=yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName,e._bundleCountSysSettingName]),s=t[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime,r=t[e._bundleCountSysSettingName]?.value||e._defaultBundleCount;return{executionDebounceTime:s,bundleCount:r}})()}_prepareDebouncedResponsesStream(){var e=this;return(0,C.A)(function*(){const{executionDebounceTime:t,bundleCount:s}=yield e._getBundleSettings();if(e._responses)return;const r=new l.BehaviorSubject(0),n=(0,l.merge)(r.pipe((0,l.filter)(a=>a>=s)),e._requests.pipe((0,l.tap)(()=>{r.next(r.value+1)}),(0,l.debounceTime)(t)));e._responses=e._requests.pipe((0,l.buffer)(n),(0,l.filter)(({length:a})=>!!a),(0,l.mergeMap)(a=>(r.next(0),e._httpClient.post(e._expressionsEngineEndpoint,a,{headers:new V.HttpHeaders({"Content-Type":"application/json"})}))),(0,l.share)())})()}_executeThrottled(e){var t=this;return(0,C.A)(function*(){yield t._prepareDebouncedResponsesStream();const s=(0,L.qv)(),r=(0,l.firstValueFrom)(t._responses.pipe((0,l.filter)(n=>n.some(a=>a.executionId===s)),(0,l.map)(n=>n.find(a=>a.executionId===s).result)));return t._requests.next({executionId:s,metadata:e}),r})()}safeExecute(e,t={immediate:!1}){var s=this;return(0,C.A)(function*(){try{return yield s.execute(e,t)}catch(r){return{success:!1,errorInfo:r instanceof V.HttpErrorResponse?{errorCode:r.name,message:r.message,stackTrace:r.url}:r,result:null}}})()}execute(e,t={immediate:!1}){var s=this;return(0,C.A)(function*(){let r;const n=s._expressionMetadataAdapter.getExecutionMetadata(e),a=yield s._featureService.getFeatureState("ExpressionEngineDisableBundling");return t.immediate||a?r=yield s._executeImmediate(n):r=yield s._executeThrottled(n),r.success?{...r,result:s._expressionMetadataAdapter.decodeValue(r.result,e.resultDataValueType)}:Promise.reject(r.errorInfo)})()}validate(e){const t={metadata:this._expressionMetadataAdapter.getExecutionMetadata(e)};return(0,l.lastValueFrom)(this._httpClient.post(this._expressionEngineValidationEndpoint,t))}static#e=this.\u0275fac=function(t){return new(t||Vs)(c.\u0275\u0275inject(V.HttpClient),c.\u0275\u0275inject(Xr),c.\u0275\u0275inject(ve),c.\u0275\u0275inject(Ns))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Vs,factory:Vs.\u0275fac,providedIn:"root"})}let Ku=class extends H{constructor(){super(...arguments),this.type="crt.ExecuteExpressionRequest"}};Ku=(0,f.__decorate)([B({type:"crt.ExecuteExpressionRequest"})],Ku);let Ka=class extends te{constructor(e){super(),this._engine=e}handle(e){return this._engine.safeExecute(e.metadata)}};Ka=(0,f.__decorate)([Se({type:"crt.ExecuteExpressionHandler",requestType:"crt.ExecuteExpressionRequest"}),(0,f.__metadata)("design:paramtypes",[Vs])],Ka);let xs=class Sc{static#e=this.\u0275fac=function(t){return new(t||Sc)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Sc});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Vs,Ns],imports:[w.CommonModule,Mt,Mt]})};xs=(0,f.__decorate)([Ru({converters:[Ha],requestHandlers:[Ka]})],xs),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(xs,{imports:[w.CommonModule,Mt],exports:[Mt]})}();class za{convert(e){const{name:t,path:s,caption:r,dataValueType:n}=e||{};return{name:t,path:s||t,caption:r,dataValueType:n}}}class Os extends za{convert(e){const{aggregationConfig:t}=e||{};return{...super.convert(e),type:"aggregation",aggregationConfig:{filter:t?.filter,aggregationFunction:t?.aggregationFunction,sortByColumn:t?.sortByColumn,sortByDirection:t?.sortByDirection}}}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Os)))(s||Os)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Os,factory:Os.\u0275fac,providedIn:"root"})}class Ls extends za{convert(e){const{functionConfig:t}=e||{};return{...super.convert(e),type:"function",functionConfig:t}}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Ls)))(s||Ls)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ls,factory:Ls.\u0275fac,providedIn:"root"})}class Bs extends za{convert(e){return{...super.convert(e),type:"default"}}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Bs)))(s||Bs)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Bs,factory:Bs.\u0275fac,providedIn:"root"})}const sp=P.gX.create({token:mu,mappings:[{predicate:z.AggregationAttribute,injectable:Os},{predicate:z.FunctionAttribute,injectable:Ls}],default:{injectable:Bs}});var nt;(function(i){i[i.None=0]="None",i[i.Count=1]="Count",i[i.Sum=2]="Sum",i[i.Avg=3]="Avg",i[i.Min=4]="Min",i[i.Max=5]="Max",i[i.TopOne=6]="TopOne"})(nt||(nt={}));function zu(i){switch(i){case et.Count:return nt.Count;case et.Sum:return nt.Sum;case et.Avg:return nt.Avg;case et.Min:return nt.Min;case et.Max:return nt.Max;case et.TopOne:return nt.TopOne;default:return nt.None}}function Mm(i){switch(i){case AggregationType.Count:return AggregationFunction.Count;case AggregationType.Sum:return AggregationFunction.Sum;case AggregationType.Avg:return AggregationFunction.Avg;case AggregationType.Min:return AggregationFunction.Min;case AggregationType.Max:return AggregationFunction.Max;case AggregationType.TopOne:return AggregationFunction.TopOne;default:return AggregationFunction.None}}function rp(i){switch(i){case"all":return Ut.All;case"distinct":return Ut.Distinct;default:return Ut.None}}function Im(i){switch(i){case AggregationEvalType.All:return"all";case AggregationEvalType.Distinct:return"distinct";default:return"none"}}class hi{addColumnCaption(e,t){const{name:s,caption:r}=t;if(!r)return;const n=e.findColumn(s);n&&n.withCaption(r)}addColumn(e,t){!e||!t||(this.addColumnInternal(e,t),this.addColumnCaption(e,t))}}class ks extends hi{addColumnInternal(e,t){const{name:s,path:r,aggregationConfig:n}=t;e.addAggregationSubQueryColumn(r,zu(n?.aggregationFunction),n,s)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ks)))(s||ks)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ks,factory:ks.\u0275fac,providedIn:"root"})}class Fs extends hi{addColumnInternal(e,t){const{name:s,path:r}=t||{},n=t?.functionConfig;e.addAggregationFunctionColumn(r,zu(n?.aggregation),s,rp(n?.aggregationEval))}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Fs)))(s||Fs)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Fs,factory:Fs.\u0275fac,providedIn:"root"})}var Ke;(function(i){i[i.None=0]="None",i[i.Day=1]="Day",i[i.Week=2]="Week",i[i.Month=3]="Month",i[i.Year=4]="Year",i[i.WeekDay=5]="WeekDay",i[i.Hour=6]="Hour",i[i.HourMinute=7]="HourMinute"})(Ke||(Ke={}));function np(i){switch(i){case"minute":return Ke.HourMinute;case"hour":return Ke.Hour;case"day":return Ke.Day;case"weekday":return Ke.WeekDay;case"week":return Ke.Week;case"month":return Ke.Month;case"year":return Ke.Year;default:return Ke.None}}function Rm(i){switch(i){case DatePartType.HourMinute:return"minute";case DatePartType.Hour:return"hour";case DatePartType.Day:return"day";case DatePartType.WeekDay:return"weekday";case DatePartType.Week:return"week";case DatePartType.Month:return"month";case DatePartType.Year:return"year";default:return"none"}}class js extends hi{addColumnInternal(e,t){const{name:s,path:r}=t||{},n=t?.functionConfig;e.addDatePartFunctionColumn(r,np(n?.datePart),s)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(js)))(s||js)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:js,factory:js.\u0275fac,providedIn:"root"})}class $s extends hi{addColumnInternal(e,t){e.addSchemaColumn(t.path,t.name)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory($s)))(s||$s)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:$s,factory:$s.\u0275fac,providedIn:"root"})}const ip=P.gX.create({token:pu,mappings:[{predicate:i=>i.type==="aggregation",injectable:ks},{predicate:i=>i.type==="function"&&i.functionConfig?.type==="aggregation",injectable:Fs},{predicate:i=>i.type==="function"&&i.functionConfig?.type==="datePart",injectable:js}],default:{injectable:$s}});function Gu(i){Object.values(i.controls||{}).forEach(e=>{e instanceof xe.FormGroup||e instanceof xe.FormArray?Gu(e):e.updateValueAndValidity({onlySelf:!0})})}function Ga(i){i?.markAsPristine(),i?.markAsUntouched(),i?.updateValueAndValidity()}function wm(i){return Object.values(i?.errors||{}).map(e=>e?.message).filter(Boolean)}function Wu(i){return i.statusChanges.pipe((0,o.startWith)(i.status),(0,o.first)(()=>i.status.toLowerCase()!=="pending"),(0,o.map)(()=>{}))}let Wa=class extends te{constructor(e){super(),this._ngZone=e}_validateRequest(e){const{$context:t,collectionAttributeName:s}=e;if(!t)throw new Error('The "$context" request property is not specified.');if(!s)throw new Error('The "collectionAttributeName" request property is not specified.');const r=t._attributeConfigs[s];if(!(("viewModelConfig"in r||"viewModelName"in r)&&r.isCollection))throw new Error(`There is no view model collection for the specified "${s}" attribute.`)}_canCancelPrimaryDataChanges(e,t){var s=this;return(0,C.A)(function*(){if(!t)return!0;const r=yield s._getPrimaryAttributeValue(e);return t.includes(r)})()}_getPrimaryAttributeValue(e){return(0,C.A)(function*(){const t=yield e.getPrimaryModelName(),s=yield e.getPrimaryDataSchema(),r=e.getViewModelAttributePath(t,s.primaryAttributeName);return e[r]})()}_resetFormApiModel(e){this._ngZone.run((0,C.A)(function*(){const t=yield e.getPrimaryModelName();e.getBoundDataSourceAttributeControls(t)?.forEach(r=>{Ga(r)})}))}_cancelPrimaryDataChanges(e){var t=this;return(0,C.A)(function*(){try{const s={type:"crt.CancelPrimaryDataChangesRequest",$context:e};return yield t.handlerChain.process(s)}catch(s){return[{success:!1,errorInfo:s?.message}]}})()}handle(e){var t=this;return(0,C.A)(function*(){t._validateRequest(e);const{$context:s,collectionAttributeName:r,primaryAttributeValues:n}=e??{},a=yield s.attributes[r],u=a.getChangedItems(),d=[];for(const g of u)(yield t._canCancelPrimaryDataChanges(g,n))&&d.push(t._cancelPrimaryDataChanges(g));for(const g of a)u.includes(g)||t._resetFormApiModel(g);return(yield Promise.all(d)).flat()})()}};Wa=(0,f.__decorate)([Se({type:"crt.CancelCollectionPrimaryDataHandler",requestType:"crt.CancelCollectionPrimaryDataChangesRequest"}),(0,f.__metadata)("design:paramtypes",[c.NgZone])],Wa);let Za=class extends te{_validateRequest(e){const{$context:t}=e;if(!t)throw new Error('The "$context" request property is not specified.')}_cancelCurrentDataChanges(e){var t=this;return(0,C.A)(function*(){const s=e.getPrimaryModelMode();if(s===T.Create){const r=yield e.getPrimaryModelName();return e.getModelByName(r).getDataSource().scope===De.ViewElement&&e.markPrimaryModelFor(T.Delete),Promise.resolve({success:!0})}return s===T.Delete&&e.markPrimaryModelFor(T.Update),(yield e.IsChanged)?t._reloadCurrentDataChanges(e):Promise.resolve({success:!0})})()}_reloadCurrentDataChanges(e){var t=this;return(0,C.A)(function*(){try{return yield t._loadPrimaryData(e),yield t._onSuccessCancelPrimaryData(e),{success:!0}}catch(s){const r=s?.message;return t._onFailCancelPrimaryData(e,r),{success:!1,errorInfo:r}}})()}_loadPrimaryData(e){var t=this;return(0,C.A)(function*(){const s=yield e.getPrimaryModelName(),r=yield e.getPrimaryDataSchema(),n=e.getViewModelAttributePath(s,r.primaryAttributeName);yield t.handlerChain.process({type:"crt.LoadDataRequest",$context:e,dataSourceName:s,parameters:[{type:F.PrimaryColumnValue,value:n}]})})()}_onFailCancelPrimaryData(e,t){e.formApiModel.setErrors({cancel:{message:t}})}_onSuccessCancelPrimaryData(e){return(0,C.A)(function*(){const t=yield e.getPrimaryModelName();e.getBoundDataSourceAttributeControls(t)?.forEach(r=>{Ga(r)})})()}_cancelNestedDataChanges(e){var t=this;return(0,C.A)(function*(){const s=[],r=Object.entries(e._attributeConfigs);for(const[a,u]of r)if(!(!("viewModelConfig"in u)&&!("viewModelName"in u)))if(u.isCollection)s.push(t._cancelPrimaryDataSafely(()=>t._cancelCollectionPrimaryDataChanges(e,a)));else{const d=yield e[a];s.push(t._cancelPrimaryDataSafely(()=>t._cancelPrimaryDataChanges(d)))}return(yield Promise.all(s)).flat()})()}_cancelPrimaryDataChanges(e){var t=this;return(0,C.A)(function*(){const s={type:"crt.CancelPrimaryDataChangesRequest",$context:e};return yield t.handlerChain.process(s)})()}_cancelCollectionPrimaryDataChanges(e,t){var s=this;return(0,C.A)(function*(){const r={type:"crt.CancelCollectionPrimaryDataChangesRequest",$context:e,collectionAttributeName:t};return yield s.handlerChain.process(r)})()}_cancelPrimaryDataSafely(e){return e().catch(t=>[{success:!1,errorInfo:t?.message}])}handle(e){var t=this;return(0,C.A)(function*(){t._validateRequest(e);const s=e.$context,r=yield t._cancelNestedDataChanges(s);return[yield t._cancelCurrentDataChanges(s),...r]})()}};Za=(0,f.__decorate)([Se({type:"crt.CancelPrimaryDataChangesHandler",requestType:"crt.CancelPrimaryDataChangesRequest"})],Za);let Zu=class extends H{};Zu=(0,f.__decorate)([B({type:"crt.LoadLookupListRequest"})],Zu);let Ja=class extends te{handle(e){const t={control:e.valueAttributeName,items:e.itemsAttributeName},s=e.filterValue??null,r=[{type:F.PrimaryDisplayValueFilter,value:"@requestPayload.lookupFilterValue"},...e.parameters||[]],n={...e.payload,lookupFilterValue:s};return e.$context.loadLookupList(t,r,n),Promise.resolve()}};Ja=(0,f.__decorate)([Se({type:"crt.LoadLookupListHandler",requestType:"crt.LoadLookupListRequest"})],Ja);const Pm="crtInput:",Dm="crtOutput:",Tm="crtValidationInput:",ap="crtInject:";function Xa(i){return function(e,t,s){Reflect.defineMetadata(ap+s,i,e)}}const op="DisableShowSuccessMessageAfterLoadDataRequest";class It extends H{}var Ya;(function(i){i.RefreshAll="RefreshAll",i.RefreshSpecific="RefreshSpecific"})(Ya||(Ya={}));let Qa=class extends It{};Qa=(0,f.__decorate)([B({type:"crt.LoadDataRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.LoadDataRequest",propertiesPanelComponentTypeName:"crt.LoadDataRequestPropertiesPanel",position:500})],Qa);let eo=class extends te{constructor(e,t){super(),this._translateService=e,this._featureValues=t}_isDynamicDS(e){const t=e.config||{};return!!(t.dataSourceConfig&&t.attributeName)}_loadDynamicDS(e){const t=e.$context,s=e.config;return(0,l.lastValueFrom)(t.load(s),{defaultValue:null})}_load(e){if(!e.dataSourceName)return;const t=e.$context;let s=e.parameters;s=this._addPrimaryDisplayValueFilterIfNeed(e,s);const r=e.config;return this._trySubscribeToLoadedData(e),(0,l.lastValueFrom)(t.load(e.dataSourceName,s,r),{defaultValue:null})}_trySubscribeToLoadedData(e){e?.showSuccessMessage&&this._subscribeToLoadedData(e,[e.dataSourceName])}_subscribeToLoadedData(e,t){if(this._featureValues[op]||t.length===0)return;const s=e.$context,r=t.map(d=>s._modelsMap.get(d)),n=new Set(t);r.forEach(d=>{const h=d.affectedAttributes.map(b=>b.path);s._getDependentModelsForLoad(d,h).forEach(b=>{n.add(b)})});const a=new Set,u=s._modelLoaded$.subscribe(d=>{if(n.has(d)&&a.add(d),a.size===n.size){u.unsubscribe();const h={$context:e.$context,type:"crt.NotificationRequest",message:this._translateService.instant("LoadDataRequest.SuccessMessage")};this.handlerChain.process(h)}})}_addPrimaryDisplayValueFilterIfNeed(e,t){return e.primaryDisplayFilterValue?(t=t||[],[...t,{type:F.PrimaryDisplayValueFilter,value:e.primaryDisplayFilterValue}]):t}_isDynamicModel(e,t){return e._dynamicModelNames.has(t)}_refreshData(e){const t=e.refreshDataConfig,s=e.$context;let r;if(t.mode===Ya.RefreshAll){const a=t.excludedDataSourceNames||[];r=[...s._modelsMap.values()].map(u=>u.name).filter(u=>!a.includes(u)).filter(u=>!this._isDynamicModel(s,u)).filter(u=>s._getDependOnModelsNames(u).length===0)}else if(r=t.targetDataSourceNames||[],r.length===0)throw new Error("'RefreshSpecific' option requires at least one target data source name");r=r.filter(a=>{const u=s._getDependOnModelsNames(a);return!r.some(d=>u.includes(d))}),r=[...new Set(r)];const n=r.map(a=>({$context:e.$context,type:e.type,showSuccessMessage:!1,dataSourceName:a,config:{loadType:le.Reload,useLastLoadParameters:!0}}));return e.showSuccessMessage===!0&&this._subscribeToLoadedData(e,r),Promise.all(n.map(a=>this.handlerChain.process(a)))}handle(e){if(!e.$context)throw new Error("Property '$context' should be specified");return e.refreshDataConfig?this._refreshData(e):this._isDynamicDS(e)?this._loadDynamicDS(e):this._load(e)}};eo=(0,f.__decorate)([Se({type:"crt.LoadDataSourceHandler",requestType:"crt.LoadDataRequest"}),(0,f.__param)(1,(0,c.Inject)(E)),(0,f.__param)(1,Xa(E)),(0,f.__metadata)("design:paramtypes",[O.TranslateService,Wi])],eo);let Ju=class extends It{};Ju=(0,f.__decorate)([B({type:"crt.LoadDefaultValuesRequest"})],Ju);let to=class extends te{handle(e){const t=e.$context;return(0,l.lastValueFrom)(t.loadDefaultValues(e.dataSourceName),{defaultValue:null})}};to=(0,f.__decorate)([Se({type:"crt.LoadDefaultValuesHandler",requestType:"crt.LoadDefaultValuesRequest"})],to);let Xu=class extends It{};Xu=(0,f.__decorate)([B({type:"crt.SaveDataRequest"})],Xu);let so=class extends te{handle(e){const t=e.$context,{dataSourceName:s,options:r,parameters:n,transactionOperation:a}=e,u=a?t.commitTransaction(s,n,r,a):t.save(s,n,r);return(0,l.lastValueFrom)(u,{defaultValue:null})}};so=(0,f.__decorate)([Se({type:"crt.SaveDataHandler",requestType:"crt.SaveDataRequest"})],so);let Yu=class extends It{};Yu=(0,f.__decorate)([B({type:"crt.SaveInTransactionDataRequest"})],Yu);let ro=class extends te{handle(e){const t=e.$context,{dataSourceName:s,options:r,parameters:n,transaction:a}=e,u=t.saveInTransaction(s,n,r,a);return(0,l.lastValueFrom)(u,{defaultValue:null})}};ro=(0,f.__decorate)([Se({type:"crt.SaveInTransactionDataHandler",requestType:"crt.SaveInTransactionDataRequest"})],ro);let no=class extends te{_validateRequest(e){const{$context:t,collectionAttributeName:s}=e;if(!t)throw new Error('The "$context" request property is not specified.');if(!s)throw new Error('The "collectionAttributeName" request property is not specified.');const r=t._attributeConfigs[s];if(!(("viewModelConfig"in r||"viewModelName"in r)&&r.isCollection))throw new Error(`There is no view model collection for the specified "${s}" attribute.`)}_canSavePrimaryData(e,t){var s=this;return(0,C.A)(function*(){if(!t)return!0;const r=yield s._getPrimaryAttributeValue(e);return t.includes(r)})()}_getPrimaryAttributeValue(e){return(0,C.A)(function*(){const t=yield e.getPrimaryModelName(),s=yield e.getPrimaryDataSchema(),r=e.getViewModelAttributePath(t,s.primaryAttributeName);return e[r]})()}_savePrimaryData(e){var t=this;return(0,C.A)(function*(){try{const s={type:"crt.SavePrimaryDataRequest",$context:e};return yield t.handlerChain.process(s)}catch(s){return[{success:!1,rowsAffected:0,errorInfo:s?.message}]}})()}handle(e){var t=this;return(0,C.A)(function*(){t._validateRequest(e);const{$context:s,collectionAttributeName:r,primaryAttributeValues:n}=e??{},u=s.attributes[r].getChangedItems(),d=[];for(const h of u)(yield t._canSavePrimaryData(h,n))&&d.push(yield t._savePrimaryData(h));return d.flat()})()}};no=(0,f.__decorate)([Se({type:"crt.SaveCollectionPrimaryDataHandler",requestType:"crt.SaveCollectionPrimaryDataRequest"})],no);function Qu(i,e){const t=e.map(s=>{const r=i._attributeConfigs[s];return r&&r.caption?Promise.resolve(r.caption):i[en][Ds.string][s].then(n=>n||s)});return Promise.all(t)}class Us{constructor(e){this._translateService=e}_getFirstValidationError(e){const t=Object.entries(e??{});if(t.length===0)return null;const s=t[0][1];return Object.entries(s)[0]}getValidationErrorMessage(e,t){var s=this;return(0,C.A)(function*(){const r=s._getFirstValidationError(t);if(!r)return"";const n=r[0],a=r[1].message,d=Object.entries(t).filter(([b,M])=>Object.keys(M).includes(n)).map(([b,M])=>b),h=(yield Qu(e,d)).map(b=>`"${b}"`),g=d.length===1?s._translateService.instant("BaseViewModel.ValidationErrorMessageSingleErrorField"):s._translateService.instant("BaseViewModel.ValidationErrorMessageSeveralErrorFields");return mt.String.format(g,h.join(", "),a)})()}static#e=this.\u0275fac=function(t){return new(t||Us)(c.\u0275\u0275inject(O.TranslateService))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Us,factory:Us.\u0275fac})}var W;(function(i){i.None="None",i.OneToMany="OneToMany",i.ManyToOne="ManyToOne",i.ManyToMany="ManyToMany",i.CircularDependency="CircularDependency"})(W||(W={}));function el(i,e){return!!i?.some(t=>t.relationPath.split(".").shift()===e)}function tl(i){return i.dataValueType===v.r.Guid}function sl(i,e){return tl(e)&&i.primaryAttributeName===e.name}function io(i,e,t,s){const r=t.findAttributeByName(s),n=i.findAttributeByName(e);return(n.isLookup||tl(n))&&sl(t,r)?W.OneToMany:sl(i,n)&&r.isLookup?W.ManyToOne:W.ManyToMany}function ao(i){const e=i.split("."),t=e.shift(),s=e.shift();return{dependOnModelName:t,dependOnAttributeName:s}}class qs{constructor(){}_getDataSchema(e,t){return e.dataSchemas[t]}_getRelationData(e,t){const s=t.attributePath;if(s.split(".").length!==1)throw new Error(["Transition relation is not allowed.",`Model name: '${e}', attribute path: '${s}'`].join(" "));const r=t.relationPath.split(".");if(r.length!==2)throw new Error(["Transition relation is not allowed.",`Model name: '${e}', relation path: '${t.relationPath}'`].join(" "));const[n,a]=r;return{modelAttributeName:s,dependOnModelName:n,dependOnModelAttributeName:a}}_mergeRelationTypes(e,t){if(e===W.None)return t;if(t===W.None)return e;if(e===W.CircularDependency||t===W.CircularDependency)return W.CircularDependency;if(e===t)return e;if(e===W.OneToMany&&t===W.ManyToOne||e===W.ManyToOne&&t===W.OneToMany)return W.CircularDependency;if(e===W.ManyToMany||t===W.ManyToMany)return W.ManyToMany}_saveBefore(e,t,s){const r=s.find(n=>n.name===t);r.dependsOn.includes(e)||r.dependsOn.push(e)}_saveAfter(e,t,s){const r=s.find(n=>n.name===e);r.dependsOn.includes(t)||r.dependsOn.push(t)}_sort(e,t){const s=t.map(r=>({name:r,dependsOn:[]}));return t.forEach(r=>{const n=e._getModelDependencies(r);if(!n||n.length===0)return;const a=new Map;for(const u of n){const{modelAttributeName:d,dependOnModelName:h,dependOnModelAttributeName:g}=this._getRelationData(r,u),b=io(this._getDataSchema(e,r),d,this._getDataSchema(e,h),g);let M=a.get(h)??W.None;M=this._mergeRelationTypes(M,b),a.set(h,M)}a.forEach((u,d)=>{switch(u){case W.ManyToOne:this._saveBefore(r,d,s);break;case W.OneToMany:this._saveAfter(r,d,s);break;case W.ManyToMany:throw new Error("Many-to-many relation is not supported");case W.CircularDependency:throw new Error("Circular dependency detected")}})}),(0,P.Bo)(s)}sort(e,t){return t.every(r=>e.getModelMode(r)===T.Update)?t:this._sort(e,t).flat()}static#e=this.\u0275fac=function(t){return new(t||qs)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:qs,factory:qs.\u0275fac})}function rl(i){return i.replace(/\.+/g,"").replace(/\[+/g,"").replace(/\]+/g,"").replace(/:+/g,"")}const cp="DS",up="DYN";function pi(i){for(;i?.parent;)i=i.parent;return i}function Kt(i){return i?.getDataSource()?.scope===De.Page}function lp(i){const e=[];return i?._modelsMap.forEach((t,s)=>{Kt(t)&&e.push(s)}),e}class Hs{static#e=this._dataCache=new WeakMap;static _getDataSourceColumns(e){const t={};let s=!1;for(const[r,n]of Object.entries(e.dataSourceConfig.config.attributes)){const a=n.path;t[rl(r)]=a,a==="Id"&&(s=!0)}return!s&&e.includePrimaryAttributes!==!1&&(t.Id="Id"),t}static _createAttributesConfigMap(e,t,s,r,n){const a={},u=this.getAttributeDataSourceOldName(e,r);for(const[d]of Object.entries(t)){const h=n.config?.useOriginalAttributesName?`${d}`:`${u}_${d}`,g=n.config.attributes[d],b={path:`${s}.${d}`,type:g?.type,functionConfig:g?.functionConfig,aggregationConfig:g?.aggregationConfig};a[h]={modelConfig:b}}return a}static _createAttributePagingConfig(e){return e.pagingConfig||{rowCount:30}}static _createAttributeSortingConfig(e){return e.sortingConfig||{attributeName:e.attributeName+"Sorting"}}static _createAttributeFiltersConfig(e){return e.filtersConfig?.map(t=>{const s={...t};return delete s.value,s})||[]}static _getDataSourceNameForDynamicModel(e,t){return e.getBoundDataSourceNameByAttributePath(t)||this._getAttributeDataSourceDefaultName(t)}static _getDynamicDataSourceNamePrefix(){return`${up}_`}static _isDynamicDataSourceName(e){return e.startsWith(this._getDynamicDataSourceNamePrefix())}static _getAttributeDataSourceDefaultName(e){return`${e}${cp}`}static _getLoadData(e,t,s,r){let n;return this._dataCache.has(e)?n=this._dataCache.get(e):(n=t.load(s,[]).pipe((0,o.share)(),(0,o.tap)(()=>this._dataCache.delete(e))),this._dataCache.set(e,n)),(0,l.lastValueFrom)(n.pipe((0,l.map)(()=>r())),{defaultValue:null})}static createAttributeConfig(e,t,s){const r=s.attributeName,n=s.dataSourceConfig,a=this._getDataSourceColumns(s),u=this._createAttributesConfigMap(e,a,t,r,n),d=this._createAttributePagingConfig(s),h=this._createAttributeSortingConfig(s),g=this._createAttributeFiltersConfig(s);return{isCollection:!0,modelConfig:{path:t,pagingConfig:d,sortingConfig:h,filterAttributes:g},viewModelConfig:{attributes:u}}}static getAttributeDataSourceOldName(e,t){let s=this._getDataSourceNameForDynamicModel(e,t);return(!s||this._isDynamicDataSourceName(s))&&(s=this._getAttributeDataSourceDefaultName(t)),s}static createDynamicDataSourceNameFromAttributeName(e,t){const s=this._getDynamicDataSourceNamePrefix(),r=this._getDataSourceNameForDynamicModel(e,t);return this._isDynamicDataSourceName(r)?r:`${s}${r}`}static defineAsyncAttribute(e,t,s,r,n){const a=s.modelConfig?.path?.split(".")[0],u=e.getModelByName(a),d="isLookup"in s&&s.isLookup,h="isCollection"in s&&s.isCollection;Object.defineProperty(e,t,{get:()=>u&&h&&!d&&!u?.isLoaded?this._getLoadData(u,e,a,r):Promise.resolve(r()),set:n,configurable:!0})}static deferUpdatingValueAndValidity(e,t,s){if(s?.["ViewModel.DontDeferUpdatingValueAndValidity"])return t();const r=e.formApiModel.updateValueAndValidity;if(r.callbackCount)r.callbackCount++;else{const u=(0,P.S)();u.callbackCount=1,u.originalFn=r.bind(e.formApiModel),e.formApiModel.updateValueAndValidity=u}const n=t(),a=()=>{const u=e.formApiModel.updateValueAndValidity;u.callbackCount===1?(e.formApiModel.updateValueAndValidity=u.originalFn,e.formApiModel.updateValueAndValidity()):u.callbackCount--};return n instanceof Promise?n.finally(a):n.pipe((0,o.finalize)(a))}}let oo=class extends te{constructor(e,t,s,r,n){super(),this._baseViewModelProcessValidationResultService=e,this.modelSaveOrderSorterService=t,this._featureValues=s,this._transactionFactory=r,this._translateService=n}_validateRequest(e){const{$context:t}=e;if(!t)throw new Error('The "$context" request property is not specified.')}_saveModel(e,t,s){var r=this;return(0,C.A)(function*(){const n=e.dataSchemas[t],a=e.getViewModelAttributePath(t,n.primaryAttributeName);try{const u=yield r._saveData(e,t,a,s);return u.success&&r._onSuccessSaveRootData(e,t,u),u}catch(u){const d=u?.message;return r._createFailedSaveResult(d)}})()}_queueSaveDataInTransaction(e,t,s,r){var n=this;return(0,C.A)(function*(){const a={type:"crt.SaveInTransactionDataRequest",$context:e,parameters:[{type:F.PrimaryColumnValue,value:s}],transaction:r,dataSourceName:t};return yield n.handlerChain.process(a)})()}_queueSaveModelInTransaction(e,t,s){const r=e.dataSchemas[t],a=e.getViewModelAttributePaths(t,r.primaryAttributeName)[0];return this._queueSaveDataInTransaction(e,t,a,s)}_validateModel(e,t){var s=this;return(0,C.A)(function*(){if(!(yield e.isValid(t))){const n=yield e.validate(t),a=yield s._baseViewModelProcessValidationResultService.getValidationErrorMessage(e,n);return s._createFailedSaveResult(a)}return null})()}_getModels(e){var t=this;return(0,C.A)(function*(){const s=yield e.getPrimaryModelName();let r=lp(e);return r=r.filter(n=>e.getModelMode(n)!==T.Init),s&&!r.includes(s)&&r.unshift(s),t._featureValues.DisableMultipleDataSources?r:t.modelSaveOrderSorterService.sort(e,r)})()}_canSaveDataResult(e,t){var s=this;return(0,C.A)(function*(){const r=e.dataSchemas[t],n=e.getViewModelAttributePath(t,r.primaryAttributeName),a=yield s._canSaveData(e,t,n);if(a&&!a?.result)return s._createFailedSaveResult(a.message)})()}_checkPdsGroupValidationResults(e,t){var s=this;return(0,C.A)(function*(){const r=yield Promise.all(t.map(a=>s._validateModel(e,a)));if(r.some(a=>a&&!a.success))return r;const n=yield Promise.all(t.map(a=>s._canSaveDataResult(e,a)));return n.some(a=>a&&!a.success)?n:[]})()}_saveModelChanges(e,t,s){var r=this;return(0,C.A)(function*(){let n;return(yield r._shouldSkipSavingUnchangedPageModel(e,t))||(n=yield r._saveModel(e,t,s)),n})()}_queueModelChangesInTransaction(e,t,s){var r=this;return(0,C.A)(function*(){let n;return(yield r._shouldSkipSavingUnchangedPageModel(e,t))||(n=yield r._queueSaveModelInTransaction(e,t,s)),n})()}_saveInChain(e,t){var s=this;return(0,C.A)(function*(){const r=[];for(const n of t)r.push(yield s._saveModelChanges(e,n));return r})()}_saveInTransaction(e,t){var s=this;return(0,C.A)(function*(){const r=[],n=[],a=yield s._transactionFactory.create();for(const d of t){const h=yield s._queueModelChangesInTransaction(e,d,a),g=s._saveModelChanges(e,d,h);n.push(g)}try{yield a.commit()}catch(d){return[s._createFailedSaveResult(d?.message)]}const u=yield Promise.all(n);return r.push(...u),r})()}_saveRootData(e){var t=this;return(0,C.A)(function*(){const s=yield t._getModels(e),r=yield e.getPrimaryModelName();let n=[...r?[r]:[],...s.filter(g=>el(e._getModelDependencies(g),r))];t._featureValues.DisableMultipleDataSources&&(n=[]);const a=(yield Promise.all(n.map(function(){var g=(0,C.A)(function*(b){return(yield t._shouldSkipValidationAndSavingPageModel(e,b))?null:b});return function(b){return g.apply(this,arguments)}}()))).filter(Boolean);let u=yield t._checkPdsGroupValidationResults(e,a);if(!u.length){const g=!t._featureValues["DataSource-DisableTransactions"],b=a.map(M=>e.getModelByName(M)).every(M=>M.supportsTransactions);g&&b&&a.length>1?u=yield t._saveInTransaction(e,a):u=yield t._saveInChain(e,a)}const d=s.filter(g=>!n.includes(g));for(const g of d){const b=yield t._validateModel(e,g),M=yield t._canSaveDataResult(e,g);!b&&!M?u.push(yield t._saveModelChanges(e,g)):u.push(b||M)}u=u.filter(Boolean);const h=u.filter(g=>!g.success).map(g=>g.errorInfo);return h.length&&t._onFailSaveRootData(e,h.join(", ")),u})()}_shouldSkipSavingUnchangedPageModel(e,t){var s=this;return(0,C.A)(function*(){if(s._featureValues.DisableMultipleDataSources)return!1;const r=e.getModelByName(t),n=e._getModelDependencies(t),a=!n?.length,u=r?._isChanged,d=yield e.getPrimaryModelName();return a?t!==d&&!u:r?.getDataSource()?.isForceUpdateUnchangedData?!1:el(n,d)&&!u})()}_canSaveData(e,t,s){return(0,C.A)(function*(){const n={primaryColumnValue:yield e[s]};return e.canSave(t,n)})()}_saveData(e,t,s,r){var n=this;return(0,C.A)(function*(){const a={type:"crt.SaveDataRequest",$context:e,parameters:[{type:F.PrimaryColumnValue,value:s}],transactionOperation:r,dataSourceName:t};return yield n.handlerChain.process(a)})()}_onFailSaveRootData(e,t){e.formApiModel.setErrors({save:{message:t}})}_updateAttributesOnSaveResult(e,t,s){if(s?.primaryAttributes?.length)for(const r of s.primaryAttributes)for(const[n,a]of Object.entries(r)){const u=e.getViewModelAttributePath(t,n);e[u]=a}}_onSuccessSaveRootData(e,t,s){this._updateAttributesOnSaveResult(e,t,s),e.getBoundDataSourceAttributeControls(t)?.forEach(n=>{Ga(n)})}_saveNestedData(e,t){var s=this;return(0,C.A)(function*(){const r=[],n=Object.entries(e._attributeConfigs);for(const[u,d]of n)if(!(!("viewModelConfig"in d)&&!("viewModelName"in d)))if(d.isCollection)r.push(s._saveDataSafely(()=>s._saveInnerViewModelCollection(e,u,t)));else{const h=yield e[u];r.push(s._saveDataSafely(()=>s._saveInnerViewModel(h)))}return(yield Promise.all(r)).flat()})()}_saveInnerViewModel(e){var t=this;return(0,C.A)(function*(){const s={type:"crt.SavePrimaryDataRequest",$context:e};return yield t.handlerChain.process(s)})()}_saveInnerViewModelCollection(e,t,s){var r=this;return(0,C.A)(function*(){const n={type:"crt.SaveCollectionPrimaryDataRequest",$context:e,collectionAttributeName:t,scopes:s};return yield r.handlerChain.process(n)})()}_saveDataSafely(e){return e().catch(t=>[this._createFailedSaveResult(t?.message)])}_createFailedSaveResult(e){return{success:!1,rowsAffected:0,errorInfo:e}}_shouldSkipValidationAndSavingPageModel(e,t){var s=this;return(0,C.A)(function*(){const r=yield e.getPrimaryModelName();if(t===r)return!1;const n=e._getModelDependencies(t);if(!n?.length)return!1;const[{relationPath:a,attributePath:u}]=n,[,d]=a.split("."),h=io(e.dataSchemas[t],u,e.dataSchemas[r],d);if(h===W.OneToMany)return!1;if(h===W.ManyToOne){const g=e.getViewModelAttributePaths(r,d);if(!g.length)return!0;if(!(yield e[g[0]])){if(!e.getBoundDataSourceAttributeControls(t).every(Y=>Y.value===null)){const Y=yield Qu(e,[g[0]]),j={type:"crt.NotificationRequest",$context:e,message:s._translateService.instant("BaseViewModel.ErrorMessageOnEmptyRelationColumn",{caption:Y})};yield s.handlerChain.process(j)}return!0}}return!1})()}handle(e){var t=this;return(0,C.A)(function*(){t._validateRequest(e);const s=e.$context,r=yield t._saveRootData(s);if(r.some(a=>!a.success))return r;const n=yield t._saveNestedData(s,e.scopes);return[...r,...n]})()}};oo=(0,f.__decorate)([Se({type:"crt.SavePrimaryDataHandler",requestType:"crt.SavePrimaryDataRequest"}),(0,f.__param)(2,(0,c.Inject)(E)),(0,f.__param)(2,Xa(E)),(0,f.__param)(3,(0,c.Inject)(zn)),(0,f.__param)(3,Xa(zn)),(0,f.__metadata)("design:paramtypes",[Us,qs,Wi,Object,O.TranslateService])],oo);let nl=class extends It{};nl=(0,f.__decorate)([B({type:"crt.DeleteDataRequest"})],nl);let co=class extends te{handle(e){const t=e.$context;return(0,l.lastValueFrom)(t.delete(e.dataSourceName,e.parameters,e.config),{defaultValue:null})}};co=(0,f.__decorate)([Se({type:"crt.DeleteDataHandler",requestType:"crt.DeleteDataRequest"})],co);let il=class extends It{};il=(0,f.__decorate)([B({type:"crt.CopyDataRequest"})],il);let uo=class extends te{handle(e){const t=e.$context,{dataSourceName:s,recordId:r,copiedValues:n}=e;return(0,l.lastValueFrom)(t.copy(s,r,n),{defaultValue:null})}};uo=(0,f.__decorate)([Se({type:"crt.CopyDataHandler",requestType:"crt.CopyDataRequest"})],uo);let al=class extends It{};al=(0,f.__decorate)([B({type:"crt.SortDataRequest"})],al);let lo=class extends te{handle(e){const t=e.$context;return(0,l.lastValueFrom)(t.setSorting(e.dataSourceName,e.config),{defaultValue:null})}};lo=(0,f.__decorate)([Se({type:"crt.SortDataHandler",requestType:"crt.SortDataRequest"})],lo);let ol=class extends It{};ol=(0,f.__decorate)([B({type:"crt.GetDataSourceLoadFiltersRequest"})],ol);let ho=class extends te{constructor(e){super(),this._entitySchemaQueryBuilder=e}handle(e){var t=this;return(0,C.A)(function*(){const s=e.$context;if(!s)throw new Error("Property '$context' should be specified");const r=e.dataSourceName;if(!r)throw new Error("Property 'dataSourceName' should be specified");const n=s.dataSchemas[r];if(!n)throw new Error(`Schema for data source with name ${r} not found`);const a=yield s.getDataSourceLoadParameters(r);return a.parameters.some(u=>u.type===F.Never)?null:(0,l.lastValueFrom)(t._entitySchemaQueryBuilder.build(n,[],a.parameters).pipe((0,l.map)(u=>u.getMetadata().filters)))})()}};ho=(0,f.__decorate)([Se({type:"crt.GetDataSourceLoadFiltersHandler",requestType:"crt.GetDataSourceLoadFiltersRequest"}),(0,f.__metadata)("design:paramtypes",[fs])],ho);const mi=new c.InjectionToken("SCOPE_NAME"),cl=new c.InjectionToken("VIEW_EVENT_ZONE_NAME"),dp=new c.InjectionToken("INJECTION_CONTEXT");class Ks{selectData(){return null}static#e=this.\u0275fac=function(t){return new(t||Ks)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ks,factory:Ks.\u0275fac,providedIn:"root"})}class zs extends Ks{constructor(){super(...arguments),this._elon={FirstName:"Elon",Account:{Name:"SpaceX",Ships:[{Id:"Falcon 9"},{Id:"Falcon Heavy"}],Employee:{Name:"Mask",Age:49}},Employees:["Elon"]}}selectData(){return(0,l.of)(this._elon).pipe((0,o.delay)(50))}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(zs)))(s||zs)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:zs,factory:zs.\u0275fac,providedIn:"root"})}class fi{constructor(e){this.injector=e}}function Pe(i){return i?function(e){Ae(i.type,"ValidatorTypeName");const t={...i,typeRef:e};cr(t,e)}:e=>{}}class po{static#e=this._instanceOfKey="devkit_BaseValidator";get isAsync(){return this.async}get validateFn(){return this.validate.bind(this)}static[Symbol.hasInstance](e){return e?.constructor?._instanceOfKey===po._instanceOfKey}}let Ee=class extends po{constructor(e){super(),this.injector=e}defaultValidationError(e){const t=this.injector?.get(O.TranslateService),s=e??{},r=t?.instant(this.i18nMessageKey,s);return{message:e?.message||r||""}}};Ee=(0,f.__decorate)([Pe(),(0,f.__metadata)("design:paramtypes",[c.Injector])],Ee);let mo=class extends Ee{constructor(){super(...arguments),this.i18nMessageKey="Validators.Required.Message",this.async=!1}validateLczValue(e){return e?!!e.find(t=>t.value&&t.value.trim()):!1}validate(e,t){const s=e.value;return(typeof s=="string"?!!(e&&e.value?.trim()):this.validateLczValue(s))?null:{required:this.defaultValidationError(t)}}};mo=(0,f.__decorate)([Pe({type:"crt.EmptyOrWhiteSpace"})],mo);let fo=class extends Ee{constructor(){super(...arguments),this.i18nMessageKey="Validators.Max.Message",this.async=!1}validate(e,t){const r=xe.Validators.max(t.max)(e);return r?{max:this.defaultValidationError({...t,...r.max})}:null}};fo=(0,f.__decorate)([Pe({type:"crt.Max"})],fo);function ul(i){return typeof i=="string"}function hp(i){const e=i.substring(1,i.length-1);return parseInt(e,10)}function Nm(i,e){return i.replace(/{[0-9]}/g,t=>{const s=hp(t);return e[s]?e[s].toString():""})}function Vm(i){return i.charAt(0).toUpperCase()+i.slice(1)}function xm(i){return i.charAt(0).toLowerCase()+i.slice(1)}function pp(i){let e=0;if(!ul(i)||i.length===0)return e;for(let t=0;t<i.length;t++)e=i.charCodeAt(t)+(e<<5)-e,e|=0;return e}function mp(i){return pp(JSON.stringify(i))}function Om(i){return mp(i).toString(16)}class Le{static _trimValueIfNeeded(e,t){return t?.trimValue&&!Le.isEmptyInputValue(e)&&ul(e)?e.trim():e}static isEmptyInputValue(e){return e==null||(typeof e=="string"||Array.isArray(e))&&e.length===0}static hasValidLength(e){return e!=null&&typeof e.length=="number"}static getControlValueAndTrimIfNeeded(e,t){return Le._trimValueIfNeeded(e.value,t)}}let go=class extends Ee{constructor(){super(...arguments),this.i18nMessageKey="Validators.MaxLength.Message",this.async=!1}_maxLengthValidator(e,t){return Le.hasValidLength(e)&&e.length>t.maxLength?{maxlength:this.defaultValidationError({...t,requiredLength:t.maxLength,actualLength:e.length})}:null}validate(e,t){const s=Le.getControlValueAndTrimIfNeeded(e,t);return this._maxLengthValidator(s,t)}};go=(0,f.__decorate)([Pe({type:"crt.MaxLength"})],go);let _o=class extends Ee{constructor(){super(...arguments),this.i18nMessageKey="Validators.Min.Message",this.async=!1}validate(e,t){const r=xe.Validators.min(t.min)(e);return r?{min:this.defaultValidationError({...t,...r.min})}:null}};_o=(0,f.__decorate)([Pe({type:"crt.Min"})],_o);let yo=class extends Ee{constructor(){super(...arguments),this.i18nMessageKey="Validators.MinLength.Message",this.async=!1}_minLengthValidator(e,t){return Le.isEmptyInputValue(e)||!Le.hasValidLength(e)?null:e.length<t.minLength?{minlength:this.defaultValidationError({...t,requiredLength:t.minLength,actualLength:e.length})}:null}validate(e,t){const s=Le.getControlValueAndTrimIfNeeded(e,t);return this._minLengthValidator(s,t)}};yo=(0,f.__decorate)([Pe({type:"crt.MinLength"})],yo);let gi=class extends Ee{constructor(){super(...arguments),this.i18nMessageKey="Validators.RegExp.Message",this.async=!1}validate(e,t){typeof t.regex=="string"&&(t.regex=new RegExp(t.regex));const s=t.regex.test(e.value);return this.i18nMessageKey=t.message||this.i18nMessageKey,s?null:{[t.errorCode]:this.defaultValidationError({...t})}}};gi=(0,f.__decorate)([Pe({type:"crt.RegExp"})],gi);let bo=class extends Ee{constructor(e){super(e),this.injector=e,this.async=!1,this.i18nMessageKey="Validators.PhoneNumber.Message",this._phoneValidationService=e.get(yt)}validate(e,t){return!e.value||this._phoneValidationService.isValidPhoneNumber(e.value)?null:{invalidPhoneNumber:this.defaultValidationError(t)}}};bo=(0,f.__decorate)([Pe({type:"crt.PhoneNumber"}),(0,f.__metadata)("design:paramtypes",[c.Injector])],bo);let So=class extends Ee{constructor(){super(...arguments),this.i18nMessageKey="Validators.Required.Message",this.async=!1}_requiredValidator(e,t){return Le.isEmptyInputValue(e)?{required:this.defaultValidationError(t)}:null}validate(e,t){const s=Le.getControlValueAndTrimIfNeeded(e,t);return this._requiredValidator(s,t)}};So=(0,f.__decorate)([Pe({type:"crt.Required"})],So);let Co=class extends Ee{constructor(e){super(e),this.injector=e,this._messageKey="Validators.SchemaNamePrefix.",this.async=!0,this._sysSettingsService=e.get(ve)}_getSchemaNamePrefix(){var e=this;return(0,C.A)(function*(){return(yield e._sysSettingsService.getByCode("SchemaNamePrefix")).value})()}validate(e,t){var s=this;return(0,C.A)(function*(){if((0,D.isObject)(e.value))return null;const r=Le.getControlValueAndTrimIfNeeded(e,{trimValue:!0}),n=yield s._getSchemaNamePrefix();if(n){const a=!r?.startsWith(n);if(a||r===n)return s.i18nMessageKey=a?s._messageKey+"NoSchemaNamePrefixMessage":s._messageKey+"OnlySchemaNamePrefixMessage",{namePrefixError:s.defaultValidationError({...t,schemaNamePrefix:n})}}return null})()}};Co=(0,f.__decorate)([Pe({type:"crt.SchemaNamePrefix"}),(0,f.__metadata)("design:paramtypes",[c.Injector])],Co);let Ao=class extends gi{constructor(){super(...arguments),this._params={regex:/^[a-zA-Z]+[a-zA-Z0-9-_]*$/,errorCode:"allowedSymbolsErrorCode"},this.i18nMessageKey="Validators.SchemaNameAllowedSymbols.Message",this.async=!1}validate(e){return super.validate(e,this._params)}};Ao=(0,f.__decorate)([Pe({type:"crt.SchemaNameAllowedSymbols"})],Ao);let vo=class extends Ee{constructor(){super(...arguments),this.i18nMessageKey="Validators.UniqueCodeColumnValue.Message",this.async=!1,this._windowCodeList="_copilotCodeList"}validate(e,t){const s=e.value;if(!s)return null;const r=window[this._windowCodeList];return r&&r.filter(a=>a===s).length>1?{uniqueColumnValue:this.defaultValidationError({...t,controlValue:s})}:null}};vo=(0,f.__decorate)([Pe({type:"crt.UniqueCodeColumnValue"})],vo);const ll="calculated";function fp(i){let e=[];return typeof i=="string"&&(e=[i]),Array.isArray(i)&&(e=i),e.map(t=>typeof t=="string"&&t?.trim()).filter(Boolean)}function gp(i){return(i??[]).filter(e=>hl(e)||dl(e))}function _p(i){const e=i.map(r=>Ht.requestsRegistrationInfos.has(r)),t=e.includes(!0),s=e.includes(!1);return t&&s}function dl(i){return!!i&&"attribute"in i&&!!i.attribute}function hl(i){return!!i&&"request"in i&&!!i.request}function yp(i){const e=fp(i.from),t=gp(i.triggers),{from:s,filter:r,converter:n,change:a,triggersOptions:u}=i;return e.length===0&&t.length===0&&!n?(console.error("At least one of the properties 'converter', 'from', or 'triggers' must be specified: "+JSON.stringify(i)+"."),null):e.length===0&&!n?(console.error(`Converter is required in a calculated attribute if there are 'triggers' and no 'from': ${JSON.stringify(i)}.`),null):_p(e)?(console.error(`Simultaneous specification of attributes and request in the "from" property of calculated attribute is not supported: ${JSON.stringify(i)}.`),null):(e.length===0&&r&&console.warn(`Filter is skipped in a calculated attribute if there are 'triggers' and no 'from': ${JSON.stringify(i)}.`),{from:e,originalFrom:s,filter:e.length?r:void 0,converter:n,triggers:t,triggersOptions:{debounce:u?.debounce??0},change:a})}const pl=new c.InjectionToken("Represents a factory of calculated attribute source changes providers"),ml=new c.InjectionToken("Represents a factory of calculated attribute trigger providers"),bp=new c.InjectionToken("A factory of expression interpreter");class it{constructor(e){this._converterExpressionInterpreter=e?.create("converter")}_getConverterFn(e,t,s){if(!e||!this._converterExpressionInterpreter)return(0,l.of)(s);const r={viewModel$:(0,l.of)(t),parent:null};return this._converterExpressionInterpreter.evaluate(e,r)}evaluate(e){const{args:t,expression:s,context:r,defaultEvaluationFn:n}=e;return this._getConverterFn(s,r,n).pipe((0,o.switchMap)(a=>{const u=a(t);return u instanceof Promise?u:Promise.resolve(u)}))}static#e=this.\u0275fac=function(t){return new(t||it)(c.\u0275\u0275inject(bp,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:it,factory:it.\u0275fac})}const Sp=i=>!0,Cp=i=>i;class Gs{constructor(e,t,s,r){this._converterEvaluator=e,this._attributeSourcesChangesProviderFactory=t,this._attributeTriggerProviderFactory=s,this._measurePerformanceService=r}_createCalculateAttributeValueFn(e,t){const{viewModel:s,attribute:r,generateOptions:n}=e,{originalFrom:a,filter:u,converter:d}=t,h=Array.isArray(a);return g=>g.pipe((0,o.map)(b=>h?b:b?.[0]),(0,P.Ny)(b=>this._converterEvaluator.evaluate({args:b,expression:u,context:s,defaultEvaluationFn:Sp})),(0,o.filter)(([,b])=>!!b),(0,o.concatMap)(([b])=>this._converterEvaluator.evaluate({args:b,expression:d,context:s,defaultEvaluationFn:Cp})),(0,o.map)(b=>{const M=s.attributes[r];return[(0,D.cloneDeep)(b),(0,D.cloneDeep)(M)]}),(0,o.filter)(([b,M])=>!(0,D.isEqual)(b,M)),(0,o.tap)(([b,M])=>{s.attributes[r]=b,n?.onChangeAttributeValue(r,b,M)}),(0,o.map)(([b])=>b))}_createGetAttributeValueFn(e){const{viewModel:t,attributeName:s,attributeConfig:r,calculateAttributeFn:n}=e;let a;const u=this._getAttributeSourcesStream(r,t);return()=>{const d=s in t.attributes;return a?d?(0,l.of)(t.attributes[s]):a:(a=n(u).pipe((0,o.shareReplay)({bufferSize:1,refCount:!0})),t._subscriptions.add(a.subscribe()),a)}}_getAttributeSourcesStream(e,t){const s=this._getAttributeTriggers(e,t),r=this._getAttributeSourcesChanges(e,t);if(!s)return r||(0,l.of)(void 0);const n=e.triggersOptions.debounce;return r?(0,l.merge)(s.pipe((0,o.debounceTime)(n)),r).pipe((0,o.withLatestFrom)(r),(0,o.map)(([,a])=>a)):s.pipe((0,o.startWith)(void 0),(0,o.debounceTime)(n))}_getAttributeTriggers(e,t){const{triggers:s}=e,r=s.map(n=>this._attributeTriggerProviderFactory.create(n)?.getTrigger(n,t)).filter(Boolean);return r.length===0?null:(0,l.merge)(...r)}_getAttributeSourcesChanges(e,t){const{from:s}=e;return s.length===0?null:this._attributeSourcesChangesProviderFactory.create(s).getChanges(s,e,t)}_defineCalculatedAttribute(e,t,s){Object.defineProperty(s,e,{get:()=>(0,l.firstValueFrom)(t(),{defaultValue:null}),configurable:!0})}defineAttribute(e){this._measurePerformanceService.measure(`CalculatedAttributeCreator.defineAttribute.${e.attribute}`,()=>{const{viewModel:t,attribute:s,attributeConfig:r}=e,n=yp(r);if(n===null)return;const a=this._createCalculateAttributeValueFn(e,n),u=this._createGetAttributeValueFn({attributeName:s,attributeConfig:n,calculateAttributeFn:a,viewModel:t});this._defineCalculatedAttribute(s,u,t)})}static#e=this.\u0275fac=function(t){return new(t||Gs)(c.\u0275\u0275inject(it),c.\u0275\u0275inject(pl),c.\u0275\u0275inject(ml),c.\u0275\u0275inject(ge))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Gs,factory:Gs.\u0275fac,providedIn:"root"})}class sn{constructor(e,t){this.ngZone=e,this.measurePerformanceService=t}innerDefineAttribute(e,t){this.measurePerformanceService.measure(`DefaultAttributeCreator.defineAttribute.${e.attribute}`,()=>{const s=e.viewModel,r=s.attributes,n=e.attribute,a=e.attributeConfig,u=e.control,d=g=>{r[n]=g,this.ngZone.run(()=>{const b=s._viewModelAttributeChangeEventOptions?.getAsSilent();u.setValue(g,b),t?.call(this,g)})},h=()=>u.value;Hs.defineAsyncAttribute(s,n,a,h,d)})}defineAttribute(e){this.innerDefineAttribute(e)}static#e=this.\u0275fac=function(t){return new(t||sn)(c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(ge))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:sn,factory:sn.\u0275fac,providedIn:"root"})}const rn="maskState",_i="maskedValue",yi="unMaskedValue";var nn;(function(i){i.Unmasked="unmasked",i.Masked="masked"})(nn||(nn={}));const fl=Symbol("isAttributeValueMasked"),Ap=Symbol("getMaskedValue"),vp=Symbol("getUnmaskedValue"),Ep=Symbol("setMaskedState"),Mp=Symbol("getMaskedState");class zt extends sn{_setMaskData(e,t){const s=e.viewModel,r=e.attribute;if(!e.attributeConfig.isValueMasked)return;const a=s._viewModelAttributeChangeEventOptions?.getIsMaskedValue(),u=a?nn.Masked:nn.Unmasked,d=a?_i:yi;s.setAttributePropertyValue(r,rn,u),s.setAttributePropertyValue(r,d,t)}afterDefineAttribute(e,t){this._setMaskData(e,t)}defineAttribute(e){this.innerDefineAttribute(e,t=>this.afterDefineAttribute(e,t))}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(zt)))(s||zt)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:zt,factory:zt.\u0275fac,providedIn:"root"})}class an extends zt{constructor(e,t){super(e,t)}afterDefineAttribute(e,t){super.afterDefineAttribute(e,t),e?.viewModel?.setAttributePropertyValue(e?.attribute,"displayColor",t?.primaryColorValue)}static#e=this.\u0275fac=function(t){return new(t||an)(c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(ge))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:an,factory:an.\u0275fac,providedIn:"root"})}const gl=new c.InjectionToken("View model attribute creator factory"),Ip=P.gX.create({token:gl,mappings:[{predicate:v.r.Lookup,injectable:an},{predicate:ll,injectable:Gs}],default:{injectable:zt}});class Gt{transform(e){return function(t){const{instance:s,params:r}=e,n={value:t.value};return s.validate(n,r)}}static#e=this.\u0275fac=function(t){return new(t||Gt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Gt,factory:Gt.\u0275fac,providedIn:"root"})}class Wt{resolveModelConfig(e){return null}static#e=this.\u0275fac=function(t){return new(t||Wt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Wt,factory:Wt.\u0275fac,providedIn:"root"})}class on{constructor(){this.account={attributes:{Name:{},Ships:{isCollection:!0,viewModelConfig:"ship"},Employee:{viewModelConfig:"employee"}}},this.ship={attributes:{Id:{}}},this.employee={attributes:{Name:{},Age:{}}}}resolveModelConfig(e){return(0,l.of)(this[e]).pipe((0,o.delay)(50))}static#e=this.\u0275fac=function(t){return new(t||on)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:on,factory:on.\u0275fac,providedIn:"root"})}class Zt{constructor(e){this.injector=e,this.initDependencies()}initDependencies(){this.repository=this.injector.get(Wt),this.ngZone=this.injector.get(c.NgZone)}static#e=this.\u0275fac=function(t){return new(t||Zt)(c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Zt,factory:Zt.\u0275fac})}class Rp{create(e){const{validator:t,...s}=e,r=s.params.map(({name:n})=>n);return class extends Ee{constructor(n){super(n),this.async=s.async}_getMessageFromParams(n){return{[s.type]:{message:n.message}}}_setParamsProxy(n){return new Proxy(n,{get(a,u){if(r.includes(u))return a[u];throw new Error(`Property ${u} is not defined in validator params config`)}})}_toPromise(n){let a;return n instanceof Promise?a=n:n instanceof l.Observable?a=(0,l.lastValueFrom)(n,{defaultValue:null}):a=Promise.resolve(n),a}validate(n,a){let u=a;a&&(u=this._setParamsProxy(a));const h=t(u)(n,u);return this.isAsync?this._toPromise(h).then(g=>g&&u?.message?this._getMessageFromParams(u):g):u?.message&&h?this._getMessageFromParams(u):h}}}}class Lm{}const wp="ValidatorRegistry";class bi extends he{static#e=this.registryKey=wp;static _hasWithAnotherTypeRef(e,t){const s=bi.items.get(e);return!s||s.lazy&&!s.typeRef?!1:s.typeRef!==t}static validate(e){if(Ae(e.type,"ValidatorTypeName"),e.typeRef&&bi._hasWithAnotherTypeRef(e.type,e.typeRef))throw new Error(`Error when register ${e.type}. Element with this type has already exist`)}static get items(){return this.store.typeInfos}static register(e){const t=this.items.get(e.type);this.items.set(e.type,{...t??{},...e})}}class cn extends fi{constructor(e){super(e)}getValidator(e,t){const s=bi.items.get(e);if(!s)throw new Error(`Validator '${e}' was not registered`);if(s.lazy&&!s.instantiate)throw new Error(`Lazy module with ${e} validator is not loaded`);return s.instantiate(t?.injectionContext)}static#e=this.\u0275fac=function(t){return new(t||cn)(c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:cn,factory:cn.\u0275fac})}var me;(function(i){i.ChangeAttributeValue="change-attribute-value",i.ModelDataLoaded="model-data-loaded-event",i.BeforeModelLoad="before-model-load",i.LoadDefaultValues="load-default-values",i.StartLoadModelAttributes="start-load-model-attributes",i.FinishLoadModelAttributes="finish-load-model-attributes",i.ViewEvent="view-event"})(me||(me={}));function _l(i,e){if(!i||!e)return l.EMPTY;const t=e.events$.pipe((0,o.filter)(s=>s.type===me.ChangeAttributeValue),(0,o.filter)(s=>s.payload.attributeName===i),(0,o.switchMap)(()=>e[i]));return new l.Observable(s=>(i in e?(0,l.merge)((0,l.from)(e[i]),t):t).subscribe(s))}class yl{}class Jt extends yl{getChanges(e,t,s){const r=e.map(n=>_l(n,s));return(0,l.combineLatest)(r)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Jt)))(s||Jt)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Jt,factory:Jt.\u0275fac})}function bl(i,e){if(!i||!e)return l.EMPTY;const t=new l.ReplaySubject(1),s=ce.instance.subscribe(r=>{r.type===i&&t.next(r)},e);return e._subscriptions.add(s),t}const Pp=100;class Ws extends yl{constructor(e){super(),this._converterEvaluator=e}_accumulateRequests(e,t,s){const r=new l.BehaviorSubject([]),n=this._accumulateRequestsCombinations(e,r,t,s).subscribe();return new l.Observable(a=>(r.complete(),n.unsubscribe(),this._findAcceptableRequestsCombination(r.value,t,s).pipe((0,o.switchMap)(u=>u?(0,l.merge)((0,l.of)(u),e):e)).subscribe(a)))}_accumulateRequestsCombinations(e,t,s,r){return e.pipe((0,o.map)(n=>[n,...t.value]),(0,o.switchMap)(n=>n.length<Pp?(0,l.of)(n):this._findAcceptableRequestsCombination(n,s,r).pipe((0,o.map)(a=>a?[a]:[]))),(0,o.tap)(n=>t.next(n)),(0,o.map)(()=>{}))}_findAcceptableRequestsCombination(e,t,s){if(!e.length)return(0,l.of)(null);const{filter:r,originalFrom:n}=t;return(0,l.from)(e).pipe((0,P.Ny)(a=>this._converterEvaluator.evaluate({args:Array.isArray(n)?a:a[0],context:s,expression:r})),(0,o.first)(([,a])=>!!a,[null]),(0,o.map)(([a])=>a))}getChanges(e,t,s){const r=e.map(a=>bl(a,s)),n=(0,l.combineLatest)(r);return t.filter?this._accumulateRequests(n,t,s):n}static#e=this.\u0275fac=function(t){return new(t||Ws)(c.\u0275\u0275inject(it))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ws,factory:Ws.\u0275fac})}const Dp=P.gX.create({token:pl,mappings:[{predicate:i=>i.every(e=>Ht.requestsRegistrationInfos.has(e)),injectable:Ws}],default:{injectable:Jt}});class Tp{}class Sl extends Tp{constructor(e){super(),this._converterEvaluator=e}getTrigger(e,t){return this.getTriggerInternal(e,t).pipe((0,P.Ny)(s=>this._converterEvaluator.evaluate({args:s,expression:e?.filter,context:t,defaultEvaluationFn:()=>!0})),(0,o.filter)(([,s])=>!!s),(0,o.map)(()=>{}))}}class Zs extends Sl{constructor(e){super(e)}getTriggerInternal(e,t){return _l(e?.attribute,t)}static#e=this.\u0275fac=function(t){return new(t||Zs)(c.\u0275\u0275inject(it))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Zs,factory:Zs.\u0275fac})}class Js extends Sl{constructor(e){super(e)}getTriggerInternal(e,t){return new l.Observable(s=>bl(e?.request,t).subscribe(s))}static#e=this.\u0275fac=function(t){return new(t||Js)(c.\u0275\u0275inject(it))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Js,factory:Js.\u0275fac})}const Np=P.gX.create({token:ml,mappings:[{predicate:dl,injectable:Zs},{predicate:hl,injectable:Js}]});class un{static#e=this.\u0275fac=function(t){return new(t||un)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:un});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Gs,it,Zs,Js,Jt,Ws,Dp,Np]})}class Cl{constructor(e,t,s=!1){this.name=e,this._value=t,this._locked=s,this._isValueInitialized=!1,this._pendingValue=void 0,this._onChanged=new c.EventEmitter,this._hasInitialValue=!1,t!=null&&(this._isValueInitialized=!0,this._hasInitialValue=!0,this._initialValue=t)}get onChanged(){return this._onChanged}get value(){return this.getValue()}set value(e){this.setValue(e)}get initialValue(){return this._initialValue}set initialValue(e){this.setInitialValue(e)}get hasInitialValue(){return this._hasInitialValue}get isLocked(){return this._locked}emitValueChanged(e){this.onChanged.emit(e)}areValuesEqual(e,t){return(0,D.isEqual)(e,t)}getValue(){return this._value}setValue(e,t=!1){if(this._locked||(this._isValueInitialized=!0,this._pendingValue=e,this.areValuesEqual(this._value,e)))return;const s=(0,D.cloneDeep)(this._value);this._value=(0,D.cloneDeep)(e),!t&&this.emitValueChanged({name:this.name,value:e,oldValue:s})}resetValue(){this.hasInitialValue&&this.setValue(this.initialValue)}setInitialValue(e){this._hasInitialValue=!0,this._initialValue=e,this._isValueInitialized||this.setValue(e,!0)}setPending(e){const t=typeof this._pendingValue>"u"?this.value:this._pendingValue;this.value=e,this._pendingValue=t}resetPending(){this.value=this._pendingValue,this._pendingValue=void 0}}class Eo extends Cl{constructor(e,t,s,r,n=!1){super(e,t,n),this._validatorTypeResolver=s,this._injectionContext=r,this._onValidatorChanged=new c.EventEmitter}get onValidatorChanged(){return this._onValidatorChanged}_createValidatorInfo(){return{name:this.validatorTypeName,instance:this._validatorTypeResolver.getValidator(this.validatorTypeName,{injectionContext:this._injectionContext}),disabled:!0}}emitValueChanged(e){super.emitValueChanged(e),this.hasValidator&&this.updateValidator(e)&&this._onValidatorChanged.emit()}get hasValidator(){return!1}updateValidator(e){return!1}setValidatorInfo(e,t=!1){this.validatorInfo=e}initializeValidator(e,t=!1){if(!this.hasValidator||this._validatorTypeResolver==null)return e;let s=e.find(n=>n.name===this.validatorTypeName),r=!1;return s==null&&(s=this._createValidatorInfo(),r=!0),this.setValidatorInfo(s,t),r?[...e,s]:e}}class Al{static#e=this._properties=new Map;static _get(e){if(!e)return Eo;if(this._properties.has(e))return this._properties.get(e);throw new Error(`CrtControlProperty with type ${e} doesn't registered`)}static register(e,t){this._properties.set(e,t)}static create(e){const t=this._get(e.typeName);return new t(e.name,e.value,e.validatorTypeResolver,e.injectionContext,e.locked===!0)}}function Vp(i){return function(e){Ae(i.name,"PropertyName"),Al.register(i.name,e)}}let Mo=class extends Eo{constructor(){super(...arguments),this.validatorTypeName="crt.Required"}get hasValidator(){return!0}updateValidator(e){return this.validatorInfo&&(this.validatorInfo.disabled=!e.value),!0}setValidatorInfo(e,t=!1){super.setValidatorInfo(e,t),this.initialValue=!e.disabled,this.setValue(!e.disabled,t)}};Mo=(0,f.__decorate)([Vp({name:"crt.Required"})],Mo);let Io=class extends H{};Io=(0,f.__decorate)([B({type:"crt.AddCommunicationOptionsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.Add\u0421ommunicationOptionsRequest",propertiesPanelComponentTypeName:"crt.AddCommunicationOptionsRequestPropertiesPanel",position:740})],Io);var Be;(function(i){i.Selection="selection",i.Filtration="filtration"})(Be||(Be={}));class vl extends H{}class El extends vl{}let Ro=class extends El{};Ro=(0,f.__decorate)([B({type:"crt.AddRecordsInStaticFoldersRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.AddRecordsInStaticFoldersRequest",propertiesPanelComponentTypeName:"crt.AddRecordsInStaticFoldersRequestPropertiesPanel",position:706,compatibleAPIs:{[Be.Selection]:!0}})],Ro);class xp extends H{}let wo=class extends xp{};wo=(0,f.__decorate)([B({type:"crt.AddTagsInRecordRequest"})],wo);let Po=class extends H{};Po=(0,f.__decorate)([B({type:"crt.ContinueInOtherPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ContinueInOtherPageRequest",position:1e3})],Po);let Do=class extends H{};Do=(0,f.__decorate)([B({type:"crt.CopilotActionRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CopilotActionRequest",propertiesPanelComponentTypeName:"crt.CopilotActionRequestPropertiesPanelComponent",position:3001})],Do);let To=class extends H{};To=(0,f.__decorate)([B({type:"crt.CreateRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CreateRecordRequest",propertiesPanelComponentTypeName:"crt.CreateRecordRequestPropertiesPanel",position:200})],To);let No=class extends H{};No=(0,f.__decorate)([B({type:"crt.DeleteRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.DeleteRecordsRequest",propertiesPanelComponentTypeName:"crt.DeleteRecordsRequestPropertiesPanel",position:701,compatibleAPIs:{[Be.Selection]:!0}})],No);let Vo=class extends H{};Vo=(0,f.__decorate)([B({type:"crt.ExportDataGridToExcelRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ExportDataGridToExcelRequest",propertiesPanelComponentTypeName:"crt.ExportDataGridToExcelRequestPropertiesPanel",position:800,compatibleAPIs:{[Be.Selection]:!0}})],Vo);let xo=class extends H{};xo=(0,f.__decorate)([B({type:"crt.ImportDataRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ImportDataRequest",propertiesPanelComponentTypeName:"crt.ImportDataRequestPropertiesPanel",position:750})],xo);let Oo=class extends H{};Oo=(0,f.__decorate)([B({type:"crt.MoveSelectedItemsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.MoveSelectedItemsRequest",propertiesPanelComponentTypeName:"crt.MoveSelectedItemsRequestPropertiesPanel",position:1e3,compatibleAPIs:{[Be.Selection]:!0}})],Oo);var Ml;(function(i){i.Root="root",i.Item="item",i.Const="const"})(Ml||(Ml={}));class Bm{}let Lo=class extends H{};Lo=(0,f.__decorate)([B({type:"crt.OpenChangeLogRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenChangeLogRequest",propertiesPanelComponentTypeName:"crt.OpenChangeLogRequestPropertiesPanel",position:370})],Lo);let Bo=class extends H{};Bo=(0,f.__decorate)([B({type:"crt.OpenDuplicatesPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenDuplicatesPageRequest",propertiesPanelComponentTypeName:"crt.OpenDuplicatesPageRequestPropertiesPanel",position:360})],Bo);let ko=class extends H{};ko=(0,f.__decorate)([B({type:"crt.OpenPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenPageRequest",propertiesPanelComponentTypeName:"crt.OpenPageRequestPropertiesPanel",position:350})],ko);let Fo=class extends H{};Fo=(0,f.__decorate)([B({type:"crt.PrintablesRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.PrintablesRequest",propertiesPanelComponentTypeName:"crt.PrintablesRequestPropertiesPanel",position:3e3,compatibleAPIs:{[Be.Selection]:!0}})],Fo);let jo=class extends El{};jo=(0,f.__decorate)([B({type:"crt.RemoveRecordsInStaticFoldersRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RemoveRecordsInStaticFoldersRequest",propertiesPanelComponentTypeName:"crt.RemoveRecordsInStaticFoldersRequestPropertiesPanel",position:705,compatibleAPIs:{[Be.Selection]:!0}})],jo);class Il extends vl{}let $o=class extends Il{};$o=(0,f.__decorate)([B({type:"crt.RemoveTagsInRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RemoveTagsInRecordsRequest",propertiesPanelComponentTypeName:"crt.RemoveTagsInRecordsRequestPropertiesPanel",position:704,compatibleAPIs:{[Be.Selection]:!0}})],$o);let Uo=class extends H{};Uo=(0,f.__decorate)([B({type:"crt.RunBusinessProcessRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RunBusinessProcessRequest",propertiesPanelComponentTypeName:"crt.RunBusinessProcessRequestPropertiesPanel",position:700,compatibleAPIs:{[Be.Selection]:!0}})],Uo);let qo=class extends H{};qo=(0,f.__decorate)([B({type:"crt.SaveRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SaveRecordRequest",propertiesPanelComponentTypeName:"crt.SaveRecordRequestPropertiesPanel",position:400})],qo);let Ho=class extends H{};Ho=(0,f.__decorate)([B({type:"crt.SelectLookupPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SelectLookupPageRequest",propertiesPanelComponentTypeName:"crt.SelectLookupPageRequestPropertiesPanel",scopes:["BaseLookupPageTemplate"],position:2e3})],Ho);let Ko=class extends H{};Ko=(0,f.__decorate)([B({type:"crt.SetRecordRightsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SetRecordRightsRequest",propertiesPanelComponentTypeName:"crt.SetRecordRightsRequestPropertiesPanel",position:800})],Ko);let zo=class extends H{};zo=(0,f.__decorate)([B({type:"crt.ShowRelationshipsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ShowRelationshipsRequest",propertiesPanelComponentTypeName:"crt.ShowRelationshipsRequestPropertiesPanel",position:900})],zo);let Go=class extends H{};Go=(0,f.__decorate)([B({type:"crt.UpdateRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.UpdateRecordRequest",propertiesPanelComponentTypeName:"crt.UpdateRecordRequestPropertiesPanel",position:300})],Go);let Wo=class extends H{};Wo=(0,f.__decorate)([B({type:"crt.UploadFileRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.UploadFileRequest",propertiesPanelComponentTypeName:"crt.UploadFileRequestPropertiesPanel",position:702})],Wo);let Zo=class extends H{constructor(){super(...arguments),this.type="crt.CancelRecordChangesRequest"}};Zo=(0,f.__decorate)([B({type:"crt.CancelRecordChangesRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CancelRecordChangesRequest",position:500})],Zo);let Jo=class extends H{constructor(){super(...arguments),this.type="crt.ClosePageRequest"}};Jo=(0,f.__decorate)([B({type:"crt.ClosePageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ClosePageRequest",position:600})],Jo);class Rt extends H{}let Xo=class extends Rt{constructor(){super(...arguments),this.type="crt.HandleAfterModelDeleteRequest"}};Xo=(0,f.__decorate)([B({type:"crt.HandleAfterModelDeleteRequest"})],Xo);let Yo=class extends Rt{constructor(){super(...arguments),this.type="crt.HandleAfterModelInsertRequest"}};Yo=(0,f.__decorate)([B({type:"crt.HandleAfterModelInsertRequest"})],Yo);let Qo=class extends Rt{constructor(){super(...arguments),this.type="crt.HandleAfterModelLoadRequest"}};Qo=(0,f.__decorate)([B({type:"crt.HandleAfterModelLoadRequest"})],Qo);let ec=class extends Rt{constructor(){super(...arguments),this.type="crt.HandleAfterModelUpdateRequest"}};ec=(0,f.__decorate)([B({type:"crt.HandleAfterModelUpdateRequest"})],ec);let tc=class extends Rt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelDeleteRequest"}};tc=(0,f.__decorate)([B({type:"crt.HandleBeforeModelDeleteRequest"})],tc);let sc=class extends Rt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelInsertRequest"}};sc=(0,f.__decorate)([B({type:"crt.HandleBeforeModelInsertRequest"})],sc);let rc=class extends Rt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelLoadRequest"}};rc=(0,f.__decorate)([B({type:"crt.HandleBeforeModelLoadRequest"})],rc);let nc=class extends Rt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelUpdateRequest"}};nc=(0,f.__decorate)([B({type:"crt.HandleBeforeModelUpdateRequest"})],nc);let ic=class extends Il{};ic=(0,f.__decorate)([B({type:"crt.AddTagsInRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.AddTagsInRecordsRequest",propertiesPanelComponentTypeName:"crt.AddTagsInRecordsRequestPropertiesPanel",position:703,compatibleAPIs:{[Be.Selection]:!0}})],ic);function Op(){const i=[Mo,Io,Ro,wo,Po,Do,To,No,Vo,xo,Oo,Lo,Bo,ko,Fo,jo,$o,Uo,qo,Ho,Ko,zo,Go,Wo,Zo,Jo,Qa,Xo,Yo,Qo,ec,tc,sc,rc,nc,ic]}let ac=class extends H{constructor(e){super(),this.type="crt.HandleViewModelAttributeChangeRequest",this.attributeName=e.attributeName,this.value=e.value,this.oldValue=e.oldValue,this.silent=!!e.silent,this.preventAttributeChangeRequest=!!e.preventAttributeChangeRequest,this.preventStateChange=!!e.preventStateChange,this.preventRunBusinessRules=!!e.preventRunBusinessRules}};ac=(0,f.__decorate)([B({type:"crt.HandleViewModelAttributeChangeRequest"}),(0,f.__metadata)("design:paramtypes",[Object])],ac);var at;(function(i){i.DebouncingBusinessRules="DebouncingBusinessRules",i.RunningBusinessRules="RunningBusinessRules",i.ProcessingAttributeChangeRequest="ProcessingAttributeChangeRequest",i.AttributeLoading="AttributeLoading"})(at||(at={}));let oc=class extends H{constructor(){super(...arguments),this.type="crt.HandleViewModelInitRequest"}};oc=(0,f.__decorate)([B({type:"crt.HandleViewModelInitRequest"})],oc);let cc=class extends H{constructor(){super(...arguments),this.type="crt.HandleViewModelResumeRequest"}};cc=(0,f.__decorate)([B({type:"crt.HandleViewModelResumeRequest"})],cc);let uc=class extends H{constructor(){super(...arguments),this.type="crt.HandleViewModelPauseRequest"}};uc=(0,f.__decorate)([B({type:"crt.HandleViewModelPauseRequest"})],uc);let lc=class extends H{constructor(){super(...arguments),this.type="crt.HandleViewModelDestroyRequest"}};lc=(0,f.__decorate)([B({type:"crt.HandleViewModelDestroyRequest"})],lc);class Lp{constructor(e={preventAttributeChangeRequest:!1,preventRunBusinessRules:!1,preventStateChange:!1,isMaskedValue:!1}){this._preventAttributeChangeRequest=!1,this._preventStateChange=!1,this._preventRunBusinessRules=!1,this._isMaskedValue=!1,this._setOptions(e)}_setUsingSilent(e){this._preventStateChange=e,this._preventRunBusinessRules=e,this._preventAttributeChangeRequest=!1}_setOptions(e){this._preventAttributeChangeRequest=e?.preventAttributeChangeRequest??this._preventAttributeChangeRequest,this._preventStateChange=e?.preventStateChange??this._preventStateChange,this._preventRunBusinessRules=e?.preventRunBusinessRules??this._preventRunBusinessRules,this._isMaskedValue=e?.isMaskedValue??this._isMaskedValue}getAsSilent(){return this._preventRunBusinessRules&&this._preventStateChange}getIsMaskedValue(){return this._isMaskedValue}setOptions(e){if((0,D.isUndefined)(e?.silent)){const t=(0,D.pick)(e,"preventAttributeChangeRequest","preventStateChange","preventRunBusinessRules","isMaskedValue");this._setOptions(t)}else this._setUsingSilent(e?.silent)}getOptions(){return{preventAttributeChangeRequest:this._preventAttributeChangeRequest,preventRunBusinessRules:this._preventRunBusinessRules,preventStateChange:this._preventStateChange,isMaskedValue:this._isMaskedValue}}reset(){this._preventAttributeChangeRequest=!1,this._preventRunBusinessRules=!1,this._preventStateChange=!1,this._isMaskedValue=!1}}var Si;(function(i){i.EntityDataSource="crt.EntityDataSource",i.WebServiceDataSource="crt.WebServiceDataSource",i.PageParametersDataSource="crt.PageParametersDataSource"})(Si||(Si={}));var Xs;(function(i){i.Reload="reload",i.Merge="merge"})(Xs||(Xs={}));function Bp(i){let e=!1;const t=[];return Object.keys(i).forEach(s=>{Rl(s,i)&&(e=!0,t.push(s))}),{hasCycles:e,cycledModelsNames:t}}function Rl(i,e,t=[]){if(!e[i])return!1;const s=Object.values(e[i]);return s.some(n=>t.includes(wl(n)))?!0:(t.push(i),!s.every(n=>!Rl(wl(n),e,t)))}function wl(i){return i.relationPath.split(".")[0]}var Ci;(function(i){i.AddTask="addTask",i.RemoveTask="removeTask"})(Ci||(Ci={}));class Pl extends H{constructor(e,t,s){super(),this.action=e,this.taskName=t,this.$context=s,this.type="crt.SchemaViewMaskRequest"}}class dc extends kn{constructor(){super(...arguments),this.requestType="crt.MaskService"}showMask(e,t){return(0,C.A)(function*(){const s=new Pl(Ci.AddTask,e,t);yield ce.instance.process(s)})()}hideMask(e,t){return(0,C.A)(function*(){const s=new Pl(Ci.RemoveTask,e,t);yield ce.instance.process(s)})()}}(0,f.__decorate)([He(),(0,f.__metadata)("design:type",Function)],dc.prototype,"showBodyMask",void 0),(0,f.__decorate)([He(),(0,f.__metadata)("design:type",Function)],dc.prototype,"hideBodyMask",void 0);const kp=new c.InjectionToken("DEVKIT_MASK_SERVICE",{providedIn:"root",factory:()=>new dc});class Dl{constructor(e){this.ngZone=e}run(e,t,s){return this.ngZone.runOutsideAngular(e)}}class Fp extends Dl{constructor(e){super(e)}run(e,t,s){return this.ngZone.run(e,t,s)}}var hc;(function(i){i.Root="root",i.Angular="angular",i.ExecutionTracking="executionTracking"})(hc||(hc={}));var ln;(function(i){i[i.Busy=0]="Busy",i[i.Idle=1]="Idle"})(ln||(ln={}));var Ai;(function(i){i.ReadyStateChange="readystatechange"})(Ai||(Ai={}));class jp{constructor(e){this._trackedTasks=[],this._trackedEventTasks=[],this._enableDebugTracking=!1,this._disableWaits=!1,this._pendingFunctions=new Map,this.onStateChange$=new c.EventEmitter(!1),this._parentZone=Zone.current,this._rootZone=Zone.root,this._isBusy=!1,this._ignoredTaskSources=["setInterval","requestAnimationFrame"],this._eventTaskFilters=[t=>t.source.startsWith("XMLHttpRequest")&&t.source.endsWith(Ai.ReadyStateChange)],this._zone=this._parentZone.fork({name:e,properties:{currentExecutionZone:this},onInvokeTask:this._onInvokeTask.bind(this),onCancelTask:this._onCancelTask.bind(this),onScheduleTask:this._onScheduleTask.bind(this),onHasTask:this._onHasTask.bind(this)})}wait(e){if(this._disableWaits)return e();this._isBusy||(this._isBusy=!0,this.onStateChange$.next(ln.Busy));const t=(0,L.qv)();return this._pendingFunctions.set(t,this._enableDebugTracking?e:null),e().finally(()=>{this._pendingFunctions.delete(t),!this._pendingFunctions.size&&this._zone.run(()=>new Promise(s=>setTimeout(s)))}).catch(s=>{throw s})}_cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(e,t){if(e.type==="eventTask"&&(e.state==="running"||e.state==="scheduled")){const s=e;s.eventName===Ai.ReadyStateChange&&s.target.readyState===XMLHttpRequest.DONE&&t.cancelTask(s)}}_onInvokeTask(e,t,s,r,n,a){this._unTrackTask(r);let u;try{u=e.invokeTask(s,r,n,a),this._cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(r,t)}catch(d){console.error(d),t.cancelTask(r)}return u}_onCancelTask(e,t,s,r){return this._unTrackTask(r),e.zone.runGuarded(()=>e.cancelTask(s,r))}_onScheduleTask(e,t,s,r){return this._getCanScheduleTask(r)?(this._trackTask(r),e.scheduleTask(s,r)):(r.cancelScheduleRequest(),this._parentZone.scheduleTask(r))}_onHasTask(e,t,s,r){e.hasTask(s,r);const n=r.eventTask||r.macroTask||r.microTask||this._pendingFunctions.size>0;this._isBusy!==n&&(this._rootZone.run(()=>this.onStateChange$.next(n?ln.Busy:ln.Idle)),this._isBusy=n)}_trackTask(e){this._enableDebugTracking&&(e.type==="eventTask"&&this._trackedEventTasks.push(e),this._trackedTasks.push(e))}_unTrackTask(e){if(!this._enableDebugTracking)return;const t=this._trackedTasks.indexOf(e);t>-1&&this._trackedTasks.splice(t,1)}_getCanScheduleTask(e){return e.type==="eventTask"?this._eventTaskFilters.some(t=>t(e)):this._ignoredTaskSources.indexOf(e.source)===-1}run(e,t,s){return this._zone.run(e,t,s)}}class Ys{constructor(e){this._ngZone=e}createDefaultZones(){return{root:new Dl(this._ngZone),angular:new Fp(this._ngZone)}}createZone(e,t){if(t===hc.ExecutionTracking)return new jp(e);throw new Error(`Zone ${e} with type ${t} is not supported`)}static#e=this.\u0275fac=function(t){return new(t||Ys)(c.\u0275\u0275inject(c.NgZone))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ys,factory:Ys.\u0275fac,providedIn:"root"})}let pc=class Vi{constructor(e){this._zoneProvider=e,this._zones=e.createDefaultZones()}init(e){var t=this;return(0,C.A)(function*(){t._disableExecutionTrackingZone=yield(0,l.lastValueFrom)(e("DisableExecutionTrackingZone"))})()}runInZone(e,t,s,r){return this._disableExecutionTrackingZone&&e!==Et.Angular&&(e=Et.Root),(this._zones[e]??this._zones[Et.Root]).run(t,s,r)}register(e,t){if(this._zones[e])throw new Error(`Zone ${e} already registered`);const s=this._zoneProvider.createZone(e,t);return this._zones[e]=s,s}get(e){return this._zones[e]}runOutside(e){return this.runInZone(Et.Root,e)}static#e=this.\u0275fac=function(t){return new(t||Vi)(c.\u0275\u0275inject(Ys))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Vi,factory:Vi.\u0275fac,providedIn:"root"})};pc=(0,f.__decorate)([(0,P.op)({requestType:"crt.ZoneService"}),(0,f.__metadata)("design:paramtypes",[Ys])],pc);const Tl=new c.InjectionToken("CRT_METADATA_PREPROCESSOR");class $p{constructor(e,t){this.id=e,this._baseHostInjector=t,this._hostModuleTypes=[],this._hostModuleRefs=[],this._lazyModulesBySource=new Map,this._hostInjector=this._baseHostInjector}_createDynamicNgModule(e){const s=this._hostInjector.get(Tl,[]).map(a=>({provide:Tl,useValue:a,multi:!0})),r=(0,c.NgModule)({providers:s})(class{}),n=(0,c.NgModule)({imports:[r,...e]})(class{});return(0,c.createNgModule)(n,this._hostInjector)}inject(e){return this._hostInjector.get(e)}addLazyModule(e){const t=In.get(e);if(!t)throw new Error("Module was not bootstrapped");const{source:s}=t;this._lazyModulesBySource.has(s)||this._lazyModulesBySource.set(s,new Set),this._lazyModulesBySource.get(s).add(e)}getLazyModules(e){return[...this._lazyModulesBySource.get(e)??[]]}connectHostLazyModules(){const e=this.getLazyModules("host");if((0,D.isEqual)(e,this._hostModuleTypes))return;const t=this._createDynamicNgModule(e);this._hostModuleTypes=e,this._hostModuleRefs.push(t),this._hostInjector=t.injector}destroy(){for(const e of this._hostModuleRefs)e.destroy();this._hostModuleRefs=[]}}var mc=y(74975);class Qs extends mc.S{constructor(){super(...arguments),this._injectionContextsMap=new Map}createContext(e,t){const s=new $p(e,t);return this._injectionContextsMap.set(e,s),s}injectFromContext(e,t){return this._injectionContextsMap.get(e).inject(t)}removeContext(e){return this._injectionContextsMap.get(e)?.destroy(),this._injectionContextsMap.delete(e)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Qs)))(s||Qs)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Qs,factory:Qs.\u0275fac,providedIn:"root"})}const Up=new c.InjectionToken("IS_DESIGN_TIME"),qp=new c.InjectionToken("Terrasoft global object",{providedIn:"root",factory:()=>(0,D.get)((0,c.inject)(P.ZP),["Terrasoft"])||{}}),Hp=new c.InjectionToken("Flag indicating that this is an angular host",{providedIn:"root",factory:()=>(0,D.get)((0,c.inject)(qp),["isAngularHost"])}),Nl=100;class er extends mc.S{constructor(){super(...arguments),this._window=(0,c.inject)(P.ZP),this._requestBuffer=[],this._requestIter=0,this._cachedRequestIter=0,this._compressedRequestIter=0}_onRequest(e){const t=e.getEntries();for(const s of t){if(!s.name.startsWith(this._window.location.origin))return;this._requestIter++,s.transferSize||this._cachedRequestIter++,s.encodedBodySize!==s.decodedBodySize&&this._compressedRequestIter++,s.fetchStart&&s.responseStart&&s.responseEnd&&this._requestBuffer.push({name:s.name,initiatorType:s.initiatorType,transferSize:s.transferSize,responseStart:s.responseStart,responseEnd:s.responseEnd,fetchStart:s.fetchStart})}}_calculateLatency(e,t){return e/(t/1e3)/1e3/1e3||0}_normalizeUrl(e,t){try{return(e+new URL(t)?.pathname.replace("/0/","/")).slice(0,Nl)}catch{return t?.slice(0,Nl)}}_reset(){this._resourcePerformanceObserver?.disconnect(),this._markPerformanceObserver?.disconnect(),this._requestBuffer=[],this._compressedRequestIter=0,this._cachedRequestIter=0,this._requestIter=0}_downlink(){let e=0,t=0;return this._requestBuffer.forEach(r=>{r.initiatorType==="xmlhttprequest"&&(e+=r.transferSize,t+=r.responseEnd-r.responseStart)}),+this._calculateLatency(e,t).toFixed(1)}_withCache(){return Math.round(this._cachedRequestIter/this._requestIter*100)||0}_withCompression(){return Math.round(this._compressedRequestIter/this._requestIter*100)||0}_topRequests(e){const t=[];for(let s=this._requestBuffer.length-1;s>=0;s--){const r=this._requestBuffer[s],n=Math.round(r.responseEnd-r.fetchStart);if(n>=e.topRequestThreshold&&t.length<e.topRequestCount){const a=this._normalizeUrl(n,r.name);if(t.push(a),t.length===e.topRequestThreshold)return t}}return t}start(){this._reset(),this._resourcePerformanceObserver=this._resourcePerformanceObserver??new PerformanceObserver(this._onRequest.bind(this)),this._resourcePerformanceObserver.observe({type:"resource",buffered:!this._firstStart}),this._firstStart=!0}measure(e={topRequestThreshold:400,topRequestCount:5}){const t={transferred:0};return this._requestBuffer.sort((s,r)=>s.fetchStart-r.fetchStart),t.duration=this._calculateDuration(),t.transferred=this._calculateTransferred(),t.downlink=this._downlink(),t.cache=this._withCache(),t.compression=this._withCompression(),t.topRequests=this._topRequests(e),this._reset(),t}_calculateDuration(){let e=this._requestBuffer[0]?.responseEnd,t=this._requestBuffer[0]?.responseEnd-this._requestBuffer[0]?.fetchStart;return this._requestBuffer.forEach(s=>{e<s.fetchStart?t+=s.responseEnd-s.fetchStart:e<s.responseEnd&&(t+=s.responseEnd-e),e=Math.max(e,s.responseEnd)}),Math.round(t)||0}_calculateTransferred(){let e=this._requestBuffer.reduce((t,s)=>t+s.transferSize,0);return e=Math.round(e/1e3)||0,e}ngOnDestroy(){this._reset()}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(er)))(s||er)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:er,factory:er.\u0275fac,providedIn:"root"})}var ze;(function(i){i.PageStartLoading="PageStartLoading",i.PageFinishLoading="PageFinishLoading"})(ze||(ze={}));class dn extends mc.S{constructor(){super(),this._ngZone=(0,c.inject)(c.NgZone),this._window=(0,c.inject)(P.ZP),this._featureValues=(0,c.inject)(E,{optional:!0}),this._isAngularHost=(0,c.inject)(Hp,{optional:!0}),this._performanceNetworkObserver=(0,c.inject)(er),this._measureName="PageLoadDuration",this._debounceTime=100,this._subscriptions=new l.Subscription,this._measurements=[],this._tasks=new Set,this._loadingStarted=!1,this._loadingStartedCount=new Set,this._loadingFinishedCount=new Set,this._tasksQueueSubject=new l.Subject,this._pageLoadLifeCycleSubject=new l.Subject,this._iterationCounter=0,this.pageLoadDuration$=new l.Subject,this._enableMeasurement=!!this._isAngularHost&&!this._featureValues?.DisablePerformancePageLoadMeasurement,this._initSubscriptions(),(0,D.set)(this._window,"creatio.performance.measurePerformancePageLoadService",this)}_initSubscriptions(){this._enableMeasurement&&(this._subscriptions.add(this._tasksQueueSubject.pipe((0,l.debounceTime)(this._debounceTime),(0,o.filter)(e=>this._loadingStartedCount.size===this._loadingFinishedCount.size&&this._loadingStarted&&e.size===1&&e.has(ze.PageStartLoading))).subscribe({next:()=>this._pageLoadLifeCycleSubject.next(ze.PageFinishLoading)})),this._subscriptions.add(this._pageLoadLifeCycleSubject.subscribe({next:e=>{this._ngZone.runOutsideAngular(()=>{e===ze.PageStartLoading&&this._onStartPageLoadMeasure(),e===ze.PageFinishLoading&&this._onEndPageLoadMeasure()})}})))}_onStartPageLoadMeasure(){this.addTask(ze.PageStartLoading)}_getLocationInfo(){const e=this._window.location.hash,[t,s]=e.slice(1).split("/");return{moduleName:t,schemaName:s,hash:e}}_getMeasurementDetail(){const t=((0,D.get)(this._window,"creatio.performance")??{}).focusLossDuringLoad,s={iteration:this._iterationCounter++,location:this._getLocationInfo(),isReuse:!!this._isReuseMode,focusLossDuringLoad:!!t};return this._featureValues.DisablePerformancePageNetworkMeasurement||(s.network=this._performanceNetworkObserver.measure()),s}_onEndPageLoadMeasure(){this.removeTask(ze.PageFinishLoading),this.removeTask(ze.PageStartLoading);const e={start:this._startTime,detail:this._getMeasurementDetail(),end:this._window.performance.now()};this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this.pageLoadDuration$.next(e),this._reset()}_reset(){const e=(0,D.get)(this._window,"creatio.performance");e.initialLoad?e.initialLoad=!1:e.focusLossDuringLoad=null,this._startTime=null,this._tasks.clear(),this._loadingStarted=!1,this._loadingStartedCount.clear(),this._loadingFinishedCount.clear(),this._isReuseMode=null}setReuseMode(e){this._enableMeasurement&&this._isReuseMode===null&&(this._isReuseMode=e)}startPageLoadMeasure(e=performance.now()){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{this._reset(),this._startTime=e,this._pageLoadLifeCycleSubject.next(ze.PageStartLoading),this._featureValues.DisablePerformancePageNetworkMeasurement||this._performanceNetworkObserver.start()})}addTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&(this._loadingStartedCount.add(e),this._loadingStarted=!0),this._tasks.add(e),this._tasksQueueSubject.next(this._tasks)})}removeTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&this._loadingFinishedCount.add(e),this._tasks.delete(e),this._tasksQueueSubject.next(this._tasks)})}getMeasurements(){const e=this._measurements.map(t=>t());return this._measurements=[],e}getMeasureDataOnTimeout$(){const e={start:this._startTime,end:this._window.performance.now(),detail:this._getMeasurementDetail(),timeout:!0};return this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this._reset(),(0,l.of)(e)}ngOnDestroy(){this._reset(),this._subscriptions.unsubscribe(),this._tasksQueueSubject.complete(),this._pageLoadLifeCycleSubject.complete(),this.pageLoadDuration$.complete()}static#e=this.\u0275fac=function(t){return new(t||dn)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:dn,factory:dn.\u0275fac,providedIn:"root"})}const tr=Symbol("InternalViewModelInjector");class ot extends Array{constructor(...e){return super(),this._itemsChanged=new l.Subject,this._itemAttributeChanged=new l.Subject,this._destroyed$=new l.Subject,this._changed=new l.Subject,this._trackChanges=!0,this._createdItems=[],this._deletedItems=[],this._isDestroyed=!1,typeof e[0]=="number"?new Array(e[0]):([this._viewModelGenerator,this._viewModelConfig={},this._model,this._host,this._hostAttributeName]=e,this._measurePerformanceService=this._host?.[tr]?.get(ge,null,{optional:!0}),this._featureValues=this._host?.[tr]?.get(E,{},{optional:!0})??{},this._ngZone=this._host?.[tr]?.get(c.NgZone,null,{optional:!0}),Object.setPrototypeOf(this,Object.create(ot.prototype)),this._subscribeItemsModelModesChanges(),this._subscribeItemsAttributesChanges(),new Proxy(this,{set:(t,s,r,n)=>{const a=t[s];return t[s]=r,this._trackChanges&&(s==="length"&&r!==a?this._onItemsChanged():isNaN(parseInt(s))||this._onItemsChanged()),!0}}))}get changed(){return this._changed.asObservable().pipe((0,P.BV)(this._ngZone),(0,o.takeUntil)(this._destroyed$))}get itemAttributeChanged(){return this._itemAttributeChanged.asObservable().pipe((0,o.takeUntil)(this._destroyed$))}get isChanged(){return this.getChangedItems().length>0}get formApiModel(){return this._formApiModel||this._updateFormApiModelValues({emitEvent:!1}),this._formApiModel}_isItemPrimaryAttributeEqual(e,t){return(0,C.A)(function*(){if(!e)return!1;const s=yield e[e.primaryAttributeName];return t.includes(s)})()}_insertItem(e,t){typeof t!="number"&&(t=this.length),t=Math.max(t,0),t=Math.min(t,this.length),this.splice(t,0,e)}_generateItem(e){const t=()=>{const s=this._model?.createCollectionItemModel(T.Create),r=this._host?.[tr],n=this._viewModelGenerator.generate({viewModelConfig:this._viewModelConfig,modelConfig:s?{primaryDataSourceName:s.name}:void 0,models:s?[s]:void 0,parentViewModel:this._host,businessRulesActive:e.businessRulesActive??!1},r?c.Injector.create({providers:[{provide:mi,useValue:null}],parent:r}):null).pipe((0,o.tap)(a=>{s?.name&&(a.dataSchemas[s.name]=this._host.dataSchemas[s.name])}),(0,o.switchMap)(a=>s?.name?a.create(s.name,e.initialModelValues).pipe((0,o.map)(()=>a)):(0,l.of)(a)),(0,o.tap)(a=>{Object.entries(e.initialAttributeValues??{}).forEach(([u,d])=>a[u]=d),a._markAsPristine(e.initialAttributeValues??{}),this._model?.childrenChange()}));return(0,l.lastValueFrom)(n)};return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.generateItem",()=>t()):t()}_mergeItems(e,t){const s=()=>{const r=(e[0]||t[0])?.primaryAttributeName;for(const n of t){const a=e.findIndex(u=>{const d=u.attributes?.[r],h=n.attributes?.[r];return d&&d===h});a===-1?e.push(n):e.splice(a,1,n)}return e};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.mergeItems",()=>s()):s()}_triggerChangesAfter(e){this._trackChanges=!1;const t=e.call(this);return this._trackChanges=!0,this._isDestroyed||this._onItemsChanged(),t}_onItemsChanged(){const e=this.map(t=>({item:t,itemModelMode:t?.getPrimaryModelMode?.()}));this._updateCollectionState(e,!0)}_subscribeItemsModelModesChanges(){this._itemsChanged.pipe((0,o.switchMap)(()=>this._getItemsModelModesChanges()),(0,o.tap)(e=>this._updateCollectionState([e],!1)),(0,o.takeUntil)(this._destroyed$)).subscribe()}_subscribeItemsAttributesChanges(){this._itemsChanged.pipe((0,o.switchMap)(()=>this._getItemsAttributesChanges()),(0,o.filter)(e=>!e.payload.silent),(0,o.tap)(()=>this._itemAttributeChanged.next()),(0,o.takeUntil)(this._destroyed$)).subscribe()}_getItemsAttributesChanges(){const e=this.map(t=>t?.events$?.pipe((0,o.filter)(s=>s.type===me.ChangeAttributeValue))).filter(Boolean);return e.length?(0,l.merge)(...e):l.EMPTY}_getItemsModelModesChanges(){const e=[...this,...this._deletedItems].map(t=>t?._getPrimaryModelModeChanges?.()?.pipe((0,o.map)(s=>({item:t,itemModelMode:s})))).filter(Boolean);return e.length?(0,l.merge)(...e):l.EMPTY}_updateCollectionState(e,t){this._trackChanges=!1;const s=e.map(r=>this._onItemModelModeChanged(r)).some(r=>!!r);this._trackChanges=!0,!(!t&&!s)&&(this._updateFormApiModelValues(),this._updateFormApiModelPristineState(),this._changed.next(),this._itemsChanged.next())}_onItemModelModeChanged(e){const{item:t,itemModelMode:s}=e;if(!t||s==null)return!1;switch(s){case T.Create:return this._onCreateItem(t);case T.Update:return this._onUpdateItem(t);case T.Delete:return this._onDeleteItem(t);default:return!1}}_onCreateItem(e){const t=this._deletedItems.indexOf(e);return t!==-1?(this._deletedItems.splice(t,1),!0):(this._createdItems.indexOf(e)===-1&&this._createdItems.push(e),!1)}_onUpdateItem(e){const t=this._createdItems.indexOf(e);if(t!==-1)return this._createdItems.splice(t,1),!1;const s=this._deletedItems.indexOf(e);if(s!==-1){const r=this._deletedItems.splice(s,1);super.push(...r)}return!0}_onDeleteItem(e){const t=this._createdItems.indexOf(e),s=this._deletedItems.indexOf(e);return t!==-1?this._createdItems.splice(t,1):s===-1&&this._deletedItems.push(e),super.splice(this.indexOf(e),1),!0}_updateFormApiModelValues(e){if(this._featureValues.DisableBaseViewModelCollectionOptimization){this._formApiModel??=new xe.FormArray([]),this._formApiModel.clear({emitEvent:!1}),this.filter(s=>s?.formApiModel).forEach(s=>{this._formApiModel.push(s.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity();return}if(!this._formApiModel||!this._formApiModel.length){const s=new xe.FormArray(this.filter(r=>r?.formApiModel)?.map(r=>r.formApiModel));this._formApiModel||(this._formApiModel=s),this._formApiModel.length||this._host?.formApiModel?.setControl(this._hostAttributeName,s)}else this._formApiModel.clear({emitEvent:!1}),this.filter(s=>s?.formApiModel).forEach(s=>{this._formApiModel.push(s.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity()}_updateFormApiModelPristineState(){const e=this.formApiModel.pristine,t=this.some(s=>s?.formApiModel?.dirty);if(t&&e){this.formApiModel.markAsDirty();return}!t&&!e&&this.formApiModel.markAsPristine()}_reload(e){const t=()=>{for(const n of[...this._deletedItems,...this])this.removeChildModel(n,{triggerNotification:!1});this._model?.childrenChange();const s=[],r=n=>s.push(n.destroy());return this._createdItems.forEach(r),this._createdItems.splice(0,this._createdItems.length),this._deletedItems.forEach(r),this._deletedItems.splice(0,this._deletedItems.length),this.forEach(r),this.splice(0,this.length,...e),(0,l.forkJoin)(s).pipe((0,o.defaultIfEmpty)(void 0),(0,o.map)(()=>{}))};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.reload",()=>t()):t()}removeChildModel(e,t){const s=t?.triggerNotification??!0,r=this._model?.name,n=e.getModelByName(r);this._model?.removeChild(n),s&&this._model?.childrenChange()}copyWithin(e,t,s){return this._triggerChangesAfter(()=>super.copyWithin(e,t,s))}fill(e,t,s){return this._triggerChangesAfter(()=>super.fill(e,t,s))}push(...e){return this._triggerChangesAfter(()=>super.push(...e))}reverse(){return this._triggerChangesAfter(()=>super.reverse())}shift(){return this._triggerChangesAfter(()=>super.shift())}sort(e){return this._triggerChangesAfter(()=>super.sort(e))}splice(e,t,...s){return this._triggerChangesAfter(()=>super.splice(e,t,...s))}unshift(...e){return this._triggerChangesAfter(()=>super.unshift(...e))}getChangedItems(){const e=[...this._deletedItems];return this.filter(s=>{if(s.attributes.IsChanged)return!0;const r=s.getPrimaryModelMode();return r&&r!==T.Update}).concat(e)}createItem(e){var t=this;const s=function(){var r=(0,C.A)(function*(){const n=yield t._generateItem(e||{});return t._insertItem(n,e?.index),n});return function(){return r.apply(this,arguments)}}();return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.createItem",()=>s()):s()}getPrimaryAttributeValues(){return Promise.all(this.map(e=>e?.[e?.primaryAttributeName]))}findByPrimaryAttribute(e){var t=this;return(0,C.A)(function*(){for(const s of t)if(yield t._isItemPrimaryAttributeEqual(s,[e]))return s})()}filterByPrimaryAttributes(e){var t=this;return(0,C.A)(function*(){const s=[];for(const r of t)(yield t._isItemPrimaryAttributeEqual(r,e))&&s.push(r);return s})()}merge(e){const t=()=>{this._triggerChangesAfter(()=>{const s=this._mergeItems([...this],e);super.splice(0,this.length,...s),this._createdItems.splice(0,this._createdItems.length),e instanceof ot&&this._mergeItems(this._deletedItems,e._deletedItems)})};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.merge",()=>t()):t()}reload(e){return(0,l.lastValueFrom)(this._reload(e))}remove(e){const[t,s]=typeof e=="number"?[e,this[e]]:[this.indexOf(e),e];if(t>=0&&t<this.length)return this.splice(t,1),(0,l.lastValueFrom)(s.destroy())}clear(){return this.reload([])}moveTo(e,t){if(t>=this.length)throw new Nn("Target index cannot be greater than collection length");const s=this.indexOf(e);s===t||t<0||this._triggerChangesAfter(()=>{super.splice(t,0,super.splice(s,1)[0])})}destroy(){this._isDestroyed=!0,this._host=null;const e=this._reload([]);return this._formApiModel.clear({emitEvent:!1}),this._itemAttributeChanged.complete(),this._itemsChanged.complete(),this._destroyed$.next(),this._destroyed$.complete(),(0,l.lastValueFrom)(e)}}var vi;(function(i){i.Readonly="READONLY_PROPERTY",i.Disabled="DISABLED_PROPERTY"})(vi||(vi={}));const Kp="DataValueType";class Ei extends Cl{get propertiesConfig(){return[{name:"visible",defaultValue:!0},{name:"displayColor"},{name:"required",typeName:"crt.Required",defaultValue:!1}]}get formControl(){return this._formControl||(this._formControl=new xe.FormControl(this.value),this._subscribeOnFormControl(this._formControl)),this._formControl}set formControl(e){this._formControl=e,this._subscribeOnFormControl(this._formControl)}get properties(){return this._properties}get onPropertyChanged(){return this._onPropertyChanged}get visible(){return this.getPropertyByName("visible").getValue()}set visible(e){const t=this.getPropertyByName("visible");t.value=e}get required(){return this.getPropertyByName("required").getValue()}set required(e){const t=this.getPropertyByName("required");t.value=e}get displayColor(){return this.getPropertyByName("displayColor").getValue()}set displayColor(e){const t=this.getPropertyByName("displayColor");t.value=e}get isDirty(){return this.formControl.dirty}constructor(e=null,t,s=null,r=!1,n="",a=[],u,d,h,g){super(n,e),this._featureValues=t,this.validationState=s,this.disabled=r,this._subscription=new l.Subscription,this._appliedValidatorsCache=new Map,this._onPropertyChanged=new c.EventEmitter,this._crtControlStateAdapter=u,this._validatorTypeResolver=d,this._injectionContext=g,this._initProperties(a),this._subscribeOnPropertiesEvents(),this._initializeValidators(h??[],!0)}_subscribeOnFormControl(e){this._formControlSubscription?.unsubscribe(),this._formControlSubscription=e.valueChanges.pipe((0,o.startWith)(e.value),(0,o.distinctUntilChanged)((t,s)=>this.areValuesEqual(t,s))).subscribe(t=>{this.setValue(t)})}_initProperties(e){const t=[...this.propertiesConfig,...e];this._properties=new Map,t.forEach(s=>{const r=Al.create({typeName:s.typeName,name:s.name,value:s.defaultValue,locked:s.locked===!0,validatorTypeResolver:this._validatorTypeResolver,injectionContext:this._injectionContext});this._properties.set(s.name,r)})}_subscribeOnPropertyEvents(e){this._subscription.add(e.onChanged.subscribe(({name:t,value:s,oldValue:r})=>{this.onPropertyChanged.emit({name:t,value:s,oldValue:r})})),this._subscription.add(e.onValidatorChanged.subscribe(()=>{this._refreshValidators()}))}_subscribeOnPropertiesEvents(){this.properties.forEach(e=>{this._subscribeOnPropertyEvents(e)})}_initializeValidators(e,t=!1){this._validatorInfo=e,this._properties.forEach(s=>{this._validatorInfo=s.initializeValidator(this._validatorInfo,t)}),this._refreshValidators()}_useValidatorsMerging(){return!this._featureValues.DisableControlValidatorsMerging}_getEnabledValidatorFns(e=!1){return this._validatorInfo.filter(t=>!t.disabled&&t.instance.isAsync===e).map(t=>{if(this._useValidatorsMerging()){const r=this._appliedValidatorsCache.get(t.name);if(r)return r.validatorFn}const s=this._crtControlStateAdapter.transform(t);return this._useValidatorsMerging()&&this._appliedValidatorsCache.set(t.name,{validatorInfo:t,validatorFn:s}),s})??[]}_mergeValidators(e,t){for(const s of this._appliedValidatorsCache.values())if(s.validatorInfo.instance.isAsync){const n=s.validatorFn;t.includes(n)?this.formControl.hasAsyncValidator(n)||this.formControl.addAsyncValidators(n):this.formControl.removeAsyncValidators(n)}else{const n=s.validatorFn;e.includes(n)?this.formControl.hasValidator(n)||this.formControl.addValidators(n):this.formControl.removeValidators(n)}}_refreshValidators(){const e=this._getEnabledValidatorFns(),t=this._getEnabledValidatorFns(!0);this._useValidatorsMerging()?this._mergeValidators(e,t):(this.formControl.setValidators(e),this.formControl.setAsyncValidators(t)),this.formControl.updateValueAndValidity()}_updateValidator(e,t=!1){const s=this._validatorInfo.find(r=>r.name===e);if(!s)throw new Error(`Validator ${e} does not exist on ${this.name} attribute.`);s.disabled!==t&&(s.disabled=t,this._refreshValidators())}findPropertyByName(e){return this.properties.has(e)?this.properties.get(e):null}static create(e){return new Ei(e.value,e.featureValues,null,!1,e.name,e.propertiesConfig??[],e.crtControlStateAdapter,e.validatorTypeResolver,e.validatorsInfo,e.injectionContext)}setValue(e,t){const s=this.formControl;this.areValuesEqual(e,s.value)||(s.dirty||s.markAsDirty(),s.setValue(e,{onlySelf:!!t})),super.setValue(e,t)}enableValidator(e){this._updateValidator(e,!1)}disableValidator(e){this._updateValidator(e,!0)}change(e){this.setValue(e)}getPropertyByName(e,t=!1){let s=this.findPropertyByName(e);return!s&&t&&(s=new Eo(e,null,this._validatorTypeResolver,this._injectionContext),this._properties.set(e,s),this._subscribeOnPropertyEvents(s)),s}hasPropertyValue(e){return!!this.getPropertyByName(e)}getPropertyValue(e){const t=this.getPropertyByName(e);return t?t.getValue():null}setPropertyValue(e,t,s=!1){this.getPropertyByName(e,!0).setValue(t,s)}setPropertyInitialValue(e,t){this.getPropertyByName(e,!0).setInitialValue(t)}getPropertyInitialValue(e){return this.getPropertyByName(e)?.initialValue}getValue(){return this._formControl?this._formControl.value:super.getValue()}destroy(){this._formControlSubscription?.unsubscribe(),this._subscription.unsubscribe()}getInvariabilityPropertyName(){const e=this.getPropertyValue(vi.Readonly),t=this.getPropertyValue(vi.Disabled);return e??t}toggle(e){const t=this.getInvariabilityPropertyName(),s=this.getPropertyByName(t);s&&(e?s.resetPending():s.setPending(!0))}}function km(i){const e=i;return e?!!e?.modelConfig||!!e?.embeddedModel||!!e?.value:!1}function Vl(i){const e=i;return e?!!e.from||!!e.triggers||!!e.converter:!1}const zp=y(85088);class hn{sort(e,t){const s=[];let r=[];Object.entries(e||{}).forEach(([a,u])=>{if(Vl(u)){let d=u.from;d=Array.isArray(d)?d:[d];const h=d.map(g=>[a,g]);r=r.concat(h)}else s.push(a)});const n=zp(r).reverse();return[...s,...n].filter(Boolean).filter((a,u,d)=>d.indexOf(a)===u).map(a=>{const u=n.includes(a)?e[a]??t[a]:e[a];return[a,u]})}static#e=this.\u0275fac=function(t){return new(t||hn)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:hn,factory:hn.\u0275fac,providedIn:"root"})}class pn{constructor(e,t,s,r,n,a,u){this._crtControlStateAdapter=e,this._validatorTypeResolver=t,this._viewModelGenerator=s,this._attributeCreator=r,this._viewModelRepository=n,this._attributesTopologicalSorting=a,this._injector=u,this._featureValues=this._injector.get(E,null,{optional:!0}),this._measurePerformanceService=this._injector.get(ge)}_generateAttributes(e,t,s){const r=this._attributesTopologicalSorting.sort(t,e._attributeConfigs);return Promise.all(r.map(([n,a])=>e._systemAttributes.includes(n)?(console.warn(`Overriding of system attributes is denied. Attribute name:"${n}"`),Promise.resolve()):(s.disableDefaultConfig||(a??={}),e._attributeConfigs[n]=a,a?"viewModelConfig"in a||"viewModelName"in a?a.isCollection?this._generateNestedModelCollectionAttribute(e,n,a,s):this._generateNestedModelAttribute(e,n,a,s):Vl(a)?this._generateCalculatedAttribute(e,n,a,s):this._generateModelAttribute(e,n,a,s):this._removeViewModelAttribute(e,n))))}_generateNestedModelCollectionAttribute(e,t,s,r){var n=this;return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedCollectionAttribute.${t}`,(0,C.A)(function*(){const a=e.getBoundDataSourceNameByAttributePath(t),u=e.getModelByName(a),d="viewModelConfig"in s?s.viewModelConfig:yield(0,l.lastValueFrom)(n._viewModelRepository.resolveModelConfig(s.viewModelName)),h=new ot(n._viewModelGenerator,d,u,e,t);n._registerOrSetFormControl(e.formApiModel,t,h.formApiModel);const g=e.attributes[t];e.attributes[t]=h,n._defineNestedModelAttribute(e,t,s,r),n._subscribeOnCollectionChanged(e,t,h,r),g!==void 0&&r.onChangeAttributeValue(t,h,g)}))}_defineNestedModelAttribute(e,t,s,r){const n=u=>{const d=e.attributes[t];e.attributes[t]=u,d instanceof ot&&u instanceof ot&&this._subscribeOnCollectionChanged(e,t,u,r),r.onChangeAttributeValue(t,u,d)},a=()=>e.attributes[t];Hs.defineAsyncAttribute(e,t,s,a,n)}_generateNestedModelAttribute(e,t,s,r){return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedModelAttribute.${t}`,()=>{const n="viewModelConfig"in s?s.viewModelConfig:s.viewModelName,a=e?.[tr];return(0,l.lastValueFrom)(this._viewModelGenerator.generate({viewModelConfig:n,parentViewModel:e},a?c.Injector.create({providers:[{provide:mi,useValue:null}],parent:a}):null).pipe((0,l.map)(u=>{this._registerOrSetFormControl(e.formApiModel,t,u.formApiModel);const d=e.attributes[t];e.attributes[t]=u,this._defineNestedModelAttribute(e,t,s,r),d!==void 0&&r.onChangeAttributeValue(t,u,d)})))})}_subscribeOnCollectionChanged(e,t,s,r){if(e._collectionSubscription.has(t)){const a=e._collectionSubscription.get(t);a.unsubscribe(),e._subscriptions.remove(a)}const n=new l.Subscription;n.add(s.changed.subscribe(()=>{r.onChangeAttributeValue(t,s,null)})),n.add(s.itemAttributeChanged.subscribe(()=>{r.onChangeAttributeValue(t,s,null)})),e._collectionSubscription.set(t,n),e._subscriptions.add(n)}_generateCalculatedAttribute(e,t,s,r){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateCalculatedAttribute.${t}`,()=>{this._attributeCreator.create(ll)?.defineAttribute({viewModel:e,attribute:t,attributeConfig:s,generateOptions:r})})}_getCrtControlPropertiesConfig(e,t,s){const r=Object.entries(s.properties??[]).map(([n,a])=>({name:n,defaultValue:a.defaultValue,locked:a.locked===!0}));return this._addDataValueTypePropertyConfig(r,s),this._addMaskedPropertyConfig(e,t,r,s),this._disableSystemAttributes(e,t,r),r}_addDataValueTypePropertyConfig(e,t){t.dataValueTypeName&&e.push({name:Kp,defaultValue:v.r[t.dataValueTypeName]})}_addMaskedPropertyConfig(e,t,s,r){this._isNotAllowMaskedPropertyConfig(e,t,r)||(r.isValueMasked=!0,this._getOrCreatePropertyConfig(s,rn),this._getOrCreatePropertyConfig(s,_i),this._getOrCreatePropertyConfig(s,yi))}_isNotAllowMaskedPropertyConfig(e,t,s){const n=e.getBoundDataSchemaAttributeByAttributePath(t)?.isValueMasked,a=s.isValueMasked;return n&&a===!1||!n&&!a}_disableSystemAttributes(e,t,s){if(this._featureValues?.DisableBlockingSystemColumns===!0)return;if(e.getBoundDataSchemaAttributeByAttributePath(t)?.isSystem){const n=this._getOrCreatePropertyConfig(s,"readonly");n.locked=!0,n.defaultValue=!0}}_getOrCreatePropertyConfig(e,t){let s=this._findPropertyConfigByName(e,t);return s||(s={name:t},e.push(s)),s}_findPropertyConfigByName(e,t){return e.find(s=>s.name===t)}_generateModelAttribute(e,t,s,r){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateModelAttribute.${t}`,()=>{const n=e.attributes[t],a=s?.value,u=this._getCrtControlPropertiesConfig(e,t,s),d=Ei.create({name:t,value:a,crtControlStateAdapter:this._crtControlStateAdapter,validatorTypeResolver:this._validatorTypeResolver,validatorsInfo:e._validators[t],propertiesConfig:u,injectionContext:e._injectionContext??pi(e)?._injectionContext,featureValues:this._featureValues});e._subscriptions.add(d.onChanged.subscribe(b=>{e.attributes[t]=b.value,r.onChangeAttributeValue(b.name,b.value,b.oldValue)})),e._subscriptions.add(d.onPropertyChanged.subscribe(({name:b,value:M,oldValue:Z})=>{r.onChangeAttributeValue(`${t}:${b}`,M,Z)})),e._crtControls.set(t,d),this._registerOrSetFormControl(e.formApiModel,t,d.formControl),e.attributes[t]=a??null;const h=e._getDataSourceAttributeDataValueType(t);this._attributeCreator.create(h).defineAttribute({viewModel:e,attribute:t,attributeConfig:s,control:d}),n!==void 0&&r.onChangeAttributeValue(t,a,n)})}_registerOrSetFormControl(e,t,s){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.registerOrSetFormControl.${t}`,()=>{if(this._featureValues?.DisableAttributeOnlyRegisteringControl){e.setControl(t,s);return}e.contains(t)?e.setControl(t,s):e.registerControl(t,s)})}_removeViewModelAttribute(e,t){return delete e._attributeConfigs[t],delete e.attributes[t],delete e[t],Promise.resolve()}generate(e,t,s){var r=this;return this._measurePerformanceService.measureCallback("BaseViewModelAttributeGenerator.generateAttributes",()=>Hs.deferUpdatingValueAndValidity(e,(0,C.A)(function*(){yield r._generateAttributes(e,t,s),!r._featureValues?.DisableAttributeOnlyRegisteringControl&&e.formApiModel.updateValueAndValidity()}),this._featureValues))}static#e=this.\u0275fac=function(t){return new(t||pn)(c.\u0275\u0275inject(Gt),c.\u0275\u0275inject(fi),c.\u0275\u0275inject(Zt),c.\u0275\u0275inject(gl),c.\u0275\u0275inject(Wt),c.\u0275\u0275inject(hn),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:pn,factory:pn.\u0275fac,providedIn:"root"})}class mn{_defineResourceAttribute(e,t,s,r,n){return new l.Observable(a=>{const u=e._getDataSourceAttributeCaption(r,n);if(this._defineResourceProperty(t,s,u),r.includes(".")){const d=r.split(".")[1];this._defineResourceProperty(t,d,u)}a.next(),a.complete()})}_defineResourceProperty(e,t,s){e[t]||Object.defineProperty(e,t,{get:()=>Promise.resolve(s??""),configurable:!0})}_getResourceNameByPath(e){const t=e.split(".");return t.length>1?t.join("_"):e}generate(e,t){return Object.entries(t||{}).map(([s,r])=>{const n=e[en][Ds.string],a=this._getResourceNameByPath(s);return this._defineResourceAttribute(e,n,a,s,r)})}static#e=this.\u0275fac=function(t){return new(t||mn)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:mn,factory:mn.\u0275fac,providedIn:"root"})}const Mi="HasUnsavedData",fn="IsChanged",fc="PrimaryModelMode",gc="BusinessRulesActivated",Ii="State";var _c;(function(i){i.Paused="Paused",i.Active="Active"})(_c||(_c={}));class gn{constructor(e,t,s){this._sysSettingsService=e,this._dataSchemaRepository=t,this._featureValues=s,this._searchComparisonTypeSysSettingCode="StringColumnSearchComparisonType"}_getParameterValue(e,t,s){if(typeof t=="string"){if(t.startsWith("@requestPayload")){const r=t.replace("@requestPayload.","");return(0,D.get)(s,r)}if(t.startsWith("$"))return e.attributes[t.substring(1)];if(e.attributes[t])return e.attributes[t]}return t}_applyFilterMacros(e,t){let s=null;switch(typeof t){case"object":s=JSON.stringify((0,ue.classToPlain)(t));break;case"string":s=t;break;default:return t}const r=/##ViewModelMacro\.\$([^#]+)##/g;let n=!1;return[...s.matchAll(r)].forEach(a=>{const u=a[1],d=(0,D.get)(e.attributes,u);let h=d?.toString();typeof d=="object"&&(n=!0,h=JSON.stringify(d)),s=s.replace(a[0],h)}),typeof t=="object"||n?JSON.parse(s):s}_createPrimaryDisplayColumnValueFilter(e){var t=this;return(0,C.A)(function*(){const s=t._searchComparisonTypeSysSettingCode,n=(yield t._sysSettingsService.getByCode(s))?.value===1?ne.Contain:ne.Start_with;return{type:F.PrimaryDisplayValueFilter,value:e,comparisonType:n}})()}_createColumnValueFilter(e,t,s){const r=t;return Promise.resolve({type:F.ColumnValue,value:{attributePath:r.attributePath,attributeValue:this._getParameterValue(e,r.attributeValue,s)}})}_getOwnLoadParameters(e,t){return e.getModelByName(t)?.getOwnLoadParameters()}_getDataSourceFilteringParameters(e,t){const r=e._dataSourcesInfos.get(t).getFilteringConfig();return e._checkFilteringAttributes(t,r),r.length===0?Promise.resolve([]):Promise.all(r.map(n=>e[n.name])).then(n=>n.map(a=>({type:F.Filter,value:a})))}_getDataSourceOwnFilteringParameters(e,t){return this._getOwnLoadParameters(e,t)?.parameters??[]}_getPrimaryAttributeName(e,t){var s=this;return(0,C.A)(function*(){if(!t)return null;let r=Object.values(e.dataSchemas).find(n=>n.name===t);return r||(r=yield(0,l.lastValueFrom)(s._dataSchemaRepository.get(t))),r?.primaryAttributeName})()}_getParameterRelationsConfigs(e){return e.relationsConfigs||[]}_createRelationParameter(e,t){const s={...e},r=this._getParameterRelationsConfigs(s);return s.relationsConfigs=[{dataSchemaName:t.dataSchemaName,attributePath:t.attributePath,relationPath:t.relationPath},...r],s}_validateAllowedRelations(e,t,s){const n=s?.relationPath?.split(".")?.shift(),a=e.dataSchemas[t],u=a?.findAttributeByName(n);if(a&&u&&a.primaryAttributeName!==n&&u.dataValueType!==v.r.Lookup&&!this._featureValues.DataSourceAllowRelationsByNonLookupColumn){const d="Filtration of data sources by page data is currently supported by lookup and primaryAttribute fields only",h=new Error(`${d}, please see the console for more details`);throw h.stack=`${d} , data source name: ${t}, relation config: ${JSON.stringify(s)}`,h}}_createRelationParameterWithAttributeValue(e,t,s,r){var n=this;return(0,C.A)(function*(){const a={...s},u=n._getParameterRelationsConfigs(a),d=e.dataSchemas[t],h=r.relationPath.split("."),g=h.shift(),b=d.findAttributeByName(g);if(b.dataValueType!==v.r.Lookup&&(n._featureValues.DataSourceAllowRelationsByNonLookupColumn||d.primaryAttributeName===g))return a.type=F.ColumnValue,a.value={attributePath:r.attributePath,attributeValue:r.value},a.relationsConfigs=u,a;const M={dataSchemaName:r.dataSchemaName,attributePath:r.attributePath,relationPath:r.relationPath};a.value=r.value,a.type=F.PrimaryColumnValue,d.primaryAttributeName!==g&&(M.dataSchemaName=b.referenceSchemaName);const Z=d.type!==hs.Entity?M.dataSchemaName:r.dataSchemaName;return M.relationPath=h.length===0?yield n._getPrimaryAttributeName(e,Z):h.join("."),a.relationsConfigs=[M,...u],a})()}_convertToRelationParameters(e,t,s,r){var n=this;return(0,C.A)(function*(){const a=[];n._validateAllowedRelations(e,t,r);for(const u of s){const d=r.useAttributeValue?yield n._createRelationParameterWithAttributeValue(e,t,u,r):n._createRelationParameter(u,r);a.push(d)}return a})()}_getRelationParameters(e,t,s){var r=this;return(0,C.A)(function*(){const n=e._modelDependencies[t]||[];if(n.length===0)return Promise.resolve([]);const a=n.map(h=>r.getLoadParametersByRelation(e,h,t,s)),u=(yield Promise.all(a)).flat();if(r._featureValues.DisableDsDepsJoinOptimization)return u;const d=u.filter(h=>h.type!==F.Empty);return d.length===0?u:d.filter(h=>h.type===F.Filter?!!h.value:!0)})()}_getPagingConfigRowCount(e,t,s,r){return typeof t=="string"&&(t=(0,D.isNil)(e.attributes[t])?0:e.attributes[t]),r&&(!t||t+s>r)&&(t=r-s),t}_getPagingConfigRowsOffset(e,t,s,r){const n=e._dataSourcesInfos.get(r).collectionViewModelAttributeName,a=e.attributes[n]?.length??0;if(typeof t=="number")throw new Error("Rows offset parameter cannot be set to number");return!t&&s===le.LoadNext?a:!t&&s===le.Reload?0:(e.attributes[t]=(0,D.isNil)(e.attributes[t])?0:e.attributes[t],s===le.Reload?e.attributes[t]:e.attributes[t]+a)}_getModelPagingConfig(e,t,s,r){if(!t){const u=this._getOwnLoadParameters(e,r);return Promise.resolve(u?.options?.pagingConfig??null)}const n=this._getPagingConfigRowsOffset(e,t.rowsOffset,s,r),a=this._getPagingConfigRowCount(e,t.rowCount,n,t.rowsLimit);return Promise.resolve({rowCount:a,rowsOffset:n})}_mergeSorting(e,t){return(0,D.unionBy)(e??[],t??[],"columnName")??null}_getModelSortingConfig(e,t,s){const n=this._getOwnLoadParameters(e,s)?.options?.sortingConfig,a=t?.attributeName;return!a||!e.attributes[a]?n?Promise.resolve(n):Promise.resolve(null):Promise.all(e.attributes[a].map(function(){var u=(0,C.A)(function*(d){return{columnName:yield d.columnName,direction:yield d.direction}});return function(d){return u.apply(this,arguments)}}())).then(u=>({columns:this._mergeSorting(u,n?.columns)}))}_updateLastEventLoadParameters(e,t,s,r){s&&s.length!==0?e._lastEventLoadParameters.set(t,s):r!==!0&&e._lastEventLoadParameters.set(t,[{type:F.Empty,value:""}])}_getModelLoadParameters(e,t,s,r,n,a,u){const d=this.getModelParameters(e,s,r).then(h=>(a!==!0&&this._updateLastEventLoadParameters(e,t,h,n),n!==!0?h:e._lastEventLoadParameters.get(t)||[{type:F.Never,value:""}]));return Promise.all([d,this._getDataSourceFilteringParameters(e,t),this._getDataSourceOwnFilteringParameters(e,t),this._getRelationParameters(e,t,u)]).then(([h,g,b,M])=>[...h,...b,...g,...M])}getLoadParametersByRelation(e,t,s,r){const n=t.relationPath.split("."),a=n.shift(),u=e.dataSchemas[a],d={dataSchemaName:u.name,attributePath:t.attributePath,relationPath:n.join(".")},h=n.shift(),b=e._dataSourcesInfos.get(a).getMappedAttributeNames(h)?.[0]??null,M=e.getModelMode(a),Z=r?.[a]?.[d.relationPath];if(e.getModelByName(s)?.getAllowCopyingRecords()&&Z)d.value=Z,d.useAttributeValue=!0;else{const j=e.getIsDirty(b)||M===T.Create||M===T.Copy||u.type!==hs.Entity;if(b&&j){d.useAttributeValue=!0;const Xt=e.attributes[b];d.value=Xt?.value?Xt.value:Xt}}return this._getModelLoadParameters(e,a,null,null,!0,!1).then(j=>this._convertToRelationParameters(e,a,j,d))}getModelParameters(e,t,s){if(s?.parameters&&(t=[...t,...s.parameters]),!t||t.length===0)return Promise.resolve([]);const r=t.map(n=>{switch(n.type){case F.PrimaryColumnValue:return Promise.resolve({type:n.type,value:this._getParameterValue(e,n.value,s)});case F.Filter:return Promise.resolve({type:n.type,value:this._applyFilterMacros(e,n.value)});case F.PrimaryDisplayValueFilter:return this._createPrimaryDisplayColumnValueFilter(this._getParameterValue(e,n.value,s));case F.ColumnValue:return this._createColumnValueFilter(e,n.value,s)}});return Promise.all(r)}getModelLoadParameters(e,t,s,r=le.Load,{payload:n,useLastLoadParameters:a,doNotUpdateLastLoadParameters:u,modelLoadConfiguration:d}={}){const h=t.name,g=r??le.Load,b=g===le.Load?null:t.getPagingConfig(),M=t.getSortingConfig();return Promise.all([this._getModelLoadParameters(e,h,s,n,a,u,d),this._getModelPagingConfig(e,b,g,h),this._getModelSortingConfig(e,M,h)])}static#e=this.\u0275fac=function(t){return new(t||gn)(c.\u0275\u0275inject(ve),c.\u0275\u0275inject(st),c.\u0275\u0275inject(E))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:gn,factory:gn.\u0275fac,providedIn:"root"})}class ct{get attributesMap(){return this._attributesMap}get mappedViewModelAttributes(){return this._mappedViewModelAttributes}get isCollection(){return this._isCollection}get collectionViewModelAttributeName(){return this._collectionViewModelAttributeName}constructor(e){this._attributesMap=new Map,this._mappedViewModelAttributes=new Set,this.attributes=[],this.includePrimaryAttributes=!0,this.name=e}static _getDataSourceInfo(e,t){if(!e.has(t)){const s=new ct(t);return e.set(t,s),s}return e.get(t)}static _extractViewModelAttributeMapInfo(e){const t=e.split(".");return{dataSourceName:t.shift(),dataSourceAttributePath:t.join(".")}}static _getByDefaultAttribute(e,t,s,r=""){const n=t.modelConfig;if(!n||!n.path)return;const a=this._extractViewModelAttributeMapInfo(n.path);if(!a.dataSourceAttributePath){this._getByViewModelCollectionAttribute(e,t,s);return}if(r&&r!==a.dataSourceName)throw new Error(`Attribute '${e}' mapped on a few DataSources`);const u=this._getDataSourceInfo(s,a.dataSourceName),d=n.aggregationConfig?.aggregationFunction?rl(a.dataSourceAttributePath):a.dataSourceAttributePath;u.attributes.push({path:d,type:n.type,functionConfig:n.functionConfig,aggregationConfig:n.aggregationConfig}),u._mappedViewModelAttributes.add(e),u._attributesMap.set(e,a.dataSourceAttributePath)}static _getByInlineViewModelAttribute(e,t,s,r=""){const n=t.viewModelConfig||{};Object.entries(n.attributes||{}).forEach(([a,u])=>{const d=`${e}.${a}`;this._processViewModelAttribute(d,u,s,r)})}static _getByViewModelCollectionAttribute(e,t,s){const r=t.modelConfig;if(!r||!r.path)return;const a=this._extractViewModelAttributeMapInfo(r.path).dataSourceName,u=this._getDataSourceInfo(s,a);u._isCollection=!0,u._collectionViewModelAttributeName=e,u._pagingConfig=r.pagingConfig,u._sortingConfig=r.sortingConfig,u._filteringConfig=r.filterAttributes,u.includePrimaryAttributes=r.includePrimaryAttributes===void 0?!0:r.includePrimaryAttributes;const d=t?.viewModelConfig;Object.entries(d?.attributes||{}).forEach(([h,g])=>{this._processViewModelAttribute(`${e}.${h}`,g,s,a)})}static _processViewModelAttribute(e,t,s,r=""){"viewModelConfig"in t||"viewModelName"in t?t.isCollection?this._getByViewModelCollectionAttribute(e,t,s):this._getByInlineViewModelAttribute(e,t,s,r):"from"in t||this._getByDefaultAttribute(e,t,s,r)}static getFromViewModelConfig(e,t=[]){const s=new Map;return Object.entries(e?.attributes||{}).forEach(([r,n])=>{this._processViewModelAttribute(r,n,s)}),t.filter(r=>!s.has(r.name)).forEach(({name:r})=>{const n=new ct(r);s.set(r,n)}),s}static getLookupListDataSourceInfo(e,t){const s=new ct("");return s._isCollection=!0,s._collectionViewModelAttributeName=e,Object.entries(t).forEach(([r,n])=>{s.attributes.push({path:n}),s._mappedViewModelAttributes.add(r),s._attributesMap.set(r,n)}),s}_getRowModelDto(e){const t=e.length>0?e[0]:{},s={};return Object.entries(t).forEach(([r,n])=>{this.getMappedAttributeNames(r).forEach(u=>{const d=u.split(".");this.isCollection&&d.length>1&&d.shift(),(0,D.set)(s,d.join("."),n)})}),s}_getCollectionModelDto(e){const t=this._collectionViewModelAttributeName,s=e.map(r=>this._getRowModelDto([r]));return{[t]:s}}getMappedAttributes(){return Array.from(this._mappedViewModelAttributes.values())}getMappedAttributeNames(e){return Array.from(this._attributesMap.entries()).filter(([,t])=>t===e).map(([t])=>t)}getDataSourceAttributePath(e){return this._attributesMap.has(e)?this._attributesMap.get(e):""}getIsMapOnCollection(e){return this._isCollection&&this._collectionViewModelAttributeName===e}getPagingConfig(){return this._pagingConfig}getSortingConfig(){return this._sortingConfig}getFilteringConfig(){return this._filteringConfig||[]}getModelDto(e){return this._isCollection?this._getCollectionModelDto(e):this._getRowModelDto(e)}addNewAttribute(e,t,s){const r=new Map;r.set(this.name,this),ct._getByDefaultAttribute(e,t,r,s)}getIsDataSourceAttributePathExists(e){return this.attributes.find(t=>t.path===e)!==void 0}}class Gp{}function Wp(i,e){return yc.apply(this,arguments)}function yc(){return yc=(0,C.A)(function*(i,e){const t=typeof e=="string"?e.split("."):e;let s=t.shift(),r=i;for(;s;)r=yield r[s],s=t.shift();return r}),yc.apply(this,arguments)}const Zp=500;class wt{static#e=this._skippedProperties=["schedule","then"];constructor(e,t,s,r,n,a,u,d){this.viewModelGenerator=e,this.injector=t,this.viewModelConfig=s,this.resources=r,this._eventScopes=a,this._modelsInitConfig=u,this._defaultPrimaryAttributeName="Id",this._models$=new l.BehaviorSubject([]),this._businessRulesActive=!0,this._dropdownPageSizeSettingsCode="DropdownPageSize",this._dataSourcesInfos=new Map,this._attributesToDataSourceNameMap=new Map,this._dropdownPageSize=null,this._replayEvents$=new l.ReplaySubject,this._loadedDataSources=new Set,this._conflictedModels=[],this.__destroyed=!1,this._disableViewModelWaitingForAsyncTasks=!1,this._disableViewModelLoadUnblockingThread=!1,this._blockFieldsAffectedByBusinessRules=!1,this._asyncTasksExecutingSubject=new l.BehaviorSubject(new Set),this._modelsRequestedToLoad=new Set,this._attributesAffectedByBusinessRules=[],this._businessRulesAreActivated=!1,this._destroySubject=new l.Subject,this._modelSourceRecordId={},this._modelLoadParametersSetted$=new l.Subject,this._modelsNamesWithParameters=new Set,this.saveModelTaskName="MODEL_SAVING",this._modelLoaded$=new l.Subject,this._viewModelAttributeChangeEventOptions=new Lp({preventAttributeChangeRequest:!1,preventStateChange:!0,preventRunBusinessRules:!0}),this._dynamicModelNames=new Set,this._attributeConfigs={},this._eventsSubject$=new l.Subject,this._collectionSubscription=new Map,this._crtControls=new Map,this._subscriptions=new l.Subscription,this._destroy$=this._destroySubject.asObservable(),this._businessRulesActivated$=new l.BehaviorSubject(!1),this.attributes={},this.dataSchemas={},this.events$=(0,l.merge)(this._eventsSubject$,this._replayEvents$),this._systemAttributes=[],this.initDependencies(),this._subscribeModelsChanges(),this.handlerChain=ce.instance,n?this.formApiModel=n:this.formApiModel=this.formBuilder.group({}),this.parent=d;const h=this._appInfo?.isDebugEnabled?this._createProxy(this):this;return this._viewModelDataDelayerService&&!this.parent&&this._viewModelDataDelayerService.setViewModel(h),h}get models(){return this._models$.value}get IsChanged(){return Promise.resolve(this.attributes[fn])}set IsChanged(e){}get HasUnsavedData(){return Promise.resolve(this.attributes[Mi])}set HasUnsavedData(e){}set BusinessRulesActivated(e){}get BusinessRulesActivated(){return Promise.resolve(this._businessRulesAreActivated)}get _isChanged(){return console.warn("Warning: The `_isChanged` property of the view-model is deprecated. It will be removed in future versions. Use `IsChanged` or `HasUnsavedData` attribute instead."),Object.keys(this._attributeConfigs).filter(e=>!(0,D.isEmpty)(this._attributeConfigs[e].modelConfig)).some(e=>this.formApiModel.controls[e]?.dirty)}get _scopes(){return[...this._eventScopes??[]]}get _injectionContext(){return this._context}get[tr](){return this.injector}get primaryAttributeName(){if(!this._primaryModelName)return this._defaultPrimaryAttributeName in this._attributeConfigs?this._defaultPrimaryAttributeName:null;const t=this.dataSchemas[this._primaryModelName].primaryAttributeName,s=this._dataSourcesInfos.get(this._primaryModelName);return this._getMappedAttributeName(s,t)}get PrimaryModelMode(){return this.getPrimaryModelMode()}get State(){return pi(this).attributes[Ii]}get _destroyed(){return this.__destroyed}get modelInitConfigs(){return this._modelsInitConfig}_createProxy(e){return new Proxy(e,{get(t,s){return!(typeof s=="string")||s in t||wt._skippedProperties.includes(s)||console.debug(`Attribute ${s} not found.`),t[s]}})}_executeWithOptions(e,t){let s;try{return s=this._viewModelAttributeChangeEventOptions.getOptions(),this._viewModelAttributeChangeEventOptions.setOptions(t),e()}finally{this._viewModelAttributeChangeEventOptions.setOptions(s)}}_setSystemAttributeValue(e,t){const s=this.attributes[e];this.attributes[e]=t,this._executeWithOptions(()=>{this._fireChangeAttributeEvent({type:me.ChangeAttributeValue,payload:{attributeName:e,oldValue:s,value:t}})},{preventStateChange:!0,preventRunBusinessRules:!0})}_fireChangeAttributeEvent(e){e.payload.silent??=this._viewModelAttributeChangeEventOptions.getAsSilent(),Object.assign(e.payload,this._viewModelAttributeChangeEventOptions.getOptions()),this._eventsSubject$.next(e)}_getViewModelValidators(e){const t=this.viewModelConfig.attributes[e]??{};return("validators"in t&&t.validators)??{}}_initDataSourceValidators(){return this._measurePerformanceService?.measure(`ViewModel.initDataSourceValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._validators={},this._dataSourcesInfos.forEach(e=>{e.attributesMap.forEach((t,s)=>{const r=this.viewModelConfig.attributes[s]??{};if("modelConfig"in r&&r.modelConfig?.ignoreValidators)return;this._validators[s]=this._validators[s]||[];const n=this._getDataSourceAttributeSchema(e,t);if(n?.validators){for(const[a,u]of Object.entries(n.validators))if(u?.type){const d=this._injectionContext??pi(this)?._injectionContext,h=this.validatorTypeResolver.getValidator(u.type,{validationParameters:u?.params,injectionContext:d}),g=this._getViewModelValidators(s),b=Object.values(g).find(M=>M.type===u.type);this._validators[s].push({name:a,instance:h,disabled:!!b?.disabled,params:u?.params})}}})}),(0,l.of)(null)))}_initSchemaValidators(e){this._measurePerformanceService.measure(`ViewModel.initSchemaValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{Object.entries(e||{}).forEach(([t])=>{const s=this._getViewModelValidators(t);this._validators[t]=this._validators[t]||[];for(const[r,n]of Object.entries(s))if(n?.type){const a=this._injectionContext??pi(this)?._injectionContext,u=this.validatorTypeResolver.getValidator(n.type,{validationParameters:n.params,injectionContext:a});this._validators[t].push({name:r,instance:u,disabled:n.disabled,params:n?.params})}})})}_waitAsyncValidation(){return(0,l.from)(this.waitAsyncTasksFinish()).pipe((0,o.switchMap)(()=>this.formApiModel.statusChanges.pipe((0,o.startWith)(this.formApiModel.status),(0,o.filter)(e=>e.toLowerCase()!=="pending"),(0,o.first)(),(0,o.map)(()=>null))))}_getResourcesStrings(){const e=this.resources?.strings??{};return{...e,...this._getResourceStringsByAttributes(e)}}_getChangedResourcesStrings(e){const t=Object.entries(e).reduce((r,[n,a])=>{const u=this.resources?.strings[n]||{},d=a&&{...u,...a};return{...r,[n]:d}},{}),s={...this.resources?.strings,...t};return JSON.parse(JSON.stringify(s))}_generateResourceAttribute(){this[en]={},this[en][Ds.string]={};const e=this._getResourcesStrings();return this._attributeResourceGenerator.generate(this,e)}_getBoundAttributeNames(){const e=new Set;return this._dataSourcesInfos.forEach(t=>{for(const s of t.mappedViewModelAttributes)e.add(s)}),Array.from(e.values())}_getDataSourceInfoByViewModelAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e);return this._dataSourcesInfos.has(t)?this._dataSourcesInfos.get(t):null}_getResourceStringsByAttributes(e){const t=Object.keys(e);return this._getBoundAttributeNames().filter(r=>!t.includes(r)).reduce((r,n)=>(r[n]={},r),{})}_getDataSourceAttributeSchema(e,t){return this.dataSchemas[e.name]?.attributes?.find(s=>s.name===t)}_generatePrimaryAttributes(){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{const e=Array.from(this._dataSourcesInfos.values()).map(t=>{const s=t.name,r=this.dataSchemas[s],a=(t.includePrimaryAttributes?[r?.primaryAttributeName,r?.primaryDisplayAttributeName]:[]).filter(u=>u&&!t.getIsDataSourceAttributePathExists(u)).map(u=>{const d=(0,L.qv)(),h=`${s}_${u}_${d}`,g=r.findAttributeByName(u),b={modelConfig:{path:`${s}.${u}`},dataValueTypeName:v.r[g.dataValueType]};return this._attributeConfigs[h]=b,t.addNewAttribute(h,b),this._attributeGenerate({[h]:b})});return a.length===0?(0,l.of)(null):(0,l.forkJoin)(a)});return e.length===0?(0,l.of)(null):(0,l.forkJoin)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.forkJoin.${this._injectionContext?.id}.parent.${!!this.parent}`))})}_getDataSourceDto(e){const t={},s=this._dataSourcesInfos.get(e);return s.attributesMap.forEach((r,n)=>{if(!s.getIsMapOnCollection(n)){const a=this.attributes[n],u=this._getDataSourceAttributeSchema(s,r);!a&&u?.dataValueType===v.r.Lookup?t[r]=null:t[r]=a}}),(0,l.of)(t)}_checkFilteringAttributes(e,t){if(t.some(r=>(0,D.isNil)(r.name)))throw new Error(`Filtering attributes for ${e} are not valid!`)}_attributeGenerate(e,t){return this._attributeGenerator.generate(this,e,{...t,onChangeAttributeValue:(s,r,n)=>{this._fireChangeAttributeEvent({type:me.ChangeAttributeValue,payload:{attributeName:s,value:r,oldValue:n,silent:this._viewModelAttributeChangeEventOptions.getAsSilent()}})}})}_getDataSourceNamesAffectedByFilteringAttribute(e,t){return[...this._dataSourcesInfos.entries()].filter(([,s])=>s.isCollection).filter(([s])=>{const r=this.getModelByName(s);return t.has(r?.name)||r?.isLoaded||r?.isLoading}).filter(([s,r])=>{const n=r.getFilteringConfig(),a=n.some(u=>u?.name===e&&u?.loadOnChange);return a&&this._checkFilteringAttributes(s,n),a}).map(([s])=>s)}_createRequestsForReloadingDataSources(e){return e.map(t=>({type:"crt.LoadDataRequest",$context:this,dataSourceName:t,config:{loadType:le.Reload}}))}_dispatchStartLoadModelAttributes(e){const t=`${at.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.addTask(t,{targetTask:!0}),this._replayEvents$.next({type:me.StartLoadModelAttributes,payload:e})}_dispatchFinishLoadModelAttributes(e){const t=`${at.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.removeTask(t,{targetTask:!0}),this._replayEvents$.next({type:me.FinishLoadModelAttributes,payload:e})}_processEmptyLoadDataForCollection(e,t){var s=this;return(0,C.A)(function*(){if(!e.isCollection||!e.collectionViewModelAttributeName)return;const r=t.find(d=>d.type===F.PrimaryColumnValue);if(!r)return;const n=r.value?.value,a=s.attributes[e.collectionViewModelAttributeName];if(!n||!a)return;const u=yield a.findByPrimaryAttribute(n);u&&a.remove(u)})()}_loadDynamicModel(e){const t=e.attributeName,s=e.dataSourceConfig,r=e.dataSourceName||Hs.createDynamicDataSourceNameFromAttributeName(this,t),n=Hs.createAttributeConfig(this,r,e),a=this._createAndSetDataSourceInfo(r,t,n);return this._defineOrUpdateAttribute(t,n),this._setupSortingAttribute(e.sortingConfig),this._setupFiltersAttributes(e.filtersConfig),this._modelGenerator.generateOne(s,r).pipe((0,o.tap)(u=>this._markModelAsCollection(u,a)),(0,o.tap)(u=>this._dynamicModelNames.add(u.name)),(0,o.tap)(u=>this._upsertModel(r,u)),(0,o.tap)(u=>this._addModelDependencies(u,e.dependencies)),(0,o.switchMap)(u=>(0,l.forkJoin)([(0,l.of)(u),this._addDataSchemaToDataSchemas(u)])),(0,o.switchMap)(([u])=>(0,l.forkJoin)([(0,l.of)(u),(0,l.of)(this._replaceAttributesToDataSourceNameMap(a))])),(0,o.switchMap)(([u])=>(0,l.forkJoin)([(0,l.of)(u),this._reGenerateResourcesAttributes()])),(0,o.switchMap)(([u])=>this._loadModelData({model:u,dataSourceInfo:a,parametersConfig:[],loadType:le.Reload,useLastLoadParameters:e.useLastLoadParameters}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${e.dataSourceName}`))))}_defineOrUpdateAttribute(e,t){this.attributes[e]?this._attributeConfigs[e]=t:this._attributeGenerate({[e]:t})}_createAndSetDataSourceInfo(e,t,s){const n=ct.getFromViewModelConfig({attributes:{[t]:s}}).get(e);return this._dataSourcesInfos.set(e,n),n}_setupSortingAttribute(e){if(!e?.default)return;const t=e.attributeName;this.attributes[t]=e.default}_setupFiltersAttributes(e){e?.forEach(t=>{if(!t.value)return;const s=t.name,r=t.value;this[s]=r.value||r})}_addModelDependencies(e,t){this._modelDependencies[e.name]=t||[]}_addDataSchemaToDataSchemas(e){return e.getSchema().pipe((0,o.tap)(t=>this.dataSchemas[e.name]=t))}_reGenerateResourcesAttributes(){return(0,l.forkJoin)([...this._generateResourceAttribute(),(0,l.of)(null)])}_replaceAttributesToDataSourceNameMap(e){const t=this._getDataSourceAttributesMap(e),s=[...Array.from(this._attributesToDataSourceNameMap.entries()),...t];this._initializeAttributesToDataSourceNameMap(s)}_getMappedAttributeName(e,t){if(!e)return"";const s=e.getMappedAttributeNames(t);return!s||s.length===0?"":s[0]}_getMappedAttributeNames(e,t){return e?e.getMappedAttributeNames(t):[]}_getModelAttributesToLoad(e,t){const s=this._dataSourcesInfos.get(e.name);if(t?.attributes){const r=t.attributes.filter(n=>{const a=this._getMappedAttributeName(s,n);return!this.getIsDirty(a)});return this._getModelDependentAttributes(e,r)}return s.attributes.map(r=>r.path)}_loadStaticModel(e,t,s,r,n,a){const u=this.getModelByName(e),d=this._dataSourcesInfos.get(u.name);return this._loadModelData({model:u,dataSourceInfo:d,parametersConfig:t,loadType:s,payload:r,useLastLoadParameters:n,doNotUpdateLastLoadParameters:a})}_waitDataDelay(e){return this._viewModelDataDelayerService?.shouldBeDelayed()?(0,l.of)(e).pipe((0,o.delayWhen)(()=>this._viewModelDataDelayerService.loadTrigger$)):(0,l.of)(e)}_updateTrackedAttributes(e){const t=this._modelDependencies[e.name];if(!t||!e.isAggregate)return;const s=/^.{0,2}\[\w+:\w+(:\w+)?]/;t.forEach(r=>{const n=r.relationPath.split(".")[0],a=this.getModelByName(n),u=e.affectedAttributes.filter(h=>h.schemaName===a.dataSchemaName).map(h=>h.path.split(".")[0]).filter(h=>!s.test(h)),d=new Set([...r.trackByAttributes??[],...u]);r.trackByAttributes=[...d.values()]})}_waitForModelLoad(e){var t=this;return(0,C.A)(function*(){const s=t.getModelByName(e);!s||s?.isLoaded||s.mode===T.Create||s.mode===T.Copy||(yield(0,l.firstValueFrom)(t._modelLoaded$.pipe((0,o.filter)(r=>r===e),(0,o.take)(1))))})()}_waitForModelsLoad(e){var t=this;return(0,C.A)(function*(){if(e.length===0||t._isDesignTime)return;const s=e.map(r=>t._waitForModelLoad(r));yield Promise.all(s)})()}_waitForModelsLoadParameters(e,t){var s=this;return(0,C.A)(function*(){if(e.length===0||s._isDesignTime||!t||t.mode===T.Create||t.mode===T.Copy)return;const r=e.map(n=>s._waitForModelLoadParameters(n));yield Promise.all(r)})()}_waitForModelLoadParameters(e){var t=this;return(0,C.A)(function*(){t._lastEventLoadParameters.has(e)||t._modelsNamesWithParameters.has(e)||(yield(0,l.firstValueFrom)(t._modelLoadParametersSetted$.pipe((0,o.filter)(()=>t._modelsNamesWithParameters.has(e)),(0,o.take)(1))))})()}_getAffectedAttributes(e,t,s){const n=this.dataSchemas[e].primaryAttributeName,a=[...t];return n&&!t.includes(n)&&s?.length>0&&s?.[0][n]&&a.push(n),a}_getModelLoadParameters(e,t,s,r,n,a){return this._modelParametersBuilder.getModelLoadParameters(this,e,t,s,{payload:r,useLastLoadParameters:n,doNotUpdateLastLoadParameters:a}).catch(u=>(console.error(u),this._showNotification({message:u.message}),[[{type:F.Never}],{},{}]))}_getRelationTypeForRootModel(e){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return null;const t=this._modelDependencies[e],s=Kt(this.getModelByName(e));if(t?.length!==1||!this._primaryModelName||!s)return null;const r=this.dataSchemas[this._primaryModelName],n=t[0],{dependOnModelName:a,dependOnAttributeName:u}=ao(n.relationPath);return a!==this._primaryModelName?null:io(this.dataSchemas[e],n.attributePath,r,u)}_isManyToOneRootModelRelation(e){return this._getRelationTypeForRootModel(e)===W.ManyToOne}_isOneToManyRootModelRelation(e){return this._getRelationTypeForRootModel(e)===W.OneToMany}_getOneToManyRelationDefaultValues(e){const t=this._modelDependencies[e]?.[0];if(!t)return{};const s=this.dataSchemas[this._primaryModelName],r=this.getViewModelAttributePaths(this._primaryModelName,s.primaryAttributeName)?.[0],n=this.getViewModelAttributePaths(this._primaryModelName,s.primaryDisplayAttributeName)?.[0];return{[t.attributePath]:{value:this.attributes[r],displayValue:this.attributes[n]}}}_getDependOnModelLoadConfiguration(e){const t=this._getDependOnModelsNames(e),s={};return t.forEach(r=>{this._modelSourceRecordId[r]&&(s[r]={[this.dataSchemas[r].primaryAttributeName??"Id"]:this._modelSourceRecordId[r]})}),s}_isPrimaryModel(e){return this._primaryModelName===e}_isIndependentRootModel(e){return Kt(e)?this._getDependOnModelsNames(e.name).length===0:!1}_checkAndProcessPageDataSourceData(e,t){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return(0,l.of)(t);if(this._isManyToOneRootModelRelation(e.name)&&t.length===0)return this._clearModelValues(e.name),e.setLoadedState(),(0,l.of)(t);const r=this._isOneToManyRootModelRelation(e.name),n=this._isIndependentRootModel(e);if(!(r&&t.length===0||n&&t.length===0&&!this._isPrimaryModel(e.name)))return(0,l.of)(t);e.resetMode();const u=this._getOneToManyRelationDefaultValues(e.name);if(this.PrimaryModelMode===T.Copy){const d=this.dataSchemas[e.name].primaryAttributeName??"Id",h=this._getDependOnModelLoadConfiguration(e.name);return(0,l.from)(this.getDataSourceLoadParameters(e.name,h)).pipe((0,o.switchMap)(({parameters:g,options:b})=>e.load({attributes:[d],parameters:g,options:{loadType:le.Reload,pagingConfig:b.pagingConfig,sortingConfig:b.sortingConfig}})),(0,o.switchMap)(g=>{e.resetMode();const b=g?.length?g[0][d]:null;return b?this.copy(e.name,b,u):this.create(e.name,u)}),(0,o.map)(()=>t))}return this.create(e.name,u).pipe((0,o.map)(()=>t))}_isRowsLimitReached(e){var t=this;return(0,C.A)(function*(){const s=e.collectionViewModelAttributeName,r=e.getPagingConfig()?.rowsLimit;return!r||!s?!1:(yield t[s])?.length>=r})()}_setDataSourceLoaded(e,t,s,r){var n=this;return(0,C.A)(function*(){s.length<r?.rowCount||(yield n._isRowsLimitReached(t))?n._loadedDataSources.add(e):n._loadedDataSources.delete(e)})()}_getModelDependedOnEntityDataSource(e){return e.filter(t=>this.models.find(n=>n.name===t).getDataSource().type===Si.EntityDataSource)}_loadModelData({model:e,dataSourceInfo:t,parametersConfig:s,loadType:r,payload:n,useLastLoadParameters:a,doNotUpdateLastLoadParameters:u}){const d=e.name;this._modelsRequestedToLoad.add(d);const h=this._getModelAttributesToLoad(e,n),g=n?.attributes;if(g&&h.length===0)return(0,l.of)([]);if(this._conflictedModels.includes(d))return(0,l.of)([]);const b=this._getDataSourceMappingAttributes(t,h),M=this._getLoadTypeForDataSource(t,r);if(M===le.LoadNext&&this._loadedDataSources.has(d))return(0,l.of)([]);this._dispatchStartLoadModelAttributes(b);const Z=!this._isSyncForModelAllowed(e)||g===null||e.mode===T.Init,Y=this._getDependOnModelsNames(d);this._checkAndLoadUnloadedDependOnModels(Y);const j=this._getModelDependedOnEntityDataSource(Y),Xt=Y.filter(Me=>!j.includes(Me)),Qp=Promise.all([this._waitForModelsLoad(Xt),this._waitForModelsLoadParameters(j,e)]);return(0,l.from)(this._featureValues.DisableSequentialLoadDependentDS?this._waitForModelsLoad(Y):Qp).pipe((0,o.switchMap)(Me=>(0,l.from)(this._getModelLoadParameters(t,s,M,n,a,u)).pipe((0,o.tap)(()=>{!this._featureValues.DisableSequentialLoadDependentDS&&!t.isCollection&&(this._modelDependencies[d]?.map(de=>de.relationPath)||[]).forEach(de=>{const{dependOnModelName:ar,dependOnAttributeName:bc}=ao(de),[Ol]=this.getViewModelAttributePaths(ar,bc);this.getAttributeControl(Ol).markAsPristine()})}),(0,o.tap)(()=>{if(!this._featureValues.DisableSequentialLoadDependentDS){this._setModalLoadParameters(d);const Ge=this._getAffectedAttributes(d,h,[]);this._reloadDependentModels(e,Ge,De.Page)}}))),(0,o.mergeMap)(Me=>this._waitDataDelay(Me)),(0,o.switchMap)(([Me,Ge,xl])=>e.load({attributes:h,parameters:Me,options:{loadType:r,pagingConfig:Ge,sortingConfig:xl}}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.model.load.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${d}`),(0,o.catchError)(de=>this._handleLoadErrorResponse(de,[])),(0,o.tap)(()=>this._updateTrackedAttributes(e)),(0,o.tap)(de=>{de.length===0&&this._dispatchFinishLoadModelAttributes(b)}),(0,o.mergeMap)(de=>de.length===0?(0,l.from)(this._processEmptyLoadDataForCollection(t,Me)).pipe((0,o.map)(()=>de)):(0,l.of)(de)),(0,o.switchMap)(de=>this._checkAndProcessPageDataSourceData(e,de)),(0,o.map)(de=>({data:de,viewModelAttributes:t.getModelDto(de)})),(0,o.switchMap)(({data:de,viewModelAttributes:ar})=>this.setValue(ar,{collectionLoadType:M===le.Reload?Xs.Reload:Xs.Merge,silent:!0,isMaskedValue:!0}).pipe((0,P.pR)(()=>!t.isCollection||!ar?(0,l.of)(void 0):(Object.keys(ar).forEach(bc=>{this.attributes[bc]?.forEach(Ll=>{Ll.formApiModel.updateValueAndValidity()})}),(0,l.from)(this._setDataSourceLoaded(d,t,de,Ge)))),(0,o.tap)(()=>this._markAsPristine(ar)),(0,o.map)(()=>de))))),(0,o.tap)(()=>this._modelLoaded$.next(d)),(0,o.switchMap)(Me=>this._runBusinessRulesForModel(e,Me)),(0,o.tap)(Me=>{const Ge=this._getAffectedAttributes(d,h,Me);this._featureValues.DisableSequentialLoadDependentDS&&this._reloadDependentModels(e,Ge,De.Page),Z||this._reloadDependentModels(e,Ge,De.ViewElement)}),(0,o.tap)(Me=>{const Ge=Me[0]??{};e.setLoadedState(Object.keys(Ge)),this._dispatchFinishLoadModelAttributes(b)}))}_checkAndLoadUnloadedDependOnModels(e){const t=e.filter(s=>{const r=!this._modelsRequestedToLoad.has(s),n=!Kt(this.getModelByName(s));return r&&n});this._requestReloadModels(t)}_createChangeAttributeTriggers(e){return e.map(t=>({type:oe.ChangeAttributeValue,name:t,scopeId:""}))}_runBusinessRulesForModel(e,t,s=!1,r=[]){const n=this._dataSourcesInfos.get(e.name);if(n.isCollection||!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,l.of)(t);const a=t[0]??{},u=s?[...n.mappedViewModelAttributes]:Object.keys(a).flatMap(b=>this._getMappedAttributeNames(n,b)).filter(b=>b!=null),d=this._createChangeAttributeTriggers(u),h={type:oe.DataLoaded,name:e.name,scopeId:""},g=this.models.filter(b=>b!==e).filter(b=>b.mode!==T.Init).filter(b=>b.getDataSource().scope===De.Page).map(b=>this._getModelBusinessRuleContext(b.name,[]));return(0,l.forkJoin)([this._getModelBusinessRuleContext(n.name,[h,...r]),...g,(0,l.of)(this._getViewModelBusinessRuleContext([...d,...r,h]))]).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRulesForModel.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,o.switchMap)(b=>this._runBusinessRulesForContexts(b)),(0,o.map)(()=>t))}_runInitialBusinessRules(){if(!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,l.of)(null);const e={type:oe.ContextReady,name:null,scopeId:""};return this._prepareBusinessRulesContexts([e]).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitialBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,o.mergeMap)(t=>t.length===0?(0,l.of)(null):this._runBusinessRulesForContexts(t)))}_createViewModelAttributesValues(e,t){const s=Object.entries(this.dataSchemas),[,r]=s.find(([a])=>a===e),n={};for(const a of r.attributes){const u=t[a.name],d=this.getViewModelAttributePath(e,a.name);d&&(n[d]=u??null)}return n}_createModelData(e,t){const s=this._dataSourcesInfos.get(e),r=this._getDataSourceMappingAttributes(s);this._dispatchStartLoadModelAttributes(r);const n=this.getModelByName(e),a=n.disableSync,u=this._getModelAttributesToLoad(n,null);return n.disableSync=!0,n.create(t).pipe((0,o.switchMap)(d=>{const h=this._createViewModelAttributesValues(e,d),g=this._isOneToManyRootModelRelation(e)?{silent:!0}:null;return this.setValue(h,g).pipe((0,o.tap)(()=>this._forEachControl(h,b=>{b.markAsPristine(),b.markAsUntouched()})))}),(0,o.tap)(()=>{n.disableSync=a,this._modelLoaded$.next(e),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e)}),(0,o.switchMap)(()=>this._runBusinessRulesForModel(n,[],!0)),(0,o.tap)(()=>{this._isSyncForModelAllowed(n)&&this._reloadDependentModels(n,u)}),(0,o.tap)(()=>{this._dispatchFinishLoadModelAttributes(r),n.setLoadedState()}),(0,o.map)(()=>null))}_copyModelData(e,t,s){const r=this._dataSourcesInfos.get(e),n=this._getDataSourceMappingAttributes(r);this._dispatchStartLoadModelAttributes(n);let a;const u=this.getModelByName(e),d=this._getModelAttributesToLoad(u,null),h=u.disableSync;return u.disableSync=!0,this._modelSourceRecordId[e]=t,u.copy(t,s).pipe((0,o.catchError)(g=>this._handleLoadErrorResponse(g,{})),(0,o.map)(g=>({data:[g],viewModelAttributes:r.getModelDto([g])})),(0,o.switchMap)(({data:g,viewModelAttributes:b})=>this.setValue(b).pipe((0,o.tap)(()=>this._markAsPristine(b)),(0,o.map)(()=>g))),(0,o.tap)(()=>{u.disableSync=h,this._modelLoaded$.next(e)}),(0,o.switchMap)(g=>this._runBusinessRulesForModel(u,g,!0)),(0,o.tap)(()=>{this._isSyncForModelAllowed(u)&&(this._reloadDependentModels(u,d),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e))}),(0,o.tap)(()=>{this._dispatchFinishLoadModelAttributes(n),u.setLoadedState()}),(0,o.mergeMap)(()=>(0,l.of)(a)))}_getDataSourceMappingAttributes(e,t=null){const s=t??e.attributes.map(n=>n.path),r=Object.fromEntries(s.map(n=>[this._getMappedAttributeName(e,n),!0]));return e.collectionViewModelAttributeName&&(r[e.collectionViewModelAttributeName]=!0),r}_handleLoadErrorResponse(e,t){if(e instanceof Au)return(0,l.of)(t);const s=1e4;return console.error(e),this._showNotification({message:e.message,duration:s}),(0,l.of)(t)}_canExecuteBusinessRulesByModelAttributeValue(e,t,s){return t&&e?this._isModelAttributeValueValid(e,t,s):!0}_canExecuteBusinessRulesByViewModelAttributeValue(e,t){const s=this._getDataSourceInfoByViewModelAttributePath(e);if(s){const r=s.getDataSourceAttributePath(e);return this._canExecuteBusinessRulesByModelAttributeValue(s,r,t)}return!0}_getContextAttributeValue(e){return e instanceof Date?Ui(e):e}_getNormalizedContextAttributeValue(e,t,s){const r=e;return v.r[t]===v.r.Lookup||r?.displayValue?r?.value??e:s===!0||!t?e:[v.r.RICH_TEXT,v.r.Image].includes(v.r[t])?null:v.r[t]===v.r.MAXSIZE_TEXT&&e?e.slice(0,500):e}_getHasValueContextAttributeValue(e,t){return!!(t&&v.r[t]===v.r.Boolean||e!=null&&e!=="")}_getViewModelAttributeInfos(e,t,s){return Object.keys(t).filter(r=>!(t[r]instanceof ot)).map(r=>{if(t[r]instanceof wt)return this._getViewModelAttributeInfos(e?`${e}.${r}`:r,t[r]?.attributes??{},s);const n=this._attributeConfigs[r]?.dataValueTypeName,a=this._getContextAttributeValue(t[r]),u=this._getNormalizedContextAttributeValue(a,n,s);return{name:e?`${e}.${r}`:r,value:u??null,displayValue:t[r]?.displayValue,dataValueTypeName:n,hasValue:this._getHasValueContextAttributeValue(a,n)}}).flat()}_runBusinessRulesForContexts(e){const t=`${at.RunningBusinessRules}-${(0,L.qv)()}`;return this._onAsyncTaskStarted(t),(0,l.of)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,o.map)(s=>s?.filter(r=>!(0,D.isNil)(r))??[]),(0,o.mergeMap)(s=>{if(s.length===0)return(0,l.of)(null);const r=s.map(n=>({scopeName:n.scopeName,scopeId:n.scopeId,scopeType:n.scopeType,triggers:n.triggers}));return this._toggleControlsAffectedByBusinessRules(!1,r),this._businessRulesEngine.execute(s).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.execute.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,o.tap)(n=>{n.forEach(a=>{const u=r.find(d=>d.scopeId===a.scopeId&&d.scopeName===a.scopeName&&d.scopeType===a.scopeType);a.triggers=u?.triggers??[]})}),(0,o.switchMap)(n=>n?this._businessRulesApplier.applyRules(this,n):(0,l.of)(null)),(0,o.tap)(()=>{this._toggleControlsAffectedByBusinessRules(!0,r)}))}),(0,o.tap)(()=>this._onAsyncTaskFinished(t)))}_createViewModelContext(e,t){return{scopeType:Oe.ViewModel,scopeName:this._scopeName,scopeId:this._scopeName,scopeState:At.Unknown,parentScopeId:null,attributes:t,triggers:e}}_getViewModelBusinessRuleContext(e){const t=this._featureValues["BRules-EnableCompareLargeAttributeValues"],s=this._getViewModelAttributeInfos(null,this.attributes,t);return this._createViewModelContext(e,[...s].map(r=>({attributeName:r.name,value:r.value,displayValue:r.displayValue,dataValueTypeName:r.dataValueTypeName,hasValue:r.hasValue})))}_prepareModelBusinessRuleTrigger(e,t){return t.map(s=>{if(s.type===oe.DataLoaded||s.type===oe.ContextReady)return s;const r=this._getDataSourceInfoByViewModelAttributePath(s.name);return!r||r.name!==e?null:{type:oe.ChangeAttributeValue,name:r.getDataSourceAttributePath(s.name),scopeId:""}}).filter(s=>s!=null)}_getModelContextScopeStateType(e){switch(e.mode){case T.Init:return At.Init;case T.Create:return At.Create;case T.Copy:return At.Copy;case T.Update:return At.Update;default:return At.Unknown}}_getModelBusinessRuleContext(e,t){const s=this._dataSourcesInfos.get(e),r=this.getModelByName(e),n=this.dataSchemas[e],a=this._prepareModelBusinessRuleTrigger(e,t),u=this._getModelContextScopeStateType(r);return this._getDataSourceDto(e).pipe((0,o.map)(d=>({...r._getPersistedState(),...d})),(0,o.map)(d=>({enableCompareLargeAttributeValues:this._featureValues["BRules-EnableCompareLargeAttributeValues"],modelDto:d})),(0,o.map)(({enableCompareLargeAttributeValues:d,modelDto:h})=>Object.entries(h).map(([g,b])=>{let M;const Z=this._getMappedAttributeName(s,g);if(Z)M=this._attributeConfigs[Z]?.dataValueTypeName;else{const Xt=n.findAttributeByName(g);M=v.r[Xt.dataValueType]}const Y=this._getContextAttributeValue(b),j=this._getNormalizedContextAttributeValue(Y,M,d);return{attributeName:g,value:j,displayValue:b?.displayValue,dataValueTypeName:M,hasValue:this._getHasValueContextAttributeValue(Y,M),isSignificant:g===n.primaryAttributeName}})),(0,o.map)(d=>({scopeType:Oe.Model,scopeName:r.dataSchemaName,scopeId:e,scopeState:u,parentScopeId:this._scopeName,attributes:d,triggers:a,modelType:r.getDataSource()?.type})))}_prepareDataSourceNamesForBusinessRules(){return this._modelsMap.size===0?[]:[...this._modelsMap.values()].filter(e=>!this._dataSourcesInfos.get(e.name).isCollection).map(e=>e.name)}_getModelsBusinessRuleContexts(e){return this._prepareDataSourceNamesForBusinessRules().map(s=>s?this._getModelBusinessRuleContext(s,e):(0,l.of)(null))}_prepareBusinessRulesContexts(e){const t=this._getModelsBusinessRuleContexts(e);if(!this._scopeName)return t.length===0?(0,l.of)([]):(0,l.forkJoin)([...t]);const r=[(0,l.of)(this._getViewModelBusinessRuleContext(e)),...t];return r.length===0?(0,l.of)([]):(0,l.forkJoin)(r)}_isAttributeChange(e){return!e.attributeName?.includes(":")}_businessRulesSubscribeOnChangeAttributes(){if(!this._businessRulesProcessingEnabled||this._isDesignTime)return;const e=this.events$.pipe((0,o.filter)(()=>this._businessRulesActive),(0,o.filter)(s=>s.type===me.ChangeAttributeValue),(0,o.filter)(s=>this._isAttributeChange(s.payload)),(0,o.filter)(s=>!s.payload.silent),(0,o.filter)(s=>!s.payload?.preventRunBusinessRules),(0,o.filter)(s=>{const r=s.payload;return this._canExecuteBusinessRulesByViewModelAttributeValue(r.attributeName,r.value)}),(0,o.filter)(s=>{const r=s.payload,n=this._getAttributeDataValueTypeName(r.attributeName);return n&&ia(n)===v.r.Lookup?r.value?.value!==r.oldValue?.value:!0}),(0,o.map)(s=>s.payload.attributeName)),t=e.pipe((0,o.tap)(()=>this._onAsyncTaskStarted(at.DebouncingBusinessRules)),(0,o.buffer)(e.pipe((0,o.debounceTime)(Zp))),(0,o.map)(s=>Array.from(new Set(s))),(0,o.map)(s=>this._createChangeAttributeTriggers(s)),(0,o.mergeMap)(s=>this._prepareBusinessRulesContexts(s)),(0,o.tap)(()=>this._onAsyncTaskFinished(at.DebouncingBusinessRules)),(0,o.filter)(s=>s.length>0),(0,o.mergeMap)(s=>this._runBusinessRulesForContexts(s)));this._subscriptions.add(t.subscribe())}_subscribeOnChangeAttributes(){const e=this.events$.pipe((0,o.filter)(t=>t.type===me.ChangeAttributeValue),(0,o.map)(t=>t),(0,o.map)(t=>{const s=this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),r=this._dataSourcesInfos.get(s)?.attributesMap.get(t.payload.attributeName),n=this.getBoundDataSchemaAttributeByAttributePath(t.payload.attributeName);return{changeEvent:t,model:this.getModelByName(s),modelAttributeInfo:{name:n?.name??r,isLookup:!!n?.isLookup}}}),(0,o.filter)(({model:t,modelAttributeInfo:s})=>!!(t&&s.name)),(0,o.tap)(({changeEvent:t,model:s,modelAttributeInfo:r})=>{const n=t.payload,a=r.isLookup,u=a?n.oldValue?.value:n.oldValue,d=a?n.value?.value:n.value;u!==d&&s?.attributeChanged(r.name,n?.preventStateChange??n?.silent)}));this._subscriptions.add(e.subscribe())}_getHasRelation(e=[],t,s){return e.map(n=>{const a=n.trackByAttributes??[],{dependOnModelName:u,dependOnAttributeName:d}=ao(n.relationPath);return a.push(d),{rootModelName:u,trackedAttributes:d}}).filter(({rootModelName:n})=>n===t).filter(({trackedAttributes:n})=>this._dataSourcesInfos.get(t).isCollection?!0:s.some(a=>n.includes(a))).length!==0}_getDependentModelsNames(e,t=[]){return e?Object.entries(this._modelDependencies).filter(([s])=>s!==e).filter(([,s])=>this._getHasRelation(s,e,t)).map(([s])=>s).map(s=>[s,...this._getDependentModelsNames(s)]).flat():[]}_getIsModelDataChanged(e){if(!this.getModelByName(e)?.isLoaded)return!1;const s=this._dataSourcesInfos.get(e);if(s.isCollection){const n=s.collectionViewModelAttributeName,a=this.attributes[n];return a?a.isChanged:!1}return s.getMappedAttributes().some(n=>this.getIsDirty(n))}_requestReloadModels(e){this._createRequestsForReloadingDataSources(e).forEach(s=>{this._ngZone.runOutsideAngular(()=>this.processRequest(s))})}_isModelAttributeValueValid(e,t,s){return this._getDataSourceAttributeSchema(e,t)?.dataValueType===v.r.Lookup?mh(s):!0}_canReloadModelDependentData(e,t){return e.canReloadDependentData(t)?!0:this._conflictedModels.includes(e.name)?!1:this._getDependentModelsNames(e.name,[t]).length>0}_getModelDependentAttributes(e,t){return[...t,...t.map(s=>e.getDependentAttributesNames(s)).flat()]}_getChangedModelsNames(e){return e.filter(t=>this._getIsModelDataChanged(t))}_showNotification(e){this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.NotificationRequest",$context:this,...e}))}_isSyncForModelAllowed(e){return e.allowSync}_subscribeOnReloadDataEvents(){if(this._isDesignTime)return;const e=this.events$.pipe((0,o.filter)(()=>this._modelSynchronizationEnabled),(0,o.filter)(t=>t.type===me.ChangeAttributeValue),(0,o.filter)(t=>t.payload.silent!==!0),(0,o.map)(t=>({modelName:this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),attributeName:t.payload.attributeName,attributeValue:t.payload.value})),(0,o.filter)(({modelName:t})=>t!=null),(0,o.map)(({modelName:t,attributeName:s,attributeValue:r})=>{const n=this._dataSourcesInfos.get(t),a=n?.attributesMap.get(s);return{model:this.getModelByName(t),dataSourceInfo:n,modelAttribute:a,attributeValue:r}})).pipe((0,o.filter)(({model:t})=>t!=null),(0,o.filter)(({dataSourceInfo:t})=>!t.isCollection),(0,o.filter)(({model:t})=>this._isSyncForModelAllowed(t)),(0,o.filter)(({dataSourceInfo:t,modelAttribute:s,attributeValue:r})=>this._isModelAttributeValueValid(t,s,r)),(0,o.filter)(({model:t,modelAttribute:s})=>this._canReloadModelDependentData(t,s))).pipe((0,o.tap)(({model:t,dataSourceInfo:s,modelAttribute:r,attributeValue:n})=>{const a=this._getModelDependentAttributes(t,[r]),u=Object.fromEntries(a.map(d=>[this._getMappedAttributeName(s,d),!0]));this._dispatchStartLoadModelAttributes(u),t.reloadDependentData(r,n).pipe((0,o.switchMap)(d=>{if(d.length===0)return(0,l.of)(d);const h=s.getModelDto(d);return this.setValue(h,{silent:!0,isMaskedValue:!0}).pipe((0,o.switchMap)(()=>this._runBusinessRulesForModel(t,d)))}),(0,o.tap)(()=>this._reloadDependentModels(t,[r])),(0,o.tap)(()=>this._dispatchFinishLoadModelAttributes(u))).subscribe()}));this._subscriptions.add(e.subscribe())}_subscribeOnChangeRequests(){const e=this.events$.pipe((0,o.filter)(t=>t.type===me.ChangeAttributeValue),(0,o.mergeMap)(t=>{const s=t.payload.attributeName,r=this._attributeConfigs[s];return Array.isArray(r?.change)?r.change:[r?.change]}),(0,o.filter)(t=>t!=null),(0,o.map)(t=>({type:t.request,$context:this,scopes:this._scopeName?[this._scopeName]:[],...t.params})),(0,o.tap)(t=>this._ngZone.runOutsideAngular(()=>this.handlerChain.process(t))));this._subscriptions.add(e.subscribe())}_subscribeOnFilteringEvents(){const e=new Set;this._subscriptions.add(this._modelLoaded$.pipe((0,o.tap)(s=>{e.add(s)})).subscribe());const t=this.events$.pipe((0,o.filter)(s=>s.type===me.ChangeAttributeValue),(0,o.map)(s=>{const r=s.payload.attributeName;return this._getDataSourceNamesAffectedByFilteringAttribute(r,e)}),(0,o.map)(s=>this._createRequestsForReloadingDataSources(s)),(0,o.tap)(s=>{s.forEach(r=>{this._ngZone.runOutsideAngular(()=>this.processRequest(r))})}));this._subscriptions.add(t.subscribe())}_saveModel(e,t,s){const r=this.getModelByName(e),n=r.mode,a=this.getSaveModelStream$({dataSourceName:e,parametersConfig:t,saveAction:(u,d)=>r.insertOrUpdate(u,d),onSavedAction:(u,d)=>this._updateLastLoadParameters(e,n,u,d),getInvalidAction:u=>(0,l.of)(u)});return this.handleSaveModelStream(a,s)}_initSubscriptions(){return this._measurePerformanceService.measure(`ViewModel.initSubscriptions.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._subscribeOnFilteringEvents(),this._subscribeModelsEvents(),this._subscribeOnChangeAttributes(),this._subscribeOnChangeRequests(),this._subscribeOnReloadDataEvents(),this._businessRulesSubscribeOnChangeAttributes(),this._subscribeOnChangeAttributesToHandleModelDependenciesConstrains(),this._subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(),(0,l.of)(null)))}_subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(){if(this._featureValues.DisableMultipleDataSources)return;const e=this.events$.pipe((0,o.filter)(t=>this._primaryModelName!=null),(0,o.filter)(t=>t.type===me.ChangeAttributeValue),(0,o.map)(t=>t),(0,o.map)(({payload:t})=>{const s=t.attributeName,r=t.value;return{modelName:this.getBoundDataSourceNameByAttributePath(s),attributeName:s,attributeValue:r}}),(0,o.filter)(({modelName:t})=>this._isPrimaryModel(t)),(0,o.filter)(({attributeName:t})=>{const s=this.getBoundDataSchemaByAttributePath(t),r=this.getBoundDataSchemaAttributeByAttributePath(t);return!s||!r?!1:s.primaryDisplayAttributeName===r.name}),(0,o.map)(({modelName:t,attributeValue:s})=>{const r=this.dataSchemas[this._primaryModelName],a=this._getDependentModelsNames(t,[r.primaryAttributeName]).filter(u=>this._isOneToManyRootModelRelation(u));return{primaryDisplayValue:s,dependentModelsNames:a}}),(0,o.filter)(({dependentModelsNames:t})=>t.length>0),(0,o.tap)(({dependentModelsNames:t,primaryDisplayValue:s})=>{const r=this.dataSchemas[this._primaryModelName],n=this.getViewModelAttributePaths(this._primaryModelName,r.primaryAttributeName)[0],a=this.attributes[n],u={};t.map(d=>{const g=this._modelDependencies[d][0].attributePath;return this.getViewModelAttributePaths(d,g)}).flat().forEach(d=>{u[d]={value:a,displayValue:s}}),this.setValue(u,{silent:!0,preventAttributeChangeRequest:!0,preventRunBusinessRules:!1,preventStateChange:!0})}));this._subscriptions.add(e.subscribe())}_getDataSchemas(){if(this.models&&this.models.length!==0){const e=this.models.map(t=>t.getSchema().pipe((0,o.map)(s=>[t.name,s])));return(0,l.combineLatest)(e).pipe((0,o.take)(1),(0,o.map)(t=>Object.fromEntries(t)))}return(0,l.of)({})}_setAttributesDefaultValues(e){var t=this;return(0,l.from)((0,C.A)(function*(){let s=Object.entries(t.dataSchemas);e&&(s=s.filter(([r])=>r===e));for(const[r,n]of s){const a={};for(const u of n.attributes){const d=yield(0,l.lastValueFrom)(u.defaultValue,{defaultValue:null});if(!(0,D.isNil)(d)){const h=t.getViewModelAttributePath(r,u.name);h&&(a[h]=d)}}t.setValue(a).subscribe()}})())}_generateDataSourcesInfo(){return this._dataSourcesInfos=ct.getFromViewModelConfig(this.viewModelConfig,this.models),(0,l.of)(this._dataSourcesInfos)}_generateAttributesToDataSourceNameMap(e){const t=Array.from(e.values()).map(s=>this._getDataSourceAttributesMap(s)).flat();return this._initializeAttributesToDataSourceNameMap(t),(0,l.of)(this._attributesToDataSourceNameMap)}_initializeAttributesToDataSourceNameMap(e){this._attributesToDataSourceNameMap=new Map(e)}_getDataSourceAttributesMap(e){const s=e.getMappedAttributes().map(r=>[r,e.name]);return e.isCollection&&s.push([e.collectionViewModelAttributeName,e.name]),s}_getDataSourceLoadType(e){return e?e||le.Reload:null}_getLoadTypeForDataSource(e,t){if(t===le.Load)return t;const s=e.getPagingConfig();return!t&&s?le.LoadNext:t}_loadDefaultSorting(e){this._measurePerformanceService.measure(`ViewModel._loadDefaultSorting.${this._injectionContext?.id}.parent.${!!this.parent}.dsNames.${e?.toString()}`,()=>{const t=Array.from(this._dataSourcesInfos.entries()).filter(([s])=>!e?.length||e.includes(s)).map(([,s])=>s.getSortingConfig()).filter(s=>!!s?.default).reduce((s,r)=>(s[r.attributeName]=r.default,s),{});this.setValue(t,{silent:!0}).subscribe()})}_getDropdownPageSize(){var e=this;return(0,C.A)(function*(){if(!(0,D.isEmpty)(e._dropdownPageSize))return e._dropdownPageSize;const t=yield e.sysSettingsService.getByCode(e._dropdownPageSizeSettingsCode);return e._dropdownPageSize={pagingConfig:{rowCount:t?.value,rowsOffset:0}},e._dropdownPageSize})()}_mergeCollectionModels(e,t){this._measurePerformanceService.measure(`ViewModel.mergeCollectionModels.${this._injectionContext?.id}.parent.${!!this.parent}.collection.${e}`,()=>{const s=this.attributes[e];this._featureValues.DisableBaseViewModelCollectionOptimization||s.length?s.merge(t):s.push(...t)})}_getEmbeddedModels(){const e=Object.entries(this.viewModelConfig?.attributes??{}).filter(([,r])=>r&&"embeddedModel"in r&&r.embeddedModel).map(([r,n])=>({attributeName:r,embeddedModel:n.embeddedModel}));if(e.length===0)return(0,l.of)([]);const t={},s=[];if(e.forEach(({attributeName:r,embeddedModel:{name:n,config:a}})=>{n?t[n]&&s.push(`Duplicated embedded model : ${n}.`):s.push(`Embedded model name is not provided for ${r}.`),t[n]=a}),s.length>0)throw new Error(s.join(" "));return this._modelGenerator.generate({dataSources:t},this.injector)}_concatModelsWithEmbedded(e=null){return this._getEmbeddedModels().pipe((0,o.map)(t=>{const s=[...e??[],...t??[]],r=s.map(n=>n.name).filter((n,a,u)=>u.indexOf(n)!==a);if(r.length>0)throw new Error(`Duplicated model names found : ${r.join(",")}.`);return s}))}_updateModelsMap(){const e=this.models.map(t=>[t.name,t]);this._modelsMap=new Map(e)}_subscribeModelsChanges(){this._subscriptions.add(this._models$.subscribe(()=>this._updateModelsMap()))}_subscribeModelsEvents(){this._isDesignTime||this.models.forEach(e=>this._subscribeModelEvents(e))}_subscribeModelEvents(e){this._subscriptions.add(e.event$.pipe((0,o.mergeMap)(t=>this._waitDataDelay(t)),(0,o.mergeMap)(t=>this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.HandleModelEventRequest",$context:this,scopes:this._eventScopes,modelName:e.name,modelEvent:t})),1)).subscribe())}_upsertModel(e,t){const s=[...this.models],r=s.findIndex(({name:n})=>n===e);r===-1?s.push(t):s.splice(r,1,t).forEach(n=>n.destroy()),this._subscribeModelEvents(t),this._models$.next(s)}_replaceDataSourceInfo(e,t){!e||!t||(this._loadedDataSources.has(e)&&this._loadedDataSources.delete(e),this._dataSourcesInfos.set(e,t),this._replaceAttributesToDataSourceNameMap(t))}_updateModels(e){e.forEach((t,s)=>{const r=this.getModelByName(s);r&&(this._markModelAsCollection(r,t),this._updateModelDependentAttributes(r,t))})}_markModelAsCollection(e,t){t.isCollection&&(e._isCollection=!0)}_setModalLoadParameters(e){this._modelsNamesWithParameters.add(e),this._modelLoadParametersSetted$.next()}_updateModelDependentAttributes(e,t){const s=t.attributes.map(r=>({path:r.path,type:r.type}));e.updateDependentAttributes(s)}_initIsChangedAttribute(){this._systemAttributes.push(fn),this.attributes[fn]=!1;const e=this._models$.pipe((0,o.switchMap)(t=>t?.length?(0,l.combineLatest)(t.map(s=>s._dirty$)):(0,l.of)([])),(0,o.map)(t=>t.some(s=>s)),(0,o.filter)(()=>!this._viewModelAttributeChangeEventOptions.getOptions().preventStateChange),(0,o.distinctUntilChanged)()).subscribe(t=>{this._setSystemAttributeValue(fn,t)});this._subscriptions.add(e)}_initHasUnsavedDataAttribute(){this._systemAttributes.push(Mi),this.attributes[Mi]=!1;const e=this.events$.pipe((0,o.filter)(a=>a?.type===me.ChangeAttributeValue&&a.payload?.attributeName===fn),(0,o.map)(a=>a.payload.value)),t=(0,l.merge)(this.IsChanged,e),r=this._models$.pipe((0,o.map)(a=>a.map(u=>u._modeChanges$.pipe((0,o.map)(d=>({mode:d,name:u.name})),(0,o.startWith)({mode:u.mode,name:u.name})))),(0,o.switchMap)(a=>a?.length?(0,l.combineLatest)(a):(0,l.of)([]))).pipe((0,o.map)(a=>a.some(({mode:u,name:d})=>{const h=!this._isDesignTime&&!this._featureValues.DisableMultipleDataSources&&!this._isPrimaryModel(d)&&this._isIndependentRootModel(this.getModelByName(d)),g=this._isOneToManyRootModelRelation(d);return(u===T.Create||u===T.Copy)&&!g&&!h}))),n=(0,l.combineLatest)([t,r]).pipe((0,o.map)(([a,u])=>!!(a||u)),(0,o.distinctUntilChanged)()).subscribe(a=>{this._setSystemAttributeValue(Mi,a)});this._subscriptions.add(n)}_initPrimaryModelModeAttribute(){const e=this._getPrimaryModelModeChanges();if(!e)return;this._systemAttributes.push(fc),this.attributes[fc]=this.getPrimaryModelMode();const t=e.pipe((0,o.startWith)(this.getPrimaryModelMode())).subscribe(s=>this._setSystemAttributeValue(fc,s));this._subscriptions.add(t)}_initStateAttribute(){this._systemAttributes.push(Ii),this.attributes[Ii]=_c.Active}_initBusinessRulesActivatedAttribute(){if(this._systemAttributes.push(gc),this.attributes[gc]=this._businessRulesAreActivated,this._businessRulesAreActivated)return;const e=this._businessRulesActivated$.pipe((0,o.filter)(t=>t===!0)).subscribe(t=>{this._setSystemAttributeValue(gc,t)});this._subscriptions.add(e)}_initSystemAttributes(){var e=this;return(0,C.A)(function*(){yield e._measurePerformanceService.measureCallback(`ViewModel.initSystemAttributes.${e._injectionContext?.id}.parent.${!!e.parent}`,()=>(e._initIsChangedAttribute(),e._initPrimaryModelModeAttribute(),e._initHasUnsavedDataAttribute(),e._featureValues.DisableDelayingModelEvents||e._initStateAttribute(),e._initBusinessRulesActivatedAttribute(),Promise.resolve()))})()}_handleCircularDependencies(){const e=Bp(this._modelDependencies);if(e.hasCycles){const t=this._translateService.instant("BaseViewModel.WarningModelsWithCircularDependencies");this._showNotification({message:t,duration:1e4}),console.warn(t,e.cycledModelsNames)}this._conflictedModels=e?.cycledModelsNames}_forEachControl(e,t){Object.keys(e).forEach(r=>{if(this.attributes[r]instanceof ot){const n=this.attributes[r],a=e[r];n.forEach(u=>{const d=u.primaryAttributeName,h=u.attributes[d],g=a.find(b=>b[d]===h);g&&u._forEachControl(g,t)})}else if(this.attributes[r]instanceof wt)this.attributes[r]._forEachControl(e[r],t);else{const n=this.getControl(r);t(n.formControl)}})}_getModelsErrors(e){return(e??[]).filter(t=>!t.isCollectionItemModel&&t.hasErrors).map(t=>t.getLastError())}_notifyAboutModelsErrors(e){const t=this._getModelsErrors(e);if(t.length>0){const s=t.map(r=>r.message).join(" ");this._showNotification({message:s})}}_initFeaturesStates(){this._disableViewModelWaitingForAsyncTasks=this._featureValues.DisableViewModelWaitingForAsyncTasks,this._disableViewModelLoadUnblockingThread=this._featureValues.DisableViewModelLoadUnblockingThread,this._blockFieldsAffectedByBusinessRules=this._featureValues.BlockFieldsWhileRunBusinessRules,this._modelSynchronizationEnabled=!this._featureValues.ModelSynchronizationDisabled}_handleAsyncTasksCycle(e){let t=null;const s=100,r=Array.from(e).filter(n=>n.startsWith(at.ProcessingAttributeChangeRequest));if(!(!e.size||!r.length))return r.length&&(t=setTimeout(()=>{console.warn("[ViewModel]: Clearing executing tasks by exceeded timeout",r),r.forEach(n=>e.delete(n)),this._asyncTasksExecutingSubject.next(e)},s)),t}_getAffectedViewModelAttributes(e,t){return this.models.filter(r=>r.dataSchemaName===e).map(r=>r.name).flatMap(r=>this.getViewModelAttributePaths(r,t))}_toggleControlsAffectedByBusinessRules(e,t){if(!this._blockFieldsAffectedByBusinessRules)return;this._attributesAffectedByBusinessRules?.filter(r=>Uh(this._scopeName,r,t))?.forEach(r=>{r.scopeName===this._scopeName?this.getControl(r.name).toggle(e):this._getAffectedViewModelAttributes(r.scopeName,r.name).forEach(a=>{this.getControl(a).toggle(e)})})}_initAttributesAffectedByBusinessRules(){var e=this;return(0,C.A)(function*(){const s=e._prepareDataSourceNamesForBusinessRules().filter(n=>!!n).map(n=>e.getModelByName(n)).map(n=>({scopeId:n.name,scopeName:n.dataSchemaName,scopeType:Oe.Model,modelType:n.getDataSource()?.type})),r={scopeName:e._scopeName,scopeType:Oe.ViewModel,scopeId:e._scopeName};e._attributesAffectedByBusinessRules=yield e._businessRulesEngine.getAffectedAttributes([r,...s])})()}_initBusinessRules(){var e=this;return this._measurePerformanceService.measureCallback(`ViewModel.initBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`,(0,C.A)(function*(){e._businessRulesProcessingEnabled=!e._featureValues.BusinessRulesProcessingDisabled&&e.viewModelConfig.supportBusinessRules!==!1,e._businessRulesProcessingEnabled&&(yield e._initAttributesAffectedByBusinessRules()),e._businessRulesAreActivated=e._businessRulesProcessingEnabled&&e._businessRulesActive!==!1,e._businessRulesActivated$.next(e._businessRulesAreActivated)}))}_attributeGenerate$(e,t){return(0,l.of)(this._featureValues.UseDesignerHotSwapViewModel).pipe((0,o.switchMap)(s=>s&&this._isDesignTime?this._initDataSourceValidators().pipe((0,o.tap)(()=>{this._initSchemaValidators(e)}),(0,o.switchMap)(()=>this._attributeGenerate(e,t))):this._attributeGenerate(e,t)))}_validateByDataSourceName(e){var t=this;return(0,C.A)(function*(){const s={},r=t._getBoundDataSourceAttributeControls(e);return yield Promise.all(Object.entries(r).map(([n,a])=>(a.markAsTouched(),a.updateValueAndValidity(),(0,l.lastValueFrom)(Wu(a).pipe((0,o.tap)(()=>{a.errors&&(s[n]=a.errors)})))))),s})()}_validateAll(){var e=this;return(0,C.A)(function*(){const t={};return e.formApiModel.markAllAsTouched(),e.formApiModel.updateValueAndValidity(),Gu(e.formApiModel),yield(0,l.lastValueFrom)(Wu(e.formApiModel).pipe((0,o.tap)(()=>{Object.entries(e.formApiModel.controls).forEach(([r,n])=>{n.errors&&(t[r]=n.errors)})}))),t})()}_getDependentModelsNamesOnRelationAttributeName(e){const t=this.getBoundDataSourceNameByAttributePath(e),r=this._dataSourcesInfos.get(t)?.attributesMap.get(e);return this._getDependentModelsNames(t,[r])}_setAttributeValue(e,t,s){this._executeWithOptions(()=>this[e]=t,s)}_subscribeOnChangeAttributesToHandleModelDependenciesConstrains(){if(this._isDesignTime)return;const e=this.events$.pipe((0,o.filter)(t=>t.type===me.ChangeAttributeValue),(0,o.filter)(t=>this._isAttributeChange(t.payload)),(0,o.tap)(t=>{const s=t;!s?.payload?.value&&s.payload?.attributeName&&this._clearValuesForManyToOne(s.payload.attributeName)}));this._subscriptions.add(e.subscribe())}_clearValuesForManyToOne(e){this._getDependentModelsNamesOnRelationAttributeName(e).forEach(s=>{this._isManyToOneRootModelRelation(s)&&this._clearModelValues(s)})}_clearModelValues(e){const t=this._dataSourcesInfos.get(e),s=t?.isCollection?[]:t.getMappedAttributes();if(s.length){const r=s.reduce((n,a)=>({...n,[a]:null}),{});this.setValue(r).subscribe(()=>{this._markAsPristine(r),this._markAsUntouched(r)})}}_markAsUntouched(e){this._forEachControl(e,t=>{t.markAsUntouched()})}_setSingleSubmodelValue(e,t,s){return this.attributes[e].setValue(t[e],{silent:s?.silent,isMaskedValue:s?.isMaskedValue,preventAttributeChangeRequest:s?.preventAttributeChangeRequest,preventStateChange:s?.preventStateChange,preventRunBusinessRules:s?.preventRunBusinessRules})}_setCollectionSubmodelValue(e,t,s){const r=this._attributeConfigs[e],n=r.viewModelConfig||r.viewModelName,a=!this._featureValues.DisableDataGridEditingMode,u=(t[e]||[]).map(d=>{const h=this.getBoundDataSourceName(e),b=this._getDataSourceInfoByViewModelAttributePath(e)?.isCollection&&this.getModelByName(h)?.createCollectionItemModel(T.Update);return this.viewModelGenerator.generate({viewModelConfig:n,modelConfig:a&&b?{primaryDataSourceName:b.name}:void 0,models:a&&b?[b]:void 0,parentViewModel:this,businessRulesActive:!1},c.Injector.create({providers:[{provide:mi,useValue:null}],parent:this.injector})).pipe(this._measurePerformanceService.measure$(`ViewModel.setValue.generateViewModel.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${b?.name}`),(0,o.tap)(M=>{h&&(M.dataSchemas[h]=this.dataSchemas[h])}),(0,o.tap)(M=>{M.deactivateBusinessRules()}),(0,o.switchMap)(M=>M.setValue(d,{silent:s?.silent,isMaskedValue:s?.isMaskedValue,preventAttributeChangeRequest:s?.preventAttributeChangeRequest,preventStateChange:s?.preventStateChange,preventRunBusinessRules:s?.preventRunBusinessRules}).pipe((0,o.tap)(()=>b&&b.setLoadedState()),(0,o.map)(()=>M))))});return!u.length&&s?.collectionLoadType===Xs.Reload&&this.attributes[e].clear(),u.length===0?(0,l.of)(null):(0,l.forkJoin)([...u]).pipe((0,o.tap)(d=>{const h=this.getBoundDataSourceName(e);this.getModelByName(h)?.childrenChange(),this._executeWithOptions(()=>{s?.collectionLoadType===Xs.Reload||!s?.collectionLoadType?this.attributes[e].reload(d):this.getBoundDataSchema(e)?this._mergeCollectionModels(e,d):this.attributes[e].push(...d)},s)}))}_setSubmodelValues(e,t,s){return(0,l.forkJoin)([...e.filter(r=>t?.[r]).map(r=>this.attributes[r]instanceof wt?this._setSingleSubmodelValue(r,t,s):this._setCollectionSubmodelValue(r,t,s)),(0,l.of)(this)])}_findAttributePathInDataSourceNameMap(e){for(const t of this._attributesToDataSourceNameMap.keys()){const s=t.indexOf(".");if(s<0)continue;const r=s+1,n=e.length;if(t.startsWith(e,r)&&(t.length===r+n||t.charAt(r+n)==="."))return t}}_getBoundDataSourceAttributeControls(e){return Object.fromEntries(Array.from(this._attributesToDataSourceNameMap.entries()).filter(([t,s])=>s===e).map(([t])=>[t,this.getAttributeControl(t)]))}_resetMaskDataForAttribute(e){this[fl](e)&&(this.setAttributePropertyValue(e,rn,null),this.setAttributePropertyValue(e,_i,null),this.setAttributePropertyValue(e,yi,null))}showLoadMaskAndValidateFields(e){this.maskService.showMask(this.saveModelTaskName,this);const t=this._getBoundDataSourceAttributeControls(e);Object.keys(t).forEach(s=>this.formApiModel.controls[s].updateValueAndValidity())}deleteModel(e,t,s,r){return(0,l.from)(this._modelParametersBuilder.getModelParameters(this,t,r?.payload)).pipe((0,o.switchMap)(n=>s(e,n)))}handleSaveModelStream(e,t){return e.pipe((0,o.finalize)(()=>this.maskService.hideMask(this.saveModelTaskName,this)),(0,o.catchError)(s=>{const r=typeof s=="string"?s:s?.message||s?.errorInfo;return t?.silent===!0?(0,l.of)({success:!1,rowsAffected:0,errorInfo:r}):(0,l.throwError)(()=>new Error(r))}))}_updateLastLoadParameters(e,t,s,r){const n=t===T.Create||t===T.Copy,a=this.dataSchemas[e],u=a.dataSourceConfig?.type===Si.EntityDataSource;if(r.success&&n&&u){const d=a.primaryAttributeName,h=s[d];this._loadedDataSources.add(e),this._lastEventLoadParameters.set(e,[{type:F.PrimaryColumnValue,value:h}])}}getSaveParameters(e,t){return(0,l.forkJoin)({parameters:this._modelParametersBuilder.getModelParameters(this,t),dto:this._getDataSourceDto(e)})}getSaveModelStream$(e){return this.showLoadMaskAndValidateFields(e.dataSourceName),(0,l.from)(this.isValid(e.dataSourceName)).pipe((0,o.switchMap)(t=>{if(!t){const s=this.injector.get(O.TranslateService);return e.getInvalidAction({success:!1,rowsAffected:0,errorInfo:s.instant("HomePage.DialogMessages.RequiredFieldsAreNotFilled")})}return this.getSaveParameters(e.dataSourceName,e.parametersConfig).pipe((0,o.mergeMap)(({parameters:s,dto:r})=>(0,l.forkJoin)({result:e.saveAction(r,s),dto:(0,l.of)(r)})),(0,o.tap)(({result:s,dto:r})=>e.onSavedAction(r,s)),(0,o.map)(({result:s})=>s))}))}_checkDataSourceName(e){if(!e)throw new Error("Data source name is not provided")}innerSave(e,t,s){return(0,l.from)(this.waitAsyncTasksFinish()).pipe((0,o.switchMap)(()=>(this._checkDataSourceName(s),this.getModelMode(s)===T.Delete?t():e())))}initDependencies(){this.formBuilder=this.injector.get(xe.FormBuilder),this.resourceFinderService=this.injector.get(Ts),this.validatorTypeResolver=this.injector.get(fi),this.maskService=this.injector.get(kp),this.sysSettingsService=this.injector.get(ve),this.crtControlStateAdapter=this.injector.get(Gt),this._businessRulesEngine=this.injector.get(ws),this._businessRulesApplier=this.injector.get(Es),this._featureValues=this.injector.get(E),this._modelGenerator=this.injector.get(qr),this._ngZone=this.injector.get(c.NgZone),this._translateService=this.injector.get(O.TranslateService),this._scopeName=this.injector.get(mi,null),this._attributeGenerator=this.injector.get(pn),this._attributeResourceGenerator=this.injector.get(mn),this._crtZoneService=this.injector.get(pc),this._viewEventZoneName=this.injector.get(cl,Et.Root),this._modelParametersBuilder=this.injector.get(gn),this._context=this.injector.get(dp,null),this._crtInjectionContextService=this.injector.get(Qs),this._viewModelDataDelayerService=this.injector.get(Gp,null),this._isDesignTime=this.injector.get(Up,null),this._measurePerformanceService=this.injector.get(ge,null),this._measurePerformancePageLoadService=this.injector.get(dn),this._appInfo=this.injector.get(Te,null)}processRequest(e){return this.handlerChain.process(e)}runInitFlow(e=null){return this._concatModelsWithEmbedded(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitFlow.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,o.tap)(t=>this._notifyAboutModelsErrors(t)),(0,o.tap)(t=>this._models$.next(t)),(0,o.tap)(()=>this._initFeaturesStates()),(0,o.mergeMap)(()=>this._generateDataSourcesInfo()),(0,o.tap)(t=>this._updateModels(t)),(0,o.mergeMap)(t=>this._generateAttributesToDataSourceNameMap(t)),(0,o.mergeMap)(t=>this._getDataSchemas()),(0,o.tap)(t=>this.dataSchemas=t),(0,o.mergeMap)(()=>this._initDataSourceValidators()),(0,o.switchMap)(()=>this._initBusinessRules()),(0,o.tap)(()=>{this._initSchemaValidators(this.viewModelConfig.attributes)}),(0,o.mergeMap)(()=>(0,l.forkJoin)([...this._generateResourceAttribute(),this._initSystemAttributes(),this._attributeGenerate(this.viewModelConfig.attributes),(0,l.of)(this),this._initSubscriptions()])),(0,o.mergeMap)(()=>this._generatePrimaryAttributes()),(0,o.tap)(()=>this._loadDefaultSorting()),(0,o.mergeMap)(()=>this._runInitialBusinessRules()),(0,o.tap)(()=>this._viewModelAttributeChangeEventOptions.reset())).pipe((0,o.switchMap)(()=>(0,l.of)(this)))}[fl](e){return this._attributeConfigs[e]?.isValueMasked??!1}[Ap](e){return this.getAttributePropertyValue(e,_i)}[vp](e){return this.getAttributePropertyValue(e,yi)}[Ep](e,t){this.setAttributePropertyValue(e,rn,t)}[Mp](e){return this.getAttributePropertyValue(e,rn)||nn.Unmasked}init(e,t){return this._primaryModelName=t?.primaryModelName,this._modelDependencies=t?.modelDependencies||{},this._modelsLoadingConfig=t?.modelsLoadingConfig||{},this._lastEventLoadParameters=new Map,t?.businessRulesActive||this.deactivateBusinessRules(),this._modelDependencies&&this._handleCircularDependencies(),this._ngZone.runOutsideAngular(()=>this.runInitFlow(e))}setValue(e,t){const s=[],r=[];for(const n of Object.keys(this._attributeConfigs))"viewModelConfig"in this._attributeConfigs[n]||"viewModelName"in this._attributeConfigs[n]?r.push(n):s.push(n);return this._executeWithOptions(()=>{this._measurePerformanceService.measure(`ViewModel.setValue.updateViewModelModelAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.data.${Object.keys(e).toString()}`,()=>{for(const n in e)s.includes(n)&&(this._resetMaskDataForAttribute(n),this.set(n,e[n],{isMaskedValue:t?.isMaskedValue}))})},t),Hs.deferUpdatingValueAndValidity(this,()=>this._setSubmodelValues(r,e,t),this._featureValues)}deactivateBusinessRules(){this._businessRulesActive=!1}activateBusinessRules(){const e=this._businessRulesActive;if(this._businessRulesActive=!0,e)return(0,l.of)(null);const t=this.models.filter(s=>s.isLoaded);if(t.length>0){const s={type:oe.ContextReady,name:null,scopeId:""};return(0,l.forkJoin)(t.map(r=>this._runBusinessRulesForModel(r,[],!0,[s]))).pipe((0,o.tap)(()=>this._businessRulesAreActivated=this._businessRulesProcessingEnabled),(0,o.tap)(()=>this._businessRulesActivated$.next(this._businessRulesAreActivated)))}}_getDependOnModelsNames(e){const t=this._modelDependencies[e];if(!t)return[];const s=t.map(r=>r.relationPath.split(".")[0]);return[...new Set(s)]}_getModelDependencies(e){return this._modelDependencies[e]??[]}_getIsAffectedByBusinessRules(e){if(!this._businessRulesProcessingEnabled)return Promise.resolve(!1);const t=e.name,s=this._attributesAffectedByBusinessRules;if(s.length===0||!t)return Promise.resolve(!1);const r=s.some(d=>d.name===t),n=this.getBoundDataSchemaByAttributePath(t),a=this.getBoundDataSchemaAttributeByAttributePath(t);if(!a)return Promise.resolve(r);const u=s.filter(d=>d.scopeName===n.name).some(d=>d.name===a.name);return Promise.resolve(u||r)}executeRequest(e){return e.scopes=e.scopes||this._eventScopes,this._crtZoneService.runInZone(this._viewEventZoneName,()=>this.processRequest(e))}getAttributeControl(e){let t=this.formApiModel;Wp(this,e).then(D.noop);for(const s of e.split("."))t=t.get(s);return t??new xe.FormControl}loadLookupList(e,t=[],s){const r=e.control,n=e.items,a=this._getDataSourceInfoByViewModelAttributePath(n);if(a){const u=this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.LoadDataRequest",$context:this,dataSourceName:a.name,parameters:t,config:{payload:s}}));Promise.resolve(u)}else{const u=this._getDataSourceInfoByViewModelAttributePath(r);if(u){const d=u.getDataSourceAttributePath(r);(0,l.forkJoin)([this._getDropdownPageSize(),this._modelParametersBuilder.getModelParameters(this,t,s)]).pipe((0,o.mergeMap)(([h,g])=>this.getModelByName(u.name).loadLookupList(d,g,h)),(0,o.map)(h=>ct.getLookupListDataSourceInfo(n,{value:h.primaryAttributeName,displayValue:h.primaryDisplayAttributeName}).getModelDto(h.data)),(0,o.mergeMap)(h=>this.setValue(h,{silent:!0}))).subscribe()}}}load(...e){const t=this._disableViewModelLoadUnblockingThread?(0,l.of)(null):(0,l.timer)(0,l.asyncScheduler);if(typeof e[0]=="string"){const r=e[0],n=e[1],a=e[2];this._checkDataSourceName(r);const u=this._getDataSourceLoadType(a?.loadType);return t.pipe((0,o.switchMap)(()=>this._loadStaticModel(r,n,u,a?.payload,a?.useLastLoadParameters,a?.doNotUpdateLastLoadParameters).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${r}`))))}const s=e[0];return t.pipe((0,o.switchMap)(()=>this._loadDynamicModel(s).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.model.${s.dataSourceName}`))))}setSorting(e,t){const r=this._dataSourcesInfos.get(e).getSortingConfig(),n=r&&r.attributeName;return n&&(this[n]=t),(0,l.of)(null)}create(e,t){return this._checkDataSourceName(e),this._createModelData(e,t)}copy(e,t,s){return this._checkDataSourceName(e),this._copyModelData(e,t,s)}loadDefaultValues(e){return this._setAttributesDefaultValues(e)}save(e,t,s){return this.innerSave(()=>this._saveModel(e,t,s),()=>this.delete(e,t,s),e)}delete(e,t,s){return this._checkDataSourceName(e),this.deleteModel(e,t,(r,n)=>this.getModelByName(r).delete(n),s)}resume(){return(0,l.of)(void 0)}pause(){return(0,l.of)(void 0)}destroy(){this._subscriptions.unsubscribe(),Array.from(this._collectionSubscription.values()).forEach(t=>t.unsubscribe()),this._collectionSubscription.clear(),this._crtControls.forEach(t=>{t.destroy()}),this.models?.forEach(t=>t.destroy()),this._crtControls.clear(),this._eventsSubject$.complete(),this._replayEvents$.complete(),this._modelLoaded$.complete();const e=[];for(const t of Object.values(this.attributes))t instanceof wt&&e.push(t.destroy()),t instanceof ot&&e.push((0,l.from)(t.destroy()));return(0,l.forkJoin)(e).pipe((0,o.defaultIfEmpty)(void 0),(0,o.map)(()=>{}),(0,o.finalize)(()=>{this.parent||(this._crtInjectionContextService.removeContext(this._injectionContext?.id),Rn(this._injectionContext),this._context=null,this._viewModelDataDelayerService?.destroy(),this._viewModelDataDelayerService=null),this._asyncTasksExecutingSubject.complete(),this._dataSourcesInfos.clear(),this.__destroyed=!0,this._destroySubject.next(),this._destroySubject.complete()}))}getBoundDataSourceName(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(t!==null)return t;if(!e)return null;const s=this._findAttributePathInDataSourceNameMap(e);return this.getBoundDataSourceNameByAttributePath(s)}getBoundDataSourceAttributeControls(e){return Object.values(this._getBoundDataSourceAttributeControls(e))}getBoundDataSourceNameByAttributePath(e){return this._attributesToDataSourceNameMap.get(e)??null}getBoundDataSchema(e){return this.dataSchemas[this.getBoundDataSourceName(e)]}getBoundDataSchemaByAttributePath(e){return this.dataSchemas[this.getBoundDataSourceNameByAttributePath(e)]??null}getBoundDataSchemaAttributeByAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e),s=this.getBoundDataSchemaByAttributePath(e);if(!t||!s)return null;const n=this._getDataSourceInfoByViewModelAttributePath(e).getDataSourceAttributePath(e);return s.findAttributeByName(n)}getPrimaryModelName(){return Promise.resolve(this._primaryModelName)}getPrimaryDataSchema(){return this.getPrimaryModelName().then(e=>this.dataSchemas[e])}isValid(e){const t=this._waitAsyncValidation().pipe((0,o.map)(()=>e?this.getBoundDataSourceAttributeControls(e).every(s=>!s.invalid):this.formApiModel.valid));return(0,l.lastValueFrom)(t)}validate(e){return this._ngZone.run(()=>e?this._validateByDataSourceName(e):this._validateAll())}getViewModelAttributePath(e,t){const s=this._dataSourcesInfos.get(e);return this._getMappedAttributeName(s,t)}getViewModelAttributePaths(e,t){return this._dataSourcesInfos.get(e)?.getMappedAttributeNames(t)}getCollectionViewModelAttributePath(e){return this._dataSourcesInfos.get(e)?.collectionViewModelAttributeName}canDelete(e,t){var s=this;return(0,C.A)(function*(){return s.getModelByName(e).canDelete(t)})()}canSave(e,t){var s=this;return(0,C.A)(function*(){return s.getModelByName(e).canSave(t)})()}enableAttributeValidator(e,t){this.getControl(e).enableValidator(t)}disableAttributeValidator(e,t){this.getControl(e).disableValidator(t)}_hotSwap(e){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap`,()=>{const t=e?.attributes?.changed||[],s=(0,D.isEmpty)(e.resources?.strings);if((0,D.isEmpty)(t)&&s)return(0,l.of)(!1);s||(this.resources={strings:this._getChangedResourcesStrings(e.resources.strings)}),this.viewModelConfig=e.actualViewModelConfig;const r=ct.getFromViewModelConfig(this.viewModelConfig),n=Object.fromEntries(t.map(b=>[b,this.viewModelConfig.attributes[b]])),a=e?.models?.changed??[],u=a.map(b=>b.name),d=this.models.filter(b=>b.isLoaded||b.isLoading).filter(b=>u.includes(b.name)).map(b=>b.name),h=a.map(b=>{const M=r.get(b.name);return this._upsertModel(b.name,b),this._replaceDataSourceInfo(b.name,M),this._addDataSchemaToDataSchemas(b)}),g=this._attributeGenerate$(n,{disableDefaultConfig:!0});return(0,l.forkJoin)([...h,g]).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap.forkJoin`),(0,o.switchMap)(()=>this._reGenerateResourcesAttributes()),(0,o.tap)(()=>this._loadDefaultSorting(u)),(0,o.tap)(()=>this._requestReloadModels(d)),(0,o.map)(()=>!0))})}set(e,t,s){return this._setAttributeValue(e,t,s),Promise.resolve()}_markAsPristine(e){this._forEachControl(e,t=>{t.markAsPristine()})}getAttributeNameByViewItemName(e){return Object.keys(this._attributeConfigs).find(t=>this._attributeConfigs[t].viewItemName===e)}getControl(e){return this._crtControls.has(e)?this._crtControls.get(e):Ei.create({name:e,value:null,propertiesConfig:[],featureValues:this._featureValues})}getAttributePropertyValue(...e){let t,s;if(e.length===2)t=e[0],s=e[1];else if(e.length===1){const n=e[0].split(":");t=n[0],s=n[1]}else throw new Error("ArgumentException");return this.getControl(t).getPropertyValue(s)}setAttributePropertyValue(...e){let t,s,r;if(e.length===3)t=e[0],s=e[1],r=e[2];else if(e.length===2){const a=e[0].split(":");t=a[0],s=a[1],r=e[1]}else throw new Error("ArgumentException");return this.getControl(t).setPropertyValue(s,r)}resetAttributePropertyValue(...e){let t,s;if(e.length===1)[t,s]=e[0].split(":");else if(e.length===2)t=e[0],s=e[1];else throw new Error("ArgumentException");this.getControl(t).getPropertyByName(s)?.resetValue()}getInvariabilityPropertyName(e){return this.getControl(e).getInvariabilityPropertyName()}setModelValues(e,t){return this.getModelByName(e).setValue(t)}_getBoundAttributesNames(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(!t)return null;const s=this._dataSourcesInfos.get(t),r=s.attributesMap.get(e);return Array.from(s.attributesMap.entries()).filter(([n,a])=>a===r&&n!==e).map(([n])=>n)}_getAttributeDataValueTypeName(e){return this._attributeConfigs[e].dataValueTypeName}getDataSourceLoadParameters(e,t){const s=this._dataSourcesInfos.get(e);return s?this._modelParametersBuilder.getModelLoadParameters(this,s,[],le.Load,{modelLoadConfiguration:t}).then(([r,n,a])=>({parameters:r,options:{pagingConfig:n,sortingConfig:a}})):null}getAttributeViewModelConfig(e){return this._attributeConfigs[e]?.viewModelConfig?.attributes}isDataSourceForCollection(e){return!!this._dataSourcesInfos.get(e)?.isCollection}_getDataSourceAttributeDataValueType(e){const t=this._getDataSourceInfoByViewModelAttributePath(e);let s=null;if(t){const r=t.getDataSourceAttributePath(e);r&&(s=this._getDataSourceAttributeSchema(t,r)?.dataValueType)}return s}_getModelNamesByLoadType(e){return Object.entries(this._modelsLoadingConfig).filter(([t,s])=>s.type===e).map(([t,s])=>t)}_reloadDependentModels(e,t=[],s=null){const r=this._getDependentModelsForLoad(e,t);this._requestReloadModels(r.filter(n=>{const a=Kt(this.getModelByName(n));return!s||a&&s===De.Page||!a&&s===De.ViewElement}))}_getDependentModelsForLoad(e,t=[]){const s=this._getDependentModelsNames(e.name,t),r=this._getChangedModelsNames(s).filter(n=>!Kt(this.getModelByName(n)));return r.length!==0&&this._showNotification({message:"BaseViewModel.RefreshModelDataConflict"}),s.filter(n=>!r.includes(n)).filter(n=>this._modelsRequestedToLoad.has(n)||Kt(this.getModelByName(n)))}_getDataSourceAttributeCaption(e,t){let s=this.resourceFinderService.findLocalizableValue(t);const r=this._getDataSourceInfoByViewModelAttributePath(e);if(s==null&&r){const n=r.getDataSourceAttributePath(e),a=n?this._getDataSourceAttributeSchema(r,n):"";s=a?a.caption:this._translateService.instant("BaseViewModel.DataSourceAttributeRemoved")}return s}getIsDirty(e){return this.getControl(e).isDirty}getModelByName(e){return this._modelsMap.get(e)}getModelMode(e){return this.getModelByName(e)?.mode}getPrimaryModelMode(){return this.getModelMode(this._primaryModelName)}_getModelModeChanges(e){return this.getModelByName(e)?._modeChanges$}_getPrimaryModelModeChanges(){return this._getModelModeChanges(this._primaryModelName)}markModelFor(e,t){this.getModelByName(e)?.markFor(t)}markPrimaryModelFor(e){this.markModelFor(this._primaryModelName,e)}_setStateAttribute(e){this._setSystemAttributeValue(Ii,e)}_onAsyncTaskStarted(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.add(e),this._asyncTasksExecutingSubject.next(t)}_onAsyncTaskFinished(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.delete(e),this._asyncTasksExecutingSubject.next(t)}waitAsyncTasksFinish(){let e;return(0,l.firstValueFrom)(this._asyncTasksExecutingSubject.pipe((0,o.tap)(t=>{clearTimeout(e),e=this._handleAsyncTasksCycle(t)}),(0,o.filter)(t=>t.size===0),(0,o.take)(1),(0,o.map)(()=>{})))}destroyModel(e){const t=this.getModelByName(e);t&&t.destroy();const s=this.models.filter(r=>r.name!==e);this._models$.next(s),this._dataSourcesInfos.delete(e),[...this._attributesToDataSourceNameMap.entries()].filter(([r,n])=>e===n).forEach(([r])=>this._attributesToDataSourceNameMap.delete(r))}}class Jp extends wt{_getTransactionalModelByName(e){const t=this.getModelByName(e);if(!(t instanceof Hn))throw new Error(`Model with name "${e}" is not a TransactionalModel.`);return t}_saveModelInTransaction(e,t,s,r){const n=this._getTransactionalModelByName(e),a=n.mode;return this.getSaveModelStream$({dataSourceName:e,parametersConfig:t,saveAction:(u,d)=>(0,l.of)(n.insertOrUpdateInTransaction(r,u,d)),onSavedAction:(u,d)=>{d.payload.dto=u,d.payload.modelMode=a},getInvalidAction:u=>(0,l.of)(r.createFailureOperation(u))})}saveInTransaction(e,t,s,r){return this.innerSave(()=>this._saveModelInTransaction(e,t,s,r),()=>this.deleteInTransaction(e,t,s,r),e)}deleteInTransaction(e,t,s,r){return this._checkDataSourceName(e),this.deleteModel(e,t,(n,a)=>{const u=this._getTransactionalModelByName(n);return(0,l.of)(u.deleteInTransaction(r,a))},s)}commitTransaction(e,t,s,r){const n=(0,l.from)(r.asyncResult).pipe((0,o.tap)(a=>{const u=r.payload.modelMode,d=r.payload.dto;this._updateLastLoadParameters(e,u,d,a)}));return this.handleSaveModelStream(n,s)}}class sr{constructor(e){this._featureValues=e,this.viewModelConstructor=null}_getViewModelConstructor(){return this.viewModelConstructor?this.viewModelConstructor:this._featureValues?.["DataSource-DisableTransactions"]?wt:Jp}static useClass(e){return new class extends sr{constructor(){super(...arguments),this.viewModelConstructor=e}}(null)}create(e,t,s,r,n,a,u,d){const h=this._getViewModelConstructor();return new h(e,t,s,r,n,a,u,d)}static#e=this.\u0275fac=function(t){return new(t||sr)(c.\u0275\u0275inject(E,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:sr,factory:sr.\u0275fac,providedIn:"root"})}class rr extends Zt{constructor(){super(...arguments),this._lifecycleHooksRequests={init:oc,resume:cc,pause:uc,destroy:lc},this.handlerChain=ce.instance}_processRequest(e,t,s){return this.ngZone.runOutsideAngular(()=>this.sendRequest({...e,scopes:s,$context:t}))}_processViewModelAttributeChanges(e,t){e.events$.pipe((0,o.filter)(s=>s.type===me.ChangeAttributeValue&&!s.payload?.preventAttributeChangeRequest)).subscribe({next:s=>{const r=`${at.ProcessingAttributeChangeRequest}-${(0,L.qv)()}`;e._onAsyncTaskStarted(r),this._processRequest(new ac(s.payload),e,t).then(()=>e._onAsyncTaskFinished(r))}})}_generateFromConfig(e,t){const s=t||this.injector,{viewModelConfig:r,modelConfig:n,resources:a,models:u,scopes:d,modelInitConfigs:h,modelConfig:{primaryDataSourceName:g}={},parentViewModel:b,businessRulesActive:M}=e,Z=this.viewModelFactory.create(this,s,this._trimEmptyAttributes(r),a,null,d,h,b);return this.generateLifecycleHooks(Z,e),this._processViewModelAttributeChanges(Z,d),Z.init(u,{modelDependencies:n?.dependencies,primaryModelName:g,modelsLoadingConfig:n?.loadingConfig,businessRulesActive:M})}_trimEmptyAttributes(e){const t=e?.attributes??{};return Object.keys(t).forEach(s=>{t[s]||delete t[s]}),{...e,attributes:t}}_generateFromString(e,t){return this.repository.resolveModelConfig(e.viewModelConfig).pipe((0,o.switchMap)(s=>this._generateFromConfig({...e,viewModelConfig:s},t)))}initDependencies(){super.initDependencies(),this.viewModelFactory=this.injector.get(sr)}generateLifecycleHooks(e,t){Object.entries(this._lifecycleHooksRequests).forEach(([s,r])=>{e[s]=new Proxy(e[s],{apply:(n,a,u)=>{const d=n.apply(a,u);if(!(d instanceof l.Observable))throw new Error(`Method ${s} should return Observable`);return d.pipe((0,o.switchMap)(h=>(0,l.from)(this._processRequest(new r,e,t.scopes)).pipe((0,l.map)(()=>h))))}})})}sendRequest(e){return this.handlerChain.process(e)}generate(e,t){const s=t?.get(ge);return typeof e.viewModelConfig=="string"?s?this._generateFromString(e,t).pipe(s.measure$("viewModelGenerator.generateFromString")):this._generateFromString(e,t):s?this._generateFromConfig(e,t).pipe(s.measure$("viewModelGenerator.generateFromConfig")):this._generateFromConfig(e,t)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(rr)))(s||rr)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:rr,factory:rr.\u0275fac,providedIn:"root"})}Op();let _n=class Cc{static#e=this.\u0275fac=function(t){return new(t||Cc)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Cc});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[St,gs,qr,Gt,Xr,{provide:Zt,useClass:rr},{provide:Wt,useClass:on},{provide:Ks,useClass:zs},Ue.vn,st,Ts,Rp,{provide:fi,useClass:cn},{provide:cl,useValue:Et.Root},{provide:ep,useValue:qa.instance},Ip,Us,qs,sp,ip],imports:[w.CommonModule,xe.ReactiveFormsModule,un,Qr,xs,O.TranslateModule]})};_n=(0,f.__decorate)([Ru({includes:[xs],requestHandlers:[Wa,Za,Ja,eo,to,so,ro,no,oo,co,uo,lo,ho],validators:[mo,fo,go,_o,yo,gi,bo,So,Co,Ao,vo]})],_n),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(_n,{imports:[w.CommonModule,xe.ReactiveFormsModule,un,Qr,xs,O.TranslateModule]})}();class nr{static#e=this.\u0275fac=function(t){return new(t||nr)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:nr});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Ct,Ue.vn,ft],imports:[Ss,_n,Wr]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(nr,{declarations:[Kr],imports:[Ss,_n,Wr]})})();class yn{_buildRequestUrl(e){return this._isAbsoluteUrl(e)?e:w.Location.joinWithSlash(this.getUrl(),e)}_isAbsoluteUrl(e){return/^https?:\/\//i.test(e)}getUrl(){return Dn()}intercept(e,t){return e=e.clone({url:this._buildRequestUrl(e.url)}),t.handle(e).pipe((0,o.catchError)(s=>(console.log(s),(0,l.throwError)(s))))}static#e=this.\u0275fac=function(t){return new(t||yn)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:yn,factory:yn.\u0275fac})}class ir extends yn{getUrl(){return ht()}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ir)))(s||ir)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ir,factory:ir.\u0275fac})}class bn extends O.TranslateLoader{constructor(e){super(),this._nestedTranslateLoader=e}_getDefaultTranslation(){return{ErrorListDialogService:{CodeErrorListDialogCaption:"Compilation errors",FileNameColumn:"File name",ErrorTextColumn:"Description",ErrorNumberColumn:"Code",LineColumn:"Line",CodeValidationErrorListDialogCaption:"Error while saving package dependencies",SourceColumn:"Source",ReferenceColumn:"Reference",PackageColumn:"Package",AcademyHelpUrlCaption:" Learn more in the Academy"},TableDialog:{Close:"Close"}}}_getRussianTranslation(){return{ErrorListDialogService:{CodeErrorListDialogCaption:"\u041E\u0442\u0447\u0435\u0442 \u043E\u0448\u0438\u0431\u043E\u043A \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438",FileNameColumn:"\u0418\u043C\u044F \u0444\u0430\u0439\u043B\u0430",ErrorTextColumn:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",ErrorNumberColumn:"\u041A\u043E\u0434",LineColumn:"\u0421\u0442\u0440\u043E\u043A\u0430",CodeValidationErrorListDialogCaption:"\u041E\u0448\u0438\u0431\u043A\u0430: \u0446\u0438\u043A\u043B\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043F\u043E\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C \u0437\u0430\u0432\u0438\u0441\u0438\u043C\u043E\u0441\u0442\u0438 \u043F\u0430\u043A\u0435\u0442\u043E\u0432",SourceColumn:"\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A",ReferenceColumn:"\u0421\u0441\u044B\u043B\u043A\u0430",PackageColumn:"\u041F\u0430\u043A\u0435\u0442",AcademyHelpUrlCaption:" \u041F\u043E\u0434\u0440\u043E\u0431\u043D\u0435\u0435 \u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0432 \u0410\u043A\u0430\u0434\u0435\u043C\u0438\u0438"},TableDialog:{Close:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"}}}getTranslation(e){let t=this._getDefaultTranslation();return e==="ru-RU"&&(t=Object.assign(t,this._getRussianTranslation())),(this._nestedTranslateLoader?this._nestedTranslateLoader.getTranslation(e):(0,l.of)({})).pipe((0,l.map)(s=>Object.assign(t,s)))}static#e=this.\u0275fac=function(t){return new(t||bn)(c.\u0275\u0275inject(Hc,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:bn,factory:bn.\u0275fac})}const Xp=y.p+"assets/i18n/libs/";function Yp(i,e){return()=>(0,l.lastValueFrom)(i.loadCurrentUserInfo().pipe((0,o.switchMap)(t=>e.use(t?.userInfo?.cultureInfo?.sysCultureName).pipe((0,o.catchError)(()=>(0,l.of)(null))))),{defaultValue:null})}class Sn{constructor(e,t,s){this._injector=e,this._customElementsBootstrapService=t,this._translateService=s}ngDoBootstrap(){this._translateService.use(this._translateService.defaultLang).subscribe(()=>{this._customElementsBootstrapService.defineComponent("ts-error-list-dialog-proxy",Kr,this._injector)})}static#e=this.\u0275fac=function(t){return new(t||Sn)(c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(P.SH),c.\u0275\u0275inject(O.TranslateService))};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Sn});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[P.rK,{provide:c.APP_INITIALIZER,useFactory:Yp,deps:[Ue.fv,O.TranslateService],multi:!0},Pn,Xe,Ue.vn,{provide:w.APP_BASE_HREF,useValue:"/"},{provide:V.HTTP_INTERCEPTORS,useClass:ir,multi:!0},Tt,Q],imports:[_.BrowserModule,k.BrowserAnimationsModule,lr.forNested({defaultLanguage:"en-US",useDefaultLang:!0,loader:{provide:O.TranslateLoader,useClass:bn},resourceSources:[{prefix:Xp,suffix:".json"}]}),V.HttpClientModule,V.HttpClientXsrfModule.withOptions({cookieName:"BPMCSRF",headerName:"BPMCSRF"}),U.RouterModule.forRoot([],{}),nr]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Sn,{imports:[_.BrowserModule,k.BrowserAnimationsModule,O.TranslateModule,V.HttpClientModule,V.HttpClientXsrfModule,U.RouterModule,nr]})})(),_.platformBrowser().bootstrapModule(Sn).catch(i=>console.error(i))},86464:(x,G,y)=>{y.d(G,{r:()=>_});var _;(function(p){p[p.Guid=0]="Guid",p[p.Text=1]="Text",p[p.Integer=4]="Integer",p[p.Float=5]="Float",p[p.Money=6]="Money",p[p.DateTime=7]="DateTime",p[p.Date=8]="Date",p[p.Time=9]="Time",p[p.Lookup=10]="Lookup",p[p.Enum=11]="Enum",p[p.Boolean=12]="Boolean",p[p.Blob=13]="Blob",p[p.Image=14]="Image",p[p.CUSTOM_OBJECT=15]="CUSTOM_OBJECT",p[p.IMAGELOOKUP=16]="IMAGELOOKUP",p[p.COLLECTION=17]="COLLECTION",p[p.Color=18]="Color",p[p.LOCALIZABLE_STRING=19]="LOCALIZABLE_STRING",p[p.ENTITY=20]="ENTITY",p[p.ENTITY_COLLECTION=21]="ENTITY_COLLECTION",p[p.ENTITY_COLUMN_MAPPING_COLLECTION=22]="ENTITY_COLUMN_MAPPING_COLLECTION",p[p.HASH_TEXT=23]="HASH_TEXT",p[p.SECURE_TEXT=24]="SECURE_TEXT",p[p.FILE=25]="FILE",p[p.MAPPING=26]="MAPPING",p[p.SHORT_TEXT=27]="SHORT_TEXT",p[p.MEDIUM_TEXT=28]="MEDIUM_TEXT",p[p.MAXSIZE_TEXT=29]="MAXSIZE_TEXT",p[p.LONG_TEXT=30]="LONG_TEXT",p[p.FLOAT1=31]="FLOAT1",p[p.FLOAT2=32]="FLOAT2",p[p.FLOAT3=33]="FLOAT3",p[p.FLOAT4=34]="FLOAT4",p[p.LOCALIZABLE_PARAMETER_VALUES_LIST=35]="LOCALIZABLE_PARAMETER_VALUES_LIST",p[p.METADATA_TEXT=36]="METADATA_TEXT",p[p.STAGE_INDICATOR=37]="STAGE_INDICATOR",p[p.OBJECT_LIST=38]="OBJECT_LIST",p[p.COMPOSITE_OBJECT_LIST=39]="COMPOSITE_OBJECT_LIST",p[p.FLOAT8=40]="FLOAT8",p[p.FILE_LOCATOR=41]="FILE_LOCATOR",p[p.PHONE_TEXT=42]="PHONE_TEXT",p[p.RICH_TEXT=43]="RICH_TEXT",p[p.WEB_TEXT=44]="WEB_TEXT",p[p.EMAIL_TEXT=45]="EMAIL_TEXT",p[p.COMPOSITE_OBJECT=46]="COMPOSITE_OBJECT"})(_||(_={}))},6530:(x,G,y)=>{y.d(G,{gZ:()=>k,n7:()=>c,qv:()=>V});const _="00000000-0000-0000-0000-000000000000",p=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");function w(U){let O="";for(let P=0;P<U;P++)O+=((1+Math.random())*65536|0).toString(16).substring(1);return O}function V(){return[w(2),w(1),w(1),w(1),w(3)].join("-")}function c(U){return!!U&&p.test(U)}function k(U){return!U||U===_}},23176:(x,G,y)=>{y.d(G,{Vx:()=>ut,op:()=>wc,SH:()=>Ze,gX:()=>Ec,sj:()=>ce,$A:()=>Li,rK:()=>Bi,ZP:()=>Dt,Bo:()=>Pn,Ny:()=>Pc,S:()=>$,BB:()=>Dc,hk:()=>Tc,BV:()=>Oi,DH:()=>Nc,pR:()=>Vc});var _=y(40297),p=y(59131),w=y(62278),V=y(36486);const c=new p.InjectionToken("CustomEventApplicationIdToken"),k=new p.InjectionToken("CustomEventServiceToken");class U{constructor(o,S=null){this.document=o,this.appId=S,this.customEventName="TSCustomEventChannel",this.appId=S||Math.random().toString()}subscribe(o){return this.customEventObserver$=this.customEventObserver$||(0,w.fromEvent)(document,this.customEventName),this.customEventObserver$.pipe((0,V.filter)(S=>S.detail.eventName===o&&S.detail.sender!==this.appId),(0,V.map)(S=>S.detail.payload))}createOutboundChannel(o){const S=new w.Subject;return S.asObservable().subscribe(R=>{const N=new CustomEvent(this.customEventName,{detail:{eventName:o,sender:this.appId,payload:R}});this.document.dispatchEvent(N)}),S}getDataViaEvent(o,S={}){return new w.Observable(R=>{this.subscribe(o).pipe((0,V.first)()).subscribe(N=>{R.next(N),R.complete()}),this.createOutboundChannel(o).next(S)})}getDataStreamViaEvent(o,S={}){return new w.Observable(R=>{const N=this.subscribe(o).subscribe(Q=>{R.next(Q)},w.noop,()=>R.complete());return this.createOutboundChannel(o).next(S),()=>{N.unsubscribe()}})}static#e=this.\u0275fac=function(S){return new(S||U)(p.\u0275\u0275inject(_.DOCUMENT),p.\u0275\u0275inject(c,8))};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}var O=y(34268),P=y.n(O);const L="(?=^.{1,250}$)^[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?\\.)+[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?$",ee=()=>new RegExp(L,"g"),D=()=>new RegExp(CONTAINS_EMAIL_PATTERN,"g");function J(E){return ee().test(E)}function ke(E){return CONTAINS_EMAIL_REGEXP().test(E)}const We={name:"uponSanitizeElement",func:(E,o)=>{const S=o.tagName;J(S)&&E.insertAdjacentText("afterbegin",`<${S}>`)}},he={name:"afterSanitizeAttributes",func:(E,o)=>{const S=window?.location?.origin;if(E.nodeName==="A"&&!E.getAttribute("href")?.toLowerCase().startsWith(S)){E.setAttribute("target","_blank");let R=E.getAttribute("rel")||"";["noopener","noreferrer"].forEach(N=>{R.includes(N)||(R+=" "+N)}),E.setAttribute("rel",R.trim())}}},Pt=new p.InjectionToken("Represents a DOM purifier",{factory:()=>(P().addHook(We.name,We.func),P().addHook(he.name,he.func),P()),providedIn:"platform"});function m(E){return E?Array.isArray(E)?E:[E]:[]}function A(E){return E||{}}function I(){}function $(){return()=>{}}var K=y(26714);class Ie{static create(o){return new o}}class Ce{constructor(){this.speechResult=new w.Subject,this.speechEnd=new w.Subject}static _getInternalApiClass(){return window.SpeechRecognition||window.webkitSpeechRecognition}static isSupported(){return Ce._getInternalApiClass()!==void 0}_subscribeEvents(){this._internalApi.addEventListener("result",this.onResult.bind(this)),this._internalApi.addEventListener("speechend",this.onSpeechEnd.bind(this))}_unsubscribeEvents(){this._internalApi.removeEventListener("result",this.onResult),this._internalApi.removeEventListener("speechend",this.onSpeechEnd)}init(o){const S=Ce._getInternalApiClass();this._internalApi=Ie.create(S),this._internalApi.continuous=!0,this._internalApi.lang=o.lang||"en-US",this._subscribeEvents()}onResult(o){const{resultIndex:S,results:R}=o,N=R[S][0];if(!N)throw new Error("No results to transcript");this.speechResult.next(N.transcript)}onSpeechEnd(){this.speechEnd.next()}destroy(){this._unsubscribeEvents(),this._internalApi=null}startRecognition(){this._internalApi.start()}stopRecognition(){this._internalApi.stop()}static#e=this.\u0275fac=function(S){return new(S||Ce)};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:Ce,factory:Ce.\u0275fac})}var Yt=y(73436);class An{get messages$(){return this._messages$}constructor(o,S){this._ngZone=S;const R=new w.Subject;this._messages$=R.pipe(this._runInZone(this._ngZone)),this._broadcastChannel=new Yt.BroadcastChannel(o),this._broadcastChannel.onmessage=N=>R.next(N)}_runInZone(o){return S=>new w.Observable(R=>{S.subscribe(N=>o.run(()=>R.next(N)))})}publish(o){return(0,w.from)(this._broadcastChannel.postMessage(o))}}class ut{constructor(o){this._ngZone=o}createInstance(o){return new An(o,this._ngZone)}static#e=this.\u0275fac=function(S){return new(S||ut)(p.\u0275\u0275inject(p.NgZone))};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:ut,factory:ut.\u0275fac,providedIn:"root"})}class xi{static toColdObservable(o){return new Observable(S=>{o().subscribe(N=>{S.next(N),S.complete()})})}}class Qt{log(o,S,...R){console.log(o,...R)}warn(o,S,...R){console.warn(o,...R)}error(o,S,...R){console.error(o,...R)}exception(o,S,...R){(console.exception||console.error)(o,...R)}static#e=this.\u0275fac=function(S){return new(S||Qt)};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:Qt,factory:Qt.\u0275fac})}const Ac={dataAccess:"data-access",feature:"feature",ui:"ui",util:"util",components:"components",deprecated:"deprecated"},Bl={studioFree:"studio-free",studioEnterprise:"studio-enterprise",sdk:"sdk"};class or{constructor(o,S,R=null){this._injector=o,this._registrationMap=S,this._defaultInstanceType=R}_getInstance(o,S){return S?"injectable"in S&&S.injectable!=null?this._injector.get(S.injectable):"useFactory"in S&&typeof S.useFactory=="function"?S.useFactory(o):"useValue"in S?S.useValue:null:null}_getDefaultInstance(o){return this._getInstance(o,this._defaultInstanceType)}_getInstanceByType(o){if(this._registrationMap.has(o)){const S=this._registrationMap.get(o);return this._getInstance(o,S)}}_getInstanceByPredicate(o){for(const[S,R]of this._registrationMap)if(typeof S=="function"&&S(o))return this._getInstance(o,R)}create(o=null){return o==null?this._getDefaultInstance(o):this._getInstanceByType(o)??this._getInstanceByPredicate(o)??this._getDefaultInstance(o)}static#e=this.\u0275fac=function(S){p.\u0275\u0275invalidFactory()};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:or,factory:or.\u0275fac,providedIn:"root"})}var vc=y(28399);class Ec{static _createMappings(o){const S=new Map;return o=o??[],o.forEach(R=>{const N=R.predicate,Q=(0,vc.omit)(R,"predicate");S.set(N,Q)}),S}static create(o){const{mappings:S,default:R,token:N}=o??{};return{provide:N,useFactory:Q=>{const se=this._createMappings(S);return new or(Q,se,R)},deps:[p.Injector]}}}function cr(E){return Array.isArray(E)?E:[E]}function Mc(E,o){return o.forEach(({replaceMacros:S,replaceValue:R})=>{E=E.map(N=>N===S?R??"":N)}),E}function Ic(E,o){if(!E)return"";if(!o)return E;let S=[E];return o=cr(o),S=Rc(S,o),S=Mc(S,o),S.join("")}function Rc(E,o){if(!E)return[];let S=cr(E);if(!o)return S;const R=cr(o),N=R.map(({replaceMacros:Q})=>Q);return R.forEach(({searchValue:Q,replaceMacros:se})=>{if(Q&&se){const ye=new RegExp(`(${se})`,"g"),dt=S.map(Tt=>N.includes(Tt)?Tt:Tt.split(Q).join(se).split(ye));S=flatten(dt)}}),S}var kl=y(4930);function wc(E){return function(o){Reflect.defineMetadata("requestType",E.requestType,o)}}function Fl(E){return o=>{const S=o.pipe(share()),R=S.pipe(tap(E),take(1));return concat(R,S)}}function Pc(E){return o=>o.pipe((0,V.concatMap)((S,R)=>E(S,R).pipe((0,V.map)(N=>[S,N]))))}function Dc(E){return o=>o.pipe((0,V.mergeMap)((S,R)=>E(S,R).pipe((0,V.map)(N=>[S,N]))))}function Tc(E){return o=>o.pipe((0,V.mergeMap)((S,R)=>E(S,R).pipe((0,V.map)(()=>S))))}function Nc(E){return o=>o.pipe((0,V.switchMap)((S,R)=>E(S,R).pipe((0,V.map)(N=>[S,N]))))}function Vc(E){return o=>o.pipe((0,V.switchMap)((S,R)=>E(S,R).pipe((0,V.map)(()=>S))))}function Oi(E){return o=>E?new w.Observable(S=>{const R=se=>E.run(()=>S.next(se)),N=se=>E.run(()=>S.error(se)),Q=()=>E.run(()=>S.complete());return o.subscribe({next:R,error:N,complete:Q})}):o}function jl(E){return o=>E?new Observable(S=>{const R=se=>E.runOutsideAngular(()=>S.next(se)),N=se=>E.runOutsideAngular(()=>S.error(se)),Q=()=>E.runOutsideAngular(()=>S.complete());return o.subscribe({next:R,error:N,complete:Q})}):o}var vn=y(23710);class Li{static initialize(){vn.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),vn.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(o,S="",R="_"){const N=new RegExp(`^${S}`);return S+o.replace(N,"")+R+vn.generate()}static getUniqueIncrementalName(o,S){if(!S.includes(o))return o;let R;for(let N=1;N<=S.length;N++)if(R=`${o}-${N}`,!S.includes(R))return R;return R}}Li.initialize();const $l=new p.InjectionToken("An abstraction over window.navigator object",{factory:()=>window.navigator,providedIn:"root"});var xc=y(6530);const En=new p.InjectionToken("CURRENT_TAB_ID_TOKEN"),Oc={provide:En,useValue:(0,xc.qv)()},Lc=new p.InjectionToken("Dialog token"),Dt=new p.InjectionToken("WindowToken",{providedIn:"root",factory:Mn});function Mn(){return window}const Bi={provide:Dt,useFactory:Mn};class lt{constructor(o){this._window=o,this._hasFocus=!1,this._window.addEventListener("focus",()=>{this._hasFocus=!0}),this._window.addEventListener("blur",()=>{this._hasFocus=!1})}_getIsDocumentVisible(){return document.visibilityState!=="hidden"}get hasFocus(){return this._hasFocus}get isActive(){return this._getIsDocumentVisible()}focus(){this._window.focus()}static#e=this.\u0275fac=function(S){return new(S||lt)(p.\u0275\u0275inject(Dt))};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:lt,factory:lt.\u0275fac,providedIn:"root"})}var In=y(3633);class Ze{constructor(o){this._injector=o}defineComponent(o,S,R=null){const N=(0,In.createCustomElement)(S,{injector:R||this._injector});customElements.get(o)||customElements.define(o,N)}static#e=this.\u0275fac=function(S){return new(S||Ze)(p.\u0275\u0275inject(p.Injector))};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:Ze,factory:Ze.\u0275fac,providedIn:"root"})}function Bc(E,o){return E.creatio.tabId=o,(0,w.of)(void 0)}const kc={provide:p.APP_INITIALIZER,multi:!0,useFactory:(E,o)=>()=>Bc(E,o),deps:[Dt,En]},Rn=new p.InjectionToken("LOCAL_STORAGE_SERVICE_CONFIG");class es{static forRoot(o={}){return{ngModule:es,providers:[{provide:Rn,useValue:o}]}}static#e=this.\u0275fac=function(S){return new(S||es)};static#t=this.\u0275mod=p.\u0275\u0275defineNgModule({type:es});static#s=this.\u0275inj=p.\u0275\u0275defineInjector({})}const ts="LOCAL_STORAGE_NOT_SUPPORTED";class ce{constructor(o={}){this._isSupported=!1,this._prefix="ls",this._storageType="localStorage";const{prefix:S,storageType:R}=o||{};S!=null&&this._setPrefix(S),R!=null&&this._setStorageType(R),this._isSupported=this._checkSupport()}_deriveKey(o){return`${this._prefix}${o}`}_checkSupport(){try{const o=this._storageType in window&&window[this._storageType]!==null;if(o){this._webStorage=window[this._storageType];const S=this._deriveKey(`__${Math.round(Math.random()*1e7)}`);this._webStorage.setItem(S,""),this._webStorage.removeItem(S)}return o}catch(o){return console.error(o.message),!1}}_setPrefix(o){this._prefix=o;const S=".";this._prefix&&!this._prefix.endsWith(S)&&(this._prefix=this._prefix?`${this._prefix}${S}`:"")}_setStorageType(o){this._storageType=o}get(o){if(!this._isSupported)return console.warn(ts),null;const S=this._webStorage?this._webStorage.getItem(this._deriveKey(o)):null;if(!S||S==="null")return null;try{return JSON.parse(S)}catch{return null}}set(o,S){const R=S===void 0?null:JSON.stringify(S);if(!this._isSupported)return console.warn(ts),!1;try{this._webStorage&&this._webStorage.setItem(this._deriveKey(o),R)}catch(N){return console.error(N.message),!1}return!0}remove(...o){let S=!0;return o.forEach(R=>{this._isSupported||(console.warn(ts),S=!1);try{this._webStorage.removeItem(this._deriveKey(R))}catch(N){console.error(N.message),S=!1}}),S}static#e=this.\u0275fac=function(S){return new(S||ce)(p.\u0275\u0275inject(Rn,8))};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac,providedIn:"root"})}var Ae=y(73308);class ur{playFromSource(o,S=!1){return(0,Ae.A)(function*(){const R=new Audio(o),N=R.play();if(N!==void 0)try{yield N}catch(Q){if(R.muted=!0,S)throw Q}})()}static#e=this.\u0275fac=function(S){return new(S||ur)};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:ur,factory:ur.\u0275fac,providedIn:"root"})}var Je;(function(E){E.Small="small",E.Medium="medium",E.Large="large",E.XL="xl",E.XXL="xxl"})(Je||(Je={}));class Fe{constructor(o,S){this._window=o,this._document=S,this._minScreenSize=600,this._mediumScreenSize=790,this._largeScreenSize=1079,this._xlScreenSize=1280,this._screenSizeChanges$=new w.BehaviorSubject(this._currentScreenSizeType),this._changeScreenSizeType()}get currentScreenSizeType(){return this._currentScreenSizeType}get currentScreenSize(){return this._currentScreenSize}get isSmallScreen(){return this._currentScreenSizeType===Je.Small}_setScreenSizeTypeAttribute(o){this._document.body.setAttribute("screen-size-type",o)}_getScreenSizeType(){return this._currentScreenSize=this._window.innerWidth,this._currentScreenSize<=this._minScreenSize?Je.Small:this._currentScreenSize<=this._mediumScreenSize?Je.Medium:this._currentScreenSize<=this._largeScreenSize?Je.Large:this._currentScreenSize<=this._xlScreenSize?Je.XL:Je.XXL}_changeScreenSizeType(){const o=this._getScreenSizeType();return o===this._currentScreenSizeType?!1:(this._currentScreenSizeType=o,this._setScreenSizeTypeAttribute(o),!0)}screenSizeTypeChangeNotifier(){return this._screenSizeChanges$.asObservable()}refreshCurrentScreenSizeType(){this._changeScreenSizeType()&&this._screenSizeChanges$.next(this._currentScreenSizeType)}static#e=this.\u0275fac=function(S){return new(S||Fe)(p.\u0275\u0275inject(Dt),p.\u0275\u0275inject(_.DOCUMENT))};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:Fe,factory:Fe.\u0275fac,providedIn:"root"})}const ki=new p.InjectionToken("DESKTOP_NOTIFICATION_SENDER_PROVIDER");var wn;(function(E){E[E.StayLoggedIn=0]="StayLoggedIn",E[E.Exit=1]="Exit",E[E.NotSet=2]="NotSet"})(wn||(wn={}));var Fc=y(93277),Fi=y(79772);class te{constructor(){this._liveAnnouncer=(0,p.inject)(Fc.LiveAnnouncer),this._translateService=(0,p.inject)(Fi.TranslateService)}announce(o,S,R=200){var N=this;return(0,Ae.A)(function*(){const Q=N._translateService.instant(o);yield N._liveAnnouncer.announce(Q,S,R)})()}static#e=this.\u0275fac=function(S){return new(S||te)};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac,providedIn:"root"})}function l(E){return E.map(o=>({name:o.name,dependsOn:[...o.dependsOn]}))}function Xe(E){return E.filter(o=>o.dependsOn.length===0).map(o=>o.name)}function Pn(E){if(!E||E.length===0)return[];const o=l(E),S=o.map(ye=>ye.dependsOn).flat().length;let R=0;const N=Xe(o);if(N.length===0)throw new Error("Cyclic dependencies detected");const Q=[[...N]];let se=o.filter(ye=>ye.dependsOn.length!==0);for(;se.length!==0;){if(R>S)throw new Error("Process is hanging while build order");R++,se=se.map(dt=>({name:dt.name,dependsOn:dt.dependsOn.filter(Tt=>!N.includes(Tt))}));const ye=Xe(se);if(ye.length===0)throw new Error("Cyclic dependencies detected");N.push(...ye),Q.push(ye),se=se.filter(dt=>dt.dependsOn.length!==0)}return Q}function f(E){return Pn(E).flat()}},91592:(x,G,y)=>{y.d(G,{X:()=>w});var _=y(59131),p=y.n(_);class w{constructor(){this.getRegisteredEvents=()=>[]}set eventHandlers(c){this._eventHandlers=c,this._validateEventHandlers()}get eventHandlers(){return this._eventHandlers}_stringify(c){const k=[()=>JSON.stringify(c),()=>c.toString()];for(let U=0;U<k.length;U++){const O=k[U];try{return O()}catch{}}return""}_checkEventCanBeHandled(c){const k=this.getRegisteredEvents();if(!k||k.some(P=>P.name===c))return;const U=k.map(P=>P.name).join(", ");let O=`Handler for event "${c}" can not be specified because the event was not registered in table cell class. Registered table column events to subscribe: ${U}.`;throw this.columnDataSchema&&(O+=` Column name: "${this.columnDataSchema.name}".`),new Error(O)}_checkHandlerIsFunction(c,k){if(typeof k!="function")throw new TypeError(`Handler for event with name "${c}" must be a function, but actual is"${this._stringify(k)}".`)}_validateEventHandlers(){if(!this.eventHandlers)return;Object.keys(this.eventHandlers).forEach(k=>{this._checkEventCanBeHandled(k),this._checkHandlerIsFunction(k,this.eventHandlers[k])})}_checkEventDataType(c,k){return c instanceof k||c.constructor===k}_validateFiringEvent(c,k){const U=this._registeredEvents.find(P=>P.name===c);if(!U)throw new Error(`Event with name "${c}" is not registered in the cell class and can not be fired.`);const O=U.dataType;if(k&&(!O||!this._checkEventDataType(k,O)))throw new TypeError(`Type of the data in the event "${c}" must be "${O}", but actual data is "${this._stringify(k)}".`)}_getValidEventHandler(c){const k=this.eventHandlers&&this.eventHandlers[c];if(k)return this._checkHandlerIsFunction(c,k),k}isEmpty(){return!(this.columnDataSchema&&this.record)}fireEvent(c,k){this._validateFiringEvent(c,k);const U=this._getValidEventHandler(c);return U&&U(this.record,k)}ngOnInit(){this._registeredEvents=this.getRegisteredEvents()}getValue(){const c=this.record[this.columnDataSchema.name],k=this.columnDataSchema.formatter;return k?k(c,this.record):c}static#e=this.\u0275fac=function(k){return new(k||w)};static#t=this.\u0275dir=_.\u0275\u0275defineDirective({type:w,inputs:{columnDataSchema:"columnDataSchema",record:"record",eventHandlers:"eventHandlers"}})}},93248:(x,G,y)=>{y.d(G,{Fg:()=>p,HO:()=>w,Oi:()=>_,oy:()=>V});const _="user-info-cache",p="currentUserInfo",w="application-info-cache",V="applicationInfo"},61843:(x,G,y)=>{y.d(G,{dJ:()=>p,fX:()=>w});const _="A5420246-0A8E-E111-84A3-00155D054C03",p="en-US";class w{constructor(c){Object.assign(this,c)}static getDefaultCulture(){return new w({sysCultureId:_,sysCultureName:p,decimalSeparator:".",thousandSeparator:","})}}},47149:(x,G,y)=>{y.d(G,{P:()=>V,Q:()=>w});var _=y(86464);const p="DataValueType",w={[_.r.Date]:{type:_.r.Date,id:"603d4960-a1a2-45e9-b232-206a54421b01",name:"Date",icon:"data-type-date-icon.svg",designerIcon:y(26861),translateKey:`${p}.DateCaption`},[_.r.Time]:{type:_.r.Time,id:"04cc757b-8f06-482c-8a1a-0c0e171d2410",name:"Time",icon:"data-type-time-icon.svg",designerIcon:y(8510),translateKey:`${p}.TimeCaption`},[_.r.DateTime]:{type:_.r.DateTime,id:"d21e9ef4-c064-4012-b286-fa1a8171da44",name:"DateTime",icon:"data-type-datetime-icon.svg",designerIcon:y(55146),translateKey:`${p}.DateTimeCaption`},[_.r.Text]:{type:_.r.Text,id:"8b3f29bb-ea14-4ce5-a5c5-293a929b6ba2",name:"Text",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${p}.TextCaption`},[_.r.SHORT_TEXT]:{type:_.r.SHORT_TEXT,id:"325a73b8-0f47-44a0-8412-7606f78003ac",name:"ShortText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${p}.ShortTextCaption`},[_.r.PHONE_TEXT]:{type:_.r.PHONE_TEXT,id:"26cba63c-daf1-4f36-b2ea-73c0d675d90c",name:"PhoneText",icon:"data-type-phone-icon.svg",designerIcon:y(59155),translateKey:`${p}.PhoneTextCaption`},[_.r.WEB_TEXT]:{type:_.r.WEB_TEXT,id:"26cba64c-daf1-4f36-b2ea-73c0d695d90c",name:"WebText",icon:"data-type-text-icon.svg",designerIcon:y(64337),translateKey:`${p}.WebTextCaption`},[_.r.EMAIL_TEXT]:{type:_.r.EMAIL_TEXT,id:"66cba64c-daf1-4f36-b8ea-73c0d695d90c",name:"EmailText",icon:"data-type-text-icon.svg",designerIcon:y(71011),translateKey:`${p}.EmailTextCaption`},[_.r.MEDIUM_TEXT]:{type:_.r.MEDIUM_TEXT,id:"ddb3a1ee-07e8-4d62-b7a9-d0e618b00fbd",name:"MediumText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${p}.MediumTextCaption`},[_.r.LONG_TEXT]:{type:_.r.LONG_TEXT,id:"5ca35f10-a101-4c67-a96a-383da6afacfc",name:"LongText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${p}.LongTextCaption`},[_.r.MAXSIZE_TEXT]:{type:_.r.MAXSIZE_TEXT,id:"c0f04627-4620-4bc0-84e5-9419dc8516b1",name:"MaxSizeText",icon:"data-type-unlimited-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${p}.MaxSizeTextCaption`},[_.r.Integer]:{type:_.r.Integer,id:"6b6b74e2-820d-490e-a017-2b73d4ccf2b0",name:"Integer",icon:"data-type-integer-icon.svg",designerIcon:y(60521),translateKey:`${p}.IntegerCaption`},[_.r.FLOAT1]:{type:_.r.FLOAT1,id:"07ba84ce-0bf7-44b4-9f2c-7b15032eb98c",name:"Float1",icon:"data-type-float1-icon.svg",designerIcon:y(68877),translateKey:`${p}.FLOAT1Caption`},[_.r.FLOAT2]:{type:_.r.FLOAT2,id:"5cc8060d-6d10-4773-89fc-8c12d6f659a6",name:"Float2",icon:"data-type-float2-icon.svg",designerIcon:y(68877),translateKey:`${p}.FLOAT2Caption`},[_.r.FLOAT3]:{type:_.r.FLOAT3,id:"3f62414e-6c25-4182-bcef-a73c9e396f31",name:"Float3",icon:"data-type-float3-icon.svg",designerIcon:y(68877),translateKey:`${p}.FLOAT3Caption`},[_.r.FLOAT4]:{type:_.r.FLOAT4,id:"ff22e049-4d16-46ee-a529-92d8808932dc",name:"Float4",icon:"data-type-float4-icon.svg",designerIcon:y(68877),translateKey:`${p}.FLOAT4Caption`},[_.r.FLOAT8]:{type:_.r.FLOAT8,id:"a4aaf398-3531-4a0d-9d75-a587f5b5b59e",name:"Float8",icon:"data-type-float8-icon.svg",designerIcon:y(68877),translateKey:`${p}.FLOAT8Caption`},[_.r.Guid]:{type:_.r.Guid,id:"23018567-a13c-4320-8687-fd6f9e3699bd",name:"Guid",icon:"data-type-guid-icon.svg",designerIcon:y(92458),translateKey:`${p}.GuidCaption`},[_.r.Lookup]:{type:_.r.Lookup,id:"b295071f-7ea9-4e62-8d1a-919bf3732ff2",name:"Lookup",icon:"data-type-lookup-icon.svg",designerIcon:y(61631),translateKey:`${p}.LookupCaption`},[_.r.Boolean]:{type:_.r.Boolean,id:"90b65bf8-0ffc-4141-8779-2420877af907",name:"Boolean",icon:"data-type-boolean-icon.svg",designerIcon:y(36659),translateKey:`${p}.BooleanCaption`},[_.r.HASH_TEXT]:{type:_.r.HASH_TEXT,id:"ecbcce18-2a17-4ead-829a-9d02fa9578a4",name:"HashText",icon:"data-type-crs-text-icon.svg",designerIcon:y(97180),translateKey:`${p}.HashTextCaption`},[_.r.SECURE_TEXT]:{type:_.r.SECURE_TEXT,id:"3509b9dd-2c90-4540-b82e-8f6ae85d8248",name:"SecureText",icon:"data-type-encrypted-text-icon.svg",designerIcon:y(28010),translateKey:`${p}.SecureTextCaption`},[_.r.IMAGELOOKUP]:{type:_.r.IMAGELOOKUP,id:"b039feb0-ee7c-4884-8aa6-d6d45d84316f",name:"ImageLookup",icon:"data-type-image-link-icon.svg",designerIcon:y(65689),translateKey:`${p}.ImageLookupCaption`},[_.r.Money]:{type:_.r.Money,id:"969093e2-2b4e-463b-883a-3d3b8c61f0cd",name:"Money",icon:"data-type-float2-icon.svg",designerIcon:y(32643),translateKey:`${p}.MoneyCaption`},[_.r.Float]:{type:_.r.Float,id:"57ee4c31-5ec4-45fa-b95d-3a2868aa89a8",name:"Float",icon:"data-type-float1-icon.svg",designerIcon:y(68877),translateKey:`${p}.FloatCaption`},[_.r.FILE]:{type:_.r.FILE,id:"a33c9252-d401-453e-949d-169157067ed9",name:"File",icon:"data-type-file-icon.svg",designerIcon:y(55039),translateKey:`${p}.FileCaption`},[_.r.Image]:{type:_.r.Image,id:"fa6e6e49-b996-475e-a77e-73904e4c5a88",name:"Image",icon:"data-type-image-icon.svg",designerIcon:y(55039),translateKey:`${p}.ImageCaption`},[_.r.Blob]:{type:_.r.Blob,id:"b7342b7a-5dde-40de-aa7c-24d2a57b3202",name:"Blob",icon:"data-type-blob-icon.svg",designerIcon:y(55039),translateKey:`${p}.BlobCaption`},[_.r.Color]:{type:_.r.Color,id:"dafb71f9-ee9f-4e0b-a4d7-37aa15987155",name:"Color",icon:"data-type-color-icon.svg",designerIcon:y(39078),translateKey:`${p}.ColorCaption`},[_.r.RICH_TEXT]:{type:_.r.RICH_TEXT,id:"79bccffa-8c8b-4863-b376-a69d2244182b",name:"RichText",icon:"data-type-rich-text-icon.svg",designerIcon:y(67021),translateKey:`${p}.RichCaption`},[_.r.ENTITY]:{type:_.r.ENTITY,id:"ebd85d37-0abf-4bbf-bb32-97dc3dffcc8c",name:"Entity",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${p}.Entity`},[_.r.ENTITY_COLLECTION]:{type:_.r.ENTITY_COLLECTION,id:"51fb23ba-3eb2-11e2-b7d5-b0c76188709b",name:"EntityCollection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${p}.EntityCollection`},[_.r.ENTITY_COLUMN_MAPPING_COLLECTION]:{type:_.r.ENTITY_COLUMN_MAPPING_COLLECTION,id:"b53eaa2a-4bb7-4a6b-9f4f-58ccab293e31",name:"EntityColumnMappingCollection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${p}.EntityColumnMappingCollection`},[_.r.CUSTOM_OBJECT]:{type:_.r.CUSTOM_OBJECT,id:"84ed6865-9692-4c98-aaed-4d15b96a95c2",name:"CustomObject",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${p}.CustomObject`},[_.r.OBJECT_LIST]:{type:_.r.OBJECT_LIST,id:"4b51a8b5-1ee9-4437-9d58-f35e083cbcdf",name:"ObjectList",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${p}.ObjectList`},[_.r.COMPOSITE_OBJECT_LIST]:{type:_.r.COMPOSITE_OBJECT_LIST,id:"651ec16f-d140-46db-b9e2-825c985a8ac2",name:"CompositeObjectList",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${p}.CompositeObjectList`},[_.r.COMPOSITE_OBJECT]:{type:_.r.COMPOSITE_OBJECT,id:"632e4371-0a7f-46cd-a284-a623b3933027",name:"CompositeObject",icon:"data-type-composite-object-icon.svg",designerIcon:y(97180),translateKey:`${p}.CompositeObject`},[_.r.COLLECTION]:{type:_.r.COLLECTION,name:"Collection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${p}.Collection`},[_.r.LOCALIZABLE_STRING]:{type:_.r.LOCALIZABLE_STRING,id:"95c6e6c4-2cc8-46be-a1cb-96f942655f86",name:"LocalizableString",icon:"data-type-text-icon.svg",designerIcon:y(97180),translateKey:`${p}.LocalizableString`},[_.r.METADATA_TEXT]:{type:_.r.METADATA_TEXT,id:"394e160f-c8e0-46fa-9c0d-75d97e9e9169",name:"MetaDataText",icon:"data-type-text-icon.svg",designerIcon:y(97180),translateKey:`${p}.MetaDataText`}},V={DateTime:[_.r.Date,_.r.Time,_.r.DateTime],Text:[_.r.Text,_.r.SHORT_TEXT,_.r.MEDIUM_TEXT,_.r.LONG_TEXT,_.r.PHONE_TEXT,_.r.WEB_TEXT,_.r.EMAIL_TEXT,_.r.MAXSIZE_TEXT,_.r.LOCALIZABLE_STRING,_.r.RICH_TEXT],Number:[_.r.FLOAT1,_.r.FLOAT2,_.r.FLOAT3,_.r.FLOAT4,_.r.FLOAT8,_.r.Integer,_.r.Money,_.r.Float],Lookup:[_.r.Lookup,_.r.IMAGELOOKUP]}},74975:(x,G,y)=>{y.d(G,{S:()=>w});var _=y(59131),p=y.n(_);class w{constructor(){const c=this.constructor;if((0,_.inject)(c,_.InjectFlags.Optional|_.InjectFlags.SkipSelf))throw Error(`[${c.name}]: trying to create multiple instances,
			but this service should be a singleton.`)}}},23092:(x,G,y)=>{y.d(G,{fv:()=>he,oq:()=>L,vn:()=>We});var _=y(63721),p=y.n(_),w=y(59131),V=y.n(w),c=y(62278),k=y.n(c),U=y(93248),O=y(61843),P=y(74975),C=y(49820);class L{constructor(){this.cultureInfo=new O.fX,this.defCultureInfo=new O.fX}}const ee="Information about the current user is not initialized yet. Use UserInfoService to load current user information.";function D(){return{get id(){throw new ReferenceError(ee)},get contactId(){throw new ReferenceError(ee)},get contactName(){throw new ReferenceError(ee)},get accountId(){throw new ReferenceError(ee)},get accountName(){throw new ReferenceError(ee)},get isSSP(){throw new ReferenceError(ee)},get timeZoneId(){throw new ReferenceError(ee)},get cultureInfo(){throw new ReferenceError(ee)},get defCultureInfo(){throw new ReferenceError(ee)},get timeZoneOffsetHours(){throw new ReferenceError(ee)},get photoId(){throw new ReferenceError(ee)},get accessType(){throw new ReferenceError(ee)},get sessionId(){throw new ReferenceError(ee)}}}const J=D(),ke={get id(){return J.id},get contactId(){return J.contactId},get contactName(){return J.contactName},get accountId(){return J.accountId},get accountName(){return J.accountName},get isSSP(){return J.isSSP},get timeZoneId(){return J.timeZoneId},get cultureInfo(){return J.cultureInfo},get defCultureInfo(){return J.defCultureInfo},get timeZoneOffsetHours(){return J.timeZoneOffsetHours},get photoId(){return J.photoId},get accessType(){return J.accessType},get sessionId(){return J.sessionId}};Object.freeze(ke);const We={provide:L,useFactory:()=>ke};class he extends P.S{constructor(m,A){super(),this._httpClient=m,this._cacheManager=A,this._serviceEndpoint="/ServiceModel/UserInfoService.svc"}_applyUserInfo(m){Object.keys(J).forEach(A=>{delete J[A]}),Object.assign(J,m)}loadCurrentUserInfo(){if(!this._userInfo$){const m=`${this._serviceEndpoint}/GetCurrentUserInfo`;this._userInfo$=this._cacheManager.executeWithCache(U.Oi,U.Fg,this._httpClient.post(m,null)).pipe((0,c.tap)(A=>this._applyUserInfo(A?.userInfo)),(0,c.shareReplay)({bufferSize:1,refCount:!1}))}return this._userInfo$}static#e=this.\u0275fac=function(A){return new(A||he)(w.\u0275\u0275inject(_.HttpClient),w.\u0275\u0275inject(C.G))};static#t=this.\u0275prov=w.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac,providedIn:"root"})}},49820:(x,G,y)=>{y.d(G,{G:()=>he});var _=y(73308),p=y(63721),w=y(59131),V=y(23176),c=y(62278),k=y(36486);class U{constructor(m,A,I){this._indexedDBService=m,this.memoryCache=I,this._tableName=A.tableName,this._keyPrefix=A.keyPrefix}_getPrefixedKey(m){return this._keyPrefix?`${this._keyPrefix}_${m}`:m}_getIndexedDBRecord(m){return(0,c.firstValueFrom)(this._indexedDBService.getByKey(this._tableName,m))}_getIndexedDBRecords(m){return(0,c.firstValueFrom)(this._indexedDBService.getByKeys(this._tableName,m))}has(m){var A=this;return(0,_.A)(function*(){if(yield A.memoryCache?.has(A._getPrefixedKey(m)))return!0;const I=yield A._getIndexedDBRecord(A._getPrefixedKey(m));return yield A.memoryCache?.set(A._getPrefixedKey(m),I?.data),!!I?.data})()}get(m){var A=this;return(0,_.A)(function*(){if(yield A.memoryCache?.has(A._getPrefixedKey(m)))return A.memoryCache.get(A._getPrefixedKey(m));const I=yield A._getIndexedDBRecord(A._getPrefixedKey(m));return yield A.memoryCache?.set(A._getPrefixedKey(m),I?.data),I?.data??null})()}getAll(){var m=this;return(0,_.A)(function*(){return yield(0,c.firstValueFrom)(m._indexedDBService.getAll(m._tableName).pipe((0,c.map)(A=>A.map(I=>({key:I.key,value:I.data})))))})()}set(m,A){var I=this;return(0,_.A)(function*(){const $=yield I._getIndexedDBRecord(I._getPrefixedKey(m));$?yield(0,c.firstValueFrom)(I._indexedDBService.update(I._tableName,{id:$.id,key:I._getPrefixedKey(m),data:A})):yield(0,c.firstValueFrom)(I._indexedDBService.add(I._tableName,{key:I._getPrefixedKey(m),data:A})),yield I.memoryCache?.set(I._getPrefixedKey(m),A)})()}bulkSet(m){var A=this;return(0,_.A)(function*(){if(!m||m.length===0)return;const I=(yield A._getIndexedDBRecords(m.map(K=>A._getPrefixedKey(K.key))))||[],$=m.map(K=>{const Ie=I.filter(Boolean).find(Yt=>Yt.key===A._getPrefixedKey(K.key)),Ce={key:A._getPrefixedKey(K.key),data:K.value};return Ie?.id?{...Ce,id:Ie.id}:Ce});yield(0,c.firstValueFrom)(A._indexedDBService.bulkUpdate(A._tableName,$)),yield A.memoryCache?.bulkSet(m)})()}delete(m){var A=this;return(0,_.A)(function*(){yield(0,c.firstValueFrom)(A._indexedDBService.deleteByIndex(A._tableName,A._getPrefixedKey(m))),yield A.memoryCache?.delete(A._getPrefixedKey(m))})()}clear(){var m=this;return(0,_.A)(function*(){yield(0,c.firstValueFrom)(m._indexedDBService.clear(m._tableName)),yield m.memoryCache?.clear()})()}}class O{constructor(){this._cache=new Map}has(m){return Promise.resolve(this._cache.has(m))}get(m){return Promise.resolve(this._cache.get(m))}getAll(){return Promise.resolve([...this._cache].map(([m,A])=>({key:m,value:A})))}set(m,A){return this._cache.set(m,A),Promise.resolve()}bulkSet(m){return m.forEach(A=>{this._cache.set(A.key,A.value)}),Promise.resolve()}delete(m){return this._cache.delete(m),Promise.resolve()}clear(){return this._cache.clear(),Promise.resolve()}}var P=y(41483),C=y(40234),L=y(30293);const ee={name:"crt-shell-db",version:9,objectStoresMeta:Object.values(L.w).map(Pt=>({store:Pt,storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"key",keypath:"key",options:{unique:!0}},{name:"data",keypath:"data",options:{unique:!1}}]})),isDefault:!0};class D{constructor(m){this.dbService=m,this._shouldRemoveDataBaseErrorNames=["VersionError","InvalidStateError","UnknownError"],this._dbReady=!0,this.dbService||(this._dbReady=!1,console.info("For using persistent cache, you need to register NgxIndexedDBService."))}_getErrorMessage(m){return m instanceof Error?`Name: ${m.name}, Message: ${m.message}`:m instanceof Event&&m.target&&"error"in m.target?`${m.target.error?.message}`:typeof m=="string"?m:JSON.stringify(m)}_handleError(m){const A=typeof m=="string"||m instanceof Error&&this._shouldRemoveDataBaseErrorNames.includes(m.name);return this._dbReady&&A?(indexedDB.deleteDatabase(ee.name),console.warn(`IndexedDB has been refreshed. ${this._getErrorMessage(m)}`),this._dbReady=!1,(0,c.of)(void 0)):(console.warn(`IndexedDB request error. ${this._getErrorMessage(m)}`),(0,c.of)(void 0))}_executeIndexedDBOperation(m,A){return this._dbReady?m():(0,c.of)(A)}get dbReady(){return this._dbReady}add(m,A){return this._executeIndexedDBOperation(()=>this.dbService.add(m,A),void 0).pipe((0,c.catchError)(I=>this._handleError(I)))}bulkAdd(m,A){return this._executeIndexedDBOperation(()=>this.dbService.bulkAdd(m,A),[]).pipe((0,c.catchError)(I=>this._handleError(I)))}getByKey(m,A){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(m,"key",A),null).pipe((0,c.catchError)(I=>this._handleError(I)))}getByKeys(m,A){if(A.length===0)return(0,c.of)([]);const I=A.map($=>this._executeIndexedDBOperation(()=>this.getByKey(m,$),null));return(0,c.forkJoin)(I).pipe((0,c.map)($=>$.filter(Boolean)),(0,c.catchError)($=>this._handleError($)))}clear(m){return this._executeIndexedDBOperation(()=>this.dbService.clear(m),!1).pipe((0,c.catchError)(A=>this._handleError(A)))}update(m,A){return this._executeIndexedDBOperation(()=>this.dbService.update(m,A),void 0).pipe((0,c.catchError)(I=>this._handleError(I)))}bulkUpdate(m,A){return this._executeIndexedDBOperation(()=>this.dbService.bulkPut(m,A),[]).pipe((0,c.catchError)(I=>this._handleError(I)))}delete(m,A){return this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(m,A),!0).pipe((0,c.catchError)(I=>this._handleError(I)))}deleteByIndex(m,A){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(m,"key",A),null).pipe((0,c.switchMap)(I=>I?this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(m,I.id),!1):(0,c.of)(!0)),(0,c.catchError)(I=>this._handleError(I)))}getAll(m){return this._executeIndexedDBOperation(()=>this.dbService.getAll(m),null).pipe((0,c.catchError)(A=>this._handleError(A)))}static#e=this.\u0275fac=function(A){return new(A||D)(w.\u0275\u0275inject(C.NgxIndexedDBService,8))};static#t=this.\u0275prov=w.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac,providedIn:"root"})}class J{constructor(m){this._indexedDBService=m}create(m){switch(m.type){case P.P.Memory:return new O;case P.P.Persistent:return new U(this._indexedDBService,m.options);case P.P.PersistentAndMemory:return new U(this._indexedDBService,m.options,new O);default:throw new Error(`Unsupported cache type: ${m.type}`)}}static#e=this.\u0275fac=function(A){return new(A||J)(w.\u0275\u0275inject(D))};static#t=this.\u0275prov=w.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac,providedIn:"root"})}var ke=y(72051);const We=new w.InjectionToken("USE_SYSTEM_CLIENT_CACHE",{providedIn:"root",factory:()=>!!window.__useSystemClientCache});class he{constructor(m,A,I){this._injector=m,this._systemCaches=A,this._useSystemClientCache=I,this._caches=new Map}_getPersistentCacheRegistryItems(){var m=this;return(0,_.A)(function*(){return(yield(0,c.firstValueFrom)(m._indexedDBService.getAll(L.w.CacheRegistry)))?.map(I=>I.data)??[]})()}_initializePersistentCacheRegistry(){var m=this;return(0,_.A)(function*(){const I=(yield m._getPersistentCacheRegistryItems()).map($=>[$.name,$]);m._persistentCacheRegistry=new Map(I)})()}_initializeRegisteredCaches(){this._persistentCacheRegistry.forEach(m=>{const A=this._cacheFactory.create({name:m.name,type:m.useMemoryCache?P.P.PersistentAndMemory:P.P.Persistent,options:{tableName:m.tableName}});this._caches.set(m.name,A)})}_registerPersistentCache(m){var A=this;return(0,_.A)(function*(){const I={name:m.name,tableName:m.options.tableName,useMemoryCache:m.type===P.P.PersistentAndMemory,hash:""};yield(0,c.firstValueFrom)(A._indexedDBService.add(L.w.CacheRegistry,{key:m.name,data:I})),A._persistentCacheRegistry.set(m.name,I)})()}_updatePersistentCacheHash(m,A){var I=this;return(0,_.A)(function*(){const $=I._persistentCacheRegistry.get(m);$.hash=A,I._persistentCacheRegistry.set(m,$);const K=yield(0,c.firstValueFrom)(I._indexedDBService.getByKey(L.w.CacheRegistry,m));K?.data&&(K.data.hash=A,yield(0,c.firstValueFrom)(I._indexedDBService.update(L.w.CacheRegistry,{id:K.id,key:m,data:$})))})()}_isPersistentCache(m){return m===P.P.Persistent||m===P.P.PersistentAndMemory}_initializeSystemCaches(){var m=this;return(0,_.A)(function*(){const A=m._systemCaches||[];if(A.length===0)return;const I=A.filter($=>!m._caches.has($.name));yield Promise.all(I.map($=>m._create($)))})()}_create(m){var A=this;return(0,_.A)(function*(){if(A._caches.has(m.name))throw new Error(`Cache instance with name "${m.name}" already exists.`);const I=A._cacheFactory.create(m);return A._caches.set(m.name,I),A._isPersistentCache(m.type)&&(yield A._registerPersistentCache(m)),I})()}_internalInitialize(){var m=this;return(0,_.A)(function*(){m._indexedDBService=m._injector.get(D),m._cacheFactory=m._injector.get(J),m._httpClient=m._injector.get(p.HttpClient),m._caches.clear(),yield m._initializePersistentCacheRegistry(),m._initializeRegisteredCaches(),yield m._initializeSystemCaches(),yield m._validateSystemCaches()})()}_validateSystemCaches(){var m=this;return(0,_.A)(function*(){if(!m._caches.size||!m._indexedDBService.dbReady)return;const{hashes:A=[],cacheVersion:I=0}=yield(0,c.lastValueFrom)(m._httpClient.get("api/ClientCache/Hashes").pipe((0,k.catchError)(()=>(console.warn("Failed to get system hashes"),(0,c.of)({hashes:[],cacheVersion:0})))));if(m._getIsNeedForceClearCache(I)){yield m._innerClearAll();return}yield Promise.all(A.map(({name:K,value:Ie})=>m._internalValidateCache(K,Ie)))})()}_getIsNeedForceClearCache(m){const A=this._injector.get(V.sj),I="ClientCacheVersion",$=A.get(I),K=m&&m!==$;return K&&A.set(I,m),K}_internalValidateCache(m,A){var I=this;return(0,_.A)(function*(){if(!I._persistentCacheRegistry.has(m))return;if(I._persistentCacheRegistry.get(m).hash!==A){const K=I._caches.get(m);K&&(yield K.clear(),yield I._updatePersistentCacheHash(m,A))}})()}_innerClearAll(){var m=this;return(0,_.A)(function*(){yield Promise.all([...m._caches.values()].map(A=>A.clear()))})()}whenInitialized(){return this._initialized??=this._internalInitialize(),this._initialized}get(m){var A=this;return(0,_.A)(function*(){yield A.whenInitialized();const I=A._caches.get(m);if(!I)throw new Error(`Cache instance with name "${m}" does not exist.`);return I})()}getOrCreate(m){var A=this;return(0,_.A)(function*(){if(yield A.whenInitialized(),!A._caches.has(m.name)){if(!m.type)throw new Error(`Cache type must be specified for cache "${m.name}".`);yield A._create({...m,type:m.type})}return A._caches.get(m.name)})()}clearAll(){var m=this;return(0,_.A)(function*(){yield m.whenInitialized(),yield m._innerClearAll()})()}validateCache(m,A){var I=this;return(0,_.A)(function*(){yield I.whenInitialized(),yield I._internalValidateCache(m,A)})()}executeWithCache(m,A,I){return this._useSystemClientCache?(0,c.from)(this.whenInitialized()).pipe((0,c.switchMap)(()=>(0,c.of)(this._caches.get(m))),(0,c.switchMap)(function(){var $=(0,_.A)(function*(K){return{cacheValue:yield K?.get(A),cacheInstance:K}});return function(K){return $.apply(this,arguments)}}()),(0,c.switchMap)(({cacheValue:$,cacheInstance:K})=>$?(0,c.of)($):I.pipe((0,c.tap)(Ie=>K?.set(A,Ie))))):I}executeWithBulkCache(m,A){return this._useSystemClientCache?(0,c.from)(this.whenInitialized()).pipe((0,c.switchMap)(()=>(0,c.of)(this._caches.get(m))),(0,c.switchMap)(function(){var I=(0,_.A)(function*($){return{cachedItems:yield $?.getAll(),cacheInstance:$}});return function($){return I.apply(this,arguments)}}()),(0,c.switchMap)(({cachedItems:I,cacheInstance:$})=>I?.length?(0,c.of)(I):A.pipe((0,c.switchMap)(K=>(0,c.from)($?.bulkSet(K)).pipe((0,k.map)(()=>K)))))):A}static#e=this.\u0275fac=function(A){return new(A||he)(w.\u0275\u0275inject(w.Injector),w.\u0275\u0275inject(ke.P,8),w.\u0275\u0275inject(We,8))};static#t=this.\u0275prov=w.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac,providedIn:"root"})}},41483:(x,G,y)=>{y.d(G,{P:()=>_});var _;(function(p){p.Memory="Memory",p.Persistent="Persistent",p.PersistentAndMemory="PersistentAndMemory"})(_||(_={}))},72051:(x,G,y)=>{y.d(G,{P:()=>w});var _=y(59131),p=y.n(_);const w=new _.InjectionToken("SYSTEM_CACHE")},30293:(x,G,y)=>{y.d(G,{w:()=>_});var _;(function(p){p.CacheRegistry="cache-registry",p.Images="images",p.BusinessRules="business-rules",p.RuntimeEntitySchema="runtime-entity-schema",p.RuntimeFreedomUISchemas="runtime-freedom-ui-schemas",p.UserInfo="user-info",p.SystemSettingsCache="system-settings",p.ApplicationInfo="application-info"})(_||(_={}))},77017:x=>{x.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.error-icon-a{fill:#df1f26;}.error-icon-b,.error-icon-c{fill:none;}.error-icon-b{stroke:#fff;stroke-miterlimit:10;stroke-width:1.5px;}</style></defs><circle class="error-icon-a" cx="7" cy="7" r="7" transform="translate(1 1)"/><line class="error-icon-b" x2="6" y2="6" transform="translate(5 5)"/><line class="error-icon-b" y1="6" x2="6" transform="translate(5 5)"/><rect class="error-icon-c" width="16" height="16"/></svg>'},64207:x=>{x.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16.001" height="16" viewBox="0 0 16.001 16"><defs><style>.warning-icon-a{fill:#ff9800;}.warning-icon-b,.warning-icon-d{fill:none;}.warning-icon-b{stroke:#fff;stroke-linecap:round;stroke-miterlimit:10;stroke-width:2px;}.warning-icon-c{fill:#fff;}</style></defs><g transform="translate(-1330.138 361.759)"><path class="warning-icon-a" d="M1345.172-346.541H1331.1a.964.964,0,0,1-.84-1.438l7.033-12.505a.965.965,0,0,1,1.682,0l7.034,12.505A.965.965,0,0,1,1345.172-346.541Z"/><line class="warning-icon-b" y2="3" transform="translate(1338.139 -355.279)"/><circle class="warning-icon-c" cx="1.25" cy="1.25" r="1.25" transform="translate(1336.889 -350.529)"/></g><rect class="warning-icon-d" width="16" height="16" transform="translate(0.001)"/></svg>'},78683:x=>{x.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 1.49845H0.783829V4.00128H2.48383V0.000488281H0V1.49845Z" fill="#FF4013"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M14 1.00089H5.08699V3.00089H14V1.00089ZM14 6.00052H5.08699V8.00052H14V6.00052ZM0 12.7274V13.9998H3.19044V9.99979H0V11.1761H1.5V11.5073H0.75V12.3962H1.5V12.7274H0ZM14 10.9998H5.08699V12.9998H14V10.9998Z" fill="#FF4013"/>
<path d="M2.14577e-05 7.56383V8.99972L3.15902 8.99977V7.56383L2.26167 7.56378L3.15902 6.86625L3.15902 5.00135L2.14577e-05 5.00128L0 6.43327H1.5L2.14577e-05 7.56383Z" fill="#FF4013"/>
</svg>
`},36659:x=>{x.exports=`<svg id="Boolean_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_12" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-width="2"><rect width="14" height="14" stroke="none"/><rect x="1" y="1" width="12" height="12" fill="none"/></g><path id="Path_30" d="M10.5,4.5,5.912,9,4,7.162" transform="translate(1 0.5)" fill="rgba(0,0,0,0)" stroke="#ff4013" stroke-width="2"/></svg>
`},39078:x=>{x.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8.183.779c2.084.007 2.813.35 4.468 1.861l-1.875 2.424-2.95-1.229Z" fill="#ff1c06"/><path d="M7.643 14.846c-2.083-.006-2.813-.35-4.467-1.861l1.875-2.424L8 11.79Z" fill="#ffc6b8"/><path d="M15.024 8.156c-.064 2.22-.431 3.006-2 4.809l-2.4-1.931 1.322-3.175Z" fill="#ff4013"/><path d="M13.074 3.143c1.5 1.443 1.8 2.195 1.949 4.431l-3.03.46-1.286-2.925Z" fill="#ff320e"/><path d="M3.224 12.86c-1.5-1.443-1.795-2.195-1.948-4.43l3.029-.46 1.287 2.925Z" fill="#ffe8e3"/><path d="M12.999 12.98c-1.578 1.562-2.386 1.878-4.769 2.1l-.4-3.055 3.149-1.384Z" fill="#ff795a"/><g transform="translate(-798.326 92.909)" fill="none"><path d="M798.326-92.909h16v16h-16z"/><circle cx="7" cy="7" r="7" transform="translate(799.326 -91.909)" stroke="#ff4013" stroke-width="2"/><circle cx="3" cy="3" r="3" transform="translate(803.326 -87.909)" stroke="#ff4013" stroke-width="2"/><g stroke="#ff4013" stroke-width="2"><path d="M806.326-81.454v3.686"/><path d="M806.326-88.519v-3.386"/><path d="M803.211-84.909h-3.685"/><path d="M812.826-84.909h-3.387"/><path d="M804.126-87.162c-.8-.8-2.306-2.252-3.1-3.05"/><path d="M811.628-79.605c-.729-.73-2.31-2.2-3.04-2.926"/><path d="m804.02-82.6-3 3"/><path d="m811.629-90.213-3.088 2.978"/></g></g></svg>
`},26861:x=>{x.exports=`<svg id="Date_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_6448" transform="translate(1 3)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="14" height="12" stroke="none"/><rect x="1" y="1" width="12" height="10" fill="none"/></g><line id="Line_764" x2="12" transform="translate(2 7)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_11729" d="M176.171,1073.754v3" transform="translate(-171.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/><path id="Path_11730" d="M176.171,1073.754v3" transform="translate(-165.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/></svg>
`},55146:x=>{x.exports=`<svg id="Datetime_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Icon_left_panel_date_time_16x16_heavy" transform="translate(0)"><rect id="Rectangle_6448" width="16" height="16" fill="none"/><path id="Path_6271" d="M1895.033,260.278h-4.149v-9h12v2" transform="translate(-1889.884 -248.278)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7772" d="M0,0H4.5" transform="translate(1 6)" fill="none" stroke="#ff4013" stroke-width="2"/><line id="Line_771" y2="4" transform="translate(4)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_772" y2="4" transform="translate(10)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Path_6272" transform="translate(-1889.764 -248.582)" fill="none" stroke-miterlimit="10"><path d="M1905.764,258.584a5,5,0,1,1-5-5A5,5,0,0,1,1905.764,258.584Z" stroke="none"/><path d="M 1900.7626953125 261.5840454101562 C 1902.417602539062 261.5840454101562 1903.763916015625 260.23828125 1903.763916015625 258.5840759277344 C 1903.763916015625 256.9292602539062 1902.417602539062 255.5829772949219 1900.7626953125 255.5829772949219 C 1899.109130859375 255.5829772949219 1897.763916015625 256.9292602539062 1897.763916015625 258.5840759277344 C 1897.763916015625 260.23828125 1899.109130859375 261.5840454101562 1900.7626953125 261.5840454101562 M 1900.7626953125 263.5840454101562 C 1898.000244140625 263.5840454101562 1895.763916015625 261.3454284667969 1895.763916015625 258.5840759277344 C 1895.763916015625 255.8215942382812 1898.000244140625 253.5829772949219 1900.7626953125 253.5829772949219 C 1903.524169921875 253.5829772949219 1905.763916015625 255.8215942382812 1905.763916015625 258.5840759277344 C 1905.763916015625 261.3454284667969 1903.524169921875 263.5840454101562 1900.7626953125 263.5840454101562 Z" stroke="none" fill="#ff4013"/></g><path id="Path_6273" d="M1900.1,255.194v4h2.5" transform="translate(-1889.098 -249.194)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},71011:x=>{x.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2 3.5H14V12C14 12.1326 13.9473 12.2598 13.8536 12.3536C13.7598 12.4473 13.6326 12.5 13.5 12.5H2.5C2.36739 12.5 2.24021 12.4473 2.14645 12.3536C2.05268 12.2598 2 12.1326 2 12V3.5Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14 3.5L8 9L2 3.5" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},55039:x=>{x.exports=`<svg id="File_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Group_7055" transform="translate(-733.278 92.545)"><g id="Rectangle_6454" transform="translate(735.278 -91.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="12" height="14" stroke="none"/><rect x="1" y="1" width="10" height="12" fill="none"/></g><line id="Line_774" x2="6" transform="translate(738.278 -87.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_775" x2="6" transform="translate(738.278 -84.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_777" x2="4" transform="translate(738.278 -81.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},68877:x=>{x.exports=`<svg id="Float_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_14515" transform="translate(-144 -422)"><rect id="Rectangle_39433" width="16" height="16" transform="translate(144 422)" fill="none"/></g><path id="Path_11302" d="M6.957-4.64a6.469,6.469,0,0,1-.8,3.6A2.764,2.764,0,0,1,3.707.127,2.732,2.732,0,0,1,1.285-1.079,6.377,6.377,0,0,1,.47-4.64a6.53,6.53,0,0,1,.793-3.621A2.752,2.752,0,0,1,3.707-9.426,2.739,2.739,0,0,1,6.135-8.208,6.39,6.39,0,0,1,6.957-4.64Zm-4.539,0a7.22,7.22,0,0,0,.3,2.447,1.022,1.022,0,0,0,.993.74A1.033,1.033,0,0,0,4.7-2.2,7.02,7.02,0,0,0,5-4.64a7,7,0,0,0-.308-2.453,1.034,1.034,0,0,0-.987-.746,1.025,1.025,0,0,0-.99.746A7.208,7.208,0,0,0,2.418-4.64ZM7.759-.908a1.064,1.064,0,0,1,.286-.806,1.158,1.158,0,0,1,.832-.273,1.125,1.125,0,0,1,.816.279,1.061,1.061,0,0,1,.289.8,1.061,1.061,0,0,1-.292.79,1.105,1.105,0,0,1-.812.289,1.138,1.138,0,0,1-.825-.282A1.057,1.057,0,0,1,7.759-.908ZM13.69,0H11.728V-5.37l.019-.882.032-.965q-.489.489-.679.641l-1.066.857L9.088-6.9l2.99-2.38H13.69Z" transform="translate(0.53 12.426)" fill="#ff4013"/></svg>
`},92458:x=>{x.exports=`<svg id="Guid_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_42308" width="16" height="16" fill="none"/><path id="Path_11737" d="M1.162,0H3.43V-9.8H1.162Zm9.926-10.388v3.654a2.894,2.894,0,0,0-2.254-.91A3.661,3.661,0,0,0,5.068-3.766,3.661,3.661,0,0,0,8.834.112a2.9,2.9,0,0,0,2.352-.98V0h2.086V-10.388ZM9.212-1.68A1.911,1.911,0,0,1,7.28-3.766,1.911,1.911,0,0,1,9.212-5.852,1.908,1.908,0,0,1,11.13-3.766,1.908,1.908,0,0,1,9.212-1.68Z" transform="translate(0.838 13)" fill="#ff4013" stroke="rgba(0,0,0,0)" stroke-width="1"/></svg>
`},65689:x=>{x.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1742_819)">
<path d="M10.913 8.99277L7.40833 13.0074H13.0074V11.2395L10.913 8.99277ZM10.8641 6.00745L15.0074 10.4519V15.0074H3.00745L10.8641 6.00745Z" fill="#ff4013"/>
<path d="M3.43597 9.72806C2.87697 10.2871 2.20496 9.92807 1.64496 9.37007C1.08596 8.81107 0.726988 8.13807 1.28699 7.57907L3.07794 5.78806C3.63694 5.22906 4.30898 5.58806 4.86798 6.14606C5.42798 6.70506 5.78595 7.37706 5.22595 7.93706L3.43597 9.72806Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M7.93689 5.22705C7.37689 5.78605 6.70591 5.42704 6.14691 4.86804C5.58691 4.30904 5.22894 3.63704 5.78894 3.07804L7.57892 1.28704C8.13892 0.728043 8.80993 1.08704 9.36993 1.64604C9.92993 2.20504 10.2879 2.87704 9.72888 3.43704L7.93689 5.22705Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M4.70691 6.51907L6.51791 4.70807" stroke="#ff4013" stroke-width="2"/>
<path d="M11.301 2.00702H14.0079V14.007H2.00793V11.581" stroke="#ff4013" stroke-width="2"/>
</g>
<defs>
<clipPath id="clip0_1742_819">
<rect width="16.007" height="16.007" fill="#ff4013"/>
</clipPath>
</defs>
</svg>
`},60521:x=>{x.exports=`<svg id="Integer_icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.99433 4.65198C9.48732 5.09802 9.74027 5.69781 9.74027 6.39946C9.74027 7.11039 9.46186 7.74386 8.95863 8.29085L8.95331 8.29664C8.68048 8.58037 8.17318 8.98047 7.44252 9.47417L7.44143 9.4749C7.00788 9.76552 6.67964 10.0338 6.4484 10.2773C6.39755 10.3308 6.35224 10.3822 6.31202 10.4316H9.03463C9.42976 10.4316 9.75009 10.7519 9.75009 11.1471C9.75009 11.5422 9.42976 11.8625 9.03463 11.8625H4.36201V11.5055C4.36201 10.774 4.62396 10.1113 5.14954 9.53003C5.45393 9.18287 5.98212 8.74216 6.73359 8.22779C7.28336 7.835 7.61754 7.57002 7.77738 7.40238C8.08169 7.07198 8.22096 6.73348 8.22096 6.38964C8.22096 6.03409 8.11952 5.81409 7.95289 5.66027C7.78277 5.50324 7.51683 5.40148 7.12478 5.40148C6.72877 5.40148 6.47218 5.52561 6.29884 5.75228L6.29169 5.76164L6.28392 5.77051C6.13055 5.94579 6.0142 6.20942 5.96505 6.5873C5.91679 6.95826 5.61042 7.29659 5.18377 7.29659C4.7751 7.29659 4.39395 6.95656 4.44447 6.49553C4.51728 5.83108 4.75991 5.26428 5.17392 4.82141C5.68203 4.26788 6.36125 4 7.15424 4C7.87626 4 8.49451 4.21025 8.99122 4.6492L8.99433 4.65198ZM14.8743 4.5961C15.3635 5.01371 15.6083 5.57814 15.6083 6.262C15.6083 6.71398 15.4974 7.12093 15.2526 7.45671C15.1531 7.59318 15.0352 7.71289 14.9008 7.81669C15.0605 7.92572 15.2015 8.0545 15.3211 8.20545C15.6165 8.55303 15.7556 8.98069 15.7556 9.46307C15.7556 10.1963 15.4914 10.8144 14.9713 11.2883C14.4419 11.7715 13.7612 12 12.9634 12C12.2299 12 11.6078 11.8045 11.1119 11.4124L11.1064 11.408C10.628 11.014 10.3332 10.4794 10.2052 9.83055C10.1107 9.35139 10.5042 8.97835 10.9288 8.97835C11.3492 8.97835 11.6378 9.30727 11.7079 9.64478C11.7693 9.94025 11.9002 10.158 12.0891 10.3154C12.3147 10.495 12.5969 10.5985 12.9634 10.5985C13.3872 10.5985 13.6961 10.4769 13.9229 10.2668C14.1282 10.0596 14.2363 9.80805 14.2363 9.49253C14.2363 9.15687 14.1319 8.93882 13.9486 8.7817C13.7609 8.62082 13.483 8.52399 13.0419 8.52399H12.7866C12.4159 8.52399 12.1154 8.22345 12.1154 7.85271C12.1154 7.48197 12.4159 7.18143 12.7866 7.18143H13.0125C13.4306 7.18143 13.6903 7.08609 13.85 6.9535C14.0037 6.81675 14.0989 6.61783 14.0989 6.31109C14.0989 6.00164 14.0017 5.79895 13.8513 5.66111L13.8504 5.66027C13.6842 5.50686 13.4217 5.4113 13.0223 5.4113C12.6106 5.4113 12.3484 5.51295 12.1702 5.68456L12.1656 5.68906C12.0215 5.82278 11.914 6.00455 11.8495 6.25293C11.766 6.57474 11.481 6.87436 11.0816 6.87436C10.6572 6.87436 10.2506 6.49494 10.3668 6.00508C10.4953 5.4634 10.7597 5.01133 11.1524 4.66211C11.6438 4.20736 12.2763 4 13.0125 4C13.739 4 14.3777 4.18225 14.8711 4.59337L14.8743 4.5961ZM3.41307 4.92822V11.1029C3.41307 11.5224 3.07297 11.8625 2.65342 11.8625C2.23388 11.8625 1.89377 11.5224 1.89377 11.1029V6.23307C1.68552 6.37174 1.46266 6.49124 1.22573 6.59268C0.723506 6.80771 0.244141 6.40276 0.244141 5.92406C0.244141 5.5872 0.467589 5.3135 0.755873 5.2089C0.963927 5.13341 1.17934 5.03405 1.39555 4.90741C1.64533 4.74519 1.85627 4.57307 2.04007 4.3863C2.18718 4.23681 2.39336 4.13748 2.62233 4.13748C3.05905 4.13748 3.41307 4.4915 3.41307 4.92822Z" fill="#ff4013"/>
</svg>
`},61631:x=>{x.exports=`<svg id="Lookup_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_6916" transform="translate(2.277 2)"><g id="Group_6915" transform="translate(-0.277)"><circle id="Ellipse_237" cx="4.5" cy="4.5" r="4.5" fill="none" stroke="#ff4013" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path id="Path_6243" d="M.344.344,4.123,4.123" transform="translate(7.877 7.876)" fill="none" stroke="#ff4013" stroke-width="2"/></g></g><rect id="Rectangle_24756" width="16" height="16" fill="none"/></svg>
`},32643:x=>{x.exports=`<svg id="Money_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><path id="Path_7070" d="M-318.645,863.293h-6v-8h14v4" transform="translate(325.645 -852.293)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7071" d="M-322.646,855.292a2,2,0,0,1-2,2" transform="translate(326.646 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7072" d="M-312.246,857.292a2,2,0,0,1-2-2" transform="translate(326.246 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7073" d="M-324.646,861.692a2,2,0,0,1,2,2" transform="translate(326.646 -853.692)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Ellipse_1363" transform="translate(6 5)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="2" cy="2" r="2" stroke="none"/><circle cx="2" cy="2" r="1" fill="none"/></g><path id="Path_7074" d="M-310.846,861.425c0,.737-1.12,1.333-2.5,1.333s-2.5-.6-2.5-1.333,1.12-1.333,2.5-1.333S-310.846,860.69-310.846,861.425Z" transform="translate(325.846 -851.092)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7075" d="M-310.846,863.292c0,.589-1.12,1.333-2.5,1.333s-2.5-.744-2.5-1.333" transform="translate(325.846 -850.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},59155:x=>{x.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.3353 1.83815L6.26378 1.46676L6.26378 1.46676L5.3353 1.83815ZM6.03813 3.59524L5.10965 3.96663L5.10965 3.96663L6.03813 3.59524ZM5.82454 4.94398L5.05632 4.3038L5.0563 4.30383L5.82454 4.94398ZM5.44629 5.39792L6.21451 6.03811L6.21453 6.03808L5.44629 5.39792ZM5.52758 7.19434L4.82047 7.90144L4.8205 7.90147L5.52758 7.19434ZM6.8057 8.47236L7.5128 7.76526L7.51278 7.76523L6.8057 8.47236ZM8.60205 8.55382L7.96198 7.7855L7.96187 7.78559L8.60205 8.55382ZM9.05613 8.17554L9.69619 8.94386L9.69631 8.94376L9.05613 8.17554ZM10.4048 7.96192L10.7762 7.03345L10.7761 7.03344L10.4048 7.96192ZM12.1617 8.66476L11.7903 9.59322L11.7903 9.59323L12.1617 8.66476ZM12.9999 9.90268H11.9999V9.90272L12.9999 9.90268ZM13 11.7369H14V11.7368L13 11.7369ZM4.09733 2C4.23363 2 4.3562 2.08298 4.40682 2.20954L6.26378 1.46676C5.90943 0.580885 5.05144 0 4.09733 0V2ZM4.40682 2.20953L5.10965 3.96663L6.96661 3.22386L6.26378 1.46676L4.40682 2.20953ZM5.10965 3.96663C5.15517 4.08044 5.13462 4.20985 5.05632 4.3038L6.59277 5.58417C7.14152 4.92566 7.28485 4.01947 6.96661 3.22385L5.10965 3.96663ZM5.0563 4.30383L4.67804 4.75777L6.21453 6.03808L6.59279 5.58414L5.0563 4.30383ZM4.67807 4.75774C3.90567 5.68462 3.96693 7.0479 4.82047 7.90144L6.23468 6.48723C6.11298 6.36552 6.10396 6.17076 6.21451 6.03811L4.67807 4.75774ZM4.8205 7.90147L6.09862 9.17949L7.51278 7.76523L6.23466 6.4872L4.8205 7.90147ZM6.09859 9.17947C6.95196 10.0328 8.31517 10.0946 9.24224 9.32204L7.96187 7.78559C7.82939 7.89599 7.63468 7.88713 7.5128 7.76526L6.09859 9.17947ZM9.24212 9.32213L9.69619 8.94386L8.41606 7.40722L7.96198 7.7855L9.24212 9.32213ZM9.69631 8.94376C9.79033 8.86541 9.91963 8.8449 10.0334 8.8904L10.7761 7.03344C9.98045 6.71516 9.07438 6.85861 8.41594 7.40732L9.69631 8.94376ZM10.0333 8.89039L11.7903 9.59322L12.5331 7.73629L10.7762 7.03345L10.0333 8.89039ZM11.7903 9.59323C11.917 9.64389 11.9999 9.76649 11.9999 9.90268H13.9999C13.9999 8.94847 13.4189 8.09059 12.5331 7.73628L11.7903 9.59323ZM11.9999 9.90272L12 11.7369L14 11.7368L13.9999 9.90264L11.9999 9.90272ZM12 11.7369C12 11.8823 11.8822 12 11.737 12V14C12.987 14 14 12.9867 14 11.7369H12ZM11.737 12C6.35945 12 2 7.64067 2 2.26318H0C0 8.74528 5.25492 14 11.737 14V12ZM2 2.26318C2 2.11782 2.11785 2 2.26316 2V0C1.01322 0 0 1.0133 0 2.26318H2ZM2.26316 2H4.09733V0H2.26316V2Z" fill="#FF4013"/>
</svg>
`},67021:x=>{x.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 1H3C1.89543 1 1 1.89543 1 3V13C1 14.1046 1.89543 15 3 15H13C14.1046 15 15 14.1046 15 13V3C15 1.89543 14.1046 1 13 1Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M9 12H7V6H4V4H12V6H9V12Z" fill="#FF4013"/>
</svg>
`},28010:x=>{x.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.14 6.90901C5.13775 7.50618 5.25259 8.098 5.478 8.65101L1.5 12.629V15.229H4.1V13.669H5.66V12.109H7.22L8.078 11.251C8.631 11.4764 9.22282 11.5912 9.82 11.589C10.7456 11.589 11.6504 11.3145 12.4201 10.8003C13.1897 10.286 13.7895 9.55512 14.1438 8.69996C14.498 7.84481 14.5907 6.90381 14.4101 5.99598C14.2295 5.08815 13.7838 4.25426 13.1293 3.59975C12.4747 2.94524 11.6409 2.49951 10.733 2.31893C9.82519 2.13835 8.8842 2.23103 8.02904 2.58525C7.17388 2.93947 6.44297 3.53932 5.92872 4.30894C5.41448 5.07856 5.14 5.98339 5.14 6.90901ZM12.4832 5.95178C12.4832 6.84671 11.7577 7.57221 10.8628 7.57221C9.96785 7.57221 9.24236 6.84671 9.24236 5.95178C9.24236 5.05684 9.96785 4.33135 10.8628 4.33135C11.7577 4.33135 12.4832 5.05684 12.4832 5.95178Z" fill="#FF4013"/>
</svg>
`},97180:x=>{x.exports=`<svg id="Text_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_39432" width="16" height="16" fill="none"/><path id="Path_11304" d="M5.113,0H2.994V-8.23H.28V-9.994H7.827V-8.23H5.113Z" transform="translate(4 13)" fill="#ff4013"/></svg>
`},8510:x=>{x.exports=`<svg id="Time_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Ellipse_1346" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="7" cy="7" r="7" stroke="none"/><circle cx="7" cy="7" r="6" fill="none"/></g><path id="Path_6908" d="M1824.814,31.345v6h3" transform="translate(-1816.814 -29.345)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},64337:x=>{x.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 8H14" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M8 13.8375C9.38071 13.8375 10.5 11.2239 10.5 7.99998C10.5 4.77601 9.38071 2.16248 8 2.16248C6.61929 2.16248 5.5 4.77601 5.5 7.99998C5.5 11.2239 6.61929 13.8375 8 13.8375Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},73308:(x,G,y)=>{y.d(G,{A:()=>p});function _(w,V,c,k,U,O,P){try{var C=w[O](P),L=C.value}catch(ee){c(ee);return}C.done?V(L):Promise.resolve(L).then(k,U)}function p(w){return function(){var V=this,c=arguments;return new Promise(function(k,U){var O=w.apply(V,c);function P(L){_(O,k,U,P,C,"next",L)}function C(L){_(O,k,U,P,C,"throw",L)}P(void 0)})}}}}]);
